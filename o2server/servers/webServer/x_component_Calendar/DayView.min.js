MWF.require("MWF.widget.Calendar",null,!1);var MWFCalendarDayView=MWF.xApplication.Calendar.DayView=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",date:""},initialize:function(t,e,i){this.setOptions(i),this.path="../x_component_Calendar/$DayView/",this.cssPath="../x_component_Calendar/$DayView/"+this.options.style+"/css.wcss",this._loadCss(),this.app=e,this.container=$(t),this.weekBegin=this.app.calendarConfig.weekBegin||"0",this.load()},load:function(){this.node=new Element("div.node",{styles:this.css.node}).inject(this.container),this.node.setStyle("position","relative"),this.resetNodeSize(),this.loadCalendar()},resetNodeSize:function(){var t=this.container.getSize().y-50;this.node.setStyle("height",t+"px"),this.calendar&&this.calendar.resetBodySize()},loadCalendar:function(){var t="";t=this.options.date?Date.parse(this.options.date):new Date,this.calendar=new MWFCalendarDayView.Calendar(this,t)},hide:function(){new Fx.Morph(this.node,{duration:"300",transition:Fx.Transitions.Expo.easeOut}).start({opacity:0}).chain(function(){this.node.setStyle("display","none")}.bind(this))},show:function(){this.node.setStyles(this.css.node),new Fx.Morph(this.node,{duration:"800",transition:Fx.Transitions.Expo.easeOut}).start({opacity:1}).chain(function(){this.calendar.dataTable_wholeDay&&this.calendar.dataTable_wholeDay.setStyle("display","")}.bind(this))},reload:function(){this.calendar&&this.calendar.reLoadCalendar()},recordStatus:function(){var t="";return this.calendar&&(t=this.calendar.date),{date:t.toString()}},destroy:function(){this.calendar&&this.calendar.destroy(),this.node.destroy()}});MWFCalendarDayView.DayWidth,MWFCalendarDayView.HourHeight=48,MWFCalendarDayView.DayHeight=24*MWFCalendarDayView.HourHeight,MWFCalendarDayView.DayMsec=864e5,MWFCalendarDayView.Calendar=new Class({Implements:[Events],initialize:function(t,e){this.view=t,this.css=this.view.css,this.container=this.view.node,this.app=this.view.app,this.lp=this.app.lp,this.date=e||new Date,this.today=new Date,this.load()},load:function(){this.startTime=new Date(this.date.get("year"),this.date.get("month"),this.date.get("date"),0,0,0),this.startTimeStr=this.startTime.format("db"),this.endTime=new Date(this.date.get("year"),this.date.get("month"),this.date.get("date"),23,59,59),this.endTimeStr=this.endTime.format("db"),this.titleNode=new Element("div",{styles:this.css.calendarTitleNode}).inject(this.container),this.titleTable=new Element("table",{styles:this.css.titleTable,border:"0",cellPadding:"0",cellSpacing:"0"}).inject(this.container),this.scrollNode=new Element("div.scrollNode",{styles:this.css.scrollNode}).inject(this.container),this.contentWarpNode=new Element("div.contentWarpNode",{styles:this.css.contentWarpNode}).inject(this.scrollNode),this.contentContainerNode=new Element("div.contentContainerNode",{styles:this.css.contentContainerNode}).inject(this.contentWarpNode),this.bodyNode=new Element("div.bodyNode",{styles:this.css.contentNode}).inject(this.contentContainerNode),this.setTitleNode(),this.loadTitleTable(),this.loadBodyTable(),this.loadDataTable_wholeDay(),this.loadDataTable(),this.loadCalendar()},setTitleNode:function(){this.prevDayNode=new Element("div",{styles:this.css.calendarPrevDayNode}).inject(this.titleNode);var t=this.date.format(this.lp.dateFormatDay)+"，"+this.lp.weeks.arr[this.date.getDay()];this.titleTextNode=new Element("div",{styles:this.css.calendarTitleTextNode,text:t}).inject(this.titleNode),this.nextDayNode=new Element("div",{styles:this.css.calendarNextDayNode}).inject(this.titleNode),this.prevDayNode.addEvents({mouseover:function(){this.prevDayNode.setStyles(this.css.calendarPrevDayNode_over)}.bind(this),mouseout:function(){this.prevDayNode.setStyles(this.css.calendarPrevDayNode)}.bind(this),mousedown:function(){this.prevDayNode.setStyles(this.css.calendarPrevDayNode_down)}.bind(this),mouseup:function(){this.prevDayNode.setStyles(this.css.calendarPrevDayNode_over)}.bind(this),click:function(){this.changeDayPrev()}.bind(this)}),this.nextDayNode.addEvents({mouseover:function(){this.nextDayNode.setStyles(this.css.calendarNextDayNode_over)}.bind(this),mouseout:function(){this.nextDayNode.setStyles(this.css.calendarNextDayNode)}.bind(this),mousedown:function(){this.nextDayNode.setStyles(this.css.calendarNextDayNode_down)}.bind(this),mouseup:function(){this.nextDayNode.setStyles(this.css.calendarNextDayNode_over)}.bind(this),click:function(){this.changeDayNext()}.bind(this)}),this.titleTextNode.addEvents({mouseover:function(){this.titleTextNode.setStyles(this.css.calendarTitleTextNode_over)}.bind(this),mouseout:function(){this.titleTextNode.setStyles(this.css.calendarTitleTextNode)}.bind(this),mousedown:function(){this.titleTextNode.setStyles(this.css.calendarTitleTextNode_down)}.bind(this),mouseup:function(){this.titleTextNode.setStyles(this.css.calendarTitleTextNode_over)}.bind(this)}),this.createDaySelector()},changeDayPrev:function(){this.date.decrement("day",1);var t=this.date.format(this.lp.dateFormatDay)+"，"+this.lp.weeks.arr[this.date.getDay()];this.titleTextNode.set("text",t),this.reLoadCalendar()},changeDayNext:function(){this.date.increment("day",1);var t=this.date.format(this.lp.dateFormatDay)+"，"+this.lp.weeks.arr[this.date.getDay()];this.titleTextNode.set("text",t),this.reLoadCalendar()},changeDaySelect:function(){this.monthSelector||this.createDaySelector()},createDaySelector:function(){MWF.require("MWF.widget.Calendar",function(){this.calendar=new MWF.widget.Calendar(this.titleTextNode,{style:"meeting_blue",target:this.node,baseDate:this.date,onQueryComplate:function(t,e,i){var a=new Date.parse(e);this.changeDayTo(a)}.bind(this)})}.bind(this))},changeDayTo:function(t){this.date=t;var e=this.date.format(this.lp.dateFormatDay)+"，"+this.lp.weeks.arr[this.date.getDay()];this.titleTextNode.set("text",e),this.reLoadCalendar()},isToday:function(t){var e=new Date;return e.get("year")==t.get("year")&&(e.get("month")==t.get("month")&&e.get("date")==t.get("date"))},isSameday:function(t,e){return t.get("year")==e.get("year")&&(t.get("month")==e.get("month")&&t.get("date")==e.get("date"))},loadTitleTable:function(){if(!this.wholeDayTd){var t=new Element("tr").inject(this.titleTable),e=new Element("td.calendarTableCell",{tdType:"hour",styles:this.css.calendarTableCell_hour}).inject(t);e.setStyle("min-height","80px");new Element("div",{text:this.lp.allDay}).inject(e);this.wholeDayTd=new Element("td",{tdType:"calendar",styles:this.css.calendarTableCell}).inject(t),this.wholeDayTd.addEvent("click",function(t){this.setCurrentTd(this.wholeDayTd)}.bind(this)),this.wholeDayTd.addEvent("dblclick",function(t){this.cancelCurrentTd();this.date.format("%Y-%m-%d");var e=new MWF.xApplication.Calendar.EventForm(this,{},{startTime:Date.parse(t.target.retrieve("dateStr")),endTime:Date.parse(t.target.retrieve("dateStr")),isWholeday:!0},{app:this.app});e.view=this,e.create()}.bind(this))}},loadBodyTable:function(){this.calendarTable=new Element("table",{styles:this.css.calendarTable,height:"100%",border:"0",cellPadding:"0",cellSpacing:"0"}).inject(this.bodyNode),this.hourTdMap={};for(var t=0;t<24;t++){var e=new Element("tr").inject(this.calendarTable),i=new Element("td.calendarTableCell",{tdType:"hour",styles:this.css.calendarTableCell_hour,valign:"top"}).inject(e);new Element("div",{text:t+":00"}).inject(i);i.store("hour",t),(i=this.hourTdMap[t]=new Element("td",{tdType:"calendar",styles:this.css.calendarTableCell}).inject(e)).store("hour",t),i.addEvent("click",function(t){this.setCurrentTd(t.target)}.bind(this)),i.addEvent("dblclick",function(t){this.cancelCurrentTd();var e=t.target.retrieve("hour"),i=this.date.format("%Y-%m-%d"),a=new MWF.xApplication.Calendar.EventForm(this,{},{startTime:Date.parse(i+" "+e+":00"),endTime:Date.parse(i+" "+(e+1)+":00")},{app:this.app});a.view=this,a.create()}.bind(this)),new Drag(i,{onStart:function(t,e){this.cancelCurrentTd(),this.cellDragStart(t,e)}.bind(this),onDrag:function(t,e){this.cellDrag(t,e)}.bind(this),onComplete:function(t,e){this.completeDrag(t,e)}.bind(this)})}},setCurrentTd:function(t){if(t.setStyle("background-color","#fffdf2"),this.currentSelectedTd){var e=this.isToday(this.date);this.currentSelectedTd.setStyle("background-color",e?"#F8FBFF":"#fff")}this.currentSelectedTd=t},cancelCurrentTd:function(){if(this.currentSelectedTd){var t=this.isToday(this.date);this.currentSelectedTd.setStyle("background-color",t?"#F8FBFF":"#fff")}this.currentSelectedTd=null},reLoadCalendar:function(){this.startTime=new Date(this.date.get("year"),this.date.get("month"),this.date.get("date"),0,0,0),this.startTimeStr=this.startTime.format("db"),this.endTime=new Date(this.date.get("year"),this.date.get("month"),this.date.get("date"),23,59,59),this.endTimeStr=this.endTime.format("db"),this.day&&this.day.destroy(),this.day=null,this.wholeDay&&this.wholeDay.destroy(),this.wholeDay=null,this.loadTitleTable(),this.loadCalendar()},loadCalendar:function(){this.app.currentDate=this.date.clone(),this.dateIndexMap=null,this.titleTable.getElement("td:nth-child(1)").setStyle("height","auto"),this.loadData(function(t){this.loadwholeDay(this.wholeDayData),this.loadDataDay(this.inOneDayEvents),this.resetBodySize(),this.setTodayTds(),this.cancelCurrentTd()}.bind(this))},setTodayTds:function(){if(this.isToday(this.date)){this.wholeDayTd.setStyle("background-color","#f8fbff"),Object.each(this.hourTdMap,(function(t){t.setStyle("background-color","#f8fbff")}));var t=new Date,e=this.nowTd=this.hourTdMap[t.get("hours")],i=t.get("minutes");i=i<2?2:i;var a=e.getPosition(this.bodyNode);this.nowTimeNode=new Element("div",{styles:{position:"absolute",left:a.x,top:a.y+(i-2)/60*MWFCalendarDayView.HourHeight,height:"2px",width:MWFCalendarDayView.DayWidth,"background-color":"#ff3333"}}).inject(this.bodyNode),this.isSetToday=!0}else this.isSetToday&&(this.wholeDayTd.setStyle("background-color","#fff"),Object.each(this.hourTdMap,(function(t){t.setStyle("background-color","#fff")})),this.nowTimeNode&&this.nowTimeNode.destroy(),this.nowTd&&(this.nowTd=null),this.isSetToday=!1)},loadData:function(t){this.app.actions.listEventWithFilter({calendarIds:this.app.getSelectedCalendarId(),startTime:this.startTimeStr,endTime:this.endTimeStr},function(e){this.wholeDayData=e.data&&e.data.wholeDayEvents?e.data.wholeDayEvents:[],this.inOneDayEvents=[],(e.data&&e.data.inOneDayEvents?e.data.inOneDayEvents:[]).each(function(t){t.inOneDayEvents.length>0&&this.inOneDayEvents.push(t)}.bind(this)),t&&t()}.bind(this))},loadDataTable_wholeDay:function(t){this.dataTable_wholeDay=new Element("table.dataTable",{styles:this.css.calendarTable,height:"0",border:"0",cellPadding:"0",cellSpacing:"0"}).inject(this.container),this.dataTable_wholeDay.setStyles({display:"none",position:"absolute",top:"51px",left:"0px",margin:"0px auto 0px 12px"});var e=new Element("tr").inject(this.dataTable_wholeDay);new Element("td",{styles:{height:"0px",position:"relative"}}).inject(e),this.dataTd_wholeDay=new Element("td",{valign:"top",styles:{height:"0px",position:"relative"}}).inject(e)},loadwholeDay:function(t){this.wholeDay=new MWFCalendarDayView.Calendar.wholeDay(this,t,this.date)},loadDataTable:function(t){this.bodyNode.setStyle("position","relative"),this.dataTable=new Element("table.dataTable",{styles:this.css.calendarTable,height:"0",border:"0",cellPadding:"0",cellSpacing:"0"}).inject(this.bodyNode),this.dataTable.setStyles({position:"absolute",top:"0px",left:"0px"});var e=new Element("tr").inject(this.dataTable);new Element("td",{styles:{height:"0px",position:"relative"}}).inject(e),this.dataTd=new Element("td",{styles:{height:"0px",position:"relative"}}).inject(e)},loadDataDay:function(t){t.length>0&&this.loadDay(t[0].inOneDayEvents)},loadDay:function(t){this.day=new MWFCalendarDayView.Calendar.Day(this.dataTd,this.date,this,t)},resetBodySize:function(){var t=this.container.getSize(),e=this.titleNode.getSize(),i=this.titleTable.getSize(),a=t.y-e.y-i.y;this.contentWarpNode&&this.contentWarpNode.setStyles({width:t.x-40+"px"}),this.scrollNode.setStyle("height",a+"px");var s=MWFCalendarDayView.DayWidth=t.x-40-60;this.calendarTable&&(this.calendarTable.setStyles({width:t.x-40+"px"}),this.calendarTable.getElement("tr:nth-child(1)").getElements("td").each((function(t,e){t.setStyle("width",(0==e?60:s)+"px")})));this.titleTable&&(this.titleTable.setStyles({width:t.x-40+"px"}),this.titleTable.getElement("tr:nth-child(1)").getElements("td").each((function(t,e){t.setStyle("width",(0==e?60:s)+"px")})));this.dataTable&&(this.dataTable.setStyles({width:t.x-40+"px"}),this.dataTable.getElement("tr:nth-child(1)").getElements("td").each((function(t,e){t.setStyle("width",(0==e?60:s)+"px")})));(this.day&&this.day.resize(),this.dataTable_wholeDay)&&(this.dataTable_wholeDay.setStyles({width:t.x-40+"px"}),this.dataTable_wholeDay.getElement("tr:nth-child(1)").getElements("td").each((function(t,e){t.setStyle("width",(0==e?60:s)+"px")})));this.wholeDay&&this.wholeDay.resize(),this.nowTimeNode&&(this.nowTimeNode.setStyle("width",s),this.nowTd&&this.nowTimeNode.setStyle("left",this.nowTd.getPosition(this.bodyNode).x))},reload:function(){this.view.reload()},destroy:function(){this.day&&this.day.destroy(),this.wholeDay&&this.wholeDay.destroy(),this.container.empty()},getIndexByPage:function(t){var e=this.calendarTable.getPosition();this.pageOffsetHeight=t.y-e.y;var i=(t.y-e.y)/MWFCalendarDayView.HourHeight;return i<0||i>24?null:Math.floor(i)},getIndexListByRange:function(t,e){for(var i=Math.min(t,e),a=Math.max(t,e),s=[],n=i;n<=a;n++)s.push(n);return s},cellDragStart:function(t,e){t.store("index",this.getIndexByPage(e.page)),this.scrollNodeHeight=this.scrollNode.getSize().y},cellDrag:function(t,e){var i=t.retrieve("index"),a=this.getIndexByPage(e.page);if(a){var s=this.getIndexListByRange(i,a),n=this.isToday(this.date);if(this.selectedIndexRange){this.selectedIndexRange;this.selectedIndexRange.each(function(t){s.contains(t)||this.hourTdMap[t].setStyle("background-color",n?"#F8FBFF":"#fff")}.bind(this)),s.each(function(t){this.selectedIndexRange.contains(t)||this.hourTdMap[t].setStyle("background-color","#fffdf2")}.bind(this))}else for(var d=0;d<s.length;d++)this.hourTdMap[s[d]].setStyle("background-color","#fffdf2");this.selectedIndexRange=s;var o=this.scrollNode.getScroll().y;this.pageOffsetHeight+1.5*MWFCalendarDayView.HourHeight>this.scrollNodeHeight+o?window.setTimeout(function(){this.scrollNode.scrollTo(0,o+MWFCalendarDayView.HourHeight)}.bind(this),200):this.pageOffsetHeight-1.5*MWFCalendarDayView.HourHeight<o&&window.setTimeout(function(){this.scrollNode.scrollTo(0,o-MWFCalendarDayView.HourHeight)}.bind(this),200)}},completeDrag:function(t,e){var i=this.isToday(this.date);if(this.selectedIndexRange&&this.selectedIndexRange.length){this.selectedIndexRange.each(function(t){this.hourTdMap[t].setStyle("background-color",i?"#F8FBFF":"#fff")}.bind(this));var a=this.selectedIndexRange[0],s=this.selectedIndexRange.getLast(),n=this.date.format("%Y-%m-%d")+" "+a+":00",d=this.date.format("%Y-%m-%d")+" "+s+":59",o=new MWF.xApplication.Calendar.EventForm(this,{},{startTime:n,endTime:d},{app:this.app});o.view=this,o.create(),this.selectedIndexRange=null}}}),MWFCalendarDayView.Calendar.wholeDay=new Class({Implements:[Events],initialize:function(t,e,i){this.calendar=t,this.view=this.calendar.view,this.css=this.calendar.css,this.app=this.calendar.app,this.date=i.clone(),this.data=e,this.load()},load:function(){this.startTime=this.calendar.startTime,this.endTime=this.calendar.endTime,this.rangeList=[],this.rangeObject={},this.data.each(function(t,e){var i=this.getTimeRange(t.startTime,t.endTime);if(!i)return null;t.range=i,t.range.id=t.id,t.range.data=t,this.rangeList.push(i),this.rangeObject[t.id]=i}.bind(this)),this.sortRange(),this.calendar.titleTable.getElement("td:nth-child(1)").setStyle("height",24*this.rangeList.length+3),this.documentList=[],this.rangeList.each(function(t,e){var i=t.data;if(!i)return null;this.documentList.push(new MWFCalendarDayView.Calendar.wholeDayDocument(this,i,t))}.bind(this))},sortRange:function(){this.rangeList.sort(function(t,e){return e.diff-t.diff}.bind(this))},getTimeRange:function(t,e){var i=Date.parse(t);if((a=Date.parse(e))<this.startTime)return null;if(this.endTime<i)return null;i<this.startTime&&(i=this.startTime.clone()),this.endTime<a&&(a=this.endTime.clone());var a=new Date(a.get("year"),a.get("month"),a.get("date"),23,59,59);return{start:i=Date.parse(t),end:a=Date.parse(e),diff:a-i}},resize:function(){this.documentList&&this.documentList.each(function(t){t.resize()}.bind(this))},destroy:function(){if(this.documentList){for(;this.documentList.length;)this.documentList.pop().destroy();this.calendar.dataTd_wholeDay.empty()}}}),MWFCalendarDayView.Calendar.wholeDayDocument=new Class({initialize:function(t,e,i){this.day=t,this.calendar=t.calendar,this.view=this.calendar.view,this.css=this.calendar.css,this.app=this.calendar.app,this.date=t.date.clone(),this.data=e,this.range=i,this.load()},load:function(){this.container=this.calendar.dataTd_wholeDay;this.items=[];this.data.dateStart=Date.parse(this.data.startTime),this.data.dateEnd=Date.parse(this.data.endTime),this.yIndex=this.getUsefulTdYIndex(),this.createNode()},getUsefulTdYIndex:function(){return"null"==typeOf(this.day.yIndex)?this.day.yIndex=0:this.day.yIndex++,this.day.yIndex},createNode:function(){var t=this.lightColor=MWFCalendar.ColorOptions.getLightColor(this.data.color),e=this.node=new Element("div",{styles:{position:"absolute",overflow:"hidden",height:"20px","line-height":"20px","border-top":"1px solid "+t,"border-bottom":"1px solid "+t,"background-color":t},events:{click:function(){var t=new MWF.xApplication.Calendar.EventForm(this,this.data,{isFull:!0},{app:this.app});t.view=this.view,this.calendar.app.isEventEditable(this.data)?t.edit():t.open()}.bind(this),mouseover:function(){this.node.setStyle("border-color",this.data.color)}.bind(this),mouseout:function(){this.node.setStyle("border-color",this.lightColor)}.bind(this)}}).inject(this.container);e.setStyles(this.getCoordinate()),this.beginDateOutRange||e.setStyles({"border-left":"1px solid "+t,"border-top-left-radius":"10px","border-bottom-left-radius":"10px"}),this.endDateOutRange||e.setStyles({"border-right":"1px solid "+t,"border-top-right-radius":"10px","border-bottom-right-radius":"10px"});new Element("div",{styles:{"font-size":"10px","padding-left":"2px",float:"left"},text:this.data.dateStart.format("%m-%d %H:%M")+this.app.lp.to+this.data.dateEnd.format("%m-%d %H:%M")}).inject(e),new Element("div",{styles:{"padding-left":"5px","font-size":"12px",float:"left"},text:this.data.title}).inject(e);this.tooltip=new MWF.xApplication.Calendar.EventTooltip(this.app.content,this.node,this.app,this.data,{axis:"y",delay:350}),this.tooltip.view=this.view},getCoordinate:function(){this.data,this.range;var t=24*this.yIndex,e=this.day.startTime,i=this.day.endTime;this.data.dateStart<e?this.beginDateOutRange=!0:(this.beginDateOutRange=!1,e=this.data.dateStart),this.data.dateEnd>i?this.endDateOutRange=!0:(this.endDateOutRange=!1,i=this.data.dateEnd);var a=(i-e)/MWFCalendarDayView.DayMsec*MWFCalendarDayView.DayWidth-2;return{top:t+2,left:(e-this.day.startTime)/MWFCalendarDayView.DayMsec*MWFCalendarDayView.DayWidth+3,width:a}},resize:function(){this.node.setStyles(this.getCoordinate())},reload:function(){this.tooltip&&this.tooltip.destroy(),this.view.reload()},destroy:function(){this.tooltip&&this.tooltip.destroy(),this.node.destroy()}}),MWFCalendarDayView.Calendar.Day=new Class({Implements:[Events],initialize:function(t,e,i,a){this.container=t,this.calendar=i,this.view=this.calendar.view,this.css=this.calendar.css,this.app=this.calendar.app,this.date=e.clone(),this.data=a,this.calendars=[],this.load()},load:function(){this.day=this.date.getDate(),this.month=this.date.getMonth(),this.year=this.date.getFullYear(),this.startTime=this.calendar.startTime,this.endTime=this.calendar.endTime,this.rangeList=[],this.rangeObject={},this.data.each(function(t,e){var i=this.getTimeRange(t.startTime,t.endTime);if(!i)return null;t.range=i,t.range.data=t,t.range.id=t.id,this.rangeList.push(i),this.rangeObject[t.id]=i}.bind(this)),this.sortRange();this.data.length;this.documentList=[],this.rangeList.each(function(t,e){t.index=this.rangeList.indexOf(t);var i=t.data;this.documentList.push(new MWFCalendarDayView.Calendar.Document(this.container,this,i,t))}.bind(this))},sortRange:function(){this.rangeList.sort((function(t,e){return t.startTime-e.startTime}))},getTimeRange:function(t,e){var i="string"==typeOf(t)?Date.parse(t):t,a="string"==typeOf(e)?Date.parse(e):e;if(a<=this.startTime)return null;if(this.endTime<=i)return null;var s={start:i<=this.startTime?[0,0,0]:[i.get("hr"),i.get("min"),i.get("sec")],end:this.endTime<=a?[23,59,59]:[a.get("hr"),a.get("min"),a.get("sec")]};return s.startTime=new Date(this.year,this.month,this.day,s.start[0],s.start[1],s.start[2]),s.endTime=new Date(this.year,this.month,this.day,s.end[0],s.end[1],s.end[2]),s.diff=s.endTime-s.startTime,s},resize:function(){this.documentList&&this.documentList.each(function(t){t.resize()}.bind(this))},reload:function(){this.view.reload()},destroy:function(){for(;this.documentList.length>0;)this.documentList.pop().destroy();this.container.empty()}}),MWFCalendarDayView.Calendar.Document=new Class({initialize:function(t,e,i,a){this.container=t,this.day=e,this.calendar=e.calendar,this.view=this.calendar.view,this.css=this.calendar.css,this.app=this.calendar.app,this.date=e.date.clone(),this.data=i,this.range=a,this.load()},load:function(){var t=this.lightColor=MWFCalendar.ColorOptions.getLightColor(this.data.color),e=this.node=new Element("div",{styles:{position:"absolute",border:"1px solid "+t,"background-color":t,overflow:"hidden","border-radius":"5px","max-width":"150px"},events:{click:function(){var t=new MWF.xApplication.Calendar.EventForm(this,this.data,{isFull:!0},{app:this.app});t.view=this.view,this.calendar.app.isEventEditable(this.data)?t.edit():t.open()}.bind(this),mouseover:function(){this.node.setStyle("border-color",this.data.color)}.bind(this),mouseout:function(){this.node.setStyle("border-color",this.lightColor)}.bind(this)}}).inject(this.container);e.setStyles(this.getCoordinate());new Element("div",{styles:{"font-size":"10px","padding-top":"2px","padding-left":"2px"},text:this.range.startTime.format("%H:%M")+"-"+this.range.endTime.format("%H:%M")}).inject(e),new Element("div",{styles:{"padding-top":"7px","padding-left":"5px","font-size":"12px"},text:this.data.title}).inject(e);this.tooltip=new MWF.xApplication.Calendar.EventTooltip(this.app.content,this.node,this.app,this.data,{axis:"x",delay:350}),this.tooltip.view=this.view},resize:function(){this.node.setStyles(this.getCoordinate())},getCoordinate:function(){this.data;var t=this.range,e=4,i=0;"ie"===Browser.name&&(e=4,i=-2);var a=Math.floor((t.endTime-t.startTime)/MWFCalendarDayView.DayMsec*MWFCalendarDayView.DayHeight)-e;a<16&&(a=16);var s=Math.floor((t.startTime-this.day.startTime)/MWFCalendarDayView.DayMsec*MWFCalendarDayView.DayHeight)-i,n=Math.floor(MWFCalendarDayView.DayWidth/this.day.rangeList.length)-5;return n>150&&(n=150),{top:s,left:(n+5)*this.range.index+3,width:n,height:a}},reload:function(){this.tooltip&&this.tooltip.destroy(),this.view.reload()},destroy:function(){this.tooltip&&this.tooltip.destroy(),this.node.destroy()}});