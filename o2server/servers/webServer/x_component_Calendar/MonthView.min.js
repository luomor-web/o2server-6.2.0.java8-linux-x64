var MWFCalendarMonthView=MWF.xApplication.Calendar.MonthView=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",date:""},initialize:function(t,e,i){this.setOptions(i),this.path="../x_component_Calendar/$MonthView/",this.cssPath="../x_component_Calendar/$MonthView/"+this.options.style+"/css.wcss",this._loadCss(),this.app=e,this.container=$(t),this.load()},load:function(){this.node=new Element("div",{styles:this.css.node}).inject(this.container),this.loadCalendar(),this.resetNodeSize()},resetNodeSize:function(){var t=this.container.getSize(),e=t.y-50;this.node.setStyle("height",e+"px");var i=this.app.sideBar?this.app.sideBar.getSize():{x:0,y:0};this.node.setStyle("width",t.x-i.x+"px"),this.node.setStyle("margin-right",i.x+"px"),this.calendar&&this.calendar.resetBodySize()},loadCalendar:function(){var t="";this.options.date&&(t=Date.parse(this.options.date)),this.calendar=new MWFCalendarMonthView.Calendar(this,t)},hide:function(){new Fx.Morph(this.node,{duration:"300",transition:Fx.Transitions.Expo.easeOut}).start({opacity:0}).chain(function(){this.node.setStyle("display","none")}.bind(this))},show:function(){this.node.setStyles(this.css.node),new Fx.Morph(this.node,{duration:"800",transition:Fx.Transitions.Expo.easeOut}).start({opacity:1}).chain(function(){}.bind(this))},reload:function(){this.calendar&&this.calendar.reLoadCalendar()},recordStatus:function(){var t="";return this.calendar&&(t=this.calendar.date),{date:t.toString()}},destroy:function(){this.calendar&&this.calendar.destroy(),this.node.destroy()}});MWFCalendarMonthView.Calendar=new Class({Implements:[Events],initialize:function(t,e){this.view=t,this.css=this.view.css,this.container=this.view.node,this.app=this.view.app,this.date=e||new Date,this.today=new Date,this.days={},this.weekBegin=this.app.calendarConfig.weekBegin||0,this.load()},load:function(){this.titleNode=new Element("div",{styles:this.css.calendarTitleNode}).inject(this.container),this.titleTableContainer=new Element("div",{styles:this.css.calendarTitleTableContainer}).inject(this.container),this.scrollNode=new Element("div",{styles:this.css.scrollNode}).inject(this.container),this.contentWarpNode=new Element("div",{styles:this.css.contentWarpNode}).inject(this.scrollNode),this.contentContainerNode=new Element("div",{styles:this.css.contentContainerNode}).inject(this.contentWarpNode),this.bodyNode=new Element("div",{styles:this.css.contentNode}).inject(this.contentContainerNode),this.bodyNode.setStyle("position","relative"),this.setTitleNode(),this.setTitleTableNode(),this.setBodyNode()},resetBodySize:function(){var t=this.container.getSize(),e=this.titleNode.getSize(),i=this.titleTable.getSize(),n=t.y-e.y-i.y;this.scrollNode.setStyle("height",n+"px"),this.titleTableContainer.setStyles({width:t.x-40+"px"}),this.contentWarpNode&&this.contentWarpNode.setStyles({width:t.x-40+"px"});var s=this.calendarTable.getSize();MWFCalendarMonthView.WeekWidth=s.x,MWFCalendarMonthView.DayWidth=s.x/7,this.dataTdList.each((function(t){t.setStyle("width",MWFCalendarMonthView.WeekWidth)})),this.wholeDayDocumentList&&this.wholeDayDocumentList.length&&this.wholeDayDocumentList.each(function(t){t.resize()}.bind(this)),this.oneDayDocumentList&&this.oneDayDocumentList.length&&this.oneDayDocumentList.each(function(t){t.resize()}.bind(this));var a=30,o=this.calendarTable.getElements("tr");for(var h in this.calendarTrHeight=[],this.usedYIndex){var d=this.usedYIndex[h],l=Math.max(d[0].length,d[1].length,d[2].length,d[3].length,d[4].length,d[5].length,d[6].length);if(l>4){this.dataTableList[h].setStyle("top",a);var r=30+24*l;a+=r,o[parseInt(h)].getElements("td").each((function(t){t.setStyle("height",r)})),this.calendarTrHeight.push(r)}else this.dataTableList[h].setStyle("top",a),a=a+MWFCalendarMonthView.WeekHeight+1,o[parseInt(h)].getElements("td").each((function(t){t.setStyle("height",MWFCalendarMonthView.WeekHeight)})),this.calendarTrHeight.push(MWFCalendarMonthView.WeekHeight)}},setTitleNode:function(){this.prevMonthNode=new Element("div",{styles:this.css.calendarPrevMonthNode}).inject(this.titleNode);var t=this.date.format(this.app.lp.dateFormatMonth);this.titleTextNode=new Element("div",{styles:this.css.calendarTitleTextNode,text:t}).inject(this.titleNode),this.nextMonthNode=new Element("div",{styles:this.css.calendarNextMonthNode}).inject(this.titleNode),this.prevMonthNode.addEvents({mouseover:function(){this.prevMonthNode.setStyles(this.css.calendarPrevMonthNode_over)}.bind(this),mouseout:function(){this.prevMonthNode.setStyles(this.css.calendarPrevMonthNode)}.bind(this),mousedown:function(){this.prevMonthNode.setStyles(this.css.calendarPrevMonthNode_down)}.bind(this),mouseup:function(){this.prevMonthNode.setStyles(this.css.calendarPrevMonthNode_over)}.bind(this),click:function(){this.changeMonthPrev()}.bind(this)}),this.nextMonthNode.addEvents({mouseover:function(){this.nextMonthNode.setStyles(this.css.calendarNextMonthNode_over)}.bind(this),mouseout:function(){this.nextMonthNode.setStyles(this.css.calendarNextMonthNode)}.bind(this),mousedown:function(){this.nextMonthNode.setStyles(this.css.calendarNextMonthNode_down)}.bind(this),mouseup:function(){this.nextMonthNode.setStyles(this.css.calendarNextMonthNode_over)}.bind(this),click:function(){this.changeMonthNext()}.bind(this)}),this.titleTextNode.addEvents({mouseover:function(){this.titleTextNode.setStyles(this.css.calendarTitleTextNode_over)}.bind(this),mouseout:function(){this.titleTextNode.setStyles(this.css.calendarTitleTextNode)}.bind(this),mousedown:function(){this.titleTextNode.setStyles(this.css.calendarTitleTextNode_down)}.bind(this),mouseup:function(){this.titleTextNode.setStyles(this.css.calendarTitleTextNode_over)}.bind(this),click:function(){this.changeMonthSelect()}.bind(this)})},changeMonthPrev:function(){this.date.decrement("month",1);var t=this.date.format(this.app.lp.dateFormatMonth);this.titleTextNode.set("text",t),this.reLoadCalendar()},changeMonthNext:function(){this.date.increment("month",1);var t=this.date.format(this.app.lp.dateFormatMonth);this.titleTextNode.set("text",t),this.reLoadCalendar()},changeMonthSelect:function(){this.monthSelector||this.createMonthSelector(),this.monthSelector.show()},createMonthSelector:function(){this.monthSelector=new MWFCalendarMonthView.MonthSelector(this.date,this)},changeMonthTo:function(t){this.date=t;var e=this.date.format(this.app.lp.dateFormatMonth);this.titleTextNode.set("text",e),this.reLoadCalendar()},setTitleTableNode:function(){if("1"==this.weekBegin)var t="<tr><th>"+this.app.lp.weeks.Mon+"</th><th>"+this.app.lp.weeks.Tues+"</th><th>"+this.app.lp.weeks.Wed+"</th><th>"+this.app.lp.weeks.Thur+"</th><th>"+this.app.lp.weeks.Fri+"</th><th>"+this.app.lp.weeks.Sat+"</th><th>"+this.app.lp.weeks.Sun+"</th></tr>";else t="<tr><th>"+this.app.lp.weeks.Sun+"</th><th>"+this.app.lp.weeks.Mon+"</th><th>"+this.app.lp.weeks.Tues+"</th><th>"+this.app.lp.weeks.Wed+"</th><th>"+this.app.lp.weeks.Thur+"</th><th>"+this.app.lp.weeks.Fri+"</th><th>"+this.app.lp.weeks.Sat+"</th></tr>";this.titleTable=new Element("table",{styles:this.css.calendarTable,height:"100%",border:"0",cellPadding:"0",cellSpacing:"0",html:t}).inject(this.titleTableContainer),this.calendarTableTitleTr=this.titleTable.getElement("tr"),this.calendarTableTitleTr.setStyles(this.css.calendarTableTitleTr),this.calendarTableTitleTr.getElements("th").setStyles(this.css.calendarTableTh)},setBodyNode:function(){this.calendarTable=new Element("table",{styles:this.css.calendarTable,height:"100%",border:"0",cellPadding:"0",cellSpacing:"0",html:"<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>"}).inject(this.bodyNode),this.loadBackgroundCalendar(!0),this.loadDataContainer(),this.loadCalendar()},reLoadCalendar:function(){this.wholeDayDocumentList&&this.wholeDayDocumentList.length&&this.wholeDayDocumentList.each(function(t){t.destroy()}.bind(this)),this.wholeDayDocumentList=[],this.oneDayDocumentList&&this.oneDayDocumentList.length&&this.oneDayDocumentList.each(function(t){t.destroy()}.bind(this)),this.oneDayDocumentList=[],this.loadBackgroundCalendar(!1),this.loadCalendar()},loadDataContainer:function(){this.dataTableList=[],this.dataTdList=[],[0,1,2,3,4,5,6].each(function(t){var e=new Element("table.dataTable",{styles:this.css.calendarTable,border:"0",cellPadding:"0",cellSpacing:"0",index:t}).inject(this.bodyNode);e.setStyles({position:"absolute",top:(MWFCalendarMonthView.WeekHeight+1)*t+MWFCalendarMonthView.THHeight+30,left:"0px",margin:"0px auto 0px 0px"});var i=new Element("tr").inject(e),n=new Element("td",{valign:"top",styles:{height:"0px",position:"relative"}}).inject(i);this.dataTableList.push(e),this.dataTdList.push(n)}.bind(this))},calculateMonthRange:function(){var t=this.date.clone(),e=new Date(t.get("year"),t.get("month"),1,0,0,0),i=e.getDay();if("1"==this.weekBegin)var n=i-1<0?6:i-1;else n=i;e.decrement("day",n),this.monthStart=e,this.monthStartStr=this.monthStart.format("db");var s=e.clone();s.increment("day",41),this.monthEnd=new Date(s.get("year"),s.get("month"),s.get("date"),23,59,59),this.monthEndStr=this.monthEnd.format("db"),this.calculateWeekRange()},calculateWeekRange:function(){this.weekRangeList=[];for(var t,e=this.monthStart.clone(),i=0;i<6;i++)t=e.clone().increment("day",6),t=new Date(t.get("year"),t.get("month"),t.get("date"),23,59,59),this.weekRangeList.push({start:e,end:t}),e=t.clone().increment("second",1);this.weekDaysList=[],e=this.monthStart.clone();for(i=0;i<this.weekRangeList.length;i++){for(var n=0,s=[];n<7;)s.push(e.format("%Y-%m-%d")),e.increment("day",1),n++;this.weekDaysList.push(s)}this.usedYIndex={};for(i=0;i<this.weekRangeList.length;i++){this.usedYIndex[i]={};for(n=0;n<7;)this.usedYIndex[i][n]=[],n++}},getUserfulYIndex:function(t,e){for(var i=0,n=!0,s=this.usedYIndex[t];n;){for(var a=!1,o=0;o<e.length;o++)if(s[e[o]].contains(i)){a=!0;break}a?i++:n=!1}for(o=0;o<e.length;o++)s[e[o]].push(i);return i},getDateIndex:function(t){for(var e=t.format("%Y-%m-%d"),i=0;i<this.weekDaysList.length;i++){var n=this.weekDaysList[i].indexOf(e);if(n>-1)return{weekIndex:i,dayIndex:n}}return null},getDateIndexOfWeek:function(t,e){for(var i=this.weekDaysList[t],n=[],s=0;s<e.length;s++)n.push(i.indexOf(e[s]));return n},inCurrentMonth:function(t){return t>this.monthStart&&t<this.monthEnd},getTimeRange:function(t,e){if(t>this.monthEnd||e<this.monthStart)return null;var i={startTime:t,endTime:e,start:t<=this.monthStart?this.monthStart.clone():t.clone(),end:this.monthEnd<=e?this.monthEnd.clone():e.clone()};return i.firstDay=i.start.clone().clearTime(),i.diff=i.start-i.end,i.weekInforList=this.getWeekInfor(t,e),i},getWeekInfor:function(t,e){if(t>this.monthEnd||e<this.monthStart)return null;for(var i={},n=0;n<this.weekRangeList.length;n++){var s=this.weekRangeList[n];if(!(t>s.end||e<s.start)){var a=t>=s.start,o=s.end>=e,h=a?t:s.start,d=o?e:s.end,l=d-h,r=h-s.start,c=this.getDaysByRange(h,d),u=this.getDateIndexOfWeek(n,c);if(i[n]={index:n,isEventStart:a,isEventEnd:o,start:h,end:d,diff:l,days:c,left:r,daysIndex:u},o)break}}return i},getDaysByRange:function(t,e){for(var i=t.clone(),n=e,s=[];i<n;)s.push(i.clone().format("%Y-%m-%d")),i.increment();return s},loadCalendar:function(){this.app.currentDate=this.date.clone(),this.calculateMonthRange(),this.cancelCurrentTd(),this.loadData(function(){this.loadWholeDay(this.wholeDayData),this.loadOneDay(this.inOneDayEvents),this.resetBodySize()}.bind(this))},loadBackgroundCalendar:function(t){var e=this.date.clone();e.set("date",1);var i=e.getDay();if("1"==this.weekBegin)var n=i-1<0?6:i-1;else n=i;e.decrement("day",n),this.calendarTable.getElements("td").each(function(i){this.loadDay(i,e,t),e.increment()}.bind(this))},loadData:function(t){this.app.actions.listEventWithFilter({calendarIds:this.app.getSelectedCalendarId(),startTime:this.monthStartStr,endTime:this.monthEndStr},function(e){this.wholeDayData=e.data&&e.data.wholeDayEvents?e.data.wholeDayEvents:[],this.inOneDayEvents=[],(e.data&&e.data.inOneDayEvents?e.data.inOneDayEvents:[]).each(function(t){t.inOneDayEvents.length>0&&this.inOneDayEvents.push(t)}.bind(this)),t&&t()}.bind(this))},loadOneDay:function(t){this.oneDayDocumentList=[],t.each(function(t,e){t.inOneDayEvents.each(function(e,i){this.oneDayDocumentList.push(new MWFCalendarMonthView.Calendar.InOnDayDocument(this,e,t.eventDate))}.bind(this))}.bind(this))},loadWholeDay:function(t){this.wholeDayRange=[],t.each(function(t,e){var i=this.getTimeRange(Date.parse(t.startTime),Date.parse(t.endTime));i&&(i.data=t,this.wholeDayRange.push(i))}.bind(this)),this.wholeDayRange.sort(function(t,e){return t.firstDay>e.firstDay?1:t.firstDay<e.firstDay?-1:t.diff-e.diff}.bind(this)),this.wholeDayDocumentList=[],this.wholeDayRange.each(function(t){this.wholeDayDocumentList.push(new MWFCalendarMonthView.Calendar.WholeDayDocument(this,t))}.bind(this))},loadDay:function(t,e,i){var n=this;t.empty();var s="thisMonth",a=e.get("month"),o=e.get("year"),h=e.get("date"),d=this.date.get("month"),l=this.date.get("year"),r=this.today.get("month"),c=this.today.get("year"),u=this.today.get("date");s=a==r&&o==c&&h==u?"today":a==d&&o==l?"thisMonth":"otherMonth",t.set("valign","top"),t.setStyles(this.css["calendarTableCell_"+s]),t.store("dateStr",e.format("%Y-%m-%d")),t.store("type",s),i&&(t.addEvent("click",function(e){this.setCurrentTd(t)}.bind(this)),t.addEvent("dblclick",function(t){n.cancelCurrentTd();var e=new MWF.xApplication.Calendar.EventForm(n,{},{startTime:Date.parse(this.retrieve("dateStr")+" 08:00"),endTime:Date.parse(this.retrieve("dateStr")+" 09:00")},{app:n.app});e.view=n,e.create()}.bind(t)),new Drag(t,{onStart:function(t,e){this.cancelCurrentTd(),this.cellDragStart(t,e)}.bind(this),onDrag:function(t,e){this.cellDrag(t,e)}.bind(this),onComplete:function(t,e){this.completeDrag(t,e)}.bind(this)}));var p=new Element("div",{styles:this.css["dayTitle_"+s]}).inject(t);new Element("div",{styles:this.css["dayTitleDay_"+s],text:h}).inject(p).addEvent("click",function(){n.app.toDay(this.date)}.bind({date:e.format("%Y-%m-%d")}))},setCurrentTd:function(t){t.setStyle("background-color","#fffdf2"),this.currentSelectedTd&&this.currentSelectedTd.setStyle("background-color","today"==this.currentSelectedTd.retrieve("type")?"#F8FBFF":"#fff"),this.currentSelectedTd=t},cancelCurrentTd:function(){this.currentSelectedTd&&this.currentSelectedTd.setStyle("background-color","today"==this.currentSelectedTd.retrieve("type")?"#F8FBFF":"#fff"),this.currentSelectedTd=null},reload:function(){this.view.reload()},destroy:function(){Object.each(this.days,function(t){t.destroy()}.bind(this)),this.container.empty()},getIndexByPage:function(t){var e=this.calendarTable.getPosition(),i=(t.x-e.x)/MWFCalendarMonthView.DayWidth;if(i<0||i>7)return null;this.pageOffsetHeight=t.y-e.y;var n=t.y-e.y-MWFCalendarMonthView.THHeight;if(n<0)return null;for(var s=null,a=0;a<this.calendarTrHeight.length;a++){if(n<this.calendarTrHeight[a]){s=a;break}n-=this.calendarTrHeight[a]}return null!=s?{row:s,col:Math.floor(i)}:null},getTdsByIndexRange:function(t,e){if(this.calendarTableTds)var i=this.calendarTableTds;else i=this.calendarTableTds=this.calendarTable.getElements("td");var n,s;t.row==e.row?t.col<=e.col?(n=t,s=e):(n=e,s=t):t.row<e.row?(n=t,s=e):(n=e,s=t);for(var a=7*n.row+n.col,o=7*s.row+s.col,h=[],d=a;d<=o;d++)h.push(i[d]);return h},cellDragStart:function(t,e){t.store("index",this.getIndexByPage(e.page)),this.scrollNodeHeight=this.scrollNode.getSize().y},cellDrag:function(t,e){var i=t.retrieve("index"),n=this.getIndexByPage(e.page);if(n){var s=this.getTdsByIndexRange(i,n);this.selectedTds?(this.selectedTds.each(function(t){var e=t.retrieve("type");s.contains(t)||t.setStyle("background-color","today"==e?"#F8FBFF":"#fff")}.bind(this)),s.each(function(t){this.selectedTds.contains(t)||t.setStyle("background-color","#fffdf2")}.bind(this))):s.each(function(t){t.setStyle("background-color","#fffdf2")}.bind(this));var a=this.scrollNode.getScroll().y;this.pageOffsetHeight+1.5*MWFCalendarMonthView.WeekHeight>this.scrollNodeHeight+a?window.setTimeout(function(){this.scrollNode.scrollTo(0,a+MWFCalendarMonthView.WeekHeight)}.bind(this),200):this.pageOffsetHeight-1.5*MWFCalendarMonthView.WeekHeight<a&&window.setTimeout(function(){this.scrollNode.scrollTo(0,a-MWFCalendarMonthView.WeekHeight)}.bind(this),200),this.selectedTds=s}},completeDrag:function(t,e){if(this.selectedTds&&this.selectedTds.length){this.selectedTds.each(function(t){var e=t.retrieve("type");t.setStyle("background-color","today"==e?"#F8FBFF":"#fff")}.bind(this));var i=this.selectedTds[0].retrieve("dateStr"),n=this.selectedTds.getLast().retrieve("dateStr"),s=new MWF.xApplication.Calendar.EventForm(this,{},{startTime:i,endTime:n,isWholeday:!0},{app:this.app});s.view=this,s.create(),this.selectedTds=null}}}),MWFCalendarMonthView.THHeight=50,MWFCalendarMonthView.WeekHeight=140,MWFCalendarMonthView.WeekWidth,MWFCalendarMonthView.DayWidth,MWFCalendarMonthView.Calendar.WholeDayDocument=new Class({Implements:[Events],initialize:function(t,e){this.calendar=t,this.view=this.calendar.view,this.css=this.calendar.css,this.app=this.calendar.app,this.range=e,this.load()},load:function(){this.weekList=[],Object.each(this.range.weekInforList,function(t){this.weekList.push(new MWFCalendarMonthView.Calendar.WholeDayWeek(this,t,this.range.data))}.bind(this))},setMouseOver:function(){this.weekList.each(function(t){t.mouseover()}.bind(this))},setMouseOut:function(){this.weekList.each(function(t){t.mouseout()}.bind(this))},resize:function(){this.weekList.each(function(t){t.resize()}.bind(this))},destroy:function(){this.weekList.each(function(t){t.destroy()}.bind(this))}}),MWFCalendarMonthView.Calendar.WholeDayWeek=new Class({Implements:[Events],initialize:function(t,e,i){this.document=t,this.calendar=t.calendar,this.view=this.calendar.view,this.css=this.calendar.css,this.app=this.calendar.app,this.weekInfor=e,this.data=i,this.load()},load:function(){this.timeStart=Date.parse(this.data.startTime),this.timeEnd=Date.parse(this.data.endTime),this.yIndex=this.calendar.getUserfulYIndex(this.weekInfor.index,this.weekInfor.daysIndex),this.container=this.getContainer(),this.createNode()},createNode:function(){var t=this.lightColor=MWFCalendar.ColorOptions.getLightColor(this.data.color),e=this.node=new Element("div",{styles:{position:"absolute",overflow:"hidden",height:"20px","line-height":"20px","border-top":"1px solid "+t,"border-bottom":"1px solid "+t,"background-color":t},events:{click:function(){var t=new MWF.xApplication.Calendar.EventForm(this,this.data,{isFull:!0},{app:this.app});t.view=this.view,this.calendar.app.isEventEditable(this.data)?t.edit():t.open()}.bind(this),mouseover:function(){this.document.setMouseOver()}.bind(this),mouseout:function(){this.document.setMouseOut()}.bind(this)}}).inject(this.container),i=this.getCoordinate();e.setStyles(i),this.weekInfor.isEventStart&&e.setStyles({"border-left":"1px solid "+t,"border-top-left-radius":"10px","border-bottom-left-radius":"10px"}),this.weekInfor.isEventEnd&&e.setStyles({"border-right":"1px solid "+t,"border-top-right-radius":"10px","border-bottom-right-radius":"10px"}),this.weekInfor.isEventStart&&(this.timeNode=new Element("div",{styles:{"font-size":"10px","padding-left":"2px",float:"left"},text:this.timeStart.format("%m-%d %H:%M")+MWF.xApplication.Calendar.LP.to+this.timeEnd.format("%m-%d %H:%M")}).inject(e)),this.titleNode=new Element("div",{styles:{"padding-left":"5px","font-size":"12px",float:"left",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},text:this.data.title}).inject(e),this.titleNode.setStyle("width",i.width-(this.timeNode?this.timeNode.getSize().x:0)-6),this.tooltip=new MWF.xApplication.Calendar.EventTooltip(this.app.content,this.node,this.app,this.data,{axis:"y",delay:350}),this.tooltip.view=this.view},getContainer:function(){return this.calendar.dataTdList[this.weekInfor.index]},getCoordinate:function(){this.data;var t=this.weekInfor,e=24*this.yIndex,i=t.daysIndex.length/7*MWFCalendarMonthView.WeekWidth-3;return{top:e+2,left:t.daysIndex[0]/7*MWFCalendarMonthView.WeekWidth,width:i}},mouseover:function(){this.node.setStyle("border-color",this.data.color)},mouseout:function(){this.node.setStyle("border-color",this.lightColor)},resize:function(){var t=this.getCoordinate();this.node.setStyles(t),this.titleNode.setStyle("width",t.width-(this.timeNode?this.timeNode.getSize().x:0)-6)},reload:function(){this.tooltip&&this.tooltip.destroy(),this.view.reload()},destroy:function(){this.tooltip&&this.tooltip.destroy(),this.node.destroy()}}),MWFCalendarMonthView.Calendar.InOnDayDocument=new Class({Implements:[Events],initialize:function(t,e,i){this.calendar=t,this.view=this.calendar.view,this.css=this.calendar.css,this.app=this.calendar.app,this.data=e,this.dateStr=i,this.date=Date.parse(i),this.load()},load:function(){this.timeStart=Date.parse(this.data.startTime),this.timeEnd=Date.parse(this.data.endTime),this.index=this.calendar.getDateIndex(this.date),this.yIndex=this.calendar.getUserfulYIndex(this.index.weekIndex,[this.index.dayIndex]),this.container=this.getContainer(),this.createNode()},createNode:function(){var t=this.lightColor=MWFCalendar.ColorOptions.getLightColor(this.data.color),e=this.node=new Element("div",{styles:{position:"absolute",border:"1px solid "+t,"background-color":t,overflow:"hidden",height:"20px","line-height":"20px","border-radius":"10px"},events:{click:function(){var t=new MWF.xApplication.Calendar.EventForm(this,this.data,{isFull:!0},{app:this.app});t.view=this.view,this.app.isEventEditable(this.data)?t.edit():t.open()}.bind(this),mouseover:function(){this.node.setStyle("border-color",this.data.color)}.bind(this),mouseout:function(){this.node.setStyle("border-color",this.lightColor)}.bind(this)}}).inject(this.container),i=this.getCoordinate();e.setStyles(i),this.timeNode=new Element("div",{styles:{"font-size":"10px","padding-left":"2px",float:"left"},text:this.timeStart.format("%H:%M")+MWF.xApplication.Calendar.LP.to+this.timeEnd.format("%H:%M")}).inject(e),this.titleNode=new Element("div",{styles:{"padding-left":"5px","font-size":"12px",float:"left",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},text:this.data.title}).inject(e),this.titleNode.setStyle("width",i.width-this.timeNode.getSize().x-6),this.tooltip=new MWF.xApplication.Calendar.EventTooltip(this.app.content,this.node,this.app,this.data,{axis:"y",delay:350}),this.tooltip.view=this.view},getContainer:function(){return this.calendar.dataTdList[this.index.weekIndex]},getCoordinate:function(){this.data;var t=24*this.yIndex,e=MWFCalendarMonthView.DayWidth-3;return{top:t+2,left:this.index.dayIndex*MWFCalendarMonthView.DayWidth,width:e}},resize:function(){var t=this.getCoordinate();this.node.setStyles(t),this.titleNode.setStyle("width",t.width-this.timeNode.getSize().x-6)},reload:function(){this.tooltip&&this.tooltip.destroy(),this.view.reload()},destroy:function(){this.tooltip&&this.tooltip.destroy(),this.node.destroy()}}),MWFCalendarMonthView.Document=new Class({initialize:function(t,e,i){this.day=t,this.css=this.day.css,this.view=this.day.view,this.app=this.day.app,this.container=this.day.contentNode,this.data=e,this.index=i,this.load()},load:function(){this.nodeStyles="today"==this.day.type?this.css.calendarNode_today:this.css.calendarNode,this.node=new Element("div",{styles:this.nodeStyles}).inject(this.container),this.iconNode=new Element("div",{styles:this.css.calendarIconNode}).inject(this.node),this.timeNode=new Element("div",{styles:this.css.calendarTimeNode}).inject(this.node),this.textNode=new Element("div",{styles:this.css.calendarTextNode}).inject(this.node);var t=Date.parse(this.data.startTime).format("%H:%M");this.timeNode.set("text",t),this.textNode.set("text",this.data.subject),this.node.addEvents({mouseenter:function(){this.day.collapseReady=!1,this.node.setStyles(this.css.calendarNode_over)}.bind(this),mouseleave:function(){this.node.setStyles(this.nodeStyles)}.bind(this),click:function(){this.openCalendar()}.bind(this)}),this.loadTooltip()},loadTooltip:function(){this.tooltip=new MWF.xApplication.Calendar.EventTooltip(this.app.content,this.node,this.app,this.data,{axis:"x",hiddenDelay:300,displayDelay:300,onShow:function(){this.day.collapseDisable=!0}.bind(this),onQueryCreate:function(){this.day.collapseDisable=!0}.bind(this),onHide:function(){this.day.collapseDisable=!1,this.day.collapse()}.bind(this)}),this.tooltip.view=this.view},showTooltip:function(){this.tooltip||(this.tooltip=new MWF.xApplication.Calendar.EventTooltip(this.app.content,this.node,this.app,this.data,{axis:"x",delay:150}),this.tooltip.view=this.view),this.tooltip.load()},openCalendar:function(){this.form=new MWF.xApplication.Calendar.CalendarForm(this,this.data,{},{app:this.app}),this.form.view=this,this.form.open()},destroy:function(){this.tooltip&&this.tooltip.destroy(),this.node.destroy(),MWF.release(this)},reload:function(){this.view.reload()}}),MWFCalendarMonthView.MonthSelector=new Class({Implements:[Events],initialize:function(t,e){this.calendar=e,this.css=this.calendar.css,this.app=this.calendar.app,this.date=t,this.year=this.date.get("year"),this.load()},load:function(){this.monthSelectNode=new Element("div",{styles:this.css.calendarMonthSelectNode}).inject(this.calendar.container),this.monthSelectNode.position({relativeTo:this.calendar.titleTextNode,position:"bottomCenter",edge:"upperCenter"}),this.monthSelectNode.addEvent("mousedown",(function(t){t.stopPropagation()})),this.monthSelectTitleNode=new Element("div",{styles:this.css.calendarMonthSelectTitleNode}).inject(this.monthSelectNode),this.monthSelectPrevYearNode=new Element("div",{styles:this.css.calendarMonthSelectTitlePrevYearNode}).inject(this.monthSelectTitleNode),this.monthSelectNextYearNode=new Element("div",{styles:this.css.calendarMonthSelectTitleNextYearNode}).inject(this.monthSelectTitleNode),this.monthSelectTextNode=new Element("div",{styles:this.css.calendarMonthSelectTitleTextNode}).inject(this.monthSelectTitleNode),this.monthSelectTextNode.set("text",this.year);this.monthSelectTable=new Element("table",{styles:{"margin-top":"10px"},height:"200px",width:"90%",align:"center",border:"0",cellPadding:"0",cellSpacing:"0",html:"<tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr>"}).inject(this.monthSelectNode),this.monthSelectBottomNode=new Element("div",{styles:this.css.calendarMonthSelectBottomNode,text:this.app.lp.today}).inject(this.monthSelectNode),this.setEvent()},loadMonth:function(){this.monthSelectTextNode.set("text",this.year);var t=new Date,e=t.get("year"),i=t.get("month"),n=this.date.get("year"),s=this.date.get("month"),a=this;this.monthSelectTable.getElements("td").each(function(t,o){t.empty(),t.removeEvents("mouseover"),t.removeEvents("mouseout"),t.removeEvents("mousedown"),t.removeEvents("mouseup"),t.removeEvents("click");var h=o+1;t.store("month",h),t.setStyles(this.css.calendarMonthSelectTdNode),t.setStyle("background-color","#FFF"),this.year==e&&o==i?new Element("div",{styles:a.css.calendarMonthSelectTodayNode,text:""+h+("zh"===MWF.language.substr(0,2)?this.app.lp.month:"")}).inject(t):this.year==n&&o==s?new Element("div",{styles:a.css.calendarMonthSelectCurrentNode,text:""+h+("zh"===MWF.language.substr(0,2)?this.app.lp.month:"")}).inject(t):t.set("text",""+h+("zh"===MWF.language.substr(0,2)?this.app.lp.month:"")),t.addEvents({mouseover:function(){this.setStyles(a.css.calendarMonthSelectTdNode_over)},mouseout:function(){this.setStyles(a.css.calendarMonthSelectTdNode)},mousedown:function(){this.setStyles(a.css.calendarMonthSelectTdNode_down)},mouseup:function(){this.setStyles(a.css.calendarMonthSelectTdNode_over)},click:function(){a.selectedMonth(this)}})}.bind(this))},setEvent:function(){this.monthSelectPrevYearNode.addEvent("click",function(){this.prevYear()}.bind(this)),this.monthSelectNextYearNode.addEvent("click",function(){this.nextYear()}.bind(this)),this.monthSelectBottomNode.addEvents({mouuseover:function(){this.monthSelectBottomNode.setStyles(this.css.calendarMonthSelectBottomNode_over)}.bind(this),mouuseout:function(){this.monthSelectBottomNode.setStyles(this.css.calendarMonthSelectBottomNode)}.bind(this),click:function(){this.todayMonth()}.bind(this)})},prevYear:function(){this.year--,this.year<1900&&(this.year=1900),this.monthSelectTextNode.set("text",this.year),this.loadMonth()},nextYear:function(){this.year++,this.monthSelectTextNode.set("text",this.year),this.loadMonth()},todayMonth:function(){var t=new Date;this.calendar.changeMonthTo(t),this.hide()},selectedMonth:function(t){var e=t.retrieve("month"),i=Date.parse(this.year+"/"+e+"/1");this.calendar.changeMonthTo(i),this.hide()},show:function(){this.date=this.calendar.date,this.year=this.date.get("year"),this.loadMonth(),this.monthSelectNode.setStyle("display","block"),this.hideFun=this.hide.bind(this),document.body.addEvent("mousedown",this.hideFun)},hide:function(){this.monthSelectNode.setStyle("display","none"),document.body.removeEvent("mousedown",this.hideFun)},destroy:function(){}});