MWF.xApplication.process=MWF.xApplication.process||{},MWF.xApplication.process.Application=MWF.xApplication.process.Application||{},MWF.require("MWF.widget.Common",null,!1),MWF.require("MWF.xScript.Macro",null,!1),MWF.xDesktop.requireApp("process.Application","lp."+o2.language,null,!1),MWF.xApplication.process.Application.Viewer=new Class({Implements:[Options,Events],Extends:MWF.widget.Common,options:{style:"default",resizeNode:!0,actions:{lookup:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}/execute",method:"PUT"},getView:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}"},listWorkByJob:{uri:"/jaxrs/job/{job}/find/work/workcompleted"},listTaskByWork:{uri:"/jaxrs/work/{id}/assignment/manage"}},actionRoot:"x_processplatform_assemble_surface"},initialize:function(e,t,i){this.setOptions(i),this.path="../x_component_process_Application/$Viewer/",this.cssPath="../x_component_process_Application/$Viewer/"+this.options.style+"/css.wcss",this._loadCss(),this.lp=MWF.xApplication.process.Application.LP,this.container=$(e),this.json=t,this.viewJson=null,this.filterItems=[],this.searchStatus="none",this.items=[],this.selectedItems=[],this.hideColumns=[],this.openColumns=[],this.gridJson=null,this.init(function(){this.load()}.bind(this))},init:function(e){this.json.data?(this.viewJson=JSON.decode(this.json.data),e&&e()):this.getView(e)},load:function(){this.loadLayout(),this.createSearchNode(),this.createViewNode({filterList:this.json.filter||null}),this.options.resizeNode&&(this.setContentHeightFun=this.setContentHeight.bind(this),this.container.addEvent("resize",this.setContentHeightFun),this.setContentHeightFun())},loadLayout:function(){this.node=new Element("div",{styles:this.css.node}).inject(this.container),this.searchAreaNode=new Element("div",{styles:this.css.searchAreaNode}).inject(this.node),this.viewAreaNode=new Element("div",{styles:this.css.viewAreaNode}).inject(this.node)},createSearchNode:function(){this.viewJson.customFilterEntryList&&this.viewJson.customFilterEntryList.length?(this.searchStatus="default",this.loadFilterSearch()):this.loadSimpleSearch()},loadSimpleSearch:function(){this.searchSimpleNode=new Element("div",{styles:this.css.searchSimpleNode}).inject(this.searchAreaNode),this.searchSimpleButtonNode=new Element("div",{styles:this.css.searchSimpleButtonNode}).inject(this.searchSimpleNode),this.searchSimpleInputNode=new Element("input",{type:"text",styles:this.css.searchSimpleInputNode,value:this.lp.searchKeywork}).inject(this.searchSimpleNode),this.searchSimpleButtonNode.addEvent("click",function(){this.search()}.bind(this)),this.searchSimpleInputNode.addEvents({focus:function(){this.searchSimpleInputNode.get("value")===this.lp.searchKeywork&&this.searchSimpleInputNode.set("value","")}.bind(this),blur:function(){this.searchSimpleInputNode.get("value")||this.searchSimpleInputNode.set("value",this.lp.searchKeywork)}.bind(this),keydown:function(e){13===e.code&&this.search()}.bind(this)})},search:function(){if(this.gridJson)for(var e=this.searchSimpleInputNode.get("value"),t=this.viewTable.rows,i="no"!==this.json.isTitle?1:0;i<t.length;i++){var s=t[i];e&&e!=this.lp.searchKeywork?-1!==s.get("text").indexOf(e)?"none"===s.getStyle("display")&&s.setStyle("display","table-row"):"none"!==s.getStyle("display")&&s.setStyle("display","none"):"none"===s.getStyle("display")&&s.setStyle("display","table-row")}},loadFilterSearch:function(){this.viewSearchCustomActionNode=new Element("div",{styles:this.css.viewFilterSearchCustomActionNode,text:this.lp.customSearch}).inject(this.searchAreaNode),this.viewSearchInputAreaNode=new Element("div",{styles:this.css.viewFilterSearchInputAreaNode}).inject(this.searchAreaNode),this.viewSearchIconNode=new Element("div",{styles:this.css.viewFilterSearchIconNode}).inject(this.viewSearchInputAreaNode),this.viewSearchInputBoxNode=new Element("div",{styles:this.css.viewFilterSearchInputBoxNode}).inject(this.viewSearchInputAreaNode),this.viewSearchInputNode=new Element("input",{styles:this.css.viewFilterSearchInputNode,value:this.lp.searchKeywork}).inject(this.viewSearchInputBoxNode),this.viewSearchInputNode.addEvents({focus:function(){this.viewSearchInputNode.get("value")===this.lp.searchKeywork&&this.viewSearchInputNode.set("value","")}.bind(this),blur:function(){this.viewSearchInputNode.get("value")||this.viewSearchInputNode.set("value",this.lp.searchKeywork)}.bind(this),keydown:function(e){13===e.code&&this.searchView()}.bind(this)}),this.viewSearchIconNode.addEvents({click:function(){this.searchView()}.bind(this)}),this.viewSearchCustomActionNode.addEvents({click:function(){this.loadCustomSearch()}.bind(this)})},searchView:function(){if(this.viewJson.customFilterEntryList){var e=this.viewSearchInputNode.get("value");if(e&&e!==this.lp.searchKeywork){var t=this.json.filter||[];this.viewJson.customFilterEntryList.each(function(i){if("textValue"===i.formatType){var s={path:i.path,value:e,formatType:i.formatType,logic:"or",comparison:"like"};t.push(s)}if("numberValue"===i.formatType){var o=e.toFloat();if(!isNaN(o)){s={path:i.path,value:o,formatType:i.formatType,logic:"or",comparison:"like"};t.push(s)}}}.bind(this)),this.createViewNode({filterList:t})}}},searchCustomView:function(){if(this.filterItems.length){var e=this.json.filter||[];this.filterItems.each(function(t){e.push(t.data)}.bind(this)),this.createViewNode({filterList:e})}else this.createViewNode({filterList:this.json.filter||null})},loadCustomSearch:function(){this.viewSearchIconNode.setStyle("display","none"),this.viewSearchInputBoxNode.setStyle("display","none"),this.viewSearchCustomActionNode.setStyle("display","none"),this.searchMorph||(this.searchMorph=new Fx.Morph(this.viewSearchInputAreaNode));var e=this.viewSearchInputAreaNode.getParent().getSize().x-2-20;this.css.viewFilterSearchInputAreaNode_custom.width=e+"px";var t=this.viewSearchInputAreaNode.getSize().x-2;this.viewSearchInputAreaNode.setStyle("width",t+"px"),this.searchMorph.start(this.css.viewFilterSearchInputAreaNode_custom).chain(function(){this.searchStatus="custom",this.css.viewFilterSearchInputAreaNode_custom.width="auto",this.viewSearchInputAreaNode.setStyle("width","auto"),this.viewSearchCustomContentNode?(this.viewSearchCustomCloseActionNode.setStyle("display","block"),this.viewSearchCustomContentNode.setStyle("display","block")):this.loadCustomSearchContent(),this.setContentHeightFun()}.bind(this)),this.searchCustomView()},loadCustomSearchContent:function(){this.viewSearchCustomCloseActionNode=new Element("div",{styles:this.css.viewFilterSearchCustomCloseActionNode}).inject(this.viewSearchInputAreaNode),this.viewSearchCustomContentNode=new Element("div",{styles:this.css.viewFilterSearchCustomContentNode}).inject(this.viewSearchInputAreaNode),this.viewSearchCustomPathContentNode=new Element("div",{styles:this.css.viewFilterSearchCustomPathContentNode}).inject(this.viewSearchCustomContentNode),this.viewSearchCustomComparisonContentNode=new Element("div",{styles:this.css.viewFilterSearchCustomComparisonContentNode}).inject(this.viewSearchCustomContentNode),this.viewSearchCustomValueContentNode=new Element("div",{styles:this.css.viewFilterSearchCustomValueContentNode}).inject(this.viewSearchCustomContentNode),this.viewSearchCustomAddContentNode=new Element("div",{styles:this.css.viewFilterSearchCustomAddContentNode}).inject(this.viewSearchCustomContentNode),this.viewSearchCustomAddIconNode=new Element("div",{styles:this.css.viewFilterSearchCustomAddIconNode}).inject(this.viewSearchCustomAddContentNode),this.viewSearchCustomFilterContentNode=new Element("div",{styles:this.css.viewFilterSearchCustomFilterContentNode}).inject(this.viewSearchCustomContentNode),this.loadViewSearchCustomList(),this.viewSearchCustomCloseActionNode.addEvents({click:function(){this.closeCustomSearch()}.bind(this)}),this.viewSearchCustomAddIconNode.addEvents({click:function(){this.viewSearchCustomAddToFilter()}.bind(this)})},loadViewSearchCustomList:function(){this.viewSearchCustomPathListNode=new Element("select",{styles:this.css.viewFilterSearchCustomPathListNode,multiple:!0}).inject(this.viewSearchCustomPathContentNode),this.viewSearchCustomComparisonListNode=new Element("select",{styles:this.css.viewFilterSearchCustomComparisonListNode,multiple:!0}).inject(this.viewSearchCustomComparisonContentNode),this.viewJson.customFilterEntryList.each(function(e){new Element("option",{style:this.css.viewFilterSearchOptionNode,value:e.path,text:e.title}).inject(this.viewSearchCustomPathListNode).store("entry",e)}.bind(this)),this.viewSearchCustomPathListNode.addEvent("change",function(){this.loadViewSearchCustomComparisonList()}.bind(this))},loadViewSearchCustomComparisonList:function(){var e=this.viewSearchCustomPathListNode.selectedIndex,t=this.viewSearchCustomPathListNode.options[e].retrieve("entry");if(t)switch(t.formatType){case"numberValue":this.loadComparisonSelect(this.lp.numberFilter),this.loadViewSearchCustomValueNumberInput();break;case"dateTimeValue":this.loadComparisonSelect(this.lp.dateFilter),this.loadViewSearchCustomValueDateInput();break;case"booleanValue":this.loadComparisonSelect(this.lp.booleanFilter),this.loadViewSearchCustomValueBooleanInput();break;default:this.loadComparisonSelect(this.lp.textFilter),this.loadViewSearchCustomValueTextInput()}},loadViewSearchCustomValueNumberInput:function(){this.viewSearchCustomValueContentNode.empty(),this.viewSearchCustomValueNode=new Element("input",{styles:this.css.viewFilterSearchCustomValueNode,type:"number"}).inject(this.viewSearchCustomValueContentNode)},loadViewSearchCustomValueDateInput:function(){this.viewSearchCustomValueContentNode.empty(),this.viewSearchCustomValueNode=new Element("input",{styles:this.css.viewFilterSearchCustomValueNode,type:"text",readonly:!0}).inject(this.viewSearchCustomValueContentNode),MWF.require("MWF.widget.Calendar",function(){this.calendar=new MWF.widget.Calendar(this.viewSearchCustomValueNode,{style:"xform",isTime:!0,target:this.container,format:"db"})}.bind(this))},loadViewSearchCustomValueBooleanInput:function(){this.viewSearchCustomValueContentNode.empty(),this.viewSearchCustomValueNode=new Element("select",{styles:this.css.viewFilterSearchCustomValueSelectNode,multiple:!0}).inject(this.viewSearchCustomValueContentNode),new Element("option",{value:"true",text:this.lp.yes}).inject(this.viewSearchCustomValueNode),new Element("option",{value:"false",text:this.lp.no}).inject(this.viewSearchCustomValueNode)},loadViewSearchCustomValueTextInput:function(){this.viewSearchCustomValueContentNode.empty(),this.viewSearchCustomValueNode=new Element("textarea",{styles:this.css.viewFilterSearchCustomValueNode}).inject(this.viewSearchCustomValueContentNode)},loadComparisonSelect:function(e){this.viewSearchCustomComparisonListNode.empty(),Object.each(e,function(e,t){new Element("option",{value:t,text:e}).inject(this.viewSearchCustomComparisonListNode)}.bind(this))},closeCustomSearch:function(){if(this.viewSearchCustomContentNode&&"block"===this.viewSearchCustomContentNode.getStyle("display")){this.viewSearchCustomCloseActionNode.setStyle("display","none"),this.viewSearchCustomContentNode.setStyle("display","none"),e=this.viewSearchInputAreaNode.getParent().getSize().x-2-10-90,this.css.viewFilterSearchInputAreaNode.width=e+"px";var e=this.viewSearchInputAreaNode.getSize().x-2;this.viewSearchInputAreaNode.setStyle("width",e+"px"),this.searchMorph||(this.searchMorph=new Fx.Morph(this.viewSearchInputAreaNode)),this.searchMorph.start(this.css.viewFilterSearchInputAreaNode).chain(function(){this.searchStatus="default",this.css.viewFilterSearchInputAreaNode.width="auto",this.viewSearchInputAreaNode.setStyle("margin-right","90px"),this.viewSearchIconNode.setStyle("display","block"),this.viewSearchInputBoxNode.setStyle("display","block"),this.viewSearchCustomActionNode.setStyle("display","block"),this.setContentHeightFun()}.bind(this)),this.createViewNode({filterList:this.json.filter||null})}},viewSearchCustomAddToFilter:function(){var e=this.viewSearchCustomPathListNode.selectedIndex,t=this.viewSearchCustomComparisonListNode.selectedIndex;if(-1===e)return MWF.xDesktop.notice("error",{x:"left",y:"top"},this.lp.filterErrorTitle,this.viewSearchCustomPathListNode,{x:0,y:85}),!1;if(-1===t)return MWF.xDesktop.notice("error",{x:"left",y:"top"},this.lp.filterErrorComparison,this.viewSearchCustomComparisonListNode,{x:0,y:85}),!1;var i=this.viewSearchCustomPathListNode.options[e].retrieve("entry");if(i){var s=i.title,o=i.path,n=this.viewSearchCustomComparisonListNode.options[t].get("value"),h=this.viewSearchCustomComparisonListNode.options[t].get("text"),a="";switch(i.formatType){case"numberValue":case"dateTimeValue":a=this.viewSearchCustomValueNode.get("value");break;case"booleanValue":var l=this.viewSearchCustomValueNode.selectedIndex;if(-1!==l)a="true"===this.viewSearchCustomValueNode.options[l].get("value");break;default:a=this.viewSearchCustomValueNode.get("value")}if(""===a)return MWF.xDesktop.notice("error",{x:"left",y:"top"},this.lp.filterErrorValue,this.viewSearchCustomValueContentNode,{x:0,y:85}),!1;this.filterItems.push(new MWF.xApplication.process.Application.Viewer.Filter(this,{logic:"and",path:o,title:s,comparison:n,comparisonTitle:h,value:a,formatType:i.formatType},this.viewSearchCustomFilterContentNode)),this.searchCustomView()}},searchViewRemoveFilter:function(e){this.filterItems.erase(e),e.destroy(),this.searchCustomView()},setContentHeight:function(){var e=this.node.getSize(),t=this.searchAreaNode.getSize(),i=e.y-t.y;this.viewAreaNode.setStyle("height",i+"px")},createLoadding:function(){this.loadingAreaNode=new Element("div",{styles:this.css.viewLoadingAreaNode}).inject(this.contentAreaNode),new Element("div",{styles:{height:"5px"}}).inject(this.loadingAreaNode);var e=new Element("div",{styles:this.css.viewLoadingNode}).inject(this.loadingAreaNode);new Element("div",{styles:this.css.viewLoadingIconNode}).inject(e),new Element("div",{styles:this.css.viewLoadingTextNode}).inject(e).set("text","loading...")},createViewNode:function(e){this.viewAreaNode.empty(),this.contentAreaNode=new Element("div",{styles:this.css.contentAreaNode}).inject(this.viewAreaNode),this.viewTable=new Element("table",{styles:this.css.viewTitleTableNode,border:"0px",cellPadding:"0",cellSpacing:"0"}).inject(this.contentAreaNode),this.createLoadding(),"no"!==this.json.isTitle?(this.viewTitleLine=new Element("tr",{styles:this.css.viewTitleLineNode}).inject(this.viewTable),this.selectTitleCell=new Element("td",{styles:this.css.viewTitleCellNode}).inject(this.viewTitleLine),this.selectTitleCell.setStyle("width","10px"),this.json.titleStyles&&this.selectTitleCell.setStyles(this.json.titleStyles),this.entries={},this.viewJson.selectEntryList.each(function(e){if(this.entries[e.column]=e,e.hideColumn)this.hideColumns.push(e.column);else{var t=new Element("td",{styles:this.css.viewTitleCellNode,text:e.displayName}).inject(this.viewTitleLine),i=MWF.getTextSize(e.displayName,this.css.viewTitleCellNode);t.setStyle("min-width",i.x+"px"),this.json.titleStyles&&t.setStyles(this.json.titleStyles)}e.allowOpen&&this.openColumns.push(e.column)}.bind(this)),this.lookup(e)):(this.viewJson.selectEntryList.each(function(e){e.hideColumn&&this.hideColumns.push(e.column),e.allowOpen||this.openColumns.push(e.column)}.bind(this)),this.lookup(e))},lookup:function(e){this.getLookupAction(function(){this.json.application&&this.lookupAction.invoke({name:"lookup",async:!0,data:e||null,parameter:{view:this.json.name,application:this.json.application},success:function(e){this.viewData=e.data,this.viewJson.groupEntry.column?(this.gridJson=e.data.groupGrid,this.loadGroupData()):(this.gridJson=e.data.grid,this.loadData()),this.loadingAreaNode&&(this.loadingAreaNode.destroy(),this.loadingAreaNode=null)}.bind(this)})}.bind(this))},loadData:function(){this.gridJson.length&&this.gridJson.each(function(e,t){this.items.push(new MWF.xApplication.process.Application.Viewer.Item(this,e,null,t))}.bind(this))},loadGroupData:function(){this.selectTitleCell&&(this.selectTitleCell.set("html","<span style='font-family: Webdings'><img src='../x_component_process_Application/$Viewer/"+this.options.style+"/icon/expand.png'/></span>"),this.selectTitleCell.setStyle("cursor","pointer"),this.selectTitleCell.addEvent("click",this.expandOrCollapseAll.bind(this))),this.gridJson.length&&(this.gridJson.each(function(e){this.items.push(new MWF.xApplication.process.Application.Viewer.ItemCategory(this,e))}.bind(this)),this.expandOrCollapseAll())},expandOrCollapseAll:function(){var e=this.selectTitleCell.getElement("span");-1===e.get("html").indexOf("expand.png")?this.items.each(function(t){t.collapse(),e.set("html","<img src='../x_component_process_Application/$Viewer/"+this.options.style+"/icon/expand.png'/>")}.bind(this)):this.items.each(function(t,i){window.setTimeout(function(){t.expand()}.bind(this),10*i+5),e.set("html","<img src='../x_component_process_Application/$Viewer/"+this.options.style+"/icon/down.png'/>")}.bind(this))},getView:function(e){this.getLookupAction(function(){this.json.application&&this.lookupAction.invoke({name:"getView",async:!0,parameter:{view:this.json.viewName,application:this.json.application},success:function(t){this.viewJson=JSON.decode(t.data.data),this.json=Object.merge(this.json,t.data),e&&e()}.bind(this)})}.bind(this))},getLookupAction:function(e){if(this.lookupAction)e&&e();else{var t=this;MWF.require("MWF.xDesktop.Actions.RestActions",function(){this.lookupAction=new MWF.xDesktop.Actions.RestActions("",this.options.actionRoot,""),this.lookupAction.getActions=function(e){this.actions=t.options.actions,e&&e()},e&&e()}.bind(this))}},hide:function(){this.node.setStyle("display","none")},reload:function(){this.node.setStyle("display","block"),this.loadingAreaNode&&this.loadingAreaNode.setStyle("display","block"),this.filterItems.each(function(e){e.destroy()}.bind(this)),this.filterItems=[],this.viewSearchInputNode&&this.viewSearchInputNode.set("text",this.lp.searchKeywork),this.closeCustomSearch(),this.viewAreaNode.empty(),this.createViewNode({filterList:this.json.filter||null})},getFilter:function(){var e=[];if("custom"===this.searchStatus&&this.filterItems.length&&this.filterItems.each(function(t){e.push(t.data)}.bind(this)),"default"===this.searchStatus){var t=this.viewSearchInputNode.get("value");t&&t!==this.lp.searchKeywork&&this.viewJson.customFilterEntryList.each(function(i){if("textValue"===i.formatType){var s={path:i.path,value:t,formatType:i.formatType,logic:"or",comparison:"like"};e.push(s)}if("numberValue"===i.formatType){var o=t.toFloat();if(!isNaN(o)){s={path:i.path,value:o,formatType:i.formatType,logic:"or",comparison:"like"};e.push(s)}}}.bind(this))}return e.length?e:null},getData:function(){if(this.selectedItems.length){var e=[];return this.selectedItems.each((function(t){e.push(t.data)})),e}return[]}}),MWF.xApplication.process.Application.Viewer.Item=new Class({initialize:function(e,t,i,s){this.view=e,this.data=t,this.css=this.view.css,this.isSelected=!1,this.prev=i,this.load()},load:function(){this.node=new Element("tr",{styles:this.css.viewContentTrNode}),this.prev?this.node.inject(this.prev.node,"after"):this.node.inject(this.view.viewTable),this.selectTd=new Element("td",{styles:this.css.viewContentTdNode}).inject(this.node),this.selectTd.setStyles({cursor:"pointer"}),this.view.json.itemStyles&&this.selectTd.setStyles(this.view.json.itemStyles),Object.each(this.data.data,function(e,t){if(-1===this.view.hideColumns.indexOf(t)){var i=new Element("td",{styles:this.css.viewContentTdNode}).inject(this.node);if(t!==this.view.viewJson.groupEntry.column){var s=this.view.entries[t].code?MWF.Macro.exec(this.view.entries[t].code,{value:e,gridData:this.view.gridJson,data:this.view.viewData,entry:this.data}):e;i.set("text",s)}-1!==this.view.openColumns.indexOf(t)&&this.setOpenWork(i),this.view.json.itemStyles&&i.setStyles(this.view.json.itemStyles)}}.bind(this)),this.setEvent()},setOpenWork:function(e){e.setStyle("cursor","pointer"),e.addEvent("click",this.openWorkAndCompleted.bind(this))},openWorkAndCompleted:function(e){this.view.lookupAction.invoke({name:"listWorkByJob",async:!0,parameter:{job:this.data.job},success:function(t){var i=t.data.workCompletedList.length,s=t.data.workList.length+i;if(1===s)i?this.openWorkCompleted(t.data.workCompletedList[0].id,e):this.openWork(t.data.workList[0].id,e);else if(s>1){var o=this.createWorksArea();t.data.workCompletedList.each(function(e){this.createWorkCompletedNode(e,o)}.bind(this)),t.data.workList.each(function(e){this.createWorkNode(e,o)}.bind(this)),this.showWorksArea(o,e)}}.bind(this)})},createWorkNode:function(e,t){var i=t.getLast(),s=new Element("div",{styles:this.css.workAreaNode}).inject(i),o=new Element("div",{styles:this.css.workAreaActionNode,text:this.view.lp.open}).inject(s);o.store("workId",e.id),o.addEvent("click",function(e){this.openWork(e.target.retrieve("workId"),e),this.mask.hide(),t.destroy()}.bind(this));var n=new Element("div",{styles:this.css.workAreaLeftNode}).inject(s),h=(new Element("div",{styles:this.css.workAreaTitleNode,text:e.title}).inject(n),new Element("div",{styles:this.css.workAreaContentNode}).inject(n));new Element("div",{styles:this.css.workAreaContentTitleNode,text:this.view.lp.activity+": "}).inject(h),new Element("div",{styles:this.css.workAreaContentTextNode,text:e.activityName}).inject(h);var a=[];this.view.lookupAction.invoke({name:"listTaskByWork",async:!0,parameter:{id:e.id},success:function(e){e.data.taskList.each(function(e){a.push(MWF.name.cn(e.person))}.bind(this)),new Element("div",{styles:this.css.workAreaContentTitleNode,text:this.view.lp.taskPeople+": "}).inject(h),new Element("div",{styles:this.css.workAreaContentTextNode,text:a.join(", ")}).inject(h)}.bind(this)})},createWorkCompletedNode:function(e,t){var i=t.getLast(),s=new Element("div",{styles:this.css.workAreaNode}).inject(i),o=new Element("div",{styles:this.css.workAreaActionNode,text:this.view.lp.open}).inject(s);o.store("workId",e.id),o.addEvent("click",function(e){this.mask.hide(),t.destroy(),this.openWorkCompleted(e.target.retrieve("workId"),e)}.bind(this));var n=new Element("div",{styles:this.css.workAreaLeftNode}).inject(s),h=(new Element("div",{styles:this.css.workAreaTitleNode,text:e.title}).inject(n),new Element("div",{styles:this.css.workAreaContentNode}).inject(n));new Element("div",{styles:this.css.workAreaContentTitleNode,text:this.view.lp.activity+": "}).inject(h),new Element("div",{styles:this.css.workAreaContentTextNode,text:this.view.lp.processCompleted}).inject(h)},createWorksArea:function(){var e=this.css.worksAreaNode;layout.mobile&&(e=this.css.worksAreaNodeMobile);var t=new Element("div",{styles:e}),i=new Element("div",{styles:this.css.worksAreaTitleNode}).inject(t);new Element("div",{styles:this.css.worksAreaTitleCloseNode}).inject(i).addEvent("click",function(e){this.mask.hide(),e.target.getParent().getParent().destroy()}.bind(this));new Element("div",{styles:this.css.worksAreaContentNode}).inject(t);return t},showWorksArea:function(e,t){this.mask=new MWF.widget.Mask({style:"desktop",loading:!1}),this.mask.loadNode(this.view.container),e.inject(this.view.node),this.setWorksAreaPosition(e,t.target)},setWorksAreaPosition:function(e,t){var i=t.getPosition(this.view.container),s=this.view.container.getSize(),o=(this.view.container.getPosition(this.view.container.getOffsetParent()),e.getSize()),n=i.x+o.x-s.x;n=n>0?n+20:0;var h=i.y+o.y-s.y;h=h>0?h+5:0,e.position({relativeTo:t,position:"lefttop",edge:"lefttop",offset:{x:0-n,y:0-h}})},openWork:function(e,t){var i={workId:e};layout.desktop.openApplication(t,"process.Work",i)},openWorkCompleted:function(e,t){var i={workCompletedId:e};layout.desktop.openApplication(t,"process.Work",i)},setEvent:function(){"single"!==this.view.json.select&&"multi"!==this.view.json.select||this.node.addEvents({mouseover:function(){if(!this.isSelected){var e="checkbox";"single"===this.view.json.select&&(e="radiobox"),this.selectTd.setStyles({background:"url(../x_component_process_Application/$Viewer/default/icon/"+e+".png) center center no-repeat"})}}.bind(this),mouseout:function(){this.isSelected||this.selectTd.setStyles({background:"transparent"})}.bind(this),click:function(){this.select()}.bind(this)})},select:function(){this.isSelected?"single"===this.view.json.select?this.unSelectedSingle():this.unSelected():"single"===this.view.json.select?this.selectedSingle():this.selected(),this.view.fireEvent("select")},selected:function(){this.view.selectedItems.push(this),this.selectTd.setStyles({background:"url(../x_component_process_Application/$Viewer/default/icon/checkbox_checked.png) center center no-repeat"}),this.node.setStyles(this.css.viewContentTrNode_selected),this.isSelected=!0},unSelected:function(){this.view.selectedItems.erase(this),this.selectTd.setStyles({background:"transparent"}),this.node.setStyles(this.css.viewContentTrNode),this.isSelected=!1},selectedSingle:function(){this.view.currentSelectedItem&&this.view.currentSelectedItem.unSelectedSingle(),this.view.selectedItems=[this],this.view.currentSelectedItem=this,this.selectTd.setStyles({background:"url(../x_component_process_Application/$Viewer/default/icon/radiobox_checked.png) center center no-repeat"}),this.node.setStyles(this.css.viewContentTrNode_selected),this.isSelected=!0},unSelectedSingle:function(){this.view.selectedItems=[],this.view.currentSelectedItem=null,this.selectTd.setStyles({background:"transparent"}),this.node.setStyles(this.css.viewContentTrNode),this.isSelected=!1}}),MWF.xApplication.process.Application.Viewer.ItemCategory=new Class({initialize:function(e,t){this.view=e,this.data=t,this.css=this.view.css,this.items=[],this.loadChild=!1,this.load()},load:function(){this.node=new Element("tr",{styles:this.css.viewContentTrNode}).inject(this.view.viewTable),this.selectTd=new Element("td",{styles:this.css.viewContentCategoryTdNode}).inject(this.node),this.view.json.itemStyles&&this.selectTd.setStyles(this.view.json.itemStyles),this.categoryTd=new Element("td",{styles:this.css.viewContentCategoryTdNode,colspan:this.view.viewJson.selectEntryList.length}).inject(this.node),this.groupColumn=null;for(var e=0;e<this.view.viewJson.selectEntryList.length;e++)if(this.view.viewJson.selectEntryList[e].column===this.view.viewJson.groupEntry.column){this.groupColumn=this.view.viewJson.selectEntryList[e];break}if(this.groupColumn)var t=this.groupColumn.code?MWF.Macro.exec(this.groupColumn.code,{value:this.data.group,gridData:this.view.gridJson,data:this.view.viewData,entry:this.data}):this.data.group;else t=this.data.group;this.categoryTd.set("html","<span style='font-family: Webdings'><img src='../x_component_process_Application/$Viewer/"+this.view.options.style+"/icon/expand.png'/></span> "+t),this.view.json.itemStyles&&this.categoryTd.setStyles(this.view.json.itemStyles),this.setEvent()},setEvent:function(){this.node.addEvents({click:function(){this.expandOrCollapse()}.bind(this)})},expandOrCollapse:function(){-1===this.node.getElement("span").get("html").indexOf("expand.png")?this.collapse():this.expand()},collapse:function(){this.items.each(function(e){e.node.setStyle("display","none")}.bind(this)),this.node.getElement("span").set("html","<img src='../x_component_process_Application/$Viewer/"+this.view.options.style+"/icon/expand.png'/>")},expand:function(){this.items.each(function(e){e.node.setStyle("display","table-row")}.bind(this)),this.node.getElement("span").set("html","<img src='../x_component_process_Application/$Viewer/"+this.view.options.style+"/icon/down.png'/>"),this.loadChild||(this.data.list.each(function(e){this.items.push(new MWF.xApplication.process.Application.Viewer.Item(this.view,e,this))}.bind(this)),this.loadChild=!0)}}),MWF.xApplication.process.Application.Viewer.Filter=new Class({initialize:function(e,t,i){this.viewer=e,this.data=t,this.css=this.viewer.css,this.content=i,this.load()},load:function(){this.node=new Element("div",{styles:this.css.viewSearchFilterNode}).inject(this.content),this.viewer.filterItems.length&&(this.logicNode=new Element("div",{styles:this.css.viewSearchFilterSelectAreaNode}).inject(this.node),this.logicSelectNode=new Element("div",{styles:this.css.viewSearchFilterSelectNode,text:this.viewer.lp.and,value:"and"}).inject(this.logicNode),this.logicSelectButtonNode=new Element("div",{styles:this.css.viewSearchFilterSelectButtonNode}).inject(this.logicNode),this.logicNode.addEvents({click:function(){"and"===this.logicSelectNode.get("value")?(this.logicSelectButtonNode.setStyle("float","left"),this.logicSelectNode.setStyle("float","right"),this.logicSelectNode.set({text:this.viewer.lp.or,value:"or"}),this.data.logic="or"):(this.logicSelectButtonNode.setStyle("float","right"),this.logicSelectNode.setStyle("float","left"),this.logicSelectNode.set({text:this.viewer.lp.and,value:"and"}),this.data.logic="and"),this.viewer.searchCustomView()}.bind(this)})),this.titleNode=new Element("div",{styles:this.css.viewSearchFilterTextNode,text:this.data.title||""}).inject(this.node),this.comparisonTitleNode=new Element("div",{styles:this.css.viewSearchFilterTextNode,text:this.data.comparisonTitle}).inject(this.node),this.valueNode=new Element("div",{styles:this.css.viewSearchFilterTextNode,text:'"'+this.data.value+'"'}).inject(this.node),this.deleteNode=new Element("div",{styles:this.css.viewSearchFilterDeleteNode}).inject(this.node),this.node.addEvents({mouseover:function(){this.node.setStyles(this.css.viewSearchFilterNode_over),this.deleteNode.setStyles(this.css.viewSearchFilterDeleteNode_over)}.bind(this),mouseout:function(){this.node.setStyles(this.css.viewSearchFilterNode),this.deleteNode.setStyles(this.css.viewSearchFilterDeleteNode)}.bind(this)}),this.deleteNode.addEvent("click",function(){this.viewer.searchViewRemoveFilter(this)}.bind(this))},destroy:function(){this.node.destroy(),MWF.release(this)}});