o2.xApplication.process.Xform.widget=o2.xApplication.process.Xform.widget||{},o2.xApplication.process.Xform.widget.OOXML=o2.xApplication.process.Xform.widget.OOXML||{},o2.OOXML=o2.OOXML||{},o2.xApplication.process.Xform.widget.OOXML.WordprocessingML=o2.OOXML.WML=new Class({Implements:[Options,Events],options:{AppVersion:"16.0000",Application:"o2oa",Company:"",ScaleCrop:"false",LinksUpToDate:"false",SharedDoc:"false",HyperlinksChanged:"false",w_document:'<w:document xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main"\n            xmlns:wpc="http://schemas.microsoft.com/office/word/2010/wordprocessingCanvas"\n            xmlns:cx="http://schemas.microsoft.com/office/drawing/2014/chartex"\n            xmlns:cx1="http://schemas.microsoft.com/office/drawing/2015/9/8/chartex"\n            xmlns:cx2="http://schemas.microsoft.com/office/drawing/2015/10/21/chartex"\n            xmlns:cx3="http://schemas.microsoft.com/office/drawing/2016/5/9/chartex"\n            xmlns:cx4="http://schemas.microsoft.com/office/drawing/2016/5/10/chartex"\n            xmlns:cx5="http://schemas.microsoft.com/office/drawing/2016/5/11/chartex"\n            xmlns:cx6="http://schemas.microsoft.com/office/drawing/2016/5/12/chartex"\n            xmlns:cx7="http://schemas.microsoft.com/office/drawing/2016/5/13/chartex"\n            xmlns:cx8="http://schemas.microsoft.com/office/drawing/2016/5/14/chartex"\n            xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"\n            xmlns:aink="http://schemas.microsoft.com/office/drawing/2016/ink"\n            xmlns:am3d="http://schemas.microsoft.com/office/drawing/2017/model3d"\n            xmlns:o="urn:schemas-microsoft-com:office:office"\n            xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"\n            xmlns:m="http://schemas.openxmlformats.org/officeDocument/2006/math" xmlns:v="urn:schemas-microsoft-com:vml"\n            xmlns:wp14="http://schemas.microsoft.com/office/word/2010/wordprocessingDrawing"\n            xmlns:wp="http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing"\n            xmlns:w10="urn:schemas-microsoft-com:office:word"\n            xmlns:w14="http://schemas.microsoft.com/office/word/2010/wordml"\n            xmlns:w15="http://schemas.microsoft.com/office/word/2012/wordml"\n            xmlns:w16cex="http://schemas.microsoft.com/office/word/2018/wordml/cex"\n            xmlns:w16cid="http://schemas.microsoft.com/office/word/2016/wordml/cid"\n            xmlns:w16="http://schemas.microsoft.com/office/word/2018/wordml"\n            xmlns:w16sdtdh="http://schemas.microsoft.com/office/word/2020/wordml/sdtdatahash"\n            xmlns:w16se="http://schemas.microsoft.com/office/word/2015/wordml/symex"\n            xmlns:wpg="http://schemas.microsoft.com/office/word/2010/wordprocessingGroup"\n            xmlns:wpi="http://schemas.microsoft.com/office/word/2010/wordprocessingInk"\n            xmlns:wne="http://schemas.microsoft.com/office/word/2006/wordml"\n            xmlns:wps="http://schemas.microsoft.com/office/word/2010/wordprocessingShape"\n            xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main"\n            mc:Ignorable="w14 w15 w16se w16cid w16 w16cex w16sdtdh wp14">',xmlHead:'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>',divAsP:!1},initialize:function(t){this.setOptions(t),this.path="../x_component_process_Xform/widget/$OOXML/WordprocessingML/",this.dpi=this.getDPI(),this.rid=11},getDPI:function(){var t=new Element("div",{styles:{width:"1in",height:"1in"}}).inject(document.body),e=t.offsetWidth.toInt();return t.destroy(),e},getZipTemplate:function(){return fetch(this.path+"template.zip").then((function(t){return t.blob().then(JSZip.loadAsync)}))},load:function(t){return new Promise(function(e){o2.load(["/o2_lib/jszip/jszip.min.js","/o2_lib/jszip/FileSaver.js"],function(){this.getZipTemplate().then(function(e){return this.zip=e,this.processDocument(t)}.bind(this)).then((function(t){var s=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});e(s)}))}.bind(this))}.bind(this))},processDocument:function(t){return this.zip.file("word/document.xml").async("text").then(function(e){return this.processWordDocument(e,t)}.bind(this)).then(function(t){return"<?xml"!==t.substring(0,5)&&(t=t.replace(/<w:document.*\>/,this.options.w_document),t=this.options.xmlHead+t),this.zip.file("word/document.xml",t),this.pics&&this.pics.length?this.zip.file("word/_rels/document.xml.rels").async("text").then(function(t){return this.processWordRel(t)}.bind(this)).then(function(t){return"<?xml"!==t.substring(0,5)&&(t=this.options.xmlHead+t),this.zip.file("word/_rels/document.xml.rels",t).generateAsync({type:"blob"})}.bind(this)):this.zip.generateAsync({type:"blob"})}.bind(this))},saveAs:function(t,e){o2.saveAs(t,e)},getPageRule:function(t){var e=null;if(t)for(var s=0;s<t.length;s++)if(t[s].type===CSSRule.PAGE_RULE){e=t[s];break}return e},getPicExt:function(t){switch(t.toLowerCase()){case"image/tiff":return"tif";case"image/gif":return"gif";case"image/jpeg":return"jpg";case"image/png":return"png"}return""},processWordRel_createRel:function(t,e,s,r){var i=this.createEl(s,"Relationship","rel");this.setAttrs(i,{Target:"media/"+t,Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",Id:"rId"+e},!1),r.appendChild(i)},processWordRel_getPicByUrl:function(t,e,s,r){var i="image"+e,o={Authorization:layout.session.user.token};return o[o2.tokenName]=layout.session.user.token,fetch(t,{credentials:"include",headers:o,mode:"cors"}).then(function(t){var o=this.getPicExt(t.headers.get("content-type")),a=i+"."+o;return t.blob().then(function(t){this.zip.file("word/media/"+a,t),this.processWordRel_createRel(a,e,s,r)}.bind(this))}.bind(this))},processWordRel_getPicByBase64:function(t,e,s,r){var i="image"+e,o=t.split(","),a=o[0].match(/:(.*?);/)[1],n=o[1],c=i+"."+this.getPicExt(a);return this.zip.file("word/media/"+c,n,{base64:!0}),this.processWordRel_createRel(c,e,s,r),Promise.resolve()},processWordRel:function(t,e){var s=(new DOMParser).parseFromString(t,"text/xml"),r=s.documentElement,i=[],o=11;return this.pics.each(function(t){"data"===t.substring(0,4).toLowerCase()?i.push(this.processWordRel_getPicByBase64(t,o,s,r)):i.push(this.processWordRel_getPicByUrl(t,o,s,r)),o++}.bind(this)),Promise.all(i).then((function(){return(new XMLSerializer).serializeToString(s)}))},processWordDocument:function(t,e){var s=(new DOMParser).parseFromString(t,"text/xml"),r=s.documentElement.querySelector("body"),i=new Element("div",{styles:{display:"block",width:"442.2pt",padding:"104.9pt 73.7pt 99.25pt 79.4pt"}}).set("html",e).inject(document.body);return new Promise(function(t){var e=i.getElements("img"),o=[];e.each(function(t){if(!t.complete){var e=new Promise((function(e){t.addEvent("load",function(){e()}.bind(this))}));o.push(e)}}.bind(this)),Promise.all(o).then(function(){if(i.getElement("style")){var e=this.getPageRule(i.getElement("style").sheet.cssRules);e&&this.processPageSection(e,r)}var o=i.getElement(".WordSection1");o&&(this.processPageSection(o,r),this.processDom(o,r)),i.destroy();var a=new XMLSerializer;t(a.serializeToString(s))}.bind(this))}.bind(this))},processDom:function(t,e,s,r){for(t=t.getFirst();t;){if("none"!==t.getStyle("display"))if(t.hasClass("doc_layout_redHeader"))for(var i=t.firstChild;i;){if(i.nodeType===Node.TEXT_NODE){if(i.nodeValue.trim()){var o=this.createParagraphFromDom(t,e,s);this.processRun(t,o,t,i.nodeValue)}}else this.processParagraph(i,e,s);i=i.nextSibling}else if(t.hasClass("doc_layout_filetext"))this.processFiletext(t,e,s);else if("p"===t.tagName.toLowerCase()||(r||this.options.divAsP)&&"div"===t.tagName.toLowerCase())this.processParagraph(t,e,s);else if("hr"===t.tagName.toLowerCase())this.processHr(t,e,s);else if("img"===t.tagName.toLowerCase()){o=this.createParagraphFromDom(t,e,s);this.processPic(t,o,s)}else if("table"===t.tagName.toLowerCase())this.processTable(t,e,s);else if("span"===t.tagName.toLowerCase()){if(!e||"w:p"!==e.tagName.toString().toLowerCase())e=this.createParagraphFromDom(t,e,s);this.processRun(t,e)}else this.processDom(t,e,s,r);t=t.getNext()}},processFiletext:function(t,e,s){for(node=t.getFirst();node;){if("div"===node.tagName.toLowerCase()||"p"===node.tagName.toLowerCase())this.processParagraph(node,e,s);else if("img"===node.tagName.toLowerCase()){var r=this.createParagraphFromDom(node,e,s);this.processPic(node,r,s)}else"table"===node.tagName.toLowerCase()&&this.processTable(node,e,s);node=node.getNext()}},isEmptyP:function(t){var e=t.querySelector("t"),s=t.querySelector("drawing");return!e&&!s},processParagraphRun:function(t,e,s,r,i,o){for(t=t.firstChild;t;)t.nodeType===Node.TEXT_NODE?t.nodeValue.trim()&&this.processRun(t.parentElement||t.parentNode,e,s,t.nodeValue):t.nodeType===Node.ELEMENT_NODE?"span"===t.tagName.toLowerCase()?this.processRun(t,e,s):"br"===t.tagName.toLowerCase()?this.processRun(t,e,s,"","br"):"div"===t.tagName.toLowerCase()||"p"===t.tagName.toLowerCase()?(this.isEmptyP(e)?this.setParagraphAttrFromDom(t,e):e=this.createParagraphFromDom(t,r,i),this.processParagraphRun(t,e,s,r,i,o)):"ul"===t.tagName.toLowerCase()||"ol"===t.tagName.toLowerCase()?this.processNumbering(t,e,s,r,i,o):"table"===t.tagName.toLowerCase()?(this.processTable(t,r),this.isEmptyP(e)&&e.destroy(),e=this.createParagraphFromDom(s,r,i)):"img"===t.tagName.toLowerCase()?(this.processPic(t,e,i),this.isEmptyP(e)&&e.destroy(),e=this.createParagraphFromDom(s,r,i)):this.processParagraphRun(t,e,s,r,i,o):this.processParagraphRun(t,e,s,r,i,o),t=t.nextSibling},processNumbering:function(t,e,s,r,i,o){for(var a=(o=o||0)+1,n="ul"===t.tagName.toLowerCase()?"1":"2",c=t.getChildren("li"),l=0;l<c.length;l++){var h=c[l];this.isEmptyP(e)||(e=this.createParagraphFromDom(h,r,i));var p=e.querySelector("pPr");p||(p=this.createEl(r.ownerDocument,"pPr"),e.appendChild(p)),oo_numPr=this.createEl(r.ownerDocument,"numPr"),oo_ilvl=this.createEl(r.ownerDocument,"ilvl"),this.setAttrs(oo_ilvl,{val:o}),oo_numId=this.createEl(r.ownerDocument,"numId"),this.setAttrs(oo_numId,{val:n}),oo_numPr.appendChild(oo_ilvl),oo_numPr.appendChild(oo_numId),p.appendChild(oo_numPr),this.processParagraphRun(h,e,h,r,i,a)}},getPPrs:function(t){var e,s,r,i={},o=t.getStyle("text-align");if(o){var a="start";switch(o){case"center":a="center";break;case"right":case"end":a="end";break;case"justify":a="both"}i.jc={val:a}}(e=t.getStyle("margin-left"))&&e.toFloat()&&((e=20*this.pxToPt(e))&&(i.ind||(i.ind={}),i.ind.left=e));(s=t.getStyle("margin-left"))&&s.toFloat()&&((s=20*this.pxToPt(s))&&(i.ind||(i.ind={}),i.ind.right=s));(r=t.getStyle("text-indent"))&&r.toFloat()&&((r=20*this.pxToPt(r))&&(i.ind||(i.ind={}),r>0?i.ind.firstLine=r:i.ind.hanging=Math.abs(r)));var n=t.getStyle("page-break-after");return n&&"avoid"==n.toString().toLowerCase()&&(i.keepNext={}),i},setParagraphAttrFromDom:function(t,e){var s=this.getPPrs(t),r=e.querySelector("pPr");r||(r=this.createEl(e.ownerDocument,"pPr"),e.appendChild(r)),Object.keys(s).each(function(t){var i=r.querySelector(t);i||(i=this.createEl(e.ownerDocument,t)),this.setAttrs(i,s[t]),r.appendChild(i)}.bind(this))},createParagraphFromDom:function(t,e,s){var r=this.createParagraph(e.ownerDocument,{pPrs:this.getPPrs(t)});if(s)e.appendChild(r);else{var i=this.getEl(e,"sectPr");i?this.insertSiblings(i,[r],"beforebegin"):this.insertChildren(e,[r])}return r},processParagraph:function(t,e,s){var r=this.createParagraphFromDom(t,e,s);return this.processParagraphRun(t,r,t,e,s),this.isEmptyP(r)&&r.destroy(),r},getTableTblW:function(t){var e="dxa",s=t.style.width;if(s||(s=t.get("width")),s&&"string"===o2.typeOf(s)){var r=s.substring(s.length-1,s.length);"%"===r?(s=50*s.toFloat(),e="pct"):"pt"!==(r=s.substring(s.length-2,s.length)).toLowerCase()&&(s=this.pxToPt(s))}return s&&s.toFloat()?"dxa"===e&&(s=20*s.toFloat()):(s=0,e="auto"),{w:s,type:e}},getTableBorder:function(t,e){var s,r={space:"0",val:"single",color:"auto",sz:"0"},i=t.currentStyle?t.currentStyle[("border-"+e+"-style").camelCase()]:t.getStyle("border-"+e);i&&"none"!==i?(s=t.currentStyle?t.currentStyle[("border-"+e+"-width").camelCase()]:t.getStyle("border-"+e+"-width"))&&s.toFloat()||(s=t.get("border")):(s=t.get("border"))&&"none"!==s||(s=t.getStyle("border-"+e+"-width")),s&&"string"===o2.typeOf(s)&&(u=s.substring(s.length-2,s.length),"pt"!==u.toLowerCase()&&(s=this.pxToPt(s))),s&&s.toFloat()||(s=0),r.sz=8*s.toFloat(),"firefox"==Browser.name&&(r.sz=1.25*r.sz);var o=this.getColorHex(t.currentStyle?t.currentStyle[("border-"+e+"-color").camelCase()]:t.getStyle("border-"+e+"-color"));switch(o||(o="auto"),r.color=o,t.currentStyle?t.currentStyle[("border-"+e+"-style").camelCase()]:t.getStyle("border-"+e+"-style")){case"dashed":case"dotted":case"double":r.val="double";break;default:r.val="single"}0===r.sz&&(r.val="none");var a=t.get("cellspacing");return a&&(r.space=this.pxToPt(a)),r},getTableTblGrid:function(t){for(var e=[],s=t.rows,r=0;r<s.length;r++){var i=0;tds=s[r].cells;for(var o=0;o<tds.length;o++){var a=tds[o],n=a.get("colspan");if(n&&1!==n.toInt()){for(var c=n.toInt()-1,l=[],h=0;h<c;h++)l.push(new Element("td").inject(a,"after"));for(;e.length<=i;)e.push(0);(p=this.pxToPt(a.clientWidth))>e[i]&&(e[i]=p),l.each(function(t){for(i++;e.length<=i;)e.push(0);var s=this.pxToPt(t.clientWidth);s>e[i]&&(e[i]=s)}.bind(this)),l.each((function(t){t.destroy()}))}else{for(;e.length<=i;)e.push(0);var p;(p=this.pxToPt(a.clientWidth))>e[i]&&(e[i]=p)}i++}}return e},getTdValign:function(t){var e="",s=t.getStyle("vertical-align")||t.get("valign");if(s)switch(s){case"bottom":e="bottom";break;case"top":e="top";break;default:e="center"}return e},getMsoStyle:function(t){var e={},s=t.getAttribute("style");s&&s.split(/\s*;\s*/g).map((function(t){var s=t.split(/\s*:\s*/g);return 2===s.length&&"mso"===s[0].substr(0,3).toLowerCase()&&(e[s[0]]=s[1]),!1}));return e},processTableDom:function(t,e,s,r,i){for(t=t.firstChild;t;){if(t.nodeType===Node.ELEMENT_NODE)if(t.hasClass("doc_layout_filetext"))this.processFiletext(t,e,s);else if("p"===t.tagName.toLowerCase()||(r||this.options.divAsP)&&"div"===t.tagName.toLowerCase())this.processParagraph(t,e,s);else if("br"===t.tagName.toLowerCase())this.processRun(t,e,s,"","br");else if("hr"===t.tagName.toLowerCase())this.processHr(t,e,s);else if("img"===t.tagName.toLowerCase()){if(!e||"w:p"!==e.tagName.toString().toLowerCase())e=this.createParagraphFromDom(t,e,t.parentElement);this.processPic(t,e,s)}else if("table"===t.tagName.toLowerCase())this.processTable(t,e,s);else if("span"===t.tagName.toLowerCase()){if(!e||"w:p"!==e.tagName.toString().toLowerCase())e=this.createParagraphFromDom(t,e,t.parentElement);this.processRun(t,e,s)}else this.processTableDom(t,e,s,r);else if(t.nodeType===Node.TEXT_NODE){if(t.nodeValue.trim()){if(!e||"w:p"!==e.tagName.toString().toLowerCase())e=this.createParagraphFromDom(t.parentElement||t.parentNode,e,t.parentElement);this.processRun(t.parentElement||t.parentNode,e,s,t.nodeValue)}}else this.processTableDom(t,e,s);t=t.nextSibling}},arrangeTable:function(t){for(var e=[],s=t.rows,r={},i=0;i<s.length;i++){e[i]=[];for(var o=0,a=r[o];a&&a.count;)a.count--,e[i].push({td:a.td,type:0}),a.count<1&&delete r[o],a=r[++o];for(var n=s[i].cells,c=0;c<n.length;c++){var l=n[c];e[i].push({td:l,type:1});var h=l.get("rowspan");h&&h.toInt()>1&&(r[o]={td:l,count:h.toInt()-1});var p=l.get("colspan");if(p&&p.toInt()>1)for(var d=1;d<p.toInt();d++)e[i].push({td:l,type:0});var m=o+1;for(a=r[m];a&&a.count;)a.count--,e[i].push({td:a.td,type:0}),a.count<1&&delete r[m],a=r[++m];if(p&&p.toInt()>1&&r[o]){r[o].count=r[o].count*p.toInt();for(d=1;d<p.toInt();d++)r[o+d]=r[o]}o=m-1,o++}}var f=e.length;if(f>0)for(var g=e[0].length,u=0;u<g;u++){for(var w=0,v=0;v<f;v++)if(0!==e[v][u].type){w=1;break}if(0===w)for(v=0;v<f;v++)if(v==e[v][u].td.getParent("tr").rowIndex&&e[v][u].td){var b=e[v][u].td.get("colspan");b=b.toInt()-1,e[v][u].td.set("colspan",b)}}},processTable:function(t,e,s){this.arrangeTable(t);var r=e.ownerDocument,i=this.createEl(r,"tbl"),o=this.createEl(r,"tblPr"),a=this.createEl(r,"tblW"),n=this.getTableTblW(t);this.setAttrs(a,n),o.appendChild(a);var c=this.createEl(r,"tblBorders"),l=this.createEl(r,"top");this.setAttrs(l,this.getTableBorder(t,"top"));var h=this.createEl(r,"start");this.setAttrs(h,this.getTableBorder(t,"left"));var p=this.createEl(r,"bottom");this.setAttrs(p,this.getTableBorder(t,"bottom"));var d=this.createEl(r,"end");this.setAttrs(d,this.getTableBorder(t,"right")),this.insertSiblings(c,[l,h,p,d],"beforeend"),o.appendChild(c);var m=t.get("cellpadding").toFloat();m||(m=0),m=20*this.pxToPt(m);var f=t.getStyle("padding-left"),g=t.getStyle("padding-right"),u=t.getStyle("padding-top"),w=t.getStyle("padding-bottom");f=f?20*this.pxToPt(f):0,g=g?20*this.pxToPt(g):0,u=u?20*this.pxToPt(u):0,w=w?20*this.pxToPt(w):0;var v=this.createEl(r,"tblCellMar"),b=this.createEl(r,"start");this.setAttrs(b,{type:"dxa",w:f||m}),v.appendChild(b),b=this.createEl(r,"end"),this.setAttrs(b,{type:"dxa",w:g||m}),v.appendChild(b),b=this.createEl(r,"top"),this.setAttrs(b,{type:"dxa",w:u||m}),v.appendChild(b),b=this.createEl(r,"bottom"),this.setAttrs(b,{type:"dxa",w:w||m}),v.appendChild(b),o.appendChild(v);var x=t.get("align");if(x){var C="start";switch(x){case"center":C="center";break;case"right":case"end":C="end";break;case"justify":C="both"}var E=this.createEl(r,"jc");this.setAttrs(E,{val:C}),o.appendChild(E)}var y=!1,P=this.getMsoStyle(t),A=P["mso-table-anchor-horizontal"],S=P["mso-table-anchor-vertical"],T=P["mso-table-left"],F=P["mso-table-top"];if(A||S||T||F){A&&"page"!==A&&"margin"!==A&&"text"!==A&&(A="margin"),S&&"page"!==S&&"margin"!==S&&"text"!==S&&(S="margin");var N={horzAnchor:A||null,vertAnchor:S||null,tblpXSpec:T||null,tblpYSpec:F||null},D=this.createEl(r,"tblpPr");this.setAttrs(D,N),o.appendChild(D),y=!0}if((rt=t.getStyle("background-color"))&&"transparent"!==rt){rt=this.getColorHex(rt);var L=this.createEl(r,"shd");this.setAttrs(L,{val:"clear",color:"auto",fill:rt}),o.appendChild(L)}i.appendChild(o);var R=this.getTableTblGrid(t),z=this.createEl(r,"tblGrid");R.each(function(t){var e=this.createEl(r,"gridCol");t&&this.setAttrs(e,{w:20*t}),z.appendChild(e)}.bind(this)),i.appendChild(z);for(var k={},O=t.rows,I=0;I<O.length;I++){var _=O[I],M=this.createEl(r,"tr");if(y){var j=this.createEl(r,"trPr"),H=this.createEl(r,"cantSplit"),W=this.createEl(r,"tblHeader");j.appendChild(H),j.appendChild(W),M.appendChild(j)}for(var B=0,X=k["td"+(gt=B)];X;){k["td"+gt].idx--;var V=k["td"+gt].tcPr,G=this.createEl(r,"tc");if(V){(U=(q=V.cloneNode(!0)).querySelector("vMerge"))&&U.destroy(),U=this.createEl(r,"vMerge"),q.appendChild(U),G.appendChild(q)}else{var q=this.createEl(r,"tcPr"),U=this.createEl(r,"vMerge");q.appendChild(U),G.appendChild(q)}var Z=this.createEl(r,"p");G.appendChild(Z),M.appendChild(G),k["td"+gt].idx<1&&delete k["td"+gt],B++,X=k["td"+ ++gt]}for(var J=_.cells,Y=0;Y<J.length;Y++){var $=J[Y],K=this.createEl(r,"tc"),Q=this.createEl(r,"tcPr"),tt=this.createEl(r,"tcW"),et=this.getTableTblW($);this.setAttrs(tt,et),Q.appendChild(tt);var st=this.createEl(r,"tcBorders");l=this.createEl(r,"top");this.setAttrs(l,this.getTableBorder($,"top"));h=this.createEl(r,"start");this.setAttrs(h,this.getTableBorder($,"left"));p=this.createEl(r,"bottom");this.setAttrs(p,this.getTableBorder($,"bottom"));var rt;d=this.createEl(r,"end");if(this.setAttrs(d,this.getTableBorder($,"right")),this.insertSiblings(st,[l,h,p,d],"beforeend"),Q.appendChild(st),(rt=$.getStyle("background-color"))&&"transparent"!==rt){rt=this.getColorHex(rt);L=this.createEl(r,"shd");this.setAttrs(L,{val:"clear",color:"auto",fill:rt}),Q.appendChild(L)}f=$.getStyle("padding-left"),g=$.getStyle("padding-right"),u=$.getStyle("padding-top"),w=$.getStyle("padding-bottom");f=f?20*this.pxToPt(f):0,g=g?20*this.pxToPt(g):0,u=u?20*this.pxToPt(u):0,w=w?20*this.pxToPt(w):0;var it=this.createEl(r,"tcMar");b=this.createEl(r,"start");this.setAttrs(b,{type:"dxa",w:f}),it.appendChild(b),b=this.createEl(r,"end"),this.setAttrs(b,{type:"dxa",w:g}),it.appendChild(b),b=this.createEl(r,"top"),this.setAttrs(b,{type:"dxa",w:u}),it.appendChild(b),b=this.createEl(r,"bottom"),this.setAttrs(b,{type:"dxa",w:w}),it.appendChild(b),Q.appendChild(it);var ot=this.getTdValign($);if(ot){var at=this.createEl(r,"vAlign");this.setAttrs(at,{val:ot}),Q.appendChild(at)}var nt=this.createEl(r,"hideMark");Q.appendChild(nt);var ct=$.get("rowspan");if(ct&&ct.toInt()>1){k["td"+B]={tcPr:Q,idx:ct.toInt()-1};var lt=this.createEl(r,"vMerge");this.setAttrs(lt,{val:"restart"}),Q.appendChild(lt)}var ht=$.get("colspan");if(ht&&ht.toInt()>1){B+=ht.toInt()-1;var pt=this.createEl(r,"gridSpan");this.setAttrs(pt,{val:ht}),Q.appendChild(pt)}K.appendChild(Q),this.processTableDom($,K,$,!0,K);for(var dt=!1,mt=K.firstChild;mt;){if("w:p"===mt.tagName){dt=!0;break}mt=mt.nextSibling}if(!dt){var ft=this.createEl(r,"p");K.appendChild(ft)}M.appendChild(K);var gt;for(X=k["td"+(gt=B+1)];X;){k["td"+gt].idx--;V=k["td"+gt].tcPr,G=this.createEl(r,"tc");if(V){(U=(q=V.cloneNode(!0)).querySelector("vMerge"))&&U.destroy(),U=this.createEl(r,"vMerge"),q.appendChild(U),G.appendChild(q)}else{q=this.createEl(r,"tcPr"),U=this.createEl(r,"vMerge");q.appendChild(U),G.appendChild(q)}Z=this.createEl(r,"p");G.appendChild(Z),M.appendChild(G),k["td"+gt].idx<1&&delete k["td"+gt],X=k["td"+ ++gt]}if(ht&&ht.toInt()>1&&k["td"+B]){k["td"+B].idx=k["td"+B].idx*ht.toInt();for(var ut=1;ut<ht.toInt();ut++){ct[B+ut]=k["td"+B]}}B=gt-1,B++}i.appendChild(M)}if(s)e.appendChild(i);else{var wt=this.getEl(e,"sectPr");wt?this.insertSiblings(wt,[i],"beforebegin"):this.insertChildren(e,[i])}},pxToPt:function(t){var e=t;return t&&"string"===o2.typeOf(t)?(u=t.substring(t.length-2,t.length),e="pt"!==u.toLowerCase()?t.toFloat()/this.dpi*72:t.toFloat()):e=t.toFloat()/this.dpi*72,e},setPics:function(t){this.pics&&this.pics.length||(this.pics=[]),this.pics.push(t.src)},processPic:function(t,e,s){if(!t.src)return"";this.setPics(t);var r=this.rid;this.rid++;var i,o=e.ownerDocument,a=this.createRun(o,{rPrs:{noProof:{}}}),n=this.createEl(o,"drawing"),c=t.getStyle("position");if("anchor"===("absolute"===c||"fixed"===c?"anchor":"inline")){var l=t.getPosition();positionH=(9525*l.x).toInt(),positionV=(9525*l.y).toInt();var h=this.createEl(o,"anchor","wp");this.setAttrs(h,{distT:"0",distB:"0",distL:"0",distR:"0",simplePos:"false",behindDoc:"false",relativeHeight:"500",locked:"false",layoutInCell:"true",allowOverlap:"false"},!1),a.appendChild(n),n.appendChild(h);var p=this.createEl(o,"simplePos","wp");this.setAttrs(p,{x:"0",y:"0"},!1);var d=this.createEl(o,"positionH","wp");this.setAttrs(d,{relativeFrom:"margin"},!1),(m=this.createEl(o,"posOffset","wp")).appendChild(o.createTextNode(positionH)),d.appendChild(m);var m,f=this.createEl(o,"positionV","wp");this.setAttrs(f,{relativeFrom:"margin"},!1),(m=this.createEl(o,"posOffset","wp")).appendChild(o.createTextNode(positionV)),f.appendChild(m),i=h,this.insertSiblings(i,[p,d,f],"beforeend")}else{var g=this.createEl(o,"inline","wp");this.setAttrs(g,{distT:"0",distB:"0",distL:"0",distR:"0"},!1),a.appendChild(n),n.appendChild(g),i=g}var u=this.createEl(o,"extent","wp"),w=12700*this.pxToPt(t.clientWidth),v=12700*this.pxToPt(t.clientHeight);this.setAttrs(u,{cx:w,cy:v},!1);var b=this.createEl(o,"effectExtent","wp");this.setAttrs(b,{l:"0",t:"0",r:"0",b:"0"},!1);var x=this.createEl(o,"wrapNone","wp"),C=this.createEl(o,"docPr","wp");id=(100*Math.random()).toInt(),this.setAttrs(C,{id:id,name:"PIC"+id},!1);var E=this.createEl(o,"cNvGraphicFramePr","wp"),y=this.createEl(o,"graphicFrameLocks","a");this.setAttrs(y,{noChangeAspect:"1"},!1),E.appendChild(y),this.insertSiblings(i,[u,b,x,C,E],"beforeend");var P=this.createEl(o,"graphic","a"),A=this.createEl(o,"graphicData","a");this.setAttrs(A,{uri:"http://schemas.openxmlformats.org/drawingml/2006/picture"},!1);var S=this.createEl(o,"pic","pic");this.insertChildren(i,[P,A,S],"beforeend");var T=this.createEl(o,"nvPicPr","pic"),F=this.createEl(o,"cNvPr","pic");this.setAttrs(F,{id:id,name:"PIC"+id},!1);var N=this.createEl(o,"cNvPicPr","pic");T.appendChild(F),T.appendChild(N),S.appendChild(T);var D=this.createEl(o,"blipFill","pic"),L=this.createEl(o,"blip","a");this.setAttrs(L,{embed:"rId"+r},"r"),this.setAttrs(L,{cstate:"print"},!1);var R=this.createEl(o,"extLst","a"),z=this.createEl(o,"ext","a");this.setAttrs(z,{uri:"{28A0092B-C50C-407E-A947-70E740481C1C}"},!1);var k=this.createEl(o,"useLocalDpi","a14");this.setAttrs(k,{val:"0"},!1),z.appendChild(k),R.appendChild(z),L.appendChild(R),D.appendChild(L);var O=this.createEl(o,"stretch","a"),I=this.createEl(o,"fillRect","a");O.appendChild(I),D.appendChild(O),S.appendChild(D);var _=this.createEl(o,"spPr","pic"),M=this.createEl(o,"xfrm","a"),j=this.createEl(o,"off","a");this.setAttrs(j,{x:"0",y:"0"},!1);z=this.createEl(o,"ext","a");this.setAttrs(z,{cx:w,cy:v},!1),M.appendChild(j),M.appendChild(z),_.appendChild(M);var H=this.createEl(o,"prstGeom","a");this.setAttrs(H,{prst:"rect"},!1);var W=this.createEl(o,"avLst","a");H.appendChild(W),_.appendChild(H),S.appendChild(_),e.appendChild(a)},processHr:function(t,e,s){var r=e.ownerDocument,i=this.createParagraph(r,{});if(s)e.appendChild(i);else{var o=this.getEl(e,"sectPr");o?this.insertSiblings(o,[i],"beforebegin"):this.insertChildren(e,[i])}var a=this.createRun(r,{rPrs:{noProof:{}}}),n=this.createEl(r,"drawing"),c=this.createEl(r,"anchor","wp");this.setAttrs(c,{distT:"0",distB:"0",distL:"0",distR:"0",simplePos:"false",behindDoc:"false",relativeHeight:"500",locked:"false",layoutInCell:"true",allowOverlap:"false"},!1),a.appendChild(n),n.appendChild(c);var l=this.createEl(r,"simplePos","wp");this.setAttrs(l,{x:"0",y:"0"},!1);var h=this.createEl(r,"positionH","wp");this.setAttrs(h,{relativeFrom:"column"},!1),(p=this.createEl(r,"posOffset","wp")).appendChild(r.createTextNode("0")),h.appendChild(p);var p,d=this.createEl(r,"positionV","wp");this.setAttrs(d,{relativeFrom:"paragraph"},!1),(p=this.createEl(r,"posOffset","wp")).appendChild(r.createTextNode("161290")),d.appendChild(p);var m=this.createEl(r,"extent","wp"),f=12700*this.pxToPt(t.clientWidth);this.setAttrs(m,{cx:f,cy:"0"},!1);var g=this.createEl(r,"effectExtent","wp");this.setAttrs(g,{l:"0",t:"0",r:"0",b:"0"},!1);var u=this.createEl(r,"wrapNone","wp"),w=this.createEl(r,"docPr","wp");id=(100*Math.random()).toInt(),this.setAttrs(w,{id:id,name:"Red Line"},!1);var v=this.createEl(r,"cNvGraphicFramePr","wp");this.insertSiblings(c,[l,h,d,m,g,u,w,v],"beforeend");var b=this.createEl(r,"graphic","a"),x=this.createEl(r,"graphicData","a");this.setAttrs(x,{uri:"http://schemas.microsoft.com/office/word/2010/wordprocessingShape"},!1);var C=this.createEl(r,"wsp","wps");this.insertChildren(c,[b,x,C],"beforeend");var E=this.createEl(r,"cNvCnPr","wps"),y=this.createEl(r,"spPr","wps"),P=this.createEl(r,"xfrm","a"),A=this.createEl(r,"off","a");this.setAttrs(A,{x:"0",y:"0"},!1);var S=this.createEl(r,"ext","a");this.setAttrs(S,{cx:f,cy:"0"},!1),this.insertSiblings(P,[A,S],"beforeend");var T=this.createEl(r,"prstGeom","a");this.setAttrs(T,{prst:"line"},!1);var F=this.createEl(r,"avLst","a");T.appendChild(F);var N=this.createEl(r,"ln","a"),D=12700*this.pxToPt(t.clientHeight);this.setAttrs(N,{w:D},!1);var L=this.createEl(r,"solidFill","a"),R=this.createEl(r,"srgbClr","a"),z=this.getColorHex(t.get("color"));z||(z=this.getColorHex(t.getStyle("background-color"))),z||(z="FF0000"),this.setAttrs(R,{val:z},!1),L.appendChild(R),N.appendChild(L),this.insertSiblings(y,[P,T,N],"beforeend");var k=this.createEl(r,"style","wps"),O=this.createEl(r,"lnRef","a");this.setAttrs(O,{idx:"1"},!1);var I=this.createEl(r,"schemeClr","a");this.setAttrs(I,{val:"accent1"},!1),O.appendChild(I);var _=this.createEl(r,"fillRef","a");this.setAttrs(_,{idx:"0"},!1);I=this.createEl(r,"schemeClr","a");this.setAttrs(I,{val:"accent1"},!1),_.appendChild(I);var M=this.createEl(r,"effectRef","a");this.setAttrs(M,{idx:"0"},!1);I=this.createEl(r,"schemeClr","a");this.setAttrs(I,{val:"accent1"},!1),M.appendChild(I);var j=this.createEl(r,"fontRef","a");this.setAttrs(j,{idx:"minor"},!1);I=this.createEl(r,"schemeClr","a");this.setAttrs(I,{val:"tx1"},!1),j.appendChild(I),this.insertSiblings(k,[O,_,M,j],"beforeend");var H=this.createEl(r,"bodyPr","wps");this.insertSiblings(C,[E,y,k,H],"beforeend"),i.appendChild(a)},processRunFont:function(t,e,s){var r=this.getMsoStyle(t);r["mso-font-width"]&&(e.w={val:r["mso-font-width"].toFloat()}),r["mso-ansi-font-size"]&&(e.sz={val:2*this.parseFontSize(r["mso-ansi-font-size"])}),r["mso-hansi-font-size"]&&(e.sz={val:2*this.parseFontSize(r["mso-hansi-font-size"])}),r["mso-font-size"]&&(e.sz={val:2*this.parseFontSize(r["mso-font-size"])}),r["mso-fareast-font-size"]&&(e.sz={val:2*this.parseFontSize(r["mso-fareast-font-size"])}),r["mso-ansi-font-family"]&&(s||(s={hint:"eastAsia"}),s.ascii=this.parseFont(r["mso-ansi-font-family"])),r["mso-hansi-font-family"]&&(s||(s={hint:"eastAsia"}),s.hAnsi=this.parseFont(r["mso-hansi-font-family"])),r["mso-font-family"]&&(s||(s={hint:"eastAsia"}),s.eastAsia=this.parseFont(r["mso-font-family"])),r["mso-fareast-font-family"]&&(s||(s={hint:"eastAsia"}),s.eastAsia=this.parseFont(r["mso-fareast-font-family"]))},parseFont:function(t){return'"'===t.substr(0,1)?t.substr(1,t.length-2):t},parseFontSize:function(t){var e=t;return e&&"string"===o2.typeOf(e)&&(u=e.substring(e.length-2,e.length),"pt"!==u.toLowerCase()&&(e=Math.round(this.pxToPt(e)))),e.toFloat()},processRun:function(t,e,s,r,i){for(var o={noProof:{}},a=null,n=t.getStyles("font-size","color","letter-spacing","font-weight","font-family"),c=Object.keys(n),l=0;l<c.length;l++)switch(c[l]){case"font-size":o.sz={val:2*this.parseFontSize(n["font-size"])};break;case"color":o.color={val:this.getColorHex(n.color)};break;case"letter-spacing":o.spacing={val:20*n["letter-spacing"].toFloat()||0};break;case"font-weight":var h=n["font-weight"];if("normal"==h.toLowerCase());else if("bold"==h.toLowerCase())o.b={val:"true"};else{h.toFloat()>=600&&(o.b={val:"true"})}break;case"font-family":var p=n["font-family"].split(/,\s*/);a={hint:"eastAsia",eastAsia:this.parseFont(p[p.length-1])},p.length>1&&(a.other=this.parseFont(p[0]))}s&&this.processRunFont(s,o,a),this.processRunFont(t,o,a);var d={rPrs:o,font:a};if(r||i){var m=this.createRun(e.ownerDocument,d);if(r){var f=this.createEl(m.ownerDocument,"t");f.appendChild(m.ownerDocument.createTextNode(r)),m.appendChild(f)}e.appendChild(m)}else this.processRunTextDom(t,e,d)},processRunSpan:function(t,e,s){for(var r=Object.clone(s.rPrs),i=Object.clone(s.font),o=t.getStyles("font-size","color","letter-spacing","font-weight","font-family"),a=Object.keys(o),n=0;n<a.length;n++)switch(a[n]){case"font-size":r.sz={val:2*this.parseFontSize(o["font-size"])};break;case"color":r.color={val:this.getColorHex(o.color)};break;case"letter-spacing":r.spacing={val:20*o["letter-spacing"].toFloat()||0};break;case"font-weight":var c=o["font-weight"];if("normal"==c.toLowerCase());else if("bold"==c.toLowerCase())r.b={val:"true"};else{c.toFloat()>=600&&(r.b={val:"true"})}break;case"font-family":var l=o["font-family"].split(/,\s*/);i||(i={}),i.hint="eastAsia",i.eastAsia=this.parseFont(l[l.length-1]),l.length>1&&(i.other=this.parseFont(l[0]))}this.processRunFont(t,r,i);s={rPrs:r,font:i};this.processRunTextDom(t,e,s)},processRunTextDom:function(t,e,s){for(var r=t.firstChild;r;){if(r.nodeType===Node.ELEMENT_NODE)if("span"===r.tagName.toLowerCase())this.processRunSpan(r,e,s);else if("br"===r.tagName.toLowerCase()){s.br="br";var i=this.createRun(e.ownerDocument,s);e.appendChild(i)}else this.processRunTextDom(r,e,s);else if(r.nodeType===Node.TEXT_NODE){i=this.createRun(e.ownerDocument,s);var o=this.createEl(e.ownerDocument,"t");o.appendChild(e.ownerDocument.createTextNode(r.nodeValue)),i.appendChild(o),e.appendChild(i)}else this.processRunTextDom(r,e,s);r=r.nextSibling}},processPageSection:function(t,e){var s=this.getOrCreateEl(e,"sectPr");if(s)for(var r=0;r<t.style.length;r++)switch(t.style[r]){case"size":var i=20*(c=t.style.size.split(/\s/))[0].toFloat(),o=20*c[1].toFloat(),a=this.getOrCreateEl(s,"pgSz");this.setAttrs(a,{w:i,h:o});break;case"margin-top":case"margin-right":case"margin-bottom":case"margin-left":var n=t.style[r].split("-")[1],c=20*t.style["margin"+n.capitalize()].toFloat(),l=this.getOrCreateEl(s,"pgMar");(d={})[n]=c,this.setAttrs(l,d);break;case"line-height":case"letter-spacing":var h=this.getOrCreateEl(s,"docGrid"),p=20*t.style.lineHeight.toFloat(),d=(t.style.letterSpacing.toFloat(),{type:"linesAndChars"});p&&(d.linePitch=p),this.setAttrs(h,d)}},getOrCreateEl:function(t,e){var s=this.getEl(t,e);return s||(s=this.createEl(t.ownerDocument,e),t.appendChild(s)),s},createParagraph:function(t,e){var s=this.createEl(t,"p"),r=this.createEl(t,"pPr");return e&&e.pPrs&&Object.keys(e.pPrs).each(function(s){var i=this.createEl(t,s);this.setAttrs(i,e.pPrs[s]),r.appendChild(i)}.bind(this)),s.appendChild(r),s},createRun:function(t,e){var s=this.createEl(t,"r"),r=this.createEl(t,"rPr");if(s.appendChild(r),e&&e.text){var i=this.createEl(t,"t");i.appendChild(t.createTextNode(e.text)),s.appendChild(i)}if(e&&e.br){var o=this.createEl(t,"br");s.appendChild(o)}if(e&&e.font){var a=this.createEl(t,"rFonts"),n={eastAsia:e.font.eastAsia||e.font.font,ascii:e.font.ascii||e.font.other||e.font.eastAsia||e.font.font,hAnsi:e.font.hAnsi||e.font.other||e.font.eastAsia||e.font.font};e.font.hint&&(n.hint=e.font.hint),this.setAttrs(a,n),r.appendChild(a)}return e&&e.rPrs&&Object.keys(e.rPrs).each(function(s){var i=this.createEl(t,s);this.setAttrs(i,e.rPrs[s]),r.appendChild(i)}.bind(this)),s},insertChildren:function(t,e,s){this.insertAdjacent(t,e,s,"beforeend")},insertSiblings:function(t,e,s){this.insertAdjacent(t,e,s,"afterend")},insertAdjacent:function(t,e,s,r){var i=s||"beforeend",o={beforebegin:"before",afterbegin:"top",beforeend:"bottom",afterend:"after"};e.each((function(e){t.insertAdjacentElement?t.insertAdjacentElement(i,e):e.inject(t,o[i]),t=e,i=r||"afterend"}))},getEl:function(t,e,s){return this.getEls(t,e,s)[0]},getEls:function(t,e,s){var r=s||"w";return t.getElementsByTagNameNS(this.nsResolver(r),e)},createEl:function(t,e,s){if(!1===s)return t.createElement(e);var r=s||"w";return t.createElementNS(this.nsResolver(r),r+":"+e)},setAttr:function(t,e,s,r){if(!1===r)t.setAttribute(e,s);else{var i=r||"w";t.setAttributeNS(this.nsResolver(i),i+":"+e,s)}},setAttrs:function(t,e,s){if(!1===s)Object.keys(e).forEach((function(s){t.setAttribute(s,e[s])}));else{var r=this.nsResolver(s||"w");Object.keys(e).forEach((function(i){t.setAttributeNS(r,(s||"w")+":"+i,e[i])}))}},nsResolver:function(t){return{w:"http://schemas.openxmlformats.org/wordprocessingml/2006/main",wpc:"http://schemas.microsoft.com/office/word/2010/wordprocessingCanvas",cx:"http://schemas.microsoft.com/office/drawing/2014/chartex",cx1:"http://schemas.microsoft.com/office/drawing/2015/9/8/chartex",cx2:"http://schemas.microsoft.com/office/drawing/2015/10/21/chartex",cx3:"http://schemas.microsoft.com/office/drawing/2016/5/9/chartex",cx4:"http://schemas.microsoft.com/office/drawing/2016/5/10/chartex",cx5:"http://schemas.microsoft.com/office/drawing/2016/5/11/chartex",cx6:"http://schemas.microsoft.com/office/drawing/2016/5/12/chartex",cx7:"http://schemas.microsoft.com/office/drawing/2016/5/13/chartex",cx8:"http://schemas.microsoft.com/office/drawing/2016/5/14/chartex",mc:"http://schemas.openxmlformats.org/markup-compatibility/2006",aink:"http://schemas.microsoft.com/office/drawing/2016/ink",am3d:"http://schemas.microsoft.com/office/drawing/2017/model3d",o:"urn:schemas-microsoft-com:office:office",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",m:"http://schemas.openxmlformats.org/officeDocument/2006/math",v:"urn:schemas-microsoft-com:vml",wp14:"http://schemas.microsoft.com/office/word/2010/wordprocessingDrawing",wp:"http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing",w10:"urn:schemas-microsoft-com:office:word",w14:"http://schemas.microsoft.com/office/word/2010/wordml",w15:"http://schemas.microsoft.com/office/word/2012/wordml",w16cex:"http://schemas.microsoft.com/office/word/2018/wordml/cex",w16cid:"http://schemas.microsoft.com/office/word/2016/wordml/cid",w16:"http://schemas.microsoft.com/office/word/2018/wordml",w16sdtdh:"http://schemas.microsoft.com/office/word/2020/wordml/sdtdatahash",w16se:"http://schemas.microsoft.com/office/word/2015/wordml/symex",wpg:"http://schemas.microsoft.com/office/word/2010/wordprocessingGroup",wpi:"http://schemas.microsoft.com/office/word/2010/wordprocessingInk",wne:"http://schemas.microsoft.com/office/word/2006/wordml",wps:"http://schemas.microsoft.com/office/word/2010/wordprocessingShape",a:"http://schemas.openxmlformats.org/drawingml/2006/main",pic:"http://schemas.openxmlformats.org/drawingml/2006/picture",a14:"http://schemas.microsoft.com/office/drawing/2010/main",rel:"http://schemas.openxmlformats.org/package/2006/relationships"}[t]||null},getColorHex:function(t){if(!t)return"";var e={black:"000000",silver:"c0c0c0",gray:"808080",white:"ffffff",maroon:"800000",red:"ff0000",purple:"800080",fuchsia:"ff00ff",green:"008000",lime:"00ff00",olive:"808000",yellow:"ffff00",navy:"000080",blue:"0000ff",teal:"008080",aqua:"00ffff",initial:"000000"};return e[t]?e[t]:"#"===t.substr(0,1)?t.replace("#",""):t.rgbToHex()||t}});