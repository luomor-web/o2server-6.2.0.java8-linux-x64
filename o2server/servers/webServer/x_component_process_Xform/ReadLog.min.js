MWF.xDesktop.requireApp("process.Xform","$Module",null,!1),MWF.xApplication.process.Xform.ReadLog=MWF.APPReadLog=new Class({Extends:MWF.APP$Module,options:{moduleEvents:["load","queryLoad","postLoad","postLoadData","postLoadLine"]},load:function(){this.node.empty(),this.json.isDelay||this.active()},active:function(){this._loadModuleEvents(),this.fireEvent("queryLoad")&&(this._queryLoaded(),this._loadUserInterface(),this._loadStyles(),this._loadDomEvents(),this._afterLoaded(),this.fireEvent("postLoad"),this.fireEvent("load"))},_loadUserInterface:function(){this.node.setStyle("-webkit-user-select","text"),this.form.app.action.getReadRecord(this.form.businessData.work.id,function(e){this.readLog=e.data,this.fireEvent("postLoadData"),this.loadReadLog()}.bind(this))},loadReadLog:function(){switch(this.json.mode){case"notShow":return"";case"script":this.loadReadLogByScript();break;default:this.loadReadLogDefault()}},loadReadLogByScript:function(){if(this.json.displayScript&&this.json.displayScript.code){var e=this.json.displayScript.code;this.readLog.each(function(t){this.form.Macro.environment.log=t,this.form.Macro.environment.list=null;var i=this.form.Macro.exec(e,this),o=o2.typeOf(i);"string"===o?this.node.appendHTML(i):"element"===o&&this.node.appendChild(i)}.bind(this))}},loadReadLogDefault:function(){var e=this.json.textStyle;this.readLog.each(function(t){if("readCompleted"==t.type){var i=e.replace(/{person}/g,o2.name.cn(t.person)).replace(/{datetime}/g,t.completedTime).replace(/{date}/g,t.completedTime.substring(.1)).replace(/{startDatetime}/g,t.startTime).replace(/{startDate}/g,t.startTime.substring(.1)).replace(/{startDatetime}/g,t.startTime).replace(/{unit}/g,o2.name.cn(t.unit)).replace(/{identity}/g,o2.name.cn(t.identity)).replace(/{activity}/g,o2.name.cn(t.activityName)).replace(/{title}/g,t.title).replace(/{opinion}/g,t.opinion);this.node.appendHTML(i)}}.bind(this))}});