MWF.xDesktop.requireApp("process.Xform","$Input",null,!1),MWF.xApplication.process.Xform.Textarea=MWF.APPTextarea=new Class({Implements:[Events],Extends:MWF.APP$Input,_loadUserInterface:function(){this._loadNode(),"show"==this.json.compute?this._setValue(this._computeValue()):this._loadValue()},_loadNode:function(){this.readonly||this.json.isReadonly?this._loadNodeRead():this._loadNodeEdit()},_loadNodeRead:function(){this.node.empty(),this.node.set({nodeId:this.json.id,MWFType:this.json.type})},_setValue:function(t){t||(t="");var e=o2.promiseAll(t).then(function(e){if("array"==o2.typeOf(e)&&(e=e[0]),this._setBusinessData(e),this.node.getFirst()&&this.node.getFirst().set("value",e||""),this.readonly||this.json.isReadonly){var i=new RegExp("\n","g"),s=new RegExp("<","g"),n=new RegExp(">","g"),o=t.replace(s,"&lt").replace(n,"&gt").replace(i,"<br/>");this.node.set("html",o)}}.bind(this),(function(){}));return this.moduleValueAG=e,e.then(function(){this.moduleValueAG=null}.bind(this),function(){this.moduleValueAG=null}.bind(this)),t},_resetNodeEdit:function(){var t=new Element("textarea",{styles:{background:"transparent",width:"100%",border:"0px"}}),e=new Element("div",{styles:{ovwrflow:"hidden",position:"relative","padding-right":"2px"}}).inject(this.node,"after");t.inject(e),this.node.destroy(),this.node=e},_loadNodeEdit:function(){this.json.preprocessing||this._resetNodeEdit();var t=this.node.getFirst();t.set(this.json.properties),this.form.json.textareaDisableResize&&t.setStyle("resize","none"),this.node.set({id:this.json.id,MWFType:this.json.type}),this.node.addEvent("change",function(){this._setBusinessData(this.getInputData()),this.fireEvent("change")}.bind(this)),this.node.getFirst().addEvent("blur",function(){this.validation()}.bind(this)),this.node.getFirst().addEvent("keyup",function(){this.validationMode()}.bind(this))},_afterLoaded:function(){this.readonly||this.loadDescription()},loadDescription:function(){if(!this.readonly&&!this.json.isReadonly&&(!this._getBusinessData()&&this.json.description)){var t=this.node.getFirst().getSize(),e=t.x-3;"no"==this.json.showIcon||this.form.json.hideModuleIcon||(e=t.x-23),this.descriptionNode=new Element("div",{styles:this.form.css.descriptionNode,text:this.json.description}).inject(this.node),this.descriptionNode.setStyles({width:e+"px",height:t.y+"px","line-height":t.y+"px"}),this.setDescriptionEvent()}},setDescriptionEvent:function(){this.descriptionNode&&("ios"===COMMON.Browser.Platform.name||COMMON.Browser.Platform.name,this.descriptionNode.addEvents({click:function(){this.descriptionNode.setStyle("display","none"),this.node.getFirst().focus()}.bind(this)}),this.node.getFirst().addEvents({focus:function(){this.descriptionNode.setStyle("display","none")}.bind(this),blur:function(){this.node.getFirst().get("value")||this.descriptionNode.setStyle("display","block")}.bind(this)}))}});