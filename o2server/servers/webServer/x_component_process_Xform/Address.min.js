MWF.xDesktop.requireApp("process.Xform","Combox",null,!1),MWF.xApplication.process.Xform.Address=MWF.APPAddress=new Class({Implements:[Events],Extends:MWF.APPCombox,options:{moduleEvents:["load","queryLoad","postLoad","commitInput","change"]},initialize:function(t,i,e){this.node=$(t),this.node.store("module",this),this.json=i,this.form=e,this.field=!0},_loadNode:function(){this.readonly||this.json.isReadonly?this._loadNodeRead():this._loadNodeEdit()},_loadNodeRead:function(){this.node.empty(),this.node.set({nodeId:this.json.id,MWFType:this.json.type})},_loadNodeEdit:function(){this.node.empty(),MWF.require(["MWF.widget.Combox","MWF.widget.PinYin"],function(){this.combox=new MWF.widget.Combox({style:"blue",onlySelect:!0,count:4,focusList:!0,onCommitInput:function(){this.fireEvent("commitInput")}.bind(this),onChange:function(t,i){var e=this.combox.values.map((function(t){return t.data||t.value}));if(i&&i.join()!==e.join()){for(;this.combox.values.length-1>t.index;)this.combox.deleteItem(this.combox.values[this.combox.values.length-1]);this.fireEvent("change")}}.bind(this),optionsMethod:this._searchOptions.bind(this)}),this.combox.intoEdit=function(t){if(this.options.count&&this.values.length>=this.options.count)return this.input&&this.input.node.hide(),!1;this.input||(this.input=new MWF.widget.Combox.Input(this,this,""),this.input.node.inject(this.node),this.input.node.setStyle("width","1px")),this.input.node.show(),this.input.setInputNodeStyles(),this.input.node.focus(),this.input.setInputPosition(),this.options.focusList&&this.input.searchItems()}}.bind(this),!1),this.combox.inject(this.node),this.node.set({id:this.json.id,MWFType:this.json.type}),this.combox.addEvent("change",function(){this.validationMode(),this.validation()&&this._setBusinessData(this.getInputData("change"))}.bind(this))},_searchOptions:function(t,i){t=t.toLowerCase();var e=this.combox.editItem?this.combox.editItem.getItemPosition():this.combox.values.length;if("province"===this.json.selectRange){if(e>0)return void(i&&i([]))}else if("city"===this.json.selectRange&&e>1)return void(i&&i([]));switch(e){case 0:o2.Actions.get("x_general_assemble_control").listProvince(function(t){var e=[];t.data.each(function(t){var i=t.name;MWF.widget.PinYin.toPY(i).toLowerCase(),MWF.widget.PinYin.toPYFirst(i).toLowerCase();e.push({text:i,value:i})}.bind(this)),i&&i(e)}.bind(this));break;case 1:var o=this.combox.getFirst();o2.Actions.get("x_general_assemble_control").listCity(o.data||o.value,function(t){var e=[];t.data.each(function(t){var i=t.name;MWF.widget.PinYin.toPY(i).toLowerCase(),MWF.widget.PinYin.toPYFirst(i).toLowerCase();e.push({text:i,value:i})}.bind(this)),i&&i(e)}.bind(this));break;case 2:var s=this.combox.getFirst(),n=s.data||s.value;o=this.combox.getFirst().getNextItem();o2.Actions.get("x_general_assemble_control").listDistrict(n,o.data||o.value,function(t){var e=[];t.data.each(function(t){var i=t.name;MWF.widget.PinYin.toPY(i).toLowerCase(),MWF.widget.PinYin.toPYFirst(i).toLowerCase();e.push({text:i,value:i})}.bind(this)),e.length&&i&&i(e)}.bind(this));break;default:i&&i([])}}});