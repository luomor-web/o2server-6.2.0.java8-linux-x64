MWF.xDesktop.requireApp("process.Xform","$Input",null,!1),MWF.xApplication.process.Xform.Textfield=MWF.APPTextfield=new Class({Implements:[Events],Extends:MWF.APP$Input,iconStyle:"textFieldIcon",_loadUserInterface:function(){this._loadNode(),"show"===this.json.compute?this._setValue(this._computeValue()):this._loadValue()},_loadNode:function(){this.readonly||this.json.isReadonly?this._loadNodeRead():this._loadNodeEdit()},loadDescription:function(){if(!this.readonly&&!this.json.isReadonly&&(!this._getBusinessData()&&this.json.description)){var t=this.node.getFirst().getSize(),e=t.x-3;"no"==this.json.showIcon||this.form.json.hideModuleIcon||COMMON.Browser.safari&&(e-=20),this.descriptionNode=new Element("div",{styles:this.form.css.descriptionNode,text:this.json.description}).inject(this.node),this.descriptionNode.setStyles({width:e+"px",height:t.y+"px","line-height":t.y+"px"}),this.setDescriptionEvent()}},setDescriptionEvent:function(){this.descriptionNode&&("ios"===COMMON.Browser.Platform.name||COMMON.Browser.Platform.name,this.descriptionNode.addEvents({click:function(){this.descriptionNode.setStyle("display","none"),this.node.getFirst().focus(),this.node.getFirst().fireEvent("click")}.bind(this)}),this.node.getFirst().addEvents({focus:function(){this.descriptionNode.setStyle("display","none")}.bind(this),blur:function(){this.node.getFirst().get("value")||this.descriptionNode.setStyle("display","block")}.bind(this)}))},_loadNodeRead:function(){this.node.empty(),this.node.set({nodeId:this.json.id,MWFType:this.json.type})},_resetNodeEdit:function(){var t=new Element("input",{styles:{background:"transparent",width:"100%",display:"block",border:"0px"}}),e=new Element("div",{styles:{overflow:"hidden",position:"relative","margin-right":"20px","padding-right":"4px"}}).inject(this.node,"after");t.inject(e),this.node.destroy(),this.node=e},_loadNodeEdit:function(){this.json.preprocessing||this._resetNodeEdit(),this.node.getFirst().set(this.json.properties),this.node.set({id:this.json.id,MWFType:this.json.type,events:{click:this.clickSelect.bind(this)}}),"no"==this.json.showIcon||this.form.json.hideModuleIcon?this.form.json.nodeStyleWithhideModuleIcon&&this.node.setStyles(this.form.json.nodeStyleWithhideModuleIcon):this.iconNode=new Element("div",{styles:this.form.css[this.iconStyle]}).inject(this.node,"before"),this.node.getFirst().addEvent("change",function(){var t=this.getInputData("change");this._setBusinessData(t),this.validationMode(),this.validation()&&(this._setBusinessData(t),this.fireEvent("change"))}.bind(this)),this.json.ANNModel&&(this.node.getFirst().addEvent("focus",function(){o2.Actions.get("x_query_assemble_surface").calculateNeural(this.json.ANNModel,this.form.businessData.work.id,function(t){var e=t.data.filter(function(t){var e=this.node.getFirst().get("value");return t.score>.1&&-1===e.indexOf(t.value)}.bind(this));e.length&&(this.modelNode||this.createModelNode(),this.modelNode.getLast().empty(),this.modelNode.show(),this.modelNode.position({relativeTo:this.node,position:"bottomLeft",edge:"upperLeft"}),e.each(function(t){new Element("div",{text:t.value,styles:this.form.css.modelItemNode}).inject(this.modelNode.getLast()).addEvents({mouseover:function(){this.setStyle("color","#0000ff")},mouseout:function(){this.setStyle("color","#a31515")},mousedown:function(t){var e=this.node.getFirst().get("value");this.node.getFirst().set("value",e?e+", "+t.target.get("text"):t.target.get("text")),this.modelNode.hide()}.bind(this)})}.bind(this)))}.bind(this))}.bind(this)),this.node.getFirst().addEvent("blur",function(){this.modelNode&&this.modelNode.hide()}.bind(this))),this.node.getFirst().addEvent("blur",function(){this.validation()}.bind(this)),this.node.getFirst().addEvent("keyup",function(){this.validationMode()}.bind(this))},createModelNode:function(){this.modelNode=new Element("div",{styles:this.form.css.modelNode}).inject(this.node,"after"),new Element("div",{styles:this.form.css.modelNodeTitle,text:MWF.xApplication.process.Xform.LP.ANNInput}).inject(this.modelNode),new Element("div",{styles:this.form.css.modelNodeContent,text:MWF.xApplication.process.Xform.LP.ANNInput}).inject(this.modelNode)},getInputData:function(){if(!this.node.getFirst())return this._getBusinessData();var t=this.node.getElement("input").get("value");if("number"==this.json.dataType){var e=t.toFloat();return isNaN(e)?0:e}return t}});