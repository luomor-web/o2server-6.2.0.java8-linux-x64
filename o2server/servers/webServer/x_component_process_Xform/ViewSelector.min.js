MWF.xDesktop.requireApp("process.Xform","$Module",null,!1),MWF.xDesktop.requireApp("process.Xform","Button",null,!1),MWF.xApplication.process.Xform.ViewSelector=MWF.APPViewSelector=new Class({Implements:[Events],Extends:MWF.xApplication.process.Xform.Button,_loadUserInterface:function(){var t=this.node.getElement("button");t||(t=new Element("button")),t.inject(this.node,"after"),this.node.destroy(),this.node=t,this.node.set({id:this.json.id,text:this.json.name||this.json.id,styles:this.form.css.buttonStyles,MWFType:this.json.type}),this.node.addEvent("click",function(){this.selectedData=null,this.selectView(function(t){this.doResult(t)}.bind(this))}.bind(this))},doResult:function(t){if("script"===this.json.result)return this.selectedData=t,this.json.selectedScript.code?this.form.Macro.exec(this.json.selectedScript.code,this):"";Object.each(this.json.selectedSetValues,function(e,i){var s="";t.each(function(t,i){Object.each(t.data,function(t,i){i===e&&(s=s?s+", "+t:t)}.bind(this))}.bind(this));var o=this.form.all[i];o&&(o.setData(s),s?o.descriptionNode&&o.descriptionNode.setStyle("display","none"):o.descriptionNode&&o.descriptionNode.setStyle("display","block"))}.bind(this))},selectCMSView:function(t){var e=this.json.cmsViewName;if(e){var i=null;this.json.filterList&&this.json.filterList.length&&(i=[],this.json.filterList.each(function(t){t.value=this.form.Macro.exec(t.code.code,this),i.push(t)}.bind(this)));var s,o={application:e.appId,viewName:e.name,isTitle:this.json.isTitle||"yes",select:this.json.select||"single",titleStyles:this.json.titleStyles,itemStyles:this.json.itemStyles,isExpand:this.json.isExpand||"no",showActionbar:"show"===this.json.actionbar,filter:i},n={},l=n.width||"800",c=n.height||"450";layout.mobile&&(s=document.body.getSize(),l=s.x,c=s.y,n.style="viewmobile"),l=l.toInt(),c=c.toInt();var a=((s=this.form.app.content.getSize()).x-l)/2,h=(s.y-c)/2;a<0&&(a=0),h<0&&(h=0),layout.mobile&&(a=20,h=0);var r=this;MWF.require("MWF.xDesktop.Dialog",function(){var e=new MWF.xDesktop.Dialog({title:this.json.title||"select view",style:n.style||"view",top:h,left:a-20,fromTop:h,fromLeft:a-20,width:l,height:c,html:"<div></div>",maskNode:this.form.app.content,container:this.form.app.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){t&&t(r.view.getData()),this.close()}},{text:MWF.LP.process.button.cancel,action:function(){this.close()}}]});if(e.show(),layout.mobile){var i=e.node.getElement(".MWF_dialod_Action_back"),s=e.node.getElement(".MWF_dialod_Action_ok");i&&i.addEvent("click",function(t){e.close()}.bind(this)),s&&s.addEvent("click",function(i){t&&t(this.view.getData()),e.close()}.bind(this))}MWF.xDesktop.requireApp("process.Application","Viewer",function(){this.view=new MWF.xApplication.process.Application.Viewer(e.content,o,{actions:{lookup:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}/execute",method:"PUT"},getView:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}"}},actionRoot:"x_cms_assemble_control"})}.bind(this))}.bind(this))}},selectProcessView:function(t){var e=this.json.processViewName;if(e){var i=null;this.json.filterList&&this.json.filterList.length&&(i=[],this.json.filterList.each(function(t){t.value=this.form.Macro.exec(t.code.code,this),i.push(t)}.bind(this)));var s,o={application:e.application,viewName:e.name,isTitle:this.json.isTitle||"yes",select:this.json.select||"single",titleStyles:this.json.titleStyles,itemStyles:this.json.itemStyles,isExpand:this.json.isExpand||"no",showActionbar:"show"===this.json.actionbar,filter:i},n={},l=n.width||"800",c=n.height||"600";layout.mobile&&(s=document.body.getSize(),l=s.x,c=s.y,n.style="viewmobile"),l=l.toInt(),c=c.toInt();var a=((s=this.form.app.content.getSize()).x-l)/2,h=(s.y-c)/2;a<0&&(a=0),h<0&&(h=0),layout.mobile&&(a=20,h=0);var r=this;MWF.require("MWF.xDesktop.Dialog",function(){var e=new MWF.xDesktop.Dialog({title:this.json.title||"select view",style:n.style||"view",top:h,left:a-20,fromTop:h,fromLeft:a-20,width:l,height:c,html:"",maskNode:this.form.app.content,container:this.form.app.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){t&&t(r.view.getData()),this.close()}},{text:MWF.LP.process.button.cancel,action:function(){this.close()}}]});if(e.show(),layout.mobile){var i=e.node.getElement(".MWF_dialod_Action_back"),s=e.node.getElement(".MWF_dialod_Action_ok");i&&i.addEvent("click",function(t){e.close()}.bind(this)),s&&s.addEvent("click",function(i){t&&t(this.view.getData()),e.close()}.bind(this))}MWF.xDesktop.requireApp("process.Application","Viewer",function(){this.view=new MWF.xApplication.process.Application.Viewer(e.content,o)}.bind(this))}.bind(this))}},selectQueryView:function(t){var e=this.json.queryView;if(e){var i=null;this.json.filterList&&this.json.filterList.length&&(i=[],this.json.filterList.each(function(t){t.value=this.form.Macro.exec(t.code.code,this),i.push(t)}.bind(this)));var s={application:e.appName,viewName:e.name,viewId:e.id,isTitle:this.json.isTitle||"yes",select:this.json.select||"single",titleStyles:this.json.titleStyles,itemStyles:this.json.itemStyles,isExpand:this.json.isExpand||"no",showActionbar:"show"===this.json.actionbar,filter:i,defaultSelectedScript:this.json.defaultSelectedScript?this.json.defaultSelectedScript.code:null,selectedAbleScript:this.json.selectedAbleScript?this.json.selectedAbleScript.code:null},o={},n=this.json.DialogWidth||"850",l=this.json.DialogHeight||"700";if(layout.mobile){var c=document.body.getSize();n=c.x,l=c.y,o.style="viewmobile"}n=n.toInt(),l=l.toInt();var a=((c=this.form.app.content.getSize()).x-n)/2,h=(c.y-l)/2;a<0&&(a=0),h<0&&(h=0),layout.mobile&&(a=20,h=0);var r=this;MWF.require("MWF.xDesktop.Dialog",function(){var e=new MWF.xDesktop.Dialog({title:this.json.title||"select view",style:o.style||"view",top:h,left:a-20,fromTop:h,fromLeft:a-20,width:n,height:l,html:"",maskNode:layout.mobile?$(document.body):this.form.app.content,container:layout.mobile?$(document.body):this.form.app.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){t&&t(r.view.getData()),this.close()}},{text:MWF.LP.process.button.cancel,action:function(){this.close()}}],onPostShow:function(){layout.mobile&&e.node.setStyle("z-index",200),MWF.xDesktop.requireApp("query.Query","Viewer",function(){this.view=new MWF.xApplication.query.Query.Viewer(e.content,s,{style:"select"},this.form.app,this.form.Macro)}.bind(this))}.bind(this)});if(e.show(),layout.mobile){var i=e.node.getElement(".MWF_dialod_Action_back"),c=e.node.getElement(".MWF_dialod_Action_ok");i&&i.addEvent("click",function(t){e.close()}.bind(this)),c&&c.addEvent("click",function(i){t&&t(this.view.getData()),e.close()}.bind(this))}}.bind(this))}},selectView:function(t){this.json.queryView?this.selectQueryView(t):"cms"===this.json.selectViewType?this.selectCMSView(t):this.selectProcessView(t)}});