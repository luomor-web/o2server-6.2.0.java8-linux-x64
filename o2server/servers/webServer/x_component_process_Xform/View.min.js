MWF.xDesktop.requireApp("process.Xform","$Module",null,!1),MWF.xApplication.process.Xform.View=MWF.APPView=new Class({Extends:MWF.APP$Module,options:{moduleEvents:["load","beforeLoadView","loadView","queryLoad","postLoad","select","openDocument"]},_loadUserInterface:function(){MWF.xDesktop.requireApp("query.Query","Viewer",null,!1),this.node.empty()},_afterLoaded:function(){this.json.queryView?this.loadView():"cms"===this.json.selectViewType?this.loadCMSView():"process"===this.json.selectViewType?this.loadPrcessView():this.loadView()},reload:function(){this.view&&(this.view.loadViewRes&&this.view.loadViewRes.res&&this.view.loadViewRes.res.isRunning()&&this.view.loadViewRes.res.cancel(),this.view.getViewRes&&this.view.getViewRes.res&&this.view.getViewRes.res.isRunning()&&this.view.getViewRes.res.cancel()),this.node.empty(),this.loadView()},active:function(){this.view?this.view.loadingAreaNode||this.view.loadView():this.loadView()},loadView:function(){if(!this.json.queryView||!this.json.queryView.name||!this.json.queryView.appName)return"";var e=null;this.json.filterList&&this.json.filterList.length&&(e=[],this.json.filterList.each(function(i){i.value=this.form.Macro.exec(i.code.code,this),e.push(i)}.bind(this)));var i={application:this.json.queryView?this.json.queryView.appName:this.json.application,viewName:this.json.queryView?this.json.queryView.name:this.json.viewName,isTitle:this.json.isTitle||"yes",select:this.json.select||"none",titleStyles:this.json.titleStyles,itemStyles:this.json.itemStyles,isExpand:this.json.isExpand||"no",showActionbar:"show"===this.json.actionbar,filter:e,defaultSelectedScript:this.json.defaultSelectedScript?this.json.defaultSelectedScript.code:null,selectedAbleScript:this.json.selectedAbleScript?this.json.selectedAbleScript.code:null};this.fireEvent("beforeLoadView",[i]),this.view=new MWF.xApplication.query.Query.Viewer(this.node,i,{isload:"no"!==this.json.loadView,resizeNode:"auto"!==this.node.getStyle("height").toString().toLowerCase()&&this.node.getStyle("height").toInt()>0,onLoadView:function(){this.fireEvent("loadView")}.bind(this),onSelect:function(){this.fireEvent("select")}.bind(this),onOpenDocument:function(e,i){this.openOptions={options:e,item:i},this.fireEvent("openDocument"),this.openOptions=null}.bind(this)},this.form.app,this.form.Macro)},loadPrcessView:function(){var e=null;this.json.filterList&&this.json.filterList.length&&(e=[],this.json.filterList.each(function(i){i.value=this.form.Macro.exec(i.code.code,this),e.push(i)}.bind(this)));var i={application:this.json.processView.application,viewName:this.json.processView.name,isTitle:this.json.isTitle||"yes",select:this.json.select||"none",titleStyles:this.json.titleStyles,itemStyles:this.json.itemStyles,isExpand:this.json.isExpand||"no",showActionbar:"show"===this.json.actionbar,filter:e};MWF.xDesktop.requireApp("process.Application","Viewer",function(){this.view=new MWF.xApplication.process.Application.Viewer(this.node,i,{resizeNode:"auto"!==this.node.getStyle("height").toString().toLowerCase()&&this.node.getStyle("height").toInt()>0,onSelect:function(){this.fireEvent("select")}.bind(this)})}.bind(this))},loadCMSView:function(){var e=null;this.json.filterList&&this.json.filterList.length&&(e=[],this.json.filterList.each(function(i){i.value=this.form.Macro.exec(i.code.code,this),e.push(i)}.bind(this)));var i={application:this.json.cmsView.appId,viewName:this.json.cmsView.name,isTitle:this.json.isTitle||"yes",select:this.json.select||"none",titleStyles:this.json.titleStyles,itemStyles:this.json.itemStyles,isExpand:this.json.isExpand||"no",showActionbar:"show"===this.json.actionbar,filter:e};MWF.xDesktop.requireApp("process.Application","Viewer",function(){this.view=new MWF.xApplication.process.Application.Viewer(this.node,i,{actions:{lookup:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}/execute",method:"PUT"},getView:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}"}},actionRoot:"x_cms_assemble_control",resizeNode:"auto"!==this.node.getStyle("height").toString().toLowerCase()&&this.node.getStyle("height").toInt()>0,onSelect:function(){this.fireEvent("select")}.bind(this)})}.bind(this))},getData:function(){if(this.view.selectedItems.length){var e=[];return this.view.selectedItems.each((function(i){e.push(i.data)})),e}return[]}});