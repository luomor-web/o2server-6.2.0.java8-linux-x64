MWF.xDesktop.requireApp("process.ProcessManager","package",null,!1),MWF.xDesktop.requireApp("process.ProcessManager","lp."+MWF.language,null,!1),MWF.xDesktop.requireApp("Selector","package",null,!1),MWF.require("MWF.widget.O2Identity",null,!1),MWF.xApplication.process.ProcessManager.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{application:null,style:"default",name:"process.ProcessManager",icon:"icon.png",width:"1100",height:"700",title:MWF.xApplication.process.ProcessManager.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.process.ProcessManager.LP,this.currentContentNode=null,this.restActions=MWF.Actions.get("x_processplatform_assemble_designer")},loadApplication:function(t){this.getApplication(function(){this.setTitle(this.lp.title+"-"+this.options.application.name),this.createNode(),this.loadApplicationContent(),t&&t(),window.clipboardData?this.addKeyboardEvents():(this.keyCopyItemsFun=this.keyCopyItems.bind(this),this.keyPasteItemsFun=this.keyPasteItems.bind(this),document.addEventListener("copy",this.keyCopyItemsFun),document.addEventListener("paste",this.keyPasteItemsFun),this.addEvent("queryClose",function(){this.keyCopyItemsFun&&document.removeEventListener("copy",this.keyCopyItemsFun),this.keyPasteItemsFun&&document.removeEventListener("paste",this.keyPasteItemsFun)}.bind(this)))}.bind(this),function(){this.close()}.bind(this))},addKeyboardEvents:function(){this.addEvent("copy",function(){this.keyCopyItems()}.bind(this)),this.addEvent("paste",function(){this.keyPasteItems()}.bind(this))},keyCopyItems:function(t){layout.desktop.currentApp&&layout.desktop.currentApp.appId===this.appId&&(this.formConfigurator&&(this.formConfigurator.keyCopy(t),t&&t.preventDefault()),this.processConfigurator&&(this.processConfigurator.keyCopy(t),t&&t.preventDefault()),this.dataConfigurator&&(this.dataConfigurator.keyCopy(t),t&&t.preventDefault()),this.scriptConfigurator&&(this.scriptConfigurator.keyCopy(t),t&&t.preventDefault()))},keyPasteItems:function(t){layout.desktop.currentApp&&layout.desktop.currentApp.appId===this.appId&&(this.formConfigurator&&this.formConfigurator.keyPaste(t),this.processConfigurator&&this.processConfigurator.keyPaste(t),this.dataConfigurator&&this.dataConfigurator.keyPaste(t),this.scriptConfigurator&&this.scriptConfigurator.keyPaste(t))},getApplication:function(t,e){this.options.application?t&&t():this.status&&this.status.application?this.restActions.getApplication(this.status.application,function(i){i.data?(this.options.application=i.data,t&&t()):e&&e()}.bind(this),function(){e&&e()}.bind(this),!1):e&&e()},loadApplicationContent:function(){this.loadStartMenu(),this.loadApplicationLayout()},createNode:function(){this.content.setStyle("overflow","hidden"),this.node=new Element("div",{styles:{width:"100%",height:"100%",overflow:"hidden"}}).inject(this.content)},loadApplicationLayout:function(){},loadStartMenu:function(t){this.startMenuNode=new Element("div",{styles:this.css.startMenuNode}).inject(this.node),this.menu=new MWF.xApplication.process.ProcessManager.Menu(this,this.startMenuNode,{onPostLoad:function(){this.status&&null!=this.status.navi?this.menu.doAction(this.menu.startNavis[this.status.navi]):this.menu.doAction(this.menu.startNavis[0])}.bind(this)}),this.addEvent("resize",function(){this.menu&&this.menu.onResize()}.bind(this))},clearContent:function(){this.processConfiguratorContent&&(this.processConfigurator&&(this.processConfigurator.destroy&&this.processConfigurator.destroy(),delete this.processConfigurator),this.processConfiguratorContent.destroy(),this.processConfiguratorContent=null),this.formConfiguratorContent&&(this.formConfigurator&&(this.formConfigurator.destroy&&this.formConfigurator.destroy(),delete this.formConfigurator),this.formConfiguratorContent.destroy(),this.formConfiguratorContent=null),this.viewConfiguratorContent&&(this.viewConfigurator&&(this.viewConfigurator.destroy&&this.viewConfigurator.destroy(),delete this.viewConfigurator),this.viewConfiguratorContent.destroy(),this.viewConfiguratorContent=null),this.statConfiguratorContent&&(this.statConfigurator&&(this.statConfigurator.destroy&&this.statConfigurator.destroy(),delete this.statConfigurator),this.statConfiguratorContent.destroy(),this.statConfiguratorContent=null),this.propertyConfiguratorContent&&(this.property&&(this.property.destroy&&this.property.destroy(),delete this.property),this.propertyConfiguratorContent.destroy(),this.propertyConfiguratorContent=null),this.dataConfiguratorContent&&(this.dataConfigurator&&(this.dataConfigurator.destroy&&this.dataConfigurator.destroy(),delete this.dataConfigurator),this.dataConfiguratorContent.destroy(),this.dataConfiguratorContent=null),this.scriptConfiguratorContent&&(this.scriptConfigurator&&(this.scriptConfigurator.destroy&&this.scriptConfigurator.destroy(),delete this.scriptConfigurator),this.scriptConfiguratorContent.destroy(),this.scriptConfiguratorContent=null),this.fileConfiguratorContent&&(this.fileConfigurator&&(this.fileConfigurator.destroy&&this.fileConfigurator.destroy(),delete this.fileConfigurator),this.fileConfiguratorContent.destroy(),this.fileConfiguratorContent=null),this.projectionConfiguratorContent&&(this.projectionConfigurator&&(this.projectionConfigurator.destroy&&this.projectionConfigurator.destroy(),delete this.projectionConfigurator),this.projectionConfiguratorContent.destroy(),this.projectionConfiguratorContent=null)},applicationProperty:function(){this.clearContent(),this.propertyConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.property=new MWF.xApplication.process.ProcessManager.ApplicationProperty(this,this.propertyConfiguratorContent),this.property.load()},projectionConfig:function(){this.clearContent(),this.projectionConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadProjectionConfig()},loadProjectionConfig:function(){MWF.xDesktop.requireApp("process.ProcessManager","ProjectionExplorer",function(){this.restActions=MWF.Actions.get("x_processplatform_assemble_designer"),this.projectionConfigurator=new MWF.xApplication.process.ProcessManager.ProjectionExplorer(this.projectionConfiguratorContent,this.restActions),this.projectionConfigurator.app=this,this.projectionConfigurator.load()}.bind(this))},processConfig:function(){this.clearContent(),this.processConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadProcessConfig()},loadProcessConfig:function(){MWF.xDesktop.requireApp("process.ProcessManager","ProcessExplorer",function(){this.restActions=MWF.Actions.get("x_processplatform_assemble_designer"),this.processConfigurator=new MWF.xApplication.process.ProcessManager.ProcessExplorer(this.processConfiguratorContent,this.restActions),this.processConfigurator.app=this,this.processConfigurator.load()}.bind(this))},formConfig:function(){this.clearContent(),this.formConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadFormConfig()},loadFormConfig:function(){MWF.xDesktop.requireApp("process.ProcessManager","FormExplorer",function(){this.restActions=MWF.Actions.get("x_processplatform_assemble_designer"),this.formConfigurator=new MWF.xApplication.process.ProcessManager.FormExplorer(this.formConfiguratorContent,this.restActions),this.formConfigurator.app=this,this.formConfigurator.load()}.bind(this))},viewConfig:function(){this.clearContent(),this.viewConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadViewConfig()},loadViewConfig:function(){MWF.xDesktop.requireApp("process.ProcessManager","ViewExplorer",function(){this.restActions=MWF.Actions.get("x_processplatform_assemble_designer"),this.viewConfigurator=new MWF.xApplication.process.ProcessManager.ViewExplorer(this.viewConfiguratorContent,this.restActions),this.viewConfigurator.app=this,this.viewConfigurator.load()}.bind(this))},statConfig:function(){this.clearContent(),this.statConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadStatConfig()},loadStatConfig:function(){MWF.xDesktop.requireApp("process.ProcessManager","StatExplorer",function(){this.restActions=MWF.Actions.get("x_processplatform_assemble_designer"),this.statConfigurator=new MWF.xApplication.process.ProcessManager.StatExplorer(this.statConfiguratorContent,this.restActions),this.statConfigurator.app=this,this.statConfigurator.load()}.bind(this))},dataConfig:function(){this.clearContent(),this.dataConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadDataConfig()},loadDataConfig:function(){MWF.xDesktop.requireApp("process.ProcessManager","DictionaryExplorer",function(){this.restActions=MWF.Actions.get("x_processplatform_assemble_designer"),this.dataConfigurator=new MWF.xApplication.process.ProcessManager.DictionaryExplorer(this.dataConfiguratorContent,this.restActions),this.dataConfigurator.app=this,this.dataConfigurator.load()}.bind(this))},scriptConfig:function(){this.clearContent(),this.scriptConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadScriptConfig()},loadScriptConfig:function(){MWF.xDesktop.requireApp("process.ProcessManager","ScriptExplorer",function(){this.restActions=MWF.Actions.get("x_processplatform_assemble_designer"),this.scriptConfigurator=new MWF.xApplication.process.ProcessManager.ScriptExplorer(this.scriptConfiguratorContent,this.restActions),this.scriptConfigurator.app=this,this.scriptConfigurator.load()}.bind(this))},fileConfig:function(){this.clearContent(),this.fileConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadFileConfig()},loadFileConfig:function(){MWF.xDesktop.requireApp("process.ProcessManager","FileExplorer",function(){this.restActions=MWF.Actions.get("x_processplatform_assemble_designer"),this.fileConfigurator=new MWF.xApplication.process.ProcessManager.FileExplorer(this.fileConfiguratorContent,this.restActions),this.fileConfigurator.app=this,this.fileConfigurator.load()}.bind(this))},getCategoryCount:function(){var t=this.processConfiguratorContent.getSize();return categoryCount=parseInt(t.x/182)+5,categoryCount},getProcessCount:function(){if(this.processConfigurator){var t=this.processConfigurator.processNode.getSize();return processCount=parseInt(t.x/401)*parseInt(t.y/101)+10,processCount}return 20},showContentNode:function(t){this.currentContentNode&&(this.currentContentNode.fade("hide"),t.fade("show"),t.setStyle("display","node"),this.currentContentNode=null),t.setStyle("display","block"),t.fade("show"),this.currentContentNode=t},recordStatus:function(){var t=null;return this.menu.currentNavi&&(t=this.menu.startNavis.indexOf(this.menu.currentNavi)),{navi:t,application:this.options.application.id}}}),MWF.xApplication.process.ProcessManager.Menu=new Class({Implements:[Options,Events],initialize:function(t,e,i){this.setOptions(i),this.app=t,this.node=$(e),this.currentNavi=null,this.status="start",this.startNavis=[],this.load()},load:function(){var t=this.app.path+"startMenu.json";MWF.getJSON(t,function(t){t.each(function(t){var e=new Element("div",{styles:this.app.css.startMenuNaviNode});e.store("naviData",t),new Element("div",{styles:this.app.css.startMenuIconNode}).inject(e).setStyle("background-image","url("+this.app.path+this.app.options.style+"/icon/"+t.icon+")"),new Element("div",{styles:this.app.css.startMenuTextNode,text:t.title}).inject(e),e.inject(this.node),this.startNavis.push(e),this.setStartNaviEvent(e,t),this.setNodeCenter(this.node)}.bind(this)),this.setStartMenuWidth(),this.fireEvent("postLoad")}.bind(this))},setStartNaviEvent:function(t){var e=this;t.addEvents({mouseover:function(){e.currentNavi!=this&&this.setStyles(e.app.css.startMenuNaviNode_over)},mouseout:function(){e.currentNavi!=this&&this.setStyles(e.app.css.startMenuNaviNode)},mousedown:function(){e.currentNavi!=this&&this.setStyles(e.app.css.startMenuNaviNode_down)},mouseup:function(){e.currentNavi!=this&&this.setStyles(e.app.css.startMenuNaviNode_over)},click:function(){e.doAction.apply(e,[this])}})},doAction:function(t){var e=t.retrieve("naviData").action;this.currentNavi&&this.currentNavi.setStyles(this.app.css.startMenuNaviNode),t.setStyles(this.app.css.startMenuNaviNode_current),this.currentNavi=t,this.app[e]&&this.app[e].apply(this.app),"start"==this.status&&(this.toNormal(),this.status="normal")},toNormal:function(){var t=this.app.css.normalStartMenuNode;this.morph||(this.morph=new Fx.Morph(this.node,{duration:50,link:"chain"})),this.node.setStyles(t),MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.node,{style:"xApp_ProcessManager_StartMenu",distance:100,friction:4,axis:{x:!1,y:!0}})}.bind(this))},setNodeCenter:function(t){var e=t.getSize(),i=this.app.node.getSize(),n=i.y/2-e.y/2,s=i.x/2-e.x/2;s<0&&(s=0),n<0&&(n=0),t.setStyles({left:s,top:n})},getStartMenuNormalSize:function(){var t=this.node.getFirst(),e=t.getComputedSize(),i=t.getStyle("margin-top").toFloat(),n=t.getStyle("margin-bottom").toFloat(),s=e.totalWidth+i+n,o=t.getStyle("margin-left").toFloat(),a=t.getStyle("margin-right").toFloat();return{width:e.totalWidth+o+a,height:s*this.startNavis.length}},setStartMenuWidth:function(){var t=this.node.getFirst(),e=t.getComputedSize(),i=t.getStyle("margin-left").toFloat(),n=t.getStyle("margin-right").toFloat(),s=e.totalWidth+i+n;this.node.setStyle("width",s*this.startNavis.length+"px")},onResize:function(){"start"==this.status&&this.setNodeCenter(this.node)}}),MWF.xApplication.process.ProcessManager.ApplicationProperty=new Class({initialize:function(t,e){this.app=t,this.node=$(e),this.data=this.app.options.application},load:function(){this.app.restActions.getApplication(this.app.options.application.id,function(t){this.data=t.data,this.propertyTitleBar=new Element("div",{styles:this.app.css.propertyTitleBar,text:this.data.name}).inject(this.node),this.contentNode=new Element("div",{styles:this.app.css.propertyContentNode}).inject(this.node),this.contentAreaNode=new Element("div",{styles:this.app.css.propertyContentAreaNode}).inject(this.contentNode),this.setContentHeight(),this.setContentHeightFun=this.setContentHeight.bind(this),this.app.addEvent("resize",this.setContentHeightFun),MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.contentNode,{indent:!1})}.bind(this)),this.baseActionAreaNode=new Element("div",{styles:this.app.css.baseActionAreaNode}).inject(this.contentAreaNode),this.baseActionNode=new Element("div",{styles:this.app.css.propertyInforActionNode}).inject(this.baseActionAreaNode),this.baseTextNode=new Element("div",{styles:this.app.css.baseTextNode,text:this.app.lp.application.property}).inject(this.baseActionAreaNode),this.createEditBaseNode(),this.createPropertyContentNode(),this.createIconContentNode(),this.createAvailableNode(),this.createControllerListNode()}.bind(this))},setContentHeight:function(){var t=this.app.content.getSize(),e=this.propertyTitleBar.getSize(),i=t.y-e.y;this.contentNode.setStyle("height",i+"px")},createIconContentNode:function(){this.iconContentTitleNode=new Element("div",{styles:this.app.css.iconContentTitleNode,text:this.app.lp.application.icon}).inject(this.contentAreaNode),this.iconContentNode=new Element("div",{styles:{overflow:"hidden"}}).inject(this.contentAreaNode);this.iconContentNode.set("html","<table cellspacing='0' cellpadding='0' border='0' width='95%' align='center' style='margin-top: 20px'><tr><td class='formTitle'><div id='formIconPreview'></div></td><td id='formChangeIconAction'></td></tr></table>"),this.iconContentNode.getElements("td.formTitle").setStyles(this.app.css.propertyBaseContentTdTitle),this.iconPreviewNode=this.iconContentNode.getElement("div#formIconPreview"),this.iconActionNode=this.iconContentNode.getElement("td#formChangeIconAction"),this.iconPreviewNode.setStyles({height:"72px",width:"72px",float:"right"}),this.data.icon?this.iconPreviewNode.setStyle("background","url(data:image/png;base64,"+this.data.icon+") center center no-repeat"):this.iconPreviewNode.setStyle("background","url("+this.app.path+this.app.options.style+"/icon/application.png) center center no-repeat"),new Element("div",{styles:{"margin-left":"20px",float:"left","background-color":"#FFF",padding:"4px 14px",border:"1px solid #999","border-radius":"3px","margin-top":"10px","font-size":"14px",color:"#666",cursor:"pointer"},text:this.app.lp.application.changeIcon}).inject(this.iconActionNode).addEvent("click",function(){this.changeIcon()}.bind(this))},changeIcon:function(){MWF.require("MWF.widget.Upload",function(){new MWF.widget.Upload(this.app.content,{data:null,parameter:{id:this.data.id},action:this.app.restActions.action,method:"updateApplicationIcon",onCompleted:function(t){this.app.restActions.getApplication(this.data.id,function(t){t.data&&(this.data=t.data,this.data.icon?this.iconPreviewNode.setStyle("background","url(data:image/png;base64,"+this.data.icon+") center center no-repeat"):this.iconPreviewNode.setStyle("background","url(../x_component_process_ApplicationExplorer/$Main/default/icon/application.png) center center no-repeat"))}.bind(this),!1)}.bind(this)}).load()}.bind(this))},changeIcon_1:function(){if(!this.uploadFileAreaNode){this.uploadFileAreaNode=new Element("div");this.uploadFileAreaNode.set("html",'<input name="file" type="file"/>'),this.fileUploadNode=this.uploadFileAreaNode.getFirst(),this.fileUploadNode.addEvent("change",function(){var e=t.files;if(e.length)for(var i=0;i<e.length;i++){var n=e.item(i),s=new FormData;s.append("file",n),this.app.restActions.changeApplicationIcon(this.data.id,function(){this.app.restActions.getApplication(this.data.id,function(t){t.data&&(this.data=t.data,this.data.icon?this.iconPreviewNode.setStyle("background","url(data:image/png;base64,"+this.data.icon+") center center no-repeat"):this.iconPreviewNode.setStyle("background","url(../x_component_process_ApplicationExplorer/$Main/default/icon/application.png) center center no-repeat"))}.bind(this),!1)}.bind(this),null,s,n)}}.bind(this))}var t=this.uploadFileAreaNode.getFirst();t.click()},createPropertyContentNode:function(){this.propertyContentNode=new Element("div",{styles:{overflow:"hidden","-webkit-user-select":"text","-moz-user-select":"text"}}).inject(this.contentAreaNode);var t="<table cellspacing='0' cellpadding='0' border='0' width='95%' align='center' style='margin-top: 20px'>";t+="<tr><td class='formTitle'>"+this.app.lp.application.name+"</td><td id='formApplicationName'></td></tr>",t+="<tr><td class='formTitle'>"+this.app.lp.application.alias+"</td><td id='formApplicationAlias'></td></tr>",t+="<tr><td class='formTitle'>"+this.app.lp.application.description+"</td><td id='formApplicationDescription'></td></tr>",t+="<tr><td class='formTitle'>"+this.app.lp.application.type+"</td><td id='formApplicationType'></td></tr>",t+="<tr><td class='formTitle'>"+this.app.lp.application.id+"</td><td id='formApplicationId'></td></tr>",t+="</table>",this.propertyContentNode.set("html",t),this.propertyContentNode.getElements("td.formTitle").setStyles(this.app.css.propertyBaseContentTdTitle),this.nameInput=new MWF.xApplication.process.ProcessManager.Input(this.propertyContentNode.getElement("#formApplicationName"),this.data.name,this.app.css.formInput),this.aliasInput=new MWF.xApplication.process.ProcessManager.Input(this.propertyContentNode.getElement("#formApplicationAlias"),this.data.alias,this.app.css.formInput),this.descriptionInput=new MWF.xApplication.process.ProcessManager.Input(this.propertyContentNode.getElement("#formApplicationDescription"),this.data.description,this.app.css.formInput),this.typeInput=new MWF.xApplication.process.ProcessManager.Input(this.propertyContentNode.getElement("#formApplicationType"),this.data.applicationCategory,this.app.css.formInput),this.idInput=new MWF.xApplication.process.ProcessManager.Input(this.propertyContentNode.getElement("#formApplicationId"),this.data.id,this.app.css.formInput)},createControllerListNode:function(){this.controllerListTitleNode=new Element("div",{styles:this.app.css.controllerListTitleNode,text:this.app.lp.application.controllerList}).inject(this.contentAreaNode),this.controllerListContentNode=new Element("div",{styles:{overflow:"hidden"}}).inject(this.contentAreaNode),this.administratorsContentNode=new Element("div",{styles:this.app.css.administratorsContentNode}).inject(this.controllerListContentNode),new Element("div",{styles:{"margin-left":"40px",float:"left","background-color":"#FFF",padding:"4px 14px",border:"1px solid #999","border-radius":"3px","margin-top":"10px","margin-bottom":"20px","font-size":"14px",color:"#666",cursor:"pointer"},text:this.app.lp.application.setManager}).inject(this.contentAreaNode).addEvent("click",function(){this.changeAdministrators()}.bind(this)),this.data.controllerList&&this.data.controllerList.each(function(t){if(t)new MWF.widget.O2Person({name:t},this.administratorsContentNode,{style:"application"})}.bind(this))},changeAdministrators:function(){var t={type:"person",title:this.app.lp.application.setAppManager,values:this.data.controllerList||[],onComplete:function(t){this.administratorsContentNode.empty();var e=[];t.each(function(t){e.push(t.data.distinguishedName);new MWF.widget.O2Person(t.data,this.administratorsContentNode,{style:"application"})}.bind(this)),this.data.controllerList=e,this.app.restActions.saveApplication(this.data,function(t){}.bind(this))}.bind(this)};new MWF.O2Selector(this.app.content,t)},createAvailableNode:function(){this.availableTitleNode=new Element("div",{styles:this.app.css.availableTitleNode,text:this.app.lp.application.available}).inject(this.contentAreaNode),this.availableContentNode=new Element("div",{styles:{overflow:"hidden"}}).inject(this.contentAreaNode),this.availableItemsContentNode=new Element("div",{styles:this.app.css.availableItemsContentNode}).inject(this.availableContentNode),this.availableActionAreaNode=new Element("div",{styles:{overflow:"hidden"}}).inject(this.contentAreaNode),new Element("div",{styles:this.app.css.selectButtonStyle,text:this.app.lp.application.setUsableIdentity}).inject(this.availableActionAreaNode).addEvent("click",function(){this.changeAvailableIdentitys()}.bind(this)),new Element("div",{styles:this.app.css.selectButtonStyle,text:this.app.lp.application.setUsableUnit}).inject(this.availableActionAreaNode).addEvent("click",function(){this.changeAvailableUnit()}.bind(this)),this.setAvailableItems()},setAvailableItems:function(){this.data.availableIdentityList&&this.data.availableIdentityList.each(function(t){t&&new MWF.widget.O2Identity({name:t},this.availableItemsContentNode,{style:"application"})}.bind(this)),this.data.availableUnitList&&this.data.availableUnitList.each(function(t){t&&new MWF.widget.O2Unit({name:t},this.availableItemsContentNode,{style:"application"})}.bind(this))},changeAvailableIdentitys:function(){var t={type:"identity",title:this.app.lp.application.setAppUsableIdentity,values:this.data.availableIdentityList||[],onComplete:function(t){var e=[];t.each(function(t){e.push(t.data.distinguishedName)}.bind(this)),this.data.availableIdentityList=e,this.app.restActions.saveApplication(this.data,function(t){this.availableItemsContentNode.empty(),this.setAvailableItems()}.bind(this))}.bind(this)};new MWF.O2Selector(this.app.content,t)},changeAvailableUnit:function(){var t={type:"unit",title:this.app.lp.application.setAppUsableUnit,values:this.data.availableUnitList||[],onComplete:function(t){var e=[];t.each(function(t){e.push(t.data.distinguishedName)}.bind(this)),this.data.availableUnitList=e,this.app.restActions.saveApplication(this.data,function(t){this.availableItemsContentNode.empty(),this.setAvailableItems()}.bind(this))}.bind(this)};new MWF.O2Selector(this.app.content,t)},createEditBaseNode:function(){this.editBaseNode=new Element("button",{styles:this.app.css.editBaseNode,text:this.app.lp.edit,events:{click:this.editBaseInfor.bind(this)}}).inject(this.baseActionNode)},createCancelBaseNode:function(){this.cancelBaseNode=new Element("button",{styles:this.app.css.cancelBaseNode,text:this.app.lp.cancel,events:{click:this.cancelBaseInfor.bind(this)}}).inject(this.baseActionNode)},createSaveBaseNode:function(){this.saveBaseNode=new Element("button",{styles:this.app.css.saveBaseNode,text:this.app.lp.save,events:{click:this.saveBaseInfor.bind(this)}}).inject(this.baseActionNode)},editBaseInfor:function(){this.baseActionNode.empty(),this.editBaseNode=null,this.createCancelBaseNode(),this.createSaveBaseNode(),this.editMode()},editMode:function(){this.nameInput.editMode(),this.aliasInput.editMode(),this.descriptionInput.editMode(),this.typeInput.editMode(),this.isEdit=!0},readMode:function(){this.nameInput.readMode(),this.aliasInput.readMode(),this.descriptionInput.readMode(),this.typeInput.readMode(),this.isEdit=!1},cancelBaseInfor:function(){this.data.name?(this.baseActionNode.empty(),this.cancelBaseNode=null,this.saveBaseNode=null,this.createEditBaseNode(),this.readMode()):this.destroy()},saveBaseInfor:function(){if(!this.nameInput.input.get("value"))return this.app.notice(this.app.lp.application.inputApplicationName,"error",this.node),!1;this.node.mask({style:{opacity:.7,"background-color":"#999"}}),this.save(function(){this.baseActionNode.empty(),this.cancelBaseNode=null,this.saveBaseNode=null,this.createEditBaseNode(),this.readMode(),this.node.unmask()}.bind(this),function(t,e,i){var n=i;t&&(n=t.responseText),this.app.notice("request json error: "+n,"error"),this.node.unmask()}.bind(this))},save:function(t,e){this.data.name=this.nameInput.input.get("value"),this.data.alias=this.aliasInput.input.get("value"),this.data.description=this.descriptionInput.input.get("value"),this.data.applicationCategory=this.typeInput.input.get("value"),this.app.restActions.saveApplication(this.data,function(e){this.propertyTitleBar.set("text",this.data.name),this.data.id=e.data.id,this.nameInput.save(),this.aliasInput.save(),this.descriptionInput.save(),this.typeInput.save(),t&&t()}.bind(this),function(t,i,n){e&&e(t,i,n)}.bind(this))}}),MWF.xApplication.process.ProcessManager.Input=new Class({Implements:[Events],initialize:function(t,e,i){this.node=$(t),this.value=e||"",this.style=i,this.load()},load:function(){this.content=new Element("div",{styles:this.style.content,text:this.value}).inject(this.node)},editMode:function(){this.content.empty(),this.input=new Element("input",{styles:this.style.input,value:this.value}).inject(this.content),this.input.addEvents({focus:function(){this.input.setStyles(this.style.input_focus)}.bind(this),blur:function(){this.input.setStyles(this.style.input)}.bind(this)})},readMode:function(){this.content.empty(),this.input=null,this.content.set("text",this.value)},save:function(){return this.input&&(this.value=this.input.get("value")),this.value}});