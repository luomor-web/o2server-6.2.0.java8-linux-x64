MWF.xApplication.Homepage.InforContent=new Class({Extends:MWF.xApplication.Homepage.TaskContent,Implements:[Options,Events],options:{view:"inforContent.html"},load:function(){this.tabs={},this.container.loadHtml(this.viewPath,{bind:{lp:this.app.lp},module:this},function(){this.initSize(),this.loadInfor(function(){this.fireEvent("load")}.bind(this))}.bind(this))},openInfor:function(t){layout.openApplication(t,"cms.Index")},setContentSize:function(){var t,e=this.container.getSize().y-(this.taskTitleNode.getSize().y+this.taskTitleNode.getEdgeHeight())-this.contentNode.getEdgeHeight();(this.contentNode.setStyle("height",e+"px"),this.contentHeight=e,this.noItemNode)&&(t=this.currentTab&&this.currentTab.itemsContainer?(this.currentTab.itemsContainer.getSize().y-this.noItemNode.getSize().y)/2:(this.contentHeight-this.noItemNode.getSize().y)/2,this.noItemNode.setStyle("margin-top",t+"px"));if(this.currentTab){if(this.currentTab.hotpicDocAreaNode){var i=this.currentTab.hotpicPageAreaNode.getSize().y+this.currentTab.hotpicPageAreaNode.getEdgeHeight(),o=this.contentHeight-i;this.currentTab.hotpicDocAreaNode.setStyle("height",o+"px")}if(this.currentTab.itemsContainer){var n=this.pageAreaNode.getSize().y+this.pageAreaNode.getEdgeHeight(),s=this.contentHeight-n;this.currentTab.itemsContainer.setStyle("height",s+"px")}}},loadInfor:function(t){this.loadInforApps(),this.loadAllInfor(t)},loadInforApps:function(){o2.Actions.load("x_cms_assemble_control").AppInfoAction.listWhatICanView_Article(function(t){t.data&&t.data.each(function(t){var e=new Element("div.o2_homepage_title_tab",{text:t.appName}).inject(this.tabAreaNode);e.store("app",t.id),e.addEvents({mouseover:function(t){this.tabover(t.event)}.bind(this),mouseout:function(t){this.tabout(t.event)}.bind(this),click:function(t){var e=t.target.retrieve("app");this.loadList(e,t.target||t.currentTarget)}.bind(this)})}.bind(this))}.bind(this))},loadList:function(t,e){this.isLoading||(this.tabs[t]?this.tabs[t].load():this.tabs[t]=new MWF.xApplication.Homepage.InforContent.Infor(this,e,t),this.currentTab=this.tabs[t])},loadAllInfor:function(t){this.isLoading||(this.allInforContentTab?this.allInforContentTab.load():this.allInforContentTab=new MWF.xApplication.Homepage.InforContent.AllInfor(this,this.allInforTab,{onLoad:function(){t&&t()}}),this.currentTab=this.allInforContentTab)}}),MWF.xApplication.Homepage.InforContent.AllInfor=new Class({Extends:MWF.xApplication.Homepage.TaskContent.Task,Implements:[Options,Events],options:{type:"allInfor",switchTime:5e3},initialize:function(t,e,i){this.setOptions(i),this.content=t,this.app=this.content.app,this.container=this.content.contentNode,this.tab=e,this.load()},load:function(){this.container.empty(),this.content.isLoading=!0,this.content.currentTab&&this.content.currentTab.hideTab(),this.loadItemsNode(function(){this.beginLoadContent(),this.showTab(),this.initSize(),this.initItemCount(this.page),this.loadItemsRes()}.bind(this))},reload:function(){this.load()},reloadPic:function(){this.hotpicDocArea.empty(),this.hotpicPageContent.empty(),this.loadItemsRes_pic()},reloadItem:function(){this.beginItemLoadContent(),this.initItemCount(this.page),this.loadItemsRes_item()},initItemCount:function(t){this.page=t||1,this.pageSize=(this.itemContentArea.getSize().y/this.options.itemHeight).toInt()},loadItemsNode:function(t){var e=this.app.path+this.app.options.style+"/allInfor.html";this.container.loadHtml(e,{module:this},t.bind(this))},initSize:function(){this.resizeFun=this.resize.bind(this),this.resize(),this.app.addEvent("resize",this.resizeFun)},resize:function(){var t=this.hotpicDocArea.getEdgeHeight(),e=this.hotpicPageArea.getSize().y+this.hotpicPageArea.getEdgeHeight(),i=this.content.contentHeight-t-e;if(this.hotpicDocArea.setStyle("height",i+"px"),t=this.itemContentArea.getEdgeHeight(),e=this.itemPageArea.getSize().y+this.itemPageArea.getEdgeHeight(),i=this.content.contentHeight-t-e,this.itemContentArea.setStyle("height",i+"px"),this.hotpics&&this.hotpics.length&&this.hotpics.each(function(t){this.resizePicNode(t)}.bind(this)),this.noHotpicNode){var o=(this.hotpicDocArea.getSize().y-this.noHotpicNode.getSize().y)/2;this.noHotpicNode.setStyle("margin-top",o+"px")}if(this.noItemNode){o=(this.itemContentArea.getSize().y-this.noItemNode.getSize().y)/2;this.noItemNode.setStyle("margin-top",o+"px")}},destroy:function(){this.container.empty(),this.switchId&&window.clearInterval(this.switchId),this.switchId=null,this.resizeFun&&this.app.removeEvent("resize",this.resizeFun),o2.release(this)},hideTab:function(){this.container.empty(),this.switchId&&window.clearInterval(this.switchId),this.switchId=null,this.resizeFun&&this.app.removeEvent("resize",this.resizeFun),this.content.currentTab=null,this.tab.removeClass("mainColor_color").removeClass("mainColor_border").removeClass("o2_homepage_title_tab_current").removeClass("o2_homepage_title_tab_over")},beginLoadContent:function(){this.beginPicLoadContent(),this.beginItemLoadContent(),this.noItemNode=null,this.hotpics=[],this.content.isLoading=!0},beginPicLoadContent:function(){this.picLoading=!0,this.hotpicDocArea.empty(),this.hotpicDocArea.addClass("o2_homepage_area_content_loading").addClass("icon_loading"),this.hotpicPageContent.empty()},beginItemLoadContent:function(){this.itemLoading=!0,this.itemContentArea.empty(),this.itemContentArea.addClass("o2_homepage_area_content_loading").addClass("icon_loading"),this.itemPageArea.empty()},endLoadContent:function(){this.endPicLoadContent(),this.endItemLoadContent(),this.content.isLoading=!1},endPicLoadContent:function(){this.noHotpicNode&&(this.noHotpicNode.destroy(),this.noHotpicNode=null),this.hotpicDocArea.removeClass("o2_homepage_area_content_loading").removeClass("icon_loading"),this.picLoading=!1,this.itemLoading||this.picLoading||(this.content.isLoading=!1,this.fireEvent("load"))},endItemLoadContent:function(){this.noItemNode&&(this.noItemNode.destroy(),this.noItemNode=null),this.itemContentArea.removeClass("o2_homepage_area_content_loading").removeClass("icon_loading"),this.itemLoading=!1,this.itemLoading||this.picLoading||(this.content.isLoading=!1,this.fireEvent("load"))},loadItemsRes:function(){this.loadItemsRes_pic(),this.loadItemsRes_item()},loadItemsRes_pic:function(){this.hotpicCount=6,o2.Actions.load("x_hotpic_assemble_control").HotPictureInfoAction.listForPage(1,this.hotpicCount,{},function(t){if(this.hotpicCount=t.data.length,this.hotpicCount){var e=this.app.path+this.app.options.style+"/hotpic.html";o2.loadHtml(e,function(e){this.endPicLoadContent();var i=e[0].data;t.data.each(function(t){this.loadHotpic(t,i)}.bind(this)),this.loadPicPage()}.bind(this))}else{this.endPicLoadContent(),this.noHotpicNode=new Element("div.o2_homepage_hotpic_area_content_empty_node",{text:this.app.lp.noHotpic}).inject(this.hotpicDocArea);var i=(this.hotpicDocArea.getSize().y-this.noHotpicNode.getSize().y)/2;this.noHotpicNode.setStyle("margin-top",i+"px")}}.bind(this))},loadItemsRes_item:function(){o2.Actions.load("x_cms_assemble_control").DocumentAction.query_listWithFilterPaging(this.page,this.pageSize,{orderField:"publishTime",orderType:"DESC",readFlag:"UNREAD"},function(t){if(this.itemCount=t.count,t.data&&t.data.length)this.loadItems(t.data),this.checkLoadPage();else{this.endItemLoadContent(),this.noItemNode=new Element("div.o2_homepage_hotpic_area_content_empty_node",{text:this.app.lp.noInforItem}).inject(this.itemContentArea);var e=(this.itemContentArea.getSize().y-this.noItemNode.getSize().y)/2;this.noItemNode.setStyle("margin-top",e+"px")}}.bind(this))},checkLoadPage:function(){this.itemCount&&(this.getPageCount(),this.loadPage(this.itemPageArea))},getPageCount:function(){var t=this.itemCount/this.pageSize,e=t.toInt();this.pages=e===t?e:e+1},loadItems:function(t){var e=new Element("table",{width:"100%",border:0,cellpadding:0,cellspacing:0}).inject(this.itemContentArea);t.each(function(t,i){this.loadItem(e,t,i)}.bind(this)),this.endItemLoadContent()},loadItemRow:function(t,e,i){var o=t.insertRow(-1).addClass("o2_homepage_task_item_row"),n=(this.page-1)*this.pageSize+i+1,s=n>99?"···":n,a=o.insertCell(-1).addClass("o2_homepage_task_item_cell_number"),h=(new Element("div.o2_homepage_task_item_number",{text:s,title:n}).inject(a),o2.txt(e.title||this.app.lp.noSubject));a=o.insertCell(-1).addClass("o2_homepage_task_item_cell_subject"),new Element("div.o2_homepage_task_item_subject",{html:h,title:h}).inject(a);var c=(e.publishTime||e.createTime).substr(0,10);return a=o.insertCell(-1).addClass("o2_homepage_task_item_cell_time"),new Element("div.o2_homepage_task_item_time",{text:c,title:this.app.lp.publishTime+": "+c}).inject(a),o},resizePicNode:function(t){var e=this.hotpicDocArea.getSize().x/2;t.getFirst().setStyle("height",e+"px")},loadHotpic:function(t,e,i){var o=new Element("div.o2_homepage_infor_hotpicNode").inject(this.hotpicDocArea,"top"),n={title:t.title,summary:t.summary||t.title,createTime:t.createTime.toString().substr(0,10),url:MWF.xDesktop.getImageSrc(t.picId)};o.set("html",e.bindJson(n)),o.store("data",t);var s=this;o.addEvent("click",(function(t){var e=this.retrieve("data");s.open(t,e)})),this.hotpics||(this.hotpics=[]),this.resizePicNode(o),this.hotpics.push(o)},loadPicPage:function(){if(this.hotpics&&this.hotpics.length)this.hotpics.each(function(t,e){var i=new Element("div.o2_homepage_infor_hotpicArea_page_item").inject(this.hotpicPageContent);i.store("picNode",t),i.addEvent("click",function(t){this.showPic(t.target),this.beginSwitchPic()}.bind(this)),0==e&&this.showPic(i)}.bind(this)),this.beginSwitchPic();else{this.endPicLoadContent(),this.noHotpicNode=new Element("div.o2_homepage_hotpic_area_content_empty_node",{text:this.app.lp.noHotpic}).inject(this.hotpicDocArea);var t=(this.hotpicDocArea.getSize().y-this.noHotpicNode.getSize().y)/2;this.noHotpicNode.setStyle("margin-top",t+"px")}},beginSwitchPic:function(){this.switchId&&window.clearInterval(this.switchId),this.switchId=window.setInterval(function(){var t=this.hotpicPageContent.getElement(".o2_homepage_infor_hotpicArea_page_item_current"),e=null;t&&(e=t.getNext())||(e=this.hotpicPageContent.getFirst()),e&&this.showPic(e)}.bind(this),this.options.switchTime)},showPic:function(t){var e=t.retrieve("picNode");e&&(this.currentPageNode&&this.hidePic(this.currentPageNode),e.fade("in"),e.addClass("o2_homepage_infor_hotpicNode_current"),t.addClass("o2_homepage_infor_hotpicArea_page_item_current"),this.currentPageNode=t)},hidePic:function(t){var e=t.retrieve("picNode");e&&(e.fade("out"),e.removeClass("o2_homepage_infor_hotpicNode_current"),t.removeClass("o2_homepage_infor_hotpicArea_page_item_current"),this.currentPageNode=null)},open:function(t,e){var i=e.infoId||e.id;if("BBS"==e.application){var o="ForumDocument"+e.infoId;this.app.desktop.apps[o]?this.app.desktop.apps[o].setCurrent():layout.openApplication(null,"ForumDocument",{id:i,appId:o,isEdited:!1,isNew:!1})}else{o="cms.Document"+e.infoId;this.app.desktop.apps[o]?this.app.desktop.apps[o].setCurrent():layout.openApplication(null,"cms.Document",{documentId:i,appId:o,readonly:!0})}},prevPage:function(){this.page>1&&(this.page--,this.reloadItem())},nextPage:function(){this.page<this.pages&&(this.page++,this.reloadItem())},gotoPage:function(t){this.page=t.toInt(),this.reloadItem()},reversePage:function(){var t=this.getCurrentPageRange().beginNumber-1-(this.options.showPages-1);t<1&&(t=1),this.page=t+(this.options.showPages/2).toInt(),this.reloadItem()},forwardPage:function(){var t=this.getCurrentPageRange().endNumber+1,e=t+(this.options.showPages-1);t>=this.pages&&(e=this.pages),this.page=e-(this.options.showPages/2).toInt(),this.reloadItem()}}),MWF.xApplication.Homepage.InforContent.Infor=new Class({Extends:MWF.xApplication.Homepage.TaskContent.Task,Implements:[Options,Events],options:{type:"infor"},initialize:function(t,e,i,o){this.setOptions(o),this.content=t,this.app=this.content.app,this.container=this.content.contentNode,this.tab=e,this.id=i,this.load()},load:function(){this.container=this.content.contentNode,this.container.empty(),this.beginLoadContent(),this.showTab(),this.initItemCount(),this.loadItemsRes()},reload:function(){this.content.isLoading||(this.container=this.content.contentNode,this.container.empty(),this.beginLoadContent(),this.showTab(),this.initItemCount(this.page),this.loadItemsRes())},showTab:function(){this.container.removeClass("o2_homepage_area_content_loading").removeClass("icon_loading"),this.itemsContainer=new Element("div.o2_homepage_task_area_content").inject(this.container);var t=new Element("div.o2_homepage_infor_area_action").inject(this.container);this.container=this.itemsContainer,this.content.pageAreaNode=t,this.container.addClass("o2_homepage_area_content_loading").addClass("icon_loading");var e=t.getSize().y+t.getEdgeHeight(),i=this.content.contentHeight-e;this.container.setStyle("height",i+"px"),this.content.currentTab=this,this.tab.addClass("mainColor_color").addClass("mainColor_border").addClass("o2_homepage_title_tab_current").removeClass("o2_homepage_title_tab_over")},loadItemsRes:function(){o2.Actions.load("x_cms_assemble_control").DocumentAction.query_listWithFilterPaging(this.page,this.pageSize,{orderField:"publishTime",orderType:"DESC",readFlag:"UNREAD",appIdList:[this.id]},function(t){this.itemCount=t.count,t.data&&t.data.length?(this.loadItems(t.data),this.checkLoadPage()):this.emptyLoadContent()}.bind(this))},emptyLoadContent:function(){this.container.empty(),this.container.removeClass("o2_homepage_area_content_loading").removeClass("icon_loading"),this.content.pageAreaNode.empty(),this.content.noItemNode=new Element("div.o2_homepage_hotpic_area_content_empty_node",{text:this.app.lp.noInforItem}).inject(this.container);var t=(this.container.getSize().y-this.content.noItemNode.getSize().y)/2;this.content.noItemNode.setStyle("margin-top",t+"px"),this.content.isLoading=!1},loadItemRow:function(t,e,i){var o=t.insertRow(-1).addClass("o2_homepage_task_item_row"),n=(this.page-1)*this.pageSize+i+1,s=n>99?"···":n,a=o.insertCell(-1).addClass("o2_homepage_task_item_cell_number"),h=(new Element("div.o2_homepage_task_item_number",{text:s,title:n}).inject(a),o2.txt(e.title||this.app.lp.noSubject));a=o.insertCell(-1).addClass("o2_homepage_task_item_cell_subject"),new Element("div.o2_homepage_task_item_subject",{html:h,title:h}).inject(a);var c=o2.name.cn(e.creatorPerson);a=o.insertCell(-1).addClass("o2_homepage_task_item_cell_creator"),new Element("div.o2_homepage_task_item_creator",{text:c,title:this.app.lp.publishPerson+": "+c}).inject(a);var r=(e.publishTime||e.createTime).substr(0,10);return a=o.insertCell(-1).addClass("o2_homepage_task_item_cell_time"),new Element("div.o2_homepage_task_item_time",{text:r,title:this.app.lp.publishTime+": "+r}).inject(a),o},checkLoadPage:function(){this.itemCount&&(this.getPageCount(),this.loadPage(this.itemPageArea))},getPageCount:function(){var t=this.itemCount/this.pageSize,e=t.toInt();this.pages=e===t?e:e+1},open:function(t,e){var i=e.infoId||e.id,o={documentId:i,docTitle:e.title,appId:"cms.Document"+i};layout.openApplication(t,"cms.Document",o)}});