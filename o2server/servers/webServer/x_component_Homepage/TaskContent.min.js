MWF.xApplication.Homepage.TaskContent=new Class({Implements:[Options,Events],options:{view:"taskContent.html"},initialize:function(t,e,a){this.setOptions(a),this.app=t,this.container=e,this.viewPath=this.app.path+this.app.options.style+"/"+this.options.view,this.load()},load:function(){this.container.loadHtml(this.viewPath,{bind:{lp:this.app.lp},module:this},function(){this.initSize(),this.loadCount(),this.loadTask(function(){this.fireEvent("load")}.bind(this))}.bind(this))},startProcess:function(){o2.requireApp([["process.TaskCenter","lp."+o2.language],["process.TaskCenter",""]],"",function(){var t={lp:MWF.xApplication.process.TaskCenter.LP,content:this.app.content,addEvent:function(t,e){this.app.addEvent(t,e)}.bind(this),getAction:function(t){this.action||(this.action=MWF.Actions.get("x_processplatform_assemble_surface")),t&&t()},desktop:layout.desktop,refreshAll:function(){},notice:this.app.notice};o2.JSON.get("../x_component_process_TaskCenter/$Main/default/css.wcss",(function(e){t.css=e}),!1),this.processStarter||(this.processStarter=new MWF.xApplication.process.TaskCenter.Starter(t,{onStartProcess:function(){"task"==this.currentTab.options.type&&this.currentTab.reload()}.bind(this)})),this.processStarter.load()}.bind(this),!0,!0)},initSize:function(){this.setContentSize(),this.app.addEvent("resize",this.setContentSize.bind(this))},setContentSize:function(){var t=this.container.getSize().y-(this.taskTitleNode.getSize().y+this.taskTitleNode.getEdgeHeight())-(this.pageAreaNode.getSize().y+this.pageAreaNode.getEdgeHeight())-this.itemContentNode.getEdgeHeight();if(this.itemContentNode.setStyle("height",t+"px"),this.contentHeight=t,this.noItemNode){var e=(this.contentHeight-this.noItemNode.getSize().y)/2;this.noItemNode.setStyle("margin-top",e+"px")}},loadCount:function(){o2.Actions.load("x_processplatform_assemble_surface").WorkAction.countWithPerson(layout.session.user.id,function(t){this.itemCounts||(this.itemCounts={}),this.itemCounts.task=t.data.task,this.itemCounts.taskCompleted=t.data.taskCompleted,this.itemCounts.read=t.data.read,this.itemCounts.readCompleted=t.data.readCompleted,this.showTabCount(this.taskTab,t.data.task),this.showTabCount(this.taskCompletedTab,t.data.taskCompleted),this.showTabCount(this.readTab,t.data.read),this.showTabCount(this.readCompletedTab,t.data.readCompleted),this.fireEvent("loadTaskCount"),this.fireEvent("loadReadCount"),this.fireEvent("loadTaskCompletedCount"),this.fireEvent("loadReadCompletedCount")}.bind(this)),o2.Actions.load("x_processplatform_assemble_surface").ReviewAction.V2Count({creatorPersonList:[layout.session.user.id]},function(t){this.itemCounts||(this.itemCounts={}),this.itemCounts.draft=t.data.count,this.showTabCount(this.draftTab,t.data.count),this.fireEvent("loadDraftCount")}.bind(this)),o2.Actions.load("x_processplatform_assemble_surface").DraftAction.listNext("(0)",1,function(t){this.itemCounts||(this.itemCounts={}),this.itemCounts.processDraft=t.count,this.showTabCount(this.processDraftTab,t.count),this.fireEvent("loadProcessDraftCount")}.bind(this))},showTabCount:function(t,e){var a=t.get("text");t.set("text",a+"("+e+")")},tabover:function(t){t.currentTarget.addClass("o2_homepage_title_tab_over")},tabout:function(t){t.currentTarget.removeClass("o2_homepage_title_tab_over")},loadTask:function(t){this.isLoading||(this.taskContentTab?this.taskContentTab.reload():this.taskContentTab=new MWF.xApplication.Homepage.TaskContent.Task(this,this.taskTab,{onLoad:function(){t&&t()}}),this.currentTab=this.taskContentTab)},loadTaskCompleted:function(){this.isLoading||(this.taskCompletedContentTab?this.taskCompletedContentTab.reload():this.taskCompletedContentTab=new MWF.xApplication.Homepage.TaskContent.TaskCompleted(this,this.taskCompletedTab),this.currentTab=this.taskCompletedContentTab)},loadRead:function(){this.isLoading||(this.readContentTab?this.readContentTab.reload():this.readContentTab=new MWF.xApplication.Homepage.TaskContent.Read(this,this.readTab),this.currentTab=this.readContentTab)},loadReadCompleted:function(){this.isLoading||(this.readCompletedContentTab?this.readCompletedContentTab.reload():this.readCompletedContentTab=new MWF.xApplication.Homepage.TaskContent.ReadCompleted(this,this.readCompletedTab),this.currentTab=this.readCompletedContentTab)},loadDraft:function(){this.isLoading||(this.draftContentTab?this.draftContentTab.reload():this.draftContentTab=new MWF.xApplication.Homepage.TaskContent.Draft(this,this.draftTab),this.currentTab=this.draftContentTab)},loadProcessDraft:function(){this.isLoading||(this.processDraftContentTab?this.processDraftContentTab.reload():this.processDraftContentTab=new MWF.xApplication.Homepage.TaskContent.ProcessDraft(this,this.processDraftTab),this.currentTab=this.processDraftContentTab)}}),MWF.xApplication.Homepage.TaskContent.Task=new Class({Implements:[Options,Events],options:{itemHeight:40,showPages:5,type:"task"},initialize:function(t,e,a){this.setOptions(a),this.content=t,this.app=this.content.app,this.container=this.content.itemContentNode,this.tab=e,this.load()},load:function(){this.beginLoadContent(),this.showTab(),this.initItemCount(),this.loadItemsRes()},loadItemsRes:function(){o2.Actions.load("x_processplatform_assemble_surface").TaskAction.listMyPaging(this.page,this.pageSize,function(t){t.data&&t.data.length?(this.loadItems(t.data),this.checkLoadPage()):this.emptyLoadContent(),this.fireEvent("load")}.bind(this))},reload:function(){this.content.isLoading||(this.beginLoadContent(),this.showTab(),this.initItemCount(this.page),this.loadItemsRes())},initItemCount:function(t){this.page=t||1,this.pageSize=(this.container.getSize().y/this.options.itemHeight).toInt()},beginLoadContent:function(){this.content.currentTab&&this.content.currentTab.hideTab(),this.container.empty(),this.content.noItemNode=null,this.container.addClass("o2_homepage_area_content_loading").addClass("icon_loading"),this.content.isLoading=!0},endLoadContent:function(){this.content.noItemNode&&(this.content.noItemNode.destroy(),this.content.noItemNode=null),this.container.removeClass("o2_homepage_area_content_loading").removeClass("icon_loading"),this.content.isLoading=!1},emptyLoadContent:function(){this.container.empty(),this.container.removeClass("o2_homepage_area_content_loading").removeClass("icon_loading"),this.content.pageAreaNode.empty(),this.content.noItemNode=new Element("div.o2_homepage_task_area_content_empty_node",{text:this.app.lp.noWork}).inject(this.container);var t=(this.content.contentHeight-this.content.noItemNode.getSize().y)/2;this.content.noItemNode.setStyle("margin-top",t+"px"),this.content.isLoading=!1},hideTab:function(){this.container.empty(),this.content.currentTab=null,this.tab.removeClass("mainColor_color").removeClass("mainColor_border").removeClass("o2_homepage_title_tab_current").removeClass("o2_homepage_title_tab_over")},showTab:function(){this.content.currentTab=this,this.tab.addClass("mainColor_color").addClass("mainColor_border").addClass("o2_homepage_title_tab_current").removeClass("o2_homepage_title_tab_over")},loadItems:function(t){var e=new Element("table",{width:"100%",border:0,cellpadding:0,cellspacing:0}).inject(this.container);t.each(function(t,a){this.loadItem(e,t,a)}.bind(this)),this.endLoadContent()},loadItemRow:function(t,e,a){var o=t.insertRow(-1).addClass("o2_homepage_task_item_row"),s=(this.page-1)*this.pageSize+a+1,i=s>99?"···":s,n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_number"),r=(new Element("div.o2_homepage_task_item_number",{text:i,title:s}).inject(n),"["+e.processName+"] "+o2.txt(e.title||this.app.lp.noSubject));n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_subject"),new Element("div.o2_homepage_task_item_subject",{html:r,title:r}).inject(n),n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_activity"),new Element("div.o2_homepage_task_item_activity",{text:e.activityName,title:this.app.lp.currentActivity+": "+e.activityName}).inject(n),n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_creator"),new Element("div.o2_homepage_task_item_creator",{text:o2.name.cn(e.creatorPerson),title:this.app.lp.draftUser+": "+o2.name.cn(e.creatorPerson)}).inject(n);var d=e.startTime.substr(0,10);return n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_time"),new Element("div.o2_homepage_task_item_time",{text:d,title:this.app.lp.taskStartTime+": "+d}).inject(n),o},loadItem:function(t,e,a){var o=this.loadItemRow(t,e,a),s=this;o.store("data",e),o.addEvents({mouseover:function(){this.addClass("mainColor_color").addClass("o2_homepage_task_item_row_over"),this.getElement("div").addClass("mainColor_bg").addClass("o2_homepage_task_item_number_over")},mouseout:function(){this.removeClass("mainColor_color").removeClass("o2_homepage_task_item_row_over"),this.getElement("div").removeClass("mainColor_bg").removeClass("o2_homepage_task_item_number_over")},click:function(t){var e=this.retrieve("data");e&&s.open(t,e)}})},reloadTasks:function(){var t=this.content.currentTab.options.type;"task"!=t&&"taskCompleted"!=t||this.content.currentTab.reload()},reloadReads:function(){var t=this.content.currentTab.options.type;"read"!=t&&"readCompleted"!=t||this.content.currentTab.reload()},open:function(t,e){var a={workId:e.work,appId:"process.Work"+e.work,onAfterProcess:this.reloadTasks.bind(this),onAfterReset:this.reloadTasks.bind(this),onAfterRetract:this.reloadTasks.bind(this),onAfterReroute:this.reloadTasks.bind(this),onAfterDelete:this.reloadTasks.bind(this),onAfterReaded:this.reloadReads.bind(this)};layout.openApplication(t,"process.Work",a)},checkLoadPage:function(){this.content.itemCounts&&this.content.itemCounts.task?(this.getPageCount(),this.loadPage()):this.addLoadPageEvent()},addLoadPageEvent:function(){var t=function(){this.getPageCount(),this.loadPage(),this.content.removeEvent("loadTaskCount",t)}.bind(this);this.content.addEvent("loadTaskCount",t)},getPageCount:function(){var t=this.content.itemCounts.task/this.pageSize,e=t.toInt();this.pages=e===t?e:e+1},loadPage:function(t){var e=t||this.content.pageAreaNode;if(e.empty(),this.pages>1){this.pageNode=new Element("div.o2_homepage_task_page_area").inject(e),this.prevPageNode=new Element("div.o2_homepage_task_page_prev",{text:this.app.lp.prevPage}).inject(this.pageNode),this.itemsPageAreaNode=new Element("div.o2_homepage_task_page_items").inject(this.pageNode),this.nextPageNode=new Element("div.o2_homepage_task_page_next",{text:this.app.lp.nextPage}).inject(this.pageNode),this.prevPageNode.addEvents({mouseover:function(){this.addClass("o2_homepage_task_page_prev_over").addClass("mainColor_bg")},mouseout:function(){this.removeClass("o2_homepage_task_page_prev_over").removeClass("mainColor_bg")},click:function(){this.prevPage()}.bind(this)}),this.nextPageNode.addEvents({mouseover:function(){this.addClass("o2_homepage_task_page_next_over").addClass("mainColor_bg")},mouseout:function(){this.removeClass("o2_homepage_task_page_next_over").removeClass("mainColor_bg")},click:function(){this.nextPage()}.bind(this)});var a=this.pageNode.getSize(),o=this.prevPageNode.getEdgeWidth(),s=this.nextPageNode.getEdgeWidth(),i=this.prevPageNode.getSize().x,n=this.nextPageNode.getSize().x,r=((a.x-o-s-i-n)/30).toInt()-2;r<3&&(r=3),this.options.showPages=r,this.loadPageNumber()}},getCurrentPageRange:function(){var t=1,e=this.pages,a=!1,o=!1;return this.pages>this.options.showPages&&((t=this.page-(this.options.showPages/2).toInt())<1&&(t=1),(e=t+(this.options.showPages-1))>this.pages&&(t=(e=this.pages)-(this.options.showPages-1))<1&&(t=1),t>1&&(a=!0),e<this.pages&&(o=!0)),{beginNumber:t,endNumber:e,reverse:a,forward:o}},loadPageNumber:function(){var t=this.getCurrentPageRange();this.itemsPageAreaNode.empty(),t.reverse&&(this.reverseNode=new Element("div.o2_homepage_task_page_reverse",{text:"..."}).inject(this.itemsPageAreaNode),this.reverseNode.addEvents({mouseover:function(){this.addClass("o2_homepage_task_page_item_over")},mouseout:function(){this.removeClass("o2_homepage_task_page_item_over")},click:function(){this.reversePage()}.bind(this)}));for(var e=t.beginNumber;e<=t.endNumber;e++){var a=new Element("div.o2_homepage_task_page_item",{text:e}).inject(this.itemsPageAreaNode);this.page===e&&a.addClass("o2_homepage_task_page_item_current").addClass("mainColor_bg"),a.addEvents({mouseover:function(){this.addClass("o2_homepage_task_page_item_over")},mouseout:function(){this.removeClass("o2_homepage_task_page_item_over")},click:function(t){this.gotoPage(t.target.get("text"))}.bind(this)})}t.forward&&(this.forwardNode=new Element("div.o2_homepage_task_page_forward",{text:"..."}).inject(this.itemsPageAreaNode),this.forwardNode.addEvents({mouseover:function(){this.addClass("o2_homepage_task_page_item_over")},mouseout:function(){this.removeClass("o2_homepage_task_page_item_over")},click:function(){this.forwardPage()}.bind(this)}))},prevPage:function(){this.page>1&&(this.page--,this.reload())},nextPage:function(){this.page<this.pages&&(this.page++,this.reload())},gotoPage:function(t){this.page=t.toInt(),this.reload()},reversePage:function(){var t=this.getCurrentPageRange().beginNumber-1-(this.options.showPages-1);t<1&&(t=1),this.page=t+(this.options.showPages/2).toInt(),this.reload()},forwardPage:function(){var t=this.getCurrentPageRange().endNumber+1,e=t+(this.options.showPages-1);t>=this.pages&&(e=this.pages),this.page=e-(this.options.showPages/2).toInt(),this.reload()}}),MWF.xApplication.Homepage.TaskContent.TaskCompleted=new Class({Extends:MWF.xApplication.Homepage.TaskContent.Task,Implements:[Options,Events],options:{type:"taskCompleted"},loadItemsRes:function(){o2.Actions.load("x_processplatform_assemble_surface").TaskCompletedAction.listMyPaging(this.page,this.pageSize,function(t){t.data&&t.data.length?(this.loadItems(t.data),this.checkLoadPage()):this.emptyLoadContent()}.bind(this))},loadItemRow:function(t,e,a){var o=t.insertRow(-1).addClass("o2_homepage_task_item_row"),s=(this.page-1)*this.pageSize+a+1,i=s>99?"···":s,n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_number"),r=(new Element("div.o2_homepage_task_item_number",{text:i,title:s}).inject(n),"["+e.processName+"] "+o2.txt(e.title||this.app.lp.noSubject));n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_subject"),new Element("div.o2_homepage_task_item_subject",{html:r,title:r}).inject(n),routeName=e.routeName||this.app.lp.nextActivity,n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_activity"),new Element("div.o2_homepage_task_item_activity",{text:routeName,title:this.app.lp.taskRoute+": "+routeName}).inject(n),n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_creator"),new Element("div.o2_homepage_task_item_creator",{text:o2.name.cn(e.creatorPerson),title:this.app.lp.draftUser+": "+o2.name.cn(e.creatorPerson)}).inject(n);var d=e.completedTime.substr(0,10);return n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_time"),new Element("div.o2_homepage_task_item_time",{text:d,title:this.app.lp.taskCompletedTime+": "+d}).inject(n),o},checkLoadPage:function(){this.content.itemCounts&&this.content.itemCounts.taskCompleted?(this.getPageCount(),this.loadPage()):this.addLoadPageEvent()},addLoadPageEvent:function(){var t=function(){this.getPageCount(),this.loadPage(),this.content.removeEvent("loadTaskCompletedCount",t)}.bind(this);this.content.addEvent("loadTaskCompletedCount",t)},getPageCount:function(){var t=this.content.itemCounts.taskCompleted/this.pageSize,e=t.toInt();this.pages=e===t?e:e+1},open:function(t,e){var a={jobId:e.job,appId:"process.Work"+e.job,priorityWork:e.work,onAfterProcess:this.reloadTasks.bind(this),onAfterReset:this.reloadTasks.bind(this),onAfterRetract:this.reloadTasks.bind(this),onAfterReroute:this.reloadTasks.bind(this),onAfterDelete:this.reloadTasks.bind(this),onAfterReaded:this.reloadReads.bind(this)};layout.openApplication(t,"process.Work",a)}}),MWF.xApplication.Homepage.TaskContent.Read=new Class({Extends:MWF.xApplication.Homepage.TaskContent.TaskCompleted,Implements:[Options,Events],options:{type:"read"},loadItemsRes:function(){o2.Actions.load("x_processplatform_assemble_surface").ReadAction.listMyPaging(this.page,this.pageSize,function(t){t.data&&t.data.length?(this.loadItems(t.data),this.checkLoadPage()):this.emptyLoadContent()}.bind(this))},loadItemRow:function(t,e,a){var o=t.insertRow(-1).addClass("o2_homepage_task_item_row"),s=(this.page-1)*this.pageSize+a+1,i=s>99?"···":s,n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_number"),r=(new Element("div.o2_homepage_task_item_number",{text:i,title:s}).inject(n),"["+e.processName+"] "+o2.txt(e.title||this.app.lp.noSubject));n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_subject"),new Element("div.o2_homepage_task_item_subject",{html:r,title:r}).inject(n),n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_creator"),new Element("div.o2_homepage_task_item_creator",{text:o2.name.cn(e.creatorPerson),title:this.app.lp.draftUser+": "+o2.name.cn(e.creatorPerson)}).inject(n);var d=e.startTime.substr(0,10);return n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_time"),new Element("div.o2_homepage_task_item_time",{text:d,title:this.app.lp.readStartTime+": "+d}).inject(n),o},checkLoadPage:function(){this.content.itemCounts&&this.content.itemCounts.read?(this.getPageCount(),this.loadPage()):this.addLoadPageEvent()},addLoadPageEvent:function(){var t=function(){this.getPageCount(),this.loadPage(),this.content.removeEvent("loadReadCount",t)}.bind(this);this.content.addEvent("loadReadCount",t)},getPageCount:function(){var t=this.content.itemCounts.read/this.pageSize,e=t.toInt();this.pages=e===t?e:e+1},open:function(t,e){var a={jobId:e.job,appId:"process.Work"+e.job,priorityWork:e.work,onAfterProcess:this.reloadTasks.bind(this),onAfterReset:this.reloadTasks.bind(this),onAfterRetract:this.reloadTasks.bind(this),onAfterReroute:this.reloadTasks.bind(this),onAfterDelete:this.reloadTasks.bind(this),onAfterReaded:this.reloadReads.bind(this)};layout.openApplication(t,"process.Work",a)}}),MWF.xApplication.Homepage.TaskContent.ReadCompleted=new Class({Extends:MWF.xApplication.Homepage.TaskContent.TaskCompleted,Implements:[Options,Events],options:{type:"readCompleted"},loadItemsRes:function(){o2.Actions.load("x_processplatform_assemble_surface").ReadCompletedAction.listMyPaging(this.page,this.pageSize,function(t){t.data&&t.data.length?(this.loadItems(t.data),this.checkLoadPage()):this.emptyLoadContent()}.bind(this))},loadItemRow:function(t,e,a){var o=t.insertRow(-1).addClass("o2_homepage_task_item_row"),s=(this.page-1)*this.pageSize+a+1,i=s>99?"···":s,n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_number"),r=(new Element("div.o2_homepage_task_item_number",{text:i,title:s}).inject(n),"["+e.processName+"] "+o2.txt(e.title||this.app.lp.noSubject));n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_subject"),new Element("div.o2_homepage_task_item_subject",{html:r,title:r}).inject(n),n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_creator"),new Element("div.o2_homepage_task_item_creator",{text:o2.name.cn(e.creatorPerson),title:this.app.lp.draftUser+": "+o2.name.cn(e.creatorPerson)}).inject(n);var d=e.completedTime.substr(0,10);return n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_time"),new Element("div.o2_homepage_task_item_time",{text:d,title:this.app.lp.readCompletedTime+": "+d}).inject(n),o},checkLoadPage:function(){this.content.itemCounts&&this.content.itemCounts.readCompleted?(this.getPageCount(),this.loadPage()):this.addLoadPageEvent()},addLoadPageEvent:function(){var t=function(){this.getPageCount(),this.loadPage(),this.content.removeEvent("loadReadCompletedCount",t)}.bind(this);this.content.addEvent("loadReadCompletedCount",t)},getPageCount:function(){var t=this.content.itemCounts.readCompleted/this.pageSize,e=t.toInt();this.pages=e===t?e:e+1},open:function(t,e){var a={jobId:e.job,appId:"process.Work"+e.job,priorityWork:e.work,onAfterProcess:this.reloadTasks.bind(this),onAfterReset:this.reloadTasks.bind(this),onAfterRetract:this.reloadTasks.bind(this),onAfterReroute:this.reloadTasks.bind(this),onAfterDelete:this.reloadTasks.bind(this),onAfterReaded:this.reloadReads.bind(this)};layout.openApplication(t,"process.Work",a)}}),MWF.xApplication.Homepage.TaskContent.Draft=new Class({Extends:MWF.xApplication.Homepage.TaskContent.TaskCompleted,Implements:[Options,Events],options:{type:"draft"},loadItemsRes:function(){o2.Actions.load("x_processplatform_assemble_surface").ReviewAction.V2ListCreatePaging(this.page,this.pageSize,{relateTask:!0},function(t){t.data&&t.data.length?(this.loadItems(t.data),this.checkLoadPage()):this.emptyLoadContent()}.bind(this))},loadItemRow:function(t,e,a){var o=t.insertRow(-1).addClass("o2_homepage_task_item_row"),s=(this.page-1)*this.pageSize+a+1,i=s>99?"···":s,n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_number"),r=(new Element("div.o2_homepage_task_item_number",{text:i,title:s}).inject(n),"["+e.processName+"] "+o2.txt(e.title||this.app.lp.noSubject));n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_subject"),new Element("div.o2_homepage_task_item_subject",{html:r,title:r}).inject(n);var d=[],h=[];e.taskList.each((function(t){var e=o2.name.cn(t.person);-1==h.indexOf(e)&&h.push(e),-1==d.indexOf(t.activityName)&&d.push(t.activityName)})),n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_activity"),new Element("div.o2_homepage_task_item_activity",{text:d.join(","),title:this.app.lp.currentActivity+": "+d.join(",")}).inject(n),n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_creator"),new Element("div.o2_homepage_task_item_creator",{text:h.join(","),title:this.app.lp.currentUser+": "+h.join(",")}).inject(n);var l=e.createTime.substr(0,10);return n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_time"),new Element("div.o2_homepage_task_item_time",{text:l,title:this.app.lp.draftTime+": "+l}).inject(n),o},checkLoadPage:function(){this.content.itemCounts&&this.content.itemCounts.draft?(this.getPageCount(),this.loadPage()):this.addLoadPageEvent()},addLoadPageEvent:function(){var t=function(){this.getPageCount(),this.loadPage(),this.content.removeEvent("loadDraftCount",t)}.bind(this);this.content.addEvent("loadDraftCount",t)},getPageCount:function(){var t=this.content.itemCounts.draft/this.pageSize,e=t.toInt();this.pages=e===t?e:e+1},open:function(t,e){var a={jobId:e.job,appId:"process.Work"+e.job,priorityWork:e.work,onAfterProcess:this.reloadTasks.bind(this),onAfterReset:this.reloadTasks.bind(this),onAfterRetract:this.reloadTasks.bind(this),onAfterReroute:this.reloadTasks.bind(this),onAfterDelete:this.reloadTasks.bind(this),onAfterReaded:this.reloadReads.bind(this)};layout.openApplication(t,"process.Work",a)}}),MWF.xApplication.Homepage.TaskContent.ProcessDraft=new Class({Extends:MWF.xApplication.Homepage.TaskContent.TaskCompleted,Implements:[Options,Events],options:{type:"processDraft"},loadItemsRes:function(){o2.Actions.load("x_processplatform_assemble_surface").DraftAction.listMyPaging(this.page,this.pageSize,{},function(t){t.data&&t.data.length?(this.loadItems(t.data),this.checkLoadPage()):this.emptyLoadContent()}.bind(this))},loadItemRow:function(t,e,a){var o=t.insertRow(-1).addClass("o2_homepage_task_item_row"),s=(this.page-1)*this.pageSize+a+1,i=s>99?"···":s,n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_number"),r=(new Element("div.o2_homepage_task_item_number",{text:i,title:s}).inject(n),"["+e.processName+"] "+o2.txt(e.title||this.app.lp.noSubject));n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_subject"),new Element("div.o2_homepage_task_item_subject",{html:r,title:r}).inject(n),n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_activity"),new Element("div.o2_homepage_task_item_activity",{text:this.app.lp.myProcessDraft,title:this.app.lp.currentActivity+": "+this.app.lp.myProcessDraft}).inject(n);var d=o2.name.cn(layout.session.user.name);n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_creator"),new Element("div.o2_homepage_task_item_creator",{text:d,title:this.app.lp.currentUser+": "+d}).inject(n);var h=e.createTime.substr(0,10);return n=o.insertCell(-1).addClass("o2_homepage_task_item_cell_time"),new Element("div.o2_homepage_task_item_time",{text:h,title:this.app.lp.draftTime+": "+h}).inject(n),o},checkLoadPage:function(){this.content.itemCounts&&this.content.itemCounts.processDraft?(this.getPageCount(),this.loadPage()):this.addLoadPageEvent()},addLoadPageEvent:function(){var t=function(){this.getPageCount(),this.loadPage(),this.content.removeEvent("loadProcessDraftCount",t)}.bind(this);this.content.addEvent("loadProcessDraftCount",t)},getPageCount:function(){var t=this.content.itemCounts.processDraft/this.pageSize,e=t.toInt();this.pages=e===t?e:e+1},open:function(t,e){var a={draftId:e.id,appId:"process.Work"+e.id,onAfterProcess:this.reloadTasks.bind(this),onAfterReset:this.reloadTasks.bind(this),onAfterRetract:this.reloadTasks.bind(this),onAfterReroute:this.reloadTasks.bind(this),onAfterDelete:this.reloadTasks.bind(this),onAfterReaded:this.reloadReads.bind(this)};layout.openApplication(t,"process.Work",a)}});