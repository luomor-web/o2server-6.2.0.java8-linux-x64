MWF.require("MWF.widget.O2Identity",null,!1),MWF.xApplication.Org.PrivateConfig=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",lp:{}},initialize:function(t,e,i){this.setOptions(i),this.restLoadActions=MWF.Actions.load("x_organization_assemble_control"),this.node=$(t)},_isActionManager:function(){return MWF.AC.isOrganizationManager()||MWF.AC.isPersonManager()||MWF.AC.isUnitManager()},_loadLp:function(){this.options.lp={queryPrivateConfigTitle:this.app.lp.queryPrivateConfigTitle,queryPrivateConfigExcludUnit:this.app.lp.queryPrivateConfigExcludUnit,queryPrivateConfigExcludPerson:this.app.lp.queryPrivateConfigExcludPerson,queryPrivateConfigLimitOuter:this.app.lp.queryPrivateConfigLimitOuter,queryPrivateConfigLimitAll:this.app.lp.queryPrivateConfigLimitAll,queryPrivateConfigDescribe:this.app.lp.queryPrivateConfigDescribe,queryPrivateConfigBtnEdit:this.app.lp.queryPrivateConfigBtnEdit,queryPrivateConfigBtnSave:this.app.lp.queryPrivateConfigBtnSave,queryPrivateConfigBtnCancel:this.app.lp.queryPrivateConfigBtnCancel}},_loadConfig:function(){this.ConfigContent=new MWF.xApplication.Org.PrivateConfig.ConfigContent(this),this.ConfigContent.load()},load:function(){this._loadLp(),this._loadConfig()}}),MWF.xApplication.Org.PrivateConfig.ConfigContent=new Class({initialize:function(t){this.content=t,this.lp=this.content.options.lp,this.restLoadActions=MWF.Actions.load("x_organization_assemble_control"),this.data={},this.data.id="",this.data.excludeUnit=[],this.data.excludePerson=[],this.data.limitQueryOuter=[],this.data.limitQueryAll=[],this.data.explain="",this.data.status="发布",this.contentNode=this.content.node,this.mode="read"},load:function(){this.restLoadActions.PermissionSettingAction.list(function(t){t.data.length&&(this.data=t.data[0])}.bind(this),null,!1),this.node=new Element("div").inject(this.contentNode),this.editContentNode=new Element("div").inject(this.node),this.editContentNode.set("html",this.getContentHtml());var t=this.editContentNode.getElement(".excludeUnit"),e=[];this.data.excludeUnit.each((function(t){e.push(t.split("@")[0])})),t&&t.set("text",e.join()||""),e=[],this.data.excludePerson.each((function(t){e.push(t.split("@")[0])})),(t=this.editContentNode.getElement(".excludePerson"))&&t.set("text",e.join()||""),e=[],this.data.limitQueryOuter.each((function(t){e.push(t.split("@")[0])})),(t=this.editContentNode.getElement(".limitQueryOuter"))&&t.set("text",e.join()||""),e=[],this.data.limitQueryAll.each((function(t){e.push(t.split("@")[0])})),(t=this.editContentNode.getElement(".limitQueryAll"))&&t.set("text",e.join()||""),(t=this.editContentNode.getElement(".explain"))&&t.set("text",this.data.explain||"");this.editContentNode.getElements("td.inforContent");this.loadAction()},getContentHtml:function(){var t="<table class='queryPrivateConfigTable'>";return t+="<tr><td class='tabletitle' colspan=2>"+this.lp.queryPrivateConfigTitle+"</td></tr>",t+="<tr><td class='inforTitle'>"+this.lp.queryPrivateConfigExcludUnit+":</td><td class='inforContent excludeUnit'></td></tr>",t+="<td class='inforTitle'>"+this.lp.queryPrivateConfigExcludPerson+":</td><td class='inforContent excludePerson'></td></tr>",t+="<tr><td class='inforTitle'>"+this.lp.queryPrivateConfigLimitOuter+":</td><td class='inforContent limitQueryOuter'></td></tr>",t+="<td class='inforTitle'>"+this.lp.queryPrivateConfigLimitAll+":</td><td class='inforContent limitQueryAll'></td></tr>",t+="<tr><td class='inforTitle'>"+this.lp.queryPrivateConfigDescribe+":</td><td class='inforContent explain'></td></tr>",t+="<tr><td colspan='2' class='inforAction'></td></tr>"},loadAction:function(){var t=this.editContentNode.getElements("td"),e=t[t.length-1];(MWF.AC.isOrganizationManager()||MWF.AC.isPersonManager()||MWF.AC.isUnitManager())&&(this.baseInforEditActionAreaNode=new Element("div",{class:"queryPrivateConfigBtnNode"}).inject(e),this.editNode=new Element("div",{class:"queryPrivateConfigBtnEditNode",text:this.lp.queryPrivateConfigBtnEdit}).inject(this.baseInforEditActionAreaNode),this.saveNode=new Element("div",{class:"queryPrivateConfigBtnSaveNode",text:this.lp.queryPrivateConfigBtnSave}).inject(this.baseInforEditActionAreaNode),this.cancelNode=new Element("div",{class:"queryPrivateConfigBtnCancelNode",text:this.lp.queryPrivateConfigBtnCancel}).inject(this.baseInforEditActionAreaNode),this.editNode.setStyle("display","block"),this.editNode.addEvent("click",this.edit.bind(this)),this.saveNode.addEvent("click",this.save.bind(this)),this.cancelNode.addEvent("click",this.cancel.bind(this)))},edit:function(){var t=this.editContentNode.getElements("td.inforContent");t[0].empty(),this.excludeUnitInputNode=new Element("div",{class:"inputPersonNode"}).inject(t[0]),this.data.excludeUnit&&this.data.excludeUnit.each(function(t){new MWF.widget.O2Unit({name:t.split("@")[0]},this.excludeUnitInputNode,{style:"xform"})}.bind(this)),this.excludeUnitInputNode.addEvent("click",function(){MWF.xDesktop.requireApp("Selector","package",function(){var t={type:"unit",values:this.data.excludeUnit,count:0,onComplete:function(t){var e=[],i=[];t.each((function(t){e.push(t.data.id),i.push(t.data.distinguishedName)})),this.data.excludeUnit=i,this.excludeUnitInputNode.empty(),this.data.excludeUnit.each(function(t){new MWF.widget.O2Unit({name:t.split("@")[0]},this.excludeUnitInputNode,{style:"xform"})}.bind(this))}.bind(this)};new MWF.O2Selector(this.contentNode,t)}.bind(this))}.bind(this)),t[1].empty(),this.excludePersonInputNode=new Element("div",{class:"inputPersonNode"}).inject(t[1]),this.data.excludePerson&&this.data.excludePerson.each(function(t){new MWF.widget.O2Person({name:t.split("@")[0]},this.excludePersonInputNode,{style:"xform"})}.bind(this)),this.excludePersonInputNode.addEvent("click",function(){MWF.xDesktop.requireApp("Selector","package",function(){var t={type:"person",values:this.data.excludePerson,count:0,onComplete:function(t){var e=[],i=[];t.each((function(t){e.push(t.data.id),i.push(t.data.distinguishedName)})),this.data.excludePerson=i,this.excludePersonInputNode.empty(),this.data.excludePerson.each(function(t){new MWF.widget.O2Person({name:t.split("@")[0]},this.excludePersonInputNode,{style:"xform"})}.bind(this))}.bind(this)};new MWF.O2Selector(this.contentNode,t)}.bind(this))}.bind(this)),t[2].empty(),this.limitQueryOuterInputNode=new Element("div",{class:"inputPersonNode"}).inject(t[2]),this.data.limitQueryOuter&&this.data.limitQueryOuter.each(function(t){new MWF.widget.O2Person({name:t.split("@")[0]},this.limitQueryOuterInputNode,{style:"xform"})}.bind(this)),this.limitQueryOuterInputNode.addEvent("click",function(){MWF.xDesktop.requireApp("Selector","package",function(){var t={type:"person",values:this.data.limitQueryOuter,count:0,onComplete:function(t){var e=[],i=[];t.each((function(t){e.push(t.data.id),i.push(t.data.distinguishedName)})),this.data.limitQueryOuter=i,this.limitQueryOuterInputNode.empty(),this.data.limitQueryOuter.each(function(t){new MWF.widget.O2Person({name:t.split("@")[0]},this.limitQueryOuterInputNode,{style:"xform"})}.bind(this))}.bind(this)};new MWF.O2Selector(this.contentNode,t)}.bind(this))}.bind(this)),t[3].empty(),this.limitQueryAllInputNode=new Element("div",{class:"inputPersonNode"}).inject(t[3]),this.data.limitQueryAll&&this.data.limitQueryAll.each(function(t){new MWF.widget.O2Person({name:t.split("@")[0]},this.limitQueryAllInputNode,{style:"xform"})}.bind(this)),this.limitQueryAllInputNode.addEvent("click",function(){MWF.xDesktop.requireApp("Selector","package",function(){var t={type:"person",values:this.data.limitQueryAll,count:0,onComplete:function(t){var e=[],i=[];t.each((function(t){e.push(t.data.id),i.push(t.data.distinguishedName)})),this.data.limitQueryAll=i,this.limitQueryAllInputNode.empty(),this.data.limitQueryAll.each(function(t){new MWF.widget.O2Person({name:t.split("@")[0]},this.limitQueryAllInputNode,{style:"xform"})}.bind(this))}.bind(this)};new MWF.O2Selector(this.contentNode,t)}.bind(this))}.bind(this)),t[4].empty(),this.explainInputNode=new Element("input",{class:"inputNode"}).inject(t[4]),this.explainInputNode.set("value",this.data.explain);this.mode="edit",this.editNode.setStyle("display","none"),this.saveNode.setStyle("display","block"),this.cancelNode.setStyle("display","block")},save:function(){var t=this.editContentNode.getElements("td.inforContent");this.data.explain=t[4].getElements(".inputNode")[0].get("value"),""==this.data.id?this.restLoadActions.PermissionSettingAction.create(this.data,function(t){data=t.data,this.cancel()}.bind(this),null,!1):this.restLoadActions.PermissionSettingAction.update(this.data.id,this.data,function(t){data=t.data,this.cancel()}.bind(this),null,!1)},cancel:function(){this.node.empty(),this.load()},destroy:function(){this.node.empty(),this.node.destroy(),MWF.release(this)}});