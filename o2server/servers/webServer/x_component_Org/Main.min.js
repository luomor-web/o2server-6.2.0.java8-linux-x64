MWF.xApplication.Org.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"Org",icon:"icon.png",width:layout.desktop.size?.7*layout.desktop.size.x:1e3,height:layout.desktop.size?.8*layout.desktop.size.y:800,title:MWF.xApplication.Org.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.Org.LP,this.restActions=MWF.Actions.get("x_organization_assemble_control")},loadApplication:function(t){this.createNode(),this.loadApplicationContent(),t&&t()},createNode:function(){this.content.setStyle("overflow","hidden"),this.node=new Element("div",{styles:{width:"100%",height:"100%",overflow:"hidden"}}).inject(this.content)},loadApplicationContent:function(){this.loadStartMenu()},loadStartMenu:function(){this.startMenuNode=new Element("div",{styles:this.css.startMenuNode}).inject(this.node),this.menu=new MWF.xApplication.Org.Menu(this,this.startMenuNode,{onPostLoad:function(){this.status&&null!==this.status.navi&&this.menu.doAction(this.menu.startNavis[this.status.navi])}.bind(this)}),this.addEvent("resize",function(){this.menu&&this.menu.onResize()}.bind(this))},clearContent:function(){this.orgConfiguratorContentNode&&(this.orgConfigurator&&(this.orgConfigurator.destroy(),this.orgConfigurator=null),this.orgConfiguratorContentNode.destroy(),this.orgConfiguratorContentNode=null),this.identityConfiguratorContentNode&&(this.identityConfigurator&&delete this.identityConfigurator,this.identityConfiguratorContentNode.destroy()),this.groupConfiguratorContentNode&&(this.groupConfigurator&&(this.groupConfigurator.destroy(),this.groupConfigurator=null),this.groupConfiguratorContentNode.destroy()),this.roleConfiguratorContentNode&&(this.roleConfigurator&&(this.roleConfigurator.destroy(),this.roleConfigurator=null),this.roleConfiguratorContentNode.destroy()),this.personConfiguratorContentNode&&(this.personConfigurator&&(this.personConfigurator.destroy(),this.personConfigurator=null),this.personConfiguratorContentNode.destroy()),this.importConfiguratorContentNode&&this.importConfiguratorContentNode.destroy(),this.privateNamesQueryPowerContentNode&&this.privateNamesQueryPowerContentNode.destroy(),this.pingyinArea&&this.pingyinArea.empty()},orgConfig:function(){this.clearContent(),this.orgConfiguratorContentNode=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadOrgConfig()},loadOrgConfig:function(){MWF.xDesktop.requireApp("Org","UnitExplorer",function(){this.orgConfigurator=new MWF.xApplication.Org.UnitExplorer(this.orgConfiguratorContentNode,this.restActions),this.orgConfigurator.app=this,this.orgConfigurator.load()}.bind(this))},groupConfig:function(){this.clearContent(),this.groupConfiguratorContentNode=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadGroupConfig()},loadGroupConfig:function(){MWF.xDesktop.requireApp("Org","GroupExplorer",function(){this.groupConfigurator=new MWF.xApplication.Org.GroupExplorer(this.groupConfiguratorContentNode,this.restActions),this.groupConfigurator.app=this,this.groupConfigurator.load()}.bind(this))},roleConfig:function(){this.clearContent(),this.roleConfiguratorContentNode=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadRoleConfig()},loadRoleConfig:function(){MWF.xDesktop.requireApp("Org","RoleExplorer",function(){this.roleConfigurator=new MWF.xApplication.Org.RoleExplorer(this.roleConfiguratorContentNode,this.restActions),this.roleConfigurator.app=this,this.roleConfigurator.load()}.bind(this))},personConfig:function(){this.clearContent(),this.personConfiguratorContentNode=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadPersonConfig()},loadPersonConfig:function(){MWF.xDesktop.requireApp("Org","PersonExplorer",function(){this.personConfigurator=new MWF.xApplication.Org.PersonExplorer(this.personConfiguratorContentNode,this.restActions),this.personConfigurator.app=this,this.personConfigurator.load()}.bind(this))},personImport:function(){this.clearContent(),this.importConfiguratorContentNode=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.importConfiguratorContentNode.set("load",{onSuccess:function(){this.importPersonTitleNode=this.importConfiguratorContentNode.getElement(".importPersonTitleNode"),this.importPersonTemplateNode=this.importConfiguratorContentNode.getElement(".importPersonTemplateNode"),this.importPersonNode=this.importConfiguratorContentNode.getElement(".importPersonNode"),this.importPersonResultNode=this.importConfiguratorContentNode.getElement(".importPersonResultNode"),this.exportPersonNode=this.importConfiguratorContentNode.getElement(".exportPersonNode"),o2.loadCss(this.path+this.options.style+"/importCss.css",this.importConfiguratorContentNode,function(){this.loadPersonImport()}.bind(this))}.bind(this)}).load(this.path+this.options.style+"/importView.html")},loadPersonImport:function(){var t=o2.Actions.get("x_organization_assemble_control"),e=o2.filterUrl(t.action.address+t.action.actions.getImportPersonTemplate.uri),o=this.lp.importPersonInfor.replace("{url}",e);this.importPersonTitleNode.set("text",this.lp.importPersonTitle),this.importPersonTemplateNode.set("html",o),this.importPersonNode.set("text",this.lp.importPersonAction),this.importPersonNode.addEvent("click",function(){this.importPersonResultNode.hide(),o2.require("o2.widget.Upload",function(){new o2.widget.Upload(this.content,{action:"x_organization_assemble_control",method:"importPerson",multiple:!1,onCompleted:function(e){var o=o2.filterUrl(t.action.address+t.action.actions.getImportPersonResault.uri);o=o.replace("{flag}",e.data.flag);var i=this.lp.importPersonResult.replace("{url}",o);this.importPersonResultNode.set("html",i),this.importPersonResultNode.show()}.bind(this)}).load()}.bind(this))}.bind(this));var i=o2.filterUrl(o2.Actions.getHost("x_cms_assemble_control")+"/x_organization_assemble_control/jaxrs/export/export/all");this.exportPersonNode.set("text",this.lp.exportPersonText),this.exportPersonNode.set("href",i)},privateNamesQueryPower:function(){this.clearContent(),this.privateNamesQueryPowerContentNode=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.privateNamesQueryPowerContentNode.set("load",{onSuccess:function(){this.queryPrivateConfigAreaNode=this.privateNamesQueryPowerContentNode.getElement(".queryPrivateConfigAreaNode"),o2.loadCss(this.path+this.options.style+"/queryPrivateConfig.css",this.privateNamesQueryPowerContentNode,function(){this.loadprivateNamesQueryPower()}.bind(this))}.bind(this)}).load(this.path+this.options.style+"/queryPrivateConfigView.html")},loadprivateNamesQueryPower:function(){MWF.xDesktop.requireApp("Org","PrivateConfig",function(){this.privateConfigurator=new MWF.xApplication.Org.PrivateConfig(this.privateNamesQueryPowerContentNode),this.privateConfigurator.app=this,this.privateConfigurator.load()}.bind(this))},recordStatus:function(){var t=null;return this.menu.currentNavi&&(t=this.menu.startNavis.indexOf(this.menu.currentNavi)),{navi:t}}}),MWF.xApplication.Org.Menu=new Class({Implements:[Options,Events],initialize:function(t,e,o){this.setOptions(o),this.app=t,this.node=$(e),this.currentNavi=null,this.status="start",this.startNavis=[],this.load()},load:function(){var t=this.app.path+"startMenu.json";MWF.getJSON(t,function(t){t.each(function(t){if(t.display){var e=new Element("div",{styles:this.app.css.startMenuNaviNode,title:t.title});e.store("naviData",t),new Element("div",{styles:this.app.css.startMenuIconNode}).inject(e).setStyle("background-image","url("+this.app.path+this.app.options.style+"/icon/"+t.icon+"60.png)"),new Element("div",{styles:this.app.css.startMenuTextNode,text:t.title}).inject(e),e.inject(this.node),this.startNavis.push(e),this.setStartNaviEvent(e,t),this.setNodeCenter(this.node)}}.bind(this)),this.setStartMenuWidth(),this.fireEvent("postLoad")}.bind(this))},setStartNaviEvent:function(t){var e=this;t.addEvents({mouseover:function(){if(e.currentNavi!==this){var t=this.getFirst();this.setStyles(e.app.css.startMenuNaviNode_over);var o=this.retrieve("naviData");t.setStyle("background-image","url("+e.app.path+e.app.options.style+"/icon/"+o.icon+".png)"),t.setStyles(e.app.css.startMenuIconNode_over)}},mouseout:function(){var t=this.getFirst();e.currentNavi!==this&&this.setStyles(e.app.css.startMenuNaviNode);var o=this.retrieve("naviData");t.setStyle("background-image","url("+e.app.path+e.app.options.style+"/icon/"+o.icon+"60.png)"),t.setStyles(e.app.css.startMenuIconNode)},mousedown:function(){e.currentNavi!==this&&this.setStyles(e.app.css.startMenuNaviNode_down)},mouseup:function(){e.currentNavi!==this&&this.setStyles(e.app.css.startMenuNaviNode_over)},click:function(){e.doAction.apply(e,[this])}})},doAction:function(t){var e=t.retrieve("naviData").action;this.startNavis.each(function(t){t.removeEvents("mouseover"),t.removeEvents("mouseout"),t.removeEvents("mousedown"),t.removeEvents("mouseup"),t.setStyles(this.app.css.startMenuNaviLeftNode);var e=t.getFirst(),o=t.getLast(),i=t.retrieve("naviData");e.setStyle("background-image","url("+this.app.path+this.app.options.style+"/icon/"+i.icon+"32.png)"),e.setStyles(this.app.css.startMenuIconLeftNode),o.setStyles(this.app.css.startMenuTextLeftNode)}.bind(this)),t.setStyles(this.app.css.startMenuNaviLeftNode_current),this.currentNavi=t,"start"===this.status&&(this.toNormal(),this.status="normal"),this.app[e]&&this.app[e].apply(this.app)},toNormal:function(){var t=this.app.css.normalStartMenuNode;this.morph||(this.morph=new Fx.Morph(this.node,{duration:50,link:"chain"})),this.app.pingyinArea=new Element("div",{styles:this.app.css.startMenuNaviLeftPingyinNode}).inject(this.node,"top"),this.morph.start(t).chain(function(){this.node.setStyles(t)}.bind(this))},setNodeCenter:function(t){var e=t.getSize(),o=this.app.node.getSize(),i=o.y/2-e.y/2,n=o.x/2-e.x/2;n<0&&(n=0),i<0&&(i=0),t.setStyles({left:n,top:i})},getStartMenuNormalSize:function(){var t=this.node.getFirst(),e=t.getComputedSize(),o=t.getStyle("margin-top").toFloat(),i=t.getStyle("margin-bottom").toFloat(),n=e.totalWidth+o+i,s=t.getStyle("margin-left").toFloat(),r=t.getStyle("margin-right").toFloat();return{width:e.totalWidth+s+r,height:n*this.startNavis.length}},setStartMenuWidth:function(){var t=this.node.getFirst(),e=t.getComputedSize(),o=t.getStyle("margin-left").toFloat(),i=t.getStyle("margin-right").toFloat(),n=e.totalWidth+o+i;this.node.setStyle("width",n*this.startNavis.length+"px")},onResize:function(){"start"===this.status&&this.setNodeCenter(this.node)}});