MWF.xDesktop.requireApp("Org","$Explorer",null,!1),MWF.require("MWF.widget.O2Identity",null,!1),MWF.xApplication.Org.PersonExplorer=new Class({Extends:MWF.xApplication.Org.$Explorer,Implements:[Options,Events],options:{style:"default"},_isActionManager:function(){return MWF.AC.isOrganizationManager()||MWF.AC.isPersonManager()||MWF.AC.isUnitManager()},_listElementNext:function(t,e,i){this.actions.listPersonNext(t||"(0)",e,function(t){i&&i.apply(this,[t])}.bind(this))},_newElement:function(t,e,i){return new MWF.xApplication.Org.PersonExplorer.Person(t,e,this.isEditor,i)},_listElementByKey:function(t,e,i){this.actions.listPersonByKey(function(e){t&&t.apply(this,[e])}.bind(this),e,i)},_getAddElementData:function(){return{genderType:"m",signature:"",description:"",unique:"",orderNumber:"",superior:"",officePhone:"",boardDate:"",birthday:"",employee:"",password:"",display:"",qq:"",mail:"",weixin:"",weibo:"",mobile:"",name:"",ipAddress:"",controllerList:[],woPersonAttributeList:[],woIdentityList:[],control:{allowEdit:!0,allowDelete:!0}}}}),MWF.xApplication.Org.PersonExplorer.Person=new Class({Extends:MWF.xApplication.Org.$Explorer.Item,showItemProperty:function(){this.content=new MWF.xApplication.Org.PersonExplorer.PersonContent(this)},_loadTextNode:function(){var t="<div style='float:left; height:50px; overflow:hidden'>"+this.data.name+"</div>";t+="<div style='float: right; overflow:hidden; font-size: 12px; color: #aaaaaa;'>"+(this.data.mobile||"")+"</div>",this.textNode.set({html:t})},delete:function(t,e){this.explorer.actions.deletePerson(this.data.id,function(){this.destroy(),t&&t()}.bind(this),(function(t,i,n){var s=n;t&&(s=t.responseText),MWF.xDesktop.notice("error",{x:"right",y:"top"},"request json error: "+s),e&&e()}))},_getIcon:function(t){var e=this.data.id?this.explorer.actions.getPersonIcon(this.data.id):"../x_component_Org/$Explorer/default/icon/man.png";return t?e+"?"+(new Date).getTime():e}}),MWF.xApplication.Org.PersonExplorer.PersonContent=new Class({Extends:MWF.xApplication.Org.$Explorer.ItemContent,_getData:function(t){this.item.data.id?this.explorer.actions.getPerson(function(e){this.data=e.data,this.item.data=e.data,t&&t()}.bind(this),null,this.item.data.id):(this.data=this.item.data,t&&t())},edit:function(){this.baseInfor&&this.baseInfor.edit()},_showItemPropertyTitle:function(){this.titleInfor=new MWF.xApplication.Org.PersonExplorer.PersonContent.TitleInfor(this)},_showItemPropertyBottom:function(){this.bottomInfor=new MWF.xApplication.Org.PersonExplorer.PersonContent.BottomInfor(this)},loadItemPropertyTab:function(t){this.propertyTabContainerNode=new Element("div",{styles:this.item.style.tabTitleNode}).inject(this.propertyContentNode,"top"),MWF.require("MWF.widget.Tab",function(){this.propertyTab=new MWF.widget.Tab(this.propertyContentNode,{style:"unit"}),this.propertyTab.load(),this.propertyTab.tabNodeContainer.inject(this.propertyTabContainerNode),this.propertyTab.tabNodeContainer.setStyle("width","480px"),t&&t()}.bind(this))},_loadTabs:function(){this.baseContentNode=new Element("div",{styles:this.item.style.tabContentNode}),this.basePage=this.propertyTab.addTab(this.baseContentNode,this.explorer.app.lp.personBaseText),this.attributeContentNode=new Element("div",{styles:this.item.style.tabContentNode}),this.attributePage=this.propertyTab.addTab(this.attributeContentNode,this.explorer.app.lp.personAttributeText),this.identityContentNode=new Element("div",{styles:this.item.style.tabContentNode}),this.identityPage=this.propertyTab.addTab(this.identityContentNode,this.explorer.app.lp.personIdentityText),this.roleContentNode=new Element("div",{styles:this.item.style.tabContentNode}),this.rolePage=this.propertyTab.addTab(this.roleContentNode,this.explorer.app.lp.personRoleText)},_loadContent:function(){this._listBaseInfor(),this.data&&this.data.id&&(this._listAttribute(),this._listIdentity(),this._listRole(),this.loadListCount())},loadList:function(){this._listAttribute(),this._listIdentity(),this._listRole(),this.loadListCount()},loadListCount:function(){if(this.data.woIdentityList){var t=this.data.woIdentityList.length;t?this.identityCountNode?this.identityCountNode.set("text",t):this.identityCountNode=new Element("div",{styles:this.item.style.tabCountNode,text:t}).inject(this.identityPage.tabNode):this.identityCountNode&&this.identityCountNode.destroy()}if(this.data.woPersonAttributeList){var e=this.data.woPersonAttributeList.length;e?this.attributeCountNode?this.attributeCountNode.set("text",e):this.attributeCountNode=new Element("div",{styles:this.item.style.tabCountNode,text:e}).inject(this.attributePage.tabNode):this.attributeCountNode&&this.attributeCountNode.destroy()}if(this.roleDataList){var i=this.roleDataList.length;i?this.roleCountNode?this.roleCountNode.set("text",i):this.roleCountNode=new Element("div",{styles:this.item.style.tabCountNode,text:i}).inject(this.rolePage.tabNode):this.roleCountNode&&this.roleCountNode.destroy()}},_listBaseInfor:function(){this.baseInfor=new MWF.xApplication.Org.PersonExplorer.PersonContent.BaseInfor(this)},_listAttribute:function(){this.attributeList=new MWF.xApplication.Org.List(this.attributeContentNode,this,{action:this.data.control.allowEdit,data:{person:this.data.id,name:"",unique:"",orderNumber:"",attributeList:[],description:""},attr:["name",{get:function(){return this.attributeList.join(",")},set:function(t){this.attributeList=t.split(/,\s*/g)}},"description"],onPostSave:function(t,e){t.data.id||(t.data.id=e,this.data.woPersonAttributeList.push(t.data)),this.loadListCount()}.bind(this),onPostDelete:function(t){if(this.attributeCountNode){var e=this.attributeCountNode.get("text").toInt()-t;this.attributeCountNode.set("text",e)}}.bind(this)}),this.attributeList.load([{style:"width: 20%",text:this.explorer.app.lp.attributeName},{style:"",text:this.explorer.app.lp.attributeValue},{style:"",text:this.explorer.app.lp.description}]),this.data.woPersonAttributeList.each(function(t){this.attributeList.push(t)}.bind(this))},_listIdentity:function(){var t=this;this.identityList=new MWF.xApplication.Org.List(this.identityContentNode,this,{action:!1,canEdit:!1,saveAction:"saveIdentity",data:{person:this.data.id,name:"",attributeList:[]},attr:["name",{get:function(){return""},events:{init:function(){var t=this.td;new MWF.widget.O2Unit(this.data.woUnit,t,{style:"xform"})}}},{get:function(){return this.distinguishedName},set:function(t){this.distinguishedName=t}},{get:function(){return""},events:{init:function(){var t=this.td;this.data.woUnitDutyList&&this.data.woUnitDutyList.each(function(e){new MWF.widget.O2Duty(e,t,{style:"xform"})}.bind(this))}}},{getHtml:function(){return this.major?"<div style='width:24px; height:24px; background:url(../x_component_Org/$Explorer/"+t.explorer.app.options.style+"/icon/mainid.png) center center no-repeat'></div>":"<div title='"+t.explorer.app.lp.setIdentityMain+"' style='width:24px; height:24px; cursor: pointer; background:url(../x_component_Org/$Explorer/"+t.explorer.app.options.style+"/icon/select.png) center center no-repeat'></div>"},events:{click:function(){this.data.major||t.data.control.allowEdit&&t.setMainIdentity(this.data,this.td,this.item)}}},{getHtml:function(){return t.data.control.allowEdit?"<div style='width:24px; height:24px; cursor: pointer; background:url(../x_component_Org/$Explorer/"+t.explorer.app.options.style+"/icon/edit.png) center center no-repeat'></div>":""},events:{click:function(){t.data.control.allowEdit&&t.editIdentity(this.data,this.td,this.item)}}}]}),this.identityList.load([{style:"width: 12%",text:this.explorer.app.lp.IdentityName},{style:"width: 12%",text:this.explorer.app.lp.IdentityInUnit},{style:"width: 44%",text:this.explorer.app.lp.personUnique},{style:"width: 20%",text:this.explorer.app.lp.IdentityDuty},{style:"width: 10%",text:this.explorer.app.lp.IdentityMain},{style:"width: 30px",text:""}]),this.data.woIdentityList.each(function(t){this.identityList.push(t)}.bind(this))},setMainIdentity:function(t,e,i){t.major=!0,this.explorer.actions.saveIdentity(t,function(t){this.explorer.actions.getPerson(function(t){this.data.woIdentityList=t.data.woIdentityList,this.identityList.clear(),this.data.woIdentityList.each(function(t){this.identityList.push(t)}.bind(this))}.bind(this),null,this.data.id)}.bind(this))},editIdentity:function(t,e,i){var n=this,s=e.getPosition(this.explorer.app.content),o=this.explorer.app.content.getSize(),a=(o.x-700)/2,r=(o.y-170)/2;a<0&&(a=0),r<20&&(r=20),MWF.require("MWF.xDesktop.Dialog",function(){var e=new MWF.xDesktop.Dialog({title:this.explorer.app.lp.modifyIdentity,style:"org",top:r-20,left:a,fromTop:s.y-20,fromLeft:s.x,width:700,height:170,html:"<div></div>",maskNode:this.explorer.app.content,container:this.explorer.app.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){n.saveIdentity(e,t,i),this.close()}},{text:MWF.LP.process.button.cancel,action:function(){this.close()}}]});e.show();var o=e.content.getFirst(),d="<table width='90%' cellpadding='0px' cellspacing='5px' align='center' style='margin-top:10px'><tr><th width='30%'>"+this.explorer.app.lp.IdentityName+"</th><th>"+this.explorer.app.lp.personUnique+"</th><th>"+this.explorer.app.lp.IdentityMain+"</th></tr><tr><td style='text-align: center'><input value='' type='type' style='padding: 0px 3px; width: 95%; border: 1px solid #cccccc; height: 24px; border-radius: 3px; line-height: 24px;'/></td><td style='text-align: center'><input value='' type='type' style='padding: 0px 3px; width: 95%; border: 1px solid #cccccc; height: 24px; border-radius: 3px; line-height: 24px;'/></td><td style='text-align: center'><input value='yes' type='checkbox' "+(t.major?"checked":"")+"/></td></tr></table>";o.set("html",d);var l=o.getElements("input");l[0]&&l[0].set("value",t.name),l[1]&&l[1].set("value",t.unique)}.bind(this))},saveIdentity:function(t,e,i){var n=t.content.getFirst().getElements("input"),s=n[0].get("value"),o=n[1].get("value"),a=n[2].checked;e.name===s&&e.unique===o||(s&&(e.name=s),e.unique=o,e.major=a,this.explorer.actions.saveIdentity(e,function(t){this.explorer.actions.getPerson(function(t){this.data.woIdentityList=t.data.woIdentityList,this.identityList.clear(),this.data.woIdentityList.each(function(t){this.identityList.push(t)}.bind(this))}.bind(this),null,this.data.id)}.bind(this)))},_listRole:function(){var t=this;this.roleList=new MWF.xApplication.Org.List(this.roleContentNode,this,{action:!1,canEdit:!1,data:{},attr:["name","distinguishedName","description",{getHtml:function(){return t.data.control.allowEdit?"<div style='width:24px; height:24px; cursor: pointer; background:url(../x_component_Org/$Explorer/"+t.explorer.app.options.style+"/icon/open.png) center center no-repeat'></div>":""},events:{click:function(){t.explorer.openRole(this.data,this.td)}}}]}),this.roleList.load([{style:"width: 15%",text:this.explorer.app.lp.roleName},{style:"width: 30%",text:this.explorer.app.lp.roleFullName},{style:"",text:this.explorer.app.lp.description},{style:"width: 30px",text:""}]),this.data.id&&o2.Actions.load("x_organization_assemble_control").RoleAction.listWithPerson(this.data.id,function(t){this.roleDataList=t.data,t.data.each(function(t){this.roleList.push(t)}.bind(this))}.bind(this),null,!1)}}),MWF.xApplication.Org.PersonExplorer.PersonContent.TitleInfor=new Class({Extends:MWF.xApplication.Org.$Explorer.ItemContent.TitleInfor,loadAction:function(){this.nameNode.setStyle("margin-right","80px"),(MWF.AC.isOrganizationManager()||MWF.AC.isPersonManager())&&(this.resetPasswordAction=new Element("div",{styles:this.style.titleInforResetPasswordNode,text:this.item.explorer.app.lp.resetPassword}).inject(this.nameNode,"before"),this.resetPasswordAction.addEvent("click",function(t){this.resetPassword(t)}.bind(this)),this.unlockPersonAction=new Element("div",{styles:this.style.titleInforUnlockPersonNode,text:this.item.explorer.app.lp.unlockPerson}).inject(this.nameNode,"before"),this.unlockPersonAction.addEvent("click",function(t){this.unlockPerson(t)}.bind(this))),this.data.control.allowEdit&&(this.iconNode.setStyle("cursor","pointer"),this.iconNode.addEvent("click",function(){this.changePersonIcon()}.bind(this)))},resetPassword:function(t){var e=this,i=this.item.explorer.app.lp.resetPasswordText;i=i.replace("{name}",this.data.name),this.item.explorer.app.confirm("info",t,this.item.explorer.app.lp.resetPasswordTitle,i,"360","120",(function(){e.doResetPassword(),this.close()}),(function(){this.close()}))},doResetPassword:function(){MWF.Actions.get("x_organization_assemble_control").resetPassword(this.data.id,function(){var t=this.item.explorer.app.lp.resetPasswordSuccess;t=t.replace("{name}",this.data.name),this.item.explorer.app.notice(t,"success")}.bind(this))},unlockPerson:function(t){var e=this,i=this.item.explorer.app.lp.unlockPersonText;i=i.replace("{name}",this.data.name),this.item.explorer.app.confirm("info",t,this.item.explorer.app.lp.unlockPersonTitle,i,"360","120",(function(){e.doUnlockPerson(),this.close()}),(function(){this.close()}))},doUnlockPerson:function(){MWF.Actions.load("x_organization_assemble_control").PersonAction.unlockPerson(this.data.id,function(){var t=this.item.explorer.app.lp.unlockPersonSuccess;t=t.replace("{name}",this.data.name),this.item.explorer.app.notice(t,"success")}.bind(this))},changePersonIcon:function(){var t="668",e="510";t=t.toInt(),e=e.toInt();var i=this.explorer.app.content.getSize(),n=(i.x-t)/2,s=(i.y-e)/2;n<0&&(n=0),s<0&&(s=0),layout.mobile&&(n=20,s=0);var o=this;MWF.require("MWF.xDesktop.Dialog",function(){MWF.require("MWF.widget.ImageClipper",function(){var i=new MWF.xDesktop.Dialog({title:this.explorer.app.lp.changePersonIcon,style:"image",top:s,left:n-20,fromTop:s,fromLeft:n-20,width:t,height:e,html:"<div></div>",maskNode:this.explorer.app.content,container:this.explorer.app.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){o.uploadPersonIcon(),this.close()}},{text:MWF.LP.process.button.cancel,action:function(){o.image=null,this.close()}}]});i.show(),this.image=new MWF.widget.ImageClipper(i.content.getFirst(),{aspectRatio:1,description:"",imageUrl:this._getIcon(!0),resetEnable:!1}),this.image.load()}.bind(this))}.bind(this))},uploadPersonIcon:function(){this.image&&this.image.getResizedImage()&&this.explorer.actions.changePersonIcon(this.data.id,this.image.getFormData(),this.image.getResizedImage(),function(){this.iconNode.set("src",""),this.item.iconNode&&this.item.iconNode.getElement("img").set("src",""),window.setTimeout(function(){this.iconNode.set("src",this._getIcon(!0)),this.item.iconNode&&this.item.iconNode.getElement("img").set("src",this.item._getIcon(!0))}.bind(this),100)}.bind(this),null)}}),MWF.xApplication.Org.PersonExplorer.PersonContent.BottomInfor=new Class({Extends:MWF.xApplication.Org.$Explorer.ItemContent.BottomInfor,addInforList:function(){var t=this.explorer.app.lp.personReadDn.replace(/{dn}/g,this.data.distinguishedName||" ");this.addInfor(t),t=(t=this.explorer.app.lp.personReadCreate.replace(/{date}/g,this.data.createTime||" ")).replace(/{date2}/g,this.data.updateTime||" "),this.addInfor(t),t=(t=(t=this.explorer.app.lp.personReadLogin.replace(/{date}/g,this.data.lastLoginTime||" ")).replace(/{ip}/g,this.data.lastLoginAddress||" ")).replace(/{client}/g,this.data.lastLoginClient||" "),this.addInfor(t),t=(t=this.explorer.app.lp.personReadPassword.replace(/{date}/g,this.data.passwordExpiredTime||" ")).replace(/{date2}/g,this.data.changePasswordTime||" "),this.addInfor(t)}}),MWF.xApplication.Org.PersonExplorer.PersonContent.BaseInfor=new Class({initialize:function(t){this.content=t,this.item=t.item,this.data=this.content.data,this.explorer=this.item.explorer,this.contentNode=this.content.baseContentNode,this.style=this.item.style.person,this.attributes=[],this.mode="read",this.load()},load:function(){var t;this.node=new Element("div",{styles:this.style.baseContentNode}).inject(this.contentNode),this.editContentNode=new Element("div",{styles:this.style.baseEditNode}).inject(this.node),this.editContentNode.set("html",this.getContentHtml()),(t=this.editContentNode.getElement(".infor_name"))&&t.set("text",this.data.name||""),(t=this.editContentNode.getElement(".infor_employee"))&&t.set("text",this.data.employee||""),(t=this.editContentNode.getElement(".infor_mobile"))&&t.set("text",this.data.mobile||""),(t=this.editContentNode.getElement(".infor_unique"))&&t.set("text",this.data.unique||""),(t=this.editContentNode.getElement(".infor_gender"))&&t.set("text",this.getGenderType()),(t=this.editContentNode.getElement(".infor_mail"))&&t.set("text",this.data.mail||""),(t=this.editContentNode.getElement(".infor_weixin"))&&t.set("text",this.data.weixin||""),(t=this.editContentNode.getElement(".infor_qq"))&&t.set("text",this.data.qq||""),(t=this.editContentNode.getElement(".infor_officePhone"))&&t.set("text",this.data.officePhone||""),(t=this.editContentNode.getElement(".infor_boardDate"))&&t.set("text",this.data.boardDate||""),(t=this.editContentNode.getElement(".infor_birthday"))&&t.set("text",this.data.birthday||""),(t=this.editContentNode.getElement(".infor_ipAddress"))&&t.set("text",this.data.ipAddress||""),(t=this.editContentNode.getElement(".infor_description"))&&t.set("text",this.data.description||""),this.editContentNode.getElements("td.inforTitle").setStyles(this.style.baseInforTitleNode),this.editContentNode.getElements("td.inforContent").setStyles(this.style.baseInforContentNode),this.editContentNode.getElements("td.inforAction").setStyles(this.style.baseInforActionNode);var e=this.editContentNode.getElements("td.inforContent");this.data.superior&&new MWF.widget.O2Person({name:this.data.superior},e[5],{style:"xform"}),this.loadAction()},getContentHtml:function(){var t="<table width='100%' cellpadding='3px' cellspacing='5px'>";return t+="<tr><td class='inforTitle'>"+this.explorer.app.lp.personName+":</td><td class='inforContent infor_name'>"+(this.data.name||"")+"</td><td class='inforTitle'>"+this.explorer.app.lp.personEmployee+":</td><td class='inforContent infor_employee'>"+(this.data.employee||"")+"</td></tr>",t+="<tr><td class='inforTitle'>"+this.explorer.app.lp.personMobile+":</td><td class='inforContent infor_mobile'>"+(this.data.mobile||"")+"</td><td class='inforTitle'>"+this.explorer.app.lp.personUnique+":</td><td class='inforContent infor_unique'>"+(this.data.unique||"")+"</td></tr>",t+="<tr><td class='inforTitle'>"+this.explorer.app.lp.personGender+":</td><td class='inforContent infor_gender'>"+this.getGenderType()+"</td><td class='inforTitle'>"+this.explorer.app.lp.personSuperior+":</td><td class='inforContent'></td></tr>",t+="<tr><td class='inforTitle'>"+this.explorer.app.lp.personMail+":</td><td class='inforContent infor_mail'>"+(this.data.mail||"")+"</td><td class='inforTitle'>"+this.explorer.app.lp.personWeixin+":</td><td class='inforContent infor_weixin'>"+(this.data.weixin||"")+"</td></tr>",t+="<tr><td class='inforTitle'>"+this.explorer.app.lp.personQQ+":</td><td class='inforContent infor_qq'>"+(this.data.qq||"")+"</td><td class='inforTitle'>"+this.explorer.app.lp.personOfficePhone+":</td><td class='inforContent infor_officePhone'>"+(this.data.officePhone||"")+"</td></tr>",t+="<tr><td class='inforTitle'>"+this.explorer.app.lp.personBoardDate+":</td><td class='inforContent infor_boardDate'>"+(this.data.boardDate||"")+"</td><td class='inforTitle'>"+this.explorer.app.lp.personBirthday+":</td><td class='inforContent infor_birthday'>"+(this.data.birthday||"")+"</td></tr>",t+="<tr><td class='inforTitle'>"+this.explorer.app.lp.ipAddress+":</td><td class='inforContent infor_ipAddress'>"+(this.data.ipAddress||"")+"</td><td class='inforTitle'>"+this.explorer.app.lp.description+":</td><td class='inforContent infor_description'>"+(this.data.description||"")+"</td></tr>",t+="<tr><td colspan='4' class='inforAction'></td></tr>"},loadAction:function(){var t=this.editContentNode.getElements("td"),e=t[t.length-1];this.data.control.allowEdit&&(this.baseInforEditActionAreaNode=new Element("div",{styles:this.style.baseInforEditActionAreaNode}).inject(e),this.editNode=new Element("div",{styles:this.style.actionEditNode,text:this.explorer.app.lp.editPerson}).inject(this.baseInforEditActionAreaNode),this.saveNode=new Element("div",{styles:this.style.actionSaveNode,text:this.explorer.app.lp.savePerson}).inject(this.baseInforEditActionAreaNode),this.cancelNode=new Element("div",{styles:this.style.actionCancelNode,text:this.explorer.app.lp.cancel}).inject(this.baseInforEditActionAreaNode),this.editNode.setStyle("display","block"),this.editNode.addEvent("click",this.edit.bind(this)),this.saveNode.addEvent("click",this.save.bind(this)),this.cancelNode.addEvent("click",this.cancel.bind(this)))},edit:function(){var t=this.editContentNode.getElements("td.inforContent");t[0].setStyles(this.style.baseInforContentNode_edit).empty(),this.nameInputNode=new Element("input",{styles:this.style.inputNode}).inject(t[0]),this.nameInputNode.set("value",this.data.name),t[1].setStyles(this.style.baseInforContentNode_edit).empty(),this.employeeInputNode=new Element("input",{styles:this.style.inputNode}).inject(t[1]),this.employeeInputNode.set("value",this.data.employee),t[2].setStyles(this.style.baseInforContentNode_edit).empty(),this.mobileInputNode=new Element("input",{styles:this.style.inputNode}).inject(t[2]),this.mobileInputNode.set("value",this.data.mobile),t[3].setStyles(this.style.baseInforContentNode_edit).empty(),this.uniqueInputNode=new Element("input",{styles:this.style.inputNode}).inject(t[3]),this.uniqueInputNode.set("value",this.data.unique),t[4].setStyles(this.style.baseInforContentNode_edit).empty();var e='<input name="personGenderRadioNode" value="m" type="radio" '+("m"===this.data.genderType?"checked":"")+"/>"+this.explorer.app.lp.man;e+='<input name="personGenderRadioNode" value="f" type="radio" '+("f"===this.data.genderType?"checked":"")+"/>"+this.explorer.app.lp.female,e+='<input name="personGenderRadioNode" value="d" type="radio" '+("d"===this.data.genderType?"checked":"")+"/>"+this.explorer.app.lp.other,t[4].set("html",e),t[5].setStyles(this.style.baseInforContentNode_edit).empty(),this.superiorInputNode=new Element("div",{styles:this.style.inputNode_person}).inject(t[5]),this.data.superior&&new MWF.widget.O2Person({name:this.data.superior},this.superiorInputNode,{style:"xform"}),this.superiorInputNode.addEvent("click",function(){MWF.xDesktop.requireApp("Selector","package",function(){var t={type:"person",values:this.data.superior?[this.data.superior]:[],count:1,onComplete:function(t){this.data.superior=t[0].data.distinguishedName,this.superiorInputNode.empty(),new MWF.widget.O2Person(t[0].data,this.superiorInputNode,{style:"xform"})}.bind(this)};new MWF.O2Selector(this.explorer.app.content,t)}.bind(this))}.bind(this)),t[6].setStyles(this.style.baseInforContentNode_edit).empty(),this.mailInputNode=new Element("input",{styles:this.style.inputNode}).inject(t[6]),this.mailInputNode.set("value",this.data.mail),t[7].setStyles(this.style.baseInforContentNode_edit).empty(),this.weixinInputNode=new Element("input",{styles:this.style.inputNode}).inject(t[7]),this.weixinInputNode.set("value",this.data.weixin),t[8].setStyles(this.style.baseInforContentNode_edit).empty(),this.qqInputNode=new Element("input",{styles:this.style.inputNode}).inject(t[8]),this.qqInputNode.set("value",this.data.qq),t[9].setStyles(this.style.baseInforContentNode_edit).empty(),this.officePhoneInputNode=new Element("input",{styles:this.style.inputNode}).inject(t[9]),this.officePhoneInputNode.set("value",this.data.officePhone),t[10].setStyles(this.style.baseInforContentNode_edit).empty(),this.boardDateInputNode=new Element("input",{styles:this.style.inputNode_calendar,readonly:!0}).inject(t[10]),this.boardDateInputNode.set("value",this.data.boardDate),MWF.require("MWF.widget.Calendar",function(){new MWF.widget.Calendar(this.boardDateInputNode,{style:"xform",isTime:!1,target:this.explorer.app.content,format:"%Y-%m-%d"})}.bind(this)),t[11].setStyles(this.style.baseInforContentNode_edit).empty(),this.birthdayInputNode=new Element("input",{styles:this.style.inputNode_calendar,readonly:!0}).inject(t[11]),this.birthdayInputNode.set("value",this.data.birthday),MWF.require("MWF.widget.Calendar",function(){new MWF.widget.Calendar(this.birthdayInputNode,{style:"xform",isTime:!1,target:this.explorer.app.content,format:"%Y-%m-%d"})}.bind(this)),t[12].setStyles(this.style.baseInforContentNode_edit).empty(),this.ipAddressInputNode=new Element("input",{styles:this.style.inputNode,placeHolder:this.explorer.app.lp.ipAddressPlaceHolder}).inject(t[12]),this.ipAddressInputNode.set("value",this.data.ipAddress),t[13].setStyles(this.style.baseInforContentNode_edit).empty(),this.descriptionInputNode=new Element("input",{styles:this.style.inputNode}).inject(t[13]),this.descriptionInputNode.set("value",this.data.description);var i=this;this.editContentNode.getElements("input").addEvents({focus:function(){"text"===this.get("type").toLowerCase()&&this.setStyles(i.style.inputNode_focus)},blur:function(){"text"===this.get("type").toLowerCase()&&this.setStyles(i.style.inputNode_blur)}}),this.mode="edit",this.editNode.setStyle("display","none"),this.saveNode.setStyle("display","block"),this.cancelNode.setStyle("display","block")},save:function(){for(var t="",e=this.editContentNode.getElements("td.inforContent")[4].getElements("input"),i=0;i<e.length;i++)if(e[i].checked){t=e[i].value;break}if(!this.nameInputNode.get("value")||!this.mobileInputNode.get("value")||!t)return this.explorer.app.notice(this.explorer.app.lp.inputPersonInfor,"error",this.explorer.propertyContentNode),!1;this.uniqueInputNode.get("value")||(this.data.unique=this.employeeInputNode.get("value")),this.content.propertyContentScrollNode.mask({style:{opacity:.7,"background-color":"#999"}}),this.savePerson(function(){this.cancel(),this.content.propertyContentScrollNode.unmask()}.bind(this),function(t,e,i){var n=i;if(t){var s=JSON.decode(t.responseText);n=s?s.message.trim()||"request json error":"request json error: "+t.responseText}MWF.xDesktop.notice("error",{x:"right",y:"top"},n),this.content.propertyContentScrollNode.unmask()}.bind(this))},savePerson:function(t,e){var i=Object.clone(this.data);i.name=this.nameInputNode.get("value"),i.employee=this.employeeInputNode.get("value"),i.mobile=this.mobileInputNode.get("value"),i.unique=this.uniqueInputNode.get("value"),i.mail=this.mailInputNode.get("value"),i.weixin=this.weixinInputNode.get("value"),i.qq=this.qqInputNode.get("value"),i.officePhone=this.officePhoneInputNode.get("value"),i.boardDate=this.boardDateInputNode.get("value"),i.birthday=this.birthdayInputNode.get("value"),i.ipAddress=this.ipAddressInputNode.get("value"),i.description=this.descriptionInputNode.get("value");for(var n=this.editContentNode.getElements("td.inforContent")[4].getElements("input"),s=0;s<n.length;s++)if(n[s].checked){i.genderType=n[s].value;break}this.explorer.actions.savePerson(i,function(e){Object.merge(this.data,i),this.data.id?(this.data.id=e.data.id,this.item.refresh(),t&&t()):this.explorer.actions.getPerson(function(e){this.data=Object.merge(this.data,e.data),this.item.data=this.data,this.item.refresh(),this.content.loadList(),t&&t()}.bind(this),null,e.data.id)}.bind(this),function(t,i,n){e&&e(t,i,n)}.bind(this))},cancel:function(){if(this.data.id){var t=this.editContentNode.getElements("td.inforContent");t[0].setStyles(this.style.baseInforContentNode).set("text",this.data.name||""),t[1].setStyles(this.style.baseInforContentNode).set("text",this.data.employee||""),t[2].setStyles(this.style.baseInforContentNode).set("text",this.data.mobile||""),t[3].setStyles(this.style.baseInforContentNode).set("text",this.data.unique||""),t[4].setStyles(this.style.baseInforContentNode).set("text",this.getGenderType()),t[5].setStyles(this.style.baseInforContentNode).set("text",""),this.data.superior&&new MWF.widget.O2Person({name:this.data.superior},t[5],{style:"xform"}),t[6].setStyles(this.style.baseInforContentNode).set("text",this.data.mail||""),t[7].setStyles(this.style.baseInforContentNode).set("text",this.data.weixin||""),t[8].setStyles(this.style.baseInforContentNode).set("text",this.data.qq||""),t[9].setStyles(this.style.baseInforContentNode).set("text",this.data.officePhone||""),t[10].setStyles(this.style.baseInforContentNode).set("text",this.data.boardDate||""),t[11].setStyles(this.style.baseInforContentNode).set("text",this.data.birthday||""),t[12].setStyles(this.style.baseInforContentNode).set("text",this.data.ipAddress||""),t[13].setStyles(this.style.baseInforContentNode).set("text",this.data.description||""),this.mode="read",this.editNode.setStyle("display","block"),this.saveNode.setStyle("display","none"),this.cancelNode.setStyle("display","none")}else this.item.destroy()},getGenderType:function(){var t="";if(this.data.genderType)switch(this.data.genderType){case"m":t=this.explorer.app.lp.man;break;case"f":t=this.explorer.app.lp.female;break;default:t=this.explorer.app.lp.other}return t},destroy:function(){this.node.empty(),this.node.destroy(),MWF.release(this)},_getIcon:function(t){var e=this.data.id?this.explorer.actions.getPersonIcon(this.data.id):"../x_component_Org/$Explorer/default/icon/man.png";return t?e+"?"+(new Date).getTime():e}});