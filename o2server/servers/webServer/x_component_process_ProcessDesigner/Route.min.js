MWF.xDesktop.requireApp("process.ProcessDesigner","Property",null,!1),MWF.xApplication.process.ProcessDesigner.Route=new Class({initialize:function(t,i){this.data=t,this.process=i,this.paper=this.process.paper,this.data.edition||(this.data.edition=(new o2.widget.UUID).toString()),this.loaded=!1,this.l1=8,this.l2=12,this.aj=25,this.corners=[],this.toSelf=!1,this.isLineEvent=!1,this.isTextEvent=!1,this.isSetEvent=!1,this.isArrowEvent=!1,this.isPointEvent=!1,this.checked=!1,this.isBack=!1,this.isBrokenLine=!1,this.tmpbeginPoint=null,this.tmpEndPoint=null,this.toActivity=this.getNextActivity(),this.positionPoints=this.getRoutePoint(),this.process.options.isView||(this.listItem=new MWF.APPPD.Route.List(this),this.listItem.load())},getRoutePoint:function(){var t=[];this.data.track&&this.data.track.split(/\s+/g).each(function(i){var s=i.split(/(?:,\s*){1}|(?:;\s*){1}/g);t.push({x:s[0],y:s[1]})}.bind(this));return t},reload:function(t,i){this.toActivity&&this.fromActivity&&(this.toActivity.data.id==this.fromActivity.data.id?this.toSelf=!0:this.toSelf=!1),this.getPoint(t,i),this.redraw()},load:function(t){this.process.isNewProcess&&(this.data.createTime=(new Date).format("db"),this.data.updateTime=(new Date).format("db")),t&&(this.fromActivity=t),this.toActivity&&this.fromActivity&&(this.toActivity.data.id==this.fromActivity.data.id?this.toSelf=!0:this.toSelf=!1),this.getPoint(),this.draw(),this.loaded=!0},setActivity:function(t,i){t&&(this.toActivity&&this.toActivity.fromRoutes.erase(this),this.toActivity=t,this.data.activity=this.toActivity.data.id,this.data.activityType=this.toActivity.data.type,-1==this.toActivity.fromRoutes.indexOf(this)&&this.toActivity.fromRoutes.push(this)),i&&(this.fromActivity&&(this.fromActivity.routes.erase(this),this.fromActivity.removeRouteData(this.data.id)),this.fromActivity=i,this.data.id&&this.fromActivity.addRouteData(this.data.id),-1==this.fromActivity.routes.indexOf(this)&&this.fromActivity.routes.push(this))},getNextActivity:function(){var t=this.data.activity,i=this.data.activityType;if(i)if("begin"==i.toLowerCase()){if(this.process.begin.data.id==t)return this.process.begin.fromRoutes.push(this),this.process.begin}else{var s=this.process[i+"s"][t];if(s)return-1==s.fromRoutes.indexOf(this)&&s.fromRoutes.push(this),s}return null},redraw:function(){if(this.beginPoint&&this.endPoint){if(this.set||(this.set=this.paper.set()),this.point?(this.point.show(),this.point.attr("path",MWFRaphael.getCirclePath(this.beginPoint.x,this.beginPoint.y,3))):(this.point=this.paper.circlePath(this.beginPoint.x,this.beginPoint.y,3),this.point.attr(this.process.css.route.decision.normal),this.set.push(this.point)),this.line?(this.line.show(),this.line.attr("path",this.getLinePath())):(this.line=this.paper.path(this.getLinePath()),this.line.toBack(),this.line.attr(this.process.css.route.line.normal),this.set.push(this.line)),this.line.toBack(),this.text){this.text.show();var t=this.getTextPoint();this.text.attr({text:this.data.name||MWF.APPPD.LP.unnamed,x:t.x,y:t.y})}else this.text=this.createText(),this.set.push(this.text);if(this.arrow){this.arrow.show();var i=this.positionPoints.length?this.positionPoints[this.positionPoints.length-1]:this.beginPoint;this.arrow.attr("path",MWFRaphael.getArrowPath(i,this.endPoint,this.l1,this.l2,this.aj))}else this.arrow=this.createArrow(),this.arrow.attr(this.process.css.route.arrow.normal),this.set.push(this.arrow);this.set&&(this.set.attr({transform:""}),this.checked?this.process.currentSelected==this?(this.point.attr(this.process.css.route.decision.selected),this.line.attr(this.process.css.route.line.selected),this.arrow.attr(this.process.css.route.arrow.selected),this.text.attr(this.process.css.route.linetext.selected)):(this.point.attr(this.process.css.route.decision.normal),this.line.attr(this.process.css.route.line.normal),this.arrow.attr(this.process.css.route.arrow.normal),this.text.attr(this.process.css.route.linetext.normal)):(this.point.attr(this.process.css.route.decision["no-checked"]),this.line.attr(this.process.css.route.line["no-checked"]),this.arrow.attr(this.process.css.route.arrow["no-checked"]),this.text.attr(this.process.css.route.linetext["no-checked"])),this.isBack?this.set.toBack():this.set.toFront())}else this.point&&this.point.hide(),this.line&&this.line.hide(),this.arrow&&this.arrow.hide(),this.set&&this.set.hide();this.setListItemData(),this.setEvent()},draw:function(){this.beginPoint&&this.endPoint?(this.point=this.paper.circlePath(this.beginPoint.x,this.beginPoint.y,3),this.point.attr(this.process.css.route.decision.normal),this.line=this.paper.path(this.getLinePath()),this.line.toBack(),this.line.attr(this.process.css.route.line.normal),this.text=this.createText(),this.arrow=this.createArrow(),this.arrow.attr(this.process.css.route.arrow.normal),this.set=this.paper.set(),this.set.push(this.point,this.line,this.arrow,this.text),this.point.data("bind",this),this.line.data("bind",this),this.arrow.data("bind",this),this.text.data("bind",this),this.toSelf||this.positionPoints.each(function(t,i){this.createCorner(t,i)}.bind(this)),this.checked?this.process.currentSelected==this?(this.point.attr(this.process.css.route.decision.selected),this.line.attr(this.process.css.route.line.selected),this.arrow.attr(this.process.css.route.arrow.selected),this.text.attr(this.process.css.route.linetext.selected)):(this.point.attr(this.process.css.route.decision.normal),this.line.attr(this.process.css.route.line.normal),this.arrow.attr(this.process.css.route.arrow.normal),this.text.attr(this.process.css.route.linetext.normal)):(this.point.attr(this.process.css.route.decision["no-checked"]),this.line.attr(this.process.css.route.line["no-checked"]),this.arrow.attr(this.process.css.route.arrow["no-checked"]),this.text.attr(this.process.css.route.linetext["no-checked"])),this.isBack?this.set.toBack():this.set.toFront()):(this.point&&this.point.hide(),this.line&&this.line.hide(),this.arrow&&this.arrow.hide(),this.text&&this.text.hide(),this.set&&this.set.hide()),this.setEvent()},setEvent:function(){this.set&&(this.isSetEvent||(this.set.mousedown(function(t){this.selected(),t.stopPropagation()}.bind(this)),this.set.click(function(t){t.stopPropagation()}.bind(this)),this.isSetEvent=!0)),this.line&&(this.isLineEvent||(this.line.mousedown(function(t){if(!this.toSelf){var i=MWF.getOffset(t);this.checkBrokenLineBegin(i.offsetX,i.offsetY)}}.bind(this)),this.isLineEvent=!0)),this.arrow&&(this.isArrowEvent||(this.arrow.drag(function(t,i,s,e,o){this.arrowMove(t,i,s,e.e)}.bind(this),function(){this.arrowMoveStart()}.bind(this),function(){this.arrowMoveEnd()}.bind(this)),this.arrow.hover(function(){var t=this.beginPoint;this.positionPoints.length&&(t=this.positionPoints[this.positionPoints.length-1]),t.x=t.x.toFloat(),t.y=t.y.toFloat();var i=MWFRaphael.getArrowPath(t,this.endPoint,20,30,this.aj);this.arrow.attr("path",i)}.bind(this),function(){var t=this.beginPoint;this.positionPoints.length&&(t=this.positionPoints[this.positionPoints.length-1]),t.x=t.x.toFloat(),t.y=t.y.toFloat();var i=MWFRaphael.getArrowPath(t,this.endPoint,this.l1,this.l2,this.aj);this.arrow.attr("path",i)}.bind(this))),this.isArrowEvent=!0),this.point&&(this.isPointEvent||(this.point.drag(function(t,i,s,e,o){this.pointMove(t,i,s,e.e)}.bind(this),function(){this.pointMoveStart()}.bind(this),function(){this.pointMoveEnd()}.bind(this)),this.point.hover(function(){var t=MWFRaphael.getCirclePath(this.beginPoint.x,this.beginPoint.y,8);this.point.attr("path",t)}.bind(this),function(){var t=MWFRaphael.getCirclePath(this.beginPoint.x,this.beginPoint.y,3);this.point.attr("path",t)}.bind(this))),this.isPointEvent=!0),this.text&&(this.isTextEvent||(this.text.drag(function(t,i,s,e){this.textMove(t,i,s,e)}.bind(this),function(){this.textMoveStart()}.bind(this),function(){this.textMoveEnd()}.bind(this)),this.isTextEvent=!0))},arrowMoveStart:function(){this.arrow.data("originalPoint",{x:this.endPoint.x,y:this.endPoint.y}),this.process.isChangeRouteTo=!0,this.process.currentChangeRoute=this},arrowMove:function(t,i,s,e){this.isBack=!0;var o=this.arrow.data("originalPoint");this.endPoint={x:o.x+t-6,y:o.y+i-6},this.redraw()},arrowMoveEnd:function(){this.isBack=!1,this.process.isChangeRouteTo&&(this.endPoint=this.arrow.data("originalPoint"),this.redraw(),this.process.isChangeRouteTo=!1,this.process.currentChangeRoute=null),this.line&&this.line.toFront()},pointMoveStart:function(){this.point.data("originalPoint",{x:this.beginPoint.x,y:this.beginPoint.y}),this.process.isChangeRouteFrom=!0,this.process.currentChangeRoute=this},pointMove:function(t,i,s,e){(t>10||i>10)&&(this.isBack=!0);var o=this.point.data("originalPoint");this.beginPoint={x:o.x+t-4,y:o.y+i-4},this.redraw()},pointMoveEnd:function(){this.isBack=!1,this.process.isChangeRouteFrom&&(this.beginPoint=this.point.data("originalPoint"),this.redraw(),this.process.isChangeRouteFrom=!1,this.process.currentChangeRoute=null),this.line&&this.line.toFront()},cornerBrokenLineBegin:function(t,i){if(!this.process.isCreateRoute){var s=MWF.getOffset(t),e=s.offsetX,o=s.offsetY,n=this.corners.indexOf(i);-1!=n&&(this.process.brokenLineBeginMousemoveBind=function(t){this.doBeginBrokenLine(t,e,o,n-1,i,!0)}.bind(this),this.process.brokenLineMouseupBind=function(){this.endBrokenLine()}.bind(this),this.paper.canvas.addEvent("mousemove",this.process.brokenLineBeginMousemoveBind),this.paper.canvas.addEvent("mouseup",this.process.brokenLineMouseupBind))}},checkBrokenLineBegin:function(t,i){if(!this.process.isCreateRoute&&null===this.getNearIndex(this.positionPoints,{x:t,y:i})){var s=this.getCornerPointIndex(t,i);this.process.brokenLineBeginMousemoveBind=function(e){this.doBeginBrokenLine(e,t,i,s)}.bind(this),this.process.brokenLineMouseupBind=function(){this.endBrokenLine()}.bind(this),this.paper.canvas.addEvent("mousemove",this.process.brokenLineBeginMousemoveBind),this.paper.canvas.addEvent("mouseup",this.process.brokenLineMouseupBind)}},getCornerPointIndex:function(t,i){cornerPointIndex=-1;var s=5e5;if(this.positionPoints.length){var e=this.positionPoints.concat(this.endPoint);e.unshift(this.beginPoint);for(var o=0;o<e.length-1;o++){var n=e[o],r=e[o+1],h=MWFRaphael.getMinDistance({x:t,y:i},n,r).h;h<s&&(s=h,cornerPointIndex=o-1)}}return cornerPointIndex},getNearIndex:function(t,i){for(var s=0;s<t.length;s++){var e=t[s],o={x:e.x.toFloat(),y:e.y.toFloat()};if(MWFRaphael.getPointDistance(i,o)<=8)return s}return null},endBrokenLine:function(){this.process.isBrokenLine=!1,this.removeCorner&&(this.corners.splice(this.removeCorner.idx+1,1),this.removeCorner.corner.remove(),this.positionPoints.splice(this.removeCorner.idx+1,1),this.removeCorner=null),this.isBrokenLine=!1,this.data.track=this.positionPointsToString(),this.paper.canvas.removeEvent("mouseup",this.process.brokenLineMouseupBind),this.paper.canvas.removeEvent("mousemove",this.process.brokenLineBeginMousemoveBind),this.paper.canvas.removeEvent("mousemove",this.process.brokenLineMousemoveBind)},positionPointsToString:function(){var t=[];return this.positionPoints.each((function(i){t.push(i.x+","+i.y)})),t.join(" ")},doBeginBrokenLine:function(t,i,s,e,o,n){var r=this.positionPoints[e]||this.beginPoint,h=this.positionPoints[e+2]||this.endPoint,a=MWF.getOffset(t.event);MWFRaphael.getMinDistance({x:a.offsetX,y:a.offsetY},r,h).h>6&&(this.process.isBrokenLine=!0,this.isBrokenLine=!0,o&&!this.removeCorner||(n||this.positionPoints.splice(e+1,0,{x:a.offsetX,y:a.offsetY}),this.removeCorner?(o=this.removeCorner.corner,this.removeCorner=null):o=this.createCorner(this.positionPoints[e+1],e+1)),o.attr(this.process.css.route.corner.default),this.paper.canvas.removeEvent("mousemove",this.process.brokenLineBeginMousemoveBind),this.reload(),this.process.brokenLineMousemoveBind=function(t){this.doBrokenLine(t,e,o)}.bind(this),this.paper.canvas.addEvent("mousemove",this.process.brokenLineMousemoveBind))},doBrokenLine:function(t,i,s){var e=MWF.getOffset(t.event),o=e.offsetX,n=e.offsetY;o=Raphael.snapTo(10,o,10),n=Raphael.snapTo(10,n,10);var r=this.positionPoints[i]||this.beginPoint,h=this.positionPoints[i+2]||this.endPoint,a=MWFRaphael.getMinDistance({x:o,y:n},r,h);if(a.h<6)this.removeCorner={corner:s,idx:i},s.attr("path",MWFRaphael.getRectPath(a.p.x.toFloat()-2.5,a.p.y.toFloat()-2.5,5,5,0)),this.positionPoints[i+1]&&(this.positionPoints[i+1].x=a.p.x),this.positionPoints[i+1]&&(this.positionPoints[i+1].y=a.p.y),this.reload(),this.process.brokenLineBeginMousemoveBind=function(t){this.doBeginBrokenLine(t,o,n,i,null,!0)}.bind(this),this.paper.canvas.removeEvent("mousemove",this.process.brokenLineMousemoveBind),this.paper.canvas.addEvent("mousemove",this.process.brokenLineBeginMousemoveBind);else{Math.abs(r.x-o)<5&&(o=r.x),Math.abs(r.y-n)<5&&(n=r.y),Math.abs(h.x-o)<5&&(o=h.x),Math.abs(h.y-n)<5&&(n=h.y);var c=MWFRaphael.getRectPath(o-2.5,n-2.5,5,5,0);s.attr("path",c),this.positionPoints[i+1]&&(this.positionPoints[i+1].x=o),this.positionPoints[i+1]&&(this.positionPoints[i+1].y=n),this.reload()}},selected:function(){this.process.unSelectedAll(),this.line&&this.line.attr(this.process.css.route.line.selected),this.point&&this.point.attr(this.process.css.route.decision.selected),this.arrow&&this.arrow.attr(this.process.css.route.arrow.selected),this.text&&this.text.attr(this.process.css.route.linetext.selected),this.corners.each((function(t){t.show()})),this.process.currentSelected=this,this.listItem&&this.listItem.selected(),this.set.toFront(),this.showProperty()},unSelected:function(){this.checked?(this.point.attr(this.process.css.route.decision.normal),this.line.attr(this.process.css.route.line.normal),this.arrow.attr(this.process.css.route.arrow.normal),this.text.attr(this.process.css.route.linetext.normal)):(this.point.attr(this.process.css.route.decision["no-checked"]),this.line.attr(this.process.css.route.line["no-checked"]),this.arrow.attr(this.process.css.route.arrow["no-checked"]),this.text.attr(this.process.css.route.linetext["no-checked"])),this.corners.each((function(t){t.hide()})),this.process.currentSelected=null,this.listItem&&this.listItem.unSelected(),this.property&&this.property.hide()},textMove:function(t,i,s,e){s=this.text.moveX.toFloat()+parseFloat(t),e=this.text.moveY.toFloat()+parseFloat(i);var o=this.getDefaultTextPoint();MWFRaphael.getPointDistance(o,{x:s,y:e})<5?this.text.attr({x:o.x,y:o.y}):this.text.attr({x:s,y:e})},textMoveStart:function(){this.text.moveX=this.text.attr("x"),this.text.moveY=this.text.attr("y")},textMoveEnd:function(){var t=this.text.attr("x"),i=this.text.attr("y"),s=this.getDefaultTextPoint();MWFRaphael.getPointDistance(s,{x:t,y:i})<5?this.data.position="":(t=t.toInt(),i=i.toInt(),this.data.position=t+","+i)},getLinePath:function(){var t="";return this.beginPoint&&this.endPoint&&(t="M"+this.beginPoint.x+","+this.beginPoint.y,this.positionPoints.each(function(i,s){var e,o;e=0==s?this.beginPoint:this.positionPoints[s-1],o=this.positionPoints[s+1]?this.positionPoints[s+1]:this.endPoint,i.x=i.x.toFloat(),i.y=i.y.toFloat();var n=MWFRaphael.getMinus(Math.abs(i.x-e.x),Math.abs(i.y-e.y),12),r=MWFRaphael.getMinus(Math.abs(i.x-o.x),Math.abs(i.y-o.y),12),h=null,a=null;i.x>=e.x&&i.y>=e.y?h={x:i.x-n.x,y:i.y-n.y}:i.x<=e.x&&i.y<=e.y?h={x:i.x+n.x,y:i.y+n.y}:i.x>=e.x&&i.y<=e.y?h={x:i.x-n.x,y:i.y+n.y}:i.x<=e.x&&i.y>=e.y&&(h={x:i.x+n.x,y:i.y-n.y}),i.x>=o.x&&i.y>=o.y?a={x:i.x-r.x,y:i.y-r.y}:i.x<=o.x&&i.y<=o.y?a={x:i.x+r.x,y:i.y+r.y}:i.x>=o.x&&i.y<=o.y?a={x:i.x-r.x,y:i.y+r.y}:i.x<=o.x&&i.y>=o.y&&(a={x:i.x+r.x,y:i.y-r.y}),t+="L"+h.x+","+h.y,t+="Q"+i.x+", "+i.y+", "+a.x+","+a.y}.bind(this)),t+="L"+this.endPoint.x+","+this.endPoint.y),t},getDefaultTextPoint:function(){var t="",i="";if(this.toSelf)t=this.positionPoints[2].x+(this.positionPoints[1].x-this.positionPoints[2].x)/2,i=this.positionPoints[2].y-8;else{var s=this.beginPoint,e=this.endPoint;this.positionPoints[0]&&(e=this.positionPoints[0]);var o=.4*(e.x.toFloat()-s.x.toFloat()),n=.4*(e.y.toFloat()-s.y.toFloat());t=s.x.toFloat()+o,i=s.y.toFloat()+n}return{x:t,y:i}},getTextPoint:function(){var t="",i="";if(this.data.position){var s=this.data.position.split(/(?:,\s*){1}|(?:;\s*){1}/g);t=s[0],i=s[1]}else{var e=this.getDefaultTextPoint();t=e.x,i=e.y}return{x:t,y:i}},createText:function(){var t=null;if(this.beginPoint&&this.endPoint){var i=this.getTextPoint();return(t=this.paper.text(i.x,i.y,this.data.name||MWF.APPPD.LP.unnamed)).attr(this.process.css.route.linetext.normal),t}},createArrow:function(){var t=this.beginPoint;return this.positionPoints.length&&(t=this.positionPoints[this.positionPoints.length-1]),t.x=t.x.toFloat(),t.y=t.y.toFloat(),this.paper.arrow(t,this.endPoint,this.l1,this.l2,this.aj)},createCorner:function(t,i){var s=this.paper.rectPath(t.x.toInt()-2.5,t.y.toInt()-2.5,5,5,0);return s.data("position",t),s.attr(this.process.css.route.corner.default),s.hide(),this.corners.splice(i,0,s),s.mousedown(function(t){this.cornerBrokenLineBegin(t,s)}.bind(this)),this.set.push(s),s},getPoint:function(t,i){var s=t;this.fromActivity&&(s||(s=this.fromActivity.shap.attr("path")));var e=i;if(this.toActivity&&(e||(e=this.toActivity.shap.attr("path"))),s&&e)if(this.checked=!0,this.toSelf){var o=this.fromActivity.center.x+this.fromActivity.width,n=this.fromActivity.center.y,r=this.fromActivity.center.x+this.fromActivity.width,h=this.fromActivity.center.y-this.fromActivity.height,a=this.fromActivity.center.x,c=this.fromActivity.center.y-this.fromActivity.height;this.positionPoints=[],this.positionPoints.push({x:o,y:n}),this.positionPoints.push({x:r,y:h}),this.positionPoints.push({x:a,y:c}),this.beginPoint={x:this.fromActivity.center.x+this.fromActivity.width/2,y:this.fromActivity.center.y},this.endPoint={x:this.fromActivity.center.x,y:this.fromActivity.center.y-this.fromActivity.height/2}}else{if(this.positionPoints[0]){f="M"+this.fromActivity.center.x+","+this.fromActivity.center.y+"L"+this.positionPoints[0].x+","+this.positionPoints[0].y;var p=this.positionPoints[this.positionPoints.length-1];v="M"+p.x+","+p.y+"L"+this.toActivity.center.x+","+this.toActivity.center.y}else f="M"+this.fromActivity.center.x+","+this.fromActivity.center.y+"L"+this.toActivity.center.x+","+this.toActivity.center.y,v="M"+this.fromActivity.center.x+","+this.fromActivity.center.y+"L"+this.toActivity.center.x+","+this.toActivity.center.y;var d=Raphael.pathIntersection(f,s),l=Raphael.pathIntersection(v,e);this.beginPoint=d[0],this.endPoint=l[0]}if(!s&&e){var u,y;this.checked=!1,this.tmpBeginPoint?(u=this.tmpBeginPoint.y.toFloat(),y=this.tmpBeginPoint.x.toFloat()):(u=this.toActivity.center.y.toFloat()-500,y=this.toActivity.center.x.toFloat());var v="M"+y+","+u+"L"+this.toActivity.center.x+","+this.toActivity.center.y;l=Raphael.pathIntersection(v,e);this.endPoint=l[0],this.beginPoint=this.tmpBeginPoint||{x:this.endPoint.x,y:this.endPoint.y-30},this.tmpBeginPoint=null}if(s&&!e){var P,x;this.checked=!1,this.tmpEndPoint?(P=this.tmpEndPoint.y.toFloat(),x=this.tmpEndPoint.x.toFloat()):(P=this.fromActivity.center.y.toFloat()+500,x=this.fromActivity.center.x.toFloat());var f="M"+this.fromActivity.center.x+","+this.fromActivity.center.y+"L"+x+","+P;d=Raphael.pathIntersection(f,s);this.beginPoint=d[0],this.endPoint=this.tmpEndPoint||{x:this.beginPoint.x,y:this.beginPoint.y+30},this.tmpEndPoint=null}s||e||(this.checked=!1,this.beginPoint={x:10,y:10},this.endPoint={x:10,y:30})},setListItemData:function(){if(this.listItem){var t=this.data.name||MWF.APPPD.LP.unnamed,i="";this.toActivity?(i=this.toActivity.data.name)||(i=MWF.APPPD.LP.unnamed):i=MWF.APPPD.LP.unknow,this.listItem.row.tds[1].set("text",t+" (to "+i+")")}},destroy:function(){this.fromActivity&&(this.fromActivity.removeRouteData(this.data.id),this.fromActivity.routes.erase(this)),this.listItem&&this.listItem.row.tr.destroy();var t={},i={};for(rid in this.process.routes)rid!=this.data.id?(t[rid]=this.process.routes[rid],i[rid]=this.process.routeDatas[rid]):(this.process.routes[rid]=null,this.process.routeDatas[rid]=null);this.process.routes=null,this.process.routeDatas=null,this.process.routes=t,this.process.routeDatas=i,this.process.process.routeList.erase(this.data),this.set.remove()},showProperty:function(){this.property?this.property.show():(this.property=new MWF.APPPD.Route.Property(this,{onPostLoad:function(){this.property.show()}.bind(this)}),this.property.load())},_setEditProperty:function(t,i,s){"passExpired"!==t&&"passSameTarget"!==t&&"sole"!==t||this.data[t]&&this.fromActivity&&this.fromActivity.routes.each(function(i){if(i.data.id!==this.data.id&&i.data[t]&&(i.data[t]=!1,i.property)){var s=i.property.propertyContent.getElementById(i.data.id+t);s&&s.getElements("input")[1].set("checked",!0)}}.bind(this))}}),MWF.xApplication.process.ProcessDesigner.Route.List=new Class({initialize:function(t){this.route=t,this.process=t.process,this.paper=this.route.paper},load:function(){var t=this.route.data.name||MWF.APPPD.LP.unnamed,i="";this.route.toActivity?(i=this.route.toActivity.data.name)||(i=MWF.APPPD.LP.unnamed):i=MWF.APPPD.LP.unknow,this.row=this.process.routeTable.push([{content:" ",properties:{styles:this.process.css.route.icon}},{content:t+" (to "+i+")",properties:{styles:this.process.css.list.listText}},{content:'<img src="../x_component_process_ProcessDesigner/$Process/default/icon/copy.png" />',properties:{styles:this.process.css.list.listIcon,events:{click:this.copyRoute.bind(this)}}},{content:'<img src="../x_component_process_ProcessDesigner/$Process/default/icon/delete.png" />',properties:{styles:this.process.css.list.listIcon,events:{click:this.deleteRoute.bind(this)}}}]),this.row.tr.addEvent("click",function(){this.listSelected()}.bind(this))},copyRoute:function(){this.process.copyRoute(this.route)},deleteRoute:function(t){this.process.deleteRoute(t,this.route)},selected:function(){this.process.currentListSelected&&this.process.currentListSelected.listUnSelected(),this.row.tr.setStyles(this.process.css.list.listRowSelected),this.process.currentListSelected=this},unSelected:function(){this.process.currentListSelected=null,this.row.tr.setStyles(this.process.css.list.listRow)},listSelected:function(){this.route.selected()},listUnSelected:function(){this.route.unSelected()}}),MWF.xApplication.process.ProcessDesigner.Route.Property=new Class({Implements:[Options,Events],Extends:MWF.APPPD.Property,initialize:function(t,i){this.setOptions(i),this.route=t,this.process=t.process,this.paper=this.process.paper,this.data=t.data,this.htmlPath="../x_component_process_ProcessDesigner/$Process/route.html"},setValue:function(t,i){this.data[t]=i,"name"==t&&(i||(this.data[t]=MWF.APPPD.LP.unnamed),this.route.reload())},show:function(){this.process.options.isView||(this.propertyContent?this.propertyContent.setStyle("display","block"):(this.htmlString=o2.bindJson(this.htmlString,{lp:o2.APPPD.LP.propertyTemplate}),this.propertyContent=new Element("div",{styles:{overflow:"hidden"}}).inject(this.process.propertyListNode),this.process.panel.propertyTabPage.showTabIm(),this.JsonTemplate=new MWF.widget.JsonTemplate(this.data,this.htmlString),this.propertyContent.set("html",this.JsonTemplate.load()),this.process.panel.data=this.data,this.loadRouteCondition(),this.setEditNodeEvent(),this.setEditNodeStyles(this.propertyContent),this.loadPropertyTab(),this.loadPersonInput(),this.loadScriptInput(),this.loadScriptText(),this.loadConditionInput(),this.loadFormSelect(),this.loadOrgEditor(),this.hideAdvanced()))},loadRouteCondition:function(){var t=this.propertyContent.getElement(".MWFRouteCondition"),i=this.route.fromActivity.type;"choice"==i||"condition"==i||"parallel"==i?t||(t=new Element("div.MWFTab",{title:MWF.APPPD.LP.condition,html:'<div class="MWFScriptText" name="scriptText"></div>'}).inject(this.propertyContent.getFirst())):t&&t.destroy()}});