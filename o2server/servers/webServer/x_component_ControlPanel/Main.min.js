MWF.xApplication.ControlPanel.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"ControlPanel",icon:"icon.png",width:"840",isResize:!1,isMax:!1,height:"280",title:MWF.xApplication.ControlPanel.LP.title},loadWindow:function(t){this.fireAppEvent("queryLoadWindow"),this.window=new MWF.xDesktop.WindowTransparent(this,{container:this.desktop.node}),this.fireAppEvent("loadWindow"),this.window.show(),this.content=this.window.content,t&&this.setCurrent(),this.fireAppEvent("postLoadWindow"),this.fireAppEvent("queryLoadApplication"),this.loadApplication(function(){this.fireAppEvent("postLoadApplication")}.bind(this))},loadWindowFlat:function(t){this.window={isHide:!1,isMax:!0,maxSize:function(){},restore:function(){},setCurrent:function(){this.content.removeClass("layout_component_content_hide"),this.content.addClass("layout_component_content_show")}.bind(this),setUncurrent:function(){this.content.addClass("layout_component_content_hide"),this.content.removeClass("layout_component_content_show")}.bind(this),hide:function(){},maxOrRestoreSize:function(){},restoreSize:function(){},close:function(t){this.content.destroy(),t&&t()}.bind(this)},this.window.content=new Element("div.layout_component_content").inject(layout.desktop.contentNode),this.content=this.window.content,layout.desktop.addEvent("resize",function(){this.fireAppEvent("resize")}.bind(this)),t?this.setCurrent():this.setUncurrent(),this.fireAppEvent("postLoadWindow"),this.fireAppEvent("queryLoadApplication"),this.stylePath&&this.content.loadCss(this.stylePath),this.setContentEvent(),this.loadApplication(function(){this.fireAppEvent("postLoadApplication")}.bind(this)),this.fireAppEvent("postLoad")},setNodeResize:function(){this.setNodePositionAndSizeFun=this.setNodePositionAndSize.bind(this),this.setNodePositionAndSizeFun(),this.addEvent("resize",this.setNodePositionAndSizeFun)},setNodePositionAndSize:function(){this.node.position({relativeTo:this.desktop.node,position:"center",edge:"center",offset:{y:"-120"}})},recordStatus:function(){return{size:this.node.getPosition()}},onQueryLoad:function(){this.lp=MWF.xApplication.ControlPanel.LP},loadApplication:function(t){this.layout=this.desktop,this.apps=[],"Default"===layout.viewMode&&(this.css.contentNode=this.css.contentNodeFlat),this.options.event&&(this.css.contentNode.left=this.options.event.page.x,this.css.contentNode.top=this.options.event.page.y),this.node=new Element("div",{styles:this.css.contentNode}).inject(this.content),new Fx.Morph(this.node,{duration:"100",transition:Fx.Transitions.Sine.easeOut}).start(this.css.contentNodeTo).chain(function(){this.setNodeResize(),this.node.addEvent("selectstart",function(t){t.target.setStyle("-webkit-user-select","none")}.bind(this)),"Layout"===layout.viewMode&&(this.titleAreaNode=new Element("div",{styles:this.css.titleAreaNode}).inject(this.node),this.closeNode=new Element("div",{styles:this.css.closeNode}).inject(this.titleAreaNode),this.closeNode.addEvent("click",function(){this.close()}.bind(this)),this.titleNode=new Element("div",{styles:this.css.titleAreaTextNode,text:this.lp.titleInfor}).inject(this.titleAreaNode)),this.contentNode=new Element("div",{styles:this.css.contentAreaNode}).inject(this.node),this.loadApplications()}.bind(this))},loadTitle:function(){this.titleBar=new Element("div",{styles:this.css.titleBar}).inject(this.content),this.taskTitleTextNode=new Element("div",{styles:this.css.titleTextNode,text:this.lp.title}).inject(this.titleBar)},setContentSize:function(){var t=.9*this.node.getSize().x,e=(t/120).toInt();t=120*Math.min(e,this.apps.length),this.contentNode.setStyles({width:t+"px"})},loadApplications:function(){COMMON.JSON.get(this.path+"applications.json",function(t){var e=this.layout.session.user,i=[e.name,e.distinguishedName,e.id,e.unique];e.roleList&&e.roleList.each((function(t){i.push(MWF.name.cn(t)),i.push(t)})),e.groupList&&e.groupList.each((function(t){i.push(MWF.name.cn(t)),i.push(t)})),t.each(function(t,e){var n=!0;t.allowList&&(n=!t.allowList.length||t.allowList.isIntersect(i));var s=!1;t.denyList&&(s=!!t.denyList.length&&-1!==t.denyList.isIntersect(i)),!s&&n&&(this.apps.push({value:t,key:e}),this.createApplicationMenu(t,e)),this.setContentSize(),this.addEvent("resize",this.setContentSize)}.bind(this))}.bind(this))},createApplicationMenu:function(t,e){var i=new Element("div",{styles:this.css.applicationMenuNode,title:t.title}).inject(this.contentNode),n=new Element("div",{styles:this.css.applicationMenuIconNode}).inject(i),s="../x_component_"+t.path.replace(/\./g,"_")+"/$Main/"+t.iconPath;n.setStyle("background-image","url("+s+")"),new Element("div",{styles:this.css.applicationMenuTextNode,text:t.title}).inject(i),i.addEvent("click",function(e){this.layout.openApplication(e,t.path)}.bind(this)),i.makeLnk({par:{icon:s,title:t.title,par:t.path},onStart:function(){this.applicationMenuAreaMark.fade("out"),this.applicationMenuArea.fade("out")}.bind(this),onComplete:function(){}.bind(this)});t.path}});