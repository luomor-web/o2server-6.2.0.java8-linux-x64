MWF.xApplication.MinderEditor.TopToolbar=new Class({Extends:MWF.widget.Common,initialize:function(t,e){this.editor=t,this.minder=t.minder,this.container=e,this.commands=this.editor.commands,this.path="../x_component_MinderEditor/$ToolbarInEditMode/",this.cssPath=this.path+this.editor.options.style+"/css.wcss",this._loadCss()},getHtml:function(){var t,e=this.editor.options.tools;t=e&&e.top?e.top:["menu","|","save","|","undoredo","|","append","|","arrange","|","edit_remove","|","hyperLink","image","priority","progress","|","style","help"],(this.editor.options.disableTools||[]).each((function(e){t.erase(e)}));var i="",s="toolItem";return t.each((function(t){switch(t){case"|":i+="<div styles='separator'></div>";break;case"menu":i+="<div item='menu' itemevent='click' styles='"+s+"'></div>";break;case"save":i+="<div item='save' styles='"+s+"'></div>";break;case"undoredo":i+="<div styles='toolItemGroup' style='width:70px;'>   <div item='undo' styles='toolItem_horizontal_top'></div>   <div item='redo' styles='toolItem_horizontal_bottom'></div></div>";break;case"append":i+="<div styles='toolItemGroup' style='width:250px;'>   <div item='appendChild' styles='toolItem_horizontal_top'></div>   <div item='appendParent' styles='toolItem_horizontal_top'></div>   <div item='appendSibling' styles='toolItem_horizontal_bottom'></div></div>";break;case"arrange":i+="<div styles='toolItemGroup' style='width:70px;'>   <div item='arrangeUp' styles='toolItem_horizontal_top'></div>   <div item='arrangeDown' styles='toolItem_horizontal_bottom'></div></div>";break;case"edit_remove":i+="<div styles='toolItemGroup' style='width:70px;'>   <div item='edit' styles='toolItem_horizontal_top'></div>   <div item='remove' styles='toolItem_horizontal_bottom'></div></div>";break;case"hyperLink":i+="<div item='hyperLink' styles='"+s+"'></div>";break;case"image":i+="<div item='image' styles='"+s+"'></div>";break;case"priority":i+="<div item='priority' styles='"+s+"'></div>";break;case"progress":i+="<div item='progress' styles='"+s+"'></div>";break;case"style":i+="<div styles='toolItemGroup' style='width:170px;'>   <div item='clearstyle' styles='"+s+"'></div>   <div item='copystyle' styles='toolItem_horizontal_top'></div>   <div item='pastestyle' styles='toolItem_horizontal_bottom'></div></div>";break;case"help":i+="<div item='help' styles='toolItem_help'></div>"}})),i},load:function(){var t=this.getHtml();this.container.set("html",t),this.container.getElements("[styles]").each(function(t){t.get("item")||t.setStyles(this.css[t.get("styles")])}.bind(this)),this.commands.addContainer("toptoolbar",this.container,this.css)},getCommandNode:function(t){return this.commands.getItemNode(t,"toptoolbar")}}),MWF.xApplication.MinderEditor.RightToolbar=new Class({Extends:MWF.widget.Common,initialize:function(t,e){this.editor=t,this.minder=t.minder,this.container=e,this.commands=this.editor.commands,this.path="../x_component_MinderEditor/$ToolbarInEditMode/",this.cssPath=this.path+this.editor.options.style+"/css.wcss",this._loadCss()},getItems:function(){var t,e=this.editor.options.tools;return t=e&&e.right?e.right:["font","resource","note"],(this.editor.options.disableTools||[]).each((function(e){t.erase(e)})),t},load:function(){this.styleActive=!0,this.resourceActive=!1,this.noteActive=!1,this.editor.status&&(this.styleActive=this.editor.status.styleActive,this.resourceActive=this.editor.status.resourceActive,this.noteActive=this.editor.status.noteActive),this.styleLoaded=this.styleActive,this.resourceLoaded=this.resourceActive,this.noteLoaded=this.noteActive;var t=this.getItems(),e="  lazyLoading='"+(this.styleActive?"false":"true")+"'",i="";t.contains("font")&&(i+="<div styles='"+(this.styleActive?"rightToolbarItem_style_active":"rightToolbarItem_style")+"' title='文本样式' action='switchStyle'></div><div styles='tooltipNode' id='styleTooltip' style='display:"+(this.styleActive?"":"none")+";'>   <div styles='closeNode' action='closeStyle'></div>   <div style='width: 100%; height: 100%;'>       <div item='fontsize' styles='fontToolbarItemSelector'"+e+"></div>       <div item='bold' styles='fontToolbarItem'"+e+"></div>       <div item='italic' styles='fontToolbarItem'"+e+"></div>       <div item='forecolor' styles='fontToolbarItem'"+e+"></div>       <div item='background' styles='fontToolbarItem'"+e+"></div>       <div item='fontfamily' styles='fontToolbarItemSelector'"+e+"></div>   </div></div>"),t.contains("resource")&&(i+="<div styles='"+(this.resourceActive?"rightToolbarItem_resource_active":"rightToolbarItem_resource")+"' title='标签' action='switchResource'></div><div styles='tooltipNode_resource' id='resourceTooltip' style='display:"+(this.resourceActive?"":"none")+";'>   <div styles='closeNode' action='closeResource'></div>   <div item='resource' styles='resourceToolbarItem' lazyLoading='"+(this.resourceActive?"false":"true")+"'></div></div>"),t.contains("note")&&(i+="<div styles='"+(this.noteActive?"rightToolbarItem_note_active":"rightToolbarItem_note")+"' title='备注' action='switchNote'></div><div styles='tooltipNode_note' id='noteTooltip' style='display:"+(this.noteActive?"":"none")+";'>   <div styles='closeNode' action='closeNote'></div>   <div item='note' styles='noteToolbarItem' lazyLoading='"+(this.noteActive?"false":"true")+"'></div></div>"),this.container.set("html",i),this.container.getElements("[styles]").each(function(t){t.get("item")||t.setStyles(this.css[t.get("styles")])}.bind(this)),this.container.getElements("[action]").each(function(t){var e=t.get("action");t.addEvents({click:function(t){this[e](t.target)}.bind(this)})}.bind(this)),this.styleTooltip=this.container.getElement("#styleTooltip"),this.resourceTooltip=this.container.getElement("#resourceTooltip"),this.noteTooltip=this.container.getElement("#noteTooltip"),this.setTooltipsSize(),this.commands.addContainer("righttoolbar",this.container,this.css)},closeStyle:function(t){this.switchStyle(this.container.getElement("[action='switchStyle']"),!1)},switchStyle:function(t,e){"boolean"==typeOf(e)&&(this.styleActive=!e);var i=this.styleTooltip;i&&(this.styleActive?(i.setStyle("display","none"),t.setStyles(this.css.rightToolbarItem_style)):(i.setStyle("display",""),t.setStyles(this.css.rightToolbarItem_style_active),this.styleLoaded||(this.commands.loadItemsByNameList(["fontsize","bold","italic","forecolor","background","fontfamily"],"righttoolbar"),this.styleLoaded=!0)),this.styleActive=!this.styleActive),this.setTooltipsSize()},closeResource:function(t){this.switchResource(this.container.getElement("[action='switchResource']"),!1)},switchResource:function(t,e){"boolean"==typeOf(e)&&(this.resourceActive=!e);var i=this.resourceTooltip;i&&(this.resourceActive?(i.setStyle("display","none"),t.setStyles(this.css.rightToolbarItem_resource)):(i.setStyle("display",""),t.setStyles(this.css.rightToolbarItem_resource_active),this.resourceLoaded||(this.commands.loadItemByName("resource","righttoolbar"),this.resourceLoaded=!0)),this.resourceActive=!this.resourceActive),this.setTooltipsSize()},closeNote:function(t){this.switchNote(this.container.getElement("[action='switchNote']"),!1)},switchNote:function(t,e){"boolean"==typeOf(e)&&(this.noteActive=!e);var i=this.noteTooltip;i&&(this.noteActive?(i.setStyle("display","none"),t.setStyles(this.css.rightToolbarItem_note)):(i.setStyle("display",""),t.setStyles(this.css.rightToolbarItem_note_active),this.noteLoaded||(this.commands.loadItemByName("note","righttoolbar"),this.noteLoaded=!0)),this.noteActive=!this.noteActive),this.setTooltipsSize()},setTooltipsSize:function(){var t={bottom:0,y:0},e=this.editor.Content_Offset_Top+5,i=this.editor.content.getSize().y-e,s=this.styleActive?this.styleTooltip.getCoordinates():t;if(this.resourceActive){var o=s.height?s.height+10:0;this.resourceTooltip.setStyle("top",o)}var l=this.resourceActive?this.resourceTooltip.getCoordinates():t;if(this.noteActive){o=s.height?s.height+10:0;var r=i-(o+=l.height?l.height+10:0)-10;this.noteTooltip.setStyles({top:o,height:Math.min(r,500)})}this.commands&&this.commands.setSizes()}});