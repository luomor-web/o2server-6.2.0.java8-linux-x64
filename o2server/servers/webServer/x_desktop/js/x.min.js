layout.addReady((function(){!function(e){e.inBrowser=!1,e.desktop.type="layout";var o=$("browser_loading"),t=function(){MWF.xDesktop.getUserLayout((function(){e.userLayout=e.userLayout||{};var t=new URI(window.location.href),s=t.getData("view"),n=t.getData("style");n&&(e.userLayout.flatStyle=n),s||(s=e.userLayout&&e.userLayout.viewMode?e.userLayout.viewMode:"homepage"),s=s.toLowerCase(),s=-1!==["layout","desktop"].indexOf(s)?"Layout":"Default",e.viewMode=s.capitalize(),$("appContent").destroy(),MWF.require("MWF.xDesktop."+e.viewMode,(function(){e.desktop=new MWF.xDesktop[e.viewMode]("layout_main",{}),e.desktop.load(),e.desktop.openApplication||(e.desktop.openApplication=e.openApplication),e.desktop.refreshApp||(e.desktop.refreshApp=e.refreshApp)})),o&&new Fx.Tween(o).start("opacity",0).chain((function(){o.destroy(),o=null}))}))};e.session&&e.session.user?t():e.sessionPromise&&e.sessionPromise.then((function(){t()}),(function(){}))}(layout)}));