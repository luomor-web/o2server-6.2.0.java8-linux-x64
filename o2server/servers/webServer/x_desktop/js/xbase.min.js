layout=window.layout||{},layout.desktop=layout;var locate=window.location;layout.protocol=locate.protocol,layout.inBrowser=!1,layout.session=layout.session||{},layout.debugger=-1!==locate.href.toString().indexOf("debugger"),layout.anonymous=-1!==locate.href.toString().indexOf("anonymous"),o2.xApplication=o2.xApplication||{},o2.xDesktop=o2.xDesktop||{},o2.xDesktop.requireApp=function(o,e,n,t){o2.requireApp(o,e,n,t)},function(o){o.readys=[],o.addReady=function(){for(var e=0;e<arguments.length;e++)"function"===o2.typeOf(arguments[e])&&o.readys.push(arguments[e])};var e=function(e){(function(o){return!(!window.o2android||!window.o2android.openO2Work)&&(o.workId?window.o2android.openO2Work(o.workId,"",o.title||""):o.workCompletedId&&window.o2android.openO2Work("",o.workCompletedId,o.title||""),!0)})(e)||function(o){return!!(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2Work)&&(o.workId?window.webkit.messageHandlers.openO2Work.postMessage({work:o.workId,workCompleted:"",title:o.title||""}):o.workCompletedId&&window.webkit.messageHandlers.openO2Work.postMessage({work:"",workCompleted:o.workCompletedId,title:o.title||""}),!0)}(e)||function(e){var n=new URI(window.location.href).getData("redirectlink");n=n?encodeURIComponent(n):encodeURIComponent(locate.pathname+locate.search),e.workId?window.location=o2.filterUrl("../x_desktop/workmobilewithaction.html?workid="+e.workId+(o.debugger?"&debugger":"")+"&redirectlink="+n):e.workCompletedId&&(window.location=o2.filterUrl("../x_desktop/workmobilewithaction.html?workcompletedid="+e.workCompletedId+(o.debugger?"&debugger":"")+"&redirectlink="+n))}(e)},n=function(n,t,i){switch(n){case"process.Work":e(t);break;case"cms.Document":!function(e,n,t){var i="object"===typeOf(n)?n.docTitle||n.title:"";i=i||"";var a="app="+encodeURIComponent(e)+"&status="+encodeURIComponent(t?JSON.encode(t):"")+"&option="+encodeURIComponent(n?JSON.encode(n):"");window.o2android&&window.o2android.openO2CmsDocument?window.o2android.openO2CmsDocument(n.documentId,i):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2CmsDocument?window.webkit.messageHandlers.openO2CmsDocument.postMessage({docId:n.documentId,docTitle:i}):window.location=o2.filterUrl("../x_desktop/appMobile.html?"+a+(o.debugger?"&debugger":""))}(n,t,i);break;case"cms.Module":!function(e,n,t){var i="app="+encodeURIComponent(e)+"&status="+encodeURIComponent(t?JSON.encode(t):"")+"&option="+encodeURIComponent(n?JSON.encode(n):"");window.o2android&&window.o2android.openO2CmsApplication?window.o2android.openO2CmsApplication(n.columnId,n.title||""):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2CmsApplication?window.webkit.messageHandlers.openO2CmsApplication.postMessage(n.columnId):window.location=o2.filterUrl("../x_desktop/appMobile.html?"+i+(o.debugger?"&debugger":""))}(n,t,i);break;case"Meeting":!function(e,n,t){var i="app="+encodeURIComponent(e)+"&status="+encodeURIComponent(t?JSON.encode(t):"")+"&option="+encodeURIComponent(n?JSON.encode(n):"");window.o2android&&window.o2android.openO2Meeting?window.o2android.openO2Meeting(""):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2Meeting?window.webkit.messageHandlers.openO2Meeting.postMessage(""):window.location=o2.filterUrl("../x_desktop/appMobile.html?"+i+(o.debugger?"&debugger":""))}(n,t,i);break;case"Calendar":!function(e,n,t){var i="app="+encodeURIComponent(e)+"&status="+encodeURIComponent(t?JSON.encode(t):"")+"&option="+encodeURIComponent(n?JSON.encode(n):"");window.o2android&&window.o2android.openO2Calendar?window.o2android.openO2Calendar(""):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2Calendar?window.webkit.messageHandlers.openO2Calendar.postMessage(""):window.location=o2.filterUrl("../x_desktop/appMobile.html?"+i+(o.debugger?"&debugger":""))}(n,t,i);break;case"process.TaskCenter":!function(e,n,t){var i="app="+encodeURIComponent(e)+"&status="+encodeURIComponent(t?JSON.encode(t):"")+"&option="+encodeURIComponent(n?JSON.encode(n):""),a=(n&&n.navi?n.navi:"task").toLowerCase();"done"===a&&(a="taskCompleted"),"readed"===a&&(a="readCompleted"),window.o2android&&window.o2android.openO2WorkSpace?window.o2android.openO2WorkSpace(a):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2WorkSpace?window.webkit.messageHandlers.openO2WorkSpace.postMessage(a):window.location=o2.filterUrl("../x_desktop/appMobile.html?"+i+(o.debugger?"&debugger":""))}(n,t,i);break;default:var a=new URI(window.location.href),d=a.getData("option"),s=a.getData("status");window.location=o2.filterUrl("../x_desktop/appMobile.html?app="+n+"&option="+(d||"")+"&status="+(s||"")+(o.debugger?"&debugger":""))}};o.openApplication=function(e,t,i,a,d){if(o.app){if(!o.mobile){var s="app="+encodeURIComponent(t)+"&status="+encodeURIComponent(a?JSON.encode(a):"")+"&option="+encodeURIComponent(i?JSON.encode(i):"");return o.app.$openWithSelf?window.location=o2.filterUrl("../x_desktop/app.html?"+s+(o.debugger?"&debugger":"")):window.open(o2.filterUrl("../x_desktop/app.html?"+s+(o.debugger?"&debugger":"")),s)}n(t,i,a)}else{var r=t.split("."),p=r[r.length-1];!function(o,e,n){var t=o.split("."),i=o2.xApplication;t.each(function(o,e){e<t.length-1?i[o]=i[o]||{}:i[o]=i[o]||{options:Object.clone(o2.xApplication.Common.options)},i=i[o]}.bind(this)),i.options||(i.options=Object.clone(o2.xApplication.Common.options));o2.xDesktop.requireApp(o,"lp."+o2.language,{failure:function(){o2.xDesktop.requireApp(o,"lp.zh-cn",null,!1)}.bind(this)},!1),o2.xDesktop.requireApp(o,n,(function(){e&&e(i)}))}(t,function(e){!function(e,n,t,i,a,d){var s=new n.Main(this,i);s.desktop=o,s.status=a,s.inBrowser=!!d,s.load(!0);var r=t;i.appId?r=i.appId:n.options.multitask&&(r=r+"-"+new o2.widget.UUID),s.appId=r,o.app=s,o.desktop&&(o.desktop.currentApp=s);var p=document.getElementById("appContentMask");p&&p.destroy()}(0,e,p,i||{},a,d)}.bind(this))}},o.refreshApp=function(e){var n=e.recordStatus(),t=new URI(window.location.href),i=t.getData("app"),a=(t.getData("option"),t.getData("status"));n&&(a=JSON.encode(n));var d=t.get("port");window.location=t.get("scheme")+"://"+t.get("host")+(d?":"+d+"/":"")+t.get("directory ")+"?app="+encodeURIComponent(i)+"&status="+encodeURIComponent(a)+"&option="+encodeURIComponent(options?JSON.encode(options):"")+(o.debugger?"&debugger":"")},o.load=function(e,n,t){o.apps=[],o.node=$("layout");var i=e,a=t,d=n,s=window.opener;if(s)try{i||(i=s.layout.desktop.openBrowserApp),a||(a=s.layout.desktop.openBrowserStatus),d||(d=s.layout.desktop.openBrowserOption)}catch(o){}o.openApplication(null,i,d||{},a)}}(layout),o2.addReady((function(){Element.implement({makeLnk:function(o){}});var o=$("loaddingArea"),e=0,n=document.body.getSize(),t=function(){o&&(o.destroy(),o=null)},i=function(i){if(o)if(i)o.setStyles({width:n.x+"px"}),window.setTimeout(t,500);else{var a=++e/16*n.x;o.setStyles({width:a+"px"}),e>=16&&window.setTimeout(t,500)}};layout.config=null;var a=!1,d=!1,s=!1,r=o2.session.path+"/lp/"+o2.language+".js";o2.load(r,(function(){i(),d=!0,a&&s&&d&&p((function(){c()}))}));o2.require(["o2.xDesktop.Common","o2.xDesktop.Actions.RestActions","o2.xAction.RestActions"],{onSuccess:function(){s=!0,a&&s&&d&&p((function(){c()}))},onEvery:function(){i()}}),o2.getJSON("../x_desktop/res/config/config.json",(function(o){i(),layout.config=o,(a=!0)&&s&&d&&p((function(){c()}))}));var p=function(o){"auto"===layout.config.app_protocol&&(layout.config.app_protocol=window.location.protocol),o2.xDesktop.getServiceAddress(layout.config,function(e,n){layout.serviceAddressList=e,layout.centerServer=n,i(),o&&o()}.bind(this))},c=function(){var o=function(o){layout.user=o.data,layout.session={},layout.session.user=o.data,function(o){!function(o){var e=!1,n=!1,t=["o2.xDesktop.Dialog","o2.xDesktop.UserData","o2.xDesktop.Access","o2.widget.UUID","o2.xDesktop.Menu","o2.xDesktop.Authentication","o2.widget.PinYin","o2.xDesktop.Access"],a=function(){e&&n&&o&&o()};o2.load(["../o2_lib/mootools/plugin/mBox.min.js"],(function(){i(),e=!0,a()})),o2.require("o2.widget.Common",(function(){i(),o2.require(t,{onSuccess:function(){o2.requireApp("Common","",(function(){i(),n=!0,a()}))},onEvery:function(){i()}})}))}((function(){for(i(!0);o.readys&&o.readys.length;)o.readys.shift().apply(window)}))}(layout)};o2.Actions.get("x_organization_assemble_authentication").getAuthentication(function(e){i(),o(e)}.bind(this),(function(e){if(i(),layout.anonymous)i(!0),o({data:{name:"anonymous",roleList:[]}});else{!function(o){var e=!1,n=!1,t=["o2.xDesktop.Dialog","o2.xDesktop.UserData","o2.xDesktop.Access","o2.widget.UUID","o2.xDesktop.Menu","o2.widget.PinYin","o2.xDesktop.Access"],a=function(){e&&n&&o&&o()};o2.load(["../o2_lib/mootools/plugin/mBox.min.js"],(function(){i(),e=!0,a()})),o2.require("o2.widget.Common",(function(){i(),o2.require(t,{onSuccess:function(){o2.requireApp("Common","",(function(){n=!0,a()}))},onEvery:function(){i()}})}))}((function(){i(!0),layout.openLogin()}))}})),layout.openLogin=function(){o2.require("o2.widget.Common",null,!1),o2.require("o2.xDesktop.Authentication",(function(){layout.authentication=new o2.xDesktop.Authentication({onLogin:c.bind(layout)}),layout.authentication.loadLogin(document.body);var o=$("browser_loading");o&&o.fade("out")}))}}}));