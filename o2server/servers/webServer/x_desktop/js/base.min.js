layout=window.layout||{},layout.desktop=layout,layout.desktop.type="app";var locate=window.location;layout.protocol=locate.protocol,layout.inBrowser=!0,layout.session=layout.session||{},layout.debugger=-1!==locate.href.toString().indexOf("debugger"),layout.anonymous=-1!==locate.href.toString().indexOf("anonymous"),o2.xApplication=o2.xApplication||{},o2.xDesktop=o2.xDesktop||{},o2.xDesktop.requireApp=function(o,e,t,n){o2.requireApp(o,e,t,n)},function(o){o.readys=[],o.addReady=function(){for(var e=0;e<arguments.length;e++)"function"===o2.typeOf(arguments[e])&&(o.isReady?arguments[e].apply(window):o.readys.push(arguments[e]))};var e=function(e){(function(o){return!(!window.o2android||!window.o2android.openO2Work)&&(o.workId?window.o2android.openO2Work(o.workId,"",o.title||o.docTitle||""):o.workCompletedId&&window.o2android.openO2Work("",o.workCompletedId,o.title||o.docTitle||""),!0)})(e)||function(o){return!!(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2Work)&&(o.workId?window.webkit.messageHandlers.openO2Work.postMessage({work:o.workId,workCompleted:"",title:o.title||o.docTitle||""}):o.workCompletedId&&window.webkit.messageHandlers.openO2Work.postMessage({work:"",workCompleted:o.workCompletedId,title:o.title||o.docTitle||""}),!0)}(e)||function(e){var t=new URI(window.location.href).getData("redirectlink");t=t?encodeURIComponent(t):encodeURIComponent(locate.pathname+locate.search);var n="../x_desktop/workmobilewithaction.html".toURI();e.draft?n="../x_desktop/workmobilewithaction.html?"+("draft="+encodeURIComponent(JSON.stringify(e.draft))):n=n.setData(e).toString();var a=e.jobid||e.jobId||e.job;a&&(n+=(-1!=n.indexOf("?")?"&":"?")+"jobid="+a),n+=t?"&redirectlink="+t:"",n+=o.debugger?"&debugger":"",window.location=o2.filterUrl(n)}(e)},t=function(t,n,a){switch(t){case"process.Work":e(n);break;case"cms.Document":!function(e,t,n){var a="object"===typeOf(t)?t.docTitle||t.title:"";a=a||"";var i="app="+encodeURIComponent(e)+"&status="+encodeURIComponent(n?JSON.encode(n):"")+"&option="+encodeURIComponent(t?JSON.encode(t):"");window.o2android&&window.o2android.openO2CmsDocument?window.o2android.openO2CmsDocument(t.documentId,a):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2CmsDocument?window.webkit.messageHandlers.openO2CmsDocument.postMessage({docId:t.documentId,docTitle:a}):window.location=o2.filterUrl("../x_desktop/appMobile.html?"+i+(o.debugger?"&debugger":""))}(t,n,a);break;case"cms.Module":!function(e,t,n){var a="app="+encodeURIComponent(e)+"&status="+encodeURIComponent(n?JSON.encode(n):"")+"&option="+encodeURIComponent(t?JSON.encode(t):"");window.o2android&&window.o2android.openO2CmsApplication?window.o2android.openO2CmsApplication(t.columnId,t.title||""):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2CmsApplication?window.webkit.messageHandlers.openO2CmsApplication.postMessage(t.columnId):window.location=o2.filterUrl("../x_desktop/appMobile.html?"+a+(o.debugger?"&debugger":""))}(t,n,a);break;case"Meeting":!function(e,t,n){var a="app="+encodeURIComponent(e)+"&status="+encodeURIComponent(n?JSON.encode(n):"")+"&option="+encodeURIComponent(t?JSON.encode(t):"");window.o2android&&window.o2android.openO2Meeting?window.o2android.openO2Meeting(""):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2Meeting?window.webkit.messageHandlers.openO2Meeting.postMessage(""):window.location=o2.filterUrl("../x_desktop/appMobile.html?"+a+(o.debugger?"&debugger":""))}(t,n,a);break;case"Calendar":!function(e,t,n){var a="app="+encodeURIComponent(e)+"&status="+encodeURIComponent(n?JSON.encode(n):"")+"&option="+encodeURIComponent(t?JSON.encode(t):"");window.o2android&&window.o2android.openO2Calendar?window.o2android.openO2Calendar(""):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2Calendar?window.webkit.messageHandlers.openO2Calendar.postMessage(""):window.location=o2.filterUrl("../x_desktop/appMobile.html?"+a+(o.debugger?"&debugger":""))}(t,n,a);break;case"process.TaskCenter":!function(e,t,n){var a="app="+encodeURIComponent(e)+"&status="+encodeURIComponent(n?JSON.encode(n):"")+"&option="+encodeURIComponent(t?JSON.encode(t):""),i=(t&&t.navi?t.navi:"task").toLowerCase();"done"===i&&(i="taskCompleted"),"readed"===i&&(i="readCompleted"),window.o2android&&window.o2android.openO2WorkSpace?window.o2android.openO2WorkSpace(i):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2WorkSpace?window.webkit.messageHandlers.openO2WorkSpace.postMessage(i):window.location=o2.filterUrl("../x_desktop/appMobile.html?"+a+(o.debugger?"&debugger":""))}(t,n,a);break;default:var i=new URI(window.location.href),s=i.getData("option"),d=i.getData("status");window.location=o2.filterUrl("../x_desktop/appMobile.html?app="+t+"&option="+(s||"")+"&status="+(d||"")+(o.debugger?"&debugger":""))}};o.openApplication=function(e,n,a,i,s,d,r){if("@url"===n.substring(0,4)){var p=n.replace(/\@url\:/i,""),l=new Element("a",{href:p,target:"_blank"});return l.click(),l.destroy(),l=null,!0}if(o.app){if(!o.mobile)return function(e,t,n){t&&delete t.docTitle;var a="app="+encodeURIComponent(e)+"&status="+encodeURIComponent(n?JSON.encode(n):"")+"&option="+encodeURIComponent(t?JSON.encode(t):"");switch(e){case"process.Work":var i="../x_desktop/work.html".toURI();i=t.draft?"../x_desktop/app.html?"+a:i.setData(t).toString();var s=t.jobid||t.jobId||t.job;return s&&(i+=(-1!=i.indexOf("?")?"&":"?")+"jobid="+s),i+=o.debugger?"&debugger":"",o.app.$openWithSelf?window.location=o2.filterUrl(i):window.open(o2.filterUrl(i),a);case"cms.Document":return i=(i="../x_desktop/cmsdoc.html".toURI()).setData(t).toString(),i+=o.debugger?"&debugger":"",o.app.$openWithSelf?window.location=o2.filterUrl(i):window.open(o2.filterUrl(i),a);default:return o.app.$openWithSelf?window.location=o2.filterUrl("../x_desktop/app.html?"+a+(o.debugger?"&debugger":"")):window.open(o2.filterUrl("../x_desktop/app.html?"+a+(o.debugger?"&debugger":"")),a)}}(n,a,i);t(n,a,i)}else{var c=n.split("."),u=c[c.length-1];!function(o,e,t){var n=o.split("."),a=o2.xApplication;n.each(function(o,e){e<n.length-1?a[o]=a[o]||{}:a[o]=a[o]||{options:Object.clone(o2.xApplication.Common.options)},a=a[o]}.bind(this)),a.options||(a.options=Object.clone(o2.xApplication.Common.options));o2.xDesktop.requireApp(o,"lp."+o2.language,{onFailure:function(){o2.xDesktop.requireApp(o,"lp.zh-cn",null,!1)}.bind(this)},!1),o2.xDesktop.requireApp(o,t,(function(){e&&e(a)}))}(n,function(t){var n=a&&a.appId?a.appId:t.options.multitask?"":u;n&&o.desktop.apps&&o.desktop.apps[n]?o.desktop.apps[n].setCurrent():(a&&(a.appId=n),function(e,t,n,a,i,s,d,r){a?a.event=e:a={event:e};var p=new t.Main(o.desktop,a);if(p.desktop=o.desktop,p.status=i,p.inBrowser=!(!s&&!o.inBrowser),"layout"===o.desktop.type){if(p.appId=a.appId?a.appId:t.options.multitask?n+"-"+new o2.widget.UUID:n,p.options.appId=p.appId,o.desktop.createTaskItem&&(d||(d=o.desktop.createTaskItem(p)),p.taskitem=d,p.taskitem.app=p),p.isLoadApplication=!0,p.load(!r),o.desktop.apps||(o.desktop.apps={}),o.desktop.apps[p.appId])o.desktop.apps[p.appId];else o.desktop.apps[p.appId]=p;o.desktop.appArr.push(p),o.desktop.appCurrentList.push(p),r||(o.desktop.currentApp=p)}else p.load(!0),o.app=p;var l=document.getElementById("appContentMask");l&&l.destroy()}(e,t,u,a||{appId:n},i,s,d,r))}.bind(this))}},o.refreshApp=function(e){var t=e.recordStatus(),n=new URI(window.location.href),a=n.getData("app"),i=n.getData("option"),s=n.getData("status");t&&(s=JSON.encode(t));var d=n.get("port"),r=n.get("scheme")+"://"+n.get("host")+(d&&"80"!=d?":"+d+"/":"")+n.get("directory")+n.get("file")+"?app="+encodeURIComponent(a)+"&status="+encodeURIComponent(s)+"&option="+encodeURIComponent(i?JSON.encode(i):"")+(o.debugger?"&debugger":"");r=o2.filterUrl(r),window.location=r},o.load=function(e,t,n){o.apps=[],o.node=$("layout")||$("appContent")||document.body;var a=e,i=n,s=t,d=window.opener;if(d)try{a||(a=d.layout.desktop.openBrowserApp),i||(i=d.layout.desktop.openBrowserStatus),s||(s=d.layout.desktop.openBrowserOption)}catch(o){}o.openApplication(null,a,s||{},i)},o.getFormDesignerStyle=function(o){this.formDesignerStyle?o&&o():(this.formDesignerStyle="default",MWF.UD.getData("formDesignerStyle",function(e){if(e.data){var t=JSON.decode(e.data);this.formDesignerStyle=t.style}o&&o()}.bind(this)))}}(layout),o2.addReady((function(){window.Element&&Element.implement({makeLnk:function(o){}}),layout.desktop.addEvent=function(o,e,t){window.addEvent(o,e,t)},layout.desktop.addEvents=function(o){window.addEvents(o)};var o=window.$?$("loaddingArea"):null,e=0,t=window.document&&document.body?document.body.getSize():null,n=function(){o&&(o.destroy(),o=null)},a=function(a){if(o)if(a)o.setStyles({width:t.x+"px"}),window.setTimeout(n,500);else{var i=++e/4*t.x;o.setStyles({width:i+"px"}),e>=4&&window.setTimeout(n,500)}},i=function(o,e){layout.serviceAddressList=o,layout.centerServer=e,layout.desktop.serviceAddressList=o,layout.desktop.centerServer=e},s=function(o){if("auto"===layout.config.app_protocol&&(layout.config.app_protocol=window.location.protocol),layout.config.configMapping&&(layout.config.configMapping[window.location.host]||layout.config.configMapping[window.location.hostname])){var e=layout.config.configMapping[window.location.host]||layout.config.configMapping[window.location.hostname];e.servers?(layout.serviceAddressList=e.servers,layout.desktop.serviceAddressList=e.servers,e.center&&(center="array"===o2.typeOf(e.center)?e.center[0]:e.center),layout.centerServer=center,layout.desktop.centerServer=center,o&&o()):(e.center&&(layout.config.center="array"===o2.typeOf(e.center)?e.center:[e.center]),o2.xDesktop.getServiceAddress(layout.config,function(e,t){i(e,t),a(),o&&o()}.bind(this)))}else o2.xDesktop.getServiceAddress(layout.config,function(e,t){i(e,t),a(),o&&o()}.bind(this))},d=function(){var o=new URI(window.location.href).get("data");if(o[o2.tokenName]){Cookie.dispose(o2.tokenName);var e=window.location.host,t=null;/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(e)?t=e:e.indexOf(".")>0&&(t=e.substring(e.indexOf("."))),t?Cookie.write(o2.tokenName,o[o2.tokenName],{domain:t,path:"/"}):Cookie.write(o2.tokenName,o[o2.tokenName])}layout.sessionPromise=new Promise((function(o,e){o2.Actions.get("x_organization_assemble_authentication").getAuthentication(function(e){if(e.data.language&&e.data.language!==o2.languageName){o2.language=e.data.language.toLowerCase(),o2.languageName=e.data.language;var t="../x_desktop/js/base_lp_"+o2.language+(o2.session.isDebugger?"":".min")+".js";o2.load(t,{reload:!0},(function(){o&&o(e.data)}))}else o&&o(e.data)}.bind(this),function(o,t,n){e&&e({xhr:o,text:t,error:n})}.bind(this))})),layout.sessionPromise.then((function(o){layout.user=o,layout.session=layout.session||{},layout.session.user=o,layout.session.token=o.token,layout.desktop.session=layout.session}),(function(){if(layout.anonymous){var o={name:"anonymous",roleList:[]};layout.user=o,layout.session=layout.session||{},layout.session.user=o,layout.session.token=o.token,layout.desktop.session=layout.session}else a(!0),layout.yqwx?layout.openLoginQywx():layout.openLogin()})),function(o){for(o&&(layout.user=o.data,layout.session=layout.session||{},layout.session.user=o.data,layout.session.token=o.data.token,layout.desktop.session=layout.session),a(!0),layout.isReady=!0;layout.readys&&layout.readys.length;)layout.readys.shift().apply(window)}(),layout.openLogin=function(){layout.desktop.type="app",layout.app=null;var o=$("appContent")||$("layout");o&&o.empty(),layout.authentication=new o2.xDesktop.Authentication({style:"flat",onLogin:d.bind(layout)}),layout.authentication.loadLogin(document.body);var e=$("browser_loading");e&&e.fade("out")},layout.openLoginQywx=function(){console.log("开始login。。。。。。。。。。。。。");var o=locate.href.toURI();console.log("执行单点。。。。。。。。。。");var e=new MWF.xDesktop.Actions.RestActions("","x_organization_assemble_authentication","");e.getActions=function(o){this.actions={sso:{uri:"/jaxrs/qiyeweixin/code/{code}",method:"GET"}},o&&o()},e.invoke({name:"sso",async:!0,parameter:{code:o.getData("code")},success:function(o){console.log("单点成功。"),console.log(o),layout.session.user=o.data,d()}.bind(this),failure:function(o,e,t){var n=document.getElementById("loaddingArea");n&&n.destroy(),document.id("layout").set("html","<div>企业微信单点异常！</div>")}.bind(this)})}};layout.config=null;var r=!1,p=!1,l=!1,c="../x_desktop/js/base_lp_"+o2.language+(o2.session.isDebugger?"":".min")+".js";o2.session.isDebugger&&(o2.session.isMobile||layout.mobile)&&o2.load("../o2_lib/eruda/eruda.js");var u=function(){a(),p=!0;o2.require(["o2.xDesktop.$all"],{onSuccess:function(){l=!0,r&&l&&p&&s((function(){d()}))},onEvery:function(){a()}})};o2.LP?u():o2.load(c,u),o2.getJSON("../x_desktop/res/config/config.json",(function(o){a(),layout.config=o,o2.tokenName=o.tokenName||"x-token",(r=!0)&&l&&p&&s((function(){d()}))}))}));
//# sourceMappingURL=base.min.js.map