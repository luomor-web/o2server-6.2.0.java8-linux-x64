MWF.xApplication.query=MWF.xApplication.query||{},MWF.xApplication.query.Query=MWF.xApplication.query.Query||{},MWF.require("MWF.widget.Common",null,!1),MWF.require("MWF.xScript.Macro",null,!1),MWF.xDesktop.requireApp("query.Query","lp.zh-cn",null,!1),MWF.xApplication.query.Query.Statistician=MWF.QStatistician=new Class({Implements:[Options,Events],Extends:MWF.widget.Common,options:{style:"default",resizeNode:!0},initialize:function(t,e,s,i){this.setOptions(i),this.path="../x_component_query_Query/$Statistician/",this.cssPath="../x_component_query_Query/$Statistician/"+this.options.style+"/css.wcss",this._loadCss(),this.lp=MWF.xApplication.query.Query.LP,this.app=t,this.container=$(e),this.json=s,this.statJson=null,this.gridJson=null,this.load()},load:function(){this.loadLayout(),this.loadStatData()},loadLayout:function(){this.node=new Element("div",{styles:this.css.node}).inject(this.container)},createLoadding:function(){this.node.empty(),this.loadingAreaNode=new Element("div",{styles:this.css.viewLoadingAreaNode}).inject(this.node),new Element("div",{styles:{height:"5px"}}).inject(this.loadingAreaNode);var t=new Element("div",{styles:this.css.viewLoadingNode}).inject(this.loadingAreaNode);new Element("div",{styles:this.css.viewLoadingIconNode}).inject(t),new Element("div",{styles:this.css.viewLoadingTextNode}).inject(t).set("text","loading...")},loadStatData:function(t){this.createLoadding(),MWF.Actions.get("x_query_assemble_surface").loadStat(this.json.statName,this.json.application,null,function(t){this.loadingAreaNode&&(this.loadingAreaNode.destroy(),this.loadingAreaNode=null),t.data.calculate.isGroup?this.stat=new MWF.xApplication.query.Query.Statistician.GroupStat(this,t.data):this.stat=new MWF.xApplication.query.Query.Statistician.Stat(this,t.data),this.fireEvent("loaded")}.bind(this))}}),MWF.xApplication.query.Query.Statistician.Stat=new Class({initialize:function(t,e){this.statistician=t,this.json=this.statistician.json,this.data=e,this.statGridData=Array.clone(this.data.calculateGrid),this.css=this.statistician.css,this.lp=this.statistician.lp,this.node=this.statistician.node,this.load()},load:function(){this.charts=this.data.calculate.chart,this.charts?"string"===typeOf(this.charts)&&(this.charts=[this.charts]):this.charts=["bar","pie","line"],this.json.isChart&&(this.chartAreaNode=new Element("div",{styles:this.css.statChartAreaNode}).inject(this.node)),this.json.isTable&&(this.tableAreaNode=new Element("div#tableAreaNode",{styles:this.css.statTableAreaNode}).inject(this.node)),this.loadData(),this.json.isTable&&this.createTable(),this.json.isChart&&this.createChart()},loadData:function(){var t={};this.data.calculate.calculateList.each(function(e){t[e.column]=e}.bind(this))},createChart:function(){this.chartToolbarNode=new Element("div",{styles:this.css.statChartToolbarNode}).inject(this.chartAreaNode),this.charts.length>0?this.chartNode=new Element("div",{styles:this.css.statChartNode}).inject(this.chartAreaNode):this.chartAreaNode.setStyles(this.css.statChartAreaNode_noChart),this.charts.length>0||this.data.calculate.isGroup?this.loadChartToolbar():this.chartAreaNode.hide(),this.statistician.app&&(this.resizeChartFun=this.reloadChart.bind(this),this.statistician.app.addEvent("resizeCompleted",this.resizeChartFun),this.statistician.app.addEvent("postMaxSize",this.resizeChartFun),this.statistician.app.addEvent("postRestoreSize",this.resizeChartFun))},loadChartToolbar:function(){MWF.require("MWF.widget.Toolbar",function(){this.toolbar=new MWF.widget.Toolbar(this.chartToolbarNode,{style:"simple"},this);var t=this.charts;if(-1!==t.indexOf("bar"))new Element("div",{MWFnodeid:"bar",MWFnodetype:"MWFToolBarOnOffButton",MWFButtonImage:this.statistician.path+""+this.statistician.options.style+"/icon/barChart.png",title:this.lp.chart.bar,MWFButtonAction:"changeChartBar",MWFButtonText:this.lp.chart.bar}).inject(this.chartToolbarNode);if(-1!==t.indexOf("pie"))new Element("div",{MWFnodeid:"pie",MWFnodetype:"MWFToolBarOnOffButton",MWFButtonImage:this.statistician.path+""+this.statistician.options.style+"/icon/pieChart.png",title:this.lp.chart.pie,MWFButtonAction:"changeChartPie",MWFButtonText:this.lp.chart.pie}).inject(this.chartToolbarNode);if(-1!==t.indexOf("line"))new Element("div",{MWFnodeid:"line",MWFnodetype:"MWFToolBarOnOffButton",MWFButtonImage:this.statistician.path+""+this.statistician.options.style+"/icon/lineChart.png",title:this.lp.chart.line,MWFButtonAction:"changeChartLine",MWFButtonText:this.lp.chart.line}).inject(this.chartToolbarNode);if(this.data.calculate.isGroup)new Element("div",{MWFnodeid:"rowToColumn",MWFnodetype:"MWFToolBarButton",MWFButtonImage:this.statistician.path+""+this.statistician.options.style+"/icon/rowToColumn.png",title:this.lp.chart.rowToColumn,MWFButtonAction:"loadRowToColumn",MWFButtonText:this.lp.chart.rowToColumn}).inject(this.chartToolbarNode);else 0===t.length&&this.chartToolbarNode.hide();this.toolbar.load();var e="";"bar"===(e=-1!==t.indexOf("bar")?"bar":t[0])?this.changeChartBar("on",this.toolbar.items[e]):"pie"===e?this.changeChartPie("on",this.toolbar.items[e]):"line"===e&&this.changeChartLine("on",this.toolbar.items[e])}.bind(this))},changeChartBar:function(t,e){this.toolbar.items.pie&&this.toolbar.items.pie.off(),this.toolbar.items.line&&this.toolbar.items.line.off(),e.on(),this.currentChart="bar",this.reloadChart()},changeChartPie:function(t,e){this.toolbar.items.bar&&this.toolbar.items.bar.off(),this.toolbar.items.line&&this.toolbar.items.line.off(),e.on(),this.currentChart="pie",this.reloadChart()},changeChartLine:function(t,e){this.toolbar.items.pie&&this.toolbar.items.pie.off(),this.toolbar.items.bar&&this.toolbar.items.bar.off(),e.on(),this.currentChart="line",this.reloadChart()},toFloat:function(t){return"￥"===t.substr(0,1)&&(t=t.substr(1,t.length)),(t=(t=t.replace(",","")).replace(/\s/g,"")).toFloat()},loadChartBar:function(){MWF.require("MWF.widget.chart.Bar",function(){this.bar=new MWF.widget.chart.Bar(this.chartNode,this.statGridData,"displayName",{delay:0,style:"monthly"}),this.bar.addBar((function(t){var e=t.value;return"￥"===e.substr(0,1)&&(e=e.substr(1,e.length)),(e=(e=e.replace(",","")).replace(/\s/g,"")).toFloat()}),(function(t){return t.value})),this.bar.addEvents({mouseover:function(t,e,s,i){e.filter((function(t,e){return e==i})).attr("display","block");var a=t.filter((function(t,e){return e==i})),l=a.attr("fill");a.node().store("color",l),a.attr("fill","brown")}.bind(this),mouseout:function(t,e,s,i){e.filter((function(t,e){return e==i})).attr("display","none");var a=t.filter((function(t,e){return e==i})),l=a.node().retrieve("color");a.attr("fill",l)}.bind(this)}),this.bar.load()}.bind(this))},loadChartPie:function(){MWF.require("MWF.widget.chart.Pie",function(){var t=[];this.data.calculateGrid.each(function(e){var s=this.toFloat(e.value);t.push({name:e.displayName,value:s})}.bind(this)),this.bar=new MWF.widget.chart.Pie(this.chartNode,t,{textType:"percent"}),this.bar.load()}.bind(this))},loadChartLine:function(){MWF.require("MWF.widget.chart.Line",function(){this.bar=new MWF.widget.chart.Line(this.chartNode,this.statGridData,"displayName",{delay:0,style:"monthly"}),this.bar.addBar((function(t){var e=t.value;return"￥"===e.substr(0,1)&&(e=e.substr(1,e.length)),(e=(e=e.replace(",","")).replace(/\s/g,"")).toFloat()}),(function(t){return t.value})),this.bar.load()}.bind(this))},resizeChart:function(){this.bar&&this.bar.destroy(),this.bar=null,this.chartNode&&this.chartNode.empty(),this.loadChartBar()},createTable:function(){this.createTableHead(),this.createTableData()},createTableHead:function(){this.table=new Element("table",{styles:this.css.statTableNode,width:"100%",border:"0",cellPadding:"0",cellSpacing:"0"}).inject(this.tableAreaNode),this.headTr=new Element("tr").inject(this.table),this.data.calculate.calculateList.each(function(t){new Element("th",{styles:this.css.statHeadTh,text:t.displayName}).inject(this.headTr)}.bind(this))},createTableData:function(){if(this.statGridData.length){var t=new Element("tr").inject(this.table);this.statGridData.each(function(e){new Element("td",{styles:this.css.statContentTdNode}).inject(t).set("text",e.value)}.bind(this))}},destroy:function(){this.bar&&this.bar.destroy(),this.statistician.app&&this.resizeChartFun&&(this.resizeChartFun.app.removeEvent("resizeCompleted",this.resizeChartFun),this.resizeChartFun.app.removeEvent("postMaxSize",this.resizeChartFun),this.resizeChartFun.app.removeEvent("postRestoreSize",this.resizeChartFun)),MWF.release(this)}}),MWF.xApplication.query.Query.Statistician.GroupStat=new Class({Extends:MWF.xApplication.query.Query.Statistician.Stat,loadData:function(){var t={};this.data.calculate.calculateList.each(function(e){t[e.id]=e}.bind(this)),this.statGridData.each(function(e){e.list.each(function(e){e.value=t[e.column].code?MWF.Macro.exec(t[e.column].code,{value:e.value,data:this.data}):e.value}.bind(this))}.bind(this))},createChart:function(){this.chartToolbarNode=new Element("div",{styles:this.css.statChartToolbarNode}).inject(this.chartAreaNode),this.charts.length>0?(this.json.isLegend&&(this.chartFlagNode=new Element("div",{styles:this.css.statChartFlagAreaNode}).inject(this.chartAreaNode)),this.chartNode=new Element("div",{styles:this.css.statChartNode}).inject(this.chartAreaNode)):this.chartAreaNode.setStyles(this.css.statChartAreaNode_noChart),this.loadChartToolbar(),this.statistician.app&&(this.resizeChartFun=this.reloadChart.bind(this),this.statistician.app.addEvent("resizeCompleted",this.resizeChartFun),this.statistician.app.addEvent("postMaxSize",this.resizeChartFun),this.statistician.app.addEvent("postRestoreSize",this.resizeChartFun))},resizeChart:function(){this.bar&&this.bar.destroy(),this.bar=null,this.json.isLegend&&this.chartFlagNode.empty(),this.chartNode.empty(),this.loadChartBar()},toFloat:function(t){return"￥"===t.substr(0,1)&&(t=t.substr(1,t.length)),(t=(t=t.replace(",","")).replace(/\s/g,"")).toFloat()},loadChartBar:function(){this.json.isLegend&&(this.chartFlagNode||(this.chartFlagNode=new Element("div",{styles:this.css.statChartFlagAreaNode}).inject(this.chartNode,"before"))),this.selectedData||(this.selectedData=this.statGridData),this.selectedData.length||(this.selectedData=this.statGridData),MWF.require("MWF.widget.chart.Bar",function(){this.flag=[],this.bar=new MWF.widget.chart.Bar(this.chartNode,this.selectedData,"group",{delay:0,style:"monthly"}),this.selectedData.length&&this.selectedData[0].list.each(function(t,e){this.flag.push({name:t.displayName,color:this.bar.colors[e]}),this.bar.addBar(function(t){return this.toFloat(t.list[e].value)}.bind(this),(function(t){return t.list[e].value}))}.bind(this)),this.bar.addEvents({mouseover:function(t,e,s,i){e.filter((function(t,e){return e==i})).attr("display","block");var a=t.filter((function(t,e){return e==i})),l=a.attr("fill");a.node().store("color",l),a.attr("fill","brown")}.bind(this),mouseout:function(t,e,s,i){e.filter((function(t,e){return e==i})).attr("display","none");var a=t.filter((function(t,e){return e==i})),l=a.node().retrieve("color");a.attr("fill",l)}.bind(this)}),this.bar.load(),this.json.isLegend&&this.loadFlags()}.bind(this))},rowToColumn:function(t){var e=[],s={};return t.each(function(t){var i=t.group,a=t.column;t.list.each(function(t){var l;t.column?((l=t.column?s[t.column]:s[t.displayName])||0===l||(e.push({column:t.column,group:t.displayName,list:[]}),l=e.length-1,s[t.column]=l),e[l].list.push({displayName:i,name:i,value:t.value})):((l=t.column?s[t.column]:s[t.displayName])||0===l||(e.push({group:t.displayName,list:[]}),l=e.length-1,s[t.displayName]=l),e[l].list.push({column:a,displayName:i,name:i,value:t.value}))}.bind(this))}.bind(this)),e},loadChartPie:function(){this.selectedData||(this.selectedData=this.statGridData),this.selectedData.length||(this.selectedData=this.statGridData);var t=this.rowToColumn(this.selectedData);MWF.require("MWF.widget.chart.Pie",function(){var e=t.length,s=this.chartNode.getSize(),i=s.x/e;t.each(function(t){var e=new Element("div",{styles:{overflow:"hidden",height:s.y+"px",float:"left",width:i+"px"}}).inject(this.chartNode),a=(new Element("div",{styles:{"text-align":"center","line-height":"30px","font-size":"16px","font-weight":"bold",overflow:"hidden",height:"30px"},text:t.group}).inject(e),s.y-30),l=new Element("div",{styles:{overflow:"hidden",height:a+"px"}}).inject(e),r=[];t.list.each(function(t){var e=this.toFloat(t.value);r.push({name:t.displayName,value:e,text:t.value})}.bind(this)),new MWF.widget.chart.Pie(l,r,{textType:"percent"}).load()}.bind(this))}.bind(this))},loadChartLine:function(){this.json.isLegend&&(this.chartFlagNode||(this.chartFlagNode=new Element("div",{styles:this.css.statChartFlagAreaNode}).inject(this.chartNode,"before"))),this.selectedData||(this.selectedData=this.statGridData),this.selectedData.length||(this.selectedData=this.statGridData),MWF.require("MWF.widget.chart.Line",function(){this.flag=[],this.bar=new MWF.widget.chart.Line(this.chartNode,this.selectedData,"group",{delay:0,style:"monthly"}),this.selectedData.length&&this.selectedData[0].list.each(function(t,e){this.flag.push({name:t.displayName,color:this.bar.colors[e]}),this.bar.addBar(function(t){return this.toFloat(t.list[e].value)}.bind(this),(function(t){return t.list[e].value}))}.bind(this)),this.bar.addEvents({mouseover:function(t,e,s,i){e.filter((function(t,e){return e==i})).attr("display","block");var a=t.filter((function(t,e){return e==i})),l=a.attr("fill");a.node().store("color",l),a.attr("fill","brown")}.bind(this),mouseout:function(t,e,s,i){e.filter((function(t,e){return e==i})).attr("display","none");var a=t.filter((function(t,e){return e==i})),l=a.node().retrieve("color");a.attr("fill",l)}.bind(this)}),this.bar.load(),this.json.isLegend&&this.loadFlags()}.bind(this))},loadRowToColumn:function(){(this.selectedRows.length||this.selectedCols.length)&&this.selectAll(),this.statGridData=this.rowToColumn(this.statGridData),this.selectedData=[],this.reloadChart(),this.reloadTable()},loadFlags:function(){this.flag.each(function(t,e){this.loadFlag(t,e)}.bind(this))},loadFlag:function(t,e){var s=new Element("div",{styles:this.css.ststChartFlagNode}).inject(this.chartFlagNode);new Element("div",{styles:this.css.ststChartFlagColorNode}).inject(s).setStyle("background-color",t.color);var i=new Element("div",{styles:this.css.ststChartFlagNameNode}).inject(s);i.set("text",t.name),i.set("title",t.name),s.store("idx",e),s.store("barColor",t.color);var a=this;s.addEvents({mouseover:function(){this.getFirst().setStyles(a.css.ststChartFlagColorNode_over);var t=this.retrieve("idx");switch(a.currentChart){case"bar":a.highlightBar(t);break;case"line":a.highlightLine(t)}},mouseout:function(){this.getFirst().setStyles(a.css.ststChartFlagColorNode);var t=this.retrieve("idx"),e=this.retrieve("barColor");switch(a.currentChart){case"bar":a.unHighlightBar(t,e);break;case"line":a.unHighlightLine(t,e)}}})},createDefs:function(t,e){var s=t.append(e.tag);Object.each(e.attrs,(function(t,e){s.attr(e,t)})),e.subs&&e.subs.each(function(t){this.createDefs(s,t)}.bind(this))},createHighlightDefs:function(t){var e=this.bar.svg.append("defs"),s=this.bar.css.rect_over_defs;this.createDefs(e,s),e.select((function(){return this.getFirst()})).attr("id",t),e.attr("id","defs_"+t)},unHighlightBar:function(t,e){var s="rect_over_defs"+t;d3.select("#defs_"+s).remove(),this.bar.rectCluster[t].attr(this.bar.css.rect_over_defs.urlAttr,null);var i=this.bar.textCluster[t];i.attr("display","none"),i.attr("font-weight","normal")},unHighlightLine:function(t,e){var s=this.bar.lineCluster[t],i=this.bar.pointCluster[t],a=this.bar.textCluster[t];s.attr("stroke-width","1"),i.attr("r","5").attr("stroke-width","1"),a.attr("display","none"),a.attr("font-weight","normal")},highlightBar:function(t){this.bar.rectCluster[t].remove();var e=this.recreateBars(t),s="rect_over_defs"+t;this.createHighlightDefs(s),e.attr(this.bar.css.rect_over_defs.urlAttr,"url(#"+s+")");var i=this.bar.textCluster[t];i.attr("display","block"),i.attr("font-weight","bold")},highlightLine:function(t){var e=this.bar.lineCluster[t],s=this.bar.pointCluster[t],i=this.bar.textCluster[t],a=this.bar.lineGroup.select(":last-child");e._groups[0][0].inject(a._groups[0][0],"after"),e.attr("stroke-width","3"),s.attr("r","6").attr("stroke-width","3"),i.attr("display","block"),i.attr("font-weight","bold")},recreateBars:function(t){var e=this.selectedData.map(function(e,s){return{name:e.group,data:this.toFloat(e.list[t].value)}}.bind(this));this.bar.rectClass=Math.round(100*Math.random());var s=this.bar.xScale.bandwidth()/this.bar.barsData.length,i=this.bar.group.selectAll(".MWFBar_"+this.bar.rectClass+"_"+t).data(e).enter().append("rect").attr("class",".MWFBar_"+this.bar.rectClass+"_"+t).attr("x",function(e){return this.xScale(e.name)+t*s}.bind(this.bar)).attr("width",s).attr("height",function(t){return this.size.y-this.yScale(t.data)}.bind(this.bar)).attr("y",function(t){return this.yScale(t.data)}.bind(this.bar)).attr("fill",this.bar.colors[t]);return this.bar.rectCluster[t]=i,this.bar.setEvents(),i},reloadTable:function(){this.tableAreaNode.empty(),this.createTable()},createTableHead:function(){this.selectedCols=[],this.selectedRows=[],this.table=new Element("table",{styles:this.css.statTableNode,width:"100%",border:"0",cellPadding:"0",cellSpacing:"0"}).inject(this.tableAreaNode),_self=this,this.headTr=this.table.insertRow(),this.selectAllTd=this.headTr.insertCell().setStyles(this.css.statAllSelectTd).set("title",this.lp.selecteAll),this.selectAllTd.addEvent("click",(function(){_self.selectAll(this)})),this.selectEntryTd=this.headTr.insertCell().setStyles(this.css.statAllColSelectTd).set("title",this.lp.selecteAllCol),this.selectEntryTd.addEvent("click",(function(){_self.selectAllCol(this)})),this.statGridData.length&&this.statGridData[0].list.each(function(t){t.displayName;selectTd=this.headTr.insertCell().setStyles(this.css.statColSelectTd),selectTd.addEvent("click",(function(){_self.selectCol(this)}))}.bind(this)),this.titleTr=this.table.insertRow(),this.selectGroupTd=this.titleTr.insertCell().setStyles(this.css.statAllRowSelectTd).set("title",this.lp.selecteAllRow),this.categoryTitleTd=new Element("th",{styles:this.css.statHeadTh,text:this.data.calculate.title||this.lp.category}).inject(this.titleTr),this.categoryTitleTd.setStyle("width","160px"),this.statGridData.length&&this.statGridData[0].list.each(function(t){var e=t.displayName;new Element("th",{styles:this.css.statHeadTh,text:e}).inject(this.titleTr)}.bind(this))},createTableData:function(){if(this.statGridData.length){var t=this;this.statGridData.each(function(e){var s=this.table.insertRow();s.insertCell().setStyles(this.css.statRowSelectTd).addEvent("click",(function(){t.selectRow(this)}));var i=e.group;new Element("th",{styles:this.css.statHeadTh,text:i}).inject(s);e.list.each(function(t){var e=new Element("td",{styles:this.css.statContentTdNode}).inject(s);e.set("text",t.value),this.setDragEvent(e)}.bind(this))}.bind(this))}},setDragEvent:function(t){new Drag(t,{onStart:function(t,e){this.cellDragStart(t,e)}.bind(this),onDrag:function(t,e){this.cellDrag(t,e)}.bind(this),onComplete:function(t,e){this.completeDrag(t,e)}.bind(this)});var e=this;t.addEvent("click",(function(){var s=t.cellIndex-2,i=t.getParent("tr").rowIndex-2;e.checkIsSelected(s,i)||(e.selectedCols.length||e.selectedRows.length)&&e.selectAll()}))},cellDragStart:function(t,e){var s=t.getPosition(),i=t.getSize();t.store("start",{x:s.x,y:s.y}),t.store("start2",{x:s.x+i.x,y:s.y+i.y})},getSelectedCells:function(t,e,s){var i=s.page.x-e.x,a=s.page.y-e.y,l=t.getSize();return{cols:(i/l.x).toInt(),rows:(a/l.y).toInt()}},cellDrag:function(t,e){this.selectedRows=[],this.selectedCols=[],this.selectedData=[];var s=t.retrieve("start"),i=t.retrieve("start2"),a=this.getSelectedCells(t,s,e),l=this.getSelectedCells(t,i,e),r=Math.abs(a.cols)>Math.abs(l.cols)?a.cols:l.cols,n=Math.abs(a.rows)>Math.abs(l.rows)?a.rows:l.rows,h=t.cellIndex-2,o=t.getParent("tr").rowIndex-2;(!h||h<0)&&(h=0),(!o||o<0)&&(o=0);var c=h+r,d=o+n;if(d>o)for(var u=o;u<=d;u++)this.selectedRows.push(u);else for(u=d;u<=o;u++)this.selectedRows.push(u);if(c>h)for(u=h;u<=c;u++)this.selectedCols.push(u);else for(u=c;u<=h;u++)this.selectedCols.push(u);this.checkSelectedCells()},completeDrag:function(t,e){var s=this.table.getElements("tr"),i=s[0].getElements("td");this.selectedCols.each(function(t){i[t+2].setStyles(this.css.statTableSelectedTd)}.bind(this)),this.selectedRows.each(function(t){s[t+2].getElement("td").setStyles(this.css.statTableSelectedTd)}.bind(this)),this.reloadChart()},selectCol:function(t){var e=t.cellIndex-2;-1!=this.selectedCols.indexOf(e)?(t.setStyles(this.css.statTableSelectTd),this.selectedCols.erase(e)):(t.setStyles(this.css.statTableSelectedTd),this.selectedCols.push(e)),this.checkSelectedCells(),this.reloadChart()},selectRow:function(t){var e=t.getParent("tr").rowIndex-2;-1!=this.selectedRows.indexOf(e)?(t.setStyles(this.css.statTableSelectTd),this.selectedRows.erase(e)):(t.setStyles(this.css.statTableSelectedTd),this.selectedRows.push(e)),this.checkSelectedCells(),this.reloadChart()},selectAllCol:function(){if(this.selectedCols.length){this.selectedCols=[];for(var t=this.table.getElements("tr")[0].getElements("td"),e=2;e<t.length;e++)t[e].setStyles(this.css.statTableSelectTd)}else for(var s=this.table.getElements("tr")[0].getElements("td"),i=2;i<s.length;i++)this.selectedCols.push(i-2),s[i].setStyles(this.css.statTableSelectedTd);this.checkSelectedCells(),this.reloadChart()},selectAll:function(){if(this.selectedRows.length||this.selectedCols.length){this.selectedRows=[],this.selectedCols=[];for(var t=this.table.getElements("tr"),e=t[0].getElements("td"),s=2;s<e.length;s++)e[s].setStyles(this.css.statTableSelectTd);for(var i=2;i<t.length;i++)t[i].getElement("td").setStyles(this.css.statTableSelectTd)}else{for(var a=this.table.getElements("tr"),l=a[0].getElements("td"),r=2;r<l.length;r++)this.selectedCols.push(r-2),l[r].setStyles(this.css.statTableSelectedTd);for(var n=2;n<a.length;n++)this.selectedRows.push(n-2),a[n].getElement("td").setStyles(this.css.statTableSelectedTd)}this.checkSelectedCells(),this.reloadChart()},checkIsSelected:function(t,e){if(!this.selectedCols.length&&!this.selectedRows.length)return!1;var s=!this.selectedCols.length||-1!=this.selectedCols.indexOf(t),i=!this.selectedRows.length||-1!=this.selectedRows.indexOf(e);return s&&i},checkSelectedCells:function(){this.selectedData=[];for(var t=this.table.getElements("tr"),e=2;e<t.length;e++){for(var s={group:this.statGridData[e-2].group,list:[]},i=t[e].getElements("td"),a=1;a<i.length;a++)this.checkIsSelected(a-1,e-2)?(i[a].setStyles(this.css.statContentTdNode_selected),s.list.push({column:this.statGridData[e-2].list[a-1].column,displayName:this.statGridData[e-2].list[a-1].displayName,value:this.statGridData[e-2].list[a-1].value})):i[a].setStyles(this.css.statContentTdNode);s.list.length&&this.selectedData.push(s)}},reloadChart:function(){if(this.json.isChart&&this.charts.length>0)switch(this.bar&&this.bar.destroy(),this.bar=null,this.chartFlagNode&&(this.chartFlagNode.destroy(),this.chartFlagNode=null),this.chartNode&&this.chartNode.empty(),this.currentChart){case"bar":this.loadChartBar();break;case"pie":this.loadChartPie();break;case"line":this.loadChartLine();break;default:this.loadChartBar()}}});