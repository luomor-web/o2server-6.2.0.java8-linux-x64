MWF.xApplication.Forum=MWF.xApplication.Forum||{},MWF.xApplication.ForumCategory=MWF.xApplication.ForumCategory||{},MWF.require("MWF.widget.O2Identity",null,!1),MWF.xDesktop.requireApp("Forum","Common",null,!1),MWF.xDesktop.requireApp("Forum","lp."+MWF.language,null,!1),MWF.xDesktop.requireApp("Template","Explorer",null,!1),MWF.xDesktop.requireApp("Forum","Access",null,!1),MWF.xDesktop.requireApp("Forum","ColumnTemplate",null,!1),MWF.xDesktop.requireApp("Forum","TopNode",null,!1),MWF.xApplication.ForumCategory.options={multitask:!1,executable:!0},MWF.xApplication.ForumCategory.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"ForumCategory",icon:"icon.png",width:"1230",height:"700",isResize:!1,isMax:!0,naviMode:!1,hasTop:!0,hasBreadCrumb:!0,autoWidth:!1,title:MWF.xApplication.ForumCategory.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.Forum.LP},loadApplication:function(t){this.userName=layout.desktop.session.user.distinguishedName,this.restActions=MWF.Actions.get("x_bbs_assemble_control"),this.path="../x_component_ForumCategory/$Main/"+this.options.style+"/",this.createNode(),this.loadApplicationContent()},loadController:function(t){this.access=new MWF.xApplication.Forum.Access(this.restActions,this.lp),t&&t()},createNode:function(){this.content.setStyle("overflow","hidden"),this.node=new Element("div",{styles:this.css.node}).inject(this.content)},reload:function(){this.status={categoryId:this.options.categoryId,noteHidden:this.noteNodeHidden},this.openMainPage()},loadApplicationContent:function(){!this.options.categoryId&&this.status&&this.status.categoryId&&(this.options.categoryId=this.status.categoryId),this.loadController(function(){this.access.login(function(){this.loadApplicationLayout()}.bind(this))}.bind(this))},loadApplicationLayout:function(){this.contentContainerNode=new Element("div.contentContainerNode",{styles:this.options.autoWidth?this.css.contentContainerNode_inContaienr:this.css.contentContainerNode}).inject(this.node),this.restActions.getCategory(this.options.categoryId,function(t){this.data=t.data;var e=this.inBrowser&&MWFForum.getSystemConfigValue(MWFForum.BBS_TITLE_TAIL)||"";this.setTitle(this.data.forumName+e),this.createTopNode(),this.middleNode=new Element("div.middleNode",{styles:this.options.autoWidth?this.css.middleNode_inContainer:this.css.middleNode}).inject(this.contentContainerNode),this.createNoteNode(),this.createContainerNode()}.bind(this))},loadTopObject:function(t){this.options.hasTop&&new MWF.xApplication.Forum.TopNode(this.contentContainerNode,this,this,{type:this.options.style,naviModeEnable:!0,naviMode:t}).load()},createTopNode:function(){this.loadTopObject(!1);MWF.xApplication.Forum.ForumSetting[this.options.categoryId].forumColor;if(this.options.hasBreadCrumb||this.data.forumNotice&&""!=this.data.forumNotice)var t=this.topNode=new Element("div.topNode",{styles:this.options.autoWidth?this.css.topNode_inContainer:this.css.topNode}).inject(this.contentContainerNode);if(this.options.hasBreadCrumb){var e=new Element("div.topTitleMiddleNode",{styles:this.css.topTitleMiddleNode}).inject(t),o=new Element("div.topItemTitleNode",{styles:this.css.topItemTitleNode,text:MWFForum.getBBSName()||MWF.xApplication.Forum.LP.title}).inject(e);new Element("div.topItemSepNode",{styles:this.css.topItemSepNode,text:">"}).inject(e);o.addEvent("click",function(){if(this.options.naviMode&&this.forumNavi)this.forumNavi.goto(MWFForum.NaviType.main);else{this.desktop.apps.Forum?this.desktop.apps.Forum.setCurrent():this.desktop.openApplication(null,"Forum",{appId:"Forum"}),this.inBrowser||this.close()}}.bind(this));o=new Element("div.topItemTitleNode",{styles:this.css.topItemTitleLastNode,text:this.data.forumName}).inject(e)}if(this.data.forumNotice&&""!=this.data.forumNotice){var i=new Element("div",{styles:this.css.topRightNode}).inject(t);i.addEvents({click:function(){this.noteNodeHidden?(this.noteNode.setStyle("display",""),this.topRightIconNode.setStyles(this.css.topRightIconNode),this.noteNodeHidden=!1):(this.noteNode.setStyle("display","none"),this.topRightIconNode.setStyles(this.css.topRightIconDownNode),this.noteNodeHidden=!0)}.bind(this)});this.topRightIconNode=new Element("div",{styles:this.css.topRightIconNode}).inject(i);this.status&&this.status.noteHidden&&(this.topRightIconNode.setStyles(this.css.topRightIconDownNode),this.noteNodeHidden=!0)}this._createTopContent()},_createTopContent:function(){},createContainerNode:function(){this.createCategory()},createCategory:function(){this.options.naviMode||(this.setContentSizeFun=this.setContentSize.bind(this),this.addEvent("resize",this.setContentSizeFun),this.setContentSize()),this.contentNode=new Element("div.contentNode",{styles:this.css.contentNode}).inject(this.middleNode),this._createCategory(this.data)},createNoteNode:function(){if(this.data.forumNotice&&""!=this.data.forumNotice.trim()){var t=this.noteNode=new Element("div.noteNode",{styles:this.css.noteNode}).inject(this.middleNode),e=new Element("div.noteTopNode",{styles:this.css.noteTopNode}).inject(t),o=new Element("div.noteTopContent",{styles:this.css.noteTopContent}).inject(e);new Element("div.noteIcon",{styles:this.css.noteIcon}).inject(o),new Element("div.noteTopText",{styles:this.css.noteTopText,text:this.lp.forumNotice}).inject(o),new Element("div.noteContent",{styles:this.css.noteContent,html:this.data.forumNotice}).inject(t);this.status&&this.status.noteHidden&&t.setStyle("display","none")}},setContentSize:function(){var t=this.node.getSize(),e=this.contentContainerNode.getStyle("padding-top").toFloat(),o=this.contentContainerNode.getStyle("padding-bottom").toFloat(),i=t.y-0-e-o;this.contentContainerNode.setStyle("height",i+"px")},_createCategory:function(t){var e=new Element("div.categoryNode",{styles:this.css.categoryNode}).inject(this.contentNode),o=new Element("div.categoryTopNode",{styles:this.css.categoryTopNode}).inject(e),i=new Element("div.categoryTopTitleNode",{styles:this.css.categoryTopTitleNode,text:t.forumName}).inject(o);i.addEvents({click:function(t){this.obj.openCategory(this.data)}.bind({obj:this,data:t})}),i.setStyle("color",t.forumColor||this.lp.defaultForumColor);var n=new Element("div.categoryTopRightNode",{styles:this.css.categoryTopRightNode2}).inject(o);this.createPersonNode(n,t.forumManagerName),new Element("div.categoryTopRightNode",{styles:this.css.categoryTopRightNode,text:this.lp.categoryManager+"ï¼š"}).inject(o);var s=new MWF.xApplication.Forum.ColumnTemplate(e,this,this,{type:t.indexListStyle||"type_1_0",style:this.options.naviMode?"naviMode":"default",naviMode:this.options.naviMode,categoryId:t.id,onPostLoad:function(){this.fireEvent("postLoadCategory")}.bind(this)});s.forumNavi=this.forumNavi,s.load()},openNavi:function(){MWF.xDesktop.requireApp("Forum","NaviMode",null,!1),this.clearContent(),this.contentContainerNode=new Element("div.contentContainerNode",{styles:this.css.contentContainerNode}).inject(this.node),this.loadTopObject(!0),this.middleNode=new Element("div.middleNode",{styles:this.css.middleNode}).inject(this.contentContainerNode),this.contentNode=new Element("div.contentNode",{styles:this.css.contentNode}).inject(this.middleNode),this.navi=new MWF.xApplication.Forum.NaviMode(this,this.contentNode,{type:MWFForum.NaviType.category,id:this.options.categoryId}),this.navi.load()},closeNavi:function(){this.navi&&this.navi.close()},destroy:function(){this.clearContent()},clearContent:function(){this.explorer&&this.explorer.destroy(),this.setContentSizeFun&&this.removeEvent("resize",this.setContentSizeFun),this.scrollBar&&this.scrollBar.scrollVAreaNode&&this.scrollBar.scrollVAreaNode.destroy(),this.scrollBar&&delete this.scrollBar,this.contentContainerNode&&this.contentContainerNode.destroy()},openMainPage:function(){this.clearContent(),this.loadApplicationLayout()},recordStatus:function(){return{categoryId:this.options.categoryId,noteHidden:this.noteNodeHidden}},openPerson:function(t){var e="ForumPerson"+t;this.desktop.apps[t]?this.desktop.apps[t].setCurrent():this.desktop.openApplication(null,"ForumPerson",{personName:t,appId:e})},createPersonNode:function(t,e){var o=e.split(",");o.each(function(e,i){var n=new Element("span",{text:e.split("@")[0],styles:this.css.person}).inject(t);n.addEvents({mouseover:function(){this.node.setStyles(this.obj.css.person_over)}.bind({node:n,obj:this}),mouseout:function(){this.node.setStyles(this.obj.css.person)}.bind({node:n,obj:this}),click:function(){this.obj.openPerson(this.userName)}.bind({userName:e,obj:this})}),i!=o.length-1&&new Element("span",{text:","}).inject(t)}.bind(this))}});