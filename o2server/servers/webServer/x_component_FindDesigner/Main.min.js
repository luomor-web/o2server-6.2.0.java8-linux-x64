MWF.xApplication.FindDesigner.options.multitask=!1,MWF.xApplication.FindDesigner.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"FindDesigner",mvcStyle:"style.css",icon:"icon.png",width:"1200",height:"800",filter:null,isResize:!0,isMax:!0,layout:{type:"leftRight",percent:.3},title:MWF.xApplication.FindDesigner.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.FindDesigner.LP,this.filterOption={keyword:"",designerTypes:[],caseSensitive:!1,matchWholeWord:!1,matchRegExp:!1,moduleList:[]},this.selectedModules=[],this.selectedRange=[],o2.UD.getDataJson("findDesignerLayout",function(e){this.setOptions(e)}.bind(this),!1)},loadApplication:function(e){var t=this.path+this.options.style+"/view.html";this.content.loadHtml(t,{bind:{lp:this.lp},module:this},function(){this.setSizeNode(),this.createToolbar(),this.initFilter(),e&&e()}.bind(this))},initFilter:function(){if(this.options.filter){if(this.options.filter.moduleList)this.rangeContentNode.getElements("input").forEach(function(e){-1!==e.get("value").indexOf(this.options.filter.moduleList)?e.set("checked",!0):e.set("checked",!1)}.bind(this));this.options.filter.appList&&o2.require("o2.widget.O2Identity",function(){this.options.filter.appList.each(function(e){e.name=this.lp[e.moduleType]+"-"+e.name;var t=new o2.widget.O2Other(e,this.rangeSelectedContentNode,{canRemove:!0,style:"find",onRemove:function(e){this.removeRangeItem(e)}.bind(this)});t.node.store("data",t.data)}.bind(this))}.bind(this))}},createToolbar:function(){o2.require("o2.widget.Toolbar",function(){this.previewToolbar=new o2.widget.Toolbar(this.previewTitleToolbar,{style:"findDesigner"},this),this.previewToolbar.load(),this.previewToolbar.childrenButton[0].disable(),this.previewToolbar.childrenButton[1].disable()}.bind(this))},initLayout:function(){this.listNode.set("style",""),this.previewNode.set("style",""),this.resizeDrag&&this.resizeDrag.detach(),this.sizeNodeFun&&this.removeEvent("resize",this.sizeNodeFun),"leftRight"==this.options.layout.type?this.toLeftRight():this.toTopBottom()},setSizeNode:function(){this.initLayout(),this["sizeNode_"+this.options.layout.type](),this["setResizeNode_"+this.options.layout.type](),this.sizeNodeFun=null,this.sizeNodeFun=this["sizeNode_"+this.options.layout.type].bind(this),this.addEvent("resize",this.sizeNodeFun)},sizeResultNode:function(){var e=this.content.getSize(),t=this.filterNode.getSize(),i=this.keywordNode.getSize(),r=this.rangeNode.getSize(),n=e.y-t.y-i.y-r.y;return this.resultNode.setStyle("height",n+"px"),n},sizeNode_topBottom:function(){var e=this.sizeResultNode(),t=e*this.options.layout.percent;this.listNode.setStyle("height",t+"px");var i=e*(1-this.options.layout.percent);this.previewNode.setStyle("height",i+"px");var r=t-this.listTitleNode.getSize().y;this.listAreaNode.setStyle("height",r+"px");var n=this.previewSeparatorNode.getSize(),s=this.previewTitleNode.getSize(),o=i-n.y-s.y;this.previewContentNode.setStyle("height",o+"px")},sizeNode_leftRight:function(){var e=this.sizeResultNode(),t=this.resultNode.getSize().x*this.options.layout.percent;this.listNode.setStyle("width",t+"px"),this.previewNode.setStyle("margin-left",t+"px");var i=e-this.listTitleNode.getSize().y;this.listAreaNode.setStyle("height",i+"px");var r=e-this.previewTitleNode.getSize().y;this.previewContentNode.setStyle("height",r+"px")},setResizeNode_topBottom:function(){this.previewSeparatorNode&&(this.resizeDrag=new Drag(this.previewSeparatorNode,{onStart:function(e,t){e.store("position",o2.eventPosition(t)),e.store("initialSize",this.listNode.getSize())}.bind(this),onDrag:function(e,t){var i=o2.eventPosition(t),r=e.retrieve("position"),n=e.retrieve("initialSize"),s=r.y.toFloat()-i.y.toFloat(),o=n.y-s,a=this.resultNode.getSize();this.options.layout.percent=o/a.y,this.options.layout.percent<.1&&(this.options.layout.percent=.1),this.options.layout.percent>.85&&(this.options.layout.percent=.85),this.sizeNode_topBottom(),this.editor&&this.editor.resize&&this.editor.resize()}.bind(this),onComplete:function(){o2.UD.putData("findDesignerLayout",{layout:this.options.layout})}.bind(this)}))},setResizeNode_leftRight:function(){this.previewSeparatorNode&&(this.resizeDrag=new Drag(this.previewSeparatorNode,{onStart:function(e,t){e.store("position",o2.eventPosition(t)),e.store("initialSize",this.listNode.getSize())}.bind(this),onDrag:function(e,t){var i=o2.eventPosition(t),r=e.retrieve("position"),n=e.retrieve("initialSize"),s=r.x.toFloat()-i.x.toFloat(),o=n.x-s,a=this.resultNode.getSize();this.options.layout.percent=o/a.x,this.options.layout.percent<.1&&(this.options.layout.percent=.1),this.options.layout.percent>.85&&(this.options.layout.percent=.85),this.sizeNode_leftRight(),this.editor&&this.editor.resize&&this.editor.resize()}.bind(this),onComplete:function(){o2.UD.putData("findDesignerLayout",{layout:this.options.layout})}.bind(this)}))},checkFilter:function(e){e.target.hasClass("filterNode_item")&&e.target.getElement("input").click(),e.stopPropagation()},checkRange:function(e){e.target.hasClass("rangeType_Item")&&e.target.getElement("input").click(),e.stopPropagation()},overKeywordOption:function(e){e.target.hasClass("o2_findDesigner_keywordNode_optionItem")&&(e.target.hasClass("optionItem_over")||e.target.addClass("optionItem_over"))},outKeywordOption:function(e){e.target.hasClass("o2_findDesigner_keywordNode_optionItem")&&e.target.removeClass("optionItem_over")},setCaseSensitive:function(e){this.filterOption.caseSensitive=!this.filterOption.caseSensitive,this.caseSensitiveNode.removeClass("caseSensitiveNode_"+!this.filterOption.caseSensitive),this.caseSensitiveNode.addClass("caseSensitiveNode_"+this.filterOption.caseSensitive)},setMatchWholeWord:function(e){this.filterOption.matchWholeWord=!this.filterOption.matchWholeWord,this.matchWholeWordNode.removeClass("matchWholeWordNode_"+!this.filterOption.matchWholeWord),this.matchWholeWordNode.addClass("matchWholeWordNode_"+this.filterOption.matchWholeWord)},setMatchRegExp:function(e){this.filterOption.matchRegExp=!this.filterOption.matchRegExp,this.matchRegExpNode.removeClass("matchRegExpNode_"+!this.filterOption.matchRegExp),this.matchRegExpNode.addClass("matchRegExpNode_"+this.filterOption.matchRegExp)},layoutAddClass:function(e){e=e||"",this.listNode.addClass("listNode"+e),this.previewNode.addClass("previewNode"+e),this.previewSeparatorNode.addClass("previewNode_separator"+e),this.previewTitleNode.addClass("previewNode_title"+e),this.previewTitleActionNode.addClass("previewNode_title_action"+e),this.previewContentNode.addClass("previewNode_content"+e)},layoutRemoveClass:function(e){e=e||"",this.listNode.removeClass("listNode"+e),this.previewNode.removeClass("previewNode"+e),this.previewSeparatorNode.removeClass("previewNode_separator"+e),this.previewTitleNode.removeClass("previewNode_title"+e),this.previewTitleActionNode.removeClass("previewNode_title_action"+e),this.previewContentNode.removeClass("previewNode_content"+e)},toLeftRight:function(){this.layoutAddClass("_lr"),this.layoutRemoveClass(),this.options.layout.type="leftRight"},toTopBottom:function(){this.layoutAddClass(),this.layoutRemoveClass("_lr"),this.options.layout.type="topBottom"},changeLayout:function(){"leftRight"==this.options.layout.type?this.options.layout.type="topBottom":this.options.layout.type="leftRight",this.setSizeNode(),o2.UD.putData("findDesignerLayout",{layout:this.options.layout})},getSelectedRange:function(){this.selectedRange=[],this.rangeContentNode.getElements("input").each(function(e){e.checked&&this.selectedRange.push(e.get("value"))}.bind(this))},setSelectedRange:function(){this.selectedRange&&this.selectedRange.length&&this.rangeContentNode.getElements("input").each(function(e){-1!=this.selectedRange.indexOf(e.get("value"))&&e.set("checked",!0)}.bind(this))},removeRangeItem:function(e){e.destroy(),this.rangeSelectedContentNode.getChildren().length||this.setSelectedRange()},selectFindRange:function(e){o2.requireApp("Selector","package",function(){new o2.O2Selector(this.content,{values:this.selectedModules,type:"PlatApp",selectAllEnable:!0,onLoad:function(){e&&"function"==o2.typeOf(e)&&e()},onComplete:function(e){this.rangeSelectedContentNode.empty(),e.length?(this.getSelectedRange(),this.rangeContentNode.getElements("input").set("checked",!1),o2.require("o2.widget.O2Identity",function(){e.each(function(e){e.data.name=this.lp[e.data.moduleType]+"-"+e.data.name;var t=new o2.widget.O2Other(e.data,this.rangeSelectedContentNode,{canRemove:!0,style:"find",onRemove:function(e){this.removeRangeItem(e)}.bind(this)});t.node.store("data",t.data)}.bind(this))}.bind(this))):this.setSelectedRange()}.bind(this)})}.bind(this))},getFindOption:function(){var e=[];filterItems=this.filterNode.getElements("input"),filterItems.each(function(t){t.checked&&e.push(t.get("value"))}.bind(this));var t=this.keywordInputNode.get("value"),i=[],r=this.rangeSelectedContentNode.getChildren();if(r.length){var n={};r.each(function(e){var t=e.retrieve("data");n[t.moduleType]||(n[t.moduleType]=[]),n[t.moduleType].push({id:t.id})}.bind(this)),Object.keys(n).each((function(e){i.push({moduleType:e,flagList:n[e]})}))}else this.getSelectedRange(),this.selectedRange.each((function(e){i.push({moduleType:e,flagList:[]})}));return this.filterOption.keyword=t,this.filterOption.designerTypes=e,this.filterOption.moduleList=i,this.filterOption},checkFindDesigner:function(e){13===e.keyCode&&this.findDesigner()},getFindWorker:function(){this.findWorker||(this.findWorker=new Worker("../x_component_FindDesigner/FindWorker.js")),this.findWorker.onmessage=function(e){e.data&&"receive"==e.data.type&&this.setReceiveMessage(),e.data&&"ready"==e.data.type&&this.setReadyMessage(e.data),e.data&&"done"==e.data.type&&this.doFindOptionResult(e.data),e.data&&"find"==e.data.type&&this.doFindResult(e.data),e.data&&"completed"==e.data.type&&this.doFindCompleted(e.data)}.bind(this)},doFindCompleted:function(){this.tree&&this.tree.children.length||(this.listContentNode.hide(),this.listContentNode.empty(),this.listInfoNode.removeClass("loadding"),this.listInfoNode.show().getFirst().set("text",this.lp.nothingFind)),this.patternCount||(this.patternCount=0);var e=this.lp.findPatternCountCompleted.replace("{n}",this.patternCount);this.listTitleInfoNode.set("text",e)},doFindOptionResult:function(){this.findOptionModuleProcessed++,this.updateFindProgress()},doFindResult:function(e){e.data&&this.showFindResult(e.data,e.option)},getResultTree:function(e){this.tree?e&&e():o2.require("o2.widget.Tree",function(){this.tree=new o2.widget.Tree(this.listContentNode,{style:"findDesigner"}),this.tree.load(),e&&e()}.bind(this),null,!1)},createResultCategroyItem:function(e,t,i){var r={title:t,text:"<span style='font-weight: bold'>"+e+"</span>",icon:""};return i.appendChild(r)},createResultAppItem:function(e,t,i){var r={title:t,text:"<span style='font-weight: bold; color: #0b58a2'>"+e+"</span>",icon:""};return i.appendChild(r)},createResultTypeItem:function(e,t,i){var r={title:t,text:"<span style='color: #333333'>"+e+"</span>",icon:""};return i.appendChild(r)},createResultDesignerItem:function(e,t,i){var r={expand:!1,title:t,text:"<span style='color: #333333'>"+e+"</span>",icon:""};return i.appendChild(r)},createResultPatternItem:function(e,t,i,r,n,s){var o={title:t,text:"<span style='color: #000000'>"+e+"</span>",icon:r||"",action:n||null},a=s?s.insertChild(o):i.appendChild(o);return a.addEvent("unselect",function(){if(this.editor){if("script"===this.editor.pattern.designerType)this.scriptDesignerDataObject&&this.scriptDesignerDataObject[this.editor.pattern.designerId]&&(this.scriptDesignerDataObject[this.editor.pattern.designerId].text=this.editor.getValue());else if(this.designerDataObject&&this.designerDataObject[this.editor.pattern.designerId]){var e=this.designerDataObject[this.editor.pattern.designerId];switch(this.editor.pattern.pattern.propertyType){case"duty":if(this.editor.pattern.pattern.path){for(var t=this.editor.pattern.pattern.path,i=0;i<t.length-1;i++)t[i]==this.editor.pattern.pattern.key?(e[t[i]]=JSON.parse(e[t[i]]),e=e[t[i]]):e=e[t[i]];e[t[t.length-1]]=this.editor.getValue(),e=this.designerDataObject[this.editor.pattern.designerId];for(i=0;i<t.length-1;i++){if(t[i]==this.editor.pattern.pattern.key){e[t[i]]=JSON.stringify(e[t[i]]);break}e=e[t[i]]}}break;default:if(this.editor.getValue){if(this.editor.pattern.pattern.path)for(t=this.editor.pattern.pattern.path,i=0;i<t.length-1;i++)e=e[t[i]];"styles"==t[t.length-1]?e.recoveryStyles=this.editor.getValue():"inputStyles"==t[t.length-1]&&(e.recoveryInputStyles=this.editor.getValue()),e[t[t.length-1]]=this.editor.getValue()}}}this.editor.destroy(),this.editor=null,this.previewInforNode.show().inject(this.previewContentNode)}}.bind(this)),a},updatePatternCount:function(e){e.patternCount++;var t=e.textNode.getElement("div");if(t){var i=this.lp.patternCount.replace("{n}",e.patternCount),r=e.options.text+"&nbsp;&nbsp;<span style='color: #666666'>("+i+")</span>>";t.set("html",r)}},subPatternCount:function(e){e.patternCount--,e.patternCount<0&&(e.patternCount=0);var t=e.textNode.getElement("div");if(t){var i=this.lp.patternCount.replace("{n}",e.patternCount),r=e.options.text+"&nbsp;&nbsp;<span style='color: #666666'>("+i+")</span>>";t.set("html",r)}},addResultTitle:function(){this.patternCount||(this.patternCount=0),this.patternCount++;var e=this.lp.findPatternCount.replace("{n}",this.patternCount);this.listTitleInfoNode.set("text",e)},subResultTitle:function(){this.patternCount||(this.patternCount=1),this.patternCount--;var e=this.lp.findPatternCount.replace("{n}",this.patternCount);this.listTitleInfoNode.set("text",e)},showFindResult:function(e,t,i){this.addResultTitle(),this.listInfoNode.hide(),this.listContentNode.show();var r=this.getFilterOptionRegex(t),n=this.tree.modules?this.tree.modules[e.module]:null;n||((n=this.createResultCategroyItem(this.lp[e.module],this.lp[e.module],this.tree)).patternCount=0,this.tree.modules||(this.tree.modules={}),this.tree.modules[e.module]=n),this.updatePatternCount(n);var s=n.apps?n.apps[e.appId]:null;s||((s=this.createResultAppItem(e.appName,e.appName,n)).patternCount=0,n.apps||(n.apps={}),n.apps[e.appId]=s),this.updatePatternCount(s);var o=s.types?s.types[e.designerType]:null;o||((o=this.createResultTypeItem(this.lp[e.designerType],this.lp[e.designerType],s)).patternCount=0,s.types||(s.types={}),s.types[e.designerType]=o),this.updatePatternCount(o);var a=o.designers?o.designers[e.designerId]:null;switch(a||((a=this.createResultDesignerItem(e.designerName,e.designerName,o)).patternCount=0,o.designers||(o.designers={}),o.designers[e.designerId]=a),this.updatePatternCount(a),e.designerType){case"script":this.createScriptPatternNode(e,a,r,i);break;case"form":case"page":case"widget":case"view":case"statement":case"process":this.createFormPatternNode(e,a,r,i)}},getPatternValueText:function(e,t){var i="";return e.pattern.line?e.pattern.evkey?i+="<b>["+e.pattern.evkey+"]</b>&nbsp;"+(e.pattern.line?e.pattern.line+"&nbsp;&nbsp;":"")+this.getPatternValue(e.pattern.value,t,e.pattern):i+=(e.pattern.line?e.pattern.line+"&nbsp;&nbsp;":"")+this.getPatternValue(e.pattern.value,t,e.pattern):i+=this.getPatternValue(e.pattern.value,t,e.pattern),i},getFormPatternNodeText:function(e,t){var i=this.lp.elementPattern.replace("{element}","&lt;"+e.pattern.type+"&gt;"+e.pattern.name).replace("{property}","{"+e.pattern.key+"}"+e.pattern.propertyName);return i="<span style='color: #666666'>"+i+"</span>&nbsp;&nbsp;",i+=this.getPatternValueText(e,t),e.pattern.mode&&(i="<b>["+e.pattern.mode+"]</b>&nbsp;"+i),i},createFormPatternNode:function(e,t,i,r){var n=this.getFormPatternNodeText(e,i),s=function(e){this.openPatternForm(e)}.bind(this);patternNode=this.createResultPatternItem(n,"",t,"icon_"+e.pattern.propertyType+".png",s,r),patternNode.pattern=e},getPatternValue:function(e,t,i){t.lastIndex=0;for(var r="",n=0;null!==(arr=t.exec(e));)i&&(i.cols||(i.cols=[]),i.cols.push({start:arr.index+1,end:t.lastIndex+1})),r+=o2.common.encodeHtml(e.substring(n,arr.index)),r+="<span style='background-color: #ffef8f'>"+o2.common.encodeHtml(e.substring(arr.index,t.lastIndex))+"</span>",n=t.lastIndex;return r+=o2.common.encodeHtml(e.substring(n,e.length))},createScriptPatternNode:function(e,t,i){var r,n,s=function(e){this.openPatternScript(e)}.bind(this);"text"==e.pattern.property?(n="<span style='color: #666666'>"+e.pattern.line+"</span>&nbsp;&nbsp;"+this.getPatternValue(e.pattern.value,i,e.pattern),r=this.createResultPatternItem(n,"",t,"icon_script.png",s)):(n=this.lp.property+":&nbsp;<b>"+e.pattern.property+"</b> "+this.lp.value+":&nbsp;"+this.getPatternValue(e.pattern.value,i),r=this.createResultPatternItem(n,"",t,"icon_text.png",s)),r.pattern=e},openPatternForm:function(e){e.pattern;if(this.editor&&this.editor.pattern.designerId===e.pattern.designerId&&this.editor.pattern.module===e.pattern.module)this.resetFormEditor(e.pattern);else{if(this.editor){if("script"===this.editor.pattern.designerType)this.scriptDesignerDataObject&&this.scriptDesignerDataObject[this.editor.pattern.designerId]&&(this.scriptDesignerDataObject[this.editor.pattern.designerId].text=this.editor.getValue());else if(this.designerDataObject&&this.designerDataObject[this.editor.pattern.designerId]){var t=this.designerDataObject[this.editor.pattern.designerId];switch(this.editor.pattern.pattern.propertyType){case"duty":if(this.editor.pattern.pattern.path){for(var i=this.editor.pattern.pattern.path,r=0;r<i.length-1;r++)i[r]==this.editor.pattern.pattern.key?(t[i[r]]=JSON.parse(t[i[r]]),t=t[i[r]]):t=t[i[r]];t[i[i.length-1]]=this.editor.getValue(),t=this.designerDataObject[this.editor.pattern.designerId];for(r=0;r<i.length-1;r++){if(i[r]==this.editor.pattern.pattern.key){t[i[r]]=JSON.stringify(t[i[r]]);break}t=t[i[r]]}}break;default:if(this.editor.getValue){if(this.editor.pattern.pattern.path)for(i=this.editor.pattern.pattern.path,r=0;r<i.length-1;r++)t=t[i[r]];"styles"==i[i.length-1]?t.recoveryStyles=this.editor.getValue():"inputStyles"==i[i.length-1]&&(t.recoveryInputStyles=this.editor.getValue()),t[i[i.length-1]]=this.editor.getValue()}}}this.editor.destroy()}var n;switch(this.editor=null,this.previewInforNode.hide().dispose(),e.pattern.module){case"processPlatform":if("form"===e.pattern.designerType){n=o2.Actions.load("x_processplatform_assemble_designer").FormAction.get;break}if("process"===e.pattern.designerType){n=o2.Actions.load("x_processplatform_assemble_designer").ProcessAction.get;break}break;case"cms":n=o2.Actions.load("x_cms_assemble_control").FormAction.get;break;case"portal":if("page"===e.pattern.designerType){n=o2.Actions.load("x_portal_assemble_designer").PageAction.get;break}if("widget"===e.pattern.designerType){n=o2.Actions.load("x_portal_assemble_designer").WidgetAction.get;break}break;case"query":if("view"===e.pattern.designerType){n=o2.Actions.load("x_query_assemble_designer").ViewAction.get;break}if("statement"===e.pattern.designerType){n=o2.Actions.load("x_query_assemble_designer").StatementAction.get;break}}n&&this.openPatternFormWithData(n,e)}},resetFormEditor:function(e){switch(e.pattern.propertyType){case"html":case"script":case"css":case"sql":case"events":this.reLocationEditor(e);break;case"duty":"code"==e.pattern.valueKey&&this.reLocationEditor(e);break;case"map":this.reLocationMapEditor(e);break;case"array":this.reLocationArrayEditor(e)}},reLocationArrayEditor:function(e){if(this.editor){var t=e.pattern.line-1;this.editor.items[t]&&this.editor.items[t].editValue()}},reLocationMapEditor:function(e){if(this.editor)for(var t=e.pattern.value.split(":")[0],i=0;i<this.editor.items.length;i++)if(this.editor.items[i].key===t){this.editor.items[i].editValue();break}},openPatternFormWithData:function(e,t){this.designerDataObject&&this.designerDataObject[t.pattern.designerId]?this.openPatternFormEditor(this.designerDataObject[t.pattern.designerId],t):e&&e(t.pattern.designerId).then(function(e){if(e.data){var i=e.data;if("form"==t.pattern.designerType||"page"==t.pattern.designerType||"widget"==t.pattern.designerType)i={data:JSON.decode(MWF.decodeJsonString(e.data.data)),mobileData:e.data.mobileData?JSON.decode(MWF.decodeJsonString(e.data.mobileData)):null};if("view"==t.pattern.designerType){var r=JSON.decode(e.data.data);i.application=i.query,i.applicationName=i.queryName,i.data=r}if("statement"==t.pattern.designerType){i.application=i.query,i.applicationName=i.queryName;var n=JSON.decode(i.view);i.view=n}this.designerDataObject||(this.designerDataObject={}),this.designerDataObject[t.pattern.designerId]=i,this.openPatternFormEditor(i,t)}}.bind(this),(function(){}))},openPatternFormEditor:function(e,t){switch(t.pattern.pattern.propertyType){case"html":case"script":case"css":case"sql":case"events":this.openPatternFormEditor_script(e,t);break;case"map":this.openPatternFormEditor_map(e,t);break;case"array":this.openPatternFormEditor_array(e,t);break;case"duty":this.openPatternFormEditor_duty(e,t);break;default:this.openPatternFormEditor_default(e,t)}},getValueWithPath:function(e,t,i){for(var r=t.pattern.path,n=e,s=0,o=i?i.toInt():0;s<r.length-o;)"styles"==r[s]?n.styles=n.recoveryStyles:"inputStyles"==r[s]&&(n.inputStyles=n.recoveryInputStyles),n=n[r[s]],s++;return n},getTitleWithPath:function(e,t){var i=this.lp.elementPattern.replace("{element}","&lt;"+t.pattern.type+"&gt;"+t.pattern.name).replace("{property}",t.pattern.propertyName+"{"+t.pattern.key+"}");return"<div style='line-height: 30px'>"+("<b>"+this.lp[t.module]+":&nbsp;<span style='color: #4A90E2'>"+t.appName+"</span></b>->: <b>["+t.pattern.mode+this.lp[t.designerType]+"]</b>&nbsp;"+t.designerName+"->"+i)+"</div>"},getDefaultEditorContent:function(e,t){this.lp.elementPattern.replace("{element}","&lt;"+t.pattern.type+"&gt;"+t.pattern.name).replace("{property}",t.pattern.propertyName+"{"+t.pattern.key+"}");return"<div style='padding: 20px;'><div style='height: 40px; line-height: 40px; font-size: 18px'>"+this.lp.findInfor+"</div><div style='padding-left: 10px; padding: 30px; border: 1px solid #eeeeee; background-color: #f9f9f9; border-radius: 5px; float: left'><div style='padding-left: 20px; height: 30px; line-height: 30px'><b>"+this.lp[t.module]+":&nbsp;<span style='color: #4A90E2'>"+t.appName+"</span></b></div><div style='padding-left: 40px; height: 30px; line-height: 30px'><b>["+(t.pattern.mode||"")+this.lp[t.designerType]+"]</b>&nbsp;"+t.designerName+"</div><div style='padding-left: 60px; height: 30px; line-height: 30px'><b>"+this.lp.element+":</b>&nbsp;&lt;"+t.pattern.type+"&gt;"+t.pattern.name+"</div><div style='padding-left: 80px; height: 30px; line-height: 30px'><div style='float: left'><b>"+this.lp.property+":</b>&nbsp;"+t.pattern.propertyName+"{"+t.pattern.key+"}:&nbsp;</div><div style='margin-left: 10px; float:left; height: 30px; padding: 0px 10px; line-height: 30px; border-radius: 5px; background-color: #eeeeee;'>"+this.getPatternValueText(t,this.getFindRegExp())+"</div></div></div><div style='float:left; margin-top:20px; clear:both; height: 40px; line-height: 40px; cursor: pointer; font-size: 18px; color: #0b58a2'>"+this.lp.findInforOpen+"</div></div>"},commonEditor:new Class({Implements:[Events],initialize:function(e){this.node=$(e),this.container=new Element("div",{styles:{padding:"10px"}})},load:function(e){this.container.set("html",e).inject(this.node)},destroy:function(){this.fireEvent("destroy"),this.container.destroy(),o2.release(this)},getContent:function(){}}),openPatternFormEditor_default:function(e,t){var i=this.getDefaultEditorContent(e,t.pattern);this.editor=new this.commonEditor(this.previewContentNode),this.editor.addEvent("destroy",function(){this.previewToolbar.childrenButton[0].disable(),this.previewToolbar.childrenButton[1].disable()}.bind(this)),this.editor.pattern=t.pattern,this.editor.designerNode=t,this.editor.designerData=e,this.editor.load(i),this.editor.container.getFirst().getLast().addEvent("click",function(){this.openDesinger()}.bind(this)),this.previewToolbar.childrenButton[0].disable(),this.previewToolbar.childrenButton[1].enable()},openPatternFormEditor_duty:function(e,t){if("name"==t.pattern.pattern.valueKey)this.openPatternFormEditor_default(e,t);else{var i=this.getValueWithPath(e,t.pattern,2);if(i){var r=JSON.parse(i)[t.pattern.pattern.idx.toInt()].code;o2.require("o2.widget.JavascriptEditor",function(){this.editor=new o2.widget.JavascriptEditor(this.previewContentNode,{option:{value:r,mode:"javascript"}}),this.editor.pattern=t.pattern,this.editor.designerNode=t,this.editor.designerData=e,this.editor.load(function(){this.previewToolbar&&(this.previewToolbar.childrenButton[0].enable(),this.previewToolbar.childrenButton[1].enable()),this.editor.addEvent("change",function(){this.editor.isRefind=!0}.bind(this)),this.editor.addEvent("blur",function(){this.editor.isRefind&&this.reFindInFormDesigner()}.bind(this)),this.editor.addEvent("destroy",function(){this.previewToolbar.childrenButton[0].disable(),this.previewToolbar.childrenButton[1].disable()}.bind(this)),this.editor.addEvent("save",function(){this.saveDesigner()}.bind(this)),this.resetFormEditor(t.pattern)}.bind(this))}.bind(this))}}},openPatternFormEditor_array:function(e,t){var i=this.getValueWithPath(e,t.pattern);if(i){var r=this.getTitleWithPath(e,t.pattern);o2.require("o2.widget.Arraylist",function(){this.editor=new o2.widget.Arraylist(this.previewContentNode,{htmlTitle:r,style:"findDesigner",onChange:function(){this.reFindInFormDesigner()}.bind(this),onPostLoad:function(){this.previewToolbar&&(this.previewToolbar.childrenButton[0].enable(),this.previewToolbar.childrenButton[1].enable())}.bind(this)}),this.editor.addEvent("destroy",function(){this.previewToolbar.childrenButton[0].disable(),this.previewToolbar.childrenButton[1].disable()}.bind(this)),this.editor.pattern=t.pattern,this.editor.designerNode=t,this.editor.designerData=e,this.editor.load(i),this.resetFormEditor(t.pattern)}.bind(this))}},openPatternFormEditor_map:function(e,t){var i=this.getValueWithPath(e,t.pattern);if(i){var r=this.getTitleWithPath(e,t.pattern);o2.require("o2.widget.Maplist",function(){this.editor=new o2.widget.Maplist(this.previewContentNode,{htmlTitle:r,style:"findDesigner",onChange:function(){this.reFindInFormDesigner()}.bind(this),onPostLoad:function(){this.previewToolbar&&(this.previewToolbar.childrenButton[0].enable(),this.previewToolbar.childrenButton[1].enable())}.bind(this)}),this.editor.addEvent("destroy",function(){this.previewToolbar.childrenButton[0].disable(),this.previewToolbar.childrenButton[1].disable()}.bind(this)),this.editor.pattern=t.pattern,this.editor.designerNode=t,this.editor.designerData=e,this.editor.load(i),this.resetFormEditor(t.pattern)}.bind(this))}},openPatternFormEditor_script:function(e,t){for(var i=t.pattern.pattern.path,r=e,n=0;n<i.length;)r=r[i[n]],n++;r&&o2.require("o2.widget.JavascriptEditor",function(){this.editor=new o2.widget.JavascriptEditor(this.previewContentNode,{option:{value:r,mode:t.pattern.pattern.propertyType&&"script"!==t.pattern.pattern.propertyType&&"events"!==t.pattern.pattern.propertyType?t.pattern.pattern.propertyType:"javascript"}}),this.editor.pattern=t.pattern,this.editor.designerNode=t,this.editor.designerData=e,this.editor.load(function(){this.previewToolbar&&(this.previewToolbar.childrenButton[0].enable(),this.previewToolbar.childrenButton[1].enable()),this.editor.addEvent("change",function(){this.editor.isRefind=!0}.bind(this)),this.editor.addEvent("blur",function(){this.editor.isRefind&&this.reFindInFormDesigner()}.bind(this)),this.editor.addEvent("destroy",function(){this.previewToolbar.childrenButton[0].disable(),this.previewToolbar.childrenButton[1].disable()}.bind(this)),this.editor.addEvent("save",function(){this.saveDesigner()}.bind(this)),this.resetFormEditor(t.pattern)}.bind(this))}.bind(this))},openPatternScript:function(e){e.pattern;if(this.editor&&this.editor.pattern.designerId===e.pattern.designerId&&this.editor.pattern.module===e.pattern.module)this.reLocationEditor(e.pattern);else{var t;switch(this.editor&&("script"===this.editor.pattern.designerType?this.scriptDesignerDataObject&&this.scriptDesignerDataObject[this.editor.pattern.designerId]&&(this.scriptDesignerDataObject[this.editor.pattern.designerId].text=this.editor.getValue()):this.designerDataObject&&this.designerDataObject[this.editor.pattern.designerId]&&(this.designerDataObject[this.editor.pattern.designerId]=this.editor.designerData),this.editor.destroy()),this.editor=null,this.previewInforNode.hide().dispose(),e.pattern.module){case"processPlatform":t=o2.Actions.load("x_processplatform_assemble_designer").ScriptAction.get;break;case"cms":t=o2.Actions.load("x_cms_assemble_control").ScriptAction.get;break;case"portal":t=o2.Actions.load("x_portal_assemble_designer").ScriptAction.get;break;case"service":t="invoke"===e.pattern.appId?o2.Actions.load("x_program_center").InvokeAction.get:o2.Actions.load("x_program_center").AgentAction.get}this.openPatternScriptWithData(t,e)}},openPatternScriptWithData:function(e,t){this.scriptDesignerDataObject&&this.scriptDesignerDataObject[t.pattern.designerId]?this.openPatternScriptEditor(this.scriptDesignerDataObject[t.pattern.designerId],t):e&&e(t.pattern.designerId).then(function(e){this.scriptDesignerDataObject||(this.scriptDesignerDataObject={}),this.scriptDesignerDataObject[t.pattern.designerId]=e.data,e.data&&this.openPatternScriptEditor(e.data,t)}.bind(this),(function(){}))},openPatternScriptEditor:function(e,t){o2.require("o2.widget.JavascriptEditor",function(){this.editor=new o2.widget.JavascriptEditor(this.previewContentNode,{option:{value:e.text}}),this.editor.pattern=t.pattern,this.editor.designerNode=t.parentNode,this.editor.designerData=e,this.editor.load(function(){this.previewToolbar&&(this.previewToolbar.childrenButton[0].enable(),this.previewToolbar.childrenButton[1].enable()),this.editor.addEvent("change",function(){this.editor.isRefind=!0}.bind(this)),this.editor.addEvent("blur",function(){this.editor.isRefind&&this.reFindInDesigner()}.bind(this)),this.editor.addEvent("destroy",function(){this.previewToolbar.childrenButton[0].disable(),this.previewToolbar.childrenButton[1].disable()}.bind(this)),this.editor.addEvent("save",function(){this.saveDesigner()}.bind(this)),this.reLocationEditor(t.pattern)}.bind(this))}.bind(this))},findScriptLineValue:function(e,t,i,r,n,s){var o=/\r\n|\n|\r/g,a=t.substring(r,e.index).match(o);i+=a?a.length:0;for(var d=e[0],p=e.index-1,l=t.charAt(p);!o.test(l)&&p>=0;)d=l+d,p--,l=t.charAt(p);for(p=s.lastIndex,l=t.charAt(p);!o.test(l)&&p<n;)d+=l,p++,l=t.charAt(p);return{value:d,preLine:i,preIndex:r=s.lastIndex=p}},subResultCount:function(e){this.subResultTitle();var t=this.tree.modules?this.tree.modules[e.module]:null;t&&this.subPatternCount(t);var i=t.apps?t.apps[e.appId]:null;i&&this.subPatternCount(i);var r=i.types?i.types[e.designerType]:null;r&&this.subPatternCount(r);var n=r.designers?r.designers[e.designerId]:null;n&&this.subPatternCount(n)},reFindInFormDesigner:function(){if(this.editor&&this.editor.designerNode){var e=this.editor.pattern.pattern.path.join("."),t=this.editor.designerNode.parentNode,i=[];t.children.forEach(function(t){t.pattern.pattern.path&&t.pattern.pattern.path.join(".")===e&&i.push(t)}.bind(this));var r=this.editor.pattern;switch(r.pattern.propertyType){case"html":case"script":case"css":case"sql":case"events":if(i.length>1)for(var n=1;n<i.length;n++)i[n].destroy(),this.subResultCount(this.editor.pattern);flagNode=i[0],this.reFindInFormDesigner_script(flagNode,r);break;case"duty":if(i.length>1)for(n=1;n<i.length;n++)i[n].destroy(),this.subResultCount(this.editor.pattern);flagNode=i[0],this.reFindInFormDesigner_duty(flagNode,r);break;case"map":this.reFindInFormDesigner_map(i,r);break;case"array":this.reFindInFormDesigner_array(i,r)}this.subResultCount(this.editor.pattern)}this.editor.isRefind=!1},reFindInFormDesigner_duty:function(e,t){var i=this.editor.getValue();if(i){var r=this.getFilterOptionRegex(this.filterOption);r.lastIndex=0;for(var n,s=i.length,o=0,a=0;null!==(n=r.exec(i));){var d=this.findScriptLineValue(n,i,o,a,s,r);o=d.preLine,a=d.preIndex,this.showFindResult(this._createFindMessageReplyData(this.editor.pattern.module,this.editor.pattern,"",{type:t.pattern.type,propertyType:t.pattern.propertyType,propertyName:t.pattern.propertyName,name:t.pattern.name,id:t.pattern.id,key:t.pattern.key,evkey:t.pattern.evkey,idx:t.pattern.idx,valueKey:t.pattern.valueKey,value:d.value,line:o+1,mode:t.pattern.mode,path:t.pattern.path}),this.filterOption,flagNode)}}flagNode&&flagNode.destroy()},reFindInFormDesigner_array:function(e,t){var i=this.editor.getValue();if(i){var r=this.getFilterOptionRegex(this.filterOption);e.forEach(function(e){var t=e.pattern.pattern.line.toInt()-1,n=i[t]||"";if(e.pattern.pattern.value!=n){e.pattern.pattern.value=n;var s=this.getFormPatternNodeText(e.pattern,r),o=e.textNode.getElement("div");o&&o.set("html","<span style='color: #000000'>"+s+"</span>")}}.bind(this)),i.forEach(function(i,n){r.lastIndex=0;var s=i.toString();r.test(s)&&(e.filter((function(e){return e.pattern.pattern.line.toInt()-1==n})).length||this.showFindResult(this._createFindMessageReplyData(this.editor.pattern.module,this.editor.pattern,"",{type:t.pattern.type,propertyType:t.pattern.propertyType,propertyName:t.pattern.propertyName,name:t.pattern.name,id:t.pattern.id,line:n+1,key:t.pattern.key,value:s,mode:t.pattern.mode,path:t.pattern.path}),this.filterOption,e[e.length-1].nextSibling))}.bind(this))}},reFindInFormDesigner_map:function(e,t){var i=this.editor.getValue();if(i){var r=this.getFilterOptionRegex(this.filterOption);e.forEach(function(e){var t=e.pattern.pattern.value.split(":")[0];if(e.pattern.pattern.value!=t+": "+i[t]){e.pattern.pattern.value=t+": "+(i[t]||"");var n=this.getFormPatternNodeText(e.pattern,r),s=e.textNode.getElement("div");s&&s.set("html","<span style='color: #000000'>"+n+"</span>")}}.bind(this)),Object.keys(i).forEach(function(n){r.lastIndex=0;var s=i[n];s&&("string"==typeof s&&r.test(s)&&(e.filter((function(e){return e.pattern.pattern.value.split(":")[0]==n})).length||this.showFindResult(this._createFindMessageReplyData(this.editor.pattern.module,this.editor.pattern,"",{type:t.pattern.type,propertyType:t.pattern.propertyType,propertyName:t.pattern.propertyName,name:t.pattern.name,id:t.pattern.id,key:t.pattern.key,value:n+": "+s,mode:t.pattern.mode,path:t.pattern.path}),this.filterOption,e[e.length-1].nextSibling)))}.bind(this))}},reFindInFormDesigner_script:function(e){var t=this.editor.getValue();if(t){var i=this.getFilterOptionRegex(this.filterOption);i.lastIndex=0;for(var r,n=t.length,s=0,o=0;null!==(r=i.exec(t));){var a=this.findScriptLineValue(r,t,s,o,n,i);s=a.preLine,o=a.preIndex;var d=this.editor.pattern;this.showFindResult(this._createFindMessageReplyData(this.editor.pattern.module,this.editor.pattern,"",{type:d.pattern.type,propertyType:d.pattern.propertyType,propertyName:d.pattern.propertyName,name:d.pattern.name,id:d.pattern.id,key:d.pattern.key,evkey:d.pattern.evkey,value:a.value,line:s+1,mode:d.pattern.mode,path:d.pattern.path}),this.filterOption,e)}}e&&e.destroy()},reFindInDesigner:function(){if(this.editor&&this.editor.designerNode){for(;this.editor.designerNode.firstChild;)this.editor.designerNode.firstChild.destroy(),this.subResultCount(this.editor.pattern);var e=this.editor.getValue();if(e){var t=this.getFilterOptionRegex(this.filterOption);t.lastIndex=0;for(var i,r=e.length,n=0,s=0;null!==(i=t.exec(e));){var o=this.findScriptLineValue(i,e,n,s,r,t);n=o.preLine,s=o.preIndex,this.showFindResult(this._createFindMessageReplyData(this.editor.pattern.module,this.editor.pattern,"",{property:"text",value:o.value,line:n+1}),this.filterOption)}}}this.editor.isRefind=!1},saveDesigner:function(){if(this.editor&&this.editor.pattern){var e=this.editor.pattern,t=this.editor.designerData;switch(e.designerType){case"script":var i;switch(e.module){case"processPlatform":i=o2.Actions.load("x_processplatform_assemble_designer").ScriptAction.put;break;case"cms":i=o2.Actions.load("x_cms_assemble_control").ScriptAction.put;break;case"portal":i=o2.Actions.load("x_portal_assemble_designer").ScriptAction.edit;break;case"service":i="invoke"===e.appId?o2.Actions.load("x_program_center").InvokeAction.edit:o2.Actions.load("x_program_center").AgentAction.edit}t.text=this.editor.getValue(),i&&i(t.id,t).then(function(){this.notice(this.lp.notice.save_success,"success",this.previewContentNode,{x:"left",y:"bottom"})}.bind(this),(function(){}));break;case"form":case"page":case"widget":switch(e.module){case"processPlatform":i=(r=MWF.Actions.get("x_processplatform_assemble_designer")).saveForm.bind(r);break;case"cms":i=(r=MWF.Actions.get("x_cms_assemble_control")).saveForm.bind(r);break;case"portal":var r=MWF.Actions.get("x_portal_assemble_designer");i="page"==e.designerType?r.savePage.bind(r):r.saveWidget.bind(r)}if(this.designerDataObject&&this.designerDataObject[this.editor.pattern.designerId]){var n=this.designerDataObject[this.editor.pattern.designerId];switch(this.editor.pattern.pattern.propertyType){case"duty":if(this.editor.pattern.pattern.path){for(var s=this.editor.pattern.pattern.path,o=0;o<s.length-1;o++)s[o]==this.editor.pattern.pattern.key?(n[s[o]]=JSON.parse(n[s[o]]),n=n[s[o]]):n=n[s[o]];n[s[s.length-1]]=this.editor.getValue(),n=this.designerDataObject[this.editor.pattern.designerId];for(o=0;o<s.length-1;o++){if(s[o]==this.editor.pattern.pattern.key){n[s[o]]=JSON.stringify(n[s[o]]);break}n=n[s[o]]}}break;default:if(this.editor.getValue){if(this.editor.pattern.pattern.path)for(s=this.editor.pattern.pattern.path,o=0;o<s.length-1;o++)n=n[s[o]];"styles"==s[s.length-1]?n.recoveryStyles=this.editor.getValue():"inputStyles"==s[s.length-1]&&(n.recoveryInputStyles=this.editor.getValue()),n[s[s.length-1]]=this.editor.getValue()}}}i&&i(t.data,t.mobileData,null,function(){this.notice(this.lp.notice.save_success,"success",this.previewContentNode,{x:"left",y:"bottom"})}.bind(this),(function(){}));break;case"process":if(i=(r=MWF.Actions.get("x_processplatform_assemble_designer")).saveProcess.bind(r),this.designerDataObject&&this.designerDataObject[this.editor.pattern.designerId]){n=this.designerDataObject[this.editor.pattern.designerId];if(this.editor.getValue){if(this.editor.pattern.pattern.path)for(s=this.editor.pattern.pattern.path,o=0;o<s.length-1;o++)n=n[s[o]];n[s[s.length-1]]=this.editor.getValue()}}i&&i(t,function(){this.notice(this.lp.notice.save_success,"success",this.previewContentNode,{x:"left",y:"bottom"})}.bind(this),(function(){}));break;case"view":if(i=(r=MWF.Actions.get("x_query_assemble_designer")).saveView.bind(r),this.designerDataObject&&this.designerDataObject[this.editor.pattern.designerId]){n=this.designerDataObject[this.editor.pattern.designerId];if(this.editor.getValue){if(this.editor.pattern.pattern.path)for(s=this.editor.pattern.pattern.path,o=0;o<s.length-1;o++)n=n[s[o]];n[s[s.length-1]]=this.editor.getValue()}}i&&i(t,function(){this.notice(this.lp.notice.save_success,"success",this.previewContentNode,{x:"left",y:"bottom"})}.bind(this),(function(){}));break;case"statement":if(i=(r=MWF.Actions.get("x_query_assemble_designer")).saveStatement.bind(r),this.designerDataObject&&this.designerDataObject[this.editor.pattern.designerId]){n=this.designerDataObject[this.editor.pattern.designerId];if(this.editor.getValue){if(this.editor.pattern.pattern.path)for(s=this.editor.pattern.pattern.path,o=0;o<s.length-1;o++)n=n[s[o]];n[s[s.length-1]]=this.editor.getValue()}}var a=JSON.stringify(t.view);t.view=a,i&&i(t,function(){this.notice(this.lp.notice.save_success,"success",this.previewContentNode,{x:"left",y:"bottom"})}.bind(this),(function(){}))}}},openDesinger:function(){if(this.editor&&this.editor.pattern){var e=this.editor.pattern;switch(e.designerType){case"script":switch(e.module){case"processPlatform":var t={appId:"process.ScriptDesigner"+e.designerId,id:e.designerId,application:e.appId};layout.openApplication(null,"process.ScriptDesigner",t);break;case"cms":t={appId:"cms.ScriptDesigner"+e.designerId,id:e.designerId,application:e.appId};layout.openApplication(null,"cms.ScriptDesigner",t);break;case"portal":t={appId:"portal.ScriptDesigner"+e.designerId,id:e.designerId,application:e.appId};layout.openApplication(null,"portal.ScriptDesigner",t);break;case"service":if("invoke"===e.appId){t={appId:"service.InvokeDesigner"+e.designerId,id:e.designerId};layout.openApplication(null,"service.InvokeDesigner",t)}else{t={appId:"service.AgentDesigner"+e.designerId,id:e.designerId};layout.openApplication(null,"service.AgentDesigner",t)}}break;case"form":switch(e.module){case"processPlatform":var i=this;t={style:layout.desktop.formDesignerStyle||"default",appId:"process.FormDesigner"+e.designerId,id:e.designerId,onPostFormLoad:function(){i.checkSelectDesignerElement_form(this,e,0)}};layout.openApplication(null,"process.FormDesigner",t);break;case"cms":i=this,t={style:layout.desktop.formDesignerStyle||"default",appId:"cms.FormDesigner"+e.designerId,id:e.designerId,onPostFormLoad:function(){i.checkSelectDesignerElement_form(this,e,0)}};layout.openApplication(null,"cms.FormDesigner",t)}break;case"process":i=this,t={appId:"process.ProcessDesigner"+e.designerId,id:e.designerId,onPostProcessLoad:function(){i.checkSelectDesignerElement_process(this,e,0)}};layout.openApplication(null,"process.ProcessDesigner",t);break;case"page":i=this,t={appId:"portal.PageDesigner"+e.designerId,id:e.designerId,onPostPageLoad:function(){i.checkSelectDesignerElement_form(this,e,0)}};layout.openApplication(null,"portal.PageDesigner",t);break;case"widget":i=this,t={appId:"portal.WidgetDesigner"+e.designerId,id:e.designerId,onPostWidgetLoad:function(){i.checkSelectDesignerElement_form(this,e,0)}};layout.openApplication(null,"portal.WidgetDesigner",t);break;case"view":i=this,t={appId:"query.ViewDesigner"+e.designerId,id:e.designerId,application:e.appId,onPostViewLoad:function(){i.checkSelectDesignerElement_view(this,e,0)}};layout.openApplication(null,"query.ViewDesigner",t);break;case"statement":i=this,t={appId:"query.StatementDesigner"+e.designerId,id:e.designerId,application:e.appId};layout.openApplication(null,"query.StatementDesigner",t)}this.editor.getValue&&window.setTimeout(function(){this.scriptDesignerDataObject&&this.scriptDesignerDataObject[this.editor.pattern.designerId]&&(this.scriptDesignerDataObject[this.editor.pattern.designerId]=null,delete this.scriptDesignerDataObject[this.editor.pattern.designerId]),this.editor&&this.editor.destroy(),this.editor=null,this.previewInforNode.show().inject(this.previewContentNode)}.bind(this),100)}},checkSelectDesignerElement_view:function(e,t,i){var r=!1,n=e.view;if(n)switch(t.pattern.type.toLowerCase()){case"view":r=!0;break;case"column":for(var s=0;s<n.items.length;s++){if((o=n.items[s]).json.id==t.pattern.id||o.json.name==t.pattern.id){window.setTimeout((function(){o.view&&o.view.unSelected(),o.selected()}),500),r=!0;break}}break;case"actionbar":for(s=0;s<n.actionbarList.length;s++){if((o=n.actionbarList[s]).json.id==t.pattern.id||o.json.name==t.pattern.id){window.setTimeout((function(){o.view&&o.view.unSelected(),o.selected()}),500),r=!0;break}}break;case"paging":for(s=0;s<n.pagingList.length;s++){var o;if((o=n.pagingList[s]).json.id==t.pattern.id||o.json.name==t.pattern.id){window.setTimeout((function(){o.view&&o.view.unSelected(),o.selected()}),500),r=!0;break}}}r||++i<10&&window.setTimeout(function(){this.checkSelectDesignerElement_view(e,t,i)}.bind(this),300)},checkSelectDesignerElement_process:function(e,t,i){var r=!1,n=e.process;if(n){var s=t.pattern.type.toLowerCase();switch(s){case"process":r=!0;break;case"route":n.routes&&n.routes[t.pattern.id]&&(n.routes[t.pattern.id].selected(),r=!0);break;case"begin":n.begin&&(n.begin.selected(),r=!0);break;default:n[s+"s"]&&n[s+"s"][t.pattern.id]&&(n[s+"s"][t.pattern.id].selected(),r=!0)}}r||++i<10&&window.setTimeout(function(){this.checkSelectDesignerElement_process(e,t,i)}.bind(this),300)},checkSelectDesignerElement_form:function(e,t,i){var r,n=!1;try{"PC"==t.pattern.mode?(e.changeDesignerModeToPC(),r=e.pcForm||e.pcPage):(e.changeDesignerModeToMobile(),r=e.mobileForm||e.mobilePage)}catch(e){}if(r&&"PC"==t.pattern.mode)if("form"!=t.pattern.type.toLowerCase())for(var s=0;s<r.moduleList.length;s++){var o=r.moduleList[s];if(o.json.id==t.pattern.name||o.json.name==t.pattern.name){window.setTimeout((function(){o.form&&o.form.unSelected(),o.selected()}),500),n=!0;break}}else n=!0;n||++i<10&&window.setTimeout(function(){this.checkSelectDesignerElement_form(e,t,i)}.bind(this),300)},_createFindMessageReplyData:function(e,t,i,r){return{module:e,appId:t.appId,appName:t.appName,designerId:t.designerId,designerName:t.designerName,designerType:t.designerType,designerAliase:i,pattern:r}},reLocationEditor:function(e){if(this.editor.pattern=e,this.editor.gotoLine(e.pattern.line,1),e.pattern.cols&&e.pattern.cols.length){var t=[];e.pattern.cols.forEach(function(i){t.push(this.editor.getRange(e.pattern.line,i.start,e.pattern.line,i.end))}.bind(this)),this.editor.selectRange(t)}else this.editor.selectRange(this.editor.getRange(e.pattern.line,0))},getFilterOptionRegex:function(e){var t=e.keyword;if(e.matchRegExp){var i=e.caseSensitive?"gm":"gmi";return new RegExp(t,i)}t=t.replace("[","\\[").replace("]","\\]").replace("(","\\(").replace(")","\\)").replace("{","\\{").replace("}","\\}").replace("^","\\^").replace("$","\\$").replace(".","\\.").replace("?","\\?").replace("+","\\+").replace("*","\\*").replace("|","\\|");i=e.caseSensitive?"gm":"gmi";return t=e.matchWholeWord?"\\b"+t+"\\b":t,new RegExp(t,i)},setReceiveMessage:function(){this.listTitleInfoNode.set("text",this.lp.receiveToFind)},setReadyMessage:function(e){this.findOptionModuleCount=e.count,this.findOptionModuleProcessed=0,this.updateFindProgress(),this.listTitleInfoNode.set("text",this.lp.readyToFind.replace("{n}",e.count))},updateFindProgress:function(){var e=this.findOptionModuleProcessed/this.findOptionModuleCount*100;this.listTitleProgressNode.setStyle("width",e+"%")},getActionsUrl:function(){var e=o2.Actions.getHost("x_processplatform_assemble_designer"),t=o2.Actions.getHost("x_cms_assemble_control"),i=o2.Actions.getHost("x_portal_assemble_designer"),r=o2.Actions.getHost("x_query_assemble_designer"),n=o2.Actions.getHost("x_program_center"),s=o2.Actions.getHost("x_query_service_processing");return{listProcess:o2.filterUrl(e+"/x_processplatform_assemble_designer/jaxrs/application/list"),listProcessProcess:o2.filterUrl(e+"/x_processplatform_assemble_designer/jaxrs/process/application/{applicationId}"),listProcessForm:o2.filterUrl(e+"/x_processplatform_assemble_designer/jaxrs/form/list/application/{applicationId}"),listProcessScript:o2.filterUrl(e+"/x_processplatform_assemble_designer/jaxrs/script/application/{applicationId}"),getProcessProcess:o2.filterUrl(e+"/x_processplatform_assemble_designer/jaxrs/process/{id}"),getProcessForm:o2.filterUrl(e+"/x_processplatform_assemble_designer/jaxrs/form/{id}"),getProcessScript:o2.filterUrl(e+"/x_processplatform_assemble_designer/jaxrs/script/{id}"),listCms:o2.filterUrl(t+"/x_cms_assemble_control/jaxrs/appinfo/list/manage"),listCmsForm:o2.filterUrl(t+"/x_cms_assemble_control/jaxrs/form/list/app/{appId}"),listCmsScript:o2.filterUrl(t+"/x_cms_assemble_control/jaxrs/script/list/app/{flag}"),getCmsForm:o2.filterUrl(t+"/x_cms_assemble_control/jaxrs/form/{id}"),getCmsScript:o2.filterUrl(t+"/x_cms_assemble_control/jaxrs/script/{id}"),listPortal:o2.filterUrl(i+"/x_portal_assemble_designer/jaxrs/portal/list"),listPortalPage:o2.filterUrl(i+"/x_portal_assemble_designer/jaxrs/page/list/portal/{portalId}"),listPortalScript:o2.filterUrl(i+"/x_portal_assemble_designer/jaxrs/script/list/portal/{portalId}"),listPortalWidget:o2.filterUrl(i+"/x_portal_assemble_designer/jaxrs/widget/list/portal/{portalId}"),getPortalPage:o2.filterUrl(i+"/x_portal_assemble_designer/jaxrs/page/{id}"),getPortalScript:o2.filterUrl(i+"/x_portal_assemble_designer/jaxrs/script/{id}"),getPortalWidget:o2.filterUrl(i+"/x_portal_assemble_designer/jaxrs/widget/{id}"),listQuery:o2.filterUrl(r+"/x_query_assemble_designer/jaxrs/query/list/summary"),listQueryView:o2.filterUrl(i+"/x_query_assemble_designer/jaxrs/view/list/query/{flag}"),listQueryStat:o2.filterUrl(i+"/x_query_assemble_designer/jaxrs/stat/list/query/{flag}"),listQueryStatement:o2.filterUrl(i+"/x_query_assemble_designer/jaxrs/statement/list/query/{flag}"),getQueryView:o2.filterUrl(i+"/x_query_assemble_designer/jaxrs/view/{id}"),getQueryStat:o2.filterUrl(i+"/x_query_assemble_designer/jaxrs/stat/{id}"),getQueryStatement:o2.filterUrl(i+"/x_query_assemble_designer/jaxrs/statement/{id}"),listInvoke:o2.filterUrl(n+"/x_program_center/jaxrs/invoke"),listAgent:o2.filterUrl(n+"/x_program_center/jaxrs/agent"),getInvoke:o2.filterUrl(n+"/x_program_center/jaxrs/invoke/{flag}"),getAgent:o2.filterUrl(n+"/x_program_center/jaxrs/agent/{flag}"),findAction:o2.filterUrl(s+"/x_query_service_processing/jaxrs/design/search")}},findDesigner:function(){if(this.getFindOption(),!this.filterOption.keyword)return this.listInfoNode.show().removeClass("loadding").getFirst().set("text",this.lp.nothingFind_keyword),!1;if(!this.filterOption.designerTypes.length)return this.listInfoNode.show().removeClass("loadding").getFirst().set("text",this.lp.nothingFind_noFilter),!1;if(!this.filterOption.moduleList.length)return this.listInfoNode.show().removeClass("loadding").getFirst().set("text",this.lp.nothingFind_noRange),!1;this.listContentNode.hide(),this.listContentNode.empty(),this.listInfoNode.show().getFirst().set("text",""),this.listInfoNode.addClass("loadding"),this.patternCount=0,this.editor&&this.editor.destroy(),this.editor=null,this.previewInforNode.show().inject(this.previewContentNode),this.scriptDesignerDataObject=null,this.designerDataObject=null,this.getFindWorker();var e=this.getActionsUrl();this.tree=null,this.getResultTree(function(){var t={actions:e,filterOption:this.filterOption,debug:window.layout&&layout.debugger,token:window.layout&&layout.session&&layout.session.user?layout.session.user.token:"",tokenName:o2.tokenName};this.findWorker.postMessage(t)}.bind(this))},getFindRegExp:function(){var e="gm",t=this.filterOption.keyword;return this.filterOption.caseSensitive||(e+="i"),this.filterOption.matchRegExp||(t=t.replace("[","\\[").replace("]","\\]").replace("(","\\(").replace(")","\\)").replace("{","\\{").replace("}","\\}").replace("^","\\^").replace("$","\\$").replace(".","\\.").replace("?","\\?").replace("+","\\+").replace("*","\\*").replace("|","\\|"),this.filterOption.matchWholeWord&&(t="\\b"+t+"\\b")),new RegExp(t,e)}});