MWF.xApplication.BAM.monthly=MWF.xApplication.BAM.monthly||{},MWF.xApplication.BAM.monthly.MonthlyContent=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(t,e,s){this.setOptions(s),this.path="../x_component_BAM/monthly/$MonthlyContent/",this.cssPath="../x_component_BAM/monthly/$MonthlyContent/"+this.options.style+"/css.wcss",this._loadCss(),this.monthly=t,this.app=this.monthly.app,this.actions=this.app.actions,this.container=$(e),this.initData(),this.load()},initData:function(){this.sort={type:"application",range:{}},this.filter={company:"",department:"",person:"",application:"",applicationName:"",process:"",processName:"",activity:"",activityName:""}},clearFilter:function(){this.filter={unit:"",topUnit:"",person:"",application:"",applicationName:"",process:"",processName:"",activity:"",activityName:""}},reload:function(){this.sortActionTextNode.set("html",this.getSortHtml()),this.filterActionTextNode.set("html",this.getFilterHtml()),this.table.destroy(),this.chart.destroy(),this.app.mask(),this.loadData(function(){this.loadTable(),this.loadChart(),this.fireEvent("loaded")}.bind(this))},load:function(){this.node=new Element("div",{styles:this.css.monthNode}).inject(this.container),this.titleAreaNode=new Element("div",{styles:this.css.monthTitleAreaNode}).inject(this.node),this.sortByAreaNode=new Element("div",{styles:this.css.monthSortByAreaNode}).inject(this.titleAreaNode),this.filterAreaNode=new Element("div",{styles:this.css.monthFilterAreaNode}).inject(this.titleAreaNode),this.chartAreaNode=new Element("div",{styles:this.css.monthChartAreaNode}).inject(this.node),this.tableAreaNode=new Element("div",{styles:this.css.monthTableAreaNode}).inject(this.node),this.createSortNode(),this.createFilterNode(),this.app.mask(),this.loadData(function(){this.loadTable(),this.loadChart(),this.fireEvent("loaded")}.bind(this))},createSortNode:function(){this.sortActionNode=new Element("div",{styles:this.css.sortActionNode}).inject(this.sortByAreaNode),this.sortActionTitleNode=new Element("div",{styles:this.css.sortActionTitleNode}).inject(this.sortActionNode),this.sortActionTextNode=new Element("div",{styles:this.css.sortActionTextNode}).inject(this.sortActionNode),this.sortActionTitleNode.set("text",this.app.lp.monthly.sort),this.sortActionTextNode.set("html",this.getSortHtml()),this.selectSort()},selectSort:function(){this.sortSelectMenu||(this.sortSelectMenu=new MWF.xDesktop.Menu(this.sortActionTitleNode,{event:"click",style:"BAMStyle",offsetX:-1,offsetY:-1,container:this.app.content,onQueryShow:function(){for(var t=0;t<5;t++)this.sortSelectMenu.items[t].item.getFirst().empty();var e=["company","department","application","process","activity"].indexOf(this.sort.type);if(-1!=e){src="../x_component_BAM/monthly/$MonthlyContent/"+this.options.style+"/icon/selected.png";new Element("img",{styles:this.sortSelectMenu.css.menuItemImg,src:src}).inject(this.sortSelectMenu.items[e].item.getFirst())}}.bind(this),onPostShow:function(){var t=this.sortActionNode.getSize(),e=this.sortSelectMenu.borderNode.getSize();t.x>e.x&&this.sortSelectMenu.node.setStyle("width",t.x+"px")}.bind(this),onPostHide:function(){this.sortSelectMenu.node.setStyle("width","auto"),this.sortActionNode.setStyles(this.css.sortActionNode),this.sortMenu=!1,this.sortActionTitleNode.setStyles(this.css.sortActionTitleNode)}.bind(this)}),this.sortSelectMenu.load(),this.sortSelectMenu.addMenuItem(this.app.lp.monthly.sortItems.topUnit,"click",function(){this.sortSelected("topUnit")}.bind(this)),this.sortSelectMenu.addMenuItem(this.app.lp.monthly.sortItems.unit,"click",function(){this.sortSelected("unit")}.bind(this)),this.sortSelectMenu.addMenuItem(this.app.lp.monthly.sortItems.application,"click",function(){this.sortSelected("application")}.bind(this)),this.sortSelectMenu.addMenuItem(this.app.lp.monthly.sortItems.process,"click",function(){this.sortSelected("process")}.bind(this)),this.sortSelectMenu.addMenuItem(this.app.lp.monthly.sortItems.activity,"click",function(){this.sortSelected("activity")}.bind(this))),this.sortActionTitleNode.addEvents({click:function(){var t=this.sortByAreaNode.getPosition(this.sortByAreaNode.getOffsetParent());this.sortActionNode.setStyles(this.css.sortActionNode_menu);var e=MWF.xDesktop.zIndexPool.zIndex+1;this.sortActionNode.setStyle("border-bottom","0px solid #999"),this.sortActionNode.setStyles({left:t.x+"px","z-index":e,top:t.y+"px"}),this.sortActionTitleNode.setStyles(this.css.sortActionTitleNode_menu),this.sortMenu=!0}.bind(this),mouseover:function(){this.sortMenu||this.sortActionTitleNode.setStyles(this.css.sortActionTitleNode_over)}.bind(this),mouseout:function(){this.sortMenu||this.sortActionTitleNode.setStyles(this.css.sortActionTitleNode)}.bind(this)})},sortSelected:function(t){switch(t){case"topUnit":this.sort={type:"topUnit",range:{}},this.filter.company="",this.filter.department="",this.filter.person="",this.reload();break;case"unit":this.selectedSortUnit(t);break;case"application":this.sort={type:"application",range:{}},this.filter.application="",this.filter.process="",this.filter.activity="",this.reload();break;case"process":this.selectedSortApplication(t);break;case"activity":this.selectedSortProcess(t)}},selectedSortUnit:function(t){MWF.xDesktop.requireApp("Selector","package",function(){var e={type:"unit",count:1,title:this.app.lp.monthly.selectSortCompany,onComplete:function(e){this.sort={type:t,range:{unitName:e[0].data.id,company:e[0].data.id}},this.filter.unit="",this.filter.person="",this.reload()}.bind(this)};new MWF.O2Selector(this.app.content,e)}.bind(this))},selectedSortApplication:function(t){MWF.xDesktop.requireApp("Selector","package",function(){var e={type:"application",count:1,title:this.app.lp.monthly.selectSortApplication,onComplete:function(e){this.sort={type:t,range:{applicationName:e[0].data.name,application:e[0].data.id}},this.filter.application="",this.filter.process="",this.filter.activity="",this.reload()}.bind(this)};new MWF.O2Selector(this.app.content,e)}.bind(this))},selectedSortProcess:function(t){MWF.xDesktop.requireApp("Selector","package",function(){var e={type:"process",count:1,title:this.app.lp.monthly.selectSortProcess,onComplete:function(e){this.sort={type:t,range:{applicationName:e[0].data.applicationName,application:e[0].data.application,processName:e[0].data.name,process:e[0].data.id}},this.filter.application="",this.filter.process="",this.filter.activity="",this.reload()}.bind(this)};new MWF.O2Selector(this.app.content,e)}.bind(this))},getSortHtml:function(){var t=this.app.lp.monthly.sortInfor[this.sort.type];return"process"===this.sort.type&&(t=t.replace(/{app}/g,"<span style='color: #ff0000'>"+this.sort.range.applicationName+"</span>")),"activity"===this.sort.type&&(t=(t=t.replace(/{app}/g,"<span style='color: #ff0000'>"+this.sort.range.applicationName+"</span>")).replace(/{pro}/g,"<span style='color: #ff0000'>"+this.sort.range.processName+"</span>")),"unit"===this.sort.type&&(t=t.replace(/{unit}/g,"<span style='color: #ff0000'>"+this.sort.range.unitName+"</span>")),t},selectFilter:function(){this.filterSelectMenu||(this.filterSelectMenu=new MWF.xDesktop.Menu(this.filterActionTitleNode,{event:"click",style:"BAMStyle",offsetX:-1,offsetY:-1,container:this.app.content,onQueryShow:function(){this.filterSelectMenu.clearItems(),"activity"==this.sort.type||"application"==this.sort.type||"process"==this.sort.type?this.filterSelectMenu.addMenuItem(this.app.lp.monthly.filterItems.unit,"click",function(){this.filterSelected("unit")}.bind(this)):(this.filterSelectMenu.addMenuItem(this.app.lp.monthly.filterItems.application,"click",function(){this.filterSelected("application")}.bind(this)),this.filterSelectMenu.addMenuItem(this.app.lp.monthly.filterItems.process,"click",function(){this.filterSelected("process")}.bind(this)))}.bind(this),onPostShow:function(){var t=this.filterActionNode.getSize(),e=this.filterActionTitleNode.getSize(),s=this.filterSelectMenu.borderNode.getSize();t.x>s.x&&this.filterSelectMenu.node.setStyle("width",t.x+"px");var i=0-((s=this.filterSelectMenu.borderNode.getSize()).x-e.x);this.filterSelectMenu.setOptions({offsetX:i}),this.filterSelectMenu.setPosition()}.bind(this),onPostHide:function(){this.filterSelectMenu.node.setStyle("width","auto"),this.filterActionNode.setStyles(this.css.filterActionNode),this.filterMenu=!1,this.filterActionTitleNode.setStyles(this.css.filterActionTitleNode)}.bind(this)}),this.filterSelectMenu.load()),this.filterActionTitleNode.addEvents({click:function(){var t=this.filterActionNode.getPosition(this.filterActionNode.getOffsetParent());this.filterActionNode.setStyles(this.css.filterActionNode_menu);var e=MWF.xDesktop.zIndexPool.zIndex+1;this.filterActionNode.setStyle("border-bottom","0px solid #999"),this.filterActionNode.setStyles({left:t.x+"px","z-index":e,top:t.y+"px"}),this.filterActionTitleNode.setStyles(this.css.filterActionTitleNode_menu),this.filterMenu=!0}.bind(this),mouseover:function(){this.filterMenu||this.filterActionTitleNode.setStyles(this.css.filterActionTitleNode_over)}.bind(this),mouseout:function(){this.filterMenu||this.filterActionTitleNode.setStyles(this.css.filterActionTitleNode)}.bind(this)})},filterSelected:function(t){switch(t){case"unit":this.selectedFilterUnit(t);break;case"application":this.selectedFilterApplication(t);break;case"process":this.selectedFilterProcess(t)}},selectedFilterUnit:function(){MWF.xDesktop.requireApp("Selector","package",function(){var t={type:"unit",count:1,title:this.app.lp.monthly.selectSortUnit,onComplete:function(t){this.clearFilter(),this.filter.unit=t[0].data.distinguishedName,this.reload()}.bind(this)};new MWF.O2Selector(this.app.content,t)}.bind(this))},selectedFilterApplication:function(t){MWF.xDesktop.requireApp("Selector","package",function(){var t={type:"application",count:1,title:this.app.lp.monthly.selectSortApplication,onComplete:function(t){this.clearFilter(),this.filter.application=t[0].data.id,this.filter.applicationName=t[0].data.name,this.reload()}.bind(this)};new MWF.O2Selector(this.app.content,t)}.bind(this))},selectedFilterProcess:function(t){MWF.xDesktop.requireApp("Selector","package",function(){var t={type:"process",count:1,title:this.app.lp.monthly.selectSortProcess,onComplete:function(t){this.clearFilter(),this.filter.process=t[0].data.id,this.filter.processName=t[0].data.name,this.reload()}.bind(this)};new MWF.O2Selector(this.app.content,t)}.bind(this))},createFilterNode:function(){this.filterActionNode=new Element("div",{styles:this.css.filterActionNode}).inject(this.filterAreaNode),this.filterActionTitleNode=new Element("div",{styles:this.css.filterActionTitleNode}).inject(this.filterActionNode),this.filterActionTextNode=new Element("div",{styles:this.css.filterActionTextNode}).inject(this.filterActionNode),this.filterActionTitleNode.set("text",this.app.lp.monthly.filter),this.filterActionTextNode.set("html",this.getFilterHtml()),this.selectFilter()},getFilterHtml:function(){var t=[];return this.filter.unit&&t.push(this.app.lp.monthly.filterInfor.unit.replace(/{name}/g,"<span style='color: #ff0000'>"+MWF.name.cn(this.filter.unit)+"</span>")),this.filter.personName&&t.push(this.app.lp.monthly.filterInfor.person.replace(/{name}/g,"<span style='color: #ff0000'>"+this.filter.person+"</span>")),this.filter.applicationName&&t.push(this.app.lp.monthly.filterInfor.application.replace(/{name}/g,"<span style='color: #ff0000'>"+this.filter.applicationName+"</span>")),this.filter.processName&&t.push(this.app.lp.monthly.filterInfor.process.replace(/{name}/g,"<span style='color: #ff0000'>"+this.filter.processName+"</span>")),this.filter.activityName&&t.push(this.app.lp.monthly.filterInfor.activity.replace(/{name}/g,"<span style='color: #ff0000'>"+this.filter.activityName+"</span>")),t.length?t.join(", "):this.app.lp.monthly.filterInfor.all},loadData:function(t){this.actions.loadMonthly("task",this.sort,this.filter,function(e){this.data=e.data,t&&t()}.bind(this))},loadTable:function(){this.createTable()},createTable:function(){this.table=new MWF.xApplication.BAM.monthly.MonthlyContent.Table(this,this.tableAreaNode,this.data)},getSelectedData:function(){if(this.table.selectedData.length)return this.table.selectedData;var t=[];return Object.each(this.data,function(e,s){var i=0;e.each(function(t){i+=t.count}.bind(this));var l={column:s,data:[{name:"all",count:i}]};t.push(l)}.bind(this)),t},loadChart:function(){this.chart=new MWF.xApplication.BAM.monthly.MonthlyContent.Chart(this,this.chartAreaNode,this.getSelectedData())},reloadChart:function(){this.chart&&this.chart.destroy(),this.chartAreaNode.empty(),this.chart=new MWF.xApplication.BAM.monthly.MonthlyContent.Chart(this,this.chartAreaNode,this.getSelectedData())},show:function(){this.node.setStyle("display","block")},hide:function(){this.node.setStyle("display","none")},destroy:function(){this.node.destroy(),MWF.release(this)}}),MWF.xApplication.BAM.monthly.MonthlyContent.Table=new Class({initialize:function(t,e,s){this.content=t,this.monthly=this.content.monthly,this.app=this.monthly.app,this.actions=this.app.actions,this.css=this.content.css,this.container=$(e),this.data=s,this.rowSelectors=[],this.colSelectors=[],this.tableData={cols:[],rows:[],data:[],cells:[]},this.selectedRows=[],this.selectedCols=[],this.selectedData=[],this.load()},load:function(){this.table=new Element("table",{styles:this.css.monthlyTable,cellPadding:"0",cellSpacing:"0",border:"0"}),this.getTableData(),this.createColSelectRow(),this.createTitleRow(),this.createDataRow(),this.table.inject(this.container)},getTableData:function(){var t=[],e=[],s=[],i=[],l=0;Object.each(this.data,function(n,o){t.push(o),s.push([]),i.push([]),n.each(function(t){e.filter((function(e){return e.value==t.value})).length||e.push(t),s[l].push(t.count),i[l].push(null)}.bind(this)),l++}.bind(this)),this.tableData={cols:t,rows:e,data:s,cells:i}},createColSelectRow:function(){this.selectColTr=this.table.insertRow();var t=this.selectColTr.insertCell().setStyles(this.css.monthlyTableAllSelectTd).set("title",this.app.lp.monthly.selecteAll);new MWF.xApplication.BAM.monthly.MonthlyContent.Table.AllSelector(this,t),t=this.selectColTr.insertCell().setStyles(this.css.monthlyTableAllColSelectTd).set("title",this.app.lp.monthly.selecteAllCol),new MWF.xApplication.BAM.monthly.MonthlyContent.Table.AllColSelector(this,t),this.tableData.cols.each(function(e,s){t=this.selectColTr.insertCell().setStyles(this.css.monthlyTableColSelectTd),this.setColSelectTdEvent(t,s)}.bind(this))},createTitleRow:function(){var t=this.app.lp.monthly.columnTitle[this.content.sort.type];this.titleTr=this.table.insertRow(),td=this.titleTr.insertCell().setStyles(this.css.monthlyTableAllRowSelectTd).set("title",this.app.lp.monthly.selecteAllRow),new MWF.xApplication.BAM.monthly.MonthlyContent.Table.AllRowSelector(this,td),td=this.titleTr.insertCell().setStyles(this.css.monthlyTableTitleTd),td.set("text",t),_self=this,this.tableData.cols.each(function(t,e){td=this.titleTr.insertCell().setStyles(this.css.monthlyTableTitleTd),td.set("text",t),td.store("idx",e),td.addEvent("click",(function(){var t=this.retrieve("idx");_self.colSelectors[t].td.click()}))}.bind(this))},createDataRow:function(){_self=this,this.tableData.rows.each(function(t,e){var s=this.table.insertRow(),i=s.insertCell().setStyles(this.css.monthlyTableRowSelectTd);this.setRowSelectTdEvent(i,e),(i=s.insertCell().setStyles(this.css.monthlyTableTitleTd).set("text",t.name)).store("idx",e),i.addEvent("click",(function(){var t=this.retrieve("idx");_self.rowSelectors[t].td.click()})),this.tableData.cols.each(function(t,l){(i=s.insertCell().setStyles(this.css.monthlyTableTd)).set("text",this.tableData.data[l][e]),this.tableData.cells[l][e]=i,new MWF.xApplication.BAM.monthly.MonthlyContent.Table.CellSelector(this,i)}.bind(this))}.bind(this))},setColSelectTdEvent:function(t,e){this.colSelectors.push(new MWF.xApplication.BAM.monthly.MonthlyContent.Table.ColSelector(this,t,e))},setRowSelectTdEvent:function(t,e){this.rowSelectors.push(new MWF.xApplication.BAM.monthly.MonthlyContent.Table.RowSelector(this,t,e))},destroy:function(){this.container.empty(),MWF.release(this)}}),MWF.xApplication.BAM.monthly.MonthlyContent.Table.ColSelector=new Class({initialize:function(t,e,s){this.table=t,this.td=e,this.idx=s,this.load()},load:function(){this.td.addEvents({click:function(){-1!=this.table.selectedCols.indexOf(this.idx)?this.unselectedCol():this.selectedCol()}.bind(this)})},unselectedCol:function(){this.td.setStyles(this.table.css.monthlyTableSelectTd),this.table.selectedCols.erase(this.idx),this.checkSelectedCells()},selectedCol:function(){this.td.setStyles(this.table.css.monthlyTableSelectedTd),this.table.selectedCols.push(this.idx),this.checkSelectedCells()},checkIsSelected:function(t,e){if(!this.table.selectedCols.length&&!this.table.selectedRows.length)return!1;var s=!this.table.selectedCols.length||-1!=this.table.selectedCols.indexOf(t),i=!this.table.selectedRows.length||-1!=this.table.selectedRows.indexOf(e);return s&&i},checkSelectedCells:function(){this.table.selectedData=[],this.table.tableData.cells.each(function(t,e){var s={column:this.table.tableData.cols[e],data:[]};t.each(function(t,i){this.checkIsSelected(e,i)?(t.setStyles(this.table.css.monthlyTableTd_selected),s.data.push({name:this.table.tableData.rows[i].name,value:this.table.tableData.rows[i].value,count:this.table.tableData.data[e][i]})):t.setStyles(this.table.css.monthlyTableTd)}.bind(this)),s.data.length&&this.table.selectedData.push(s)}.bind(this)),this.table.content.reloadChart()}}),MWF.xApplication.BAM.monthly.MonthlyContent.Table.RowSelector=new Class({Extends:MWF.xApplication.BAM.monthly.MonthlyContent.Table.ColSelector,load:function(){this.td.addEvents({click:function(){-1!=this.table.selectedRows.indexOf(this.idx)?this.unselectedCol():this.selectedCol()}.bind(this)})},unselectedCol:function(){this.td.setStyles(this.table.css.monthlyTableSelectTd),this.table.selectedRows.erase(this.idx),this.checkSelectedCells()},selectedCol:function(){this.td.setStyles(this.table.css.monthlyTableSelectedTd),this.table.selectedRows.push(this.idx),this.checkSelectedCells()}}),MWF.xApplication.BAM.monthly.MonthlyContent.Table.AllSelector=new Class({Extends:MWF.xApplication.BAM.monthly.MonthlyContent.Table.ColSelector,load:function(){this.td.addEvents({click:function(){this.selectedAll()}.bind(this)})},selectedAll:function(){this.table.selectedRows.length||this.table.selectedCols.length?(this.table.selectedRows=[],this.table.selectedCols=[],this.table.rowSelectors.each((function(t){t.td.setStyles(t.table.css.monthlyTableSelectTd)})),this.table.colSelectors.each((function(t){t.td.setStyles(t.table.css.monthlyTableSelectTd)}))):(this.table.tableData.rows.each(function(t,e){e<20&&this.table.selectedRows.push(e)}.bind(this)),this.table.tableData.cols.each(function(t,e){e<20&&this.table.selectedCols.push(e)}.bind(this)),this.table.rowSelectors.each((function(t){t.td.setStyles(t.table.css.monthlyTableSelectedTd)})),this.table.colSelectors.each((function(t){t.td.setStyles(t.table.css.monthlyTableSelectedTd)}))),this.checkSelectedCells()}}),MWF.xApplication.BAM.monthly.MonthlyContent.Table.AllColSelector=new Class({Extends:MWF.xApplication.BAM.monthly.MonthlyContent.Table.AllSelector,selectedAll:function(){this.table.selectedCols.length?(this.table.selectedCols=[],this.table.colSelectors.each((function(t){t.td.setStyles(t.table.css.monthlyTableSelectTd)}))):(this.table.tableData.cols.each(function(t,e){e<20&&this.table.selectedCols.push(e)}.bind(this)),this.table.colSelectors.each((function(t){t.td.setStyles(t.table.css.monthlyTableSelectedTd)}))),this.checkSelectedCells()}}),MWF.xApplication.BAM.monthly.MonthlyContent.Table.AllRowSelector=new Class({Extends:MWF.xApplication.BAM.monthly.MonthlyContent.Table.AllSelector,selectedAll:function(){this.table.selectedRows.length?(this.table.selectedRows=[],this.table.rowSelectors.each((function(t){t.td.setStyles(t.table.css.monthlyTableSelectTd)}))):(this.table.tableData.rows.each(function(t,e){e<20&&this.table.selectedRows.push(e)}.bind(this)),this.table.rowSelectors.each((function(t){t.td.setStyles(t.table.css.monthlyTableSelectedTd)}))),this.checkSelectedCells()}}),MWF.xApplication.BAM.monthly.MonthlyContent.Table.CellSelector=new Class({Extends:MWF.xApplication.BAM.monthly.MonthlyContent.Table.ColSelector,load:function(){new Drag(this.td,{onStart:function(t,e){this.cellDragStart(t,e)}.bind(this),onDrag:function(t,e){this.cellDrag(t,e)}.bind(this),onComplete:function(t,e){this.completeDrag(t,e)}.bind(this)}),this.td.addEvent("click",function(){var t=this.td.cellIndex-2,e=this.td.getParent("tr").rowIndex-2;this.checkIsSelected(t,e)||(this.table.selectedCols.each(function(t){this.table.colSelectors[t].td.setStyles(this.table.css.monthlyTableSelectTd)}.bind(this)),this.table.selectedRows.each(function(t){this.table.rowSelectors[t].td.setStyles(this.table.css.monthlyTableSelectTd)}.bind(this)),this.table.selectedRows=[],this.table.selectedCols=[],this.checkSelectedCells(),this.table.content.reloadChart())}.bind(this))},cellDragStart:function(t,e){var s=this.td.getPosition(),i=this.td.getSize();this.td.store("start",{x:s.x,y:s.y}),this.td.store("start2",{x:s.x+i.x,y:s.y+i.y})},getSelectedCells:function(t,e){var s=e.page.x-t.x,i=e.page.y-t.y,l=this.td.getSize();return{cols:(s/l.x).toInt(),rows:(i/l.y).toInt()}},cellDrag:function(t,e){this.table.selectedRows=[],this.table.selectedCols=[],this.table.selectedData=[];var s=this.td.retrieve("start"),i=this.td.retrieve("start2"),l=this.getSelectedCells(s,e),n=this.getSelectedCells(i,e),o=Math.abs(l.cols)>Math.abs(n.cols)?l.cols:n.cols,a=Math.abs(l.rows)>Math.abs(n.rows)?l.rows:n.rows,h=this.td.cellIndex-2,c=this.td.getParent("tr").rowIndex-2;(!h||h<0)&&(h=0),(!c||c<0)&&(c=0);var r=h+o,d=c+a;if(d>c)for(var p=c;p<=d;p++)this.table.selectedRows.push(p);else for(p=d;p<=c;p++)this.table.selectedRows.push(p);if(r>h)for(p=h;p<=r;p++)this.table.selectedCols.push(p);else for(p=r;p<=h;p++)this.table.selectedCols.push(p);this.checkSelectedCells()},completeDrag:function(t,e){this.table.selectedCols.each(function(t){this.table.colSelectors[t].td.setStyles(this.table.css.monthlyTableSelectedTd)}.bind(this)),this.table.selectedRows.each(function(t){this.table.rowSelectors[t].td.setStyles(this.table.css.monthlyTableSelectedTd)}.bind(this)),this.table.content.reloadChart()},checkSelectedCells:function(){this.table.selectedData=[],this.table.tableData.cells.each(function(t,e){var s={column:this.table.tableData.cols[e],data:[]};t.each(function(t,i){this.checkIsSelected(e,i)?(t.setStyles(this.table.css.monthlyTableTd_selected),s.data.push({name:this.table.tableData.rows[i].name,value:this.table.tableData.rows[i].value,count:this.table.tableData.data[e][i]})):t.setStyles(this.table.css.monthlyTableTd)}.bind(this)),s.data.length&&this.table.selectedData.push(s)}.bind(this))}}),MWF.xApplication.BAM.monthly.MonthlyContent.Chart=new Class({initialize:function(t,e,s){this.content=t,this.monthly=this.content.monthly,this.app=this.monthly.app,this.css=this.content.css,this.container=$(e),this.data=s,this.load()},load:function(){this.chartFlagNode=new Element("div",{styles:this.css.monthlyChartFlagAreaNode}).inject(this.container),this.chartNode=new Element("div",{styles:this.css.monthlyChartNode}).inject(this.container),this.loadChart()},loadChart:function(){MWF.require("MWF.widget.chart.Bar",function(){this.flag=[],this.bar=new MWF.widget.chart.Bar(this.chartNode,this.data,"column",{delay:0,style:"monthly"}),this.data[0].data.each(function(t,e){this.flag.push({name:t.name,color:this.bar.colors[e]}),this.bar.addBar((function(t){return t.data[e].count}))}.bind(this)),this.bar.addEvents({mouseover:function(t,e,s,i){e.filter((function(t,e){return e==i})).attr("display","block");var l=t.filter((function(t,e){return e==i})),n=l.attr("fill");l.node().store("color",n),l.attr("fill","brown")}.bind(this),mouseout:function(t,e,s,i){e.filter((function(t,e){return e==i})).attr("display","none");var l=t.filter((function(t,e){return e==i})),n=l.node().retrieve("color");l.attr("fill",n)}.bind(this)}),this.bar.load(),this.loadFlags()}.bind(this))},loadFlags:function(){this.flag.each(function(t,e){this.loadFlag(t,e)}.bind(this))},loadFlag:function(t,e){var s=new Element("div",{styles:this.css.monthlyChartFlagNode}).inject(this.chartFlagNode);new Element("div",{styles:this.css.monthlyChartFlagColorNode}).inject(s).setStyle("background-color",t.color);var i=new Element("div",{styles:this.css.monthlyChartFlagNameNode}).inject(s);i.set("text",t.name),i.set("title",t.name),s.store("idx",e),s.store("barColor",t.color);var l=this;s.addEvents({mouseover:function(){this.getFirst().setStyles(l.css.monthlyChartFlagColorNode_over);var t=this.retrieve("idx");l.highlightBar(t)},mouseout:function(){this.getFirst().setStyles(l.css.monthlyChartFlagColorNode);var t=this.retrieve("idx"),e=this.retrieve("barColor");l.unHighlightBar(t,e)}})},createHighlightDefs:function(t){var e=this.bar.svg.append("defs"),s=this.bar.css.rect_over_defs;this.createDefs(e,s),e.select((function(){return this.getFirst()})).attr("id",t),e.attr("id","defs_"+t)},createDefs:function(t,e){var s=t.append(e.tag);Object.each(e.attrs,(function(t,e){s.attr(e,t)})),e.subs&&e.subs.each(function(t){this.createDefs(s,t)}.bind(this))},recreateBars:function(t){var e=this.data.map(function(e,s){return{name:e.column,data:e.data[t].count}}.bind(this));this.bar.rectClass=Math.round(100*Math.random());var s=this.bar.xScale.bandwidth()/this.bar.barsData.length,i=this.bar.group.selectAll(".MWFBar_"+this.bar.rectClass+"_"+t).data(e).enter().append("rect").attr("class",".MWFBar_"+this.bar.rectClass+"_"+t).attr("x",function(e){return this.xScale(e.name)+t*s}.bind(this.bar)).attr("width",s).attr("height",function(t){return this.size.y-this.yScale(t.data)}.bind(this.bar)).attr("y",function(t){return this.yScale(t.data)}.bind(this.bar)).attr("fill",this.bar.colors[t]);return this.bar.rectCluster[t]=i,this.bar.setEvents(),i},highlightBar:function(t){this.bar.rectCluster[t].remove();var e=this.recreateBars(t),s="rect_over_defs"+t;this.createHighlightDefs(s),e.attr(this.bar.css.rect_over_defs.urlAttr,"url(#"+s+")");var i=this.bar.textCluster[t];i.attr("display","block"),i.attr("font-weight","bold")},unHighlightBar:function(t,e){var s="rect_over_defs"+t;d3.select("#defs_"+s).remove(),this.bar.rectCluster[t].attr(this.bar.css.rect_over_defs.urlAttr,null);var i=this.bar.textCluster[t];i.attr("display","none"),i.attr("font-weight","normal")},destroy:function(){this.container.empty(),this.bar.destroy(),MWF.release(this)}}),MWF.xApplication.BAM.monthly.MonthlyContent.Filter=new Class({Implements:[Options,Events],initialize:function(t,e){this.content=t,this.monthly=this.content.monthly,this.app=this.monthly.app,this.css=this.content.css,this.sort=this.content.sort,this.filter=this.content.filter,this.node=$(e),this.load()},load:function(){this.node.addEvent("cilck",function(){this.showFilterMenu()}.bind(this))},showFilterMenu:function(){this.node=new Element("div",{styles:this.css.filterAreaNode}),this.conditionNode=new Element("div",{styles:this.css.filterAreaConditionNode}).inject(this.node),this.actionNode=new Element("div",{styles:this.css.filterAreaActionNode}).inject(this.node),this.createAction()},createAction:function(){this.okAction=new Element("div",{styles:this.css.filterAreaOkActionNode}).inject(this.actionNode),this.cancelAction=new Element("div",{styles:this.css.filterAreaCancelActionNode}).inject(this.actionNode)}}),MWF.xApplication.BAM.monthly.MonthlyTaskContent=new Class({Extends:MWF.xApplication.BAM.monthly.MonthlyContent}),MWF.xApplication.BAM.monthly.MonthlyTaskCompletedContent=new Class({Extends:MWF.xApplication.BAM.monthly.MonthlyContent,loadData:function(t){this.actions.loadMonthly("taskCompleted",this.sort,this.filter,function(e){this.data=e.data,t&&t()}.bind(this))}}),MWF.xApplication.BAM.monthly.MonthlyWorkContent=new Class({Extends:MWF.xApplication.BAM.monthly.MonthlyContent,loadData:function(t){this.actions.loadMonthly("work",this.sort,this.filter,function(e){this.data=e.data,t&&t()}.bind(this))}}),MWF.xApplication.BAM.monthly.MonthlyWorkCompletedContent=new Class({Extends:MWF.xApplication.BAM.monthly.MonthlyContent,loadData:function(t){this.actions.loadMonthly("workCompleted",this.sort,this.filter,function(e){this.data=e.data,t&&t()}.bind(this))}}),MWF.xApplication.BAM.monthly.MonthlyTaskExpiredContent=new Class({Extends:MWF.xApplication.BAM.monthly.MonthlyContent,loadData:function(t){this.actions.loadMonthly("taskExpired",this.sort,this.filter,function(e){this.data=e.data,t&&t()}.bind(this))}}),MWF.xApplication.BAM.monthly.MonthlyWorkExpiredContent=new Class({Extends:MWF.xApplication.BAM.monthly.MonthlyContent,loadData:function(t){this.actions.loadMonthly("workExpired",this.sort,this.filter,function(e){this.data=e.data,t&&t()}.bind(this))}});