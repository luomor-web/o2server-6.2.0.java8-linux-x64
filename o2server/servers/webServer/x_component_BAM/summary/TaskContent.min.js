MWF.xApplication.BAM.summary=MWF.xApplication.BAM.summary||{},MWF.xApplication.BAM.summary.TaskContent=new Class({Implements:[Options,Events],options:{style:"default",max:!0},initialize:function(t,e,i){this.setOptions(i),this.summary=t,this.app=this.summary.app,this.css=this.app.css,this.lp=this.app.lp,this.container=$(e),this.category="application",this.data=this.summary.categoryData,this.maxColumn=10,this.barOptions={style:"task"},this.load()},load:function(){this.loadArea(this.lp.task),this.loadBarData(this.loadBar.bind(this))},reload:function(){this.countBar&&this.countBar.destroy(),this.elapsedBar&&this.elapsedBar.destroy(),this.elapsedCountBar&&this.elapsedCountBar.destroy(),this.timeoutRateBar&&this.timeoutRateBar.destroy(),this.timelinessRateBar&&this.timelinessRateBar.destroy(),this.countBar=null,this.elapsedBar=null,this.elapsedCountBar=null,this.timeoutRateBar=null,this.timelinessRateBar=null,this.countNode&&this.countNode.empty(),this.expiredNode&&this.expiredNode.empty(),this.expiredCountNode&&this.expiredCountNode.empty(),this.timeoutRateNode&&this.timeoutRateNode.empty(),this.timelinessRateNode&&this.timelinessRateNode.empty(),this.loadBarData(function(){this.loadBar()}.bind(this))},loadArea:function(t){this.node=new Element("div",{styles:this.css.taskContentNode}).inject(this.container),this.headNode=new Element("div",{styles:this.css.taskRankHeadNode}).inject(this.node),this.categoryNode=new Element("div",{styles:this.css.taskRankCategoryNode}).inject(this.headNode),this.actionNode=new Element("div",{styles:this.css.taskRankActionNode}).inject(this.headNode),this.titleNode=new Element("div",{styles:this.css.taskRankTitleNode,text:t}).inject(this.headNode),this.chartAreaNode=new Element("div",{styles:this.css.contentChartAreaNode}).inject(this.node),this.loadTab(),this.loadCategory(),this.options.max&&this.actionNode.addEvent("click",function(){this.maxNode?this.returnSizeChart():this.maxSizeChart()}.bind(this))},returnSizeChart:function(){this.resizeReturnChart();var t=this.container.getSize(),e=this.container.getPosition(this.container.getOffsetParent());new Fx.Morph(this.maxNode,{duration:150}).start({height:t.y+"px",width:t.x+"px",left:e.x+"px",top:e.y+"px"}).chain(function(){this.maxNode.destroy(),this.maxNode=null,this.reload(),this.resizeMaxChartFun&&this.app.removeEvent("resize",this.resizeMaxChartFun)}.bind(this))},resizeReturnChart:function(){this.node.inject(this.container),this.node.setStyles(this.css.taskContentNode),this.chartAreaNode.setStyles(this.css.contentChartAreaNode),this.actionNode.setStyles(this.css.taskRankActionNode);var t=this.chartAreaNode.getSize().y-24;this.countNode.setStyle("height",t+"px"),this.expiredNode.setStyle("height",t+"px"),this.expiredCountNode.setStyle("height",t+"px"),this.timeoutRateNode&&this.timeoutRateNode.setStyle("height",t+"px"),this.timelinessRateNode&&this.timelinessRateNode.setStyle("height",t+"px"),this.maxColumn=10,this.barOptions={marginBottom:46,style:"task"}},maxSizeChart:function(){this.createMaxNode();var t=this.app.content.getSize(),e=t.x-18,i=t.y-18;new Fx.Morph(this.maxNode,{duration:150}).start({height:i+"px",width:e+"px",left:"5px",top:"5px"}).chain(function(){this.reloadMaxChart(),this.resizeMaxChartFun=this.resizeMaxChart.bind(this),this.app.addEvent("resize",this.resizeMaxChartFun)}.bind(this))},resizeMaxChart:function(){var t=this.app.content.getSize(),e=t.x-18,i=t.y-18;this.maxNode.setStyles({height:i+"px",width:e+"px",left:"5px",top:"5px"}),this.reloadMaxChart()},reloadMaxChart:function(){this.node.inject(this.maxNode),this.node.setStyles(this.css.taskContentNode_max),this.chartAreaNode.setStyles(this.css.contentChartAreaNode_max),this.actionNode.setStyles(this.css.taskRankActionNode_max);var t=this.chartAreaNode.getSize(),e=t.y-80;this.countNode.setStyle("height",e+"px"),this.expiredNode.setStyle("height",e+"px"),this.expiredCountNode.setStyle("height",e+"px"),this.timeoutRateNode&&this.timeoutRateNode.setStyle("height",e+"px"),this.timelinessRateNode&&this.timelinessRateNode.setStyle("height",e+"px"),this.maxColumn=Math.round(t.x/40),this.barOptions={marginBottom:100,delay:10,style:"task_max"},this.reload()},createMaxNode:function(){this.maxNode=new Element("div",{styles:this.css.contentChartMaxAreaNode}).inject(this.container,"after");var t=this.container.getSize();this.maxNode.setStyles({height:t.y+"px",width:t.x+"px"}),this.maxNode.position({relativeTo:this.container,position:"upperLeft",edge:"upperLeft"})},loadTab:function(){this.tab=new MWF.widget.Tab(this.chartAreaNode,{style:"BAM_content"}),this.tab.load(),this.countNode=new Element("div",{styles:this.css.contentTabAreaNode}),this.expiredNode=new Element("div",{styles:this.css.contentTabAreaNode}),this.expiredCountNode=new Element("div",{styles:this.css.contentTabAreaNode}),this.timeoutRateNode=new Element("div",{styles:this.css.contentTabAreaNode}),this.countPage=this.tab.addTab(this.countNode,this.lp.contentTypeCount),this.expiredPage=this.tab.addTab(this.expiredNode,this.lp.contentTypeExpired),this.expiredCountPage=this.tab.addTab(this.expiredCountNode,this.lp.taskContentTypeExpiredCount),this.timeoutRatePage=this.tab.addTab(this.timeoutRateNode,this.lp.timeout)},loadBar:function(){MWF.require("MWF.widget.chart.Bar",function(){this.countPage.addEvent("show",function(){this.countBar?this.countBar.transition():this.countBar=this.loadBarChart(this.countNode,this[this.category+"Data"].taskCount.slice(0,this.maxColumn),this.barOptions)}.bind(this)),this.expiredPage.addEvent("show",function(){this.elapsedBar?this.elapsedBar.transition():this.elapsedBar=this.loadBarChart(this.expiredNode,this[this.category+"Data"].taskDuration.slice(0,this.maxColumn),this.barOptions)}.bind(this)),this.expiredCountPage.addEvent("show",function(){this.elapsedCountBar?this.elapsedCountBar.transition():this.elapsedCountBar=this.loadBarChart(this.expiredCountNode,this[this.category+"Data"].taskElapsedCount.slice(0,this.maxColumn),this.barOptions)}.bind(this)),this.timeoutRatePage.addEvent("show",function(){if(this.timeoutRateBar)this.timeoutRateBar.transition();else{var t=this.barOptions?Object.clone(this.barOptions):{};t.tickFormat=".0%",t.dataFormat=".1%",this.timeoutRateBar=this.loadBarChart(this.timeoutRateNode,this[this.category+"Data"].taskTimeoutRate.slice(0,this.maxColumn),t)}}.bind(this)),this.countPage.isShow?this.countPage.showIm():this.countPage.showTabIm()}.bind(this))},loadBarChart:function(t,e,i){var s=new MWF.widget.chart.Bar(t,e,"name",i);return s.addBar("value"),s.addEvents({mouseover:function(t,e,i,s){e.filter((function(t,e){return e==s})).attr("display","block");var a=t.filter((function(t,e){return e==s})),o=a.attr("fill");a.node().store("color",o),a.attr("fill","brown")}.bind(this),mouseout:function(t,e,i,s){e.filter((function(t,e){return e==s})).attr("display","none");var a=t.filter((function(t,e){return e==s})),o=a.node().retrieve("color");a.attr("fill",o)}.bind(this)}),s.load(),s},loadCategory:function(){var t=new MWF.widget.UUID,e="<input name='"+t+"TaskRankCategory' type='radio' value='application' checked>"+this.lp.application+"<input name='"+t+"TaskRankCategory' type='radio' value='process'>"+this.lp.process+"<input name='"+t+"TaskRankCategory' type='radio' value='activity'>"+this.lp.activity;this.categoryNode.set("html",e);var i=this;this.categoryNode.getElements("input").addEvent("click",(function(){i.category=this.value,i.reload()}))},loadBarData:function(t){this[("load-"+this.category+"-data").camelCase()](function(){t&&t()}.bind(this))},loadApplicationData:function(t){this.applicationData||(this.applicationData=this.app.actions.getTaskContentData(this.summary.categoryData.application||[])),t&&t()},loadProcessData:function(t){this.processData||(this.processData=this.app.actions.getTaskContentData(this.summary.categoryData.process||[])),t&&t()},loadActivityData:function(t){this.activityData||(this.activityData=this.app.actions.getTaskContentData(this.summary.categoryData.activity||[],(function(t){return t.processName+"-"+t.name}))),t&&t()},destroy:function(){this.countBar&&this.countBar.destroy(),this.elapsedBar&&this.elapsedBar.destroy(),this.elapsedCountBar&&this.elapsedCountBar.destroy(),this.timeoutRateBar&&this.timeoutRateBar.destroy(),this.timelinessRateBar&&this.timelinessRateBar.destroy(),MWF.release(this)}});