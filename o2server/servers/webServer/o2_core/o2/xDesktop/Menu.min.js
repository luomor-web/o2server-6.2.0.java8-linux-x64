MWF.xDesktop=MWF.xDesktop||{},MWF.require("MWF.widget.Menu",null,!1),MWF.xDesktop.Menu=new Class({Extends:MWF.widget.Menu,Implements:[Options,Events],options:{style:"default",event:"contextmenu",disable:!1,top:-1,left:-1,container:null,where:{x:"left",y:"bottom"}},load:function(){this.fireEvent("queryLoad")&&(this.node=new Element("div#menu"),this.node.set("styles",this.css.container),this.options.event&&this.target&&this.target.addEvent(this.options.event,this.showIm.bind(this)),this.borderNode=new Element("div.MWFMenu",{styles:this.css.borderNode}).inject(this.options.container||$(document.body)),this.node.inject(this.borderNode),this.hide=this.hideMenu.bind(this),this.fireEvent("postLoad"))},showIm:function(t){if(!this.options.disable&&(this.hide=this.hideIm.bind(this),this.fireEvent("queryShow",[t]))){if(this.tmpBodyOncontextmenu=document.body.oncontextmenu,document.body.oncontextmenu=function(){return!1},this.pauseCount<=0){this.setItemWidth();var e=MWF.xDesktop.zIndexPool.zIndex;this.borderNode.setStyles({display:"block",opacity:this.options.opacity||1,"z-index":e}),this.setPosition(t),$(document.body).removeEvent("mousedown",this.hide),$(document.body).addEvent("mousedown",this.hide),this.show=!0}else this.pauseCount--;var o=this.node.getPosition(document.body),i=this.node.getSize(),s=document.body.getSize();if(o.y+i.y+10>s.y){var n=s.y-o.y-10;this.node.setStyle("height",n+"px"),this.node.addEvent("mousedown",(function(t){t.stopPropagation()}))}this.fireEvent("postShow")}},hideIm:function(t){this.fireEvent("queryHide")&&($(document.body).removeEvent("mousedown",this.hide),this.borderNode.set("styles",{display:"none",opacity:0}),this.show=!1,document.body.oncontextmenu=this.tmpBodyOncontextmenu,this.tmpBodyOncontextmenu=null,t&&this.topMenu&&this.topMenu.hideIm(),this.fireEvent("postHide"))},setPosition:function(t){var e=this.target.getPosition(this.target.getOffsetParent()),o=this.target.getSize();this.borderNode.show();var i=this.borderNode.getSize(),s=0,n=0;switch(this.options.where.x.toLowerCase()){case"right":s=e.x-i.x+o.x;break;default:s=e.x-0}switch(this.options.where.y.toLowerCase()){case"top":n=e.y-i.y;break;default:n=e.y+o.y}this.options.offsetY&&(n+=this.options.offsetY),this.options.offsetX&&(s+=this.options.offsetX);var d=$(document.body).getSize(),h=this.borderNode.getSize();s+h.x>d.x&&(s=d.x-h.x-10),this.borderNode.setStyle("top",n),this.borderNode.setStyle("left",s)}});