o2.require("o2.widget.PinYin",null,!1),o2.xDesktop.Default=new Class({Implements:[Options,Events],options:{style:"blue",index:"Homepage"},zoomOut:function(){layout.userLayout.scale||(layout.userLayout.scale=1),layout.userLayout.scale=layout.userLayout.scale-.1,layout.userLayout.scale<.4&&(layout.userLayout.scale=.4),this.zoom()},zoomIn:function(){layout.userLayout.scale||(layout.userLayout.scale=1),layout.userLayout.scale=layout.userLayout.scale+.1,layout.userLayout.scale>5&&(layout.userLayout.scale=5),this.zoom()},zoom:function(t){if(t&&(layout.userLayout.scale=t,layout.userLayout.scale<.4&&(layout.userLayout.scale=.4),layout.userLayout.scale>5&&(layout.userLayout.scale=5)),layout.userLayout.scale){var e=1/layout.userLayout.scale*100+"%";document.id(document.documentElement).setStyles({transform:"scale("+layout.userLayout.scale+")","transform-origin":"0 0",width:e,height:e}),this.fireEvent("resize"),this.setZoomValue()}},setZoomValue:function(){layout.userLayout.scale||(layout.userLayout.scale=1);var t=Math.round(100*layout.userLayout.scale);this.zoomValueNode&&this.zoomValueNode.set("text",t+"%")},returnZoom:function(){this.zoom(1)},zoomMenuShow:function(){this.sliderNode.show(),this.sliderNode.set("tween",{duration:100}),this.sliderNode.tween("width","140"),this.zoomSlider||(layout.userLayout.scale||(layout.userLayout.scale=1),this.sliderNode.addEvent("mousedown",(function(t){t.stopPropagation(),t.preventDefault()})),this.zoomSlider=new Slider(this.zoomSliderNode,this.zoomSliderKnobNode,{range:[30,300],wheel:!1,snap:!0,steps:27,initialStep:100*layout.userLayout.scale,onChange:function(t){this.zoomValueNode&&this.zoomValueNode.set("text",t+"%")}.bind(this),onComplete:function(t){var e=t/100;this.zoom(e),this.zoomMenuHide()}.bind(this)})),this.hideZoom=this.zoomMenuHide.bind(this),this.desktopNode.addEvent("mousedown",this.hideZoom)},zoomMenuHide:function(){this.sliderNode.set("tween",{duration:100}),this.sliderNode.tween("width","0"),this.hideZoom&&this.desktopNode.removeEvent("mousedown",this.hideZoom)},initialize:function(t,e){this.setOptions(e),this.type="layout",this.path=o2.session.path+"/xDesktop/$Default/",this.node=$(t),this.node.empty(),this.initData(),this.zoom()},initData:function(){this.apps={},this.appArr=[],this.appCurrentList=[],this.lnks=[],this.currentApp=null,this.session={},this.serviceAddressList=layout.serviceAddressList,this.centerServer=layout.centerServer,this.session.user=layout.session.user;var t=new URI(window.location.href),e=t.getData("default")||"";this.noDefault="false"===e.toString().toLowerCase();var i=t.getData("app"),s=t.getData("option"),o=s?JSON.decode(s):null;i?(this.status=layout.userLayout,this.status.apps={},this.status.apps[i]=o||{},this.status.apps[i].name=i,this.status.apps[i].appId=i,this.status.apps[i].isIndex=!0,this.status.currentApp=i):this.status=layout.userLayout,this.status&&this.status.flatStyle&&(this.options.style=this.status.flatStyle)},load:function(t){this.loadLayout(function(){this.setEvent(),this.noDefault||this.loadDefaultPage(),window.setTimeout(function(){var e=this.path+"icons.json";o2.JSON.get(e,function(e){this.iconsJson=e,this.loadDefaultLnk(),this.loadStatus(),t&&t()}.bind(this)),this.openWebSocket(),this.checkTaskBarSize(),this.addEvent("resize",this.checkTaskBarSize.bind(this))}.bind(this),0),this.loadMessageMenu(),this.setZoomValue(),this.fireEvent("load"),MWF.require("MWF.xDesktop.shortcut")}.bind(this))},resizeHeight:function(){var t=this.menuNode.getSize().y,e=this.startMenuNode.getParent().getSize().y,i=this.startMenuNode.getParent().getStyles("border-top-width","margin-top","padding-top","border-bottom-width","margin-bottom","padding-bottom"),s=this.settingNode.getParent().getSize().y,o=this.settingNode.getParent().getStyles("border-top-width","margin-top","padding-top","border-bottom-width","margin-bottom","padding-bottom");oy1=i["border-top-width"].toInt()+i["margin-top"].toInt()+i["padding-top"].toInt()+i["border-bottom-width"].toInt()+i["margin-bottom"].toInt()+i["padding-bottom"].toInt(),oy2=o["border-top-width"].toInt()+o["margin-top"].toInt()+o["padding-top"].toInt()+o["border-bottom-width"].toInt()+o["margin-bottom"].toInt()+o["padding-bottom"].toInt();var n=t-e-s-oy1-oy2;this.lnkContentNode.setStyle("height",n+"px")},checkTaskBarSize:function(){window.setTimeout(function(){var t=this.taskContentAreaNode.getSize(),e=this.taskContentNode.getSize();t.y<e.y?(this.taskActionUp.show(),this.taskActionDown.show()):(this.taskActionUp.hide(),this.taskActionDown.hide())}.bind(this),50)},checkTaskBarScrollTo:function(t){var e=t||this.currentApp;if(e&&e.taskitem){var i=this.taskContentAreaNode.getSize(),s=this.taskContentAreaNode.getScroll(),o=this.taskContentAreaNode.getScrollSize(),n=e.taskitem.node.getPosition(this.taskContentNode);if(n.y!=s.y){var a=n.y;a<o.y-i.y?(this.taskActionDown.addClass("icon_down"),this.taskActionDown.removeClass("icon_down_gray")):(this.taskActionDown.removeClass("icon_down"),this.taskActionDown.addClass("icon_down_gray")),a<=0?(a=0,this.taskActionUp.removeClass("icon_up"),this.taskActionUp.addClass("icon_up_gray")):(this.taskActionUp.addClass("icon_up"),this.taskActionUp.removeClass("icon_up_gray")),this.taskContentAreaNode.scrollTo(0,n.y)}}},toolbarUp:function(){var t=this.taskContentAreaNode.getSize(),e=this.taskContentAreaNode.getScroll(),i=this.taskContentAreaNode.getScrollSize(),s=e.y-t.y;s<i.y-t.y&&(this.taskActionDown.addClass("icon_down"),this.taskActionDown.removeClass("icon_down_gray")),s<=0&&(s=0,this.taskActionUp.removeClass("icon_up"),this.taskActionUp.addClass("icon_up_gray")),this.taskContentAreaNode.scrollTo(0,s)},toolbarDown:function(){var t=this.taskContentAreaNode.getSize(),e=this.taskContentAreaNode.getScroll(),i=this.taskContentAreaNode.getScrollSize(),s=e.y+t.y;s+t.y>=i.y&&(s=i.y-t.y,this.taskActionDown.removeClass("icon_down"),this.taskActionDown.addClass("icon_down_gray")),s>0&&(this.taskActionUp.addClass("icon_up"),this.taskActionUp.removeClass("icon_up_gray")),this.taskContentAreaNode.scrollTo(0,s)},loadLayout:function(t){this.session.user.iconUrl=o2.filterUrl(o2.Actions.get("x_organization_assemble_control").getPersonIcon(this.session.user.id));var e=this.path+this.options.style+(o2.session.isMobile||layout.mobile,"/style-pc.css"),i=this.path+this.options.style+"/style-skin.css",s=this.path+this.options.style+(o2.session.isMobile||layout.mobile,"/layout-pc.html");this.node.loadAll({css:[e],html:[s]},{bind:{user:this.session.user},module:this},function(){var e=new XMLHttpRequest;e.addEventListener("load",function(){var t=new FileReader;t.addEventListener("load",function(){this.userInforNode.getFirst().setStyle("background-image","url("+t.result+")")}.bind(this),!1),t.readAsDataURL(e.response)}.bind(this)),e.open("GET",this.session.user.iconUrl),e.setRequestHeader("authorization",layout.session.user.token),e.responseType="blob",e.withCredentials=!0,e.send(),this.node.loadCss(i),t&&t()}.bind(this))},setEvent:function(){this.loadSkinMenu(),this.loadUserMenu(),window.onbeforeunload=function(t){if(!this.isLogout)return this.notRecordStatus||this.recordDesktopStatus(),this.closeWebSocket(),this.fireEvent("unload"),(t=t||window.event).returnValue=o2.LP.desktop.notice.unload,o2.LP.desktop.notice.unload}.bind(this),$(window).addEvent("resize",function(){this.fireEvent("resize")}.bind(this)),this.resizeHeight(),this.addEvent("resize",this.resizeHeight.bind(this)),o2.require("o2.widget.ScrollBar",function(){this.appScrollBar=new o2.widget.ScrollBar(this.lnkContentNode,{style:"hide",where:"before",indent:!0,distance:100,friction:0,axis:{x:!1,y:!0}})}.bind(this))},loadDefaultPage:function(){var t;layout.config.indexPage&&layout.config.indexPage.enable&&layout.config.indexPage.portal?(appId="portal.Portal"+layout.config.indexPage.portal,this.options.index=appId,t={options:{name:"portal.Portal",portalId:layout.config.indexPage.portal,pageId:layout.config.indexPage.page,appId:appId},close:function(){this.taskitem.destroy()},setCurrent:function(){this.taskitem.textNode&&this.taskitem.textNode.click()}}):t={options:{name:"Homepage",appId:"Homepage",title:o2.LP.desktop.homepage},close:function(){this.taskitem.destroy()},setCurrent:function(){this.taskitem.textNode&&this.taskitem.textNode.click()}},taskitem=layout.desktop.createTaskItem(t),t.taskitem=taskitem,t.options.isIndex=!0,this.apps[t.options.appId]=t,taskitem.textNode.click()},loadDefaultLnk:function(){this.status&&this.status.flatLnks&&this.status.flatLnks.length||o2.JSON.get(this.path+"defaultLnk.json",function(t){t.each(function(t){this.addLnk(t)}.bind(this))}.bind(this))},loadStatus:function(){if(this.status){this.menuData=this.status.menuData;var t=Object.keys(this.status.apps);if(this.status.apps&&t.length){if("Note"==this.status.currentApp){for(var e=t.length-1;e>-1&&"Note"==t[e];)e--;this.status.currentApp=e>-1?this.status.apps[t[e]].appId:""}var i=null;Object.each(this.status.apps,function(t,e){var s={options:t,close:function(){this.taskitem.destroy()},setCurrent:function(){this.taskitem.textNode&&this.taskitem.textNode.click()}};taskitem=layout.desktop.createTaskItem(s),s.taskitem=taskitem,this.apps[t.appId]=s,this.status.currentApp===t.appId&&(i=taskitem)}.bind(this)),i&&i.textNode.click()}this.status.widgets,this.status.flatLnks&&this.status.flatLnks.length&&this.status.flatLnks.each(function(t){this.addLnk(t)}.bind(this))}},addLnk:function(t,e,i){var s=new o2.xDesktop.Default.Lnk(this,t,e,i);if(e){var o=this.lnks.indexOf(e);"before"==i?this.lnks.splice(o,0,s):this.lnks.splice(o+1,0,s)}else this.lnks.push(s)},openWebSocket:function(){MWF.require("MWF.xDesktop.WebSocket",function(){this.socket=new MWF.xDesktop.WebSocket}.bind(this))},closeWebSocket:function(){this.socket&&this.socket.close()},loadSkinMenu:function(){this.styleMenu||(this.styleMenu=new o2.xDesktop.Menu(this.skinActionNode,{event:"click",style:"flatStyle",offsetX:-10,offsetY:26,container:this.node,onQueryShow:this.showSkinMenu.bind(this),onQueryHide:function(){this.skinActionNode.removeClass("icon_skin_focus"),this.skinActionNode.removeClass("mainColor_bg")}.bind(this)}),this.styleMenu.load(),this.loadSkinMenuItems())},showSkinMenu:function(){this.styleMenu.items.each(function(t){this.options.style==t.styleName?(t.setDisable(!0),t.text&&t.text.setStyles({background:"url("+this.path+this.options.style+"/icons/icon_gouxuan.png) right center no-repeat"})):(t.setDisable(!1),t.text&&t.text.setStyles({background:"transparent"}))}.bind(this)),this.skinActionNode.addClass("icon_skin_focus"),this.skinActionNode.addClass("mainColor_bg")},loadSkinMenuItems:function(){o2.JSON.get(this.path+"styles.json",function(t){t.each(function(t){var e=t.color,i=this.styleMenu.addMenuItem(t.title,"click",function(){this.changeLayoutSkin(t.style)}.bind(this));i.styleName=t.style;var s=i.item.getFirst();new Element("div",{styles:i.menu.css.menuItemImg}).inject(s).setStyle("background-color",e)}.bind(this)),this.styleMenu.addMenuLine();var e=o2.defaultPath+"/xDesktop/$Layout/default/preview.jpg";this.styleMenu.addMenuItem(o2.LP.desktop_style,"click",function(t){this.changeToDesktopStyle(t)}.bind(this),e).styleName="desktop"}.bind(this))},changeLayoutSkin:function(t){var e=this.path+this.options.style+"/style-skin.css";o2.removeCss(e),this.options.style=t,e=this.path+this.options.style+"/style-skin.css",this.node.loadCss(e)},changeToDesktopStyle:function(t){var e=new URI(window.location.href);e.setData("view","layout"),e.go()},loadUserMenu:function(){this.userMenu||(this.userMenu=new o2.xDesktop.Menu(this.userInforNode,{event:"click",style:"flatUser",offsetX:30,offsetY:6,container:this.node}),this.userMenu.load(),this.loadUserMenuItems())},loadUserMenuItems:function(){var t=this.path+this.options.style+"/icons/config.png";this.userMenu.addMenuItem(o2.LP.desktop.userConfig,"click",function(t){this.userConfig(t)}.bind(this),t),this.userMenu.addMenuLine(),t=this.path+this.options.style+"/icons/logout.png",this.userMenu.addMenuItem(o2.LP.desktop.logout,"click",function(){this.logout()}.bind(this),t)},userConfig:function(t){layout.openApplication(t,"Profile")},logout:function(){this.isLogout=!0,this.notRecordStatus?(layout.authentication||new o2.xDesktop.Authentication).logout():this.recordDesktopStatus(function(){(layout.authentication||new o2.xDesktop.Authentication).logout()}.bind(this.layout))},focusSearch:function(){this.searchBoxNode.addClass("layout_content_taskbar_area_search_box_focus"),this.searchBoxNode.addClass("mainColor_border"),this.searchIconNode.addClass("icon_search_focus")},blurSearch:function(){this.searchBoxNode.removeClass("layout_content_taskbar_area_search_box_focus"),this.searchBoxNode.removeClass("mainColor_border"),this.searchIconNode.removeClass("icon_search_focus")},searchInputKeyDown:function(t){this.searchInputNode.get("value")?this.searchClearNode.addClass("icon_clear"):this.searchClearNode.removeClass("icon_clear"),13===t.keyCode&&this.doSearch()},clearSearch:function(){this.searchInputNode.set("value",""),this.searchClearNode.removeClass("icon_clear"),this.clearSearchResult()},doSearch:function(){var t=this.searchInputNode.get("value");t&&(this.apps.Search&&(this.apps.Search.input.setValue(t),this.apps.Search.input.doSearch()),layout.openApplication(null,"Search",{key:t}))},clearSearchResult:function(){},recordDesktopStatus:function(t){Object.each(this.apps,function(t,e){t.options.desktopReload||this.closeApp(t)}.bind(this));var e=this.getLayoutStatusData();try{o2.UD.putData("layout",e,(function(){t&&t()}))}catch(t){}},getLayoutStatusData:function(){var t={viewMode:"Default",style:this.status.style,flatStyle:this.options.style,styleType:this.status.styleType||"",currentApp:this.currentApp?this.currentApp.appId:"Homepage",apps:{},lnks:this.status.lnks&&"array"===o2.typeOf(this.status.lnks)?this.status.lnks:[],flatLnks:[],widgets:{},menuData:this.menuData,scale:layout.userLayout.scale||1};return Object.each(this.apps,function(e,i){if(e.options.appId!==this.options.index){var s=this.getAppStatusData(e,i);s&&(t.apps[i]=s)}e.isIndex&&(t.apps[i]||(t.apps[i]={}),t.apps[i].isIndex=!0)}.bind(this)),this.lnks.each((function(e){t.flatLnks.push(e.data)})),Object.each(this.widgets,function(e,i){var s=this.getWidgetStatusData(e,i);s&&(t.widgets[i]=s)}.bind(this)),t},getAppStatusData:function(t,e){var i=null;return t.window?t.options.desktopReload&&(i={appId:t.appId,name:t.options.name,style:t.options.style,title:t.options.title,window:{},app:null},t.recordStatus&&(i.app=t.recordStatus())):t.options&&(i=t.options),i},getWidgetStatusData:function(t,e){var i={name:t.options.name,appName:t.options.appName,position:t.options.position,widget:null};return t.recordStatus&&(i.widget=t.recordStatus()),i},showStartMenu:function(){this.loadStartMenu(function(){this.startMenu.isShow||(this.startMenuNode.addClass("overColor_bg"),this.startMenu.show())}.bind(this))},loadStartMenu:function(t){this.startMenu?this.startMenu.isLoaded&&t&&t():(this.startMenu=new o2.xDesktop.Default.StartMenu(this),this.startMenu.addEvents({onHide:function(){this.startMenuNode.removeClass("overColor_bg")}.bind(this),onLoad:function(){t&&t()}}),this.startMenu.load())},showDesktopMessage:function(){this.message?this.showMessage():this.loadMessageMenu(function(){this.showMessage()}.bind(this))},loadMessageMenu:function(t){o2.require("o2.xDesktop.MessageV2",function(){this.message=new o2.xDesktop.MessageV2(this),this.message.addEvents({onLoad:function(){t&&t()}.bind(this),onHide:function(){this.msgActionNode.removeClass("icon_msg_focus"),this.msgActionNode.removeClass("mainColor_bg")}.bind(this)}),this.message.load()}.bind(this))},showMessage:function(){this.message.isShow||(this.msgActionNode.addClass("icon_msg_focus"),this.msgActionNode.addClass("mainColor_bg"),this.message.show())},createTaskItem:function(t){return new o2.xDesktop.Default.TaskItem(this,t)},closeApp:function(t,e){var i=t.appId;if(this.appCurrentList.erase(t),this.appArr.erase(t),this.apps[i]=null,delete this.apps[i],!e){var s=this.appCurrentList.length;if(s&&this.appCurrentList[s-1])this.appCurrentList[s-1].setCurrent();else{var o=Object.keys(this.apps);(s=o.length)&&this.apps[o[s-1]]&&this.apps[o[s-1]].setCurrent?this.apps[o[s-1]].setCurrent():layout.openApplication(null,"Homepage")}this.checkTaskBarSize(),this.checkTaskBarScrollTo()}},refreshApp:function(t){if(t.window){var e=t.taskitem,i={id:t.appId,name:t.options.name,style:t.options.style,appId:t.appId},s=t.recordStatus?t.recordStatus():null;t.close(!0),layout.openApplication(null,i.name,i,s,!1,e)}},getPageDesignerStyle:function(t){this.pageDesignerStyle?t&&t():(this.pageDesignerStyle="default",MWF.UD.getData("pageDesignerStyle",function(e){if(e.data){var i=JSON.decode(e.data);this.pageDesignerStyle=i.style}t&&t()}.bind(this)))},getFormDesignerStyle:function(t){this.formDesignerStyle?t&&t():(this.formDesignerStyle="default",MWF.UD.getData("formDesignerStyle",function(e){if(e.data){var i=JSON.decode(e.data);this.formDesignerStyle=i.style}t&&t()}.bind(this)))},createRefreshNode:function(){this.refreshNode=new Element("div.layout_refresh_node.icon_refresh").inject(this.desktopNode),this.refreshNode.set("morph",{duration:100,transition:Fx.Transitions.Quart.easeOut}),this.refreshNode.addEvent("click",function(){this.currentApp&&this.currentApp.refresh(),this.hideRefresh()}.bind(this))},showRefresh:function(){if(!this.refreshNodeShow){this.refreshNode||this.createRefreshNode();var t=this.taskbarNode.getSize(),e=this.refreshNode.getSize(),i=t.y,s=t.x/2-e.x/2;this.refreshNode.setStyles({left:s,top:0-e.y,opacity:0}),this.refreshNode.morph({top:i,left:s,opacity:.9}),this.refreshNodeShow=!0,this.refreshTimeoutId=window.setTimeout(function(){this.hideRefresh()}.bind(this),2e3)}},hideRefresh:function(){if(this.refreshNodeShow&&this.refreshNode){var t=this.taskbarNode.getSize(),e=this.refreshNode.getSize(),i=(t.y,t.x/2-e.x/2);this.refreshNode.morph({top:0-e.y,left:i,opacity:0}),window.setTimeout(function(){this.refreshNodeShow=!1}.bind(this),100)}this.refreshTimeoutId&&(window.clearTimeout(this.refreshTimeoutId),this.refreshTimeoutId="")}}),o2.xDesktop.Default.StartMenu=new Class({Implements:[Events],initialize:function(t){this.layout=t,this.container=this.layout.startMenuArea,this.actionNode=this.layout.startMenuNode,this.isLoaded=!1,this.isShow=!1,this.isMorph=!1,this.items=[],this.menuData=this.layout.status&&this.layout.status.menuData?this.layout.status.menuData:{appList:[],processList:[],inforList:[],queryList:[]},this.itemTempletedHtml="   <div class='layout_start_item_iconArea'>       <div class='layout_start_item_icon'></div>   </div>   <div class='layout_start_item_text'></div>   <div class='layout_start_item_badge'></div>"},load:function(){var t=this.layout.path+this.layout.options.style+(o2.session.isMobile||layout.mobile?"/layout-menu-mobile.html":"/layout-menu-pc.html");this.container.loadHtml(t,{module:this},function(){this.maskNode.setStyle("z-index",o2.xDesktop.zIndexPool.applyZindex()),this.node.setStyle("z-index",o2.xDesktop.zIndexPool.applyZindex()),this.layout.menuNode.setStyle("z-index",o2.xDesktop.zIndexPool.applyZindex()),this.node.addEvent("mousedown",(function(t){t.stopPropagation(),t.preventDefault()})),this.triangleNode=new Element("div.layout_menu_start_triangle").inject(this.layout.menuNode,"after"),this.hideMessage=function(){this.hide()}.bind(this),this.fireEvent("load"),this.layout.addEvent("resize",this.setSize.bind(this)),this.loadTitle(),this.loadLnks(),this.isLoaded=!0,this.fireEvent("load")}.bind(this))},resetMenuData:function(){this.menuData||(this.menuData={appList:[],processList:[],inforList:[],queryList:[]});var t=this.appContentNode.getChildren(),e=[];t.each(function(t){var i=t.retrieve("item");if(i)if("group"===i.data.type){var s={id:i.data.id,name:i.data.name,type:i.data.type,itemDataList:[]};i.data.itemDataList&&i.data.itemDataList.each((function(t){s.itemDataList.push(t)})),e.push(s)}else e.push({id:i.data.id,name:i.data.name,type:i.data.type})}.bind(this)),this.currentTab===this.appCategoryTab?this.menuData.appList=e:this.currentTab===this.processCategoryTab?this.menuData.processList=e:this.currentTab===this.inforCategoryTab?this.menuData.inforList=e:this.currentTab===this.queryCategoryTab&&(this.menuData.queryList=e),this.layout.menuData=this.menuData},setScroll:function(){o2.require("o2.widget.ScrollBar",function(){this.appScrollBar=new o2.widget.ScrollBar(this.appScrollNode,{style:"xDesktop_Message",where:"before",indent:!1,distance:100,friction:6,axis:{x:!1,y:!0}})}.bind(this))},loadTitle:function(){this.lnkTitleNode.set("text",o2.LP.desktop.lnkAppTitle),this.appCategoryTab=new Element("div.layout_start_tab",{text:o2.LP.desktop.message.application}).inject(this.appTitleNode),this.processCategoryTab=new Element("div.layout_start_tab",{text:o2.LP.desktop.message.process}).inject(this.appTitleNode),this.inforCategoryTab=new Element("div.layout_start_tab",{text:o2.LP.desktop.message.infor}).inject(this.appTitleNode),this.queryCategoryTab=new Element("div.layout_start_tab",{text:o2.LP.desktop.message.query}).inject(this.appTitleNode),this.refreshAreaNode=new Element("div.layout_start_search",{title:o2.LP.desktop.message.refreshMenu}).inject(this.appTitleNode),this.refreshNode=new Element("div.layout_start_search_icon").inject(this.refreshAreaNode),this.refreshNode.addClass("icon_startMenu_refresh"),this.searchNode=new Element("div.layout_start_search").inject(this.appTitleNode),this.searchIconNode=new Element("div.layout_start_search_icon").inject(this.searchNode),this.searchIconNode.addClass("icon_startMenu_search");var t=this.searchNode.getSize().x;this.searchNode.store("currentWidth",t),this.appCategoryTab.addEvent("click",function(){this.appTitleNode.getElements(".layout_start_tab").removeClass("mainColor_bg"),this.appCategoryTab.addClass("mainColor_bg"),this.currentTab=this.appCategoryTab,this.loadApplications()}.bind(this)),this.processCategoryTab.addEvent("click",function(){this.appTitleNode.getElements(".layout_start_tab").removeClass("mainColor_bg"),this.processCategoryTab.addClass("mainColor_bg"),this.currentTab=this.processCategoryTab,this.loadProcesses()}.bind(this)),this.inforCategoryTab.addEvent("click",function(){this.appTitleNode.getElements(".layout_start_tab").removeClass("mainColor_bg"),this.inforCategoryTab.addClass("mainColor_bg"),this.currentTab=this.inforCategoryTab,this.loadInfors()}.bind(this)),this.queryCategoryTab.addEvent("click",function(){this.appTitleNode.getElements(".layout_start_tab").removeClass("mainColor_bg"),this.queryCategoryTab.addClass("mainColor_bg"),this.currentTab=this.queryCategoryTab,this.loadQuerys()}.bind(this)),this.searchIconNode.addEvent("click",this.searchIconAction.bind(this)),this.refreshNode.addEvent("click",function(t){var e=this;MWF.xDesktop.confirm("infor",t,o2.LP.desktop.defaultMenuTitle,o2.LP.desktop.defaultMenuInfor,420,100,(function(){e.defaultMenu(),this.close()}),(function(){this.close()}),null,null,"o2")}.bind(this))},searchIconAction:function(){this.isMorph||(this.isSearch?this.doSearch():this.loadSearch())},loadSearch:function(){this.isSearch=!0,this.searchNode.addClass("mainColor_border"),this.appCategoryTab.hide(),this.processCategoryTab.hide(),this.inforCategoryTab.hide(),this.queryCategoryTab.hide(),this.refreshAreaNode.hide();var t=this.appTitleNode.getSize(),e=this.appTitleNode.getStyle("padding-right").toInt()||0,i=this.appTitleNode.getStyle("padding-left").toInt()||0,s=this.searchNode.getStyle("margin-right").toInt()||0,o=t.x-2*s-e-i;this.isMorph=!0,this.searchNode.set("morph",{duration:200}),this.searchNode.morph({width:o+"px"}),window.setTimeout(function(){this.isMorph=!1}.bind(this),220),this.searchClearNode||(this.searchClearNode=new Element("div.layout_start_search_clear").inject(this.searchNode),this.searchClearNode.addClass("icon_clear"),this.searchClearNode.addEvent("click",this.hideSearch.bind(this))),this.searchClearNode.show(),this.searchAreaNode||(this.searchAreaNode=new Element("div.layout_start_search_area").inject(this.searchNode)),this.searchAreaNode.show(),this.searchInputNode||(this.searchInputNode=new Element("input.layout_start_search_input",{placeholder:o2.LP.searchKey}).inject(this.searchAreaNode),this.searchInputNode.addEvent("keydown",function(t){13==t.code&&this.doSearch()}.bind(this))),this.searchInputNode.show(),this.searchInputNode.focus()},hideSearch:function(){if(this.isSearch){this.searchInputNode&&(this.searchInputNode.set("value",""),this.searchInputNode.hide()),this.searchAreaNode&&this.searchAreaNode.hide(),this.searchClearNode&&this.searchClearNode.hide(),this.isMorph=!0;var t=this.searchNode.retrieve("currentWidth");this.searchNode.morph({width:t+"px"}),window.setTimeout(function(){this.currentTab&&this.isSearchResult&&this.currentTab.click(),this.searchNode.removeClass("mainColor_border"),this.appCategoryTab.show(),this.processCategoryTab.show(),this.inforCategoryTab.show(),this.queryCategoryTab.show(),this.refreshAreaNode.show(),this.isSearch=!1,this.isMorph=!1,this.isSearchResult=!1}.bind(this),220)}},doSearch:function(){var t=this.searchInputNode.get("value").toLowerCase();t&&(this.isSearchResult=!0,this.appContentNode.empty(),this.searchApplicatins(t),this.searchProcesses(t),this.searchInfors(t),this.searchQuerys(t))},searchApplicatins:function(t){var e=this.layout.session.user,i=[e.name,e.distinguishedName,e.id,e.unique];e.roleList&&(i=i.concat(e.roleList)),e.groupList&&(i=i.concat(e.groupList)),this.layoutJson&&this.layoutJson.length&&this.layoutJson.each(function(e){this.checkMenuItem(e,i)&&(-1===e.title.toPYFirst().toLowerCase().indexOf(t)&&-1===e.title.toPY().toLowerCase().indexOf(t)&&-1===e.title.indexOf(t)||this.createApplicationMenuItem(e))}.bind(this)),this.componentJson&&this.componentJson.length&&this.componentJson.each(function(e){this.checkMenuItem(e,i)&&(-1===e.title.toPYFirst().toLowerCase().indexOf(t)&&-1===e.title.toPY().toLowerCase().indexOf(t)&&-1===e.title.indexOf(t)||this.createApplicationMenuItem(e))}.bind(this)),this.portalJson&&this.portalJson.length&&this.portalJson.each(function(e){-1===e.name.toPYFirst().toLowerCase().indexOf(t)&&-1===e.name.toPY().toLowerCase().indexOf(t)&&-1===e.name.indexOf(t)||this.createPortalMenuItem(e)}.bind(this))},searchProcesses:function(t){this.processJson&&this.processJson.length&&this.processJson.each(function(e){-1===e.name.toPYFirst().toLowerCase().indexOf(t)&&-1===e.name.toPY().toLowerCase().indexOf(t)&&-1===e.name.indexOf(t)||this.createProcessMenuItem(e)}.bind(this))},searchInfors:function(t){this.inforJson&&this.inforJson.length&&this.inforJson.each(function(e){-1===e.appName.toPYFirst().toLowerCase().indexOf(t)&&-1===e.appName.toPY().toLowerCase().indexOf(t)&&-1===e.appName.indexOf(t)||this.createInforMenuItem(e)}.bind(this))},searchQuerys:function(t){this.queryJson&&this.queryJson.length&&this.queryJson.each(function(e){-1===e.name.toPYFirst().toLowerCase().indexOf(t)&&-1===e.name.toPY().toLowerCase().indexOf(t)&&-1===e.name.indexOf(t)||this.createQueryMenuItem(e)}.bind(this))},loadJsons:function(t){this.clearAppContentNode(),this.loadLayoutApplications(function(e){var i=o2.Actions.get("x_component_assemble_control"),s=o2.Actions.get("x_portal_assemble_surface"),o=o2.Actions.get("x_processplatform_assemble_surface"),n=o2.Actions.get("x_cms_assemble_control"),a=o2.Actions.get("x_query_assemble_surface");this.layout.path;this.getIconsJson(function(){o2.Actions.invokeAsync([{action:i,name:"listComponent"},{action:s,name:"listApplication"},{action:o,name:"listApplication"},{action:n,name:"listColumn"},{action:a,name:"listQuery"}],{success:function(i,s,o,n,a){this.layoutJson=e,this.componentJson=i.data,this.portalJson=s.data,this.processJson=o.data,this.inforJson=n.data,this.queryJson=a.data,t&&t()}.bind(this),failure:function(){}})}.bind(this))}.bind(this))},getIconsJson:function(t){this.layout.iconsJson?t&&t():o2.JSON.get(iconsPath,function(e){this.layout.iconsJson=e,t&&t()}.bind(this))},setPosition:function(){o2.xDesktop.zIndexPool.zIndex;var t=0-this.node.getSize().x;this.maskNode.setStyles({left:t+"px"}),this.node.setStyles({left:t+"px"})},setSize:function(){this.appScrollBar&&this.appScrollBar.scrollVNode&&this.appScrollBar.scrollVNode.setStyle("margin-top","0px");var t=!1;this.lnkAreaNode.hide(),this.lineNode.hide();var e=this.node.getSize(),i=t?this.lnkAreaNode.getSize().y:0,s=t?this.lineNode.getSize().y:0,o=t&&this.lineNode.getStyle("margin-top").toInt()||0,n=t&&this.lineNode.getStyle("margin-bottom").toInt()||0,a=this.appTitleNode.getSize(),h=e.y-i-s-o-n-a.y;this.appScrollNode.setStyle("height",h+"px")},loadLnks:function(){this.lnkAreaNode.hide(),this.lineNode.hide()},createLnkMenuItem:function(){},clearAppContentNode:function(){this.appContentNode.empty(),this.appContentNode.addClass("icon_loading")},loadApplications:function(t){this.clearAppContentNode(),this.loadApplicationsItem(this.layoutJson,this.componentJson,this.portalJson)},loadLayoutApplications:function(t){var e=this.layout.path+"applications.json";o2.getJSON(e,function(e){t&&t(e)}.bind(this))},loadApplicationsItem:function(t,e,i){var s=this.layout.session.user,o=[s.name,s.distinguishedName,s.id,s.unique];s.roleList&&(o=o.concat(s.roleList)),s.groupList&&(o=o.concat(s.groupList));var n=Array.clone(t),a=Array.clone(e),h=Array.clone(i);this.appContentNode.removeClass("icon_loading"),this.menuData&&this.menuData.appList&&this.menuData.appList.length&&this.menuData.appList.each(function(t){if("group"===t.type)this.createGroupMenuItem(t),t.itemDataList.each(function(t){var e=n.find((function(e){return e.id===t.id}));e&&n.erase(e),(e=a.find((function(e){return e.id===t.id})))&&a.erase(e),(e=h.find((function(e){return e.id===t.id})))&&h.erase(e)}.bind(this));else{var e=null;!e&&n&&n.length&&(e=n.find((function(e){return e.id===t.id})))&&(n.erase(e),this.checkMenuItem(e,o)&&this.createApplicationMenuItem(e)),!e&&a&&a.length&&(e=a.find((function(e){return e.id===t.id})))&&(a.erase(e),this.checkMenuItem(e,o)&&this.createApplicationMenuItem(e)),!e&&h&&h.length&&(e=h.find((function(e){return e.id===t.id})))&&(h.erase(e),e.type="portal",this.createPortalMenuItem(e))}}.bind(this)),n&&n.length&&n.each(function(t){this.checkMenuItem(t,o)&&this.createApplicationMenuItem(t)}.bind(this)),a&&a.length&&a.each(function(t){this.checkMenuItem(t,o)&&this.createApplicationMenuItem(t)}.bind(this)),h&&h.length&&h.each(function(t){t.type="portal",this.createPortalMenuItem(t)}.bind(this))},loadProcesses:function(){this.clearAppContentNode(),this.loadProcessesItem(this.processJson)},loadProcessesItem:function(t){this.appContentNode.removeClass("icon_loading");var e=Array.clone(t);this.menuData&&this.menuData.processList&&this.menuData.processList.length&&this.menuData.processList.each(function(t){if("group"===t.type)this.createGroupMenuItem(t),t.itemDataList.each(function(t){var i=e.find((function(e){return e.id===t.id}));i&&e.erase(i)}.bind(this));else{var i=null;!i&&e&&e.length&&(i=e.find((function(e){return e.id===t.id})))&&(e.erase(i),i.type="process",this.createProcessMenuItem(i))}}.bind(this)),e&&e.length&&e.each(function(t){t.type="process",this.createProcessMenuItem(t)}.bind(this))},loadInfors:function(){this.clearAppContentNode(),this.loadInforsItem(this.inforJson)},loadInforsItem:function(t){this.appContentNode.removeClass("icon_loading");var e=Array.clone(t);this.menuData&&this.menuData.inforList&&this.menuData.inforList.length&&this.menuData.inforList.each(function(t){if("group"===t.type)this.createGroupMenuItem(t),t.itemDataList.each(function(t){var i=e.find((function(e){return e.id===t.id}));i&&e.erase(i)}.bind(this));else{var i=null;!i&&e&&e.length&&(i=e.find((function(e){return e.id===t.id})))&&(e.erase(i),i.type="cms",this.createInforMenuItem(i))}}.bind(this)),e&&e.length&&e.each(function(t){t.type="cms",this.createInforMenuItem(t)}.bind(this))},loadQuerys:function(){this.clearAppContentNode(),this.loadQuerysItem(this.queryJson)},loadQuerysItem:function(t){this.appContentNode.removeClass("icon_loading");var e=Array.clone(t);this.menuData&&this.menuData.queryList&&this.menuData.queryList.length&&this.menuData.queryList.each(function(t){if("group"===t.type)this.createGroupMenuItem(t),t.itemDataList.each(function(t){var i=e.find((function(e){return e.id===t.id}));i&&e.erase(i)}.bind(this));else{var i=null;!i&&e&&e.length&&(i=e.find((function(e){return e.id===t.id})))&&(e.erase(i),i.type="query",this.createQueryMenuItem(i))}}.bind(this)),e&&e.length&&e.each(function(t){t.type="query",this.createQueryMenuItem(t)}.bind(this))},checkMenuItem:function(t,e){if(!1===t.visible)return!1;var i=!0;t.allowList&&(i=!t.allowList.length||t.allowList.isIntersect(e));var s=!1;return t.denyList&&(s=!!t.denyList.length&&t.denyList.isIntersect(e)),!s&&i||o2.AC.isAdministrator()},createApplicationMenuItem:function(t){this.items.push(new o2.xDesktop.Default.StartMenu.Item(this,this.appContentNode,t))},createPortalMenuItem:function(t){this.items.push(new o2.xDesktop.Default.StartMenu.PortalItem(this,this.appContentNode,t))},createProcessMenuItem:function(t){this.items.push(new o2.xDesktop.Default.StartMenu.ProcessItem(this,this.appContentNode,t))},createInforMenuItem:function(t){this.items.push(new o2.xDesktop.Default.StartMenu.InforItem(this,this.appContentNode,t))},createQueryMenuItem:function(t){this.items.push(new o2.xDesktop.Default.StartMenu.QueryItem(this,this.appContentNode,t))},createGroupMenuItem:function(t){this.items.push(new o2.xDesktop.Default.StartMenu.GroupItem(this,this.appContentNode,t))},show:function(){if(!this.isMorph){this.isMorph=!0,this.morph||(this.maskMorph=new Fx.Morph(this.maskNode,{duration:"200",transition:Fx.Transitions.Sine.easeOut}),this.morph=new Fx.Morph(this.node,{duration:"200",transition:Fx.Transitions.Sine.easeOut})),this.maskNode.setStyles({display:"block"}),this.node.setStyles({display:"block"}),this.triangleNode.setStyles({display:"block"}),this.appAreaNode.setStyles({filter:""}),this.setSize(),this.setPosition();var t=this.layout.menuNode.getSize().x;this.loadJsons(function(){(this.currentTab||this.appCategoryTab).click()}.bind(this)),this.maskMorph.start({left:t+"px"}),this.morph.start({left:t+"px"}).chain(function(){this.isShow=!0,this.isMorph=!1,this.layout.desktopNode.addEvent("mousedown",this.hideMessage),this.setScroll(),this.fireEvent("show")}.bind(this))}},hide:function(t){if(!this.isMorph){this.isMorph=!0,this.morph||(this.maskMorph=new Fx.Morph(this.maskNode,{duration:"200",transition:Fx.Transitions.Sine.easeOut}),this.morph=new Fx.Morph(this.node,{duration:"200",transition:Fx.Transitions.Sine.easeOut}));var e=0-this.node.getSize().x;this.isSearchResult=!1,this.hideSearch(),this.lnkContentNode.empty(),this.appContentNode.empty(),this.groupMenuArea.empty(),this.appScrollBar&&this.appScrollBar.destroy(),this.maskMorph.start({left:e+"px"}).chain(function(){this.maskNode.setStyle("display","none"),this.triangleNode.setStyles({display:"none"})}.bind(this)),this.morph.start({left:e+"px"}).chain(function(){this.node.setStyle("display","none"),this.isShow=!1,this.isMorph=!1,this.layout.desktopNode.removeEvent("mousedown",this.hideMessage),this.fireEvent("hide"),t&&t()}.bind(this))}},defaultMenu:function(){this.layout.menuData=null,this.layout.status&&(this.layout.status.menuData=null),this.menuData=null,this.hide()}}),o2.xDesktop.Default.StartMenu.Item=new Class({initialize:function(t,e,i,s){this.menu=t,this.layout=this.menu.layout,this.data=i,this.container=$(e),this.load(s),this.init()},load:function(t){this.node=new Element("div.layout_start_item"),t?this.node.inject(t,"before"):this.node.inject(this.container),this.node.set("html",this.menu.itemTempletedHtml),this.iconAreaNode=this.node.getElement(".layout_start_item_iconArea"),this.iconNode=this.node.getElement(".layout_start_item_icon"),this.badgeNode=this.node.getElement(".layout_start_item_badge"),this.textNode=this.node.getElement(".layout_start_item_text"),this.loadIcon(),this.loadBadge(),this.loadText(),this.setEvent(),this.node.store("item",this),this.menu.data&&"group"===this.menu.data.type&&this.node.addClass("layout_start_item_sub")},init:function(){},dragOver:function(){this.overNode||(this.overNode=new Element("div.layout_start_item_over").inject(this.container),this.overNode.addClass("mainColor_bg")),this.overNode.position({relativeTo:this.iconAreaNode,position:"leftTop",edge:"leftTop",offset:{x:-6,y:-6}}),this.overNode.show()},dragOut:function(){this.overNode&&this.overNode.hide()},loadIcon:function(){var t,e="";"@url"===this.data.path.substring(0,4)?this.data.iconPath?t=this.data.iconPath:this.layout.iconsJson.Url&&this.layout.iconsJson.Url.icon?(t=this.layout.path+"appicons/"+this.layout.iconsJson.Url.icon,e=this.layout.iconsJson.Url.color):(t="../x_component_Setting/$Main/default/icon/site.png",e=""):this.layout.iconsJson[this.data.path]&&this.layout.iconsJson[this.data.path].icon?(t=this.layout.path+"appicons/"+this.layout.iconsJson[this.data.path].icon,e=this.layout.iconsJson[this.data.path].color):(t="../x_component_"+this.data.path.replace(/\./g,"_")+"/$Main/"+this.data.iconPath,e=""),t&&e&&(this.iconNode.addClass("layout_start_item_icon_flat"),this.iconNode.setStyle("background-color",e)),this.iconNode.setStyle("background-image","url("+t+")"),this.icon=t,this.bgcolor=e},loadBadge:function(){this.badgeNode.set("title",o2.LP.desktop.addLnk).addClass("icon_add_red")},loadText:function(){if(this.data.path){var t=this.data.path.split("."),e=o2.xApplication;t.each((function(t){e[t]||(e[t]={}),e=e[t]})),o2.xDesktop.requireApp(this.data.path,"lp."+o2.language,{onSuccess:function(){e.LP&&e.LP.title?this.textNode.set("text",e.LP.title):this.textNode.set("text",this.data.title||this.data.name)}.bind(this),onFailure:function(){this.textNode.set("text",this.data.title||this.data.name)}.bind(this)},!1)}else this.textNode.set("text",this.data.title)},setEvent:function(){this.node.addEvents({mouseover:function(){this.badgeNode.fade("in")}.bind(this),mouseout:function(){this.badgeNode.fade("out")}.bind(this),click:function(t){this.open(t)}.bind(this)}),this.badgeNode.addEvent("click",function(t){this.addLnk(),t.stopPropagation()}.bind(this)),this.makeLnk()},addLnk:function(t,e){lnkdata={name:this.data.path,title:this.data.title,iconData:this.data.iconData||null,icon:this.iconData||null,appType:null,options:null},this.layout.addLnk(lnkdata,t,e)},open:function(t){this.menu.hide(function(){this.menu.menu?this.menu.menu.hide(function(){layout.openApplication(t,this.data.path)}.bind(this)):layout.openApplication(t,this.data.path)}.bind(this))},makeLnk:function(){var t=new Drag(this.node,{stopPropagation:!0,compensateScroll:!0,onStart:function(e,i){this.doDragMove(i),t.stop()}.bind(this)})},getDragNode:function(){if(!this.dragNode){this.dragNode=new Element("div.layout_menu_lnk_item_drag").setStyle("z-index",o2.xDesktop.zIndexPool.applyZindex()).inject(this.layout.node);var t=this.iconNode.clone(!0).inject(this.dragNode).removeClass("layout_menu_lnk_item_icon").addClass("layout_menu_lnk_item_icon_drag");this.bgcolor&&t.setStyle("background-color",this.bgcolor)}var e=this.iconNode.getPosition(this.dragNode.getOffsetParent());this.dragNode.show().setStyles({left:e.x+"px",top:e.y+"px"})},doDragMove:function(t){this.getDragNode();var e=[this.layout.lnkContentNode,this.menu.appContentNode];this.menu.appContentNode.hasClass("layout_start_groupItem_menu_content")&&(this.onGroup=!0),new Drag.Move(this.dragNode,{stopPropagation:!0,compensateScroll:!0,droppables:e,onStart:function(t){this._drag_start(t)}.bind(this),onDrag:function(t,e){this._drag_drag(t,e)}.bind(this),onEnter:function(t,e){this._drag_enter(t,e)}.bind(this),onLeave:function(t,e){this._drag_leave(t,e)}.bind(this),onDrop:function(t,e){this._drag_drop(t,e)}.bind(this),onCancel:function(t){this._drag_cancel(t)}.bind(this),onComplete:function(t,e){this._drag_complete(t,e)}.bind(this)}).start(t),this.dragStatus},_drag_start:function(t){this.isDrag=!0,this.dragTargetLnk=null,this.dragPosition="before",this.node.setStyle("opacity",.2),this.positionFlagNode=new Element("div",{styles:{display:"none"}}).inject(this.node,"after")},_drag_drag:function(t,e){if(console.log(this.dragStatus),"order"==this.dragStatus&&this.layout.lnks&&this.layout.lnks.length){for(var i=e.page.y,s=0;s<this.layout.lnks.length;s++){var o=this.layout.lnks[s],n=o.node.getSize().y,a=o.node.getPosition(this.layout.node).y,h=a+n/2,d=a+n;if(a<=i&&h>=i){this.dragTargetLnk=o,this.dragPosition="before";break}if(h<=i&&d>=i){this.dragTargetLnk=o,this.dragPosition="after";break}}this.layout.positionNode||(this.layout.positionNode=new Element("div.layout_menu_lnk_item_position").setStyle("z-index",o2.xDesktop.zIndexPool.applyZindex()).inject(this.layout.node)),this.layout.positionNode.show(),this.dragTargetLnk||(this.dragTargetLnk=this.layout.lnks[this.layout.lnks.length-1],this.dragPosition="after"),this.layout.positionNode.position({relativeTo:this.dragTargetLnk.node,position:"before"==this.dragPosition?"topcenter":"bottomcenter",edge:"center"})}"group"==this.dragStatus&&(this.onGroup||this.checkDargOver(t),this.overItem||this.checkDargPosition(t))},checkDargOver:function(t){var e=t.getPosition(),i=t.getSize(),s=e.x+i.x/2-1,o=e.y+i.y/2-1,n=s+2,a=o+2,h=null;this.menu.items.each((function(t){t.isDrag||(t.iconAreaNode.isInPointInRect(s,o,n,a)?(t.dragOver(),h=t):t.dragOut())})),this.overItem=h},checkDargPosition:function(t){for(var e=t.getPosition(),i=t.getSize(),s={x:e.x+i.x-2,y:e.y+i.y/2-1,ex:e.x+i.x,ey:e.y+i.y/2+1},o={x:e.x,y:e.y+i.y/2-1,ex:e.x+2,ey:e.y+i.y/2+1},n=0;n<this.menu.items.length;n++){var a=this.menu.items[n];if(!a.isDrag){if(a.iconAreaNode.isInPointInRect(s.x,s.y,s.ex,s.ey)){!0,this.node.inject(a.node,"before");break}if(a.iconAreaNode.isInPointInRect(o.x,o.y,o.ex,o.ey)){!0,this.node.inject(a.node,"after");break}}}},_drag_enter:function(t,e){e.hasClass("layout_start_content_appContent")||e.hasClass("layout_start_groupItem_menu_content")?(this.dragStatus="group",this.node.setStyle("opacity",.2)):(this.positionFlagNode&&this.node.inject(this.positionFlagNode,"before"),this.dragStatus="order",this.node.setStyle("opacity",1))},_drag_leave:function(t,e){console.log("_drag_leave"),e.hasClass("layout_start_content_appContent")||(e.hasClass("layout_start_groupItem_menu_content")?(this.dragStatus="ungroup",this.node.setStyle("opacity",0)):(this.dragStatus="remove",this.layout.positionNode&&this.layout.positionNode.hide()))},_drag_drop:function(t,e){"ungroup"===this.dragStatus?this.removeFormGroup():("order"==this.dragStatus&&this.dragTargetLnk&&this.dragTargetLnk!=this?this.addLnk(this.dragTargetLnk,this.dragPosition):"group"==this.dragStatus&&this.overItem&&this.overItem!=this&&(this.overItem.dragOut(),this.addGroup()),this.node.setStyle("opacity",1)),this.menu.resetMenuData()},_drag_cancel:function(t){console.log("_drag_cancel"),t.hide(),this.layout.positionNode&&this.layout.positionNode.hide(),this.dragRemoveNode&&this.dragRemoveNode.hide(),this.node.setStyle("opacity",1),this.isDrag=!1,this.menu.resetMenuData()},_drag_complete:function(t){this._drag_cancel(t),this.positionFlagNode&&this.positionFlagNode.destroy(),this.positionFlagNode=null},removeFormGroup:function(){switch(this.menu.data.itemDataList.erase(this.data),this.data.type){case"portal":this.layout.startMenu.createPortalMenuItem(this.data);break;case"process":this.layout.startMenu.createProcessMenuItem(this.data);break;case"cms":this.layout.startMenu.createInforMenuItem(this.data);break;case"query":this.layout.startMenu.createQueryMenuItem(this.data);break;default:this.layout.startMenu.createApplicationMenuItem(this.data)}this.destroy(),this.menu.data.itemDataList.length?this.menu.resetSubItemIcon():this.menu.hide(function(){this.menu.destroy()}.bind(this))},addGroup:function(){if("group"===this.overItem.data.type)this.overItem.addItem(this.data);else{var t=new o2.xDesktop.Default.StartMenu.GroupItem(this.menu,this.container,{name:"Group",title:"Group",type:"group",visible:!0},this.overItem.node);t.addItem(this.overItem.data),t.addItem(this.data),this.menu.items.push(t),this.overItem.node.destroy(),t.open(null,(function(){t.editTitle()}))}this.node.destroy(),this.menu.resetMenuData()},destroy:function(){this.menu.items.erase(this),this.node.destroy()}}),o2.xDesktop.Default.StartMenu.GroupItem=new Class({Extends:o2.xDesktop.Default.StartMenu.Item,loadIcon:function(){this.iconNode.addClass("layout_start_item_icon_group"),this.iconNode.addClass("grayColor_bg"),this.sunIconNodes=[];var t=new Element("div.layout_start_item_icon_group_sub").inject(this.iconNode);this.sunIconNodes.push(t),t=new Element("div.layout_start_item_icon_group_sub").inject(this.iconNode),this.sunIconNodes.push(t),t=new Element("div.layout_start_item_icon_group_sub").inject(this.iconNode),this.sunIconNodes.push(t),t=new Element("div.layout_start_item_icon_group_sub").inject(this.iconNode),this.sunIconNodes.push(t)},init:function(){if(this.itemTempletedHtml=this.menu.itemTempletedHtml,this.data.itemDataList&&this.data.itemDataList.length)for(var t=0;t<Math.min(this.data.itemDataList.length,4);t++)this.setSubItemIcon(this.data.itemDataList[t],this.sunIconNodes[t])},resetSubItemIcon:function(){if(this.sunIconNodes.each((function(t){t.setStyle("background-image",""),t.setStyle("background-color","")})),this.data.itemDataList&&this.data.itemDataList.length)for(var t=0;t<Math.min(this.data.itemDataList.length,4);t++)this.setSubItemIcon(this.data.itemDataList[t],this.sunIconNodes[t])},open:function(t,e){this.menuNode||this.createMenuNode(),this.maskNode=new Element("div.layout_start_groupItem_menuMask").inject(this.menuNode,"before"),this.maskNode.addEvent("click",function(t){this.hide()}.bind(this)),this.maskGroupNode=this.maskNode,this.menuNode.show();var i=this.getMenuNodeOpenDimensions();this.menuNode.morph.set("transition",Fx.Transitions.Quart.easeOut),this.menuNode.morph.start(i).chain(function(){this.menuTitleNode.show(),this.menuScrollNode.show();var t=this.menuNode.getSize(),i=this.menuTitleNode.getSize(),s=t.y-i.y;this.menuContentNode.setStyle("height",s+"px"),this.loadItems(),e&&e()}.bind(this)),this.menu.appAreaNode.setStyles({filter:"blur(5px)"})},hide:function(t){this.menuTitleNode.hide(),this.menuScrollNode.hide();var e=this.getMenuNodeCloseDimensions();this.menuNode.morph.set("transition",Fx.Transitions.Quart.easeIn),this.menuNode.morph.start(e).chain(function(){this.maskNode&&this.maskNode.destroy(),this.menuNode&&this.menuNode.hide(),t&&t()}.bind(this)),this.menu.appAreaNode.setStyles({filter:""})},loadItems:function(){this.items||(this.items=[]),this.data.itemDataList.each(function(t){if(!this.items.find((function(e){return e.data.id==t.id})))switch(t.type){case"portal":this.items.push(new o2.xDesktop.Default.StartMenu.PortalItem(this,this.menuContentNode,t));break;case"process":this.items.push(new o2.xDesktop.Default.StartMenu.ProcessItem(this,this.menuContentNode,t));break;case"cms":this.items.push(new o2.xDesktop.Default.StartMenu.InforItem(this,this.menuContentNode,t));break;case"query":this.items.push(new o2.xDesktop.Default.StartMenu.QueryItem(this,this.menuContentNode,t));break;default:this.items.push(new o2.xDesktop.Default.StartMenu.Item(this,this.menuContentNode,t))}}.bind(this))},getMenuNodeOpenDimensions:function(){var t=this.menu.appAreaNode.getSize();return{width:.94*t.x,height:.7*t.y,left:t.x*(1-.94)/2,top:t.y*(1-.7)/2}},getMenuNodeCloseDimensions:function(){var t=this.iconNode.getSize(),e=this.iconNode.getPosition(this.menu.node);return{width:t.x,height:t.y,left:e.x,top:e.y}},createMenuNode:function(){this.menuNode=new Element("div.layout_start_groupItem_menu").inject(this.menu.groupMenuArea),this.menuNode.addClass("grayColor_bg"),this.menuTitleNode=new Element("div.layout_start_groupItem_menu_title").inject(this.menuNode),this.menuTitleNode.set("text",this.data.name),this.menuScrollNode=new Element("div.layout_start_groupItem_menu_scroll").inject(this.menuNode),this.menuContentNode=new Element("div.layout_start_groupItem_menu_content").inject(this.menuScrollNode),this.appContentNode=this.menuContentNode,this.menuNode.position({relativeTo:this.iconNode,position:"upperLeft",edge:"upperLeft"}),this.menuNode.morph=new Fx.Morph(this.menuNode,{duration:200,transition:Fx.Transitions.Quart.easeOut}),this.menuTitleNode.addEvent("click",function(){this.menuTitleNode.getElement("input")||this.editTitle()}.bind(this)),o2.require("o2.widget.ScrollBar",function(){this.appScrollBar=new o2.widget.ScrollBar(this.menuContentNode,{style:"xDesktop_Message",where:"before",indent:!1,distance:100,friction:6,axis:{x:!1,y:!0}})}.bind(this))},destroy:function(){this.menu.items.erase(this),this.node.destroy(),this.menuNode.destroy()},editTitle:function(){this.menuTitleNode.empty(),this.editotTitleNode=new Element("input.layout_start_groupItem_menu_title_edit",{type:"text"}).inject(this.menuTitleNode),this.editotTitleNode.set("value",this.data.name),this.editotTitleNode.focus(),this.editotTitleNode.addEvent("blur",function(){var t=this.editotTitleNode.get("value");t&&(this.data.name=t),this.data.title=this.data.name,this.menuTitleNode.empty(),this.menuTitleNode.set("text",this.data.name),this.loadText()}.bind(this))},addItem:function(t){this.data.itemDataList||(this.data.itemDataList=[]),this.data.itemDataList.length<4&&this.setSubItemIcon(t,this.sunIconNodes[this.data.itemDataList.length]),this.data.itemDataList.push(t)},setSubItemIcon:function(t,e){switch(t.type){case"process":this.setAppSubItemIcon(e,t.icon,"processDefault","../x_component_process_ApplicationExplorer/$Main/default/icon/application.png");break;case"portal":this.setAppSubItemIcon(e,t.icon,"portalDefault","../x_component_portal_PortalExplorer/$Main/default/icon/application.png");break;case"cms":this.setAppSubItemIcon(e,t.icon,"cmsDefault","../x_component_cms_Index/$Main/default/icon/column.png");break;case"query":this.setAppSubItemIcon(e,t.icon,"queryDefault","../x_component_query_Query/$Main/appicon.png");break;default:this.setDefaultSubItemIcon(t,e)}},setAppSubItemIcon:function(t,e,i,s){var o="",n="";if(e)o="data:image/png;base64,"+e,n="",t.addClass("layout_start_item_icon_group_subIcon");else{var a=i;this.layout.iconsJson[a]&&this.layout.iconsJson[a].icon?(o=this.layout.path+"appicons/"+this.layout.iconsJson[a].icon,n=this.layout.iconsJson[a].color):(o=s,n="")}o&&n&&t.setStyle("background-color",n),t.setStyle("background-image","url("+o+")")},setDefaultSubItemIcon:function(t,e){var i,s="";"@url"===t.path.substring(0,4)?t.iconPath?i=t.iconPath:this.layout.iconsJson.Url&&this.layout.iconsJson.Url.icon?(i=this.layout.path+"appicons/"+this.layout.iconsJson.Url.icon,s=this.layout.iconsJson.Url.color):(i="../x_component_Setting/$Main/default/icon/site.png",s=""):this.layout.iconsJson[t.path]&&this.layout.iconsJson[t.path].icon?(i=this.layout.path+"appicons/"+this.layout.iconsJson[t.path].icon,s=this.layout.iconsJson[t.path].color):(i="../x_component_"+t.path.replace(/\./g,"_")+"/$Main/"+t.iconPath,s=""),i&&s&&e.setStyle("background-color",s),e.setStyle("background-image","url("+i+")")},resetMenuData:function(){var t=this.menuContentNode.getChildren(".layout_start_item"),e=[];t.each(function(t){var i=t.retrieve("item");i&&e.push(i.data)}.bind(this)),this.data.itemDataList=e}}),o2.xDesktop.Default.StartMenu.PortalItem=new Class({Extends:o2.xDesktop.Default.StartMenu.Item,loadIcon:function(){var t="",e="";if(this.data.icon)t="data:image/png;base64,"+this.data.icon;else{var i="portalDefault";this.layout.iconsJson[i]&&this.layout.iconsJson[i].icon?(t=this.layout.path+"appicons/"+this.layout.iconsJson[i].icon,e=this.layout.iconsJson[i].color):(t="../x_component_portal_PortalExplorer/$Main/default/icon/application.png",e="")}t&&e&&(this.iconNode.addClass("layout_start_item_icon_flat"),this.iconNode.setStyle("background-color",e)),this.iconNode.setStyle("background-image","url("+t+")"),this.icon=t},loadText:function(){this.textNode.set("text",this.data.name)},addLnk:function(t,e){var i={portalId:this.data.id,appId:"portal.Portal"+this.data.id};lnkdata={name:"portal.Portal",title:this.data.name,iconData:this.data.icon||"",icon:null,appType:"portal",options:i},this.layout.addLnk(lnkdata,t,e)},open:function(t){var e={portalId:this.data.id,appId:"portal.Portal"+this.data.id};this.menu.hide(function(){this.menu.menu?this.menu.menu.hide(function(){layout.openApplication(t,"portal.Portal",e)}.bind(this)):layout.openApplication(t,"portal.Portal",e)}.bind(this))}}),o2.xDesktop.Default.StartMenu.ProcessItem=new Class({Extends:o2.xDesktop.Default.StartMenu.PortalItem,loadIcon:function(){var t="",e="";if(this.data.icon)t="data:image/png;base64,"+this.data.icon,e="";else{var i="processDefault";this.layout.iconsJson[i]&&this.layout.iconsJson[i].icon?(t=this.layout.path+"appicons/"+this.layout.iconsJson[i].icon,e=this.layout.iconsJson[i].color):(t="../x_component_process_ApplicationExplorer/$Main/default/icon/application.png",e="")}t&&e&&(this.iconNode.addClass("layout_start_item_icon_flat"),this.iconNode.setStyle("background-color",e)),this.iconNode.setStyle("background-image","url("+t+")"),this.icon=t},addLnk:function(t,e){var i={id:this.data.id,appId:"process.Application"+this.data.id};lnkdata={name:"process.Application",title:this.data.name,iconData:this.data.icon||"",icon:null,appType:"process",options:i},this.layout.addLnk(lnkdata,t,e)},open:function(t){var e={id:this.data.id,appId:"process.Application"+this.data.id};this.menu.hide(function(){this.menu.menu?this.menu.menu.hide(function(){layout.openApplication(t,"process.Application",e)}.bind(this)):layout.openApplication(t,"process.Application",e)}.bind(this))}}),o2.xDesktop.Default.StartMenu.InforItem=new Class({Extends:o2.xDesktop.Default.StartMenu.PortalItem,loadIcon:function(){var t="",e="";if(this.data.appIcon)t="data:image/png;base64,"+this.data.appIcon,e="";else{var i="cmsDefault";this.layout.iconsJson[i]&&this.layout.iconsJson[i].icon?(t=this.layout.path+"appicons/"+this.layout.iconsJson[i].icon,e=this.layout.iconsJson[i].color):(t="../x_component_cms_Index/$Main/default/icon/column.png",e="")}t&&e&&(this.iconNode.addClass("layout_start_item_icon_flat"),this.iconNode.setStyle("background-color",e)),this.iconNode.setStyle("background-image","url("+t+")"),this.icon=t},loadText:function(){this.textNode.set("text",this.data.appName)},addLnk:function(t,e){lnkdata={name:"cms.Module",title:this.data.appName,iconData:this.data.appIcon||"",icon:null,appType:"cms",options:{columnData:this.data,appId:"cms.Module"+this.data.id}},this.layout.addLnk(lnkdata,t,e)},open:function(t){this.menu.hide(function(){this.menu.menu?this.menu.menu.hide(function(){layout.openApplication(t,"cms.Module",{columnData:this.data,appId:"cms.Module"+this.data.id})}.bind(this)):layout.openApplication(t,"cms.Module",{columnData:this.data,appId:"cms.Module"+this.data.id})}.bind(this))}}),o2.xDesktop.Default.StartMenu.QueryItem=new Class({Extends:o2.xDesktop.Default.StartMenu.PortalItem,loadIcon:function(){var t="",e="";if(this.data.icon)t="data:image/png;base64,"+this.data.icon,e="";else{var i="queryDefault";this.layout.iconsJson[i]&&this.layout.iconsJson[i].icon?(t=this.layout.path+"appicons/"+this.layout.iconsJson[i].icon,e=this.layout.iconsJson[i].color):(t="../x_component_query_Query/$Main/appicon.png",e="")}t&&e&&(this.iconNode.addClass("layout_start_item_icon_flat"),this.iconNode.setStyle("background-color",e)),this.iconNode.setStyle("background-image","url("+t+")"),this.icon=t},addLnk:function(){lnkdata={name:"query.Query",title:this.data.name,iconData:this.data.icon||"",icon:null,appType:"query",options:{id:this.data.id,appId:"query.Query"+this.data.id}},this.layout.addLnk(lnkdata,dragTargetLnk,dragPosition)},open:function(t){this.menu.hide(function(){this.menu.menu?this.menu.menu.hide(function(){layout.openApplication(t,"query.Query",{id:this.data.id,appId:"query.Query"+this.data.id})}.bind(this)):layout.openApplication(t,"query.Query",{id:this.data.id,appId:"query.Query"+this.data.id})}.bind(this))}}),o2.xDesktop.Default.TaskItem=new Class({initialize:function(t,e){this.desktop=t,this.container=this.desktop.taskContentNode,this.app=e,this.load()},load:function(){this.node=new Element("div.layout_content_taskbar_item").inject(this.container),this.iconNode=new Element("div"),this.closeNode=new Element("div.layout_content_taskbar_item_icon",{title:o2.LP.widget.close}).inject(this.node),this.closeNode.addClass("icon_close"),this.app.options.appId==this.desktop.options.index&&(this.closeNode.hide(),this.noCloseNode=!0),this.refreshNode=new Element("div.layout_content_taskbar_item_refresh",{title:o2.LP.widget.refresh}).inject(this.node),this.refreshNode.addClass("icon_refresh"),this.refreshNode.addClass("animation_taskItemLoading"),this.actionNode=new Element("div.layout_content_taskbar_item_action").inject(this.node),this.actionNode.addClass("icon_taskitem_down"),this.textNode=new Element("div.layout_content_taskbar_item_text").inject(this.node),this.setText(this.app.options.title),this.setEvent(),this.unSelected()},setEvent:function(){this.textNode.addEvents({click:function(){this.desktop.currentApp!=this.app&&(this.app.window?this.app.setCurrent():(this.desktop.apps[this.app.options.appId]=null,layout.openApplication(null,this.app.options.name,this.app.options,this.app.options.app,!1,this,!1)))}.bind(this),dblclick:function(){this.app.openInNewBrowser(this.app.options.appId==this.desktop.options.index)}.bind(this)}),this.closeNode.addEvents({mouseover:function(){}.bind(this),mouseout:function(){}.bind(this),click:function(){this.app.window?this.app.close():(this.desktop.apps[this.app.options.appId]=null,delete this.desktop.apps[this.app.options.appId],this.destroy())}.bind(this)}),this.refreshNode.addEvents({mouseover:function(){}.bind(this),mouseout:function(){}.bind(this),click:function(){this.app.refresh()}.bind(this)}),this.loadTaskItemMenu(),this.desktop&&this.desktop.checkTaskBarSize&&this.desktop.checkTaskBarSize()},loadTaskItemMenu:function(){this.taskitemMenu||(this.taskitemMenu=new o2.xDesktop.Menu(this.actionNode,{event:"click",style:"flatUser",offsetX:-10,offsetY:6,container:this.node}),this.taskitemMenu.load(),this.loadTaskItemMenuItems())},loadTaskItemMenuItems:function(){var t=this.desktop.path+this.desktop.options.style+"/icons/menu_refresh.png";this.taskitemMenu.addMenuItem(o2.LP.desktop.refresh,"click",function(t){this.app.refresh(t)}.bind(this),t),this.taskitemMenu.addMenuLine(),this.app.options.appId!==this.desktop.options.index&&(t=this.desktop.path+this.desktop.options.style+"/icons/menu_close.png",this.taskitemMenu.addMenuItem(o2.LP.desktop.close,"click",function(){this.app.window?this.app.close():(this.desktop.apps[this.app.options.appId]=null,delete this.desktop.apps[this.app.options.appId],this.destroy())}.bind(this),t)),t=this.desktop.path+this.desktop.options.style+"/icons/menu_closeall.png",this.taskitemMenu.addMenuItem(o2.LP.desktop.closeAll,"click",function(){var t=Array.clone(Object.keys(this.desktop.apps));t.each(function(t){layout.desktop.apps[t].isIndex||layout.desktop.apps[t].options.isIndex||layout.desktop.apps[t].close()}.bind(this)),t=null}.bind(this),t),t=this.desktop.path+this.desktop.options.style+"/icons/menu_closeother.png",this.taskitemMenu.addMenuItem(o2.LP.desktop.closeOther,"click",function(){var t=Array.clone(Object.keys(this.desktop.apps));t.each(function(t){this.desktop.apps[t].isIndex||this.desktop.apps[t].options.isIndex||this.desktop.apps[t].options.appId==this.app.options.appId||this.desktop.apps[t].close()}.bind(this)),t=null}.bind(this),t)},setText:function(t){this.textNode.set("text",t||this.app.options.title)},unSelected:function(){this.node.removeClass("mainColor_bg"),this.noCloseNode||(this.closeNode.addClass("icon_close"),this.closeNode.removeClass("icon_close_focus")),this.refreshNode&&this.refreshNode.hide(),this.actionNode&&this.actionNode.hide()},selected:function(){this.node.addClass("mainColor_bg"),this.noCloseNode||(this.closeNode.removeClass("icon_close"),this.closeNode.addClass("icon_close_focus")),this.desktop.checkTaskBarScrollTo(this.app),this.actionNode&&this.actionNode.show()},destroy:function(){this.iconNode.destroy(),this.node.destroy(),this.desktop&&this.desktop.checkTaskBarSize&&this.desktop.checkTaskBarSize(),this.app.options&&this.app.options.appId&&delete this.desktop.apps[this.app.options.appId],o2.release(this)},setTaskitemSize:function(){this.desktop.checkTaskBarSize(),this.desktop.checkTaskBarScrollTo()}}),o2.xDesktop.Default.Lnk=new Class({initialize:function(t,e,i,s){this.layout=t,this.container=this.layout.lnkAreaNode,this.data=e,this.load(i,s)},load:function(t,e){this.node=new Element("div.layout_menu_lnk_item"),t?(e||(e="before"),this.node.inject(t.node,e)):this.node.inject(this.container),this.iconNode=new Element("div.layout_menu_lnk_item_icon").inject(this.node),this.textNode=new Element("div.layout_menu_lnk_item_text",{text:this.data.title}).inject(this.node),this.actionNode=new Element("div.layout_menu_lnk_item_action",{title:o2.LP.desktop.deleteLnk}).inject(this.node),this.actionNode.addClass("icon_off_light"),this.getIcon(function(t){this.iconNode.setStyle("background-image","url("+t+")"),this.setEvent()}.bind(this))},setEvent:function(){this.node.addEvents({click:function(){if("Homepage"==this.data.name){var t=this.data.name,e=this.data.options;if(layout.config.indexPage&&layout.config.indexPage.enable&&layout.config.indexPage.portal){t="portal.Portal";var i="portal.Portal"+layout.config.indexPage.portal;e={name:"portal.Portal",portalId:layout.config.indexPage.portal,pageId:layout.config.indexPage.page,appId:i}}layout.openApplication(null,t,e)}else layout.openApplication(null,this.data.name,this.data.options)}.bind(this),mouseover:function(){this.actionNode.fade("in"),this.node.addClass("overColor_bg"),this.textNode.fade("in")}.bind(this),mouseout:function(){this.actionNode.fade("out"),this.node.removeClass("overColor_bg"),this.textNode.fade("out")}.bind(this)}),this.actionNode.addEvents({click:function(t){this.destroy(),t.stopPropagation()}.bind(this),mouseover:function(){this.actionNode.addClass("layout_menu_lnk_item_action_shadow")}.bind(this),mouseout:function(){this.actionNode.removeClass("layout_menu_lnk_item_action_shadow")}.bind(this)});var t=new Drag(this.node,{stopPropagation:!0,compensateScroll:!0,onStart:function(e,i){this.doDragMove(i),t.stop()}.bind(this)})},getDragNode:function(){if(!this.dragNode){this.dragNode=new Element("div.layout_menu_lnk_item_drag").setStyle("z-index",o2.xDesktop.zIndexPool.applyZindex()).inject(this.layout.node);var t=this.iconNode.clone(!0).inject(this.dragNode).removeClass("layout_menu_lnk_item_icon").addClass("layout_menu_lnk_item_icon_drag"),e=this.data.appType?this.data.appType+"Default":this.data.name;this.layout.iconsJson[e]&&this.layout.iconsJson[e].color&&t.setStyle("background-color",this.layout.iconsJson[e].color),this.dragRemoveNode=new Element("div.layout_menu_lnk_item_icon_drag_del").inject(this.dragNode).addClass("icon_remove_badge").hide()}var i=this.iconNode.getPosition(this.dragNode.getOffsetParent());this.dragNode.show().setStyles({left:i.x+"px",top:i.y+"px"})},doDragMove:function(t){this.getDragNode(),new Drag.Move(this.dragNode,{stopPropagation:!0,compensateScroll:!0,droppables:[this.container.getParent()],onStart:function(){this._drag_start()}.bind(this),onDrag:function(t,e){this._drag_drag(t,e)}.bind(this),onEnter:function(t,e){this._drag_enter(t,e)}.bind(this),onLeave:function(t,e){this._drag_leave(t,e)}.bind(this),onDrop:function(t,e){this._drag_drop(t,e)}.bind(this),onCancel:function(t){this._drag_cancel(t)}.bind(this),onComplete:function(t,e){this._drag_complete(t,e)}.bind(this)}).start(t),this.dragStatus="order"},_drag_start:function(){this.node.addClass("overColor_bg"),this.node.addClass("opacity50"),this.dragTargetLnk=null,this.dragPosition="before"},_drag_drag:function(t,e){if("order"==this.dragStatus&&this.layout.lnks&&this.layout.lnks.length){for(var i=e.page.y,s=0;s<this.layout.lnks.length;s++){var o=this.layout.lnks[s],n=o.node.getSize().y,a=o.node.getPosition(this.layout.node).y,h=a+n/2,d=a+n;if(a<=i&&h>=i){this.dragTargetLnk=o,this.dragPosition="before";break}if(h<=i&&d>=i){this.dragTargetLnk=o,this.dragPosition="after";break}}this.layout.positionNode||(this.layout.positionNode=new Element("div.layout_menu_lnk_item_position").setStyle("z-index",o2.xDesktop.zIndexPool.applyZindex()).inject(this.layout.node)),this.layout.positionNode.show(),this.dragTargetLnk||(this.dragTargetLnk=this.layout.lnks[this.layout.lnks.length-1],this.dragPosition="after"),this.layout.positionNode.position({relativeTo:this.dragTargetLnk.node,position:"before"==this.dragPosition?"topcenter":"bottomcenter",edge:"center"})}},_drag_enter:function(){this.dragStatus="order",this.dragRemoveNode&&this.dragRemoveNode.hide()},_drag_leave:function(){this.dragStatus="remove",this.dragRemoveNode&&this.dragRemoveNode.show(),this.layout.positionNode&&this.layout.positionNode.hide()},_drag_drop:function(t,e){if("order"==this.dragStatus&&this.dragTargetLnk&&this.dragTargetLnk!=this){this.node.inject(this.dragTargetLnk.node,this.dragPosition),this.layout.lnks.erase(this);var i=this.layout.lnks.indexOf(this.dragTargetLnk);"before"==this.dragPosition?this.layout.lnks.splice(i,0,this):this.layout.lnks.splice(i+1,0,this)}},_drag_cancel:function(t){t.hide(),this.node&&(this.node.removeClass("overColor_bg"),this.node.removeClass("opacity50")),this.layout.positionNode&&this.layout.positionNode.hide(),this.dragRemoveNode&&this.dragRemoveNode.hide()},_drag_complete:function(t){"remove"==this.dragStatus?this.destroy():this._drag_cancel(t)},destroy:function(){this.layout.lnks.erase(this),this.dragNode&&this.dragNode.destroy(),this.node.destroy(),o2.release(this)},getIcon:function(t){if(this.data.icon)return this.data.icon;var e;if("@url"===this.data.name.substring(0,4))this.data.iconData?e="data:image/png;base64,"+this.data.iconData:this.data.iconPath?e=this.data.iconPath:o2.Actions.load("x_component_assemble_control").ComponentAction.get(this.data.title,function(i){e=i.data&&i.data.iconData?"data:image/png;base64,"+i.data.iconData:i.data&&i.data.iconPath?i.data.iconPath:this.layout.iconsJson.Url&&this.layout.iconsJson.Url.icon?this.layout.path+"appicons/"+this.layout.iconsJson.Url.icon:this.layout.path+"appicons/url.png",t&&t(e)}.bind(this),function(){e=this.layout.iconsJson.Url&&this.layout.iconsJson.Url.icon?this.layout.path+"appicons/"+this.layout.iconsJson.Url.icon:this.layout.path+"appicons/url.png",t&&t(e)}.bind(this));else{if(this.data.iconData)e="data:image/png;base64,"+this.data.iconData;else if(this.data.iconPath)e=this.data.iconPath;else{var i=this.data.appType?this.data.appType+"Default":this.data.name;e=this.layout.iconsJson[i]&&this.layout.iconsJson[i].icon?this.layout.path+"appicons/"+this.layout.iconsJson[i].icon:"../x_component_"+this.data.name.replace(/\./g,"_")+"/$Main/appicon.png"}t&&t(e)}return e}}),o2.xDesktop.zIndexPool={zIndex:102,applyZindex:function(){var t=this.zIndex;return this.zIndex=this.zIndex+2,t}};