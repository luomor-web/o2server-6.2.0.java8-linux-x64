MWF.xAction.RestActions.Action.x_portal_assemble_designer=new Class({Extends:MWF.xAction.RestActions.Action,getUUID:function(e,i){var a=!1!==i,n="";return this.action.invoke({name:"getId",async:a,parameter:{count:"1"},success:function(i){n=i.data[0].id,e&&e(n)},failure:null}),n},listApplicationSummary:function(e,i,a,n){e?this.action.invoke({name:"listApplicationByCategorySummary",async:n,parameter:{applictionCategory:e},success:i,failure:a}):this.action.invoke({name:"listApplicationSummary",async:n,success:i,failure:a})},saveApplication:function(e,i,a){e.id?this.updateApplication(e.id,e,i,a):this.addApplication(e,i,a)},savePage:function(e,i,a,n,t){e.isNewPage?this.addPage(e,i,a,n,t):this.updatePage(e,i,a,n,t)},updatePage:function(e,i,a,n,t){var s,o;e&&(s=MWF.encodeJsonString(JSON.encode(e))),i&&(o=MWF.encodeJsonString(JSON.encode(i)));var d=null;e&&e.json.includeScripts&&e.json.includeScripts.length&&(d={},e.json.includeScripts.each((function(e){d[e.id]="process"===e.appType?"processPlatform":e.appType})));var c=null;i&&i.json.includeScripts&&i.json.includeScripts.length&&(c={},i.json.includeScripts.each((function(e){c[e.id]="process"===e.appType?"processPlatform":e.appType})));var r={id:e.json.id,name:e.json.name,alias:e.json.name,description:e.json.description,portal:e.json.application,icon:e.json.formIcon,formFieldList:a,relatedScriptMap:d,relatedWidgetList:e&&e.json.widgetList?e.json.widgetList:[],mobileRelatedScriptMap:c,mobileRelatedWidgetList:i&&i.json.widgetList?i.json.widgetList:[]};i&&i.json.moduleList&&(Object.keys(i.json.moduleList).length?r.hasMobile=!0:r.hasMobile=!1),e&&(r.data=s),i&&(r.mobileData=o),this.action.invoke({name:"updatePage",data:r,parameter:{id:e.json.id},success:n,failure:t})},saveFile:function(e,i,a,n){e.id?this.updataFile(e.id,e,i,a):this.getUUID(function(t){e.id=t,this.addFile(e,i,a,n)}.bind(this),!1)},addPage:function(e,i,a,n,t){var s,o;if(e.json.id){e&&(s=MWF.encodeJsonString(JSON.encode(e))),i&&!i.json.id&&(i.json.id=e.json.id),i&&(o=MWF.encodeJsonString(JSON.encode(i)));var d={id:e.json.id,name:e.json.name,alias:e.json.name,hasMobile:!1,description:e.json.description,portal:e.json.application};i&&i.json.moduleList&&(Object.keys(i.json.moduleList).length?d.hasMobile=!0:d.hasMobile=!1),e&&(d.data=s),i&&(d.mobileData=o),this.action.invoke({name:"addPage",data:d,parameter:{id:e.json.categoryId},success:n,failure:t})}else this.getUUID(function(d){e.json.id=d,e&&(s=MWF.encodeJsonString(JSON.encode(e))),i&&!i.json.id&&(i.json.id=d),i&&(o=MWF.encodeJsonString(JSON.encode(i)));var c=null;e&&e.json.includeScripts&&e.json.includeScripts.length&&(c={},e.json.includeScripts.each((function(e){c[e.id]="process"===e.appType?"processPlatform":e.appType})));var r=null;i&&i.json.includeScripts&&i.json.includeScripts.length&&(r={},i.json.includeScripts.each((function(e){r[e.id]="process"===e.appType?"processPlatform":e.appType})));var l={id:e.json.id,name:e.json.name,hasMobile:!1,alias:e.json.name,description:e.json.description,portal:e.json.application,icon:e.json.formIcon,formFieldList:a,relatedScriptMap:c,relatedWidgetList:e&&e.json.widgetList?e.json.widgetList:[],mobileRelatedScriptMap:r,mobileRelatedWidgetList:i&&i.json.widgetList?i.json.widgetList:[]};i&&i.json.moduleList&&(Object.keys(i.json.moduleList).length?l.hasMobile=!0:l.hasMobile=!1),e&&(l.data=s),i&&(l.mobileData=o),this.action.invoke({name:"addPage",data:l,parameter:{id:e.json.categoryId},success:n,failure:t})}.bind(this))},saveWidget:function(e,i,a,n,t){e.isNewPage?this.addWidget(e,i,a,n,t):this.updateWidget(e,i,a,n,t)},updateWidget:function(e,i,a,n,t){var s,o;e&&(s=MWF.encodeJsonString(JSON.encode(e))),i&&(o=MWF.encodeJsonString(JSON.encode(i)));var d={id:e.json.id,name:e.json.name,alias:e.json.name,description:e.json.description,portal:e.json.application,icon:e.json.formIcon,formFieldList:a};i&&i.json.moduleList&&(Object.keys(i.json.moduleList).length?d.hasMobile=!0:d.hasMobile=!1),e&&(d.data=s),i&&(d.mobileData=o),this.action.invoke({name:"updateWidget",data:d,parameter:{id:e.json.id},success:n,failure:t})},addWidget:function(e,i,a,n,t){var s,o;if(e.json.id){e&&(s=MWF.encodeJsonString(JSON.encode(e))),i&&(o=MWF.encodeJsonString(JSON.encode(i)));var d={id:e.json.id,name:e.json.name,alias:e.json.name,hasMobile:!1,description:e.json.description,portal:e.json.application};i&&i.json.moduleList&&(Object.keys(i.json.moduleList).length?d.hasMobile=!0:d.hasMobile=!1),e&&(d.data=s),i&&(d.mobileData=o),this.action.invoke({name:"addWidget",data:d,parameter:{id:e.json.categoryId},success:n,failure:t})}else this.getUUID(function(d){e.json.id=d,e&&(s=MWF.encodeJsonString(JSON.encode(e))),i&&(o=MWF.encodeJsonString(JSON.encode(i)));var c={id:e.json.id,name:e.json.name,hasMobile:!1,alias:e.json.name,description:e.json.description,portal:e.json.application,icon:e.json.formIcon,formFieldList:a};i&&i.json.moduleList&&(Object.keys(i.json.moduleList).length?c.hasMobile=!0:c.hasMobile=!1),e&&(c.data=s),i&&(c.mobileData=o),this.action.invoke({name:"addWidget",data:c,parameter:{id:e.json.categoryId},success:n,failure:t})}.bind(this))},addPageTemplate:function(e,i,a,n,t){var s,o;this.getUUID(function(d){if(a.id=d,e){var c=Object.clone(e);c.json.id=d,c.json.name=a.name,s=MWF.encodeJsonString(JSON.encode(c))}if(i){var r=Object.clone(i);r.json.id=d,r.json.name=a.name,o=MWF.encodeJsonString(JSON.encode(r))}e&&(a.data=s),i&&(a.mobileData=o),this.action.invoke({name:"addPageTemplate",data:a,success:n,failure:t})}.bind(this))},saveSource:function(e,i,a){e.isNewSource?this.addSource(e,i,a):this.updateSource(e,i,a)},updateSource:function(e,i,a){var n=e.data;e.data=JSON.encode(e.data),this.action.invoke({name:"updataSource",data:e,parameter:{id:e.id},success:i,failure:a}),e.data=n},addSource:function(e,i,a){var n=e.data;e.data=JSON.encode(e.data),n.id?(this.action.invoke({name:"addSource",data:e,success:i,failure:a}),e.data=n):this.getUUID(function(t){e.id=t,this.action.invoke({name:"addSource",data:e,success:i,failure:a}),e.data=n}.bind(this))},saveMenu:function(e,i,a){e.isNewMenu?this.addStat(e,i,a):this.updateMenu(e,i,a)},updateMenu:function(e,i,a){var n=e.data;e.data=JSON.encode(e.data),this.action.invoke({name:"updataMenu",data:e,parameter:{id:statData.id},success:i,failure:a}),e.data=n},addMenu:function(e,i,a){var n=e.data;e.data=JSON.encode(e.data),n.id?(this.action.invoke({name:"addMenu",data:e,success:i,failure:a}),e.data=n):this.getUUID(function(t){e.id=t,this.action.invoke({name:"addMenu",data:e,success:i,failure:a}),e.data=n}.bind(this))},saveScript:function(e,i,a){e.isNewScript?this.addScript(e,i,a):this.updateScript(e,i,a)},updateScript:function(e,i,a){this.action.invoke({name:"updataScript",data:e,parameter:{id:e.id},success:i,failure:a})},addScript:function(e,i,a){e.portal=e.application,e.id?this.action.invoke({name:"addScript",data:e,success:i,failure:a}):this.getUUID(function(n){e.id=n,this.action.invoke({name:"addScript",data:e,success:i,failure:a})}.bind(this))},changeApplicationIcon:function(e,i,a,n,t){this.action.invoke({name:"updateApplicationIcon",parameter:{id:e},data:n,file:t,success:i,failure:a})}});