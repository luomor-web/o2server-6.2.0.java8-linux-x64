MWF.xAction=MWF.xAction||{},MWF.xAction.RestActions=MWF.Actions={actions:{},loadedActions:{},get:function(t){if(this.actions[t])return this.actions[t];var n=null,e=o2.session.path+"/xAction/services/"+t+".json";return MWF.getJSON(e,function(t){n=t}.bind(this),!1,!1,!1),!MWF.xAction.RestActions.Action[t]&&n.clazz&&MWF.require("MWF.xAction.services."+n.clazz,null,!1),MWF.xAction.RestActions.Action[t]||(MWF.xAction.RestActions.Action[t]=new Class({Extends:MWF.xAction.RestActions.Action})),this.actions[t]=new MWF.xAction.RestActions.Action[t](t,n),this.actions[t]},load:function(t){if(this.loadedActions[t])return this.loadedActions[t];var n=null,e=this.getHost(t)+"/"+t+"/describe/api.json";if(MWF.getJSON(e,function(t){n=t.jaxrs}.bind(this),!1,!1,!1),n){var o={};return n.each(function(n){if(n.methods&&n.methods.length){var e={};n.methods.each(function(t){var n={uri:"/"+t.uri};t.method&&(n.method=t.method),t.enctype&&(n.enctype=t.enctype),e[t.name]=n}.bind(this)),o[n.name]=new MWF.xAction.RestActions.Action(t,e)}}.bind(this)),this.loadedActions[t]=o,o}return null},async:function(t,n){var e="function"===o2.typeOf(n)?n:n.success,o="function"===o2.typeOf(n)?null:n.failure,i=[],s=t.length,c=new Array(s-1),r=function(){i.length===s&&e.apply(this,c)};t.each((function(t,n){var e=t.par||[];e.push((function(t){c[n]=t,i.push(!0),r()})),e.push((function(t,n,e){i.push(!1),o?o():function(t,n,e){if(0!=t.status){var o=e;if(t){var i=JSON.decode(t.responseText);o=i?i.message.trim()||"request json error":"request json error: "+t.responseText}MWF.xDesktop.notice("error",{x:"right",y:"top"},o)}}(t,0,e),r()})),e.push(!0),e.push(t.urlEncode),e.push(t.cache),t.action[t.subAction][t.name].apply(t.action[t.subAction],e)}))},invokeAsync2:function(t,n){var e="function"===o2.typeOf(n)?n:n.success,o="function"===o2.typeOf(n)?null:n.failure,i=[],s=t.length,c=new Array(s-1),r=function(){i.length===s&&e.apply(this,c)};t.each((function(t,n){var e=t.par||[];e.push((function(t){c[n]=t,i.push(!0),r()})),e.push((function(t,n,e){i.push(!1),o?o():function(t,n,e){if(0!=t.status){var o=e;if(t){var i=JSON.decode(t.responseText);o=i?i.message.trim()||"request json error":"request json error: "+t.responseText}MWF.xDesktop.notice("error",{x:"right",y:"top"},o)}}(t,0,e),r()})),e.push(!0),e.push(t.urlEncode),e.push(t.cache),t.action[t.name].apply(t.action,e)}))},getHost:function(t){var n=layout.serviceAddressList[t],e="";if(n)e=layout.config.app_protocol+"//"+(n.host||window.location.hostname)+(80==n.port?"":":"+n.port);else{var o=layout.desktop.centerServer.host||window.location.hostname,i=layout.desktop.centerServer.port;e=layout.config.app_protocol+"//"+o+("80"==i?"":":"+i)}return e},invokeAsync:function(t,n){var e=t.length,o=arguments.length-2,i=[],s=new Array(e-1),c=arguments,r="function"===o2.typeOf(n)?n:n.success,u="function"===o2.typeOf(n)?null:n.failure,a=function(){i.length===e&&r.apply(this,s)},h=function(t,n,e){if(0!=t.status){var o=e;if(t){var i=JSON.decode(t.responseText);o=i?i.message.trim()||"request json error":"request json error: "+t.responseText}MWF.xDesktop.notice("error",{x:"right",y:"top"},o)}};t.each((function(t,n){var e=n<o?c[n+2]:c[o+1];if(e){var r="array"===o2.typeOf(e)?e:[e];r.unshift((function(t,n,e){i.push(!1),u?u():h(t,n,e),a()})),r.unshift((function(t){s[n]=t,i.push(!0),a()}));t.action[t.name].apply(t.action,r)}else t.action[t.name]((function(){s[n]=json,i.push(!0),a()}),(function(t,n,e){i.push(!1),u?u():h(t,n,e),a()}))}))}},MWF.xAction.RestActions.Action=new Class({initialize:function(t,n){this.action=new MWF.xDesktop.Actions.RestActions("/xAction/services/"+t+".json",t,""),this.action.actions=n,Object.each(this.action.actions,function(t,n){t.uri&&(this[n]||this.createMethod(t,n))}.bind(this))},createMethod:function(t,n){var e=t.uri,o=new RegExp("{.+?}","g"),i=e.match(o),s=[];i&&(s=i.map((function(t){return t.substring(1,t.length-1)}))),this[n]=this.invokeFunction(t,s,n)},invokeFunction:function(t,n,e){return function(){var o,i,s,c,r,u=n.length-1,a=arguments.length,h=arguments,l={};return"function"===typeOf(h[0])?(u=-1,o=a>++u?h[u]:null,i=a>++u?h[u]:null,n.each((function(t,n){l[t]=a>++u?h[u]:null})),!t.method||"post"!==t.method.toLowerCase()&&"put"!==t.method.toLowerCase()||(t.enctype&&"formdata"===t.enctype.toLowerCase()?(c=a>++u?h[u]:null,r=a>++u?h[u]:null):c=a>++u?h[u]:null),s=a>++u?h[u]:null,urlEncode=!(a>++u)||h[u],cache=a>++u?h[u]:"ie"!=Browser.name):(n.each((function(t,n){l[t]=a>n?h[n]:null})),!t.method||"post"!==t.method.toLowerCase()&&"put"!==t.method.toLowerCase()||(t.enctype&&"formdata"===t.enctype.toLowerCase()?(c=a>++u?h[u]:null,r=a>++u?h[u]:null):c=a>++u?h[u]:null),o=a>++u?h[u]:null,i=a>++u?h[u]:null,s=a>++u?h[u]:null,urlEncode=!(a>++u)||h[u],cache=a>++u?h[u]:"ie"!=Browser.name),this.invoke(t,{name:e,async:s,data:c,file:r,parameter:l,success:o,failure:i,urlEncode:urlEncode,cache:cache})}.bind(this)},invoke:function(t,n){return this.action.invoke(n)}});