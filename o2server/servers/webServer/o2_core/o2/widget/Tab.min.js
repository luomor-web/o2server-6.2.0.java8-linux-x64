o2.widget=o2.widget||{},o2.widget.Tab=new Class({Implements:[Options,Events],Extends:o2.widget.Common,options:{style:"default"},initialize:function(t,e){this.setOptions(e),this.pages=[],this.path=o2.session.path+"/widget/$Tab/",this.cssPath=o2.session.path+"/widget/$Tab/"+this.options.style+"/css.wcss",this._loadCss(),this.css=Object.clone(this.css),this.showPage=null,this.node=$(t)},load:function(){this.fireEvent("queryLoad")&&(this.tabNodeContainer||(this.tabNodeContainer=new Element("div")),this.tabNodeContainer.set("styles",this.css.tabNodeContainer),this.tabNodeContainer.inject(this.node),this.tabNodeContainerRight||(this.tabNodeContainerRight=new Element("div.tabNodeContainerRight")),this.tabNodeContainerRight.set("styles",this.css.tabNodeContainerRight),this.tabNodeContainerRight.inject(this.tabNodeContainer),this.tabNodeContainerLeft||(this.tabNodeContainerLeft=new Element("div.tabNodeContainerLeft")),this.tabNodeContainerLeft.set("styles",this.css.tabNodeContainerLeft),this.tabNodeContainerLeft.inject(this.tabNodeContainer),this.tabNodeContainerArea||(this.tabNodeContainerArea=new Element("div.tabNodeContainerArea")),this.tabNodeContainerArea.set("styles",this.css.tabNodeContainerArea),this.tabNodeContainerArea.inject(this.tabNodeContainerLeft),this.contentNodeContainer||(this.contentNodeContainer=new Element("div")),this.contentNodeContainer.set("name","MWFcontentNodeContainer"),this.contentNodeContainer.set("styles",this.css.contentNodeContainer),this.contentNodeContainer.inject(this.node),this.tabNodeContainerRight.addEvents({mouseover:function(){this.tabNodeContainerRight.setStyles(this.css.tabNodeContainerRight_over)}.bind(this),mouseout:function(){this.tabNodeContainerRight.setStyles(this.css.tabNodeContainerRight)}.bind(this)}),o2.require("o2.xDesktop.Menu",function(){this.tabMenu=new o2.xDesktop.Menu(this.tabNodeContainerRight,{style:"tab",event:"click",container:this.tabNodeContainerRight,where:{x:"right",y:"bottom"},onQueryShow:function(){this.loadOverMenu()}.bind(this)}),this.tabMenu.load()}.bind(this)),this.tabNodeContainerRight.hide(),this.fireEvent("postLoad"))},rebuildTab:function(t,e,s){var i=new o2.widget.TabPage(e,"",this,{isClose:!1});return i.contentNodeArea=t,i.tabNode=s,i.textNode=s.getFirst(),i.closeNode=i.textNode.getFirst(),i.options.title=i.textNode.get("text"),i.load(),this.pages.push(i),i},addTab:function(t,e,s,i){var o=new o2.widget.TabPage(t,e,this,{isClose:s,tabNode:i});return o.load(),this.pages.push(o),o},loadOverMenu:function(t){this.tabMenu.clearItems();for(var e=this,s=this.showTabIndex;s<this.pages.length;s++){var i=this.pages[s];this.tabMenu.addMenuItem(i.options.title||i.tabNode.get("text"),"click",(function(){e.showOverPage(this)})).tabPage=i}},showOverPage:function(t){var e=t.tabPage;e&&(this.pages.erase(e),this.pages.unshift(e),e.tabNode.inject(this.tabNodeContainerArea,"top"),e.showTabIm(),this.resize())},resize:function(){for(var t=this.tabNodeContainerLeft.getSize(),e=0,s=0;s<this.pages.length;s++){if((e+=this.pages[s].tabNode.getSize().x)>t.x)break}this.showTabIndex=s,e>t.x&&s<this.pages.length?this.tabNodeContainerRight.show():this.tabNodeContainerRight.hide()}}),o2.widget.TabPage=new Class({Implements:[Options,Events],options:{isClose:!0,tabNode:null,title:""},initialize:function(t,e,s,i){this.setOptions(i),this.options.title=e,this.tab=s,this.contentNode=$(t)},load:function(){this.contentNodeArea||(this.contentNodeArea=new Element("div")),this.contentNodeArea.set("styles",this.tab.css.contentNodeArea),this.tabNode||(this.tabNode=new Element("div")),this.tabNode.set("styles",this.tab.css.tabNode),this.tabNode.addEvent("mousedown",(function(t){t.stop()})),this.textNode||(this.textNode=new Element("div").inject(this.tabNode)),this.textNode.set({styles:this.tab.css.tabTextNode,text:this.options.title}),this.tabNode.addEvent("click",this._showTab.bind(this)),this.options.isClose&&(this.closeNode||(this.closeNode=new Element("div").inject(this.tabNode)),this.closeNode.set({styles:this.tab.css.tabCloseNode}),this.closeNode.addEvent("click",this.closeTab.bind(this))),this.contentNodeArea.inject(this.tab.contentNodeContainer),this.tabNode.inject(this.tab.tabNodeContainerArea),this.contentNode.inject(this.contentNodeArea),this.tab.resize()},_showTab:function(){this.showTabIm()},showTabIm:function(t){this.isShow||(this.tab.pages.each((function(t){t.isShow&&t.hideIm()})),this.showIm(t))},showTab:function(t){this.isShow||(this.tab.pages.each((function(t){t.isShow&&t.hide()})),this.show(t))},showIm:function(t){this.fireEvent("queryShow"),this.tabNode.setStyle("display",""),this.tabNode.set("styles",this.tab.css.tabNodeCurrent),this.textNode.set("styles",this.tab.css.tabTextNodeCurrent),this.closeNode&&this.closeNode.set("styles",this.tab.css.tabCloseNodeCurrent),this.contentNodeArea.setStyle("display","block"),this.contentNodeArea.setStyle("opacity",1),this.isShow=!0,this.tab.showPage=this,t&&t(),this.fireEvent("show"),this.fireEvent("postShow")},show:function(t){this.fireEvent("queryShow"),this.tabNode.setStyle("display",""),this.tabNode.set("styles",this.tab.css.tabNodeCurrent),this.textNode.set("styles",this.tab.css.tabTextNodeCurrent),this.closeNode&&this.closeNode.set("styles",this.tab.css.tabCloseNodeCurrent),this.contentNodeArea.setStyle("display","block"),this.contentNodeArea.setStyle("opacity",1),this.morph||(this.morph=new Fx.Morph(this.contentNodeArea,{duration:100})),this.morph.start({opacity:1}).chain(function(){this.isShow=!0,this.tab.showPage=this,t&&t(),this.fireEvent("postShow")}.bind(this)),this.fireEvent("show")},hideIm:function(){this.isShow&&(this.fireEvent("queryHide"),this.tabNode.set("styles",this.tab.css.tabNode),this.textNode.set("styles",this.tab.css.tabTextNode),this.closeNode&&this.closeNode.set("styles",this.tab.css.tabCloseNode),this.contentNodeArea.setStyle("display","none"),this.contentNodeArea.setStyle("opacity",0),this.isShow=!1,this.fireEvent("hide"),this.fireEvent("postHide"))},hide:function(){this.isShow&&(this.fireEvent("queryHide"),this.tabNode.set("styles",this.tab.css.tabNode),this.textNode.set("styles",this.tab.css.tabTextNode),this.closeNode&&this.closeNode.set("styles",this.tab.css.tabCloseNode),this.morph||(this.morph=new Fx.Morph(this.contentNodeArea,{duration:100})),this.morph.start({opacity:0}).chain(function(){this.contentNodeArea.setStyle("display","none"),this.isShow=!1,this.fireEvent("postHide")}.bind(this)),this.fireEvent("hide"))},enableTab:function(t){this.disabled=!1,t?this.tabNode.show():this.showTab()},disableTab:function(t){this.disabled=!0,this.hideTab(t)},hideTab:function(t){this.fireEvent("queryHide"),this.tabNode.hide(),this.contentNodeArea.hide();if(!t){var e=this.getPrevPage();if(e&&!e.disabled)e.showTab();else if(this.tab.pages.length)for(var s=0;s<this.tab.pages.length;s++){var i=this.tab.pages[s];if(!i.disabled){i.showTab();break}}}this.isShow=!1,this.fireEvent("hide")},closeTab:function(){this.fireEvent("queryClose");var t=this.getPrevPage();this.contentNodeArea.destroy(),this.tabNode.destroy();if(this.tab.pages=this.tab.pages.erase(this),t&&!t.disabled)t.showTab();else if(this.tab.pages.length)for(var e=0;e<this.tab.pages.length;e++){var s=this.tab.pages[e];if(!s.disabled){s.showTab();break}}this.fireEvent("close")},getPrevPage:function(){var t=this.tab.pages.indexOf(this)-1;return t<0?null:this.tab.pages[t]}});