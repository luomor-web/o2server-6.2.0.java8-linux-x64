o2.widget=o2.widget||{},o2.widget.JsonParse=new Class({initialize:function(t,e,n){this.json=t,this.jsonObjectNode=e,this.jsonStringNode=n,this.stopParseJson=!1},load:function(){this.jsonString=JSON.encode(this.json),this.jsonStringNode&&this.jsonStringNode.set("text",JSON.format(this.json)),this.jsonObjectNode&&this.loadObjectTree()},loadObjectTree:function(){this.objectTree&&(this.objectTree.node.destroy(),this.objectTree=null),o2.require("o2.widget.Tree",function(){this.objectTree=new o2.widget.Tree(this.jsonObjectNode,{style:"jsonview",text:"text",onQueryExpand:function(t){if(t.firstChild&&"loadding..."===t.firstChild.options.text){t.firstChild.destroy();var e=t.options.value,n=t.options.level+1;switch(typeOf(e)){case"object":for(i in e)this.parseJsonObject(n,t,i,i,e[i],!1);break;case"array":e.each(function(e,i){this.parseJsonObject(n,t,i,i,e,!1)}.bind(this))}}}.bind(this)}),this.objectTree.load();var t=JSON.stringify(this.json,null,2);this.parseJsonObject(0,this.objectTree,"","JSON",this.json,!0);this.stopParseJson?this.stopParseJson=!1:this.jsonStringNode&&this.jsonStringNode.set("text",t)}.bind(this))},parseJsonObject:function(t,e,n,i,s,o){if(this.stopParseJson)return!1;for(var r={expand:o,title:"",text:"",action:"",icon:"",value:s,level:t},a="",d=0;d<t;d++)a+="  ";(n=n)&&(n='"'+n+'": ');var h="",c=t+1;switch(typeOf(s)){case"object":r.text=i,r.icon="object.png";var p=e.appendChild(r),l=a+n+"{",j=a+"}";if(o)for(d in s)h+=this.parseJsonObject(c,p,d,d,s[d],!1);else Object.keys(s).length&&p.appendChild({expand:!1,text:"loadding..."});h=l+"\n"+h.substring(0,h.length-2)+"\n"+j+",\n";break;case"array":r.text=i,r.icon="array.png";p=e.appendChild(r),l=a+n+"[",j=a+"]";o?s.each(function(t,e){h+=this.parseJsonObject(c,p,"","["+e+"]",t,!1)}.bind(this)):s.length&&p.appendChild({expand:!1,text:"loadding..."}),h=l+"\n"+h.substring(0,h.length-2)+"\n"+j+",\n";break;case"string":h+=a+n+'"'+s+'",\n',r.text=i+' : "'+s+'"',r.icon="string.png";p=e.appendChild(r);break;case"date":h+=a+n+'"'+s+'",\n',r.text=i+' : "'+s+'"',r.icon="string.png";p=e.appendChild(r);break;case"number":h+=a+n+'"'+s+'",\n',r.text=i+' : "'+s+'"',r.icon="string.png";p=e.appendChild(r);break;default:h+=a+n+s+",\n",r.text=i+" : "+s,r.icon="string.png";p=e.appendChild(r)}return h}});