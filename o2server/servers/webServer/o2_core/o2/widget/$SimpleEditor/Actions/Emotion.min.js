o2.widget.SimpleEditor.Actions=o2.widget.SimpleEditor.Actions||{},o2.widget.SimpleEditor.Actions.Emotion=new Class({Implements:[Options,Events],options:{style:"default",title:o2.LP.widget.SimpleEditor.insertEmotion},initialize:function(t,e,i,o,s){this.setOptions(t),this.editor=e,this.toolbar=i,this.button=o,this.bindObj=s,this.settingPath=o2.session.path+"/widget/$SimpleEditor/"+this.options.style+"/ActionSetting.js",this._loadSetting()},_loadSetting:function(){new Request({url:this.settingPath,async:!1,method:"get",onSuccess:function(t,e){this.setting=o2.widget.SimpleEditor.Actions.setting.emotion}.bind(this),onFailure:function(t){alert(t.responseText)}}).send()},command:function(t){this.fireEvent("queryCommand");var e=t.target;if("img"==e.tagName.toLowerCase()){var i=$(e).get("src");this.closeDialog();var o='<img class="MWF_editor_emotion" src="'+i+'" alt="">';this.editor.selectionRange?this.editor.selection.setRange(this.editor.selectionRange):this.editor.editareaNode.focus(),this.editor.selection.insertContent(o),this.editor.selectionRange=this.editor.selection.getRange(),this.fireEvent("postCommand")}},closeDialog:function(){this.fireEvent("queryCloseDialog"),this.dialog.close(),this.dialog.node=null,this.button&&(this.button.isActive=!1),this.editor.selectionRange&&this.editor.selection.setRange(this.editor.selectionRange),this.closeFun&&(document.body.removeEvent("mousedown",this.closeFun),this.closeFun=null),this.fireEvent("postCloseDialog")},showDialog:function(){var t=this,e=this.setting;this.fireEvent("queryOpenDialog");var i=e.imageName.length,o=e.cols,s=e.rows||Math.ceil(i/o),n=0,d="";d+="<center>",d+='  <table width="100%">';for(var l=0;l<s;l++){d+="    <tr>";for(var a=0;a<o;a++)d+='   <td width="70">',n<i&&(imgNames=e.imageName[n].split("|"),title=imgNames[1]?"title='"+imgNames[1]+"'":"",d+="   <img style='cursor:pointer;border:0;padding:2px;' "+title+" class='MWF_editor_emotion' src='"+e.imagesPath+imgNames[0]+e.fileExt+"'>"),d+="  </td>",n++;d+="    </tr>"}if(d+="  </table>",d+="</center>",e.dialog&&e.dialog.top)var r=e.dialog.top,g=$(document.body);else if(t.editor.iframe)r=(g=t.editor.iframe.getParent()).getCoordinates().top+(t.button?t.button.node.getCoordinates().bottom:130);else r=t.button?t.button.node.getCoordinates().bottom:130,g=t.editor.doc.body;if(e.dialog&&e.dialog.left)var h=e.dialog.left;else if(t.editor.iframe)h=g.getCoordinates().left+(t.button?t.button.node.getCoordinates().left-5:10);else h=t.button?t.button.node.getCoordinates().left:10;this.dialog=new o2.widget.SimpleEditor.Dialog(g,{style:t.options.style,title:t.options.title,fx:e.dialog.fx||!1,html:d,width:e.dialog.width||30*o,height:e.dialog.height||30*s,top:r,left:h,fromTop:e.dialog.fromTop||r,fromLeft:e.dialog.fromLeft||h,isMax:e.dialog.isMax||!1,isClose:e.dialog.isClose||!1,isResize:e.dialog.isResize||!1,isMove:e.dialog.isMove||!1,mark:e.dialog.mark||!1,onPostLoad:function(){},onQueryInjectNode:function(){this.node.addEvent("mousedown",(function(t){t.stopPropagation()})),this.node.getElement(".MWF_dialod_close")&&this.node.getElement(".MWF_dialod_close").addEvent("click",t.closeDialog.bind(t)),this.node.getElements(".MWF_editor_emotion")&&this.node.getElements(".MWF_editor_emotion").addEvent("click",t.command.bind(t))},onPostShow:function(){this.node.setStyle("height",(e.dialog.height||30*s)+30)}}),this.dialog.show(),this.closeFun=this.closeDialog.bind(this),document.body.addEvent("mousedown",this.closeFun),this.button&&(this.button.isActive=!0),this.fireEvent("postOpenDialog")}});