o2.widget.SimpleEditor=new Class({Extends:o2.widget.Common,Implements:[Options,Events],options:{style:"default",title:"",hasHeadNode:!0,hasTitleNode:!0,editorDisabled:!1,hasToolbar:!0,toolbarDisable:!1,hasSubmit:!0,submitDisable:!1,hasCustomArea:!0,paragraphise:!1,minHeight:200,maxHeight:717,limit:0,overFlow:"visible",width:"95%",action:"all"},initialize:function(t,i,e,s,o){this.protectRegex=/<(script|noscript|style)[\u0000-\uFFFF]*?<\/(script|noscript|style)>/g,this.setOptions(t),this.bindObject=o,this.protectedElements=[],this.path=o2.session.path+"/widget/$SimpleEditor/",this.cssPath=o2.session.path+"/widget/$SimpleEditor/"+this.options.style+"/css.wcss",this.editorPath=o2.session.path+"/widget/$SimpleEditor/"+this.options.style+"/editor.html",this.toolbarButtonPath=o2.session.path+"/widget/$SimpleEditor/"+this.options.style+"/toolbarItems.json",this._loadCss(),this.iframe=s,this.container=document.id(i),this.data=e},load:function(t){if(this.container){if(this.fireEvent("queryLoad",this)){if(this.iframe)if(this.win=this.iframe.contentWindow,this.doc=this.iframe.contentDocument?this.iframe.contentDocument:this.iframe.contentWindow.document,Object.append(this.win,new Window),Object.append(this.doc,new Document),Browser.Element){var i=this.win.Element.prototype;for(var e in Element)e.test(/^[A-Z]|\$|prototype|mooEditable/)||(i[e]=Element.prototype[e])}else document.id(this.doc.body);else this.win=window,this.doc=document;if(this.oldContent=t||this.data,this.editorNode=this.createEditor(),!this.editorNode)return;this.options.hasTitleNode&&this.titleNode.set("text",this.options.title),this._setEditarea(),this.options.hasToolbar&&this._loadToolbar(),this.options.hasSubmit&&this.setSubmitNodeDisable(this.options.submitDisable),this.editorNode.inject(this.container),this.selection=new o2.widget.SimpleEditor.Selection(this.win,this.doc),this.setContent(this.oldContent),this.iframe&&this.setIframeHeight()}this.fireEvent("postLoad",this)}},setIframeHeight:function(){try{var t=this.doc.body.scrollHeight;this.iframe.height=t}catch(t){}},createEditor:function(){var t=null;return new Request.HTML({url:this.editorPath,method:"GET",async:!1,onSuccess:function(i,e,s,o){t=i[0]}}).send(),this.parentNode=t.getElement(".MWF_editor_parent"),this.parentNode&&(this.parentNode.set("styles",this.css.MWF_editor_parent),this.parentNode.setStyle("width",this.options.width)),this.headNode=t.getElement(".MWF_editor_head"),this.options.hasHeadNode?this.headNode&&this.headNode.set("styles",this.css.MWF_editor_head):this.headNode.dispose(),this.titleNode=t.getElement(".MWF_editor_title"),this.titleNode?this.options.hasTitleNode?this.titleNode.set("styles",this.css.MWF_editor_title):this.titleNode.dispose():this.options.hasTitleNode=!1,this.wrapperNode=t.getElement(".MWF_editor_wrapper"),this.wrapperNode&&this.wrapperNode.set("styles",this.css.MWF_editor_wrapper),this.toolbarNode=t.getElement(".MWF_editor_toolbar"),this.toolbarNode?this.options.hasToolbar?this.toolbarNode.set("styles",this.css.MWF_editor_toolbar):this.toolbarNode.dispose():this.options.hasToolbar=!1,this.editareaWrapperNode=t.getElement(".MWF_editor_editarea_wrapper"),this.editareaWrapperNode&&this.editareaWrapperNode.set("styles",this.css.MWF_editor_editarea_wrapper),this.editareaNode=t.getElement(".MWF_editor_editarea"),this.editareaNode?(this.editareaNode.set("styles",this.css.MWF_editor_editarea),this.editbottomNode=t.getElement(".MWF_editor_bottom"),this.editbottomNode&&this.editbottomNode.set("styles",this.css.MWF_editor_bottom),this.submitNode=t.getElement(".MWF_editor_submit"),this.submitNode?this.options.hasSubmit?this.submitNode.set("styles",this.css.MWF_editor_submit):this.submitNode.dispose():this.options.hasSubmit=!1,this.editCustomInfoNode=t.getElement(".MWF_editor_remindarea"),this.editCustomInfoNode?this.options.hasCustomArea?(this.editCustomInfoNode.set("styles",this.css.MWF_editor_remindarea),this.options.limit&&0!=this.options.limit&&this.editCustomInfoNode.set("text","0/"+this.options.limit)):this.editCustomInfoNode.dispose():this.options.hasCustomArea=!1,t):null},setCustomInfo:function(t){this.options.hasCustomArea&&this.editCustomInfoNode.set("text",t)},_setEditarea:function(){"ie"==Browser.name&&!(void 0!==document.body.style.maxHeight&&"CSS1Compat"==document.compatMode)?this.editareaNode.set("styles",{overflowY:"max"==this.options.overFlow?"visible":this.options.overFlow,overflowX:"hidden",height:this.options.minHeight+"px"}):("visible"==this.options.overFlow||"auto"==this.options.overFlow?(vMaxHeight=null,vHeight=this.options.minHeight+"px"):"max"==this.options.overFlow&&(vMaxHeight=this.options.maxHeight+"px",vHeight="auto"),this.editareaNode.set("styles",{height:vHeight,minHeight:this.options.minHeight+"px",maxHeight:vMaxHeight,overflowY:"auto",overflowX:"hidden"})),this.editareaNode.addEvents({mouseup:this._editorMouseUp.bind(this),mousedown:this._editorMouseDown.bind(this),mouseover:this._editorMouseOver.bind(this),mouseout:this._editorMouseOut.bind(this),mouseenter:this._editorMouseEnter.bind(this),mouseleave:this._editorMouseLeave.bind(this),contextmenu:this._editorContextMenu.bind(this),click:this._editorClick.bind(this),dblclick:this._editorDoubleClick.bind(this),keypress:this._editorKeyPress.bind(this),keyup:this._editorKeyUp.bind(this),keydown:this._editorKeyDown.bind(this),focus:this._editorFocus.bind(this),blur:this._editorBlur.bind(this),resize:this._editorResize.bind(this)}),this.fireEvent("setEditarea",this)},setSubmitNodeDisable:function(t){t?this.css.MWF_editor_submit_disable&&(this.submitNode.set("styles",this.css.MWF_editor_submit_disable),this.submitNode.removeEvents()):(this.submitNode.set("styles",this.css.MWF_editor_submit),this.css.MWF_editor_submit_hover&&this.submitNode.addEvents({mouseover:function(){this.submitNode.set("styles",this.css.MWF_editor_submit_hover)}.bind(this),mouseleave:function(){this.submitNode.set("styles",this.css.MWF_editor_submit)}.bind(this)}),this.submitNode.addEvent("click",function(){this.fireEvent("submitForm",this)}.bind(this)))},setDisable:function(t){this.options.editorDisabled=t,this.options.hasToolbar&&(this.toolbarDisable=t,this.toolbar.setDisable(t)),this.options.hasSubmit&&(this.options.submitDisable=t,this.setSubmitNodeDisable(t))},execute:function(t,i,e){if(!this.busy)return this.busy=!0,this.doc.execCommand(t,i,e),this.saveContent(),this.busy=!1,!1},setContent:function(t){var i=this.protectedElements;return t=t.replace(this.protectRegex,(function(t){return i.push(t),"\x3c!-- editor:protect:"+(i.length-1)+" --\x3e"})),this.editareaNode.set("html",t),this.checkLimit(""),this},getContent:function(){var t=this.protectedElements,i=this.editareaNode.get("html").replace(/<!-- editor:protect:([0-9]+) -->/g,(function(i,e){return t[e.toInt()]}));return this.options.paragraphise&&(i=i.replace(/(h[1-6]|p|div|address|pre|li|ol|ul|blockquote|center|dl|dt|dd)><br ?\/?>/gi,"$1>")),i},clear:function(){this.setContent(""),this.options.hasCustomArea&&this.options.limit&&0!=this.options.limit&&this.editCustomInfoNode.set("text","0/"+this.options.limit)},checkLimit:function(){if(0!=this.options.limit){var t=this.editareaNode.get("html");this.contentLength=t.length,this.editCustomInfoNode&&("<br>"==t?this.editCustomInfoNode.set("text","0/"+this.options.limit):this.editCustomInfoNode.set("text",this.contentLength+"/"+this.options.limit)),this.contentLength>this.options.limit?this.beyondLimit||(this.editareaNodeBGColor=this.editareaNode.getStyle("backgroundColor"),this.editareaNode.setStyle("backgroundColor","rgb(255, 216, 216)"),this.setSubmitNodeDisable(!0),this.beyondLimit=!0):this.beyondLimit&&(this.editareaNode.setStyle("backgroundColor",this.editareaNodeBGColor),this.setSubmitNodeDisable(!1),this.beyondLimit=!1)}},_loadToolbar:function(){this.toolbar=new o2.widget.SimpleEditor.Toolbar({style:this.options.style,disable:this.options.toolbarDisable,action:this.options.action,onQueryToolbarLoad:function(){return!0},onPostToolbarLoad:function(){}},null,this.css,this.toolbarNode,this),this.toolbar.toolbarButtonPath=this.toolbarButtonPath,this.toolbar.load()},_editorResize:function(t){this.options.editorDisabled?t.stopPropagation():(!this.iframe||"visible"!=this.options.overFlow&&"max"!=this.options.overFlow||this.setIframeHeight(),this.fireEvent("_editorResize",[t,this]))},_editorFocus:function(t){this.oldContent="",this.fireEvent("editorFocus",[t,this])},_editorBlur:function(t){this.oldContent=this.getContent(),this.checkLimit(),this.fireEvent("editorBlur",[t,this])},_editorMouseUp:function(t){this.options.editorDisabled?t.stopPropagation():(this.selectionRange=this.selection.getRange(),this.fireEvent("editorMouseUp",[t,this]))},_editorMouseDown:function(t){this.options.editorDisabled?t.stopPropagation():this.fireEvent("editorMouseDown",[t,this])},_editorMouseOver:function(t){this.options.editorDisabled?t.stopPropagation():this.fireEvent("editorMouseOver",[t,this])},_editorMouseOut:function(t){this.options.editorDisabled?t.stopPropagation():this.fireEvent("editorMouseOut",[t,this])},_editorMouseEnter:function(t){this.options.editorDisabled?t.stopPropagation():this.fireEvent("editorMouseEnter",[t,this])},_editorMouseLeave:function(t){this.options.editorDisabled?t.stopPropagation():this.fireEvent("editorMouseLeave",[t,this])},_editorContextMenu:function(t){this.options.editorDisabled?t.stopPropagation():this.fireEvent("editorContextMenu",[t,this])},_editorClick:function(t){if("safari"==Browser.name||"chrome"==Browser.name){var i=t.target;"img"==Element.get(i,"tag")&&this.selection.selectNode(i)}this.selectionRange=this.selection.getRange(),this.fireEvent("editorClick",[t,this])},_editorDoubleClick:function(t){this.fireEvent("editorDoubleClick",[t,this])},_editorKeyPress:function(t){this.options.editorDisabled?t.stopPropagation():this.fireEvent("editorKeyPress",[t,this])},_editorKeyDown:function(t){if(this.options.editorDisabled)t.stopPropagation();else{if("enter"==t.key)if(this.options.paragraphise)if(!t.shift||"safari"!=Browser.name&&"chrome"!=Browser.name&&"firefox"!=Browser.name){if("safari"==Browser.name||"chrome"==Browser.name||"firefox"==Browser.name){var i=this.selection.getNode();Element.getParents(i).include(i).some((function(t){return t.nodeName.test(blockEls)}))||this.execute("insertparagraph")}}else{var e=this.selection,s=e.getRange(),o=this.doc.createElement("br");if(s.insertNode(o),s.setStartAfter(o),s.setEndAfter(o),e.setRange(s),e.getSelection().focusNode==o.previousSibling){var n=this.doc.createTextNode(" "),h=o.parentNode,d=o.nextSibling;d?h.insertBefore(n,d):h.appendChild(n),e.selectNode(n),e.collapse(1)}this.win.scrollTo(0,Element.getOffsets(e.getRange().startContainer).y),t.preventDefault()}else if("ie"==Browser.name){s=this.selection.getRange(),i=this.selection.getNode();s&&(i&&"li"==i.get("tag")||(this.selection.insertContent("<br>"),s.select(),this.selection.collapse(!1))),t.preventDefault()}this.fireEvent("editorKeyDown",[t,this])}},_editorKeyUp:function(t){this.options.editorDisabled?t.stopPropagation():(this.selectionRange=this.selection.getRange(),!this.iframe||"visible"!=this.options.overFlow&&"max"!=this.options.overFlow||this.setIframeHeight(),this.checkLimit(),this.fireEvent("editorKeyUp",[t,this]))}}),o2.widget.SimpleEditor.Toolbar=new Class({Implements:[Options,Events],options:{style:"default",disable:!1,action:"all"},initialize:function(t,i,e,s,o){this.setOptions(t),this.container=i,this.css=e,this.editor=o,s?(this.node=s,this.hasNode=!0):this.hasNode=!1,this.toolbarButtonPath=o2.session.path+"/widget/SimpleEditor/"+this.options.style+"/toolbarItems.json",this.actions=this.options.action.split(" "),this.items=[],this.children=[],this.childrenButton=[],this.childrenMenu=[]},load:function(){this.fireEvent("queryToolbarLoad")&&(this.node||(this.node=new Element("div",{styles:this.css.MWF_editor_toolbar,class:"MWF_editor_toolbar"})),new Request.JSON({url:this.toolbarButtonPath,secure:!1,async:!1,method:"get",noCache:!0,onSuccess:function(t,i){if(nodes=t.item,nodes)if(-1!=this.actions.indexOf("all"))nodes.each(function(t,i){switch(t.type){case"button":this._loadToolBarButton(t);break;case"menu":break;case"separator":this._loadToolBarSeparator()}}.bind(this));else{var e={};nodes.each((function(t,i){"button"!=t.type&&"menu"!=t.type||(e[t.actionName]=t)})),this.actions.each(function(t,i){"|"==t?this._loadToolBarSeparator():e[t]&&(node=e[t],"button"==node.type?this._loadToolBarButton(node):node.type)}.bind(this))}this.hasNode||this.node.inject(this.container)}.bind(this),onError:function(t,i){alert(t)}}).send(),this.fireEvent("postToolbarLoad"))},_loadToolBarSeparator:function(){var t=new Element("label");t.set("styles",this.css.MWF_editor_toolbar_separator),t.inject(this.node)},_loadToolBarButton:function(t){if(t){this.options.disable&&(t.disable=!0);var i=new o2.widget.SimpleEditor.ToolbarButton(t,this.node,this.css,this);i.options.style=this.options.style,i.load(),this.fireEvent("buttonLoad",[i]),i.buttonID&&(this.items[i.buttonID]=i),this.children.push(i),this.childrenButton.push(i)}},_loadToolBarMenu:function(t){},setDisable:function(t){this.childrenButton.each(function(i,e){i.setDisable(t)}.bind(this))}}),o2.widget.SimpleEditor.ToolbarButton=new Class({Implements:[Options,Events],options:{style:"default",id:"",text:"",title:"",pic:"",picDisable:"",actionName:"",dialog:"",disable:!1},initialize:function(t,i,e,s){this.setOptions(t),this.toolbar=s,this.toolbar.editor&&(this.editor=this.toolbar.editor),this.toolbarNode=i,this.css=e,""!=this.options.id&&(this.buttonID=this.options.id),this.modifiyStyle=!1,this.isActive=!1,this.dialogs={}},load:function(){this.fireEvent("queryButtonLoad"),this.node=new Element("span"),this.node.set("styles",this.css.MWF_editor_toolbar_button_span),this.node.title=this.options.title,this.options.pic&&""!=this.options.pic&&(this.picNode=this._createImageNode(this.options.pic)),this.options.text&&""!=this.options.text&&(this.textNode=this._createTextNode(this.options.text)),this.options.disable&&this.setDisable(this.options.disable),this.node.inject(this.toolbarNode);var t=this.options.actionName;o2.require("o2.widget.$SimpleEditor.Actions."+t,function(){this.action=new o2.widget.SimpleEditor.Actions[t]({style:this.options.style},this.editor,this.toolbar,this),this.action&&(this.action.options,this.action.showDialog,this.action.events&&Object.each(this.action.events,(function(t,i){this.addEvent(i,t)}),this))}.bind(this)),this._addButtonEvent(),this.fireEvent("postButtonLoad",this)},setDisable:function(t){if(t){if(this.node.set("styles",this.css.MWF_editor_toolbar_button_disable),this.picNode)this.picNode.set("styles",this.css.MWF_editor_toolbar_button_imagediv_disable),this.picNode.getElement("img").set("src",this.options.picDisable);this.textNode&&this.textNode.set("styles",this.css.MWF_editor_toolbar_button_textdiv_disable),this.options.disable=!0}else{if(this.node.set("styles",this.css.MWF_editor_toolbar_button),this.picNode)this.picNode.set("styles",this.css.MWF_editor_toolbar_button_imagediv),this.picNode.getElement("img").set("src",this.options.pic);this.textNode&&this.textNode.set("styles",this.css.MWF_editor_toolbar_button_textdiv),this.options.disable=!1}},_createImageNode:function(t){if(t){var i=new Element("span",{styles:this.css.MWF_editor_toolbar_button_imagediv}).inject(this.node);new Element("img",{styles:this.css.MWF_editor_toolbar_button_image,src:t}).inject(i);return i}return null},_createTextNode:function(t){return t?new Element("span",{styles:this.css.MWF_editor_toolbar_button_textdiv,text:t}).inject(this.node):null},_addButtonEvent:function(){this.node.addEvent("mouseover",this._buttonMouseOver.bind(this)),this.node.addEvent("mouseout",this._buttonMouseOut.bind(this)),this.node.addEvent("mousedown",this._buttonMouseDown.bind(this)),this.node.addEvent("mouseup",this._buttonMouseUp.bind(this)),this.node.addEvent("click",this._buttonClick.bind(this))},_buttonMouseOver:function(){this.modifiyStyle&&!this.options.disable&&(this.options.disable||this.node.set("styles",this.css.MWF_editor_toolbar_button_over))},_buttonMouseOut:function(){this.modifiyStyle&&!this.options.disable&&(this.options.disable||this.node.set("styles",this.css.MWF_editor_toolbar_button_out))},_buttonMouseDown:function(){this.modifiyStyle&&!this.options.disable&&(this.options.disable||this.node.set("styles",this.css.MWF_editor_toolbar_button_down))},_buttonMouseUp:function(){this.modifiyStyle&&!this.options.disable&&(this.options.disable||this.node.set("styles",this.css.MWF_editor_toolbar_button_up))},_buttonClick:function(){this.options.disable||this.options.actionName&&this.action&&this.action.showDialog&&(this.isActive||(this.toolbar.childrenButton.each((function(t,i){t.isActive&&t.action&&t.action.closeDialog&&t.action.closeDialog.call(t.action)})),this.action.showDialog.call(this.action),this.isActive=!0))}}),o2.widget.SimpleEditor.Selection=new Class({initialize:function(t,i){this.win=t,this.doc=i},getSelection:function(){return this.doc.selection?this.doc.selection:this.win.getSelection()},getRange:function(){var t=this.getSelection();if(!t)return null;try{return t.rangeCount>0?t.getRangeAt(0):t.createRange?t.createRange():null}catch(t){return this.doc.body.createTextRange()}},setRange:function(t){if(t.select)Function.attempt((function(){t.select()}));else{var i=this.getSelection();i.addRange&&(i.removeAllRanges(),i.addRange(t))}},selectNode:function(t,i){var e=this.getRange(),s=this.getSelection();return e.moveToElementText?Function.attempt((function(){e.moveToElementText(t),e.select()})):s.addRange?(i?e.selectNodeContents(t):e.selectNode(t),s.removeAllRanges(),s.addRange(e)):s.setBaseAndExtent(t,0,t,1),t},isCollapsed:function(){var t=this.getRange();return!t.item&&(0==t.boundingWidth||this.getSelection().isCollapsed)},collapse:function(t){var i=this.getRange(),e=this.getSelection();i.select?(i.collapse(t),i.select()):t?e.collapseToStart():e.collapseToEnd()},getContent:function(){var t=this.getRange(),i=new Element("body");return this.isCollapsed()?"":(t.cloneContents?i.appendChild(t.cloneContents()):null!=t.item||null!=t.htmlText?i.set("html",t.item?t.item(0).outerHTML:t.htmlText):i.set("html",t.toString()),i.get("html"))},getText:function(){var t=this.getRange(),i=this.getSelection();return this.isCollapsed()?"":t.text||(i.toString?i.toString():"")},getNode:function(){var t=this.getRange();if("ie"!=Browser.name||Browser.version>=9){var i=null;if(t)for(i=t.commonAncestorContainer,t.collapsed||t.startContainer==t.endContainer&&t.startOffset-t.endOffset<2&&t.startContainer.hasChildNodes()&&(i=t.startContainer.childNodes[t.startOffset]);"element"!=typeOf(i)&&i;)i=i.parentNode;return document.id(i)}return document.id(t.item?t.item(0):t.parentElement())},insertContent:function(t){if("ie"==Browser.name){var i=this.getRange();if(i.pasteHTML)i.pasteHTML(t),i.collapse(!1),i.select();else if(i.insertNode){if(i.deleteContents(),i.createContextualFragment)i.insertNode(i.createContextualFragment(t));else{var e=this.doc,s=e.createDocumentFragment(),o=e.createElement("div");s.appendChild(o),o.outerHTML=t,i.insertNode(s)}i.collapse(!1)}}else this.win.document.execCommand("insertHTML",!1,t)}}),o2.widget.SimpleEditor.Dialog=new Class({Implements:[Options,Events],options:{style:"default",fx:!1,title:"dialog",width:"300",height:"150",top:"0",left:"0",fromTop:"0",fromLeft:"0",mark:!0,html:"",text:"",url:"",content:null,isMax:!1,isClose:!0,isResize:!0,isMove:!0,buttons:null},initialize:function(t,i){this.setOptions(i),this.path=o2.session.path+"/widget/$SimpleEditor/"+this.options.style+"/Dialog/",this.cssPath=o2.session.path+"/widget/$SimpleEditor/"+this.options.style+"/Dialog/css.wcss",this._loadCss(),this.container=t?$(t):$(document.body),this.css.to.height=this.options.height,this.css.to.width=this.options.width,this.css.to.top=this.options.top,this.css.to.left=this.options.left,this.css.from.top=this.options.fromTop,this.css.from.left=this.options.fromLeft,this.contentUrl=o2.session.path+"/widget/$SimpleEditor/"+this.options.style+"/Dialog/dialog.html",new Request.HTML({url:this.contentUrl,method:"GET",async:!1,onSuccess:function(t,i,e,s){this.node=t[0],this.getDialogNode(),this.fireEvent("postLoad",this)}.bind(this),onFailure:function(t){alert(t)}}).send()},_loadCss:function(){new Request.JSON({url:this.cssPath,secure:!1,async:!1,method:"get",noCache:!0,onSuccess:function(t,i){this.css=t}.bind(this),onError:function(t,i){alert(t)}}).send()},reStyle:function(t){t&&this.setOptions(t),this.css.to.height=this.options.height,this.css.to.width=this.options.width,this.css.to.top=this.options.top,this.css.to.left=this.options.left,this.css.to.top=this.options.top,this.css.from.top=this.options.fromTop,this.css.from.left=this.options.fromLeft,this.node.set("styles",this.css.from)},getDialogNode:function(){this.node.set("styles",this.css.from),this.title=this.node.getElement(".MWF_dialod_title"),this.titleCenter=this.node.getElement(".MWF_dialod_title_center"),this.titleText=this.node.getElement(".MWF_dialod_title_text"),this.titleAction=this.node.getElement(".MWF_dialod_title_action"),this.content=this.node.getElement(".MWF_dialod_content"),this.bottom=this.node.getElement(".MWF_dialod_bottom"),this.resizeNode=this.node.getElement(".MWF_dialod_bottom_resize"),this.button=this.node.getElement(".MWF_dialod_button"),this.title&&(this.title.addEvent("mousedown",function(){this.containerDrag=new Drag.Move(this.node)}.bind(this)),this.title.addEvent("mouseup",function(){this.node.removeEvents("mousedown"),this.title.addEvent("mousedown",function(){this.containerDrag=new Drag.Move(this.node)}.bind(this))}.bind(this))),this.titleText&&this.getTitle(),this.content&&this.getContent(),this.titleAction&&this.getAction(),this.resizeNode&&this.setResizeNode(),this.button&&this.getButton(),this.content&&this.setContentSize(),this.fireEvent("queryInjectNode"),this.node.inject(this.container)},getButton:function(){for(i in this.options.buttons)new Element("input",{type:"button",value:i,styles:this.css.button,events:{click:this.options.buttons[i].bind(this)}}).inject(this.button)},setContentSize:function(){var t=this.options.height;this.title&&(t-=this.title.getSize().y);this.bottom&&(t-=this.bottom.getSize().y);this.button&&(t-=this.button.getSize().y);this.content.setStyle("height",t)},getTitle:function(){this.titleText.set("text",this.options.title)},getContent:function(){this.options.content?this.options.content().inject(this.content):this.options.url?(this.content.set("load",{method:"get",async:!1}),$(this.content).load(this.options.url)):this.options.html?this.content.set("html",this.options.html):this.options.text&&this.content.set("text",this.options.text)},show:function(){this.options.mark&&this._markShow(),!this.morph&&this.options.fx&&(this.morph=new Fx.Morph(this.node,{duration:200})),this.fireEvent("queryShow")&&(this.node.setStyle("display","block"),this.options.fx?this.morph.start(this.css.to).chain(function(){this.fireEvent("postShow")}.bind(this)):(this.node.setStyles(this.css.to),this.fireEvent("postShow")))},hide:function(){!this.morph&&this.options.fx&&(this.morph=new Fx.Morph(this.node,{duration:200})),this.fireEvent("queryHide")&&(this.options.fx?this.morph.start(this.css.from).chain(function(){this._markHide(),this.node.setStyle("display","none"),this.fireEvent("postHide")}.bind(this)):(this._markHide(),this.node.setStyle("display","none"),this.fireEvent("postHide")))},close:function(){!this.morph&&this.options.fx&&(this.morph=new Fx.Morph(this.node,{duration:200})),this.fireEvent("queryClose")&&(this.options.fx?this.morph.start(this.css.from).chain(function(){this._markClose(),this.node.destroy(),this.node=null,this.fireEvent("postClose")}.bind(this)):(this._markClose(),this.node.destroy(),this.fireEvent("postClose")))},_markShow:function(){if(this.options.mark){if(!this.markNode){var t=o2.getMarkSize();this.markNode=new Element("div",{styles:this.css.mark}).inject($(document.body)),this.markNode.set("styles",{height:t.y,width:t.x})}this.markNode.setStyle("display","block")}},_markHide:function(){this.markNode&&this.markNode.setStyle("display","none")},_markClose:function(){this.markNode&&this.markNode.destroy()}}),o2.widget.SimpleEditor.Actions=o2.widget.SimpleEditor.Actions||{},o2.widget.SimpleEditor.Actions.setting=o2.widget.SimpleEditor.Actions.setting||{};