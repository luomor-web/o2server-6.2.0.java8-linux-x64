MWF.xScript=MWF.xScript||{},MWF.xScript.Environment=function(t){var n=t.data,i=t.form,o=t.forms;this.library=COMMON,this.power={isManager:MWF.AC.isProcessManager()||i.businessData.control.allowReroute,isReseter:i.businessData.control.allowReset,isDelete:i.businessData.control.allowDeleteWork,isPront:!0,isPrint:!0};this.setData=function(t){var e;this.data=(e=t,new MWF.xScript.JSONData(e,(function(t,e,n){for(var i={getKey:function(){return e},getParent:function(){return n}};i&&!o[i.getKey()];)i=i.getParent();i&&i.getKey()&&o[i.getKey()]&&o[i.getKey()].resetData()}),"",null,i)),this.data.save=function(t){i.saveFormData(t)}},this.setData(n),this.workContext={getWork:function(){return t.work||t.workCompleted},getActivity:function(){return t.activity||null},getTask:function(){return t.task||null},getTaskList:function(e,n){var i,o=e&&"function"===o2.typeOf(e)?e:null,r=n&&"function"===o2.typeOf(n)?n:null;return o2.Actions.get("x_processplatform_assemble_surface").listTaskByWork(t.work.id,(function(t){i=t.data,o&&o(i)}),r,!!o),i},getTaskListByJob:function(e,n){var i,o=e&&"function"===o2.typeOf(e)?e:null,r=n&&"function"===o2.typeOf(n)?n:null;return o2.Actions.get("x_processplatform_assemble_surface").listTaskByJob(t.work.job,(function(t){i=t.data,o&&o(i)}),r,!!o),i},getTaskCompletedList:function(e,n){var i,o=e&&"function"===o2.typeOf(e)?e:null,r=n&&"function"===o2.typeOf(n)?n:null;return o2.Actions.get("x_processplatform_assemble_surface").listTaskCompletedByWork(t.work.id,(function(t){i=t.data,o&&o(i)}),r,!!o),i},getTaskCompletedListByJob:function(e,n){var i,o=e&&"function"===o2.typeOf(e)?e:null,r=n&&"function"===o2.typeOf(n)?n:null;return o2.Actions.get("x_processplatform_assemble_surface").listTaskCompletedByJob(t.work.job,(function(t){i=t.data,o&&o(i)}),r,!!o),i},getReadList:function(e,n){var i,o=e&&"function"===o2.typeOf(e)?e:null,r=n&&"function"===o2.typeOf(n)?n:null;return o2.Actions.get("x_processplatform_assemble_surface").listReadByWork(t.work.id,(function(t){i=t.data,o&&o(i)}),r,!!o),i},getReadListByJob:function(e,n){var i,o=e&&"function"===o2.typeOf(e)?e:null,r=n&&"function"===o2.typeOf(n)?n:null;return o2.Actions.get("x_processplatform_assemble_surface").listReadByJob(t.work.job,(function(t){i=t.data,o&&o(i)}),r,!!o),i},getReadCompletedList:function(e,n){var i,o=e&&"function"===o2.typeOf(e)?e:null,r=n&&"function"===o2.typeOf(n)?n:null;return o2.Actions.get("x_processplatform_assemble_surface").listReadCompletedByWork(t.work.id,(function(t){i=t.data,o&&o(i)}),r,!!o),i},getReadCompletedListByJob:function(e,n){var i,o=e&&"function"===o2.typeOf(e)?e:null,r=n&&"function"===o2.typeOf(n)?n:null;return o2.Actions.get("x_processplatform_assemble_surface").listReadCompletedByJob(t.work.job,(function(t){i=t.data,o&&o(i)}),r,!!o),i},getJobTaskList:this.getTaskListByJob,getJobReadList:this.getReadListByJob,getJobTaskCompletedList:this.getTaskCompletedListByJob,getJobReadCompletedList:this.getReadCompletedListByJob,getControl:function(){return t.control},getWorkLogList:function(){return t.workLogList},getRecordList:function(){return t.recordList},getAttachmentList:function(){return t.attachmentList},getRouteList:function(){return t.task?t.task.routeNameList:null},getInquiredRouteList:function(){return null}},this.workContent=this.workContext;var r=function(t){if(t){t.creatorPersonDn=t.creatorPerson||"",t.creatorUnitDn=t.creatorUnit||"",t.creatorUnitDnList=t.creatorUnitList||"",t.creatorIdentityDn=t.creatorIdentity||"";MWF.defineProperties(t,{creatorPerson:{get:function(){return this.creatorPersonDn.substring(0,this.creatorPersonDn.indexOf("@"))}},creatorUnit:{get:function(){return this.creatorUnitDn.substring(0,this.creatorUnitDn.indexOf("@"))}},creatorDepartment:{get:function(){return this.creatorUnitDn.substring(0,this.creatorUnitDn.indexOf("@"))}},creatorIdentity:{get:function(){return this.creatorIdentityDn.substring(0,this.creatorIdentityDn.indexOf("@"))}},creatorCompany:{get:function(){return this.creatorUnitLevel?this.creatorUnitLevel.split("/")[0]:this.creatorUnitDn.substring(0,this.creatorUnitDn.indexOf("@"))}}})}return t};r(this.workContext.getWork()),function(t){if(t){t.personDn=t.person||"",t.unitDn=t.unit||"",t.unitDnList=t.unitList||"",t.identityDn=t.identity||"";MWF.defineProperties(t,{person:{get:function(){return this.personDn.substring(0,this.personDn.indexOf("@"))}},unit:{get:function(){return this.unitDn.substring(0,this.unitDn.indexOf("@"))}},department:{get:function(){return this.unitDn.substring(0,this.unitDn.indexOf("@"))}},identity:{get:function(){return this.identityDn.substring(0,this.identityDn.indexOf("@"))}},company:{get:function(){return this.unitList[0]}}})}}(r(this.workContext.getTask())),this.Dict=MWF.xScript.createDict((i.businessData.work||i.businessData.workCompleted).application);var a,s=null,u=function(){s||(MWF.require("MWF.xScript.Actions.UnitActions",null,!1),s=new MWF.xScript.Actions.UnitActions)},l=function(t){var e=typeOf(t);if("array"===e){var n=[];return t.each((function(t){n.push("object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t)})),n}return["object"===e?t.distinguishedName||t.id||t.unique||t.name:t]};this.org={getGroup:function(t,e){u();var n={groupList:l(t)},i=null,o=s.listGroup(n,(function(t){return i=(i=t.data)&&1===i.length?i[0]:i,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},listSubGroup:function(t,e,n){u();var i,o={groupList:l(t)},r=null,a=function(t){return r=t.data,n&&"function"==o2.typeOf(n)?n(r):r};return i=e?s.listSubGroupNested(o,a,null,!!n):s.listSubGroupDirect(o,a,null,!!n),n?i:r},listSupGroup:function(t,e,n){u();var i={groupList:l(t)},o=null,r=function(t){return o=t.data,n&&"function"==o2.typeOf(n)?n(o):o};if(e)var a=s.listSupGroupNested(i,r,null,!!n);else a=s.listSupGroupDirect(i,r,null,!!n);return n?a:o},listGroupWithPerson:function(t,e){u();var n={personList:l(t)},i=null,o=s.listGroupWithPerson(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},groupHasRole:function(t,e,n){u(),nameFlag="object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t;var i={group:nameFlag,roleList:l(e)},o=!1,r=s.groupHasRole(i,(function(t){return o=t.data.value,n&&"function"==o2.typeOf(n)?n(o):o}),null,!!n);return n?r:o},getRole:function(t,e){u();var n={roleList:l(t)},i=null,o=s.listRole(n,(function(t){return i=(i=t.data)&&1===i.length?i[0]:i,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},listRoleWithPerson:function(t,e){u();var n={personList:l(t)},i=null,o=s.listRoleWithPerson(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},personHasRole:function(t,e,n){u(),nameFlag="object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t;var i={person:nameFlag,roleList:l(e)},o=!1,r=s.listRoleWithPerson(i,(function(t){return o=t.data.value,n&&"function"==o2.typeOf(n)?n(o):o}),null,!!n);return n?r:o},getPerson:function(t,e){u();var n={personList:l(t)},i=null,o=s.listPerson(n,(function(t){return i=(i=t.data)&&1===i.length?i[0]:i,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},listSubPerson:function(t,e,n){u();var i,o={personList:l(t)},r=null,a=function(t){return r=t.data,n&&"function"==o2.typeOf(n)?n(r):r};return i=e?s.listPersonSubNested(o,a,null,!!n):s.listPersonSubDirect(o,a,null,!!n),n?i:r},listSupPerson:function(t,e,n){u();var i,o={personList:l(t)},r=null,a=function(t){return r=t.data,n&&"function"==o2.typeOf(n)?n(r):r};return i=e?s.listPersonSupNested(o,a,null,!!n):s.listPersonSupDirect(o,a,null,!!n),n?i:r},listPersonWithGroup:function(t,e){u();var n={groupList:l(t)},i=null,o=s.listPersonWithGroup(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},listPersonWithRole:function(t,e){u();var n,i={roleList:l(t)},o=null;return n=s.listPersonWithRole(i,(function(t){return o=t.data,e&&"function"==o2.typeOf(e)?e(o):o}),null,!!e),e?n:o},listPersonWithIdentity:function(t,e){u();var n={identityList:l(t)},i=null,o=s.listPersonWithIdentity(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},getPersonWithIdentity:function(t,e){u();var n={identityList:l(t)},i=null,o=s.listPersonWithIdentity(n,(function(t){return i=(i=t.data)&&1===i.length?i[0]:i,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},listPersonWithUnit:function(t,e,n){u();var i,o={unitList:l(t)},r=null,a=function(t){return r=t.data,n&&"function"==o2.typeOf(n)?n(r):r};return i=e?s.listPersonWithUnitNested(o,a,null,!!n):s.listPersonWithUnitDirect(o,a,null,!!n),n?i:r},listPersonWithAttribute:function(t,e,n){u();var i={name:t,attribute:e},o=null,r=s.listPersonWithAttribute(i,(function(t){return o=t.data,n&&"function"==o2.typeOf(n)?n(o):o}),null,!!n);return n?r:o},listPersonNameWithAttribute:function(t,e,n){u();var i={name:t,attribute:e},o=null,r=s.listPersonWithAttributeValue(i,(function(t){return o=t.data.personList,n&&"function"==o2.typeOf(n)?n(o):o}),null,!!n);return n?r:o},appendPersonAttribute:function(t,e,n,i,o,r){u();var a={attributeList:n,name:e,person:"object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t},l=null,c=s.appendPersonAttribute(a,(function(t){return l=t.data,r&&"function"==o2.typeOf(r)?r(l):l}),null,!!r);return r?c:l},setPersonAttribute:function(t,e,n,i,o,r){u();var a={attributeList:n,name:e,person:"object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t},l=null,c=s.setPersonAttribute(a,(function(t){return l=t.data,r&&"function"==o2.typeOf(r)?r(l):l}),null,!!r);return r?c:l},getPersonAttribute:function(t,e,n){u();var i={name:e,person:"object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t},o=null,r=s.getPersonAttribute(i,(function(t){return o=t.data.attributeList,n&&"function"==o2.typeOf(n)?n(o):o}),null,!!n);return n?r:o},listPersonAttributeName:function(t,e){u();var n={personList:l(t)},i=null,o=s.listPersonAttributeName(n,(function(t){return i=t.data.nameList,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},listPersonAllAttribute:function(t,e){u();var n={personList:l(t)},i=null,o=s.listPersonAllAttribute(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},getIdentity:function(t,e){u();var n={identityList:l(t)},i=null,o=s.listIdentity(n,(function(t){return i=(i=t.data)&&1===i.length?i[0]:i,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},listIdentityWithPerson:function(t,e){u();var n={personList:l(t)},i=null,o=s.listIdentityWithPerson(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},listIdentityWithUnit:function(t,e,n){u();var i={unitList:l(t)},o=null,r=s[e?"listIdentityWithUnitNested":"listIdentityWithUnitDirect"](i,(function(t){return o=t.data,n&&"function"==o2.typeOf(n)?n(o):o}),null,!!n);return r.name="org",n?r:o},getUnit:function(t,e){u();var n={unitList:l(t)},i=null,o=s.listUnit(n,(function(t){return i=(i=t.data)&&1===i.length?i[0]:i,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},listSubUnit:function(t,e,n){u();var i,o={unitList:l(t)},r=null,a=function(t){return r=t.data,n&&"function"==o2.typeOf(n)?n(r):r};return i=e?s.listUnitSubNested(o,a,null,!!n):s.listUnitSubDirect(o,a,null,!!n),n?i:r},listSupUnit:function(t,e,n){u();var i,o={unitList:l(t)},r=null,a=function(t){return r=t.data,n&&"function"==o2.typeOf(n)?n(r):r};return i=e?s.listUnitSupNested(o,a,null,!!n):s.listUnitSupDirect(o,a,null,!!n),n?i:r},getUnitByIdentity:function(t,e,n){u();var i,o,r,a="current";switch(e&&("string"===typeOf(e)&&(a="type"),"number"===typeOf(e)&&(a="level")),a){case"current":var c={identityList:l(t)};o=function(t){return i=(i=t.data)&&1===i.length?i[0]:i,n&&"function"==o2.typeOf(n)?n(i):i},r=s.listUnitWithIdentity(c,o,null,!!n);break;case"type":c={identity:"object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t,type:e};o=function(t){return i=t.data,n&&"function"==o2.typeOf(n)?n(i):i},r=s.getUnitWithIdentityAndType(c,o,null,!!n);break;case"level":c={identity:"object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t,level:e};o=function(t){return i=(i=t.data)&&1===i.length?i[0]:i,n&&"function"==o2.typeOf(n)?n(i):i},r=s.getUnitWithIdentityAndLevel(c,o,null,!!n)}return n?r:i},listAllSupUnitWithIdentity:function(t,e){u();var n={identityList:l(t)},i=null,o=s.listUnitSupNestedWithIdentity(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},listUnitWithPerson:function(t,e){u();var n={personList:l(t)},i=null,o=s.listUnitWithPerson(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},listAllSupUnitWithPerson:function(t,e){u();var n={personList:l(t)},i=null,o=s.listUnitSupNestedWithPerson(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},listUnitWithAttribute:function(t,e,n){u();var i={name:t,attribute:e},o=null;return promise=s.listUnitWithAttribute(i,(function(t){return o=t.data,n&&"function"==o2.typeOf(n)?n(o):o}),null,!!n),n?promise:o},listUnitWithDuty:function(t,e,n){u();var i={name:t,identity:"object"===typeOf(e)?e.distinguishedName||e.id||e.unique||e.name:e},o=null,r=s.listUnitWithDuty(i,(function(t){return o=t.data,n&&"function"==o2.typeOf(n)?n(o):o}),null,!!n);return n?r:o},getDuty:function(t,e,n){u();var i={name:t,unit:"object"===typeOf(e)?e.distinguishedName||e.id||e.unique||e.name:e},o=null,r=s.getDuty(i,(function(t){return o=t.data,n&&"function"==o2.typeOf(n)?n(o):o}),null,!!n);return n?r:o},listDutyNameWithIdentity:function(t,e){u();var n={identityList:l(t)},i=null,o=s.listDutyNameWithIdentity(n,(function(t){return i=t.data.nameList,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},listDutyNameWithUnit:function(t,e){u();var n={unitList:l(t)},i=null,o=s.listDutyNameWithUnit(n,(function(t){return i=t.data.nameList,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},listUnitAllDuty:function(t,e){u();var n={unitList:l(t)},i=null,o=s.listUnitAllDuty(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},listTopUnit:function(t){var e=MWF.Actions.get("x_organization_assemble_control"),n=null,i=e.listTopUnit((function(e){return n=e.data,t&&"function"==o2.typeOf(t)?t(n):n}),null,!!t);return t?i:n},appendUnitAttribute:function(t,e,n,i,o,r){u();var a={attributeList:n,name:e,unit:"object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t},l=null,c=s.appendUnitAttribute(a,(function(t){return l=t.data,r&&"function"==o2.typeOf(r)?r(l):l}),null,!!r);return r?c:l},setUnitAttribute:function(t,e,n,i,o,r){u();var a={attributeList:n,name:e,unit:"object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t},l=null,c=s.setUnitAttribute(a,(function(t){return l=t.data,r&&"function"==o2.typeOf(r)?r(l):l}),null,!!r);return r?c:l},getUnitAttribute:function(t,e,n){u();var i={name:e,unit:"object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t},o=null,r=s.getUnitAttribute(i,(function(t){return o=t.data.attributeList,n&&"function"==o2.typeOf(n)?n(o):o}),null,!!n);return n?r:o},listUnitAttributeName:function(t,e){u();var n={unitList:l(t)},i=null,o=s.listUnitAttributeName(n,(function(t){return i=t.data.nameList,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i},listUnitAllAttribute:function(t,e){u();var n={unitList:l(t)},i=null,o=s.listUnitAllAttribute(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?o:i}},this.Action=(a=[],function(t,e){var n=a[t]||(a[t]=new MWF.xDesktop.Actions.RestActions("",t,""));n.getActions=function(t){this.actions||(this.actions={}),Object.merge(this.actions,e),t&&t()},this.invoke=function(t){n.invoke(t)}}),this.service={jaxwsClient:{},jaxrsClient:{}};var c=null;this.view={lookup:function(t,e,n){var i={filterList:t.filter||null};MWF.Actions.load("x_query_assemble_surface").ViewAction.executeWithQuery(t.view,t.application,i,(function(t){var n={grid:t.data.grid||t.data.groupGrid,groupGrid:t.data.groupGrid};e&&e(n)}),null,n)},lookupV1:function(t,e){!function(t){c?t&&t():MWF.require("MWF.xDesktop.Actions.RestActions",(function(){(c=new MWF.xDesktop.Actions.RestActions("","x_processplatform_assemble_surface","")).getActions=function(t){this.actions={lookup:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}/execute",method:"PUT"},getView:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}"}},t&&t()},t&&t()}))}(function(){c.invoke({name:"lookup",async:!0,parameter:{view:t.view,application:t.application},success:function(t){var n={grid:t.data.grid,groupGrid:t.data.groupGrid};e&&e(n)}.bind(this)})}.bind(this))},select:function(t,e,n){if(t.view){var o={application:t.application||i.json.application,viewName:t.view||"",isTitle:!1===t.isTitle?"no":"yes",select:!1===t.isMulti?"single":"multi",filter:t.filter};n||(n={}),n.width=t.width,n.height=t.height,n.title=t.caption;var r=n.width||"700",a=n.height||"400";if(layout.mobile){var s=document.body.getSize();r=s.x,a=s.y,n.style="viewmobile"}r=r.toInt(),a=a.toInt();var u=((s=i.app.content.getSize()).x-r)/2,l=(s.y-a)/2;u<0&&(u=0),l<0&&(l=0),layout.mobile&&(u=20,l=0);var c=this;MWF.require("MWF.xDesktop.Dialog",function(){var t=new MWF.xDesktop.Dialog({title:n.title||"select view",style:n.style||"view",top:l,left:u-20,fromTop:l,fromLeft:u-20,width:r,height:a,html:"<div style='height: 100%;'></div>",maskNode:i.app.content,container:i.app.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){e&&e(c.view.getData()),this.close()}},{text:MWF.LP.process.button.cancel,action:function(){this.close()}}]});if(t.show(),layout.mobile){var s=t.node.getElement(".MWF_dialod_Action_back"),p=t.node.getElement(".MWF_dialod_Action_ok");s&&s.addEvent("click",function(e){t.close()}.bind(this)),p&&p.addEvent("click",function(n){e&&e(this.view.getData()),t.close()}.bind(this))}MWF.xDesktop.requireApp("query.Query","Viewer",function(){this.view=new MWF.xApplication.query.Query.Viewer(t.content.getFirst(),o,{style:"select"},i.app,i.Macro)}.bind(this))}.bind(this))}}},this.statement={execute:function(t,e,n){var i=this.parseParameter(t.parameter),o={filterList:this.parseFilter(t.filter,i),parameter:i};MWF.Actions.load("x_query_assemble_surface").StatementAction.executeV2(t.name,t.mode||"data",t.page||1,t.pageSize||20,o,(function(t){e&&e(t)}),null,n)},parseFilter:function(t,e){if("array"!==typeOf(t))return[];var n=[];return(t||[]).each(function(t){var i=t.path.replace(/\./g,"_"),o=t.value;"like"===t.comparison||"notLike"===t.comparison?("%"!==o.substr(0,1)&&(o="%"+o),"%"!==o.substr(o.length-1,1)&&(o+="%"),e[i]=o):("dateTimeValue"===t.formatType||"datetimeValue"===t.formatType?o="{ts '"+o+"'}":"dateValue"===t.formatType?o="{d '"+o+"'}":"timeValue"===t.formatType&&(o="{t '"+o+"'}"),e[i]=o),t.value=i,n.push(t)}.bind(this)),n},parseParameter:function(t){if("object"!==typeOf(t))return{};var e={};for(var n in t){var i=t[n];"date"===typeOf(i)&&(i="{ts '"+i.format("db")+"'}"),e[n]=i}return e},select:function(t,e,n){if(t.name){var o={statementId:t.name||"",isTitle:!1===t.isTitle?"no":"yes",select:!1===t.isMulti?"single":"multi",filter:t.filter,parameter:t.parameter};n||(n={}),n.width=t.width,n.height=t.height,n.title=t.caption;var r=n.width||"700",a=n.height||"400";if(layout.mobile){var s=document.body.getSize();r=s.x,a=s.y,n.style="viewmobile"}r=r.toInt(),a=a.toInt();var u=((s=i.app.content.getSize()).x-r)/2,l=(s.y-a)/2;u<0&&(u=0),l<0&&(l=0),layout.mobile&&(u=20,l=0);var c=this;MWF.require("MWF.xDesktop.Dialog",function(){var t=new MWF.xDesktop.Dialog({title:n.title||"select statement view",style:n.style||"view",top:l,left:u-20,fromTop:l,fromLeft:u-20,width:r,height:a,html:"<div style='height: 100%;'></div>",maskNode:i.app.content,container:i.app.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){e&&e(c.statement.getData()),this.close()}},{text:MWF.LP.process.button.cancel,action:function(){this.close()}}]});if(t.show(),layout.mobile){var s=t.node.getElement(".MWF_dialod_Action_back"),p=t.node.getElement(".MWF_dialod_Action_ok");s&&s.addEvent("click",function(e){t.close()}.bind(this)),p&&p.addEvent("click",function(n){e&&e(this.statement.getData()),t.close()}.bind(this))}MWF.xDesktop.requireApp("query.Query","Statement",function(){this.statement=new MWF.xApplication.query.Query.Statement(t.content.getFirst(),o,{style:"select"},i.app,i.Macro)}.bind(this))}.bind(this))}}},this.importer={upload:function(t,e,n){MWF.xDesktop.requireApp("query.Query","Importer",function(){new MWF.xApplication.query.Query.Importer(i.app.content,t,{},i.app,i.Macro).load()}.bind(this))},downloadTemplate:function(t,e){MWF.xDesktop.requireApp("query.Query","Importer",function(){new MWF.xApplication.query.Query.Importer(i.app.content,t,{},i.app,i.Macro).downloadTemplate(e)}.bind(this))}};var p=[],f=function(t,e,n){var o=t;"string"==typeOf(o)&&(o={name:o});var r=o.name,a=o.type&&o.application?o.type:"process",s=o.application||i.json.application,u=a+"-"+s+"-"+r;if(p.indexOf(u)>-1)e&&e.apply(this);else{var l;switch(a){case"portal":this.scriptActionPortal?l=this.scriptActionPortal:(MWF.require("MWF.xScript.Actions.PortalScriptActions",null,!1),l=this.scriptActionPortal=new MWF.xScript.Actions.PortalScriptActions);break;case"process":this.scriptActionProcess?l=this.scriptActionProcess:(MWF.require("MWF.xScript.Actions.ScriptActions",null,!1),l=this.scriptActionProcess=new MWF.xScript.Actions.ScriptActions);break;case"cms":this.scriptActionCMS?l=this.scriptActionCMS:(MWF.require("MWF.xScript.Actions.CMSScriptActions",null,!1),l=this.scriptActionCMS=new MWF.xScript.Actions.CMSScriptActions)}l.getScriptByName(s,r,p,function(t){t.data?(p.push(u),t.data.importedList.each((function(e){"portal"===a?(p.push(a+"-"+t.data.portal+"-"+e),t.data.portalName&&p.push(a+"-"+t.data.portalName+"-"+e),t.data.portalAlias&&p.push(a+"-"+t.data.portalAlias+"-"+e)):"cms"===a?(p.push(a+"-"+t.data.appId+"-"+e),t.data.appName&&p.push(a+"-"+t.data.appName+"-"+e),t.data.appAlias&&p.push(a+"-"+t.data.appAlias+"-"+e)):"process"===a&&(p.push(a+"-"+t.data.application+"-"+e),t.data.appName&&p.push(a+"-"+t.data.appName+"-"+e),t.data.appAlias&&p.push(a+"-"+t.data.appAlias+"-"+e))})),p=p.concat(t.data.importedList),MWF.Macro.exec(t.data.text,this),e&&e.apply(this)):e&&e.apply(this)}.bind(this),null,!!n)}};this.include=function(t,e,n){if("array"==o2.typeOf(t))if(n){var i=t.length,o=0;t.each(function(t){f.apply(this,[t,function(){++o>=i&&e&&e.apply(this)}.bind(this),!0])}.bind(this))}else t.each(function(t){f.apply(this,[t])}.bind(this)),e&&e.apply(this);else f.apply(this,[t,e,n])},this.define=function(t,e,n){var i=!0;!1===n&&(i=!1);var o={};o[t]={value:e,configurable:i},MWF.defineProperties(this,o)}.bind(this),this.wait=function(){resolve={cb:this.goon.bind(this)};var t=function(t){resolve.cb=t}.bind(this);return this.target.event_resolve=t,resolve},this.goon=function(){this.target.event_resolve=null},this.page=this.form={getInfor:function(){return t.formInfor},infor:t.formInfor,getApp:function(){return i.app},app:i.app,node:function(){return i.node},readonly:i.options.readonly,get:function(t){return i.all?i.all[t]:null},getField:function(t){return o[t]},getAction:function(){return i.workAction},getDesktop:function(){return i.app.desktop},getData:function(){return new MWF.xScript.JSONData(i.getData())},save:function(t,e){i.saveWork(t,e)},close:function(){i.closeWork()},pauseTask:function(){i.pauseTask()},resumeTask:function(){i.resumeTask()},verify:function(){return!(!i.formCustomValidation("","")||!i.formValidation("",""))},process:function(t){var e=i.getOpinion().medias;t?i.submitWork(t.routeName,t.opinion,e,t.callback,t.processor,null,t.appendTaskIdentityList,t.processorOrgList,t.callbackBeforeSave):i.processWork()},reset:function(t){t?i.resetWorkToPeson(t.names,t.opinion,t.keep,t.success,t.failure):i.businessData.control.allowReset&&i.resetWork()},retract:function(t){t?i.doRetractWork(t.success,t.failure):i.businessData.control.allowRetract&&i.retractWork()},addSplit:function(t){t?i.addSplitWork(t.value,t.trimExist,t.success,t.failure):i.businessData.control.allowAddSplit&&i.addSplit()},rollback:function(t){t?i.doRollbackActionInvoke(t.log,t.flow,t.success,t.failure):i.businessData.control.allowRollback&&i.rollback()},deleteWork:function(t){t?i.doDeleteWork(t.success,t.failure):i.businessData.control.allowDelete&&i.deleteWork()},confirm:function(t,n,o,r,a,s,u,l,c,p){if(arguments.length<=1||"string"===o2.typeOf(arguments[1])){var f=MWF.getCenter({x:r,y:a});e={event:{clientX:f.x,x:f.x,clientY:f.y,y:f.y}},i.confirm(t,e,n,o,r,a,s,u,l,c,p)}else e=arguments.length>1?arguments[1]:null,n=arguments.length>2?arguments[2]:null,o=arguments.length>3?arguments[3]:null,r=arguments.length>4?arguments[4]:null,a=arguments.length>5?arguments[5]:null,s=arguments.length>6?arguments[6]:null,u=arguments.length>7?arguments[7]:null,l=arguments.length>8?arguments[8]:null,c=arguments.length>9?arguments[9]:null,p=arguments.length>10?arguments[10]:null,i.confirm(t,e,n,o,r,a,s,u,l,c,p)},alert:function(t,e,n,o,r){i.alert(t,e,n,o,r)},notice:function(t,e,n,o,r,a){i.notice(t,e,n,o,r,a)},addEvent:function(t,e){i.addEvent(t,e)},print:function(t,e){if(arguments.length){var n=arguments.length>1?arguments[0]:null,o=arguments.length>1?arguments[1]:arguments[0];i.printWork(n,o)}else i.printWork()},openWindow:function(t,e){if(arguments.length){var n=arguments.length>1?arguments[0]:null,o=arguments.length>1?arguments[1]:arguments[0];i.openWindow(o,n)}else i.openWindow()},openWork:function(t,e,n,i){var o=i||{};return o.workId=t,o.workCompletedId=e,o.docTitle=n,o.appId="process.Work"+(o.workId||o.workCompletedId),layout.desktop.openApplication(this.event,"process.Work",o)},openJob:function(t,e,n){var o=null;if(o2.Actions.get("x_processplatform_assemble_surface").listWorkByJob(t,function(t){t.data&&(o=t.data)}.bind(this),null,!1),o){var r=o.workList.length+o.workCompletedList.length;if(r){if(!(r>1&&e)){if(o.workList.length){var a=o.workList[0];return this.openWork(a.id,null,a.title,n)}a=o.workCompletedList[0];return this.openWork(null,a.id,a.title,n)}var s=new Element("div",{styles:{padding:"20px",width:"500px"}}).inject(i.node);o.workList.each(function(t){var e=new Element("div",{styles:{background:"#ffffff","border-radius":"10px",clear:"both","margin-bottom":"10px",height:"40px",padding:"10px 10px"}}).inject(s),i="<div style='height: 40px; width: 40px; float: left; background: url(../x_component_process_Xform/$Form/default/icon/work.png) no-repeat center center'></div><div style='height: 40px; width: 40px; float: right'><div class='MWFAction' style='height: 20px; width: 40px; margin-top: 10px; border: 1px solid #999999; border-radius: 5px;text-align: center; cursor: pointer'>"+o2.LP.widget.open+"</div></div><div style='height: 20px; line-height: 20px; margin: 0px 40px'>"+t.title+"</div><div style='margin: 0px 40px'><div style='color:#999999; float: left; margin-right: 10px'>"+t.activityName+"</div><div style='color:#999999; float: left; margin-right: 10px'>"+t.activityArrivedTime+"</div><div style='color:#999999; float: left; margin-right: 10px'>"+(t.manualTaskIdentityText||"")+"</div></div>";e.set("html",i);var o=e.getElement(".MWFAction");o.store("work",t),o.addEvent("click",function(t){var e=t.target.retrieve("work");e&&this.openWork(e.id,null,e.title,n),l.close()}.bind(this))}.bind(this)),o.workCompletedList.each(function(t){var e=new Element("div",{styles:{background:"#ffffff","border-radius":"10px",clear:"both","margin-bottom":"10px",height:"40px",padding:"10px 10px"}}).inject(s),i="<div style='height: 40px; width: 40px; float: left; background: url(../x_component_process_Xform/$Form/default/icon/work.png) no-repeat center center'></div><div style='height: 40px; width: 40px; float: right'><div class='MWFAction' style='height: 20px; width: 40px; margin-top: 10px; border: 1px solid #999999; border-radius: 5px;text-align: center; cursor: pointer'>"+o2.LP.widget.open+"</div></div><div style='height: 20px; line-height: 20px; margin: 0px 40px'>"+t.title+"</div><div style='margin: 0px 40px'><div style='color:#999999; float: left; margin-right: 10px'>"+o2.LP.widget.workcompleted+"</div><div style='color:#999999; float: left; margin-right: 10px'>"+t.completedTime+"</div>";e.set("html",i);var o=e.getElement(".MWFAction");o.store("work",t),o.addEvent("click",function(t){var e=t.target.retrieve("work");e&&this.openWork(null,e.id,e.title,n),l.close()}.bind(this))}.bind(this));var u=s.getSize().y+20;u>600&&(u=600);var l=o2.DL.open({title:o2.LP.widget.choiceWork,style:"user",isResize:!1,content:s,buttonList:[{type:"cancel",text:o2.LP.widget.close,action:function(){l.close()}}]})}}},openDocument:function(t,e,n){var i=n||{};i.documentId=t,i.docTitle=e,layout.desktop.openApplication(this.event,"cms.Document",i)},openPortal:function(t,e,n){var i=MWF.Actions.get("x_portal_assemble_surface");i.getApplication(t,(function(t){t.data&&(e?i.getPageByName(e,t.data.id,(function(e){var i=e.data?e.data.id:"";layout.desktop.openApplication(null,"portal.Portal",{portalId:t.data.id,pageId:i,parameters:n,appId:n&&n.appId||"portal.Portal"+t.data.id+i})})):layout.desktop.openApplication(null,"portal.Portal",{portalId:t.data.id,parameters:n,appId:n&&n.appId||"portal.Portal"+t.data.id}))}))},openCMS:function(t){MWF.Actions.get("x_cms_assemble_control").getColumn(t,(function(t){t.data&&layout.desktop.openApplication(null,"cms.Module",{columnId:t.data.id,appId:"cms.Module"+t.data.id})}))},openProcess:function(t){MWF.Actions.get("x_processplatform_assemble_surface").getApplication(t,(function(t){t.data&&layout.desktop.openApplication(null,"process.Application",{id:t.data.id,appId:"process.Application"+t.data.id})}))},openApplication:function(t,e){layout.desktop.openApplication(null,t,e)},createDocument:function(t,e,n,o,r,a,s,u,l){var c,p,f=t;"object"==typeOf(t)&&(f=t.column,e=t.category,n=t.data,o=t.identity,r=t.callback,a=t.target,s=t.latest,u=t.selectColumnEnable,l=t.ignoreTitle,c=t.onAfterPublish,p=t.onPostPublish),a&&layout.app&&layout.app.inBrowser&&(layout.app.content.empty(),layout.app=null),MWF.xDesktop.requireApp("cms.Index","Newer",(function(){new MWF.xApplication.cms.Index.Newer(null,null,i.app,null,{documentData:n,identity:o,ignoreTitle:!0===l,ignoreDrafted:!1===s,selectColumnEnable:!e||!0===u,restrictToColumn:!!e&&!0!==u,categoryFlag:e,columnFlag:f,onStarted:function(t,e){r&&r()},onPostPublish:function(){p&&p()},onAfterPublish:function(){c&&c()}}).load()}))},startProcess:function(t,e,n,o,r,a,s){if(arguments.length>2)for(var u=2;u<arguments.length;u++)if("boolean"==typeOf(arguments[u])){a=arguments[u];break}a&&layout.app&&layout.app.inBrowser&&(layout.app.$openWithSelf=!0);MWF.Actions.get("x_processplatform_assemble_surface").getProcessByName(e,t,(function(t){t.data&&MWF.xDesktop.requireApp("process.TaskCenter","ProcessStarter",function(){new MWF.xApplication.process.TaskCenter.ProcessStarter(t.data,i.app,{workData:n,identity:o,latest:s,onStarted:function(t,e,n){if(t.work){var i={draft:t.work,appId:"process.Work"+(new o2.widget.UUID).toString(),desktopReload:!1};layout.desktop.openApplication(null,"process.Work",i)}else{var o=[];if(t.each(function(t){-1!=t.currentTaskIndex&&o.push(t.taskList[t.currentTaskIndex].work)}.bind(this)),1==o.length){i={workId:o[0],appId:o[0]};layout.desktop.openApplication(null,"process.Work",i)}}r&&r(t)}.bind(this)}).load()}.bind(this))}))}},Object.defineProperty(this.form,"readonly",{get:function(){return i.options.readonly}}),this.form.medias=[],this.target=t.target,this.event=t.event,this.status=t.status,this.session=layout.desktop.session,this.Actions=o2.Actions,this.query=function(t){if(t){var e=t.data||{};t.firstResult&&(e.firstResult=t.firstResult.toInt()),t.maxResults&&(e.maxResults=t.maxResults.toInt()),o2.Actions.get("x_query_assemble_surface").executeStatement(t.name,e,success,error,options.async)}},this.Table=MWF.xScript.createTable()},MWF.xScript.createTable=function(){return function(t){this.name=t,this.action=o2.Actions.get("x_query_assemble_surface"),this.listRowNext=function(t,e,n,i,o){this.action.listRowNext(this.name,t,e,n,i,o)},this.listRowPrev=function(t,e,n,i,o){this.action.listRowPrev(this.name,t,e,n,i,o)},this.listRowPrev=function(t,e,n,i,o){this.action.listRowPrev(this.name,t,e,n,i,o)},this.listRowSelectWhere=function(t,e,n,i){this.action.listRowSelectWhere(this.name,t,e,n,i)},this.listRowCountWhere=function(t,e,n,i){this.action.listRowCountWhere(this.name,t,e,n,i)},this.deleteRow=function(t,e,n,i){this.action.deleteRow(this.name,t,e,n,i)},this.deleteAllRow=function(t,e,n){this.action.deleteAllRow(this.name,t,e,n)},this.getRow=function(t,e,n,i){this.action.getRow(this.name,t,e,n,i)},this.insertRow=function(t,e,n,i){this.action.insertRow(this.name,t,e,n,i)},this.updateRow=function(t,e,n,i,o){this.action.updateRow(this.name,t,e,n,i,o)}}},MWF.xScript.JSONData=function(t,e,n,i,o){var r=function(t,e,n,i){return function(){return-1===["array","object"].indexOf(typeOf(t[n]))?t[n]:new MWF.xScript.JSONData(t[n],e,n,i,o)}},a=function(t,e,n,i){return function(o){t[n]=o,e&&e(t,n,i)}},s=typeOf(t);"object"!==s&&"array"!==s||function(){var s={};for(var u in t)s[u]={configurable:!0,enumerable:!0,get:r.apply(this,[t,e,u,this]),set:a.apply(this,[t,e,u,this])};s.length={get:function(){return Object.keys(t).length}},s.some={get:function(){return t.some}},MWF.defineProperties(this,s);var l={getKey:{value:function(){return n}},getParent:{value:function(){return i}},toString:{value:function(){return t.toString()}},setSection:{value:function(t,e){this.add(t,e,!0);try{var n=[this.getKey()];for(p=this.getParent();p&&p.getKey();)n.unshift(p.getKey()),p=p.getParent();n.length&&(o.sectionListObj[n.join(".")]=t)}catch(t){}}},add:{value:function(n,i,o){var s=!0,u=typeOf(t);if("array"===u){if(arguments.length<2?(t.push(n),i=n,n=t.length-1):n||0===n?s=!1:(t.push(i),n=t.length-1),s)(l={})[n]={configurable:!0,enumerable:!0,get:r.apply(this,[t,e,n,this]),set:a.apply(this,[t,e,n,this])},MWF.defineProperties(this,l);this[n]=i}else if("object"===u)if(this.hasOwnProperty(n))o&&(this[n]=i);else{var l;if(t[n]=i,s)(l={})[n]={configurable:!0,enumerable:!0,get:r.apply(this,[t,e,n,this]),set:a.apply(this,[t,e,n,this])},MWF.defineProperties(this,l);this[n]=i}return this[n]}},del:{value:function(e){return this.hasOwnProperty(e)?(t[e]="",this[e]="",this):null}}};MWF.defineProperties(this,l)}.apply(this)},MWF.xScript.dictLoaded||(MWF.xScript.dictLoaded={}),MWF.xScript.addDictToCache=function(t,e,n){e||(e="root"),0!==e.indexOf("root")&&(e="root."+e);var i=t.appType||"process",o=t.enableAnonymous||!1,r=[];t.application&&r.push(t.application),t.appId&&r.push(t.appId),t.appName&&r.push(t.appName),t.appAlias&&r.push(t.appAlias);var a=[];t.id&&a.push(t.id),t.name&&a.push(t.name),t.alias&&a.push(t.alias),(f={})[e]=n;for(var s=0;s<r.length;s++)for(var u=0;u<a.length;u++){var l=a[u]+i+r[s]+o;if(MWF.xScript.dictLoaded[l]){if(0===s&&0===u){MWF.xScript.setDictToCache(l,e,n);for(var c,p=e.split(/\./g),f=MWF.xScript.dictLoaded[l],d=0;d<p.length&&(c=0===d?p[0]:c+"."+p[d],!f[c]);d++);if(c){var h=c+".";Object.keys(f).each((function(t,e){0===t.indexOf(h)&&delete f[t]}))}}}else MWF.xScript.dictLoaded[l]=f}},MWF.xScript.getMatchedDict=function(t,e){e||(e="root"),0!==e.indexOf("root")&&(e="root."+e);var n=e.split(/\./g);if(MWF.xScript.dictLoaded[t]){for(var i,o,r=MWF.xScript.dictLoaded[t],a=Array.clone(n),s=0;s<n.length;s++)if(i=0===s?n[0]:i+"."+n[s],a.shift(),r[i]){o=r[i];break}return{dict:o,unmatchedPathList:a}}return{dict:null,unmatchedPathList:a}},MWF.xScript.insertDictToCache=function(t,e,n){if(MWF.xScript.dictLoaded[t]){var i=MWF.xScript.getMatchedDict(t,e),o=i.dict,r=i.unmatchedPathList;if(o){for(var a=0;a<r.length-1;a++)o[r[a]]||(o[r[a]]={}),o=o[r[a]];var s=r[r.length-1];o[s]?"array"===typeOf(o[s])&&o[s].push(n):o[s]=n}else MWF.xScript.dictLoaded[t][e]=n}else MWF.xScript.dictLoaded[t]={},MWF.xScript.dictLoaded[t][e]=n},MWF.xScript.setDictToCache=function(t,e,n){if(MWF.xScript.dictLoaded[t]){var i=MWF.xScript.getMatchedDict(t,e),o=i.dict,r=i.unmatchedPathList;if(o){for(var a=0;a<r.length-1;a++)o[r[a]]||(o[r[a]]={}),o=o[r[a]];o[r[r.length-1]]=n}else MWF.xScript.dictLoaded[t][e]=n}else MWF.xScript.dictLoaded[t]={},MWF.xScript.dictLoaded[t][e]=n},MWF.xScript.getDictFromCache=function(t,e){var n=MWF.xScript.getMatchedDict(t,e),i=n.dict,o=n.unmatchedPathList;if(i){for(var r=0;r<o.length;r++)if(!(i=i[o[r]]))return null;return i}return null},MWF.xScript.deleteDictToCache=function(t,e){var n=MWF.xScript.getMatchedDict(t,e),i=n.dict,o=n.unmatchedPathList;if(i){for(var r=0;r<o.length-1;r++)if(!(i=i[o[r]]))return;delete i[o[o.length-1]]}},MWF.xScript.createDict=function(t){return function(e){var n=e;"string"==typeOf(n)&&(n={name:n});var i=this.name=n.name,o=n.type&&n.application?n.type:"process",r=n.application||t,a=n.enableAnonymous||!1,s={appType:o,name:i,appId:r,enableAnonymous:a},u=i+o+r+a;if("cms"==o)var l=MWF.Actions.get("x_cms_assemble_control");else l=MWF.Actions.get("x_processplatform_assemble_surface");var c=function(t){return t.split(/\./g).map((function(t){return encodeURIComponent(t)})).join("/")};this.get=function(t,e,n,i,p){var f=null;if(!0===e&&(i=!0),!0===n&&(i=!0),!p){var d=MWF.xScript.getDictFromCache(u,t);if(d)return e&&"function"==o2.typeOf(e)&&e(d),i?Promise.resolve(d):d}var h,g=function(n){return f=n.data,MWF.xScript.addDictToCache(s,t,f),e&&"function"==o2.typeOf(e)&&(f=e(n.data)),f};if(t){var m=c(t);h=l[a&&"cms"==o?"getDictDataAnonymous":"getDictData"](encodeURIComponent(this.name),r,m,g,null,!!i,!1)}else h=l[a&&"cms"==o?"getDictRootAnonymous":"getDictRoot"](this.name,r,g,null,!!i,!1);return i?h:f},this.set=function(t,e,n,i){var o=c(t);return l.setDictData(encodeURIComponent(this.name),r,o,e,(function(i){if(MWF.xScript.setDictToCache(u,t,e),n)return n(i.data)}),(function(t,e,n){if(i)return i(t,e,n)}),!1,!1)},this.add=function(t,e,n,i){var o=c(t);return l.addDictData(encodeURIComponent(this.name),r,o,e,(function(i){if(MWF.xScript.insertDictToCache(u,t,e),n)return n(i.data)}),(function(t,e,n){if(i)return i(t,e,n)}),!1,!1)},this.delete=function(t,e,n){var i=c(t);return l.deleteDictData(encodeURIComponent(this.name),r,i,(function(n){if(MWF.xScript.deleteDictToCache(u,t),e)return e(n.data)}),(function(t,e,i){if(n)return n(t,e,i)}),!1,!1)},this.destory=this.delete}};