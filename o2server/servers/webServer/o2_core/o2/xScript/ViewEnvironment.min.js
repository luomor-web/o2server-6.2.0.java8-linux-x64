MWF.xScript=MWF.xScript||{},MWF.xScript.ViewEnvironment=function(t){var n=t.view;this.library=COMMON,this.Dict=MWF.xScript.createDict();var i,o=null,r=function(){o||(MWF.require("MWF.xScript.Actions.UnitActions",null,!1),o=new MWF.xScript.Actions.UnitActions)},a=function(t){var e=typeOf(t);if("array"===e){var n=[];return t.each((function(t){n.push("object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t)})),n}return["object"===e?t.distinguishedName||t.id||t.unique||t.name:t]};this.org={getIdentity:function(t,e){r();var n={identityList:a(t)},i=null,u=o.listIdentity(n,(function(t){return i=(i=t.data)&&1===i.length?i[0]:i,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},listIdentityWithPerson:function(t,e){r();var n={personList:a(t)},i=null,u=o.listIdentityWithPerson(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},listIdentityWithUnit:function(t,e,n){r();var i={unitList:a(t)},u=null,l=o[e?"listIdentityWithUnitNested":"listIdentityWithUnitDirect"](i,(function(t){return u=t.data,n&&"function"==o2.typeOf(n)?n(u):u}),null,!!n);return l.name="org",n?l:u},getUnit:function(t,e){r();var n={unitList:a(t)},i=null,u=o.listUnit(n,(function(t){return i=(i=t.data)&&1===i.length?i[0]:i,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},listSubUnit:function(t,e,n){r();var i,u={unitList:a(t)},l=null,s=function(t){return l=t.data,n&&"function"==o2.typeOf(n)?n(l):l};return i=e?o.listUnitSubNested(u,s,null,!!n):o.listUnitSubDirect(u,s,null,!!n),n?i:l},listSupUnit:function(t,e,n){r();var i,u={unitList:a(t)},l=null,s=function(t){return l=t.data,n&&"function"==o2.typeOf(n)?n(l):l};return i=e?o.listUnitSupNested(u,s,null,!!n):o.listUnitSupDirect(u,s,null,!!n),n?i:l},getUnitByIdentity:function(t,e,n){r();var i,u,l,s="current";switch(e&&("string"===typeOf(e)&&(s="type"),"number"===typeOf(e)&&(s="level")),s){case"current":var c={identityList:a(t)};u=function(t){return i=(i=t.data)&&1===i.length?i[0]:i,n&&"function"==o2.typeOf(n)?n(i):i},l=o.listUnitWithIdentity(c,u,null,!!n);break;case"type":c={identity:"object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t,type:e};u=function(t){return i=t.data,n&&"function"==o2.typeOf(n)?n(i):i},l=o.getUnitWithIdentityAndType(c,u,null,!!n);break;case"level":c={identity:"object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t,level:e};u=function(t){return i=(i=t.data)&&1===i.length?i[0]:i,n&&"function"==o2.typeOf(n)?n(i):i},l=o.getUnitWithIdentityAndLevel(c,u,null,!!n)}return n?l:i},listAllSupUnitWithIdentity:function(t,e){r();var n={identityList:a(t)},i=null,u=o.listUnitSupNestedWithIdentity(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},listUnitWithPerson:function(t,e){r();var n={personList:a(t)},i=null,u=o.listUnitWithPerson(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},listAllSupUnitWithPerson:function(t,e){r();var n={personList:a(t)},i=null,u=o.listUnitSupNestedWithPerson(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},listUnitWithAttribute:function(t,e,n){r();var i={name:t,attribute:e},a=null;return promise=o.listUnitWithAttribute(i,(function(t){return a=t.data,n&&"function"==o2.typeOf(n)?n(a):a}),null,!!n),n?promise:a},listUnitWithDuty:function(t,e,n){r();var i={name:t,identity:"object"===typeOf(e)?e.distinguishedName||e.id||e.unique||e.name:e},a=null,u=o.listUnitWithDuty(i,(function(t){return a=t.data,n&&"function"==o2.typeOf(n)?n(a):a}),null,!!n);return n?u:a},listTopUnit:function(t){var e=MWF.Actions.get("x_organization_assemble_control"),n=null,i=e.listTopUnit((function(e){return n=e.data,t&&"function"==o2.typeOf(t)?t(n):n}),null,!!t);return t?i:n},getPerson:function(t,e){r();var n={personList:a(t)},i=null,u=o.listPerson(n,(function(t){return i=(i=t.data)&&1===i.length?i[0]:i,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},listSubPerson:function(t,e,n){r();var i,u={personList:a(t)},l=null,s=function(t){return l=t.data,n&&"function"==o2.typeOf(n)?n(l):l};return i=e?o.listPersonSubNested(u,s,null,!!n):o.listPersonSubDirect(u,s,null,!!n),n?i:l},listSupPerson:function(t,e,n){r();var i,u={personList:a(t)},l=null,s=function(t){return l=t.data,n&&"function"==o2.typeOf(n)?n(l):l};return i=e?o.listPersonSupNested(u,s,null,!!n):o.listPersonSupDirect(u,s,null,!!n),n?i:l},listPersonWithGroup:function(t,e){r();var n={groupList:a(t)},i=null,u=o.listPersonWithGroup(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},listPersonWithRole:function(t,e){r();var n,i={roleList:a(t)},u=null;return n=o.listPersonWithRole(i,(function(t){return u=t.data,e&&"function"==o2.typeOf(e)?e(u):u}),null,!!e),e?n:u},listPersonWithIdentity:function(t,e){r();var n={identityList:a(t)},i=null,u=o.listPersonWithIdentity(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},getPersonWithIdentity:function(t,e){r();var n={identityList:a(t)},i=null,u=o.listPersonWithIdentity(n,(function(t){return i=(i=t.data)&&1===i.length?i[0]:i,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},listPersonWithUnit:function(t,e,n){r();var i,u={unitList:a(t)},l=null,s=function(t){return l=t.data,n&&"function"==o2.typeOf(n)?n(l):l};return i=e?o.listPersonWithUnitNested(u,s,null,!!n):o.listPersonWithUnitDirect(u,s,null,!!n),n?i:l},listPersonWithAttribute:function(t,e,n){r();var i={name:t,attribute:e},a=null,u=o.listPersonWithAttribute(i,(function(t){return a=t.data,n&&"function"==o2.typeOf(n)?n(a):a}),null,!!n);return n?u:a},listPersonNameWithAttribute:function(t,e,n){r();var i={name:t,attribute:e},a=null,u=o.listPersonWithAttributeValue(i,(function(t){return a=t.data.personList,n&&"function"==o2.typeOf(n)?n(a):a}),null,!!n);return n?u:a},getDuty:function(t,e,n){r();var i={name:t,unit:"object"===typeOf(e)?e.distinguishedName||e.id||e.unique||e.name:e},a=null,u=o.getDuty(i,(function(t){return a=t.data,n&&"function"==o2.typeOf(n)?n(a):a}),null,!!n);return n?u:a},listDutyNameWithIdentity:function(t,e){r();var n={identityList:a(t)},i=null,u=o.listDutyNameWithIdentity(n,(function(t){return i=t.data.nameList,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},listDutyNameWithUnit:function(t,e){r();var n={unitList:a(t)},i=null,u=o.listDutyNameWithUnit(n,(function(t){return i=t.data.nameList,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},listUnitAllDuty:function(t,e){r();var n={unitList:a(t)},i=null,u=o.listUnitAllDuty(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},getGroup:function(t,e){r();var n={groupList:a(t)},i=null,u=o.listGroup(n,(function(t){return i=(i=t.data)&&1===i.length?i[0]:i,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},listSubGroup:function(t,e,n){r();var i,u={groupList:a(t)},l=null,s=function(t){return l=t.data,n&&"function"==o2.typeOf(n)?n(l):l};return i=e?o.listSubGroupNested(u,s,null,!!n):o.listSubGroupDirect(u,s,null,!!n),n?i:l},listSupGroup:function(t,e,n){r();var i={groupList:a(t)},u=null,l=function(t){return u=t.data,n&&"function"==o2.typeOf(n)?n(u):u};if(e)var s=o.listSupGroupNested(i,l,null,!!n);else s=o.listSupGroupDirect(i,l,null,!!n);return n?s:u},listGroupWithPerson:function(t,e){r();var n={personList:a(t)},i=null,u=o.listGroupWithPerson(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},getRole:function(t,e){r();var n={roleList:a(t)},i=null,u=o.listRole(n,(function(t){return i=(i=t.data)&&1===i.length?i[0]:i,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},listRoleWithPerson:function(t,e){r();var n={personList:a(t)},i=null,u=o.listRoleWithPerson(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},personHasRole:function(t,e,n){r(),nameFlag="object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t;var i={person:nameFlag,roleList:a(e)},u=!1,l=o.listRoleWithPerson(i,(function(t){return u=t.data.value,n&&"function"==o2.typeOf(n)?n(u):u}),null,!!n);return n?l:u},groupHasRole:function(t,e,n){r(),nameFlag="object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t;var i={group:nameFlag,roleList:a(e)},u=!1,l=o.groupHasRole(i,(function(t){return u=t.data.value,n&&"function"==o2.typeOf(n)?n(u):u}),null,!!n);return n?l:u},appendPersonAttribute:function(t,e,n,i,a,u){r();var l={attributeList:n,name:e,person:"object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t},s=null,c=o.appendPersonAttribute(l,(function(t){return s=t.data,u&&"function"==o2.typeOf(u)?u(s):s}),null,!!u);return u?c:s},setPersonAttribute:function(t,e,n,i,a,u){r();var l={attributeList:n,name:e,person:"object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t},s=null,c=o.setPersonAttribute(l,(function(t){return s=t.data,u&&"function"==o2.typeOf(u)?u(s):s}),null,!!u);return u?c:s},getPersonAttribute:function(t,e,n){r();var i={name:e,person:"object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t},a=null,u=o.getPersonAttribute(i,(function(t){return a=t.data.attributeList,n&&"function"==o2.typeOf(n)?n(a):a}),null,!!n);return n?u:a},listPersonAttributeName:function(t,e){r();var n={personList:a(t)},i=null,u=o.listPersonAttributeName(n,(function(t){return i=t.data.nameList,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},listPersonAllAttribute:function(t,e){r();var n={personList:a(t)},i=null,u=o.listPersonAllAttribute(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},appendUnitAttribute:function(t,e,n,i,a,u){r();var l={attributeList:n,name:e,unit:"object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t},s=null,c=o.appendUnitAttribute(l,(function(t){return s=t.data,u&&"function"==o2.typeOf(u)?u(s):s}),null,!!u);return u?c:s},setUnitAttribute:function(t,e,n,i,a,u){r();var l={attributeList:n,name:e,unit:"object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t},s=null,c=o.setUnitAttribute(l,(function(t){return s=t.data,u&&"function"==o2.typeOf(u)?u(s):s}),null,!!u);return u?c:s},getUnitAttribute:function(t,e,n){r();var i={name:e,unit:"object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t},a=null,u=o.getUnitAttribute(i,(function(t){return a=t.data.attributeList,n&&"function"==o2.typeOf(n)?n(a):a}),null,!!n);return n?u:a},listUnitAttributeName:function(t,e){r();var n={unitList:a(t)},i=null,u=o.listUnitAttributeName(n,(function(t){return i=t.data.nameList,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i},listUnitAllAttribute:function(t,e){r();var n={unitList:a(t)},i=null,u=o.listUnitAllAttribute(n,(function(t){return i=t.data,e&&"function"==o2.typeOf(e)?e(i):i}),null,!!e);return e?u:i}},this.Action=(i=[],function(t,e){var n=i[t]||(i[t]=new MWF.xDesktop.Actions.RestActions("",t,""));n.getActions=function(t){this.actions||(this.actions={}),Object.merge(this.actions,e),t&&t()},this.invoke=function(t){n.invoke(t)}}),this.service={jaxwsClient:{},jaxrsClient:{}};var u=null;this.view={lookup:function(t,e,n){var i={filterList:t.filter||null};MWF.Actions.load("x_query_assemble_surface").ViewAction.executeWithQuery(t.view,t.application,i,(function(t){var n={grid:t.data.grid||t.data.groupGrid,groupGrid:t.data.groupGrid};e&&e(n)}),null,n)},lookupV1:function(t,e){!function(t){u?t&&t():MWF.require("MWF.xDesktop.Actions.RestActions",(function(){(u=new MWF.xDesktop.Actions.RestActions("","x_processplatform_assemble_surface","")).getActions=function(t){this.actions={lookup:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}/execute",method:"PUT"},getView:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}"}},t&&t()},t&&t()}))}(function(){u.invoke({name:"lookup",async:!0,parameter:{view:t.view,application:t.application},success:function(t){var n={grid:t.data.grid,groupGrid:t.data.groupGrid};e&&e(n)}.bind(this)})}.bind(this))},select:function(t,e,i){if(t.view){var o={application:t.application||n.json.application,viewName:t.view||"",isTitle:!1===t.isTitle?"no":"yes",select:!1===t.isMulti?"single":"multi",filter:t.filter};i||(i={}),i.width=t.width,i.height=t.height,i.title=t.caption;var r=i.width||"700",a=i.height||"400";if(layout.mobile){var u=document.body.getSize();r=u.x,a=u.y,i.style="viewmobile"}r=r.toInt(),a=a.toInt();var l=((u=n.app.content.getSize()).x-r)/2,s=(u.y-a)/2;l<0&&(l=0),s<0&&(s=0),layout.mobile&&(l=20,s=0);var c=this;MWF.require("MWF.xDesktop.Dialog",function(){var t=new MWF.xDesktop.Dialog({title:i.title||"select view",style:i.style||"view",top:s,left:l-20,fromTop:s,fromLeft:l-20,width:r,height:a,html:"<div style='height: 100%;'></div>",maskNode:n.app.content,container:n.app.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){e&&e(c.view.getData()),this.close()}},{text:MWF.LP.process.button.cancel,action:function(){this.close()}}]});if(t.show(),layout.mobile){var u=t.node.getElement(".MWF_dialod_Action_back"),p=t.node.getElement(".MWF_dialod_Action_ok");u&&u.addEvent("click",function(e){t.close()}.bind(this)),p&&p.addEvent("click",function(n){e&&e(this.view.getData()),t.close()}.bind(this))}MWF.xDesktop.requireApp("query.Query","Viewer",function(){this.view=new MWF.xApplication.query.Query.Viewer(t.content.getFirst(),o,{style:"select"},n.app,n.Macro)}.bind(this))}.bind(this))}}},this.statement={execute:function(t,e,n){var i=this.parseParameter(t.parameter),o={filterList:this.parseFilter(t.filter,i),parameter:i};MWF.Actions.load("x_query_assemble_surface").StatementAction.executeV2(t.name,t.mode||"data",t.page||1,t.pageSize||20,o,(function(t){e&&e(t)}),null,n)},parseFilter:function(t,e){if("array"!==typeOf(t))return[];var n=[];return(t||[]).each(function(t){var i=t.path.replace(/\./g,"_"),o=t.value;"like"===t.comparison||"notLike"===t.comparison?("%"!==o.substr(0,1)&&(o="%"+o),"%"!==o.substr(o.length-1,1)&&(o+="%"),e[i]=o):("dateTimeValue"===t.formatType||"datetimeValue"===t.formatType?o="{ts '"+o+"'}":"dateValue"===t.formatType?o="{d '"+o+"'}":"timeValue"===t.formatType&&(o="{t '"+o+"'}"),e[i]=o),t.value=i,n.push(t)}.bind(this)),n},parseParameter:function(t){if("object"!==typeOf(t))return{};var e={};for(var n in t){var i=t[n];"date"===typeOf(i)&&(i="{ts '"+i.format("db")+"'}"),e[n]=i}return e},select:function(t,e,i){if(t.name){var o={statementId:t.name||"",isTitle:!1===t.isTitle?"no":"yes",select:!1===t.isMulti?"single":"multi",filter:t.filter,parameter:t.parameter};i||(i={}),i.width=t.width,i.height=t.height,i.title=t.caption;var r=i.width||"700",a=i.height||"400";if(layout.mobile){var u=document.body.getSize();r=u.x,a=u.y,i.style="viewmobile"}r=r.toInt(),a=a.toInt();var l=((u=n.app.content.getSize()).x-r)/2,s=(u.y-a)/2;l<0&&(l=0),s<0&&(s=0),layout.mobile&&(l=20,s=0);var c=this;MWF.require("MWF.xDesktop.Dialog",function(){var t=new MWF.xDesktop.Dialog({title:i.title||"select statement view",style:i.style||"view",top:s,left:l-20,fromTop:s,fromLeft:l-20,width:r,height:a,html:"<div style='height: 100%;'></div>",maskNode:n.app.content,container:n.app.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){e&&e(c.statement.getData()),this.close()}},{text:MWF.LP.process.button.cancel,action:function(){this.close()}}]});if(t.show(),layout.mobile){var u=t.node.getElement(".MWF_dialod_Action_back"),p=t.node.getElement(".MWF_dialod_Action_ok");u&&u.addEvent("click",function(e){t.close()}.bind(this)),p&&p.addEvent("click",function(n){e&&e(this.statement.getData()),t.close()}.bind(this))}MWF.xDesktop.requireApp("query.Query","Statement",function(){this.statement=new MWF.xApplication.query.Query.Statement(t.content.getFirst(),o,{style:"select"},n.app,n.Macro)}.bind(this))}.bind(this))}}},this.importer={upload:function(t,e,i){MWF.xDesktop.requireApp("query.Query","Importer",function(){new MWF.xApplication.query.Query.Importer(n.app.content,t,{},n.app,n.Macro).load()}.bind(this))},downloadTemplate:function(t,e){MWF.xDesktop.requireApp("query.Query","Importer",function(){new MWF.xApplication.query.Query.Importer(n.app.content,t,{},n.app,n.Macro).downloadTemplate(e)}.bind(this))}};var l=[];this.include=function(t,e){var i=t;"string"==typeOf(i)&&(i={name:i});var o=i.name,r=i.type&&i.application?i.type:"portal",a=i.application||n.json.application,u=r+"-"+a+"-"+o;if(l.indexOf(u)>-1)e&&e.apply(this);else{var s;switch(r){case"portal":this.scriptActionPortal?s=this.scriptActionPortal:(MWF.require("MWF.xScript.Actions.PortalScriptActions",null,!1),s=this.scriptActionPortal=new MWF.xScript.Actions.PortalScriptActions);break;case"process":this.scriptActionProcess?s=this.scriptActionProcess:(MWF.require("MWF.xScript.Actions.ScriptActions",null,!1),s=this.scriptActionProcess=new MWF.xScript.Actions.ScriptActions);break;case"cms":this.scriptActionCMS?s=this.scriptActionCMS:(MWF.require("MWF.xScript.Actions.CMSScriptActions",null,!1),s=this.scriptActionCMS=new MWF.xScript.Actions.CMSScriptActions)}s.getScriptByName(a,o,l,function(t){t.data?(l.push(u),t.data.importedList.each((function(e){"portal"===r?(l.push(r+"-"+t.data.portal+"-"+e),t.data.portalName&&l.push(r+"-"+t.data.portalName+"-"+e),t.data.portalAlias&&l.push(r+"-"+t.data.portalAlias+"-"+e)):"cms"===r?(l.push(r+"-"+t.data.appId+"-"+e),t.data.appName&&l.push(r+"-"+t.data.appName+"-"+e),t.data.appAlias&&l.push(r+"-"+t.data.appAlias+"-"+e)):"process"===r&&(l.push(r+"-"+t.data.application+"-"+e),t.data.appName&&l.push(r+"-"+t.data.appName+"-"+e),t.data.appAlias&&l.push(r+"-"+t.data.appAlias+"-"+e))})),l=l.concat(t.data.importedList),MWF.Macro.exec(t.data.text,this),e&&e.apply(this)):e&&e.apply(this)}.bind(this),null,!1)}},this.define=function(t,e,n){var i=!0;!1===n&&(i=!1);var o={};o[t]={value:e,configurable:i},MWF.defineProperties(this,o)}.bind(this),this.page=this.form=this.queryView=this.queryStatement={getParentEnvironment:function(){return n.getParentEnvironment()},getStatementInfor:function(){return n.getStatementInfor?n.getStatementInfor():null},getViewInfor:function(){return n.getViewInfor()},getPageInfor:function(){return n.getPageInfor()},getPageData:function(){return n.getPageData()},toPage:function(t,e){return n.toPage(t,e)},selectAll:function(){return n.selectAll()},unSelectAll:function(){return n.unSelectAll()},getSelectedData:function(){return n.getSelectedData()},setFilter:function(t,e){return n.setFilter(t,e)},setStatementFilter:function(t,e,i){return n.setFilter(t,e,i)},switchView:function(t){return n.switchView(t)},switchStatement:function(t){n.switchStatement&&n.switchStatement(t)},reload:function(){n.reload()},node:function(){return n.node},getDesktop:function(){return n.app?n.app.desktop:null},confirm:function(t,i,o,r,a,u,l,s,c,p){if(arguments.length<=1||"string"===o2.typeOf(arguments[1])){var d=MWF.getCenter({x:r,y:a});e={event:{clientX:d.x,x:d.x,clientY:d.y,y:d.y}},n.confirm(t,e,i,o,r,a,u,l,s,c,p)}else e=arguments.length>1?arguments[1]:null,i=arguments.length>2?arguments[2]:null,o=arguments.length>3?arguments[3]:null,r=arguments.length>4?arguments[4]:null,a=arguments.length>5?arguments[5]:null,u=arguments.length>6?arguments[6]:null,l=arguments.length>7?arguments[7]:null,s=arguments.length>8?arguments[8]:null,c=arguments.length>9?arguments[9]:null,p=arguments.length>10?arguments[10]:null,n.confirm(t,e,i,o,r,a,u,l,s,c,p)},alert:function(t,e,i,o,r){n.alert(t,e,i,o,r)},notice:function(t,e,i,o,r,a){n.notice(t,e,i,o,r,a)},addEvent:function(t,e){n.addEvent(t,e)},openWork:function(t,e,n,i){var o=i||{};return o.workId=t,o.workCompletedId=e,o.docTitle=n,o.appId="process.Work"+(o.workId||o.workCompletedId),layout.desktop.openApplication(this.event,"process.Work",o)},openJob:function(t,e,i){var o=null;if(o2.Actions.get("x_processplatform_assemble_surface").listWorkByJob(t,function(t){t.data&&(o=t.data)}.bind(this),null,!1),o){var r=o.workList.length+o.workCompletedList.length;if(r){if(!(r>1&&e)){if(o.workList.length){var a=o.workList[0];return this.openWork(a.id,null,a.title,i)}a=o.workCompletedList[0];return this.openWork(null,a.id,a.title,i)}var u=new Element("div",{styles:{padding:"20px",width:"500px"}}).inject(n.node);o.workList.each(function(t){var e=new Element("div",{styles:{background:"#ffffff","border-radius":"10px",clear:"both","margin-bottom":"10px",height:"40px",padding:"10px 10px"}}).inject(u),n="<div style='height: 40px; width: 40px; float: left; background: url(../x_component_process_Xform/$Form/default/icon/work.png) no-repeat center center'></div><div style='height: 40px; width: 40px; float: right'><div class='MWFAction' style='height: 20px; width: 40px; margin-top: 10px; border: 1px solid #999999; border-radius: 5px;text-align: center; cursor: pointer'>"+o2.LP.widget.open+"</div></div><div style='height: 20px; line-height: 20px; margin: 0px 40px'>"+t.title+"</div><div style='margin: 0px 40px'><div style='color:#999999; float: left; margin-right: 10px'>"+t.activityName+"</div><div style='color:#999999; float: left; margin-right: 10px'>"+t.activityArrivedTime+"</div><div style='color:#999999; float: left; margin-right: 10px'>"+(t.manualTaskIdentityText||"")+"</div></div>";e.set("html",n);var o=e.getElement(".MWFAction");o.store("work",t),o.addEvent("click",function(t){var e=t.target.retrieve("work");e&&this.openWork(e.id,null,e.title,i),s.close()}.bind(this))}.bind(this)),o.workCompletedList.each(function(t){var e=new Element("div",{styles:{background:"#ffffff","border-radius":"10px",clear:"both","margin-bottom":"10px",height:"40px",padding:"10px 10px"}}).inject(u),n="<div style='height: 40px; width: 40px; float: left; background: url(../x_component_process_Xform/$Form/default/icon/work.png) no-repeat center center'></div><div style='height: 40px; width: 40px; float: right'><div class='MWFAction' style='height: 20px; width: 40px; margin-top: 10px; border: 1px solid #999999; border-radius: 5px;text-align: center; cursor: pointer'>"+o2.LP.widget.open+"</div></div><div style='height: 20px; line-height: 20px; margin: 0px 40px'>"+t.title+"</div><div style='margin: 0px 40px'><div style='color:#999999; float: left; margin-right: 10px'>"+o2.LP.widget.workcompleted+"</div><div style='color:#999999; float: left; margin-right: 10px'>"+t.completedTime+"</div>";e.set("html",n);var o=e.getElement(".MWFAction");o.store("work",t),o.addEvent("click",function(t){var e=t.target.retrieve("work");e&&this.openWork(null,e.id,e.title,i),s.close()}.bind(this))}.bind(this));var l=u.getSize().y+20;l>600&&(l=600);var s=o2.DL.open({title:o2.LP.widget.choiceWork,style:"user",isResize:!1,content:u,buttonList:[{type:"cancel",text:o2.LP.widget.close,action:function(){s.close()}}]})}}},openDocument:function(t,e,n){var i=n||{};i.documentId=t,i.docTitle=e||"",layout.desktop.openApplication(this.event,"cms.Document",i)},openPortal:function(t,e,n){var i=MWF.Actions.get("x_portal_assemble_surface");i.getApplication(t,(function(t){t.data&&(e?i.getPageByName(e,t.data.id,(function(e){var i=e.data?e.data.id:"";layout.desktop.openApplication(null,"portal.Portal",{portalId:t.data.id,pageId:i,parameters:n,appId:n&&n.appId||"portal.Portal"+t.data.id+i})})):layout.desktop.openApplication(null,"portal.Portal",{portalId:t.data.id,parameters:n,appId:n&&n.appId||"portal.Portal"+t.data.id}))}))},openCMS:function(t){MWF.Actions.get("x_cms_assemble_control").getColumn(t,(function(t){t.data&&layout.desktop.openApplication(null,"cms.Module",{columnId:t.data.id,appId:"cms.Module"+t.data.id})}))},openProcess:function(t){MWF.Actions.get("x_processplatform_assemble_surface").getApplication(t,(function(t){t.data&&layout.desktop.openApplication(null,"process.Application",{id:t.data.id,appId:"process.Application"+t.data.id})}))},openApplication:function(t,e){layout.desktop.openApplication(null,t,e)},createDocument:function(t,e,i,o,r,a,u,l,s){var c,p,d=t;"object"==typeOf(t)&&(d=t.column,e=t.category,i=t.data,o=t.identity,r=t.callback,a=t.target,u=t.latest,l=t.selectColumnEnable,s=t.ignoreTitle,c=t.onAfterPublish,p=t.onPostPublish),a&&layout.app&&layout.app.inBrowser&&(layout.app.content.empty(),layout.app=null),MWF.xDesktop.requireApp("cms.Index","Newer",(function(){new MWF.xApplication.cms.Index.Newer(null,null,n.app,null,{documentData:i,identity:o,ignoreTitle:!0===s,ignoreDrafted:!1===u,selectColumnEnable:!e||!0===l,restrictToColumn:!!e&&!0!==l,categoryFlag:e,columnFlag:d,onStarted:function(t,e){r&&r()},onPostPublish:function(){p&&p()},onAfterPublish:function(){c&&c()}}).load()}))},startProcess:function(t,e,i,o,r,a,u){if(arguments.length>2)for(var l=2;l<arguments.length;l++)if("boolean"==typeOf(arguments[l])){a=arguments[l];break}a&&layout.app&&layout.app.inBrowser&&(layout.app.$openWithSelf=!0);MWF.Actions.get("x_processplatform_assemble_surface").getProcessByName(e,t,(function(t){t.data&&MWF.xDesktop.requireApp("process.TaskCenter","ProcessStarter",function(){new MWF.xApplication.process.TaskCenter.ProcessStarter(t.data,n.app,{workData:i,identity:o,latest:u,onStarted:function(t,e,n){if(t.work){var i={draft:t.work,appId:"process.Work"+(new o2.widget.UUID).toString(),desktopReload:!1};layout.desktop.openApplication(null,"process.Work",i)}else{var o=[];if(t.each(function(t){-1!=t.currentTaskIndex&&o.push(t.taskList[t.currentTaskIndex].work)}.bind(this)),1==o.length){i={workId:o[0],appId:o[0]};layout.desktop.openApplication(null,"process.Work",i)}}r&&r(t)}.bind(this)}).load()}.bind(this))}))}},this.target=t.target,this.event=t.event,this.status=t.status,this.session=layout.desktop.session,this.Actions=o2.Actions,this.query=function(t){if(t){var e=t.data||{};t.firstResult&&(e.firstResult=t.firstResult.toInt()),t.maxResults&&(e.maxResults=t.maxResults.toInt()),o2.Actions.get("x_query_assemble_surface").executeStatement(t.name,e,success,error,options.async)}}},MWF.xScript.dictLoaded||(MWF.xScript.dictLoaded={}),MWF.xScript.createDict||(MWF.xScript.addDictToCache=function(t,e,n){e||(e="root"),0!==e.indexOf("root")&&(e="root."+e);var i=t.appType||"process",o=t.enableAnonymous||!1,r=[];t.application&&r.push(t.application),t.appId&&r.push(t.appId),t.appName&&r.push(t.appName),t.appAlias&&r.push(t.appAlias);var a=[];t.id&&a.push(t.id),t.name&&a.push(t.name),t.alias&&a.push(t.alias),(d={})[e]=n;for(var u=0;u<r.length;u++)for(var l=0;l<a.length;l++){var s=a[l]+i+r[u]+o;if(MWF.xScript.dictLoaded[s]){if(0===u&&0===l){MWF.xScript.setDictToCache(s,e,n);for(var c,p=e.split(/\./g),d=MWF.xScript.dictLoaded[s],f=0;f<p.length&&(c=0===f?p[0]:c+"."+p[f],!d[c]);f++);if(c){var h=c+".";Object.keys(d).each((function(t,e){0===t.indexOf(h)&&delete d[t]}))}}}else MWF.xScript.dictLoaded[s]=d}},MWF.xScript.getMatchedDict=function(t,e){e||(e="root"),0!==e.indexOf("root")&&(e="root."+e);var n=e.split(/\./g);if(MWF.xScript.dictLoaded[t]){for(var i,o,r=MWF.xScript.dictLoaded[t],a=Array.clone(n),u=0;u<n.length;u++)if(i=0===u?n[0]:i+"."+n[u],a.shift(),r[i]){o=r[i];break}return{dict:o,unmatchedPathList:a}}return{dict:null,unmatchedPathList:a}},MWF.xScript.insertDictToCache=function(t,e,n){if(MWF.xScript.dictLoaded[t]){var i=MWF.xScript.getMatchedDict(t,e),o=i.dict,r=i.unmatchedPathList;if(o){for(var a=0;a<r.length-1;a++)o[r[a]]||(o[r[a]]={}),o=o[r[a]];var u=r[r.length-1];o[u]?"array"===typeOf(o[u])&&o[u].push(n):o[u]=n}else MWF.xScript.dictLoaded[t][e]=n}else MWF.xScript.dictLoaded[t]={},MWF.xScript.dictLoaded[t][e]=n},MWF.xScript.setDictToCache=function(t,e,n){if(MWF.xScript.dictLoaded[t]){var i=MWF.xScript.getMatchedDict(t,e),o=i.dict,r=i.unmatchedPathList;if(o){for(var a=0;a<r.length-1;a++)o[r[a]]||(o[r[a]]={}),o=o[r[a]];o[r[r.length-1]]=n}else MWF.xScript.dictLoaded[t][e]=n}else MWF.xScript.dictLoaded[t]={},MWF.xScript.dictLoaded[t][e]=n},MWF.xScript.getDictFromCache=function(t,e){var n=MWF.xScript.getMatchedDict(t,e),i=n.dict,o=n.unmatchedPathList;if(i){for(var r=0;r<o.length;r++)if(!(i=i[o[r]]))return null;return i}return null},MWF.xScript.deleteDictToCache=function(t,e){var n=MWF.xScript.getMatchedDict(t,e),i=n.dict,o=n.unmatchedPathList;if(i){for(var r=0;r<o.length-1;r++)if(!(i=i[o[r]]))return;delete i[o[o.length-1]]}},MWF.xScript.createDict=function(t){return function(e){var n=e;"string"==typeOf(n)&&(n={name:n});var i=this.name=n.name,o=n.type&&n.application?n.type:"process",r=n.application||t,a=n.enableAnonymous||!1,u={appType:o,name:i,appId:r,enableAnonymous:a},l=i+o+r+a;if("cms"==o)var s=MWF.Actions.get("x_cms_assemble_control");else s=MWF.Actions.get("x_processplatform_assemble_surface");var c=function(t){return t.split(/\./g).map((function(t){return encodeURIComponent(t)})).join("/")};this.get=function(t,e,n,i,p){var d=null;if(!0===e&&(i=!0),!0===n&&(i=!0),!p){var f=MWF.xScript.getDictFromCache(l,t);if(f)return e&&"function"==o2.typeOf(e)&&e(f),i?Promise.resolve(f):f}var h,m=function(n){return d=n.data,MWF.xScript.addDictToCache(u,t,d),e&&"function"==o2.typeOf(e)&&(d=e(n.data)),d};if(t){var g=c(t);h=s[a&&"cms"==o?"getDictDataAnonymous":"getDictData"](encodeURIComponent(this.name),r,g,m,null,!!i,!1)}else h=s[a&&"cms"==o?"getDictRootAnonymous":"getDictRoot"](this.name,r,m,null,!!i,!1);return i?h:d},this.set=function(t,e,n,i){var o=c(t);return s.setDictData(encodeURIComponent(this.name),r,o,e,(function(i){if(MWF.xScript.setDictToCache(l,t,e),n)return n(i.data)}),(function(t,e,n){if(i)return i(t,e,n)}),!1,!1)},this.add=function(t,e,n,i){var o=c(t);return s.addDictData(encodeURIComponent(this.name),r,o,e,(function(i){if(MWF.xScript.insertDictToCache(l,t,e),n)return n(i.data)}),(function(t,e,n){if(i)return i(t,e,n)}),!1,!1)},this.delete=function(t,e,n){var i=c(t);return s.deleteDictData(encodeURIComponent(this.name),r,i,(function(n){if(MWF.xScript.deleteDictToCache(l,t),e)return e(n.data)}),(function(t,e,i){if(n)return n(t,e,i)}),!1,!1)},this.destory=this.delete}});