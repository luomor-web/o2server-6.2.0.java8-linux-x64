MWF.require("MWF.widget.Common",null,!1),MWF.require("MWF.widget.JsonTemplate",null,!1),MWF.xApplication.query.ViewDesigner.Property=MWF.FVProperty=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",path:"../x_component_query_FormDesigner/property/property.html"},initialize:function(t,e,i,n){this.setOptions(n),this.module=t,this.view=t.view,this.data=t.json,this.data.vid=this.view.json.id,this.data.vtype=this.view.json.type,this.data.pid=this.view.json.id+this.data.id,this.htmlPath=this.options.path,this.maplists={},this.designer=i,this.propertyNode=e},load:function(){this.fireEvent("queryLoad")&&MWF.getRequestText(this.htmlPath,function(t,e){this.htmlString=t,this.fireEvent("postLoad")}.bind(this)),this.propertyNode.addEvent("keydown",(function(t){t.stopPropagation()}))},editProperty:function(t){},getHtmlString:function(t){this.htmlString?t&&t():MWF.getRequestText(this.htmlPath,function(e,i){this.htmlString=e,t&&t()}.bind(this))},show:function(){this.propertyContent?this.propertyContent.setStyle("display","block"):this.getHtmlString(function(){this.htmlString&&(this.htmlString=o2.bindJson(this.htmlString,{lp:MWF.xApplication.query.ViewDesigner.LP.propertyTemplate}),this.JsonTemplate=new MWF.widget.JsonTemplate(this.data,this.htmlString),this.propertyContent=new Element("div",{styles:{overflow:"hidden"}}).inject(this.propertyNode),this.propertyContent.set("html",this.JsonTemplate.load()),this.setEditNodeEvent(),this.setEditNodeStyles(this.propertyContent),this.loadPropertyTab(),this.loadPersonInput(),this.loadPersonSelectInput(),this.loadViewFilter(),this.loadScriptArea(),this.loadColumnExportEditor(),this.loadJSONArea(),this.loadEventsEditor(),this.loadViewStylesArea(),this.loadPagingStylesArea(),this.loadActionStylesArea(),this.loadActionArea(),this.loadStylesList(),this.loadMaplist())}.bind(this))},hide:function(){this.propertyContent&&this.propertyContent.setStyle("display","none")},loadJSONArea:function(){var t=this.propertyContent.getElement(".MWFJSONArea");t&&this.propertyTab.pages.each(function(e){e.contentNode==t.parentElement&&e.setOptions({onShow:function(){t.empty(),MWF.require("MWF.widget.JsonParse",function(){this.json=new MWF.widget.JsonParse(this.module.json,t,null),this.json.load()}.bind(this))}.bind(this)})}.bind(this))},loadPropertyTab:function(){var t=this.propertyContent.getElements(".MWFTab");if(t.length){var e=this.propertyContent.getFirst(),i=new Element("div",{styles:this.view.css.propertyTabNode}).inject(e,"before");MWF.require("MWF.widget.Tab",function(){var e=new MWF.widget.Tab(i,{style:"formPropertyList"});e.load();var n=[];t.each(function(t){var i=e.addTab(t,t.get("title"),!1);n.push(i),this.setScrollBar(i.contentNodeArea,"small",null,null)}.bind(this)),n[0].showTab(),this.propertyTab=e,this.designer.resizeNode()}.bind(this),!1)}},setEditNodeEvent:function(){var t=this;this.propertyContent.getElements("input").each(function(e){var i=e.get("name");if(i&&"_"!=i.substr(0,1)){if(this.module){var n=this.module.json.id;e.set("name",n+i)}if(i)switch(e.get("type").toLowerCase()){case"radio":e.addEvent("change",(function(e){t.setRadioValue(i,this)})),e.addEvent("blur",(function(e){t.setRadioValue(i,this)})),e.addEvent("keydown",(function(t){t.stopPropagation()})),t.setRadioValue(i,e);break;case"checkbox":e.addEvent("change",(function(e){t.setCheckboxValue(i,this)})),e.addEvent("click",(function(e){t.setCheckboxValue(i,this)})),e.addEvent("keydown",(function(t){t.stopPropagation()}));break;default:e.addEvent("change",(function(e){t.setValue(i,this.value,this)})),e.addEvent("blur",(function(e){t.setValue(i,this.value,this)})),e.addEvent("keydown",(function(e){13==e.code&&t.setValue(i,this.value,this),e.stopPropagation()})),e.hasClass("editTableInputDate")&&this.loadCalendar(e,i)}}}.bind(this)),this.propertyContent.getElements("select").each((function(e){var i=e.get("name");i&&e.addEvent("change",(function(e){t.setSelectValue(i,this)}))})),this.propertyContent.getElements("textarea").each(function(e){var i=e.get("name");i&&(e.addEvent("change",(function(e){t.setValue(i,this.value)})),e.addEvent("blur",(function(e){t.setValue(i,this.value)})),e.addEvent("keydown",(function(t){t.stopPropagation()})))}.bind(this))},loadCalendar:function(t,e){MWF.require("MWF.widget.Calendar",function(){this.calendar=new MWF.widget.Calendar(t,{style:"xform",isTime:!1,target:this.module.designer.content,format:"%Y-%m-%d",onClear:function(){this.setValue(e,t.value,t)}.bind(this),onComplate:function(){this.setValue(e,t.value,t)}.bind(this)})}.bind(this))},changeStyle:function(t){this.module.setPropertiesOrStyles(t)},changeData:function(t,e,i){var n=t.lastIndexOf("*"),s=-1!=n?t.substr(n+1,t.length):t;this.module._setEditStyle(s,e,i)},changeJsonDate:function(t,e){"array"!=typeOf(t)&&(t=[t]);var i=this.data,n=t.length-1;t.each(function(t,e){i[t]||(i[t]={}),e<n&&(i=i[t])}.bind(this)),i[t[n]]=e},setRadioValue:function(t,e){if(e.checked){var i=t.indexOf("*"),n=-1==i?t.split("."):t.substr(i+1,t.length).split("."),s=e.value;"false"==s&&(s=!1),"true"==s&&(s=!0);for(var o=this.data,a=0;a<n.length;a++){if(!o[n[a]]){o=null;break}o=o[n[a]]}this.changeJsonDate(n,s),this.changeData(t,e,o)}},setCheckboxValue:function(t,e){var i=this.module.json.id,n=$$("input[name='"+i+t+"']"),s=[];n.each((function(t){t.get("checked")&&s.push(t.value)}));var o=this.data[t];this.changeJsonDate(t,s),this.changeData(t,e,o)},setSelectValue:function(t,e){var i=e.selectedIndex,n=e.getElements("option"),s="";n[i]&&(s=n[i].get("value"));var o=t.indexOf("*"),a=-1==o?t.split("."):t.substr(o+1,t.length).split("."),r=this.data;for(i=0;i<a.length;i++){if(!r[a[i]]){r=null;break}r=r[a[i]]}this.changeJsonDate(a,s),this.changeData(t,e,r)},setValue:function(t,e,i){for(var n=t.split("."),s=this.data,o=0;o<n.length;o++){if(!s[n[o]]){s=null;break}s=s[n[o]]}this.changeJsonDate(n,e),this.changeData(t,i,s)},setEditNodeStyles:function(t){var e=t.getChildren();e.length&&e.each(function(t){var e=t.get("class");e&&this.view.css[e]&&t.setStyles(this.view.css[e]),this.setEditNodeStyles(t)}.bind(this))},loadScriptArea:function(){var t=this.propertyContent.getElements(".MWFScriptArea"),e=this.propertyContent.getElements(".MWFFormulaArea");this.loadScriptEditor(t),this.loadScriptEditor(e,"formula")},loadScriptEditor:function(t,e){t.each(function(t){var i=t.get("title"),n=t.get("name").split("."),s=this.data;Array.each(n,(function(t){s&&(s=s[t])})),MWF.require("MWF.widget.ScriptArea",function(){var o=new MWF.widget.ScriptArea(t,{title:i,maxObj:this.designer.editContentNode,onChange:function(){var t=this.data;Array.each(n,(function(e,i){i!==n.length-1&&t&&(t=t[e])})),t[n[n.length-1]]=o.toJson().code}.bind(this),onSave:function(){this.designer.saveView()}.bind(this),style:e||"default",runtime:"server"});o.load({code:s})}.bind(this))}.bind(this))},loadStatColumnSelect:function(){},loadPersonInput:function(){var t=this.propertyContent.getElements(".MWFPersonIdentity"),e=this.propertyContent.getElements(".MWFPersonUnit");MWF.xDesktop.requireApp("process.ProcessDesigner","widget.PersonSelector",function(){t.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.view.designer,{type:"identity",names:this.data[t.get("name")],onChange:function(e){this.savePersonItem(t,e)}.bind(this)})}.bind(this)),e.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.view.designer,{type:"unit",names:this.data[t.get("name")],onChange:function(e){this.savePersonItem(t,e)}.bind(this)})}.bind(this))}.bind(this))},savePersonItem:function(t,e){var i=[];e.each(function(t){i.push(t.data.distinguishedName||t.data.id||t.data.name)}.bind(this));var n=t.get("name");key=n.split(".");var s=this.data,o=key.length-1;key.each(function(t,e){s[t]||(s[t]={}),e<o&&(s=s[t])}.bind(this)),s[key[o]]=i},loadPersonSelectInput:function(){var t=this.propertyContent.getElements(".MWFSelectApplication"),e=this.propertyContent.getElements(".MWFSelectProcess"),i=this.propertyContent.getElements(".MWFSelectPerson"),n=this.propertyContent.getElements(".MWFSelectIdentity"),s=this.propertyContent.getElements(".MWFSelectUnit"),o=this.propertyContent.getElements(".MWFSelectCMSApplication"),a=this.propertyContent.getElements(".MWFSelecCMStCategory");MWF.xDesktop.requireApp("process.ProcessDesigner","widget.PersonSelector",function(){t.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.view.designer,{type:"application",names:this.data.data.where?this.data.data.where.applicationList:[],onChange:function(e){this.savePersonSelectItem(t,e)}.bind(this)})}.bind(this)),e.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.view.designer,{type:"process",names:this.data.data.where?this.data.data.where.processList:[],onChange:function(e){this.savePersonSelectItem(t,e)}.bind(this)})}.bind(this)),s.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.view.designer,{type:"unit",names:this.data.data.where?this.data.data.where.creatorUnitList:[],onChange:function(e){this.savePersonSelectItem(t,e)}.bind(this)})}.bind(this)),i.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.view.designer,{type:"person",names:this.data.data.where?this.data.data.where.creatorPersonList:[],onChange:function(e){this.savePersonSelectItem(t,e)}.bind(this)})}.bind(this)),n.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.view.designer,{type:"identity",names:this.data.data.where?this.data.data.where.creatorIdentityList:[],onChange:function(e){this.savePersonSelectItem(t,e)}.bind(this)})}.bind(this)),o.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.view.designer,{type:"CMSApplication",names:this.data.data.where?this.data.data.where.appInfoList:[],onChange:function(e){this.savePersonSelectItem(t,e)}.bind(this)})}.bind(this)),a.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.view.designer,{type:"CMSCategory",names:this.data.data.where?this.data.data.where.categoryInfoList:[],onChange:function(e){this.savePersonSelectItem(t,e)}.bind(this)})}.bind(this))}.bind(this))},savePersonSelectItem:function(t,e){var i=[];e.each(function(t){i.push({name:t.data.distinguishedName||t.data.name,id:t.data.id})}.bind(this));var n=t.get("name");key=n.split(".");var s=this.data,o=key.length-1;key.each(function(t,e){s[t]||(s[t]={}),e<o&&(s=s[t])}.bind(this)),s[key[o]]=i},loadColumnExportEditor:function(){var t=this;this.propertyContent.getElements(".MWFColumnExport").each(function(e){var i=e.getElement("select");this.view.data.data.orderList.each(function(t){t.column==this.data.column&&("asc"==t.orderType&&i.options[1].set("selected",!0),"desc"==t.orderType&&i.options[1].set("selected",!1))}.bind(this)),i.addEvent("change",function(t){var e=this.view.data.data.orderList;if("none"!=i.options[i.selectedIndex].value){var n=!1;e.each(function(t){t.column==this.data.column&&(n=!0,t.orderType=i.options[i.selectedIndex].value)}.bind(this)),n||e.push({column:this.data.column,orderType:i.options[i.selectedIndex].value});var s=Array.clone(this.view.data.data.orderList);this.view.data.data.orderList=[],this.view.json.data.selectList.each(function(t){s.each(function(e){e.column==t.column&&this.view.data.data.orderList.push(e)}.bind(this))}.bind(this))}else{e=this.view.data.data.orderList;var o=null;e.each(function(t){t.column==this.data.column&&(o=t)}.bind(this)),o&&e.erase(o)}}.bind(this));var n=e.getElements("input[name='"+this.module.json.id+"groupEntry']"),s=this.view.data.data.group;s.column==this.data.column&&n[0].set("checked",!0),n.addEvent("click",(function(e){this.checked&&("true"==this.value?(t.view.data.data.group.column=t.data.column,t.view.items.each((function(t){t.property&&t.property.propertyContent.getElement(".MWFColumnExportGroup").getElements("input").each((function(t){"true"==t.value&&t.set("checked",!1),"false"==t.value&&t.set("checked",!0)}))})),t.view.data.data.selectList.each((function(e){e.column!==t.data.column&&(e.groupEntry=!1)})),this.set("checked",!0)):s.column==t.data.column&&(t.view.data.data.group={}))}))}.bind(this))},loadViewFilter:function(){var t=this.propertyContent.getElements(".MWFViewFilter"),e=this.view.data.data.filterList,i=this.view.data.data.customFilterList;t.each(function(t){MWF.xDesktop.requireApp("query.ViewDesigner","widget.ViewFilter",function(){var n=this;new MWF.xApplication.query.ViewDesigner.widget.ViewFilter(t,this.view.designer,{filtrData:e,customData:i},{onChange:function(t){var e=this.getData();n.changeJsonDate(["data","filterList"],e.data),n.changeJsonDate(["data","customFilterList"],e.customData)}})}.bind(this))}.bind(this))},loadColumnFilter:function(){this.propertyContent.getElements(".MWFColumnFilter").each(function(t){this.module.filterAreaNode=t;var e=new Element("table",{styles:{width:"100%"},border:"0px",cellPadding:"0",cellSpacing:"0"}).inject(t),i=new Element("tr",{styles:this.module.css.filterTableTitle}).inject(e),n=MWF.APPDVD.LP.filter,s="<th style='width:24px;border-right:1px solid #CCC;border-bottom:1px solid #999;'></th><th style='border-right:1px solid #CCC;border-left:1px solid #FFF;border-bottom:1px solid #999;'>"+n.logic+"</th><th style='border-right:1px solid #CCC;border-left:1px solid #FFF;border-bottom:1px solid #999;'>"+n.path+"</th><th style='border-right:1px solid #CCC;border-left:1px solid #FFF;border-bottom:1px solid #999;'>"+n.compare+"</th><th style='border-left:1px solid #FFF;border-bottom:1px solid #999;'>"+n.value+"</th>";i.set("html",s),new Element("div",{styles:this.module.css.filterAddActionNode}).inject(i.getFirst("th")).addEvent("click",function(){this.addFilter(e)}.bind(this)),this.data.filterList&&this.data.filterList.each(function(t){new MWF.xApplication.query.ViewDesigner.Property.Filter(t,e,this)}.bind(this))}.bind(this))},addFilter:function(t){op={logic:"and",comparison:"",value:""},this.data.filterList||(this.data.filterList=[]),this.data.filterList.push(op),new MWF.xApplication.query.ViewDesigner.Property.Filter(op,t,this).editMode()},loadViewStylesArea:function(){var t=this;this.propertyContent.getElements(".MWFViewStylesArea").each(function(e){var i=e.get("name"),n=this.data;Array.each(i.split("."),(function(t){n&&(n=n[t])}));var s=n||{};MWF.require("MWF.widget.Maplist",function(){var o=[];Object.each(s,function(s,a){var r=new Element("div").inject(e);r.empty();var d=new MWF.widget.Maplist(r,{title:a,collapse:!0,onChange:function(){var s=this.data;Array.each(i.split("."),(function(t){s&&(s=s[t])})),o.each(function(t){n[t.key]=t.map.toJson()}.bind(this)),t.changeData(i,e,s)}});o.push({key:a,map:d}),d.load(s)}.bind(this))}.bind(this))}.bind(this))},loadMaplist:function(){this.propertyContent.getElements(".MWFMaplist").each(function(t){var e=t.get("title"),i=t.get("name"),n=i.toLowerCase(),s=t.get("collapse"),o=this.data[i];o||(o={}),MWF.require("MWF.widget.Maplist",function(){t.empty();var a=new MWF.widget.Maplist(t,{title:e,collapse:!!s,onChange:function(){var t=this.data[i];this.changeJsonDate(i,a.toJson()),this.changeStyle(i,t),this.changeData(i)}.bind(this),onDelete:function(t){this.module.deletePropertiesOrStyles(i,t)}.bind(this),isProperty:n.contains("properties")||n.contains("property")||n.contains("attribute")});a.load(o),this.maplists[i]=a}.bind(this))}.bind(this))},loadActionStylesArea:function(){var t=this;this.propertyContent.getElements(".MWFActionStylesArea").each(function(e){var i=e.get("name"),n=this.data[i];MWF.require("MWF.widget.Maplist",function(){var s=[];Object.each(n,function(n,o){var a=new Element("div").inject(e);a.empty();var r=new MWF.widget.Maplist(a,{title:o,collapse:!0,onChange:function(){var n=t.data[i];s.each(function(e){t.data[i][e.key]=e.map.toJson()}.bind(this)),t.changeData(i,e,n)}});s.push({key:o,map:r}),r.load(n)}.bind(this))}.bind(this))}.bind(this))},loadPagingStylesArea:function(){var t=this;this.propertyContent.getElements(".MWFPagingStylesArea").each(function(e){var i=e.get("name"),n=this.data[i];MWF.require("MWF.widget.Maplist",function(){var s=[];Object.each(n,function(n,o){var a=new Element("div").inject(e);a.empty();var r=new MWF.widget.Maplist(a,{title:o,collapse:!0,onChange:function(){var n=t.data[i];s.each(function(e){t.data[i][e.key]=e.map.toJson()}.bind(this)),t.changeData(i,e,n)}});s.push({key:o,map:r}),r.load(n)}.bind(this))}.bind(this))}.bind(this))},loadEventsEditor:function(){MWF.xApplication.process=MWF.xApplication.process||{},MWF.APPFD=MWF.xApplication.process.FormDesigner=MWF.xApplication.process.FormDesigner||{},MWF.xDesktop.requireApp("process.FormDesigner","lp."+o2.language,null,!1);var t=this.propertyContent.getElement(".MWFEventsArea");if(t){var e=t.get("name"),i=this.data;Array.each(e.split("."),(function(t){i&&(i=i[t])})),MWF.xDesktop.requireApp("process.FormDesigner","widget.EventsEditor",function(){new MWF.xApplication.process.FormDesigner.widget.EventsEditor(t,this.designer,{maxObj:this.designer.contentNode}).load(i,this.data,e)}.bind(this))}},loadActionArea:function(){MWF.xApplication.process=MWF.xApplication.process||{},MWF.APPFD=MWF.xApplication.process.FormDesigner=MWF.xApplication.process.FormDesigner||{},MWF.xDesktop.requireApp("process.FormDesigner","lp."+o2.language,null,!1),this.propertyContent.getElements(".MWFMultiActionArea").each(function(t){var e=t.get("name"),i=this.data[e];MWF.xDesktop.requireApp("process.FormDesigner","widget.ActionsEditor",function(){var n=new MWF.xApplication.process.FormDesigner.widget.ActionsEditor(t,this.designer,this.data,{maxObj:this.propertyNode.parentElement.parentElement.parentElement,systemToolsAddress:"../x_component_query_ViewDesigner/$View/toolbars.json",isSystemTool:!0,noEditShow:!0,noReadShow:!0,onChange:function(){this.data[e]=n.data,this.changeData(e)}.bind(this)});n.load(i)}.bind(this))}.bind(this)),this.propertyContent.getElements(".MWFActionArea").each(function(t){var e=t.get("name"),i=this.data[e];MWF.xDesktop.requireApp("process.FormDesigner","widget.ActionsEditor",function(){var n=new MWF.xApplication.process.FormDesigner.widget.ActionsEditor(t,this.designer,this.data,{maxObj:this.propertyNode.parentElement.parentElement,noEditShow:!0,noReadShow:!0,onChange:function(){this.data[e]=n.data,this.changeData(e)}.bind(this)});n.load(i)}.bind(this))}.bind(this)),this.propertyContent.getElements(".MWFDefaultActionArea").each(function(t){var e=t.get("name"),i=this.data[e]||this.module.defaultToolBarsData;MWF.xDesktop.requireApp("process.FormDesigner","widget.ActionsEditor",function(){var n=new MWF.xApplication.process.FormDesigner.widget.ActionsEditor(t,this.designer,this.data,{maxObj:this.propertyNode.parentElement.parentElement,isSystemTool:!0,systemToolsAddress:"../x_component_query_ViewDesigner/$View/toolbars.json",noCreate:!0,noDelete:!1,noCode:!0,noReadShow:!0,noEditShow:!0,onChange:function(){this.data[e]=n.data,this.changeData(e)}.bind(this)});n.load(i)}.bind(this))}.bind(this))},loadStylesList:function(){this.propertyContent.getElements(".MWFViewStyle").each(function(t){this.module.stylesList?(this.data.data.viewStyleType||(this.data.data.viewStyleType="default"),Object.each(this.module.stylesList,function(e,i){new Element("option",{text:e.name,value:i,selected:!this.data.data.viewStyleType&&"default"==i||this.data.data.viewStyleType==i}).inject(t)}.bind(this))):t.getParent("tr").setStyle("display","none")}.bind(this))}}),MWF.xApplication.query.ViewDesigner.Property.Filter=new Class({Implements:[Events],initialize:function(t,e,i){this.property=i,this.module=i.module,this.table=e,this.data=t,this.load()},load:function(){var t=MWF.APPDVD.LP.filter;this.node=new Element("tr",{styles:this.module.css.filterTableTd}).inject(this.table);var e="<td style='widtd:24px;border-right:1px solid #CCC;border-bottom:1px solid #999;'></td><td style='padding:3px;border-right:1px solid #CCC;border-bottom:1px solid #999; width:60px'>"+this.data.logic+"</td><td style='padding:3px;border-right:1px solid #CCC;border-bottom:1px solid #999; width:30px'>"+t.columnValue+"</td><td style='padding:3px;border-right:1px solid #CCC;border-bottom:1px solid #999;'>"+this.data.comparison+"</td><td style='padding:3px;border-bottom:1px solid #999;'>"+this.data.value+"</td>";this.node.set("html",e);var i=this.node.getElements("td");this.delActionNode=new Element("div",{styles:this.module.css.filterDelActionNode}).inject(i[0]),this.delActionNode.addEvent("click",function(t){this.delFilter(t),t.stopPropagation()}.bind(this)),this.logicNode=i[1],this.comparisonNode=i[3],this.valueNode=i[4],this.node.addEvent("click",function(){this.isEditMode||this.editMode()}.bind(this)),this.node.addEvent("blur",function(){this.isEditMode&&this.readMode()}.bind(this))},delFilter:function(t){var e=this;this.property.designer.confirm("warn",t,MWF.APPDVD.LP.notice.deleteFilterTitle,MWF.APPDVD.LP.notice.deleteFilter,300,120,(function(){e.node.destroy(),e.property.data.filterList.erase(e.data),MWF.release(e),this.close()}),(function(){this.close()}),null)},editMode:function(){this.property.editModeFilter&&this.property.editModeFilter!=this&&this.property.editModeFilter.readMode();var t=this.logicNode.getSize().x;this.logicNode.empty();var e=new Element("select",{styles:{width:"90%"}}).inject(this.logicNode),i="";i="and"==this.data.logic?'<option value="and" selected>and</option><option value="or">or</option>':'<option value="and">and</option><option value="or" selected>or</option>',e.set("html",i),e.addEvent("change",function(){this.data.logic=e.options[e.selectedIndex].value}.bind(this)),this.comparisonNode.getSize().x,this.comparisonNode.empty();var n=new Element("select",{styles:{width:"90%"}}).inject(this.comparisonNode),s=MWF.APPDVD.LP.filter;switch(i="",this.property.data.type){case"text":i+="<option value=''></option><option value='==' "+("=="==this.data.comparison?"selected":"")+">"+s.equals+"(==)</option><option value='!=' "+("!="==this.data.comparison?"selected":"")+">"+s.notEquals+"(!=)</option><option value='@' "+("@"==this.data.comparison?"selected":"")+">"+s.contain+"(@)</option>";break;case"date":i+="<option value=''></option><option value='&gt;' "+(">"==this.data.comparison?"selected":"")+">"+s.greaterThan+"(&gt;)</option><option value='&lt;' "+("<"==this.data.comparison?"selected":"")+">"+s.lessThan+"(&lt;)</option><option value='&gt;=' "+(">="==this.data.comparison?"selected":"")+">"+s.greaterThanOrEqualTo+"(&gt;=)</option><option value='&lt;=' "+("<="==this.data.comparison?"selected":"")+">"+s.lessThanOrEqualTo+"(&lt;=)</option>";break;case"number":i+="<option value=''></option><option value='==' "+("=="==this.data.comparison?"selected":"")+">"+s.equals+"(==)</option><option value='!=' "+("!="==this.data.comparison?"selected":"")+">"+s.notEquals+"(!=)</option><option value='&gt;' "+(">"==this.data.comparison?"selected":"")+">"+s.greaterThan+"(&gt;)</option><option value='&lt;' "+("<"==this.data.comparison?"selected":"")+">"+s.lessThan+"(&lt;)</option><option value='&gt;=' "+(">="==this.data.comparison?"selected":"")+">"+s.greaterThanOrEqualTo+"(&gt;=)</option><option value='&lt;=' "+("<="==this.data.comparison?"selected":"")+">"+s.lessThanOrEqualTo+"(&lt;=)</option>";break;case"boolean":i+="<option value=''></option><option value='==' "+("=="==this.data.comparison?"selected":"")+">"+s.equals+"(==)</option><option value='!=' "+("!="==this.data.comparison?"selected":"")+">"+s.notEquals+"(!=)</option>"}n.set("html",i),n.addEvent("change",function(){this.data.comparison=n.options[n.selectedIndex].value}.bind(this)),t=this.valueNode.getSize().x-9,this.valueNode.empty();switch(this.property.data.type){case"date":var o=new Element("input",{styles:{width:"90%"},type:"text",value:this.data.value}).inject(this.valueNode);MWF.require("MWF.widget.Calendar",function(){this.calendar=new MWF.widget.Calendar(o,{style:"xform",isTime:!0,secondEnable:!0,target:this.property.designer.content,format:"%Y-%m-%d %H:%M:%S"})}.bind(this));break;case"number":o=new Element("input",{styles:{width:"90%"},type:"number",value:this.data.value}).inject(this.valueNode);break;case"boolean":o=new Element("select",{styles:{width:t+"px"},html:'<option value=""></option><option value="true" '+(this.data.value?"selected":"")+'>true</option><option value="false" '+(this.data.value?"":"selected")+">false</option>"}).inject(this.valueNode);break;default:o=new Element("input",{styles:{width:"90%"},type:"text",value:this.data.value}).inject(this.valueNode)}"select"==o.tagName.toLowerCase()?o.addEvent("change",function(){o.options[o.selectedIndex].value;this.data.value=!!"true"}.bind(this)):(o.addEvent("change",function(t){this.data.value=o.get("value")}.bind(this)),o.addEvent("blur",function(t){this.data.value=o.get("value")}.bind(this)),o.addEvent("keydown",function(t){13==t.code&&(this.data.value=o.get("value"),this.readMode()),t.stopPropagation()}.bind(this))),this.isEditMode=!0,this.property.editModeFilter=this},readMode:function(){if(this.isEditMode){var t=this.logicNode.getElement("select");this.data.logic=t.options[t.selectedIndex].value;var e=this.comparisonNode.getElement("select");this.data.comparison=e.options[e.selectedIndex].value;var i=this.valueNode.getFirst();if("select"==i.tagName.toLowerCase()){i.options[i.selectedIndex].value;this.data.value=!!"true"}else this.data.value=i.get("value");this.logicNode.empty(),this.comparisonNode.empty(),this.valueNode.empty(),this.logicNode.set("text",this.data.logic),this.comparisonNode.set("text",this.data.comparison),this.valueNode.set("text",this.data.value),this.isEditMode=!1,this.property.editModeFilter=null}}});