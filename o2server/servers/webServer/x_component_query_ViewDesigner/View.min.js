MWF.xApplication=MWF.xApplication||{},MWF.xApplication.query=MWF.xApplication.query||{},MWF.xApplication.query.ViewDesigner=MWF.xApplication.query.ViewDesigner||{},MWF.APPDVD=MWF.xApplication.query.ViewDesigner,MWF.require("MWF.widget.Common",null,!1),MWF.require("MWF.xScript.Macro",null,!1),MWF.xDesktop.requireApp("query.ViewDesigner","lp."+MWF.language,null,!1),MWF.xDesktop.requireApp("query.ViewDesigner","Property",null,!1),MWF.xApplication.query.ViewDesigner.View=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",isView:!1,showTab:!0,propertyPath:"../x_component_query_ViewDesigner/$View/view.html"},initialize:function(t,e,s){this.setOptions(s),this.path="../x_component_query_ViewDesigner/$View/",this.cssPath="../x_component_query_ViewDesigner/$View/"+this.options.style+"/css.wcss",this._loadCss(),this.designer=t,this.data=e,this.data.data||(this.data.data={}),this.parseData(),this.node=this.designer.designNode,this.areaNode=new Element("div",{styles:{height:"100%",overflow:"auto"}}),this.propertyListNode=this.designer.propertyDomArea,this.designer.application&&(this.data.applicationName=this.designer.application.name),this.designer.application&&(this.data.application=this.designer.application.id),this.isNewView=!this.data.name,this.items=[],this.view=this,this.autoSave(),this.designer.addEvent("queryClose",function(){this.autoSaveTimerID&&window.clearInterval(this.autoSaveTimerID)}.bind(this))},autoSave:function(){this.autoSaveTimerID=window.setInterval(function(){this.autoSaveCheckNode||(this.autoSaveCheckNode=this.designer.contentToolbarNode.getElement("#MWFDictionaryAutoSaveCheck")),this.autoSaveCheckNode&&this.autoSaveCheckNode.get("checked")&&this.save()}.bind(this),6e4)},parseData:function(){if(this.json=this.data,!this.json.data.events){MWF.getJSON("../x_component_query_ViewDesigner/$View/view.json",{onSuccess:function(t){this.json.data.events=t.data.events}.bind(this),onerror:function(t){this.notice(t,"error")}.bind(this),onRequestFailure:function(t){this.notice(t.responseText,"error")}.bind(this)},!1)}},showProperty:function(){this.property?this.property.show():(this.property=new MWF.xApplication.query.ViewDesigner.Property(this,this.designer.propertyContentArea,this.designer,{path:this.options.propertyPath,onPostLoad:function(){this.property.show()}.bind(this)}),this.property.load())},hideProperty:function(){this.property&&this.property.hide()},load:function(){this.setAreaNodeSize(),this.designer.addEvent("resize",this.setAreaNodeSize.bind(this)),this.areaNode.inject(this.node),this.designer.viewListAreaNode.getChildren().each(function(t){t.retrieve("view").id==this.data.id&&(this.designer.currentListViewItem&&this.designer.currentListViewItem.setStyles(this.designer.css.listViewItem),t.setStyles(this.designer.css.listViewItem_current),this.designer.currentListViewItem=t,this.lisNode=t)}.bind(this)),this.domListNode=new Element("div",{styles:{overflow:"hidden"}}).inject(this.designer.propertyDomArea),this.loadTemplateStyle(function(){this.loadActionbar(),this.loadView(),this.loadPaging(),this.selected(),this.setEvent(),this.setViewWidth(),this.designer.addEvent("resize",this.setViewWidth.bind(this)),this.fireEvent("postLoad")}.bind(this))},setEvent:function(){this.areaNode.addEvent("click",this.selected.bind(this)),this.refreshNode.addEvent("click",function(t){this.loadViewData(),t.stopPropagation()}.bind(this)),this.addColumnNode.addEvent("click",function(t){this.addColumn(),t.stopPropagation()}.bind(this))},loadViewData:function(){this.data.id&&this.saveSilence(function(){this.viewContentBodyNode.empty(),this.viewContentTableNode=new Element("table",{styles:this.css.viewContentTableNode,border:"0px",cellPadding:"0",cellSpacing:"0"}).inject(this.viewContentBodyNode),this.designer.actions.loadView(this.data.id,null,function(t){var e={};if(t.data.selectList.each(function(t){e[t.column]=t}.bind(this)),this.json.data.group.column){if(t.data.groupGrid.length){for(var s=0;s<t.data.selectList.length;s++)if(t.data.selectList[s].column===t.data.group.column){t.data.selectList[s];break}t.data.groupGrid.each(function(t,s){var i,o=new Element("tr",{styles:this.json.data.viewStyles?this.json.data.viewStyles.contentTr:this.css.viewContentTrNode,"data-is-group":"yes"}).inject(this.viewContentTableNode),n=this.items.length,a=new Element("td",{styles:this.json.data.viewStyles?this.json.data.viewStyles.contentGroupTd:this.css.viewContentGroupTdNode,colSpan:n}).inject(o);if(this.json.data.viewStyles)(i=new Element("div",{styles:this.json.data.viewStyles.groupCollapseNode}).inject(a)).set("text",t.group);else{i=new Element("div",{styles:this.css.viewContentTdGroupNode}).inject(a);new Element("div",{styles:this.css.viewContentTdGroupIconNode}).inject(i);var l=new Element("div",{styles:this.css.viewContentTdGroupTextNode}).inject(i);l.set("text",t.group)}var h=[];t.list.each(function(t){var s=new Element("tr",{styles:this.json.data.viewStyles?this.json.data.viewStyles.contentTr:this.css.viewContentTrNode}).inject(this.viewContentTableNode);s.setStyle("display","none");new Element("td",{styles:this.json.data.viewStyles?this.json.data.viewStyles.contentTd:this.css.viewContentTdNode}).inject(s);Object.each(e,function(e,i){var o=t.data[i];if(null!=o&&i!=this.json.data.group.column){var n=new Element("td",{styles:this.json.data.viewStyles?this.json.data.viewStyles.contentTd:this.css.viewContentTdNode}).inject(s);e.isHtml?n.set("html",o):n.set("text",o)}}.bind(this)),h.push(s)}.bind(this)),i.store("subtrs",h);var d=this;i.addEvent("click",(function(){var t=this.retrieve("subtrs"),e=i.getFirst("div");t[0]&&("none"==t[0].getStyle("display")?(t.each((function(t){t.setStyle("display","table-row")})),e?e.setStyle("background","url(../x_component_query_ViewDesigner/$View/default/icon/down.png) center center no-repeat"):this.setStyles(d.json.data.viewStyles.groupExpandNode)):(t.each((function(t){t.setStyle("display","none")})),e?e.setStyle("background","url(../x_component_query_ViewDesigner/$View/default/icon/right.png) center center no-repeat"):this.setStyles(d.json.data.viewStyles.groupCollapseNode))),d.setContentHeight()}))}.bind(this)),this.setContentColumnWidth(),this.setContentHeight()}else if(this.json.data.noDataText){var i=this.css.noDataTextNode;this.json.data.viewStyles&&(this.json.data.viewStyles.noDataTextNode?i=this.json.data.viewStyles.noDataTextNode:this.json.data.viewStyles.noDataTextNode=this.css.noDataTextNode),this.noDataTextNode=new Element("div",{styles:i,text:this.json.data.noDataText}).inject(this.viewContentBodyNode)}}else if(t.data.grid.length)t.data.grid.each(function(t,s){var i=new Element("tr",{styles:this.json.data.viewStyles?this.json.data.viewStyles.contentTr:this.css.viewContentTrNode}).inject(this.viewContentTableNode);Object.each(e,function(e,s){var o=t.data[s];if(null!=o){var n=new Element("td",{styles:this.json.data.viewStyles?this.json.data.viewStyles.contentTd:this.css.viewContentTdNode}).inject(i);e.isHtml?n.set("html",o):n.set("text",o)}}.bind(this))}.bind(this)),this.setContentColumnWidth(),this.setContentHeight();else if(this.json.data.noDataText){i=this.css.noDataTextNode;this.json.data.viewStyles&&(this.json.data.viewStyles.noDataTextNode?i=this.json.data.viewStyles.noDataTextNode:this.json.data.viewStyles.noDataTextNode=this.css.noDataTextNode),this.noDataTextNode=new Element("div",{styles:i,text:this.json.data.noDataText}).inject(this.viewContentBodyNode)}}.bind(this))}.bind(this))},setContentColumnWidth:function(){var t=this.viewTitleTrNode.getElements("td"),e=[];t.each((function(t){e.push(t.getSize().x)}));var s=!1;if(this.viewContentTableNode){trs=this.viewContentTableNode.getElements("tr");for(var i=0;i<trs.length;i++){if(trs[i].getElements("td").each((function(t,i){1==t.get("colSpan")&&(t.setStyle("width",e[i]+"px"),s=!0)})),s)break}}},addColumn:function(){MWF.require("MWF.widget.UUID",function(){var t=(new MWF.widget.UUID).id,e={id:t,column:t,displayName:this.designer.lp.unnamed,orderType:"original"};this.json.data.selectList||(this.json.data.selectList=[]),this.json.data.selectList.push(e);var s=new MWF.xApplication.query.ViewDesigner.View.Column(e,this);(this.items.push(s),s.selected(),this.viewContentTableNode)&&this.viewContentTableNode.getElements("tr").each(function(t){new Element("td",{styles:this.css.viewContentTdNode}).inject(t)}.bind(this));this.setViewWidth(),this.addColumnNode.scrollIntoView(!0)}.bind(this))},selected:function(){if(this.currentSelectedModule){if(this.currentSelectedModule==this)return!0;this.currentSelectedModule.unSelected()}this.currentSelectedModule=this,this.showProperty()},unSelected:function(){this.currentSelectedModule=null,this.hideProperty()},loadViewNodes:function(){this.viewAreaNode=new Element("div#viewAreaNode",{styles:this.css.viewAreaNode}).inject(this.areaNode),this.viewTitleNode=new Element("div#viewTitleNode",{styles:this.css.viewTitleNode}).inject(this.viewAreaNode),this.refreshNode=new Element("div",{styles:this.css.refreshNode}).inject(this.viewTitleNode),this.addColumnNode=new Element("div",{styles:this.css.addColumnNode}).inject(this.viewTitleNode),this.viewTitleContentNode=new Element("div",{styles:this.css.viewTitleContentNode}).inject(this.viewTitleNode),this.viewTitleTableNode=new Element("table",{styles:this.css.viewTitleTableNode,border:"0px",cellPadding:"0",cellSpacing:"0"}).inject(this.viewTitleContentNode),this.viewTitleTrNode=new Element("tr",{styles:this.css.viewTitleTrNode}).inject(this.viewTitleTableNode),this.viewContentScrollNode=new Element("div",{styles:this.css.viewContentScrollNode}).inject(this.viewAreaNode),this.viewContentNode=new Element("div",{styles:this.css.viewContentNode}).inject(this.viewContentScrollNode),MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.viewContentScrollNode,{style:"view",distance:100,indent:!1})}.bind(this)),this.contentLeftNode=new Element("div",{styles:this.css.contentLeftNode}).inject(this.viewContentNode),this.contentRightNode=new Element("div",{styles:this.css.contentRightNode}).inject(this.viewContentNode),this.viewContentBodyNode=new Element("div",{styles:this.css.viewContentBodyNode}).inject(this.viewContentNode),this.viewContentTableNode=new Element("table",{styles:this.css.viewContentTableNode,border:"0px",cellPadding:"0",cellSpacing:"0"}).inject(this.viewContentBodyNode)},setContentHeight:function(){var t=this.areaNode.getSize(),e=this.viewTitleNode.getSize(),s=this.actionbarNode?this.actionbarNode.getSize():{x:0,y:0},i=this.pagingNode?this.pagingNode.getSize():{x:0,y:0},o=t.y-e.y-s.y-i.y-2;this.viewContentScrollNode.setStyle("height",o);var n=this.viewContentBodyNode.getSize();o<n.y&&(o=n.y+10),this.viewContentNode.setStyle("height",o),this.contentLeftNode.setStyle("height",o),this.contentRightNode.setStyle("height",o)},loadViewColumns:function(){this.json.data.selectList&&this.json.data.selectList.each(function(t){this.items.push(new MWF.xApplication.query.ViewDesigner.View.Column(t,this))}.bind(this))},loadViewSelectAllNode:function(){var t=this,e=new Element("td.viewTitleCheckboxTd",{styles:this.css.viewTitleColumnAreaNode}).inject(this.viewTitleTrNode);e.setStyles({width:"30px","text-align":"center",display:this.json.data.selectAllEnable?"table-cell":"none"}),new Element("input",{type:"checkbox",events:{change:function(){t.viewContentTableNode.getElements(".viewContentCheckbox").set("checked",this.checked)}}}).inject(e)},createViewCheckboxTd:function(t){var e=new Element("td.viewContentCheckboxTd",{styles:this.css.viewContentTdNode}).inject(t,"top");e.setStyles({width:"30px","text-align":"center",display:this.json.data.selectAllEnable?"table-cell":"none"}),new Element("input.viewContentCheckbox",{type:"checkbox"}).inject(e)},loadView:function(){this.loadViewNodes(),this.loadViewColumns()},loadActionbar:function(){this.actionbarNode=new Element("div#actionbarNode",{styles:this.css.actionbarNode}).inject(this.areaNode),this.actionbarList=[],this.json.data.actionbarHidden||this.showActionbar(!0)},hideActionbar:function(){this.actionbarNode.hide(),this.setContentHeight()},showActionbar:function(t){this.actionbarNode.show(),this.json.data.actionbarList||(this.json.data.actionbarList=[]),this.actionbarList&&0!=this.actionbarList.length||(this.json.data.actionbarList.length?this.json.data.actionbarList.each(function(t){this.actionbarList.push(new MWF.xApplication.query.ViewDesigner.View.Actionbar(t,this.json.data.actionbarList,this))}.bind(this)):this.actionbarList.push(new MWF.xApplication.query.ViewDesigner.View.Actionbar(null,this.json.data.actionbarList,this))),t||this.setContentHeight()},loadPaging:function(t){this.pagingNode=new Element("div#pagingNode",{styles:this.css.pagingNode}).inject(this.areaNode),this.pagingList=[],this.json.data.pagingList||(this.json.data.pagingList=[]),this.pagingList&&0!=this.pagingList.length||(this.json.data.pagingList.length?this.json.data.pagingList.each(function(t){this.pagingList.push(new MWF.xApplication.query.ViewDesigner.View.Paging(t,this.json.data.pagingList,this))}.bind(this)):this.pagingList.push(new MWF.xApplication.query.ViewDesigner.View.Paging(null,this.json.data.pagingList,this)))},setViewWidth:function(){if(this.viewAreaNode){this.viewAreaNode.setStyle("width","auto"),this.viewTitleNode.setStyle("width","auto");var t=this.viewTitleTableNode.getSize(),e=this.refreshNode.getSize(),s=(this.addColumnNode.getSize(),t.x+e.x+e.x),i=this.areaNode.getSize();s>i.x?(this.viewTitleNode.setStyle("width",s+"px"),this.viewAreaNode.setStyle("width",s+"px")):(this.viewTitleNode.setStyle("width",i.x+"px"),this.viewAreaNode.setStyle("width",i.x+"px")),this.setContentColumnWidth(),this.setContentHeight()}},setAreaNodeSize:function(){},preview:function(){this.isNewView?this.designer.notice(this.designer.lp.saveViewNotice,"error"):this.saveSilence(function(){var t="../x_desktop/app.html?app=query.Query&status=";t+=JSON.stringify({id:this.data.application,viewId:this.data.id}),window.open(o2.filterUrl(t),"_blank")}.bind(this))},saveSilence:function(t){if(!this.data.name)return this.designer.notice(this.designer.lp.notice.inputName,"error"),!1;if(!this.data.data&&!this.data.data.where)return"cms"===this.data.type?(this.designer.notice(this.designer.lp.notice.selectCMS,"error"),!1):(this.designer.notice(this.designer.lp.notice.selectProcess,"error"),!1);var e=this.data.data.where;if("cms"===this.data.type){var s=e.appInfoList,i=e.categoryInfoList;if(!(s&&s.length||i&&i.length))return this.designer.notice(this.designer.lp.notice.selectCMS,"error"),!1}else{var o=e.applicationList,n=e.processList;if(!(o&&o.length||n&&n.length))return this.designer.notice(this.designer.lp.notice.selectProcess,"error"),!1}if(e.dateRange&&"range"===e.dateRange.dateRangeType&&(!e.dateRange.start||!e.dateRange.completed))return this.designer.notice(this.designer.lp.notice.selectDateRange,"error"),!1;this.designer.actions.saveView(this.data,function(e){this.data.id=e.data.id,this.isNewView=!1,this.lisNode&&this.lisNode.getLast().set("text",this.data.name+"("+this.data.alias+")"),t&&t()}.bind(this))},save:function(t){if(!this.data.name)return this.designer.notice(this.designer.lp.notice.inputName,"error"),!1;if(!this.data.data&&!this.data.data.where)return"cms"===this.data.type?(this.designer.notice(this.designer.lp.notice.selectCMS,"error"),!1):(this.designer.notice(this.designer.lp.notice.selectProcess,"error"),!1);var e=this.data.data.where;if("cms"===this.data.type){var s=e.appInfoList,i=e.categoryInfoList;if(!(s&&s.length||i&&i.length))return this.designer.notice(this.designer.lp.notice.selectCMS,"error"),!1}else{var o=e.applicationList,n=e.processList;if(!(o&&o.length||n&&n.length))return this.designer.notice(this.designer.lp.notice.selectProcess,"error"),!1}if(e.dateRange&&"range"===e.dateRange.dateRangeType&&(!e.dateRange.start||!e.dateRange.completed))return this.designer.notice(this.designer.lp.notice.selectDateRange,"error"),!1;this.designer.actions.saveView(this.data,function(e){this.designer.notice(this.designer.lp.notice.save_success,"success",this.node,{x:"left",y:"bottom"}),this.isNewView=!1,this.data.id=e.data.id,this.lisNode&&this.lisNode.getLast().set("text",this.data.name+"("+this.data.alias+")"),t&&t()}.bind(this))},explode:function(){},implode:function(){},_setEditStyle:function(t,e,s){if("type"==t&&this.items.each(function(e){if(e.property){var s=e.property.propertyContent.getElements("#"+e.json.id+"dataPathSelectedProcessArea"),i=e.property.propertyContent.getElements("#"+e.json.id+"dataPathSelectedCMSArea");"cms"==this.json[t]?(i.setStyle("display","block"),s.setStyle("display","none")):(i.setStyle("display","none"),s.setStyle("display","block"))}}.bind(this)),"data.actionbarHidden"==t&&(this.json.data.actionbarHidden?this.hideActionbar():this.showActionbar()),"data.selectAllEnable"==t&&(this.json.data.selectAllEnable?(this.viewTitleTrNode.getElement(".viewTitleCheckboxTd").setStyle("display","table-cell"),this.viewContentTableNode.getElements(".viewContentCheckboxTd").setStyle("display","table-cell")):(this.viewTitleTrNode.getElement(".viewTitleCheckboxTd").setStyle("display","none"),this.viewContentTableNode.getElements(".viewContentCheckboxTd").setStyle("display","none"))),"data.viewStyleType"==t){var i=this.stylesList&&this.json.data.viewStyleType?this.stylesList[this.json.data.viewStyleType].file:null,o=this.stylesList&&this.json.data.viewStyleType?this.stylesList[this.json.data.viewStyleType].extendFile:null;this.loadTemplateStyles(i,o,function(t){var e,i;this.templateStyles=t,s&&this.stylesList[s]&&(e=this.stylesList[s].file,i=this.stylesList[s].extendFile),this.loadTemplateStyles(e,i,function(t){this.json.data.styleConfig=this.stylesList&&this.json.data.viewStyleType?this.stylesList[this.json.data.viewStyleType]:null,t.view&&this.clearTemplateStyles(t.view),this.templateStyles.view&&this.setTemplateStyles(this.templateStyles.view),this.setAllStyles(),this.actionbarList.each((function(e){t.actionbar&&e.clearTemplateStyles(t.actionbar),e.setStyleTemplate(),e.setAllStyles()})),this.pagingList.each((function(e){t.paging&&e.clearTemplateStyles(t.paging),e.setStyleTemplate(),e.setAllStyles()}))}.bind(this))}.bind(this))}"data.viewStyles"==t&&this.setCustomStyles()},setAllStyles:function(){this.setCustomStyles(),this.reloadMaplist()},reloadMaplist:function(){this.property&&Object.each(this.property.maplists,function(t,e){t.reload(this.json[e])}.bind(this))},setCustomStyles:function(){this.items.each(function(t){t.setCustomStyles()}.bind(this))},loadTemplateStyle:function(t){this.loadStylesList(function(){this.json.data.viewStyleType&&this.stylesList[this.json.data.viewStyleType]||(this.json.data.viewStyleType="default"),this.loadTemplateStyles(this.stylesList[this.json.data.viewStyleType].file,this.stylesList[this.json.data.viewStyleType].extendFile,function(e){this.templateStyles=e,this.json.data.viewStyleType||(this.json.data.viewStyleType="default"),this.templateStyles&&this.templateStyles.view&&(this.json.data.viewStyles?this.setTemplateStyles(this.templateStyles.view):this.json.data.viewStyles=Object.clone(this.templateStyles.view)),this.setCustomStyles(),t&&t()}.bind(this))}.bind(this))},removeStyles:function(t,e){this.json.data.viewStyles[e]&&Object.each(t,function(t,s){this.json.data.viewStyles[e][s]&&this.json.data.viewStyles[e][s]==t&&delete this.json.data.viewStyles[e][s]}.bind(this))},copyStyles:function(t,e){this.json.data.viewStyles[e]||(this.json.data.viewStyles[e]={}),Object.each(t,function(t,s){this.json.data.viewStyles[e][s]||(this.json.data.viewStyles[e][s]=t)}.bind(this))},clearTemplateStyles:function(t){t&&(t.container&&this.removeStyles(t.container,"container"),t.table&&this.removeStyles(t.table,"table"),t.titleTr&&this.removeStyles(t.titleTr,"titleTr"),t.titleTd&&this.removeStyles(t.titleTd,"titleTd"),t.contentTr&&this.removeStyles(t.contentTr,"contentTr"),t.contentSelectedTr&&this.removeStyles(t.contentSelectedTr,"contentSelectedTr"),t.contentTd&&this.removeStyles(t.contentTd,"contentTd"),t.contentGroupTd&&this.removeStyles(t.contentGroupTd,"contentGroupTd"),t.groupCollapseNode&&this.removeStyles(t.groupCollapseNode,"groupCollapseNode"),t.groupExpandNode&&this.removeStyles(t.groupExpandNode,"groupExpandNode"),t.checkboxNode&&this.removeStyles(t.checkboxNode,"checkboxNode"),t.checkedCheckboxNode&&this.removeStyles(t.checkedCheckboxNode,"checkedCheckboxNode"),t.radioNode&&this.removeStyles(t.radioNode,"radioNode"),t.checkedRadioNode&&this.removeStyles(t.checkedRadioNode,"checkedRadioNode"),t.tableProperties&&this.removeStyles(t.tableProperties,"tableProperties"))},setTemplateStyles:function(t){t.container&&this.copyStyles(t.container,"container"),t.table&&this.copyStyles(t.table,"table"),t.titleTr&&this.copyStyles(t.titleTr,"titleTr"),t.titleTd&&this.copyStyles(t.titleTd,"titleTd"),t.contentTr&&this.copyStyles(t.contentTr,"contentTr"),t.contentSelectedTr&&this.copyStyles(t.contentSelectedTr,"contentSelectedTr"),t.contentTd&&this.copyStyles(t.contentTd,"contentTd"),t.contentGroupTd&&this.copyStyles(t.contentGroupTd,"contentGroupTd"),t.groupCollapseNode&&this.copyStyles(t.groupCollapseNode,"groupCollapseNode"),t.groupExpandNode&&this.copyStyles(t.groupExpandNode,"groupExpandNode"),t.checkboxNode&&this.copyStyles(t.checkboxNode,"checkboxNode"),t.checkedCheckboxNode&&this.copyStyles(t.checkedCheckboxNode,"checkedCheckboxNode"),t.radioNode&&this.copyStyles(t.radioNode,"radioNode"),t.checkedRadioNode&&this.copyStyles(t.checkedRadioNode,"checkedRadioNode"),t.tableProperties&&this.copyStyles(t.tableProperties,"tableProperties")},loadTemplateStyles:function(t,e,s){t?(this.templateStylesList=this.templateStylesList||{},this.templateStylesList[t]?s&&s(this.templateStylesList[t]):this.loadTemplateStyleFile(t,function(i){this.loadTemplateExtendStyleFile(e,function(e){this.templateStylesList[t]=Object.merge(i,e),s&&s(this.templateStylesList[t])}.bind(this))}.bind(this))):s&&s({})},loadTemplateStyleFile:function(t,e){if(t){var s="../x_component_query_ViewDesigner/$View/skin/"+t;MWF.getJSON(s,{onSuccess:function(t){e&&e(t)}.bind(this),onRequestFailure:function(){e&&e({})}.bind(this),onError:function(){e&&e({})}.bind(this)})}else e&&e({})},loadTemplateExtendStyleFile:function(t,e){if(t){var s="../x_component_query_ViewDesigner/$View/skin/"+t;MWF.getJSON(s,{onSuccess:function(t){e&&e(t)}.bind(this),onRequestFailure:function(){e&&e({})}.bind(this),onError:function(){e&&e({})}.bind(this)})}else e&&e({})},loadStylesList:function(t){MWF.getJSON("../x_component_query_ViewDesigner/$View/skin/config.json",{onSuccess:function(e){this.stylesList=e,t&&t(this.stylesList)}.bind(this),onRequestFailure:function(){this.stylesList={},t&&t(this.stylesList)}.bind(this),onError:function(){this.stylesList={},t&&t(this.stylesList)}.bind(this)})},saveAs:function(){new MWF.xApplication.query.ViewDesigner.View.NewNameForm(this,{name:this.data.name+"_"+MWF.xApplication.query.ViewDesigner.LP.copy,query:this.data.query||this.data.application,queryName:this.data.queryName||this.data.applicationName},{onSave:function(t,e){this._saveAs(t,e)}.bind(this)},{app:this.designer}).edit()},cloneObject:function(t){if(null==t||"object"!=typeof t)return t;if("number"==typeof t.length){for(var e=[],s=0,i=t.length;s<i;++s)e[s]=this.cloneObject(t[s]);return e}e={};for(var o in t)e[o]=this.cloneObject(t[o]);return e},_saveAs:function(t,e){var s=this.cloneObject(this.data);s.isNewView=!0,s.id=this.designer.actions.getUUID(),s.name=t.name,s.alias="",s.query=t.query,s.queryName=t.queryName,s.application=t.query,s.applicationName=t.queryName,s.pid=s.id+s.id,delete s[this.data.id+"viewFilterType"],s[s.id+"viewFilterType"]="custom",s.data.selectList.each(function(t){t.id=(new MWF.widget.UUID).id}.bind(this)),this.designer.actions.saveView(s,function(t){this.designer.notice(this.designer.lp.notice.saveAs_success,"success",this.node,{x:"left",y:"bottom"}),e&&e()}.bind(this))}}),MWF.xApplication.query.ViewDesigner.View.$Module=MWF.QV$Module=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],copyStyles:function(t,e){this.json[e]||(this.json[e]={}),Object.each(t,function(t,s){this.json[e][s]=t}.bind(this))},removeStyles:function(t,e){this.json[e]&&Object.each(t,function(t,s){this.json[e][s]&&this.json[e][s]==t&&delete this.json[e][s]}.bind(this))},setTemplateStyles:function(t){t.styles&&this.copyStyles(t.styles,"styles"),t.properties&&this.copyStyles(t.properties,"properties")},clearTemplateStyles:function(t){t&&(t.styles&&this.removeStyles(t.styles,"styles"),t.properties&&this.removeStyles(t.properties,"properties"))},setStyleTemplate:function(){this.view.templateStyles&&this.view.templateStyles[this.moduleName]&&this.setTemplateStyles(this.view.templateStyles[this.moduleName])},setAllStyles:function(){this.setPropertiesOrStyles("styles"),this.setPropertiesOrStyles("inputStyles"),this.setPropertiesOrStyles("properties"),this.reloadMaplist()},showProperty:function(){this.property?this.property.show():(this.property=new MWF.xApplication.query.ViewDesigner.Property(this,this.view.designer.propertyContentArea,this.view.designer,{path:this.propertyPath,onPostLoad:function(){this.property.show()}.bind(this)}),this.property.load())},hideProperty:function(){this.property&&this.property.hide()},deletePropertiesOrStyles:function(t,e){if("properties"==t)try{this.node.removeProperty(e)}catch(t){}},setPropertiesOrStyles:function(t){if("styles"==t)try{this.setCustomStyles()}catch(t){}if("properties"==t)try{this.node.setProperties(this.json.properties)}catch(t){}},setCustomNodeStyles:function(t,e){var s=t.getStyle("border");t.clearStyles(),t.setStyle("border",s),Object.each(e,function(e,s){s.test(/^border\w*/gi)||t.setStyle(s,e)}.bind(this))},setCustomStyles:function(){var t=this.node.getStyle("border");this.node.clearStyles(),this.node.setStyles(this.css.moduleNode),this.initialStyles&&this.node.setStyles(this.initialStyles),this.node.setStyle("border",t),this.json.styles&&Object.each(this.json.styles,function(t,e){if(-1!=t.indexOf("x_processplatform_assemble_surface")||-1!=t.indexOf("x_portal_assemble_surface")){var s=MWF.Actions.getHost("x_processplatform_assemble_surface"),i=MWF.Actions.getHost("x_portal_assemble_surface");-1!==t.indexOf("/x_processplatform_assemble_surface")?t=t.replace("/x_processplatform_assemble_surface",s+"/x_processplatform_assemble_surface"):-1!==t.indexOf("x_processplatform_assemble_surface")&&(t=t.replace("x_processplatform_assemble_surface",s+"/x_processplatform_assemble_surface")),-1!==t.indexOf("/x_portal_assemble_surface")?t=t.replace("/x_portal_assemble_surface",i+"/x_portal_assemble_surface"):-1!==t.indexOf("x_portal_assemble_surface")&&(t=t.replace("x_portal_assemble_surface",i+"/x_portal_assemble_surface")),t=o2.filterUrl(t)}e.test(/^border\w*/gi)||e&&("display"===e.toString().toLowerCase()?"none"===t.toString().toLowerCase()?this.node.setStyle("opacity",.3):(this.node.setStyle("opacity",1),this.node.setStyle(e,t)):this.node.setStyle(e,t))}.bind(this))},_setEditStyle:function(t,e,s){var i="",o="";"name"===t&&(i=this.json.name||this.json.id,o=this.json.type.substr(this.json.type.lastIndexOf("$")+1,this.json.type.length),this.treeNode.setText("<"+o+"> "+i)),"id"===t&&(i=this.json.name||this.json.id,this.json.name||(o=this.json.type.substr(this.json.type.lastIndexOf("$")+1,this.json.type.length),this.treeNode.setText("<"+o+"> "+this.json.id)),this.treeNode.setTitle(this.json.id),this.node.set("id",this.json.id)),this._setEditStyle_custom(t,e,s)},reloadMaplist:function(){this.property&&Object.each(this.property.maplists,function(t,e){t.reload(this.json[e])}.bind(this))},getHtml:function(){var t=this.node.clone(!0,!0);t.clearStyles(!0);var e=t.outerHTML;return t.destroy(),e},getJson:function(){var t=Object.clone(this.json),e={};return e[t.id]=t,e}}),MWF.xApplication.query.ViewDesigner.View.Column=new Class({Extends:MWF.QV$Module,initialize:function(t,e,s){this.propertyPath="../x_component_query_ViewDesigner/$View/column.html",this.view=e,this.json=t,this.next=s,this.css=this.view.css,this.content=this.view.viewTitleTrNode,this.domListNode=this.view.domListNode,this.load()},load:function(){this.json.events?this._load():this.loadDefaultJson(function(){this._load()}.bind(this))},_load:function(){this.areaNode=new Element("td",{styles:this.css.viewTitleColumnAreaNode}),this.areaNode.store("column",this),this.next?this.areaNode.inject(this.next.areaNode,"before"):this.areaNode.inject(this.content),this.node=new Element("div",{styles:this.css.viewTitleColumnNode}).inject(this.areaNode),this.textNode=new Element("div",{styles:this.css.viewTitleColumnTextNode,text:this.json.displayName}).inject(this.node),this.createDomListItem(),this._createIconAction(),this.setEvent(),this.setCustomStyles()},loadDefaultJson:function(t){if(this.view.defaultColumnJson)return this.json=Object.merge(this.json,Object.clone(this.view.defaultColumnJson)),void(t&&t(this.json));var e=this.view.path+"column.json";MWF.getJSON(e,{onSuccess:function(e){this.view.defaultColumnJson=Object.clone(e),this.json=Object.merge(this.json,Object.clone(e)),t&&t(this.json)}.bind(this),onerror:function(t){this.view.designer.notice(t,"error")}.bind(this),onRequestFailure:function(t){this.view.designer.notice(t.responseText,"error")}.bind(this)},!1)},setCustomStyles:function(){var t=this.view.json.data.viewStyles,e=this.areaNode.getStyle("border");this.areaNode.clearStyles(),this.areaNode.setStyles(this.css.viewTitleColumnAreaNode),this.node.setStyle("border",e),Object.each(t.titleTd,function(t,e){e.test(/^border\w*/gi)||this.node.setStyle(e,t)}.bind(this))},createDomListItem:function(){this.listNode=new Element("div",{styles:this.css.cloumnListNode}),this.next?this.listNode.inject(this.next.listNode,"before"):this.listNode.inject(this.domListNode);new Element("div",{styles:this.css.cloumnListIconNode}).inject(this.listNode),new Element("div",{styles:this.css.cloumnListTextNode}).inject(this.listNode);this.resetTextNode()},setEvent:function(){this.node.addEvents({click:function(t){this.selected(),t.stopPropagation()}.bind(this),mouseover:function(){this.isSelected||this.node.setStyles(this.css.viewTitleColumnNode_over)}.bind(this),mouseout:function(){this.isSelected||(this.isError?this.node.setStyles(this.css.viewTitleColumnNode_error):this.node.setStyles(this.css.viewTitleColumnNode))}.bind(this)}),this.listNode.addEvents({click:function(t){this.selected(),t.stopPropagation()}.bind(this),mouseover:function(){this.isSelected||this.listNode.setStyles(this.css.cloumnListNode_over)}.bind(this),mouseout:function(){this.isSelected||this.listNode.setStyles(this.css.cloumnListNode)}.bind(this)})},_createIconAction:function(){this.actionArea||(this.actionArea=new Element("div",{styles:this.css.actionAreaNode}).inject(this.view.areaNode,"after"),this._createAction({name:"move",icon:"move1.png",event:"mousedown",action:"move",title:MWF.APPDVD.LP.action.move}),this._createAction({name:"add",icon:"add.png",event:"click",action:"addColumn",title:MWF.APPDVD.LP.action.add}),this._createAction({name:"delete",icon:"delete1.png",event:"click",action:"delete",title:MWF.APPDVD.LP.action.delete}))},_createAction:function(t){var e=new Element("div",{styles:this.css.actionNodeStyles,title:t.title}).inject(this.actionArea);e.setStyle("background","url("+this.view.path+this.view.options.style+"/action/"+t.icon+") no-repeat left center"),e.addEvent(t.event,function(e){this[t.action](e)}.bind(this)),e.addEvents({mouseover:function(t){t.target.setStyle("border","1px solid #999")}.bind(this),mouseout:function(t){t.target.setStyle("border","1px solid #F1F1F1")}.bind(this)})},_setActionAreaPosition:function(){var t=this.node.getPosition(this.view.areaNode.getOffsetParent()),e=t.y-25,s=t.x;this.actionArea.setPosition({x:s,y:e})},_showActions:function(){this.actionArea&&(this._setActionAreaPosition(),this.actionArea.setStyle("display","block"))},_hideActions:function(){this.actionArea&&this.actionArea.setStyle("display","none")},selected:function(){if(this.view.currentSelectedModule){if(this.view.currentSelectedModule==this)return!0;this.view.currentSelectedModule.unSelected()}this.node.setStyles(this.css.viewTitleColumnNode_selected),this.listNode.setStyles(this.css.cloumnListNode_selected),new Fx.Scroll(this.view.areaNode,{wheelStops:!1,duration:100}).toElementEdge(this.node),new Fx.Scroll(this.view.designer.propertyDomArea,{wheelStops:!1,duration:100}).toElement(this.listNode),this.view.currentSelectedModule=this,this.isSelected=!0,this._showActions(),this.showProperty()},unSelected:function(){this.view.currentSelectedModule=null,this.isError?this.node.setStyles(this.css.viewTitleColumnNode_error):this.node.setStyles(this.css.viewTitleColumnNode),this.listNode.setStyles(this.css.cloumnListNode),this.isSelected=!1,this._hideActions(),this.hideProperty()},showProperty:function(){this.property?this.property.show():(this.property=new MWF.xApplication.query.ViewDesigner.Property(this,this.view.designer.propertyContentArea,this.view.designer,{path:this.propertyPath,onPostLoad:function(){this.property.show();var t=this.property.propertyContent.getElements("#"+this.json.id+"dataPathSelectedProcessArea"),e=this.property.propertyContent.getElements("#"+this.json.id+"dataPathSelectedCMSArea");"cms"==this.view.json.type?(t.setStyle("display","none"),e.setStyle("display","block")):(t.setStyle("display","block"),e.setStyle("display","none"))}.bind(this)}),this.property.load())},hideProperty:function(){this.property&&this.property.hide()},_setEditStyle:function(t,e,s){"displayName"==t&&this.resetTextNode(),"selectType"==t&&this.resetTextNode(),"attribute"==t&&this.resetTextNode(),"path"==t&&this.resetTextNode(),"column"==t&&(this.view.json.data.orderList.each(function(t){t.column==s&&(t.column=this.json.column)}.bind(this)),this.view.json.data.group.column==s&&(this.view.json.data.group.column=this.json.column))},resetTextNode:function(){var t="attribute"==this.json.selectType?this.json.attribute||"":this.json.path||"";t||(t="unnamed"),this.textNode.set("text",this.json.displayName),this.listNode.getLast().set("text",this.json.displayName+"("+t+")")},delete:function(t){var e=this;t||(t=this.node),this.view.designer.confirm("warn",t,MWF.APPDVD.LP.notice.deleteColumnTitle,MWF.APPDVD.LP.notice.deleteColumn,300,120,(function(){e.destroy(),this.close()}),(function(){this.close()}),null)},isOrderColumn:function(){var t=this.view.json.data.orderList||[],e=!1;return t.each(function(t){t.column==this.json.column&&(e=!0)}.bind(this)),e},isGroupColumn:function(){return!!(this.view.json&&this.view.json.data&&this.view.json.data.group)&&this.view.json.data.group.column===this.json.column},destroy:function(){this.view.currentSelectedModule==this&&(this.view.currentSelectedModule=null),this.actionArea&&this.actionArea.destroy(),this.listNode&&this.listNode.destroy(),this.property&&this.property.propertyContent.destroy();var t=this.view.items.indexOf(this);if(this.view.viewContentTableNode){var e=this.view.viewContentTableNode.getElements("tr"),s=this.isGroupColumn();e.each(function(e){s?"yes"===e.get("data-is-group")&&e.destroy():"yes"!==e.get("data-is-group")&&e.deleteCell(t)}.bind(this))}this.view.json.data.group.column===this.json.column&&(this.view.json.data.group.column=null);var i=this.view.json.data.orderList||[],o=null;i.each(function(t){t.column==this.json.column&&(o=t)}.bind(this)),o&&i.erase(o),this.view.json.data.selectList&&this.view.json.data.selectList.erase(this.json),this.view.json.data.calculate&&this.view.json.data.calculate.calculateList&&this.view.json.data.calculate.calculateList.erase(this.json),this.view.items.erase(this),this.view.property&&this.view.property.loadStatColumnSelect(),this.areaNode.destroy(),this.view.selected(),this.view.setViewWidth(),MWF.release(this)},addColumn:function(t,e){MWF.require("MWF.widget.UUID",function(){var t;if(e)(t=Object.clone(e)).id=(new MWF.widget.UUID).id,t.column=(new MWF.widget.UUID).id;else{var s=(new MWF.widget.UUID).id;t={id:s,column:s,displayName:this.view.designer.lp.unnamed,orderType:"original"}}var i=this.view.json.data.selectList.indexOf(this.json);this.view.json.data.selectList.splice(i,0,t);var o=new MWF.xApplication.query.ViewDesigner.View.Column(t,this.view,this);(this.view.items.splice(i,0,o),o.selected(),this.view.viewContentTableNode)&&this.view.viewContentTableNode.getElements("tr").each(function(t){t.insertCell(i).setStyles(this.css.viewContentTdNode)}.bind(this));this.view.setViewWidth()}.bind(this))},move:function(t){var e=[];this.view.items.each(function(t){t!=this&&e.push(t.areaNode)}.bind(this)),this._createMoveNode(),this._setNodeMove(e,t)},_createMoveNode:function(){this.moveNode=new Element("div",{text:this.node.get("text")}),this.moveNode.inject(this.view.designer.content),this.moveNode.setStyles({border:"2px dashed #ffa200",opacity:.7,height:"30px","line-height":"30px",padding:"0px 10px",position:"absolute"})},_setMoveNodePosition:function(t){var e=t.page.x+2,s=t.page.y+2;this.moveNode.positionTo(e,s)},createMoveFlagNode:function(){this.moveFlagNode=new Element("td",{styles:this.css.moveFlagNode})},_setNodeMove:function(t,e){this._setMoveNodePosition(e);var s=this.moveNode.getPosition(),i=this.moveNode.getSize(),o=this.content.getPosition(),n=this.content.getSize();new Drag.Move(this.moveNode,{droppables:t,limit:{x:[o.x,o.x+n.x],y:[s.y,s.y+i.y]},onEnter:function(t,e){this.moveFlagNode||this.createMoveFlagNode(),this.moveFlagNode.inject(e,"before")}.bind(this),onLeave:function(t,e){this.moveFlagNode&&this.moveFlagNode.dispose()}.bind(this),onDrop:function(t,e){if(e){this.areaNode.inject(e,"before");var s=e.retrieve("column");this.listNode.inject(s.listNode,"before"),this.view.json.data.selectList.erase(this.json),this.view.items.erase(this);var i=this.view.json.data.selectList.indexOf(s.json);this.view.json.data.selectList.splice(i,0,this.json),this.view.items.splice(i,0,this),this.moveNode&&this.moveNode.destroy(),this.moveFlagNode&&this.moveFlagNode.destroy(),this._setActionAreaPosition()}else this.moveNode&&this.moveNode.destroy(),this.moveFlagNode&&this.moveFlagNode.destroy()}.bind(this),onCancel:function(t){this.moveNode&&this.moveNode.destroy(),this.moveFlagNode&&this.moveFlagNode.destroy()}.bind(this)}).start(e)}}),MWF.require("MWF.widget.Toolbar",null,!1),MWF.xApplication.query.ViewDesigner.View.Actionbar=new Class({Extends:MWF.xApplication.query.ViewDesigner.View.$Module,options:{style:"default",customImageStyle:"default"},initialize:function(t,e,s,i){this.setOptions(i),this.propertyPath="../x_component_query_ViewDesigner/$View/actionbar.html",this.path="../x_component_query_ViewDesigner/$View/",this.imagePath_default="../x_component_query_ViewDesigner/$View/",this.imagePath_custom="../x_component_process_FormDesigner/Module/Actionbar/",this.cssPath="../x_component_query_ViewDesigner/$View/"+this.options.style+"/actionbar.wcss",this.view=s,this.json=t,this.jsonList=e,this.css=this.view.css,this.container=this.view.actionbarNode,this.moduleName="actionbar",this.load()},load:function(){this.systemTools=[],this.customTools=[],this.json?this._load():this.loadDefaultJson(function(){this._load()}.bind(this))},_load:function(){this.json.moduleName=this.moduleName,this._createNode(),this.setEvent()},loadDefaultJson:function(t){var e=this.path+"actionbar.json";MWF.getJSON(e,{onSuccess:function(e){this.view.designer.actions.getUUID(function(s){e.id=s,this.json=e,this.jsonList.push(this.json),t&&t(e)}.bind(this))}.bind(this),onerror:function(t){this.view.designer.notice(t,"error")}.bind(this),onRequestFailure:function(t){this.view.designer.notice(t.responseText,"error")}.bind(this)})},setTemplateStyles:function(t){this.json.style=t.style,this.json.iconStyle=t.iconStyle||"",this.json.iconOverStyle=t.iconOverStyle||"",this.json.customIconStyle=t.customIconStyle,this.json.customIconOverStyle=t.customIconOverStyle||"",this.json.forceStyles=t.forceStyles||""},clearTemplateStyles:function(t){this.json.style="form",this.json.iconStyle="",this.json.iconOverStyle="",this.json.customIconStyle="",this.json.customIconOverStyle="",this.json.forceStyles=""},setAllStyles:function(){this._resetActionbar()},setEvent:function(){this.node.addEvents({click:function(t){this.selected(),t.stopPropagation()}.bind(this),mouseover:function(){this.isSelected||this.node.setStyles(this.css.toolbarWarpNode_over)}.bind(this),mouseout:function(){this.isSelected||this.node.setStyles(this.css.toolbarWarpNode)}.bind(this)})},selected:function(){if(this.view.currentSelectedModule){if(this.view.currentSelectedModule==this)return!0;this.view.currentSelectedModule.unSelected()}this.node.setStyles(this.css.toolbarWarpNode_selected),new Fx.Scroll(this.view.areaNode,{wheelStops:!1,duration:100}).toElementEdge(this.node),this.view.currentSelectedModule=this,this.isSelected=!0,this.showProperty()},unSelected:function(){this.view.currentSelectedModule=null,this.node.setStyles(this.css.toolbarWarpNode),this.isSelected=!1,this.hideProperty()},resetTextNode:function(){var t="attribute"==this.json.selectType?this.json.attribute||"":this.json.path||"";t||(t="unnamed"),this.textNode.set("text",this.json.displayName),this.listNode.getLast().set("text",this.json.displayName+"("+t+")")},getJsonPath:function(){return this.path+"toolbars.json"},_createNode:function(t){this.node=new Element("div",{id:this.json.id,MWFType:"actionbar",styles:this.css.toolbarWarpNode,events:{selectstart:function(t){t.preventDefault()}}}).inject(this.container),this.toolbarNode=new Element("div").inject(this.node),this.toolbarWidget=new MWF.widget.Toolbar(this.toolbarNode,{style:this.json.style},this),this.json.actionStyles?this.toolbarWidget.css=Object.clone(this.json.actionStyles):this.json.actionStyles=Object.clone(this.toolbarWidget.css),this.loadMultiToolbar()},_refreshActionbar:function(){this.toolbarNode=this.node.getFirst("div"),this.toolbarNode.empty(),this.toolbarWidget=new MWF.widget.Toolbar(this.toolbarNode,{style:this.json.style},this),this.json.actionStyles||(this.json.actionStyles=Object.clone(this.toolbarWidget.css)),this.toolbarWidget.css=this.json.actionStyles,this.loadMultiToolbar()},_resetActionbar:function(){this.toolbarNode=this.node.getFirst("div"),this.toolbarNode.empty(),this.toolbarWidget=new MWF.widget.Toolbar(this.toolbarNode,{style:this.json.style},this),this.json.actionStyles?(this.toolbarWidget.css=Object.merge(Object.clone(this.json.actionStyles),this.toolbarWidget.css,this.json.forceStyles||{}),this.json.actionStyles=Object.clone(this.toolbarWidget.css)):this.json.actionStyles=Object.merge(Object.clone(this.toolbarWidget.css),this.json.forceStyles||{}),this.loadMultiToolbar()},loadMultiToolbar:function(){if(this.json.multiTools){var t=Array.clone(this.json.multiTools);this.setMultiToolbars(t,this.toolbarNode),this.toolbarWidget.load(),this._setEditStyle_custom("hideSystemTools")}else this.json.defaultTools?(this.json.multiTools=this.json.defaultTools.map((function(t){return t.system=!0,t})),this.json.tools&&(this.json.multiTools=this.json.multiTools.concat(this.json.tools)),this.setMultiToolbars(Array.clone(this.json.multiTools),this.toolbarNode),this.toolbarWidget.load(),this._setEditStyle_custom("hideSystemTools")):MWF.getJSON(this.getJsonPath(),function(t){this.json.multiTools=t.map((function(t){return t.system=!0,t})),this.json.tools&&(this.json.multiTools=this.json.multiTools.concat(this.json.tools)),this.setMultiToolbars(Array.clone(this.json.multiTools),this.toolbarNode),this.toolbarWidget.load(),this._setEditStyle_custom("hideSystemTools")}.bind(this),!1)},setMultiToolbars:function(t,e){t.each(function(t){t.system?this.setToolbars([t],e):this.setCustomToolbars([t],e)}.bind(this))},setToolbars:function(t,e){t.each(function(t){var s=new Element("div",{MWFnodetype:t.type,MWFButtonImage:this.imagePath_default+""+this.options.style+"/actionbar/"+(this.json.iconStyle||"default")+"/"+t.img,title:t.title,MWFButtonAction:t.action,MWFButtonText:t.text}).inject(e);if(this.json.iconOverStyle&&s.set("MWFButtonImageOver",this.imagePath_default+""+this.options.style+"/actionbar/"+this.json.iconOverStyle+"/"+t.img),this.systemTools.push(s),t.sub){var i=e.getLast();this.setToolbars(t.sub,i)}}.bind(this))},setCustomToolbars:function(t,e){var s="";this.json.customIconStyle&&(s=this.json.customIconStyle+"/"),t.each(function(t){var i=new Element("div",{MWFnodetype:t.type,MWFButtonImage:this.imagePath_custom+""+this.options.customImageStyle+"/custom/"+s+t.img,title:t.title,MWFButtonAction:t.action,MWFButtonText:t.text}).inject(e);if(this.json.customIconOverStyle&&i.set("MWFButtonImageOver",this.imagePath_custom+""+this.options.customImageStyle+"/custom/"+this.json.customIconOverStyle+"/"+t.img),this.customTools.push(i),t.sub){var o=e.getLast();this.setToolbars(t.sub,o)}}.bind(this))},_setEditStyle_custom:function(t){"hideSystemTools"==t&&(this.json.hideSystemTools?this.systemTools.each((function(t){t.setStyle("display","none")})):this.systemTools.each((function(t){t.setStyle("display","block")}))),"defaultTools"!=t&&"tools"!=t&&"multiTools"!=t&&"actionStyles"!==t||this._refreshActionbar()}}),MWF.require("MWF.widget.Paging",null,!1),MWF.xApplication.query.ViewDesigner.View.Paging=new Class({Extends:MWF.xApplication.query.ViewDesigner.View.$Module,options:{style:"default"},initialize:function(t,e,s,i){this.setOptions(i),this.propertyPath="../x_component_query_ViewDesigner/$View/paging.html",this.view=s,this.json=t,this.jsonList=e,this.css=this.view.css,this.container=this.view.pagingNode,this.moduleName="paging",this.load()},load:function(){this.systemTools=[],this.customTools=[],this.json?this._load():this.loadDefaultJson(function(){this._load()}.bind(this))},_load:function(){this.json.moduleName=this.moduleName,this._createNode(),this.setEvent()},loadDefaultJson:function(t){var e=this.view.path+"paging.json";MWF.getJSON(e,{onSuccess:function(e){this.view.designer.actions.getUUID(function(s){e.id=s,this.json=e,this.jsonList.push(this.json),t&&t(e)}.bind(this))}.bind(this),onerror:function(t){this.view.designer.notice(t,"error")}.bind(this),onRequestFailure:function(t){this.view.designer.notice(t.responseText,"error")}.bind(this)})},setTemplateStyles:function(t){"rect"===this.json.buttonStyle?this.json.style=t.style_rect:"round"===this.json.buttonStyle?this.json.style=t.style_round:this.json.style=t.style,this.json.forceStyles=t.forceStyles||""},clearTemplateStyles:function(t){this.json.style="blue_round",this.json.forceStyles=""},setAllStyles:function(){this._resetPaging()},setEvent:function(){this.node.addEvents({click:function(t){this.selected(),t.stopPropagation()}.bind(this),mouseover:function(){this.isSelected||this.node.setStyles(this.css.pagingWarpNode_over)}.bind(this),mouseout:function(){this.isSelected||this.node.setStyles(this.css.pagingWarpNode)}.bind(this)})},selected:function(){if(this.view.currentSelectedModule){if(this.view.currentSelectedModule==this)return!0;this.view.currentSelectedModule.unSelected()}this.node.setStyles(this.css.pagingWarpNode_selected),new Fx.Scroll(this.view.areaNode,{wheelStops:!1,duration:100}).toElementEdge(this.node),this.view.currentSelectedModule=this,this.isSelected=!0,this.showProperty()},unSelected:function(){this.view.currentSelectedModule=null,this.node.setStyles(this.css.pagingWarpNode),this.isSelected=!1,this.hideProperty()},resetTextNode:function(){var t="attribute"==this.json.selectType?this.json.attribute||"":this.json.path||"";t||(t="unnamed"),this.textNode.set("text",this.json.displayName),this.listNode.getLast().set("text",this.json.displayName+"("+t+")")},_createNode:function(t){this.node=new Element("div",{id:this.json.id,MWFType:"paging",styles:this.css.pagingWarpNode,events:{selectstart:function(t){t.preventDefault()}}}).inject(this.container),this.pagingNode=new Element("div").inject(this.node),this.loadWidget()},loadWidget:function(t){var e=this.json.visiblePages?this.json.visiblePages.toInt():9;this.pagingWidget=new o2.widget.Paging(this.pagingNode,{style:this.json.style||"default",countPerPage:20,visiblePages:e,currentPage:1,itemSize:20*e*3,hasNextPage:"boolean"!==typeOf(this.json.hasPreNextPage)||this.json.hasPreNextPage,hasPrevPage:"boolean"!==typeOf(this.json.hasPreNextPage)||this.json.hasPreNextPage,hasTruningBar:"boolean"!==typeOf(this.json.hasTruningBar)||this.json.hasTruningBar,hasBatchTuring:"boolean"!==typeOf(this.json.hasBatchTuring)||this.json.hasBatchTuring,hasFirstPage:"boolean"!==typeOf(this.json.hasFirstLastPage)||this.json.hasFirstLastPage,hasLastPage:"boolean"!==typeOf(this.json.hasFirstLastPage)||this.json.hasFirstLastPage,hasJumper:"boolean"!==typeOf(this.json.hasPageJumper)||this.json.hasPageJumper,hiddenWithDisable:!1,text:{prePage:this.json.prePageText,nextPage:this.json.nextPageText,firstPage:this.json.firstPageText,lastPage:this.json.lastPageText},onJumpingPage:function(t,e){}.bind(this),onPostLoad:function(){this.view.setContentHeight()}.bind(this)},t?{}:this.json.pagingStyles||{}),t?this.json.pagingStyles?(this.pagingWidget.css=Object.merge(Object.clone(this.json.pagingStyles),this.pagingWidget.css,this.json.forceStyles||{}),this.json.pagingStyles=Object.clone(this.pagingWidget.css)):this.json.pagingStyles=Object.merge(Object.clone(this.pagingWidget.css),this.json.forceStyles||{}):this.json.pagingStyles||(this.json.pagingStyles=Object.clone(this.pagingWidget.css)),this.pagingWidget.load()},_resetPaging:function(){this.pagingNode.empty(),this.loadWidget(!0)},_refreshPaging:function(){this.pagingNode.empty(),this.loadWidget()},_setEditStyle_custom:function(t,e,s){["hasTruningBar","visiblePages","hasBatchTuring","hasFirstLastPage","hasPreNextPage","hasPageJumper","firstPageText","lastPageText","prePageText","nextPageText","pagingStyles"].contains(t)?this._refreshPaging():"buttonStyle"===t&&("rect"===this.json.buttonStyle?this.json.style=this.view.templateStyles.paging.style_rect:this.json.style=this.view.templateStyles.paging.style_round,this._resetPaging())}});