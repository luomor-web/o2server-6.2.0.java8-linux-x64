MWF.xDesktop.requireApp("process.ProcessManager","Explorer",null,!1),MWF.xApplication.portal.PortalManager.MenuExplorer=new Class({Extends:MWF.xApplication.process.ProcessManager.Explorer,Implements:[Options,Events],options:{style:"default",tooltip:{create:MWF.xApplication.portal.PortalManager.LP.menu.create,search:MWF.xApplication.portal.PortalManager.LP.menu.search,searchText:MWF.xApplication.portal.PortalManager.LP.menu.searchText,noElement:MWF.xApplication.portal.PortalManager.LP.menu.noProcessNoticeText}},_createElement:function(e){var t=new Element("div",{styles:this.css.createTemplateMaskNode}).inject(this.app.content),n=new Element("div",{styles:this.css.createTemplateAreaNode}).inject(this.app.content);n.fade("in");var s=new Element("div",{styles:this.css.createTemplateScrollNode}).inject(n),o=new Element("div",{styles:this.css.createTemplateContentNode}).inject(s);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(s,{indent:!1})}.bind(this));var i=this;MWF.getJSON("../x_component_portal_PageDesigner/$Page/template/templates.json",function(e){e.each(function(e){var s=new Element("div",{styles:this.css.templateNode}).inject(o),a=new Element("div",{styles:this.css.templateIconNode}).inject(s);new Element("div",{styles:this.css.templateTitleNode,text:e.title}).inject(s);s.store("template",e.name),new Element("img",{styles:this.css.templateIconImgNode}).inject(a).set("src","../x_component_process_ProcessDesigner/$Process/template/"+e.icon),s.addEvents({mouseover:function(){this.setStyles(i.css.templateNode_over)},mouseout:function(){this.setStyles(i.css.templateNode)},mousedown:function(){this.setStyles(i.css.templateNode_down)},mouseup:function(){this.setStyles(i.css.templateNode_over)},click:function(e){createPage(e,this.retrieve("template")),n.destroy(),t.destroy()}})}.bind(this))}.bind(this)),t.addEvent("click",(function(){n.destroy(),t.destroy()}));var a=this.app.content.getSize(),r=(a.y-262)/2,l=(a.x-828)/2;r<0&&(r=0),l<0&&(l=0),n.setStyles({top:r+"px",left:l+"px"})},_loadItemDataList:function(e){this.app.restActions.listMenu(this.app.options.application.id,e)},_getItemObject:function(e){return new MWF.xApplication.portal.PortalManager.MenuExplorer.Menu(this,e)},deleteItems:function(){for(this.hideDeleteAction();this.deleteMarkItems.length;){var e=this.deleteMarkItems.shift();this.deleteMarkItems.length?e.deleteMenu():e.deleteMenu(function(){}.bind(this))}}}),MWF.xApplication.portal.PortalManager.MenuExplorer.Menu=new Class({Extends:MWF.xApplication.process.ProcessManager.Explorer.Item,_open:function(e){var t=this,n={onQueryLoad:function(){this.actions=t.explorer.actions,this.category=t,this.options.id=t.data.id,this.application=t.explorer.app.options.application}};this.explorer.app.desktop.openApplication(e,"portal.MenuDesigner",n)},_getIcon:function(){return"process_icon_"+(49*Math.random()).toInt()+".png"},_getLnkPar:function(){return{icon:this.explorer.path+this.explorer.options.style+"/processIcon/lnk.png",title:this.data.name,par:'portal.MenuDesigner#{"id": "'+this.data.id+'"}'}},deleteMenu:function(e){this.explorer.actions.deleteMenu(this.data.id,function(){this.node.destroy(),e&&e()}.bind(this))}});