print("批量导入组织");var File=Java.type("java.io.File"),Config={interfaceUrl:"http://ahpp.zoneland.net:20030/x_program_center/jaxrs/invoke/unitAsync/execute",localPath:File.separator+"data"+File.separator+"ImportUnitFromExcel"+File.separator,recordLocalPath:File.separator+"data"+File.separator+"ImportUnitFromExcelRecord"+File.separator},Utils={parseResp:function(e){return e&&null!==e?JSON.parse(e.toString()):{type:"error",message:"服务响应是null，需要管理员查看后台日志"}},getFailText:function(e){var t;return t=e.message?e.message+(e.prompt?"("+e.prompt+")":""):e.prompt?e.prompt:"未知异常",print(t),t}};function getFileList(){var e=Config.localPath,t=new File(e),r=new(Java.type("java.util.ArrayList"));if(t.exists()){for(var a=t.listFiles(),i=0;i<a.length;i++)if(a[i].isFile()){print(a[i].getName());var n=a[i].getName().split(".");n[n.length-1].equals("xls")&&r.add(a[i])}}else print("目录不存在:"+e);return r}function importExcel(e){var t=Java.type("java.io.FileInputStream"),r="",a=null;try{a=new t(e);var i=null;try{var n=e.getName();if(n.endsWith(".xls")){i=new(Java.type("org.apache.poi.hssf.usermodel.HSSFWorkbook"))(a)}else{if(!n.endsWith(".xlsx"))return r="不支持的文件类型！",print(r),!1;i=new(Java.type("org.apache.poi.hssf.usermodel.XSSFWorkbook"))(a)}}catch(e){return r="解析Excel文件出错！",print(r),e.printStackTrace(),!1}finally{a.close()}if(0===r.length){null!==i&&i.getNumberOfSheets();var s=i.getSheetAt(0),l=s.getPhysicalNumberOfRows();if(l>1)for(var o=1;o<l;o++){print("正在执行导入第"+o+"行");var p=s.getRow(o),c=p.getLastCellNum();if(c>0&&""!==(r=importRow(p,c)))return!1}else r="EXCEL没有数据，请确定。"}return r.length()>0?(print("错误消息："+r),!1):(print(e.getName()+"导入成功！"),!0)}catch(e){return e.printStackTrace(),!1}}var Cell=Java.type("org.apache.poi.ss.usermodel.Cell");function importRow(e,t){var r={action:"add",attributeList:[]};print("cells = "+t);for(var a=0;a<t;a++){var i="",n=e.getCell(a);null!==n&&(n.setCellType(Cell.CELL_TYPE_STRING),i=n.getStringCellValue().trim());var s=!0;switch(a){case 1:"00"!=i.substr(0,2)&&(i="00"+i),r.unique=i;break;case 4:r.typeList=[i.toLowerCase()];break;case 5:r.name=i;break;case 6:var l={name:"displayName",value:i};r.attributeList.push(l);break;case 7:r.description=i;break;case 9:r.orderNumber=i;break;case 10:"0"!==i&&("00"!=i.substr(0,2)&&(i="00"+i),r.superior=i);break;case 12:"active"!==i.toLowerCase()&&(s=!1);break;case 18:l={name:"postalcode",value:i};r.attributeList.push(l)}if(!s)return""}return r.unique&&"0"!=r.unique?sendRequest(r):""}function sendRequest(e){var t="";try{"string"==typeof e&&(e=JSON.parse(bodyStr)),e.saveFlag="no";var r=com.x.base.core.project.connection.CipherConnectionAction.post(!1,Config.interfaceUrl,JSON.stringify(e)),a=Utils.parseResp(r);a.type&&"success"==a.type&&a.data&&a.data.value&&a.data.value.result&&"success"==a.data.value.result||(t=Utils.getFailText(a))}catch(e){t=e.printStackTrace()}finally{return print("resend person errorText="+t),t}}function init(){for(var e=getFileList(),t=0;t<e.size();t++)try{var r=e.get(t);if(importExcel(r)){print("正在修改文件目录："+r.getName());var a=Config.recordLocalPath+r.getName();r.renameTo(new File(a))?print("文件移动到了:"+a):print(r.getName()+" is failed to move!")}}catch(e){e.printStackTrace()}}init();