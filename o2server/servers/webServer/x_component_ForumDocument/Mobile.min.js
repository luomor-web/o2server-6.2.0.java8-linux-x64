MWF.xApplication.Forum=MWF.xApplication.Forum||{},MWF.xApplication.ForumDocument=MWF.xApplication.ForumDocument||{},MWF.xDesktop.requireApp("Forum","Common",null,!1),MWF.xDesktop.requireApp("Template","Explorer",null,!1),MWF.xApplication.ForumDocument.Mobile=new Class({Implements:[Options,Events],options:{id:"",sectionId:"",viewPageNum:1,replyIndex:null,isNew:!1,isEdited:!1},initialize:function(e,t,i,n,s,o){this.setOptions(o),this.app=t,this.node=$(e),this.actions=i,this.lp=n,this.css=s,this.path="../x_component_ForumDocument/$Mobile/default/"},load:function(){this.actions.login({},function(e){this.actions.listSubjectPermission(this.options.id,function(e){this.permission=e.data,this.actions.getSubjectView(this.options.id,function(e){this.data=e.data.currentSubject,this.options.sectionId=this.data.sectionId,this.createMiddleNode()}.bind(this))}.bind(this))}.bind(this))},createMiddleNode:function(){this.middleNode=new Element("div.middleNode",{styles:this.css.middleNode}).inject(this.node),this.subjectConainer=new Element("div.subjectConainer",{styles:this.css.subjectConainer}).inject(this.middleNode),this.data.typeCategory!=this.lp.question&&"问题"!=this.data.typeCategory||(this.satisfiedReplyViewConainer=new Element("div.satisfiedReplyViewConainer",{styles:this.css.replyViewConainer}).inject(this.middleNode)),this.replyViewConainer=new Element("div.replyViewConainer",{styles:this.css.replyViewConainer}).inject(this.middleNode),this.createSubject(),this.data.typeCategory!=this.lp.question&&"问题"!=this.data.typeCategory||this.data.acceptReplyId&&this.createSatisfiedReplyView(),this.createReplyView()},createSubject:function(){this.subjectView=new MWF.xApplication.ForumDocument.Mobile.SubjectView(this.subjectConainer,this.app,this,{templateUrl:this.path+"listItemSubject.json",scrollEnable:!1}),this.subjectView.data=this.data,this.subjectView.load()},showReply:function(e){this.replyView.showReply(e)},createReplyView:function(){var e=new Element("div.itemReplyTitleArea",{styles:this.css.itemReplyTitleArea}).inject(this.replyViewConainer);new Element("div.itemReplyTitle",{styles:this.css.itemReplyTitle,text:this.lp.allReply+"("+this.data.replyTotal+")"}).inject(e),this.replyView=new MWF.xApplication.ForumDocument.Mobile.ReplyView(this.replyViewConainer,this.app,this,{templateUrl:this.path+"listItemReply.json",scrollEnable:!1,pagingEnable:!0,documentKeyWord:"orderNumber",pagingPar:{currentPage:this.options.viewPageNum||1,countPerPage:10,hasPrevPage:!0,hasTruningBar:!1,onPostLoad:function(){1==this.replyView.getCurrentPageNum()?this.replyView.paging&&this.replyView.paging.nextPageNode&&this.replyView.paging.nextPageNode.setStyle("width","99%"):this.replyView.getCurrentPageNum()==this.replyView.getPageSize()?this.replyView.paging&&this.replyView.paging.prevPageNode&&this.replyView.paging.prevPageNode.setStyle("width","99%"):(this.replyView.paging&&this.replyView.paging.prevPageNode&&this.replyView.paging.prevPageNode.setStyle("width","49%"),this.replyView.paging&&this.replyView.paging.nextPageNode&&this.replyView.paging.nextPageNode.setStyle("width","49%"))}.bind(this)}}),this.replyView.data=this.data,this.replyView.filterData={subjectId:this.data.id},this.replyView.load()},createSatisfiedReplyView:function(){var e=new Element("div.itemReplyTitleArea",{styles:this.css.itemReplyTitleArea}).inject(this.satisfiedReplyViewConainer);new Element("div.itemReplyTitle",{styles:this.css.itemReplyTitle_accepted,text:this.lp.satisfiedAnswer}).inject(e),this.satisfiedReplyView=new MWF.xApplication.ForumDocument.Mobile.SatisfiedReplyView(this.satisfiedReplyViewConainer,this,this,{templateUrl:this.path+"listItemSatisfied.json",scrollEnable:!1}),this.satisfiedReplyView.data=this.data,this.satisfiedReplyView.load()},getUserIcon:function(e){var t=MWF.Actions.get("x_organization_assemble_personal").getIcon(e);return t||"../x_component_ForumDocument/$Main/default/icon/noavatar_big.gif"}}),MWF.xApplication.ForumDocument.Mobile.SubjectView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(e,t){return e.index=t,new MWF.xApplication.ForumDocument.Mobile.SubjectDocument(this.viewNode,e,this.explorer,this,null,e.index)},getUserData:function(e,t){MWF.Actions.get("x_organization_assemble_control").getPerson(function(e){t&&t(e)}.bind(this),null,e,!0)},_getCurrentPageData:function(e,t){var i={type:"success",count:1,size:1,data:[this.data]};e&&e(i)},_removeDocument:function(e,t){this.actions.deleteSection(e.id,function(e){this.reload(),this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_queryCreateViewNode:function(){},_postCreateViewNode:function(e){},_queryCreateViewHead:function(){},_postCreateViewHead:function(e){}}),MWF.xApplication.ForumDocument.Mobile.SubjectDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,mouseoverSubject:function(e,t){},mouseoutSubject:function(e,t){},_queryCreateDocumentNode:function(e){},_postCreateDocumentNode:function(e,t){if(e.getElements("[item='content']")[0].getElements("img").each(function(e){e.setStyles({height:"auto","max-width":"100%"})}.bind(this)),this.data.typeCategory==this.lp.vote||"投票"==this.data.typeCategory){var i=e.getElement("[item='vote']");MWF.xDesktop.requireApp("ForumDocument","Vote",function(){this.vote=new MWF.xApplication.ForumDocument.Vote(i,this.app,{isNew:!1,isEdited:!1},this.data),this.vote.load()}.bind(this),!0)}},createReply:function(e,t){var i=new MWF.xApplication.ForumDocument.ReplyForm(this,{},{toMain:!0,onPostOk:function(e){this.app.postCreateReply(e)}.bind(this)});i.mainData=this.data,i.create()}}),MWF.xApplication.ForumDocument.Mobile.ReplyView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,showReply:function(e){this.actions.getReply(e,function(e){new MWF.xApplication.ForumDocument.Mobile.ReplyDocument(this.viewNode,e.data,this.explorer,this,null,null)}.bind(this))},_createDocument:function(e,t){return e.index=t,new MWF.xApplication.ForumDocument.Mobile.ReplyDocument(this.viewNode,e,this.explorer,this,null,e.index)},_getCurrentPageData:function(e,t,i){this.clearBody(),t||(t=10),i||(i=1),1==i?(this.explorer.subjectConainer.setStyle("display","block"),this.explorer.satisfiedReplyViewConainer&&this.explorer.satisfiedReplyViewConainer.setStyle("display","block")):(this.explorer.subjectConainer.setStyle("display","none"),this.explorer.satisfiedReplyViewConainer&&this.explorer.satisfiedReplyViewConainer.setStyle("display","none"));var n=this.filterData||{};this.actions.listReplyFilterPage(i,t,n,function(t){t.data||(t.data=[]),t.count||(t.count=0),e&&e(t)}.bind(this))},_removeDocument:function(e,t){this.actions.deleteReply(e.id,function(){this.reload(),this.app.notice(this.lp.deleteReplySuccess,"ok")}.bind(this))},_create:function(){},_queryCreateViewNode:function(){},_postCreateViewNode:function(e){},_queryCreateViewHead:function(){},_postCreateViewHead:function(e){}}),MWF.xApplication.ForumDocument.Mobile.ReplyDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,mouseoverSubject:function(e,t){},mouseoutSubject:function(e,t){},getUserData:function(e,t){MWF.Actions.get("x_organization_assemble_control").getPerson(function(e){t&&t(e)}.bind(this),null,e,!0)},_queryCreateDocumentNode:function(e){},_postCreateDocumentNode:function(e,t){if(e.getElements("[item='content']")[0].getElements("img").each(function(e){e.setStyles({height:"auto","max-width":"100%"})}.bind(this)),t.parentId&&""!=t.parentId){var i=e.getElements("[item='quoteContent']")[0];this.actions.getReply(t.parentId,function(e){var t=this.parentData=e.data,n=new Element("div",{styles:this.css.itemQuote}).inject(i),s=n.set("html",t.content).get("text");n.empty(),t.contentText=s;var o=new Element("div",{styles:this.css.quoteArea}).inject(n);new Element("div",{styles:this.css.quoteInfor,text:this.lp.replyTo+" "+t.orderNumber+this.lp.floor+" "+t.creatorName.split("@")[0]+" "+t.createTime}).inject(o);new Element("div",{styles:this.css.quoteText,text:s.length>100?s.substr(0,100)+"...":s}).inject(o)}.bind(this),function(e){new Element("div",{styles:this.css.replyBeinngDelete,text:this.lp.quoteReplyBeingDeleted}).inject(i)}.bind(this))}},createReply:function(e,t){var i=navigator.userAgent.toLowerCase();/iphone|ipad|ipod/.test(i)?window.webkit.messageHandlers.ReplyAction.postMessage({body:this.data.id}):/android/.test(i)&&window.o2bbs.reply(this.data.id)}}),MWF.xApplication.ForumDocument.Mobile.SatisfiedReplyView=new Class({Extends:MWF.xApplication.ForumDocument.Mobile.ReplyView,_createDocument:function(e,t){return e.index=t,new MWF.xApplication.ForumDocument.Mobile.SatisfiedReplyDocument(this.viewNode,e,this.explorer,this,null,e.index)},_getCurrentPageData:function(e,t,i){this.clearBody(),t||(t=1),i||(i=1);this.filterData;this.actions.getAcceptedReply(this.data.acceptReplyId,function(t){t.data?"object"==typeOf(t.data)&&(t.data=[t.data],t.count=1):t.data=[],t.count||(t.count=0),e&&e(t)}.bind(this))}}),MWF.xApplication.ForumDocument.Mobile.SatisfiedReplyDocument=new Class({Extends:MWF.xApplication.ForumDocument.Mobile.ReplyDocument});