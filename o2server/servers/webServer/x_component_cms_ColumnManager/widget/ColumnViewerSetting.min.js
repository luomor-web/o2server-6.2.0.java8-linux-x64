MWF.xApplication.cms.ColumnManager=MWF.xApplication.cms.ColumnManager||{},MWF.require("MWF.widget.O2Identity",null,!1),MWF.xApplication.cms.ColumnManager.ColumnViewerSetting=new Class({Implements:[Options],options:{objectId:""},initialize:function(t,i,e,s){this.app=t,this.node=$(e),this.lp=i,this.setOptions(s)},load:function(){this.createNode(),this.listData(function(){this.loadOrg()}.bind(this))},createNode:function(){this.titleNode=new Element("div.availableTitleNode",{styles:this.app.css.availableTitleNode,text:this.lp.title}).inject(this.node),this.contentNode=new Element("div",{styles:{overflow:"hidden"}}).inject(this.node),this.itemsContentNode=new Element("div.availableItemsContentNode",{styles:this.app.css.availableItemsContentNode}).inject(this.contentNode),this.actionAreaNode=new Element("div",{styles:{overflow:"hidden"}}).inject(this.node),new Element("div.selectButtonStyle",{styles:this.app.css.selectButtonStyle,text:this.lp.set}).inject(this.actionAreaNode).addEvent("click",function(){this.change()}.bind(this))},loadOrg:function(){this.itemsContentNode.empty(),this.loadOrgWidget(this.data.personList),this.loadOrgWidget(this.data.unitList),this.loadOrgWidget(this.data.groupList)},loadOrgWidget:function(t){this.OrgWidgetList=this.OrgWidgetList||[];var i={style:"xform",canRemove:!1},e=this.itemsContentNode;(t||[]).each(function(t){var s=t.substr(t.length-1,1),n={name:t};switch(s.toLowerCase()){case"i":var a=new MWF.widget.O2Identity(n,e,i);break;case"p":a=new MWF.widget.O2Person(n,e,i);break;case"u":a=new MWF.widget.O2Unit(n,e,i);break;case"g":a=new MWF.widget.O2Group(n,e,i);break;default:a=new MWF.widget.O2Other(n,e,i)}this.OrgWidgetList.push(a)}.bind(this))},change:function(){MWF.xDesktop.requireApp("Selector","package",null,!1);var t={type:"",types:["person","unit","group"],title:this.lp.set,count:0,values:(this.data.personList||[]).combine(this.data.unitList||[]).combine(this.data.groupList||[]),expand:!1,onComplete:function(t){var i={personList:[],unitList:[],groupList:[]};t.each((function(t){var e=t.data.distinguishedName;switch(e.substr(e.length-1,1).toLowerCase()){case"p":i.personList.push(e);break;case"u":i.unitList.push(e);break;case"g":i.groupList.push(e)}})),this.saveData(i,function(){this.listData(function(){this.loadOrg()}.bind(this))}.bind(this))}.bind(this)};new MWF.O2Selector(this.app.content,t)},listData:function(t){this.app.restActions.listAppInfoViewers(this.options.objectId,function(i){this.data=i.data,t&&t(i)}.bind(this),null,!1)},saveData:function(t,i){this.app.restActions.saveAppInfoViewer(this.options.objectId,t,function(t){this.app.restActions.getColumn(this.options.objectId,function(e){this.dataParent.data=e.data,this.app.options.column=e.data,this.app.options.application=e.data,i&&i(t)}.bind(this))}.bind(this),null,!1)}});