MWF.xDesktop.requireApp("cms.ColumnManager","Explorer",null,!1),MWF.xDesktop.requireApp("cms.ColumnManager","FormExplorer",null,!1),MWF.xDesktop.requireApp("cms.ColumnManager","ViewExplorer",null,!1),MWF.xApplication.cms.ColumnManager.CategoryExplorer=new Class({Extends:MWF.xApplication.cms.ColumnManager.Explorer,Implements:[Options,Events],options:{style:"default",title:"",currentCategoryId:"",tooltip:{create:MWF.CMSCM.LP.category.create,search:MWF.CMSCM.LP.category.search,searchText:MWF.CMSCM.LP.category.searchText,noElement:MWF.CMSCM.LP.category.noCategoryNoticeText}},initialize:function(t,e,i,s){this.setOptions(s),this.setTooltip(),this.path="../x_component_cms_ColumnManager/$CategoryExplorer/",this.cssPath="../x_component_cms_ColumnManager/$CategoryExplorer/"+this.options.style+"/css.wcss",this._loadCss(),this.actions=i,this.node=$(t),this.naviNode=e,this.initData()},load:function(){this.loadContentNode()},reload:function(){this.node&&(this.initData(),this.node.empty(),this.naviNode.empty(),this.load())},refresh:function(){this.setContentSize(),this.viewExplorer.reload(),this.formExplorer.reload(),this.categoryProperty.reload()},loadContentNode:function(){this.elementContentNode=new Element("div.elementContentNode",{styles:this.css.elementContentNode}).inject(this.node),this.elementContentListNode=new Element("div.elementContentListNode",{styles:this.css.elementContentListNode}).inject(this.elementContentNode),this.naviContainerNode=this.naviNode,this.loadContentNodes(),this.setContentSize(),this.app.addEvent("resize",function(){this.setContentSize()}.bind(this)),this.loadForm(),this.loadView(),this.loadProperty(),this.loadCategoryList()},loadContentNodes:function(){this.rightContent=new Element("div.rightContent",{styles:this.css.rightContent}).inject(this.elementContentListNode),this.rightTopContent=new Element("div.rightTopContent",{styles:this.css.rightTopContent}).inject(this.rightContent),this.rightHorizontalResizeNode=new Element("div.rightHorizontalResizeNode",{styles:this.css.rightHorizontalResizeNode}).inject(this.rightContent),this.rightBottomContent=new Element("div.rightBottomContent",{styles:this.css.rightBottomContent}).inject(this.rightContent),this.createFormNode(),this.createViewNode(),this.formPercent=.5,this.topPercent=.5,this.loadRightHorizontalResize()},setNodeScroll:function(){MWF.require("MWF.widget.DragScroll",function(){new MWF.widget.DragScroll(this.naviArea)}.bind(this)),MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.naviArea,{indent:!1})}.bind(this))},loadCategoryList:function(t){this.categoryList=new MWF.xApplication.cms.ColumnManager.CategoryExplorer.CategoryList(this,this.naviNode,{currentCategoryId:this.options.currentCategoryId,columnId:this.app.options.column.id,onPostLoad:function(){this.fireEvent("postLoadCategoryList",this.categoryList)}.bind(this)})},_createElement:function(){this.categoryList.newCategory()},loadProperty:function(){this.categoryProperty=new MWF.xApplication.cms.ColumnManager.CategoryExplorer.CategoryProperty(this.app,this.rightBottomContent),this.categoryProperty.load()},createFormNode:function(){this.formAreaNode=new Element("div.formAreaNode",{styles:this.css.formAreaNode}).inject(this.rightTopContent),this.formTitleNode=new Element("div.formTitleNode",{styles:this.css.formTitleNode}).inject(this.formAreaNode),this.formCreateNode=new Element("div.formCreateNode",{styles:this.css.formCreateNode,title:MWF.xApplication.cms.ColumnManager.LP.form.create}).inject(this.formTitleNode),this.formCreateNode.addEvent("click",function(t){this.formExplorer._createElement(t)}.bind(this)),this.formCreateNode.addEvent("mouseover",function(t){this.formCreateNode.setStyles(this.css.formCreateNode_over)}.bind(this)),this.formCreateNode.addEvent("mouseout",function(t){this.formCreateNode.setStyles(this.css.formCreateNode)}.bind(this)),this.formCreateNode.setStyle("display","none"),this.formTitleTextNode=new Element("div.formTitleTextNode",{styles:this.css.formTitleTextNode,text:MWF.xApplication.cms.ColumnManager.LP.form.selectCategoryForm}).inject(this.formTitleNode),this.formNode=new Element("div.formNode",{styles:this.css.formNode}).inject(this.formAreaNode)},loadForm:function(){this.formExplorer=new MWF.xApplication.cms.ColumnManager.CategoryExplorer.FormExplorer(this.formNode,this.app.restActions,{style:"full"}),this.formExplorer.app=this.app,this.formExplorer.explorer=this,this.formExplorer.load()},createViewNode:function(){this.viewAreaNode=new Element("div.viewAreaNode",{styles:this.css.viewAreaNode}).inject(this.rightTopContent),this.viewTitleNode=new Element("div.viewTitleNode",{styles:this.css.viewTitleNode}).inject(this.viewAreaNode),this.viewAddNode=new Element("div.viewAddNode",{styles:this.css.viewAddNode,text:MWF.xApplication.cms.ColumnManager.LP.selectDataView,title:MWF.xApplication.cms.ColumnManager.LP.selectDataViewTitle}).inject(this.viewTitleNode),this.viewAddNode.addEvent("click",function(t){this.viewExplorer._selectView(t)}.bind(this)),this.viewAddNode.addEvent("mouseover",function(t){this.viewAddNode.setStyles(this.css.viewAddNode_over)}.bind(this)),this.viewAddNode.addEvent("mouseout",function(t){this.viewAddNode.setStyles(this.css.viewAddNode)}.bind(this)),this.viewAddNode.setStyle("display","none"),this.listAddNode=new Element("div.listAddNode",{styles:this.css.viewAddNode,text:MWF.xApplication.cms.ColumnManager.LP.selectList,title:MWF.xApplication.cms.ColumnManager.LP.selectListTitle}).inject(this.viewTitleNode),this.listAddNode.addEvent("click",function(t){this.viewExplorer._selectList(t)}.bind(this)),this.listAddNode.addEvent("mouseover",function(t){this.listAddNode.setStyles(this.css.viewAddNode_over)}.bind(this)),this.listAddNode.addEvent("mouseout",function(t){this.listAddNode.setStyles(this.css.viewAddNode)}.bind(this)),this.listAddNode.setStyle("display","none"),this.viewTitleTextNode=new Element("div.viewTitleTextNode",{styles:this.css.viewTitleTextNode,text:MWF.xApplication.cms.ColumnManager.LP.categoryDisplay}).inject(this.viewTitleNode),this.viewNode=new Element("div.viewNode",{styles:this.css.viewNode}).inject(this.viewAreaNode)},loadView:function(){this.viewExplorer=new MWF.xApplication.cms.ColumnManager.CategoryExplorer.ViewExplorer(this.viewNode,this.app.restActions,{style:"full"}),this.viewExplorer.app=this.app,this.viewExplorer.explorer=this,this.viewExplorer.load()},loadRightVerticalResize:function(){this.rightVerticalResize=new Drag(this.rightVerticalResizeNode,{snap:1,onStart:function(t,e){var i="firefox"==Browser.name?e.event.clientX:e.event.x,s="firefox"==Browser.name?e.event.clientY:e.event.y;t.store("position",{x:i,y:s});var o=this.formNode.getSize();t.store("initialHeight",o.y)}.bind(this),onDrag:function(t,e){var i=this.rightContent.getSize(),s="firefox"==Browser.name?e.event.clientY:e.event.y,o=t.retrieve("position"),n=s.toFloat()-o.y.toFloat(),a=t.retrieve("initialHeight").toFloat()+n;a<40&&(a=40),a>i.y-40&&(a=i.y-40),this.topPercent=a/i.y,this.setRightVerticalResize()}.bind(this)})},setRightVerticalResize:function(){var t=this.node.getSize().x;this.elementContentListNode.setStyles({width:t+"px"}),this.rightContent.setStyle("width",t+"px");var e=t-(this.rightVerticalResizeNode?this.rightVerticalResizeNode.getSize():{x:0,y:0}).x-2,i=e*this.formPercent,s=e-e*this.formPercent;this.formAreaNode.setStyle("width",i+"px"),this.formNode.setStyle("width",i+"px"),this.viewAreaNode.setStyle("width",s+"px"),this.viewNode.setStyle("width",s+"px")},loadRightHorizontalResize:function(){this.rightHorizontalResize=new Drag(this.rightHorizontalResizeNode,{snap:1,onStart:function(t,e){var i="firefox"==Browser.name?e.event.clientX:e.event.x,s="firefox"==Browser.name?e.event.clientY:e.event.y;t.store("position",{x:i,y:s});var o=this.rightTopContent.getSize();t.store("initialHeight",o.y)}.bind(this),onDrag:function(t,e){var i=this.rightContent.getSize(),s="firefox"==Browser.name?e.event.clientY:e.event.y,o=t.retrieve("position"),n=s.toFloat()-o.y.toFloat(),a=t.retrieve("initialHeight").toFloat()+n;a<120&&(a=120),a>i.y-120&&(a=i.y-120),this.topPercent=a/i.y,this.setRightHorizontalResize(),this.formExplorer&&this.formExplorer.setContentSize(),this.viewExplorer&&this.viewExplorer.setContentSize(),this.categoryProperty&&this.categoryProperty.setContentHeight()}.bind(this)})},setRightHorizontalResize:function(){var t=this.node.getSize(),e=(this.elementContentNode.getStyle("padding-top").toFloat(),this.elementContentNode.getStyle("padding-bottom").toFloat(),this.naviContainerNode.getSize(),t.y);this.elementContentListNode.setStyle("height",e+"px"),this.rightContent.setStyle("height",e+"px");var i=e-(this.rightHorizontalResizeNode?this.rightHorizontalResizeNode.getSize():{x:0,y:0}).y,s=this.topPercent*i,o=i-s;this.rightTopContent.setStyle("height",s+"px"),this.rightBottomContent.setStyle("height",o+"px"),this.formNode.setStyle("height",s-50+"px"),this.viewNode.setStyle("height",s-50+"px")},setContentSize:function(){this.setRightHorizontalResize(),this.setRightVerticalResize()},afterClickCategory:function(t){this.fireEvent("postClickSub",[t])}}),MWF.xApplication.cms.ColumnManager.CategoryExplorer.CategoryList=new Class({Implements:[Options,Events],options:{currentCategoryId:"",columnId:""},initialize:function(t,e,i){this.setOptions(i),this.explorer=t,this.app=t.app,this.node=$(e),this.css=t.css,this.categoryArr=[],this.categoryObj={},this.currentCategory=null,this.currentView=null,this.load()},load:function(){this.app.restActions.listCategory(this.options.columnId,function(t){t.data.each(function(t){this.loadCategoryByData(t)}.bind(this)),this.fireEvent("postLoad")}.bind(this),function(){this.fireEvent("postLoad")}.bind(this),!0)},getCurrentNode:function(){return this.currentNode},getCategoryNodes:function(){var t=[];return this.categoryArr.each(function(e){t.push(e.node)}.bind(this)),t},cancelCurrentNode:function(){this.currentNode&&("category"==this.currentNodeType?(this.currentNode.setStyles(this.css.categoryNaviNode),this.currentCategory._hideActions()):this.currentNode.setStyles(this.css.viewNaviNode),this.currentNode=null)},setCurrentCategoryById:function(t){t&&this.categoryObj[t]&&this.setCurrentCategory(this.categoryObj[t])},setCurrentCategory:function(t){this.cancelCurrentNode(),this.currentCategory=t,this.currentNodeType="category",this.currentNode=t.node,t.node.setStyles(this.css.categoryNaviNode_selected),this.currentTimeout=setTimeout(function(){t._showActions(),this.currentTimeout=null,this.explorer.afterClickCategory(t)}.bind(this),100),t.options.isNew?this.explorer.formCreateNode.setStyle("display","none"):this.explorer.formCreateNode.setStyle("display",""),this.explorer.formExplorer.refreshByCategory(t),t.options.isNew?(this.explorer.viewAddNode.setStyle("display","none"),this.explorer.listAddNode.setStyle("display","none")):(this.explorer.viewAddNode.setStyle("display",""),this.explorer.listAddNode.setStyle("display","")),this.explorer.viewExplorer.refreshByCategory(t),this.explorer.categoryProperty.reload(t)},setCurrentView:function(t){this.cancelCurrentNode(),this.currentView=t,this.currentNodeType="view",this.currentNode=t.node,t.node.setStyles(this.css.viewNaviNode_selected)},destroyCategory:function(t){if(t.options.isNew);else{var e=t.data.id;delete this.categoryObj[e];var i=this.categoryArr.indexOf(t);i>-1&&this.categoryArr.splice(i,1)}t.destroy()},loadCategoryByData:function(t,e,i,s){var o=new MWF.xApplication.cms.ColumnManager.CategoryExplorer.Category(this,this.node,t,{relativeNode:e,relativePosition:i});this.categoryObj[t.id]=o,this.categoryArr.push(o),s&&s(o),this.options.currentCategoryId&&this.options.currentCategoryId==t.id&&(this.setCurrentCategory(o),this.options.currentCategoryId="")},loadCategoryById:function(t,e,i,s){this.app.restActions.getCategory(t,function(t){var o=t.data,n=new MWF.xApplication.cms.ColumnManager.CategoryExplorer.Category(this,this.node,o,{relativeNode:e,relativePosition:i});this.categoryObj[o.id]=n,this.categoryArr.push(n),s&&s(n),this.options.currentCategoryId&&this.options.currentCategoryId==o.id&&(this.setCurrentCategory(n),this.options.currentCategoryId="")}.bind(this))},adjustSeq:function(t){var e=this.node.getElements(".categoryNaviNode"),i=this.app.restActions;e.each((function(e,s){var o=e.retrieve("category");if(!o.options.isNew){var n=o.data,a="000"+s;n.categorySeq=a.substr(a.length-3,3),i.saveCategory(n,null,null,!1!==t)}}))},newCategory:function(t,e){var i=new MWF.xApplication.cms.ColumnManager.CategoryExplorer.Category(this,this.node,{},{isNew:!0,relativeNode:t,relativePosition:e});this.setCurrentCategory(i)}}),MWF.xApplication.cms.ColumnManager.CategoryExplorer.Category=new Class({Implements:[Options,Events],options:{style:"default",isNew:!1,relativeNode:null,relativePosition:"bottom",actions_edit:[{name:"saveCategory",icon:"save.png",icon_over:"save_over.png",unselectedIcon:"save_over.png",unselectedIcon_over:"save_unselected_over.png",event:"click",action:"saveCategory",title:MWF.xApplication.cms.ColumnManager.LP.category.saveCategory},{name:"cancel",icon:"cancel.png",icon_over:"cancel_over.png",unselectedIcon:"cancel_over.png",unselectedIcon_over:"cancel_unselected_over.png",event:"click",action:"cancel",title:MWF.xApplication.cms.ColumnManager.LP.category.cancelEdit}],actions_read:[{name:"editCategory",icon:"edit.png",icon_over:"edit_over.png",event:"click",action:"editCategory",title:MWF.xApplication.cms.ColumnManager.LP.category.editCategory},{name:"insertCateogryBefore",icon:"insertBefore.png",icon_over:"insertBefore_gray.png",event:"click",action:"insertCateogryBefore",title:MWF.xApplication.cms.ColumnManager.LP.category.insertCateogryBefore},{name:"insertCateogryAfter",icon:"insertAfter.png",icon_over:"insertAfter_over.png",event:"click",action:"insertCateogryAfter",title:MWF.xApplication.cms.ColumnManager.LP.category.insertCateogryAfter},{name:"deleteCategory",icon:"trash.png",icon_over:"trash_gray.png",event:"click",action:"deleteCategory",title:MWF.xApplication.cms.ColumnManager.LP.category.deleteCategory},{name:"moveCategory",icon:"turn.png",icon_over:"turn_gray.png",event:"click",action:"moveCategory",title:MWF.xApplication.cms.ColumnManager.LP.category.moveCategory}]},initialize:function(t,e,i,s){this.setOptions(s),this.list=t,this.explorer=t.explorer,this.app=t.app,this.css=t.css,this.container=$(e),this.data=i,this.lp=this.app.lp.category,this.categoryViewArr=[],this.categoryViewObj={},this.load()},load:function(){var t=this;this.node=new Element("div.categoryNaviNode",{styles:this.css.categoryNaviNode}).inject(this.options.relativeNode||this.container,this.options.relativePosition||"bottom"),this.node.store("category",this),this.textNode=new Element("div.categoryNaviTextNode",{styles:this.css.categoryNaviTextNode,text:this.data.name}).inject(this.node),this.node.addEvents({mouseover:function(){t.list.getCurrentNode()==this||t.list.isOnDragging||this.setStyles(t.css.categoryNaviNode_over)},mouseout:function(){t.list.getCurrentNode()!=this&&this.setStyles(t.css.categoryNaviNode)},click:function(){t.list.isOnDragging||t.setCurrentNode(this)}}),this.loadViewNode(),this.createIconAction(),this.options.isNew&&this.editCategory()},loadViewNode:function(){this.viewNaviListNode=new Element("div.viewNaviListNode",{styles:this.css.viewNaviListNode}).inject(this.node,"after")},destroy:function(){this.node.destroy(),this.viewNaviListNode.destroy()},setCategoryView:function(t,e){var i={categoryId:this.data.id,viewId:t};this.app.restActions.addCategoryView(i,function(e){this.app.restActions.getView(t,function(t){this.app.notice(MWF.xApplication.cms.ColumnManager.LP.setCategoryListSuccess)}.bind(this))}.bind(this),null,!1)},setDefaultCategoryView:function(t,e){var i=this.data;i.defaultViewName=t,this.app.restActions.saveCategory(i,function(t){e||this.app.notice(MWF.xApplication.cms.ColumnManager.LP.setDefaultViewSuccess)}.bind(this))},cancelCategoryView:function(t,e){this.app.restActions.listCategoryViewByCategory(this.data.id,function(e){e.data.each(function(e){e.viewId==t&&this.app.restActions.deleteCategoryView(e.id,function(e){var i=this.categoryViewObj[t];delete this.categoryViewObj[t],this.categoryViewArr.erase(i),i.destroy(),this.app.notice(MWF.xApplication.cms.ColumnManager.LP.cancelCategoryListSuccess)}.bind(this),null,!1)}.bind(this))}.bind(this),null,!1)},setImportView:function(t,e){var i=this.data;i.importViewId=t,i.importViewAppId=e;var s={viewId:t,viewAppId:e};this.app.restActions.saveCategoryImportView(i.id,s,function(t){this.app.notice(MWF.xApplication.cms.ColumnManager.LP.setImpExpViewSuccess)}.bind(this))},setCategoryAlias:function(t){var e=this.data;e.categoryAlias=t,e.alias=t,this.app.restActions.saveCategory(e,function(t){this.app.notice(MWF.xApplication.cms.ColumnManager.LP.setCategoryAliasSuccess)}.bind(this))},setDocumentType:function(t){var e=this.data;e.documentType=t,this.app.restActions.saveCategory(e,function(t){this.app.notice(MWF.xApplication.cms.ColumnManager.LP.setDocumentTypeSuccess)}.bind(this))},setEditForm:function(t,e){var i=this.data;i.formId=t,i.formName=e,this.app.restActions.saveCategory(i,function(t){this.app.notice(MWF.xApplication.cms.ColumnManager.LP.setEditFormSuccess)}.bind(this))},setReadForm:function(t,e){var i=this.data;i.readFormId=t,i.readFormName=e,this.app.restActions.saveCategory(i,function(t){this.app.notice(MWF.xApplication.cms.ColumnManager.LP.setReadFormSuccess)}.bind(this))},saveCategory:function(){var t=this.data||{};if(this.options.isNew&&(t.isNew=this.options.isNew,t.appId=this.app.options.column.id),this.editMode&&this.input){var e=this.input.get("value");if(""==e||e==MWF.xApplication.cms.ColumnManager.LP.category.inputName)return void this.app.notice(MWF.xApplication.cms.ColumnManager.LP.inputCategoryNotice,"error");t.categoryName=e,t.name=e}this.app.restActions.saveCategory(t,function(t){this.list.loadCategoryById(t.data.id,this.node,"before",function(t){this.list.setCurrentCategory(t),this.list.adjustSeq(!1),this.list.destroyCategory(this)}.bind(this))}.bind(this))},cancel:function(){this.options.isNew?this.destroy():(this.editMode=!1,this.input.destroy(),this.textNode.setStyle("display",""),this._showActions())},editCategory:function(){this.textNode.setStyle("display","none"),this.editMode=!0,this.input=new Element("input",{type:"text",value:this.options.isNew?MWF.xApplication.cms.ColumnManager.LP.category.inputName:this.data.name,styles:this.css.categoryInput}).inject(this.node,"top"),this.input.addEvents({click:function(t){this._showActions(!0),this.list.currentCategory!=this&&this.setCurrentNode(),t.stopPropagation()}.bind(this),focus:function(t){t.target.value==MWF.xApplication.cms.ColumnManager.LP.category.inputName&&(t.target.value="")}.bind(this),blur:function(t){""==t.target.value&&(t.target.value=MWF.xApplication.cms.ColumnManager.LP.category.inputName)}.bind(this)}),this._showActions(!0)},setCurrentNode:function(){this.list.setCurrentCategory(this)},createViewsNode:function(t,e){var i=new MWF.xApplication.cms.ColumnManager.CategoryExplorer.CategoryView(this,t,e),s=e.isDefault?"default":e.id;this.categoryViewObj[s]=i,this.categoryViewArr.push(i)},_showActions:function(){this.editMode?(this.actionArea_edit&&this.actionArea_edit.setStyle("display",""),this.actionArea_read&&this.actionArea_read.setStyle("display","none")):(this.actionArea_edit&&this.actionArea_edit.setStyle("display","none"),this.actionArea_read&&this.actionArea_read.setStyle("display",""))},_hideActions:function(){this.actionArea_read&&this.actionArea_read.setStyle("display","none"),this.actionArea_edit&&this.actionArea_edit.setStyle("display","none")},createIconAction:function(){this.actionNodes=this.actionNodes||{},this.actionArea_read||this.options.isNew||(this.actionArea_read=new Element("div",{styles:this.css.actionArea}).inject(this.node),this.options.actions_read.each(function(t){var e=this.actionNodes[t.name]=new Element("div",{styles:this.css.actionNodeStyles,title:t.title}).inject(this.actionArea_read);e.setStyle("background","url("+this.explorer.path+this.options.style+"/icon/"+t.icon+") no-repeat left center"),e.addEvent(t.event,function(e){this[t.action](e),e.stopPropagation()}.bind(this)),e.addEvents({mouseover:function(t){this.obj.list.currentCategory!=this.obj&&this.action.unselectedIcon_over?t.target.setStyle("background","url("+this.obj.explorer.path+this.obj.options.style+"/icon/"+this.action.unselectedIcon_over+") no-repeat left center"):t.target.setStyle("background","url("+this.obj.explorer.path+this.obj.options.style+"/icon/"+this.action.icon_over+") no-repeat left center")}.bind({obj:this,action:t}),mouseout:function(t){this.obj.list.currentCategory!=this.obj&&this.action.unselectedIcon?t.target.setStyle("background","url("+this.obj.explorer.path+this.obj.options.style+"/icon/"+this.action.unselectedIcon+") no-repeat left center"):t.target.setStyle("background","url("+this.obj.explorer.path+this.obj.options.style+"/icon/"+this.action.icon+") no-repeat left center")}.bind({obj:this,action:t})})}.bind(this))),this.actionArea_edit||(this.actionArea_edit=new Element("div",{styles:this.css.actionArea}).inject(this.node),this.options.actions_edit.each(function(t){var e=this.actionNodes[t.name]=new Element("div",{styles:this.css.actionNodeStyles,title:t.title}).inject(this.actionArea_edit);e.setStyle("background","url("+this.explorer.path+this.options.style+"/icon/"+t.icon+") no-repeat left center"),e.addEvent(t.event,function(e){this[t.action](e),e.stopPropagation()}.bind(this)),e.addEvents({mouseover:function(t){this.obj.list.currentCategory!=this.obj&&this.action.unselectedIcon_over?t.target.setStyle("background","url("+this.obj.explorer.path+this.obj.options.style+"/icon/"+this.action.unselectedIcon_over+") no-repeat left center"):t.target.setStyle("background","url("+this.obj.explorer.path+this.obj.options.style+"/icon/"+this.action.icon_over+") no-repeat left center")}.bind({obj:this,action:t}),mouseout:function(t){this.obj.list.currentCategory!=this.obj&&this.action.unselectedIcon?t.target.setStyle("background","url("+this.obj.explorer.path+this.obj.options.style+"/icon/"+this.action.unselectedIcon+") no-repeat left center"):t.target.setStyle("background","url("+this.obj.explorer.path+this.obj.options.style+"/icon/"+this.action.icon+") no-repeat left center")}.bind({obj:this,action:t})})}.bind(this)))},insertCateogryBefore:function(t){this.list.newCategory(this.node,"before")},insertCateogryAfter:function(t){this.list.newCategory(this.viewNaviListNode,"after")},deleteCategory:function(t){var e=this;this.app.confirm("warn",this.actionNodes.deleteCategory,this.lp.deleteCategoryTitle,this.lp.deleteCategoryConfirm,300,120,(function(){e._deleteCategory(),this.close()}),(function(){this.close()}))},_deleteCategory:function(t){this.app.restActions.removeCategory(this.data.id,function(){this.node.destroy(),this.viewNaviListNode.destroy(),t&&t()}.bind(this),function(t,e,i){var s=i;t&&(s=t.responseText);try{var o=JSON.parse(s);o.message&&this.app.notice(o.message,"error")}catch(t){}}.bind(this))},moveCategory:function(t){this._createMoveNode(),this._setNodeMove(t)},_createMoveNode:function(){this.moveNode=new Element("div",{styles:this.css.moduleNodeMove,text:this.node.get("text"),events:{selectstart:function(){return!1}}}).inject(this.container)},_setNodeMove:function(t){this._setMoveNodePosition(t);var e=this.list.getCategoryNodes();new Drag.Move(this.moveNode,{droppables:e,onEnter:function(t,e){var i=e.retrieve("category");i&&i._dragIn(this)}.bind(this),onLeave:function(t,e){var i=e.retrieve("category");i&&i._dragOut(this)}.bind(this),onDrag:function(t){this.list.isOnDragging=!0}.bind(this),onDrop:function(t,e,i){if(e){var s=e.retrieve("category");s?(this._dragComplete(s),s._dragDrop(this)):this._dragCancel(t)}else this._dragCancel(t);this.dragInterval&&(clearInterval(this.dragInterval),this.dragInterval=null),setTimeout(function(){this.list.isOnDragging=!1}.bind(this),100),i.stopPropagation()}.bind(this),onCancel:function(t){this.dragInterval&&(clearInterval(this.dragInterval),this.dragInterval=null),setTimeout(function(){this.list.isOnDragging=!1}.bind(this),100)}.bind(this)}).start(t)},_dragIn:function(){this.viewNaviListNode.setStyles(this.css.viewNaviListNode_dragIn)},_dragOut:function(){this.viewNaviListNode.setStyles(this.css.viewNaviListNode)},_dragDrop:function(){this.viewNaviListNode.setStyles(this.css.viewNaviListNode)},_dragComplete:function(t){this.node.inject(t.viewNaviListNode,"after"),this.viewNaviListNode.inject(this.node,"after"),this.setCurrentNode(),this.moveNode&&this.moveNode.destroy(),this.moveNode=null,this.list.adjustSeq()},_dragCancel:function(){this.moveNode&&this.moveNode.destroy(),this.moveNode=null},_setScroll:function(){var t=this.explorer.categoryScrollWrapNode||this.explorer.naviArea,e=t.getCoordinates(),i=e.top,s=i+e.height,o=this.explorer.categoryScrollContentNode||this.explorer.naviNode,n=this.moveNode.getCoordinates();n.top<i&&n.bottom>i?this.dragInterval||(this.dragInterval=setInterval(function(){t.getScroll().y-15>0?t.scrollTo(0,t.getScroll().y-15):t.scrollTo(0,0)}.bind(this),100)):n.top<s&&n.bottom>s?this.dragInterval||(this.dragInterval=setInterval(function(){t.getScroll().y+15<o.getSize().y?t.scrollTo(0,t.getScroll().y+15):t.scrollTo(0,o.getSize().y)}.bind(this),100)):this.dragInterval&&(clearInterval(this.dragInterval),this.dragInterval=null)},_setMoveNodePosition:function(t){var e=t.page.x+2,i=t.page.y+2;this.moveNode.positionTo(e,i)}}),MWF.xApplication.cms.ColumnManager.CategoryExplorer.CategoryView=new Class({Implements:[Options,Events],initialize:function(t,e,i,s){this.setOptions(s),this.category=t,this.list=t.list,this.explorer=t.explorer,this.app=t.app,this.css=t.css,this.container=$(e),this.data=i,this.load()},destroy:function(){this.node.destroy()},load:function(){var t=this;this.node=new Element("div.viewNaviNode",{styles:this.css.viewNaviNode,text:this.data.isDefault?this.app.lp.defaultView:this.data.name}).inject(this.container),this.node.addEvents({mouseover:function(){t.list.getCurrentNode()!=this&&this.setStyles(t.css.viewNaviNode_over)},mouseout:function(){t.list.getCurrentNode()!=this&&this.setStyles(t.css.viewNaviNode)},click:function(e){t.setCurrentNode(this)}})},setCurrentNode:function(){this.list.setCurrentView(this)}}),MWF.xApplication.cms.ColumnManager.CategoryExplorer.FormExplorer=new Class({Extends:MWF.xApplication.cms.ColumnManager.FormExplorer,Implements:[Options,Events],load:function(){this.loadContentNode(),this.setNodeScroll(),this.refresh()},reload:function(){this.node&&(this.initData(),this.node.empty(),this.loadContentNode(),this.setNodeScroll(),this.currentCategory?this.refreshByCategory(this.currentCategory):this.refresh())},refreshByCategory:function(t){var e,i;this.currentCategory=t,t.data&&(e=t.data.formId,t.data.formName,i=t.data.readFormId),this.currentEditForm&&(this.currentEditForm.isEditForm=!1,this.currentEditForm.setStyle(),this.currentEditForm=null),this.currentReadForm&&(this.currentReadForm.isReadForm=!1,this.currentReadForm.setStyle(),this.currentReadForm=null),this.refresh(t,function(){this.itemArray.each(function(t){var s=t.data;s.id==e&&(this.currentEditForm=t,t.isEditForm=!0),s.id==i&&(this.currentReadForm=t,t.isReadForm=!0),t.setStyle()}.bind(this))}.bind(this))},refresh:function(t,e){this.noElementNode&&this.noElementNode.destroy(),t?t.options.isNew?(this.itemArray.each((function(t){t.node.setStyle("display","none")})),this.noElementNode=new Element("div",{styles:this.css.noElementNode,text:MWF.xApplication.cms.ColumnManager.LP.saveCategoryNotice}).inject(this.elementContentListNode)):this.itemArray&&this.itemArray.length?(this.itemArray.each((function(t){t.node.setStyle("display","")})),e&&e()):this.loadElementList(e):(this.itemArray.each((function(t){t.node.setStyle("display","none")})),this.noElementNode=new Element("div",{styles:this.css.noElementNode,text:MWF.xApplication.cms.ColumnManager.LP.noCategoryNotice}).inject(this.elementContentListNode))},loadContentNode:function(){this.elementContentNode=new Element("div",{styles:this.css.elementContentNode}).inject(this.node),this.elementContentListNode=new Element("div",{styles:this.css.elementContentListNode}).inject(this.elementContentNode),this.setContentSize(),this.app.addEvent("resize",function(){this.setContentSize()}.bind(this))},setContentSize:function(){var t=this.toolbarNode?this.toolbarNode.getSize():{x:0,y:0},e=this.node.getSize(),i=this.elementContentNode.getStyle("padding-top").toFloat(),s=this.elementContentNode.getStyle("padding-bottom").toFloat(),o=e.y-t.y-i-s,n=e.x;this.elementContentNode.setStyle("height",o+"px"),this.elementContentListNode.setStyles({width:n+"px"})},loadElementList:function(t){this._loadItemDataList(function(e){e.data.length?(e.data.each(function(t){var e=this._getItemObject(t,this.itemArray.length+1);e.load(),this.itemObject[t.id]=e,this.itemArray.push(e)}.bind(this)),t&&t()):(this.noElementNode=new Element("div",{styles:this.css.noElementNode,text:this.options.tooltip.noElement}).inject(this.elementContentListNode)).addEvent("click",function(t){this._createElement(t)}.bind(this))}.bind(this))},_getItemObject:function(t,e){return new MWF.xApplication.cms.ColumnManager.CategoryExplorer.Form(this,t,{index:e})},_loadItemDataList:function(t){this.app.restActions.listForm(this.app.options.column.id,t,null,!1)}}),MWF.xApplication.cms.ColumnManager.CategoryExplorer.Form=new Class({Extends:MWF.xApplication.cms.ColumnManager.FormExplorer.Form,options:{where:"bottom",index:1},initialize:function(t,e,i){this.setOptions(i),this.explorer=t,this.app=t.app,this.css=this.explorer.css,this.lp=this.app.lp.form,this.data=e,this.container=this.explorer.elementContentListNode,this.icon=this._getIcon()},load:function(){this.node=new Element("div",{styles:this.css.itemNode,events:{mouseover:function(){this.isEditForm||this.node.setStyle("background-color","#f0f0f0")}.bind(this),mouseout:function(){var t=this.options.index%2==0?"#f7f7f7":"#fff";this.isEditForm||this.node.setStyle("background-color",t)}.bind(this)}}).inject(this.container),this.itemStatusNode=new Element("div",{styles:this.css.itemStatusNode}).inject(this.node),this.itemStatusTopNode=new Element("div",{styles:this.css.itemStatusTopNode}).inject(this.itemStatusNode),this.itemStatusBottomNode=new Element("div",{styles:this.css.itemStatusBottomNode}).inject(this.itemStatusNode),this.data.name.icon&&(this.icon=this.data.name.icon);var t=this.explorer.path+""+this.explorer.options.style+"/processIcon/"+this.icon,e=new Element("div",{styles:this.css.itemIconNode,title:MWF.xApplication.cms.ColumnManager.LP.dragToDesktopNotice}).inject(this.node);e.setStyle("background","url("+t+") center center no-repeat"),e.makeLnk({par:this._getLnkPar()}),this.actionsArea=new Element("div.actionsArea",{styles:this.css.actionsArea}).inject(this.node),this.setEditAction=new Element("div.setEditAction",{styles:this.css.setEditAction,title:MWF.xApplication.cms.ColumnManager.LP.asEditForm}).inject(this.actionsArea),this.setEditAction.addEvents({click:function(t){this.setEditForm()}.bind(this),mouseover:function(t){this.isEditForm||this.setEditAction.setStyles(this.css.setEditAction_selected)}.bind(this),mouseout:function(t){this.isEditForm||this.setEditAction.setStyles(this.css.setEditAction)}.bind(this)}),this.setReadAction=new Element("div.setReadAction",{styles:this.css.setReadAction,title:MWF.xApplication.cms.ColumnManager.LP.asReadForm}).inject(this.actionsArea),this.setReadAction.addEvents({click:function(t){this.setReadForm()}.bind(this),mouseover:function(t){this.isReadForm||this.setReadAction.setStyles(this.css.setReadAction_selected)}.bind(this),mouseout:function(t){this.isReadForm||this.setReadAction.setStyles(this.css.setReadAction)}.bind(this)}),this.explorer.options.noDelete||(this.deleteActionNode=new Element("div.deleteAction",{styles:this.css.deleteAction,title:MWF.xApplication.cms.ColumnManager.LP.delete}).inject(this.actionsArea),this.deleteActionNode.addEvent("click",function(t){this.deleteItem(t)}.bind(this)),this.deleteActionNode.addEvents({mouseover:function(t){this.deleteActionNode.setStyles(this.css.deleteAction_over)}.bind(this),mouseout:function(t){this.deleteActionNode.setStyles(this.css.deleteAction)}.bind(this)}));var i=new Element("div.itemInforNode",{styles:this.css.itemInforNode}).inject(this.node),s=new Element("div.itemInforBaseNode",{styles:this.css.itemInforBaseNode}).inject(i);this.itemTextTitleNode=new Element("div.itemTextTitleNode",{styles:this.css.itemTextTitleNode,text:this.data.name,title:this.data.name,events:{click:function(t){this._open(t),t.stopPropagation()}.bind(this)}}).inject(s),new Element("div.itemTextDateNode",{styles:this.css.itemTextDateNode,text:this.data.updateTime||""}).inject(s)},setEditForm:function(){this.explorer.currentEditForm&&(this.explorer.currentEditForm.isEditForm=!1,this.explorer.currentEditForm.setStyle()),this.explorer.currentEditForm=this,this.isEditForm=!0,this.setStyle(),this.explorer.currentCategory.setEditForm(this.data.id,this.data.name)},setReadForm:function(){this.explorer.currentReadForm&&(this.explorer.currentReadForm.isReadForm=!1,this.explorer.currentReadForm.setStyle()),this.isReadForm=!0,this.setStyle(),this.explorer.currentCategory.setReadForm(this.data.id,this.data.name),this.explorer.currentReadForm=this},setStyle:function(){if(this.isEditForm&&this.isReadForm)this.itemStatusTopNode.setStyles({"background-color":"#3c76b7"}),this.itemStatusBottomNode.setStyles({"background-color":"#50e3c2"}),this.node.setStyles({"background-color":"#f2f8ff"}),this.itemTextTitleNode.setStyles({color:"#447bbb"}),this.setEditAction.setStyles(this.css.setEditAction_selected),this.setReadAction.setStyles(this.css.setReadAction_selected);else if(this.isEditForm)this.itemStatusTopNode.setStyles({"background-color":"#3c76b7"}),this.itemStatusBottomNode.setStyles({"background-color":"#3c76b7"}),this.node.setStyles({"background-color":"#f2f8ff"}),this.itemTextTitleNode.setStyles({color:"#447bbb"}),this.setEditAction.setStyles(this.css.setEditAction_selected),this.setReadAction.setStyles(this.css.setReadAction);else if(this.isReadForm){this.itemStatusTopNode.setStyles({"background-color":"#50e3c2"}),this.itemStatusBottomNode.setStyles({"background-color":"#50e3c2"});var t=this.options.index%2==0?"#f7f7f7":"#fff";this.node.setStyles({"background-color":t}),this.itemTextTitleNode.setStyles({color:"#888"}),this.setEditAction.setStyles(this.css.setEditAction),this.setReadAction.setStyles(this.css.setReadAction_selected)}else{t=this.options.index%2==0?"#f7f7f7":"#fff";this.itemStatusTopNode.setStyles({"background-color":t}),this.itemStatusBottomNode.setStyles({"background-color":t}),this.node.setStyles({"background-color":t}),this.itemTextTitleNode.setStyles({color:"#888"}),this.setEditAction.setStyles(this.css.setEditAction),this.setReadAction.setStyles(this.css.setReadAction)}},_open:function(t){layout.desktop.getFormDesignerStyle(function(){var e=this,i={style:layout.desktop.formDesignerStyle,appId:"cms.FormDesigner"+e.data.id,id:e.data.id,application:e.explorer.app.options.column.id,onQueryLoad:function(){this.actions=e.explorer.actions,this.category=e,this.options.id=e.data.id,this.column=e.explorer.app.options.column,this.application=e.explorer.app.options.column}};this.explorer.app.desktop.openApplication(t,"cms.FormDesigner",i)}.bind(this))},_deleteItem:function(t){this.explorer.app.restActions.removeForm(this.data.id,function(){this.node.destroy(),t&&t()}.bind(this))}}),MWF.xApplication.cms.ColumnManager.CategoryExplorer.ViewExplorer=new Class({Extends:MWF.xApplication.cms.ColumnManager.ViewExplorer,Implements:[Options,Events],initialize:function(t,e,i){this.setOptions(i),this.setTooltip(),this.path="../x_component_cms_ColumnManager/$Explorer/",this.cssPath="../x_component_cms_ColumnManager/$Explorer/"+this.options.style+"/css.wcss",this._loadCss(),this.actions=e,this.node=$(t),this.initData()},initData:function(){this.revealData=[],this.revealIds=[],this.itemArray=[],this.itemObject={},this.deleteMarkItems=[]},reload:function(){this.node&&(this.initData(),this.node.empty(),this.load())},load:function(){this.loadContentNode(),this.setNodeScroll(),this.loadElementList()},refreshByCategory:function(t){this.category=t,this.options.categoryId=t.data.id,this.options.defaultViewId=t.data.defaultViewName||"defaultList",this.options.formId=t.data.formId,this.options.formName=t.data.formName,this.reload()},loadElementList:function(){if(this.category)if(this.category.options.isNew){this.elementContentListNode.empty();new Element("div",{styles:this.css.noElementNode,text:MWF.xApplication.cms.ColumnManager.LP.saveCategoryNotice}).inject(this.elementContentListNode)}else this._loadItemDataList(function(t){if(t&&t.length)t.each(function(t){var e=this._getItemObject(t,this.itemArray.length+1);e.load(),this.itemObject[t.id]=e,this.itemArray.push(e),this.setViewsBackground()}.bind(this));else{this.elementContentListNode.empty();var e=new Element("div",{styles:this.css.noElementNode,text:MWF.xApplication.cms.ColumnManager.LP.notAddListOrView}).inject(this.elementContentListNode);this.options.noCreate||e.addEvent("click",function(t){this._createView(t)}.bind(this))}}.bind(this));else{this.elementContentListNode.empty();new Element("div",{styles:this.css.noElementNode,text:MWF.xApplication.cms.ColumnManager.LP.noCategoryNotice}).inject(this.elementContentListNode)}},_loadItemDataList:function(t){var e=this.options.categoryId;this.options.formId;if(e)this.actions.getCategory(e,function(i){var s=i.data.extContent;s?this.extContent=JSON.parse(s):(this.extContent={reveal:[]},this.actions.listViewByCategory(e,function(t){(t.data||[]).each(function(t){var e={type:"list",name:t.name,showName:t.name,id:t.id,alias:t.alias,appId:t.appId,formId:t.formId,formName:t.formName};this.extContent.reveal.push(e)}.bind(this))}.bind(this),null,!1)),this.extContent&&this.extContent.reveal&&0!=this.extContent.reveal.length||(this.extContent={reveal:[{id:"defaultList",showName:MWF.xApplication.cms.ColumnManager.LP.systemList,name:MWF.xApplication.cms.ColumnManager.LP.systemList}]}),this.revealData=this.extContent.reveal,this.revealData.each(function(t){this.revealIds.push(t.id)}.bind(this)),t&&t(this.revealData)}.bind(this),null,!1);else{this.elementContentListNode.empty();new Element("div",{styles:this.css.noElementNode,text:MWF.xApplication.cms.ColumnManager.LP.selectCategoryNotice}).inject(this.elementContentListNode)}},_selectList:function(){MWF.xDesktop.requireApp("cms.ColumnManager","widget.CMSListSelector",null,!1);var t={count:0,title:MWF.xApplication.cms.ColumnManager.LP.selectList,values:[],appId:this.app.options.column.id,onComplete:function(t){this.selectedList(t)}.bind(this)};new MWF.xApplication.Selector.ListSelector(this.app.content,t).load()},selectedList:function(t){var e=[],i=[];if(t.each(function(t){this.revealIds.contains(t.data.id)?e.push(t.data.name):i.push(t.data)}.bind(this)),i.each(function(t){this.revealIds.push(t.id);var e={type:"list",name:t.name,showName:t.name,id:t.id,alias:t.alias,appId:t.appId,formId:t.formId,formName:t.formName};this.revealData.push(e);var i=this._getItemObject(e);i.load(),this.itemObject[e.id]=i,this.itemArray.push(i),"defaultList"!=t.id&&this.category.setCategoryView(t.id,t.name)}.bind(this)),i.length>0&&(this.setViewsBackground(),this.saveExtContent()),e.length>0){var s=MWF.xApplication.cms.ColumnManager.LP.conflictedListNotice.replace("{text}",e.join(","));this.app.notice(s,"error")}},_selectView:function(){MWF.xDesktop.requireApp("Selector","package",null,!1);var t={type:"QueryView",title:MWF.xApplication.cms.ColumnManager.LP.selectDataView,count:0,values:[],onComplete:function(t){this.selectedView(t)}.bind(this)};new MWF.O2Selector(this.app.content,t)},selectedView:function(t){var e=[],i=[];if(t.each(function(t){this.revealIds.contains(t.data.id)?e.push(t.data.name):i.push(t.data)}.bind(this)),i.each(function(t){this.revealIds.push(t.id);var e={type:"queryview",name:t.name,showName:t.name,id:t.id,viewType:t.type,alias:t.alias,appName:t.appName||t.applicationName},i=this._getItemObject(e);i.load(),this.itemObject[e.id]=i,this.itemArray.push(i),this.revealData.push(e)}.bind(this)),i.length>0&&(this.setViewsBackground(),this.saveExtContent()),e.length>0){var s=MWF.xApplication.cms.ColumnManager.LP.conflictedViewNotice.replace("{text}",e.join(","));this.app.notice(s,"error")}},_getItemObject:function(t,e){var i=this.options.defaultViewId==t.id,s=new MWF.xApplication.cms.ColumnManager.CategoryExplorer.View(this,t,{isCategoryDefaultView:i,index:e||1});return i&&(this.defaultView=s),s},loadContentNode:function(){this.elementContentNode&&this.elementContentNode.destroy(),this.elementContentNode=new Element("div.elementContentNode",{styles:this.css.elementContentNode}).inject(this.node),this.elementContentListNode=new Element("div.elementContentListNode",{styles:this.css.elementContentListNode}).inject(this.elementContentNode);this.elementTable=new Element("table",{width:"99%",border:"0",cellpadding:"5",cellspacing:"0",styles:this.css.listTable}).inject(this.elementContentListNode);this.setContentSize(),this.app.addEvent("resize",function(){this.setContentSize()}.bind(this))},saveExtContent:function(){this.extContent={reveal:this.revealData};var t=JSON.stringify(this.extContent);this.category.data.extContent=t,this.app.restActions.saveCategoryExtContent({id:this.options.categoryId,content:t}),this.revealIds.contains(this.options.defaultViewId)||this.category.setDefaultCategoryView("",!0)},saveByDom:function(){var t=this.elementTable.getElements("tr");this.revealData=[],this.revealIds=[];for(var e=0;e<t.length;e++){var i=t[e],s=i.retrieve("view").data;this.revealData.push(s),this.revealIds.push(s.id);var o=e%2==1?"#f7f7f7":"#fff";i.setStyle("background-color",o)}this.saveExtContent()},setViewsBackground:function(){this.elementTable.getElements("tr").each(function(t,e){t.setStyle("background-color",e%2==1?"#f7f7f7":"#fff")}.bind(this))},setContentSize:function(){var t=this.toolbarNode?this.toolbarNode.getSize():{x:0,y:0},e=this.node.getSize(),i=this.elementContentNode.getStyle("padding-top").toFloat(),s=this.elementContentNode.getStyle("padding-bottom").toFloat(),o=e.y-t.y-i-s,n=e.x;this.elementContentNode.setStyle("height",o+"px"),this.elementContentListNode.setStyles({width:n+"px"})}}),MWF.xApplication.cms.ColumnManager.CategoryExplorer.View=new Class({Extends:MWF.xApplication.cms.ColumnManager.ViewExplorer.View,Implements:[Options],options:{isCategoryDefaultView:!1,index:1},initialize:function(t,e,i){this.setOptions(i),this.explorer=t,this.css=this.explorer.css,this.data=e,this.explorer.elementTable||this.explorer.loadContentNode(),this.container=this.explorer.elementTable},load:function(){this.node=new Element("tr",{styles:this.css.listTableTr,events:{mouseover:function(){this.nodeBackgroundColor=this.node.getStyle("background-color"),this.node.setStyle("background-color","#f0f0f0")}.bind(this),mouseout:function(){this.node.setStyle("background-color",this.nodeBackgroundColor)}.bind(this)}}).inject(this.container,this.options.isCategoryDefaultView?"top":"bottom"),this.node.store("view",this),this.showNameNode=new Element("td",{styles:this.css.listTableContent,text:this.data.showName,events:{click:function(t){this._open(t),t.stopPropagation()}.bind(this)}}).inject(this.node),this.options.isCategoryDefaultView?this.showNameNode.setStyles({background:"url(../x_component_cms_Module/$Main/default/icon/category_folder.png) no-repeat 10px 12px","font-size":"15px","padding-left":"35px"}):this.showNameNode.setStyle("padding-left","35px"),this.typeNode=new Element("td",{styles:this.css.listTableContent,width:"30",text:"list"==this.data.type?MWF.xApplication.cms.ColumnManager.LP.list1:MWF.xApplication.cms.ColumnManager.LP.view1}).inject(this.node),this.typeNode.setStyle("font-size","12px"),this.actionsArea=new Element("td.actionsArea",{styles:this.css.listTableContent,width:"80"}).inject(this.node),this.createAction_read(),this.createAction_edit(),this.setStyle(),this.loadTooltip()},loadTooltip:function(){var t=new MWF.xApplication.cms.ColumnManager.CategoryExplorer.ViewTooltip(this.explorer.app.content,this.node,this.explorer.app,this.data,{axis:"x",hiddenDelay:100,displayDelay:100,nodeStyles:{"z-index":"101"}});this.node.store("tooltip",t)},createAction_read:function(){this.readActionsArea=new Element("div").inject(this.actionsArea),this.editAction=new Element("div.editViewAction",{styles:this.css.editViewAction,title:MWF.xApplication.cms.ColumnManager.LP.edit}).inject(this.readActionsArea),this.editAction.addEvents({click:function(t){this.editView()}.bind(this),mouseover:function(t){this.editAction.setStyles(this.css.editViewAction_over)}.bind(this),mouseout:function(t){this.editAction.setStyles(this.css.editViewAction)}.bind(this)}),this.setDefaultCategoryViewAction=new Element("div.setDefaultCategoryViewAction",{styles:this.css.setDefaultCategoryViewAction,title:MWF.xApplication.cms.ColumnManager.LP.setAsDefaultList}).inject(this.readActionsArea),this.setDefaultCategoryViewAction.addEvents({click:function(t){this.setDefaultCategoryView()}.bind(this),mouseover:function(t){this.options.isCategoryDefaultView||this.setDefaultCategoryViewAction.setStyles(this.css.setDefaultCategoryViewAction_selected)}.bind(this),mouseout:function(t){this.options.isCategoryDefaultView||this.setDefaultCategoryViewAction.setStyles(this.css.setDefaultCategoryViewAction)}.bind(this)}),this.cancelViewAction=new Element("div.cancelViewAction",{styles:this.css.cancelViewAction,title:MWF.xApplication.cms.ColumnManager.LP.cancel}).inject(this.readActionsArea),this.cancelViewAction.addEvent("click",function(t){this.cancelView(t)}.bind(this)),this.cancelViewAction.addEvents({mouseover:function(t){this.cancelViewAction.setStyles(this.css.cancelViewAction_over)}.bind(this),mouseout:function(t){this.cancelViewAction.setStyles(this.css.cancelViewAction)}.bind(this)}),this.trunViewAction=new Element("div.trunViewAction",{styles:this.css.trunViewAction,title:MWF.xApplication.cms.ColumnManager.LP.adjustOrder}).inject(this.readActionsArea),this.trunViewAction.addEvents({click:function(t){this.turnViewOrder(t)}.bind(this),mouseover:function(t){this.trunViewAction.setStyles(this.css.turnViewAction_over)}.bind(this),mouseout:function(t){this.trunViewAction.setStyles(this.css.trunViewAction)}.bind(this)})},createAction_edit:function(){this.editActionsArea=new Element("div").inject(this.actionsArea),this.editActionsArea.setStyle("display","none"),this.saveViewAction=new Element("div.saveViewAction",{styles:this.css.saveViewAction,title:MWF.xApplication.cms.ColumnManager.LP.save}).inject(this.editActionsArea),this.saveViewAction.addEvents({click:function(t){this.saveView()}.bind(this),mouseover:function(t){this.saveViewAction.setStyles(this.css.saveViewAction_over)}.bind(this),mouseout:function(t){this.saveViewAction.setStyles(this.css.saveViewAction)}.bind(this)}),this.cancelEditViewAction=new Element("div.cancelEditViewAction",{styles:this.css.cancelEditViewAction,title:MWF.xApplication.cms.ColumnManager.LP.cancelEdit}).inject(this.editActionsArea),this.cancelEditViewAction.addEvents({click:function(t){this.cancelEditView()}.bind(this),mouseover:function(t){this.cancelEditViewAction.setStyles(this.css.cancelEditViewAction_over)}.bind(this),mouseout:function(t){this.cancelEditViewAction.setStyles(this.css.cancelEditViewAction)}.bind(this)})},_open:function(t){var e=this;if(!this.explorer.isOnDragging&&!this.editMode)if("defaultList"==this.data.id);else if("list"==this.data.type){var i={appId:"cms.ViewDesigner"+e.data.id,id:e.data.id,application:e.explorer.app.options.column.id,onQueryLoad:function(){this.actions=e.explorer.actions,this.category=e,this.options.id=e.data.id,this.column=e.explorer.app.options.column,this.application=e.explorer.app.options.column,this.options.noModifyName=e.explorer.options.noModifyName,this.options.readMode=e.explorer.options.readMode,this.options.formId=e.data.formId}};this.explorer.app.desktop.openApplication(t,"cms.ViewDesigner",i)}else if(this.data.viewType)MWF.Actions.get("x_query_assemble_designer").getApplication(this.data.appName,function(i){var s={onQueryLoad:function(){this.options.id=e.data.id,this.options.application=i.data,this.application=i.data}};this.explorer.app.desktop.openApplication(t,"query.ViewDesigner",s)}.bind(this));else{i={onQueryLoad:function(){this.actions=e.explorer.actions,this.category=e,this.options.id=e.data.id,this.application=e.explorer.app.options.column,this.explorer=e.explorer}};this.explorer.app.desktop.openApplication(t,"cms.QueryViewDesigner",i)}},cancelView:function(){var t=this.node.retrieve("tooltip");t&&t.destroy(),this.node.destroy(),this.explorer.category.cancelCategoryView(this.data.id,this.data.name),this.explorer.saveByDom()},deleteView:function(t){this.explorer.app.restActions.deleteView(this.data.id,function(){this.node.destroy(),t&&t()}.bind(this))},setDefaultCategoryView:function(){this.explorer.defaultView&&this.explorer.defaultView.cancelDefaultView(),this.options.isCategoryDefaultView=!0,this.explorer.defaultView=this,this.explorer.options.defaultViewId=this.data.id,this.node.inject(this.container,"top"),this.showNameNode.setStyles({background:"url(../x_component_cms_Module/$Main/default/icon/category_folder.png) no-repeat 10px 12px","font-size":"15px","padding-left":"35px"}),this.setStyle(),this.explorer.saveByDom(),this.explorer.category.setDefaultCategoryView(this.data.id)},cancelDefaultView:function(){this.options.isCategoryDefaultView=!1,this.showNameNode.setStyles({background:"","font-size":"14px","padding-left":"35px"}),this.setStyle()},saveView:function(){this.data.showName=this.input.get("value"),this.explorer.saveByDom(),this.showNameNode.empty(),this.editMode=!1,this.explorer.editMode=!1,this.editActionsArea.setStyle("display","none"),this.readActionsArea.setStyle("display",""),this.showNameNode.set("text",this.data.showName)},editView:function(){this.showNameNode.empty(),this.editMode=!0,this.explorer.editMode=!0,this.editActionsArea.setStyle("display",""),this.readActionsArea.setStyle("display","none"),this.input=new Element("input",{type:"text",value:this.data.showName,styles:this.css.viewInput}).inject(this.showNameNode)},cancelEditView:function(){this.showNameNode.empty(),this.editMode=!1,this.explorer.editMode=!1,this.editActionsArea.setStyle("display","none"),this.readActionsArea.setStyle("display",""),this.showNameNode.set("text",this.data.showName)},turnViewOrder:function(t){this._createMoveNode(),this._setNodeMove(t)},_createMoveNode:function(){this.moveNode=new Element("div",{styles:this.css.moduleNodeMove,text:this.data.showName,events:{selectstart:function(){return!1}}}).inject(this.container)},_setNodeMove:function(t){this._setMoveNodePosition(t),new Drag.Move(this.moveNode,{droppables:this.container.getElements("tr"),onEnter:function(t,e){e.setStyle("border-bottom","1px solid #ffa200")}.bind(this),onLeave:function(t,e){e.setStyle("border-bottom","0px")}.bind(this),onDrag:function(t){this.explorer.isOnDragging=!0}.bind(this),onDrop:function(t,e,i){if(e){var s=e.retrieve("view");s?(this._dragComplete(s),e.setStyle("border-bottom","0px")):this._dragCancel(t)}else this._dragCancel(t);setTimeout(function(){this.explorer.isOnDragging=!1}.bind(this),100),i.stopPropagation()}.bind(this),onCancel:function(t){setTimeout(function(){this.explorer.isOnDragging=!1}.bind(this),100)}.bind(this)}).start(t)},_dragComplete:function(t){this.node.inject(t.node,"after"),this.moveNode&&this.moveNode.destroy(),this.moveNode=null,this.explorer.saveByDom()},_dragCancel:function(){this.moveNode&&this.moveNode.destroy(),this.moveNode=null},_setMoveNodePosition:function(t){var e=t.page.x+2,i=t.page.y+2;this.moveNode.positionTo(e,i)},setStyle:function(){this.options.isCategoryDefaultView&&this.options.isCategoryView?this.setDefaultCategoryViewAction.setStyles(this.css.setDefaultCategoryViewAction_selected):this.options.isCategoryView?(this.setDefaultCategoryViewAction.setStyles(this.css.setDefaultCategoryViewAction),this.setCategoryViewAction.setStyles(this.css.setCategoryViewAction_selected)):this.options.isCategoryDefaultView?this.setDefaultCategoryViewAction.setStyles(this.css.setDefaultCategoryViewAction_selected):this.setDefaultCategoryViewAction.setStyles(this.css.setDefaultCategoryViewAction)}}),MWF.xApplication.cms.ColumnManager.CategoryExplorer.CategoryProperty=new Class({initialize:function(t,e,i){this.app=t,this.node=$(e),this.category=i,this.lp=this.app.lp.category},load:function(){this.propertyTitleBar=new Element("div",{styles:this.app.css.propertyTitleBar,text:this.lp.categoryProperty}).inject(this.node),this.contentNode=new Element("div",{styles:this.app.css.propertyContentNode}).inject(this.node),this.contentAreaNode=new Element("div",{styles:this.app.css.propertyContentAreaNode}).inject(this.contentNode),this.setContentHeight(),this.setContentHeightFun=this.setContentHeight.bind(this),this.app.addEvent("resize",this.setContentHeightFun),MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.contentNode,{indent:!1})}.bind(this))},reload:function(t){t&&(this.category=t),this.contentAreaNode.empty(),this.category&&!this.category.options.isNew&&this.loadContent()},loadContent:function(){this.baseActionAreaNode=new Element("div.baseActionAreaNode",{styles:this.app.css.availableTitleNode}).inject(this.contentAreaNode),this.baseActionNode=new Element("div.propertyInforActionNode",{styles:this.app.css.propertyInforActionNode}).inject(this.baseActionAreaNode),this.baseTextNode=new Element("div.baseTextNode",{styles:this.app.css.baseTextNode,text:this.app.lp.category.baseProperty}).inject(this.baseActionAreaNode),this.createPropertyContentNode(),this.processContainer=new Element("div").inject(this.contentAreaNode),this.createProcessNode(),this.viewerContainer=new Element("div").inject(this.contentAreaNode),MWF.xDesktop.requireApp("cms.ColumnManager","widget.CategoryViewerSetting",null,!1),this.viewerSetting=new MWF.xApplication.cms.ColumnManager.CategoryViewerSetting(this.app,this.app.lp.application.viewerSetting,this.viewerContainer,{objectId:this.category.data.id}),this.viewerSetting.category=this.category,this.viewerSetting.load(),this.publisherContainer=new Element("div").inject(this.contentAreaNode),MWF.xDesktop.requireApp("cms.ColumnManager","widget.CategoryPublisherSetting",null,!1),this.publisherSetting=new MWF.xApplication.cms.ColumnManager.CategoryPublisherSetting(this.app,this.app.lp.application.publisherSetting,this.publisherContainer,{objectId:this.category.data.id}),this.publisherSetting.category=this.category,this.publisherSetting.load(),this.managerContainer=new Element("div").inject(this.contentAreaNode),MWF.xDesktop.requireApp("cms.ColumnManager","widget.CategoryManagerSetting",null,!1),this.viewerSetting=new MWF.xApplication.cms.ColumnManager.CategoryManagerSetting(this.app,this.app.lp.application.managerSetting,this.managerContainer,{objectId:this.category.data.id}),this.viewerSetting.category=this.category,this.viewerSetting.load()},saveProcessApp:function(t,e){var i=this.category.data;i.workflowAppId=t,i.workflowAppName=e,this.app.restActions.saveCategory(i,function(t){this.app.notice(this.lp.setProcessAppSucess)}.bind(this))},saveProcess:function(t,e){var i=this.category.data;i.workflowFlag=t,i.workflowName=e,i.workflowType=t?MWF.xApplication.cms.ColumnManager.LP.enableProcess:MWF.xApplication.cms.ColumnManager.LP.disableProcess,this.app.restActions.saveCategory(i,function(t){this.app.notice(this.lp.setProcessSucess)}.bind(this))},createProcessNode:function(){this.processTitleNode=new Element("div.availableTitleNode",{styles:this.app.css.availableTitleNode,text:this.lp.useProcess}).inject(this.processContainer),this.processContentNode=new Element("div",{styles:{overflow:"hidden"}}).inject(this.processContainer),this.processAreaNode=new Element("div.processAreaNode",{styles:this.app.css.processAreaNode}).inject(this.processContentNode),this.createProcessAppSelect(this.category.data.workflowAppId||""),this.createProcessSelect(this.category.data.workflowAppId||"",this.category.data.workflowFlag||"")},createProcessAppSelect:function(t){this.processAppSelect=new Element("select",{styles:this.app.css.processSelect}).inject(this.processAreaNode),new Element("option",{value:"",text:this.lp.selectProcessApp}).inject(this.processAppSelect),MWF.Actions.get("x_processplatform_assemble_designer").listApplication(null,function(e){0===e.data.length?new Element("option",{value:"",text:this.lp.noProcess}).inject(this.processAppSelect):e.data.each(function(e){var i=new Element("option",{value:e.id,text:e.name}).inject(this.processAppSelect);e.id==t&&(i.selected=!0)}.bind(this))}.bind(this)),this.processAppSelect.addEvent("change",function(t){var e=this.getSelectProcessApp();this.createProcessSelect(e.id),this.saveProcessApp(e.id,e.name)}.bind(this))},getSelectProcessApp:function(){var t;return this.processAppSelect.getElements("option").each(function(e){e.selected&&(t={id:e.value,name:e.text})}.bind(this)),t},setProcessApp:function(t){var e=!0;this.processAppSelect.getElements("option").each(function(i){e&&i.value==t&&(i.selected=!0,e=!1)}.bind(this))},createProcessSelect:function(t,e){this.processSelect&&this.processSelect.destroy(),t&&(this.processSelect=new Element("select",{styles:this.app.css.processSelect}).inject(this.processAreaNode),new Element("option",{value:"",text:this.lp.selectProcess}).inject(this.processSelect),new Element("option",{value:"",text:this.lp.none}).inject(this.processSelect),MWF.Actions.get("x_processplatform_assemble_designer").listProcess(t,function(t){t.data.each(function(t){var i=new Element("option",{value:t.id,text:t.name}).inject(this.processSelect);t.id==e&&(i.selected=!0)}.bind(this))}.bind(this)),this.processSelect.addEvent("change",function(t){var e=this.getSelectProcess();this.saveProcess(e.id,e.name)}.bind(this)))},getSelectProcess:function(){var t;return this.processSelect&&this.processSelect.getElements("option").each(function(e){e.selected&&(t={id:e.value,name:e.text})}.bind(this)),t},setProcess:function(t){var e=!0;this.processSelect&&this.processSelect.getElements("option").each(function(i){e&&i.value==t&&(i.selected=!0,e=!1)}.bind(this))},setContentHeight:function(){var t=this.node.getSize(),e=this.propertyTitleBar.getSize(),i=t.y-e.y;this.contentNode.setStyle("height",i+"px")},createPropertyContentNode:function(){this.propertyContentNode=new Element("div",{styles:{overflow:"hidden"}}).inject(this.contentAreaNode);var t="<table cellspacing='0' cellpadding='0' border='0' width='95%' align='center'>";t+="<tr><td class='formTitle'>"+this.app.lp.category.idLabel+"</td><td id='formCategoryId' class='formValue'>"+this.category.data.id+"</td></tr>",t+="<tr><td class='formTitle'>"+this.app.lp.category.aliasLabel+"</td><td id='formCategoryAlias' class='formValue'></td></tr>",t+="<tr><td class='formTitle'>"+this.app.lp.category.documentType+"</td><td id='formCategoryType' class='formValue'></td></tr>",t+="<tr><td class='formTitle'>"+this.app.lp.category.excelImportView+"</td><td class='formValue'><div id='formImportViewId' style='cursor:pointer;width:90%;min-height:22px;overflow:hidden;border:1px solid #ccc;border-radius: 3px;'></div></td></td></tr>",t+="</table>",this.propertyContentNode.set("html",t),this.propertyContentNode.getElements("td.formTitle").setStyles(this.app.css.propertyBaseContentTdTitle),this.propertyContentNode.getElements("td.formValue").setStyles(this.app.css.propertyBaseContentTdValue),this.aliasInput=new MWF.xApplication.cms.ColumnManager.Input(this.propertyContentNode.getElement("#formCategoryAlias"),this.category.data.categoryAlias,this.category.css.formInput),this.aliasInput.editMode(),this.aliasInput.input.addEvent("change",function(t){this.category.setCategoryAlias(t.target.get("value"))}.bind(this));var e=this.app.lp;this.typeSelect=new MDomItem(this.propertyContentNode.getElement("#formCategoryType"),{type:"select",value:this.category.data.documentType||e.documentTypeSelectValue[0],selectValue:e.documentTypeSelectValue,selectText:e.documentTypeSelectText,event:{change:function(t){this.category.setDocumentType(t.getValue())}.bind(this)}}),this.typeSelect.load();var i=this.category.data.importViewId?[{id:this.category.data.importViewId,name:this.category.data.importViewName,applicationName:this.category.data.importViewAppId}]:[];this.importViewIdSelect=new MDomItem(this.propertyContentNode.getElement("#formImportViewId"),{type:"org",orgType:"QueryView",style:{width:"100%","min-height":"22px"},orgWidgetOptions:{canRemove:!1},value:i,event:{change:function(t){t.orgObject&&t.orgObject.length>0?(this.category.data.importViewId=t.orgObject[0].data.id,this.category.data.importViewName=t.orgObject[0].data.name,this.category.data.importViewAppId=t.orgObject[0].data.applicationName,this.category.setImportView(t.orgObject[0].data.id,t.orgObject[0].data.applicationName)):(this.category.data.importViewId="",this.category.data.importViewName="",this.category.data.importViewAppId="",this.category.setImportView("",""))}.bind(this)}},null,this.app),this.importViewIdSelect.load()}}),MWF.xDesktop.requireApp("Template","MTooltips",null,!1),MWF.xApplication.cms.ColumnManager.CategoryExplorer.ViewTooltip=new Class({Extends:MTooltips,_loadCustom:function(t){t&&t()},_getHtml:function(){var t=this.data,e="font-size:12px;color:#333",i="font-size:12px;color:#666;padding-right:20px",s=MWF.xApplication.cms.ColumnManager.LP;if("list"==t.type)var o="<table width='100%' bordr='0' cellpadding='7' cellspacing='0' style='margin:13px 13px 13px 13px;'><tr><td style='"+e+";' width='70'>"+s.type+":</td>    <td style='"+i+";'>"+s.list+"</td></tr><tr><td style='"+e+";' width='70'>"+s.listName+":</td>    <td style='"+i+";'>"+t.name+"</td></tr><tr><td style='"+e+"'>"+s.relativeForm+":</td>    <td style='"+i+"'>"+(t.formName||"")+"</td></tr><tr><td style='"+e+"'>"+s.alias+":</td>    <td style='"+i+"'>"+(t.alias||"")+"</td></tr></table>";else o="<table width='100%' bordr='0' cellpadding='7' cellspacing='0' style='margin:13px 13px 13px 13px;'><tr><td style='"+e+";' width='70'>"+s.type+":</td>    <td style='"+i+";'>"+s.dataView+"</td></tr><tr><td style='"+e+";' width='70'>"+s.viewName+":</td>    <td style='"+i+";'>"+t.name+"</td></tr><tr><td style='"+e+"'>"+s.column+":</td>    <td style='"+i+"'>"+(t.appName||"")+"</td></tr><tr><td style='"+e+"'>"+s.alias+":</td>    <td style='"+i+"'>"+(t.alias||"")+"</td></tr></table>";return o}});