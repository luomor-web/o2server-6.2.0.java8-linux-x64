MWF.xApplication.HotArticle=MWF.xApplication.HotArticle||{},MWF.require("MWF.widget.O2Identity",null,!1),MWF.xDesktop.requireApp("Template","Explorer",null,!1),MWF.xApplication.HotArticle.options={multitask:!1,executable:!0},MWF.xApplication.HotArticle.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"HotArticle",icon:"icon.png",width:"1220",height:"700",isResize:!0,isMax:!0,title:MWF.xApplication.HotArticle.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.HotArticle.LP},loadApplication:function(t){this.userName=layout.desktop.session.user.distinguishedName,this.restActions=MWF.Actions.get("x_hotpic_assemble_control"),this.path="../x_component_HotArticle/$Main/"+this.options.style+"/",this.createNode(),this.loadApplicationContent()},loadController:function(t){t&&t()},reload:function(){this.clearContent(),this.explorer?this.openSetting(this.explorer.currentNaviItem.retrieve("index")):this.loadApplicationLayout()},isAdmin:function(){return this.access.isAdmin()},createNode:function(){this.content.setStyle("overflow","hidden"),this.node=new Element("div",{styles:this.css.node}).inject(this.content)},loadApplicationContent:function(){this.loadController(function(){this.loadApplicationLayout()}.bind(this))},loadApplicationLayout:function(){this.contentContainerNode=new Element("div.contentContainerNode",{styles:this.css.contentContainerNode}).inject(this.node),this.createTopNode(),this.createContainerNode()},createTopNode:function(){this.topContainerNode=new Element("div.topContainerNode",{styles:this.css.topContainerNode}).inject(this.contentContainerNode),this.topNode=new Element("div.topNode",{styles:this.css.topNode}).inject(this.topContainerNode),this.topIconNode=new Element("div",{styles:this.css.topIconNode}).inject(this.topNode),this.topTextNode=new Element("div",{styles:this.css.topTextNode,text:this.options.title}).inject(this.topNode),this.topContentNode=new Element("div",{styles:this.css.topContentNode}).inject(this.topNode)},createContainerNode:function(){this.createContent()},createContent:function(){this.middleNode=new Element("div.middleNode",{styles:this.css.middleNode}).inject(this.contentContainerNode),this.contentNode=new Element("div.contentNode",{styles:this.css.contentNode}).inject(this.middleNode),this.createView(),this.setContentSizeFun=this.setContentSize.bind(this),this.addEvent("resize",this.setContentSizeFun),this.setContentSize()},setContentSize:function(){var t=this.topNode?this.topNode.getSize():{x:0,y:0},e=this.node.getSize(),i=this.viewContainerNode.getStyle("padding-top").toFloat(),o=this.viewContainerNode.getStyle("padding-bottom").toFloat(),n=e.y-t.y-i-o;this.viewContainerNode.setStyle("height",n+"px")},createView:function(){var t=this.viewContainerNode=new Element("div.viewContainerNode",{styles:this.css.viewContainerNode}).inject(this.contentNode);new MWF.xApplication.HotArticle.Main.View(t,this,this,{templateUrl:this.path+"listItem.json",scrollEnable:!0},{lp:this.lp}).load()},clearContent:function(){this.explorer&&this.explorer.destroy(),this.explorer=null,this.setContentSizeFun&&this.removeEvent("resize",this.setContentSizeFun),this.scrollBar&&this.scrollBar.scrollVAreaNode&&this.scrollBar.scrollVAreaNode.destroy(),this.scrollBar&&delete this.scrollBar,this.contentContainerNode&&this.contentContainerNode.destroy()},openCategory:function(t){var e="HotArticleCategory"+t.id;this.desktop.apps[e]?this.desktop.apps[e].setCurrent():this.desktop.openApplication(null,"HotArticleCategory",{categoryId:t.id,appId:e})},recordStatus:function(){var t={};return this.explorer&&(t={setting:!0,index:this.explorer.currentNaviItem.retrieve("index")}),t}}),MWF.xApplication.HotArticle.Main.View=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t,e){return new MWF.xApplication.HotArticle.Main.Document(this.viewNode,t,this.explorer,this,null,e)},_getCurrentPageData:function(t,e,i){e||(e=9),i?this.pageNum=i:i=this.pageNum?this.pageNum=this.pageNum+1:this.pageNum=1,this.getPictureUrlHost();var o=this.filterData||{};this.actions.listHotPicFilterPage(i,e,o,function(e){e.data||(e.data=[]),e.count||(e.count=0),t&&t(e)}.bind(this))},_removeDocument:function(t,e){this.actions.removeHotPic(t.id,function(t){this.pageNum=0,this.reload(),this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_openDocument:function(t){},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){},getPictureUrlHost:function(){var t=layout.serviceAddressList.x_hotpic_assemble_control;this.pictureUrlHost="http://"+t.host+(80!=t.port?":"+t.port+"/":"/")}}),MWF.xApplication.HotArticle.Main.Document=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,mouseoverDocument:function(t,e){var i=t.getElements("[styles='removeNode']")[0];i&&i.setStyle("opacity",1)},mouseoutDocument:function(t,e){var i=t.getElements("[styles='removeNode']")[0];i&&i.setStyle("opacity",0)},_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){},getRemovePermission:function(t){return this.app.userName==t.creator||!!MWF.AC.isHotPictureManager()},open:function(){var t=this.data;if("BBS"==t.application){var e="ForumDocument"+t.infoId;this.app.desktop.apps[e]?this.app.desktop.apps[e].setCurrent():this.app.desktop.openApplication(null,"ForumDocument",{id:t.infoId,appId:e,isEdited:!1,isNew:!1})}else{e="cms.Document"+t.infoId;this.app.desktop.apps[e]?this.app.desktop.apps[e].setCurrent():this.app.desktop.openApplication(null,"cms.Document",{documentId:t.infoId,appId:e,readonly:!0})}}});var getDateDiff=function(t){if(!t)return"";var e=Date.parse(t.replace(/-/gi,"/")),i=864e5,o=(new Date).getTime()-e,n=(new Date).decrement("day",1),s=(new Date).decrement("day",2),a=o/31104e6,r=o/2592e6,l=o/(7*i),c=o/i,p=o/36e5,d=o/6e4;return n.getFullYear()==e.getFullYear()&&n.getMonth()==e.getMonth()&&n.getDate()==e.getDate()?result=MWF.xApplication.HotArticle.LP.yesterday+" "+e.getHours()+":"+e.getMinutes():s.getFullYear()==e.getFullYear()&&s.getMonth()==e.getMonth()&&s.getDate()==e.getDate()?result=MWF.xApplication.HotArticle.LP.twoDaysAgo+" "+e.getHours()+":"+e.getMinutes():result=a>1||r>=1?e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate():l>=1?parseInt(l)+MWF.xApplication.HotArticle.LP.weekAgo:c>=1?parseInt(c)+MWF.xApplication.HotArticle.LP.dayAgo:p>=1?parseInt(p)+MWF.xApplication.HotArticle.LP.hourAgo:d>=1?parseInt(d)+MWF.xApplication.HotArticle.LP.minuteAgo:MWF.xApplication.HotArticle.LP.publishJustNow,result};