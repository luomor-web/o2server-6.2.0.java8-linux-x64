MWF.xApplication.Profile.options.multitask=!1,MWF.xApplication.Profile.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"newVersion",name:"Profile",icon:"icon.png",width:"1100",height:"820",isResize:!1,isMax:!1,mvcStyle:"style.css",title:MWF.xApplication.Profile.LP.title},_loadCss:function(){},loadCss:function(e,t){var o=e&&"string"===typeOf(e)?e:"style.css",i=e&&"function"===typeOf(e)?e:t,s=this.path+this.options.style+"/"+o;this.content.loadCss(s,i)},onQueryLoad:function(){this.lp=MWF.xApplication.Profile.LP,this.action=MWF.Actions.get("x_organization_assemble_personal"),MWF.xDesktop.requireApp("Profile","Common",null,!1)},loadApplication:function(e){this.action.getPerson(function(e){this.personData=e.data,this.personData.personIcon=this.action.getPersonIcon(),this.content.loadHtml(this.path+this.options.style+"/"+(this.inBrowser||"Default"==layout.viewMode?"viewBrowser":"view")+".html",{bind:{data:this.personData,lp:this.lp},module:this},function(){this.loadContent()}.bind(this))}.bind(this)),e&&e()},loadContent:function(){var e=this.content.getElements(".o2_profile_configNode");this.contentNode=this.content.getElement(".o2_profile_contentNode"),MWF.require("MWF.widget.Tab",function(){this.tab=new MWF.widget.Tab(this.contentNode,{style:"profileV2"}),this.tab.load(),e.each(function(e){this.tab.addTab(e,e.get("title"))}.bind(this)),this.contentNode.getElement("[name=MWFcontentNodeContainer]").setStyles({height:"calc(100% - 50px)",overflow:"auto"}),this.tab.pages.map(function(e){var t=e.tabNode;t.addEvent("click",function(){this.addClass("mainColor_border"),this.getChildren().addClass("mainColor_color"),this.getSiblings().removeClass("mainColor_border"),this.getSiblings().map((function(e){e.getChildren().removeClass("mainColor_color")}))}.bind(t))}.bind(this)),this.options.tab?(this.tab.pages[this.options.tab].showIm(),this.tab.pages[this.options.tab].tabNode.addClass("mainColor_border"),this.tab.pages[this.options.tab].textNode.addClass("mainColor_color")):(this.tab.pages[0].showIm(),this.tab.pages[0].tabNode.addClass("mainColor_border"),this.tab.pages[0].textNode.addClass("mainColor_color")),this.loadInforConfigActions(),this.inBrowser||"Layout"!=layout.viewMode||this.loadLayoutConfigActions(),this.loadIdeaConfigActions(),this.loadEmPowerConfigAction(),this.loadPasswordConfigActions(),this.loadSSOConfigAction()}.bind(this))},openFaceSet:function(){layout.openApplication(null,"FaceSet")},loadInforConfigActions:function(){this.contentImgNode=this.content.getElement(".o2_profile_inforIconContentImg"),this.content.getElement(".o2_profile_inforIconChange").addClass("mainColor_color mainColor_border").addEvent("click",function(){this.changeIcon()}.bind(this));var e=this.tab.pages[0].contentNode.getElements("input");e.addEvent("focus",(function(){this.addClass("mainColor_border mainColor_color")})).addEvent("blur",(function(){this.removeClass("mainColor_border mainColor_color")})),this.mailInputNode=e[0],this.mobileInputNode=e[1],this.officePhoneInputNode=e[2],this.weixinInputNode=e[3],this.qqInputNode=e[4],this.ipAddressInputNode=e[5],this.signatureInputNode=this.tab.pages[0].contentNode.getElement("textarea"),this.signatureInputNode.addEvent("focus",(function(){this.addClass("mainColor_border mainColor_color")})).addEvent("blur",(function(){this.removeClass("mainColor_border mainColor_color")})),this.languageSelectNode=this.tab.pages[0].contentNode.getElement("select"),this.languageSelectNode.empty(),this.personData.language||(this.personData.language="zh-cn"),Object.keys(this.lp.lps).each(function(e){var t=new Element("option",{value:e,text:this.lp.lps[e]}).inject(this.languageSelectNode);this.personData.language===e&&t.set("selected",!0)}.bind(this)),this.content.getElement(".o2_profile_saveInforAction").addEvent("click",function(){this.savePersonInfor()}.bind(this))},loadLayoutConfigActions:function(){var e=this.tab.pages[1].contentNode.getElements(".o2_profile_layoutClearDataAction");this.clearDataAction=e[0],this.defaultDataAction=e.length>1?e[1]:null,this.clearDefaultDataAction=e.length>2?e[2]:null,this.forceDataAction=e.length>3?e[3]:null,this.deleteForceDataAction=e.length>4?e[4]:null,this.clearDataAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){MWF.UD.deleteData("layout",function(){this.notice(this.lp.clearok,"success"),this.desktop.notRecordStatus=!0}.bind(this))}.bind(this))}.bind(this)),MWF.AC.isAdministrator()&&(this.defaultDataAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){var e=this.lp.setDefaultOk;this.close();var t=layout.desktop.getLayoutStatusData();MWF.UD.putPublicData("defaultLayout",t,function(){MWF.xDesktop.notice("success",{x:"right",y:"top"},e,layout.desktop.desktopNode)}.bind(this))}.bind(this))}.bind(this)),this.clearDefaultDataAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){MWF.UD.deletePublicData("defaultLayout",function(){this.notice(this.lp.clearok,"success"),this.desktop.notRecordStatus=!0}.bind(this))}.bind(this))}.bind(this)),this.forceDataAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){var e=this.lp.setForceOk;this.close();var t=layout.desktop.getLayoutStatusData();MWF.UD.putPublicData("forceLayout",t,function(){MWF.xDesktop.notice("success",{x:"right",y:"top"},e,layout.desktop.desktopNode)}.bind(this))}.bind(this))}.bind(this)),this.deleteForceDataAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){MWF.UD.deletePublicData("forceLayout",function(){this.notice(this.lp.clearok,"success"),this.desktop.notRecordStatus=!0}.bind(this))}.bind(this))}.bind(this)));var t=this.tab.pages[1].contentNode.getLast();this.loadDesktopBackground(t)},loadIdeaConfigActions:function(){var e=this.inBrowser||"Default"==layout.viewMode?1:2;this.ideasArea=this.tab.pages[e].contentNode.setStyle("min-height","500px").getElement("textarea").addEvent("focus",(function(){this.addClass("mainColor_border mainColor_color")})).addEvent("blur",(function(){this.removeClass("mainColor_border mainColor_color")})),this.ideasSaveAction=this.ideasArea.getNext().addEvent("mouseover",(function(){this.addClass("mainColor_bg")})).addEvent("mouseout",(function(){this.removeClass("mainColor_bg")})),this.ideasSaveDefaultAction=this.ideasSaveAction.getNext()||null,MWF.AC.isAdministrator()&&(this.ideasSaveDefaultAction.addEvent("mouseover",(function(){this.addClass("mainColor_bg")})).addEvent("mouseout",(function(){this.removeClass("mainColor_bg")})),this.ideasSaveDefaultAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){var e={};e.ideas=this.ideasArea.get("value").split("\n"),MWF.UD.putPublicData("idea",e,function(){this.notice(this.lp.ideaSaveOk,"success")}.bind(this))}.bind(this))}.bind(this))),MWF.require("MWF.widget.UUID",function(){MWF.UD.getDataJson("idea",function(e){e&&e.ideas&&this.ideasArea.set("value",e.ideas.join("\n"))}.bind(this))}.bind(this)),this.ideasSaveAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){var e={};e.ideas=this.ideasArea.get("value").split("\n"),MWF.UD.putData("idea",e,function(){this.notice(this.lp.ideaSaveOk,"success")}.bind(this))}.bind(this))}.bind(this))},loadEmPowerConfigAction:function(){var e=this.inBrowser||"Default"==layout.viewMode?2:3;this.tab.pages[e].contentNode.setStyle("overflow","auto");var t=this.tab.pages[e].contentNode.getElements("div.o2_profile_emPower_tab");this.emPowerContentNode=this.tab.pages[e].contentNode.getElement("div.o2_profile_emPower_content"),MWF.require("MWF.widget.Tab",function(){this.tabEmpower=new MWF.widget.Tab(this.emPowerContentNode,{style:"empower"}),this.tabEmpower.load(),t.each(function(e){this.tabEmpower.addTab(e,e.get("title"))}.bind(this)),this.tabEmpower.pages.map(function(e){var t=e.tabNode.setStyle("cursor","pointer");t.addEvent("click",function(){this.addClass("mainColor_bg"),this.getSiblings().removeClass("mainColor_bg")}.bind(t))}.bind(this)),this.options.tabEmpower?(this.tabEmpower.pages[this.options.tab].showIm(),this.tabEmpower.pages[this.options.tab].tabNode.addClass("mainColor_bg")):(this.tabEmpower.pages[0].showIm(),this.tabEmpower.pages[0].tabNode.addClass("mainColor_bg"))}.bind(this)),this.loadEmpowerBtn(),this.loadMyEmPower(),this.loadReceiveEmPower(),this.loadMyEmPowerLog(),this.loadReceiveEmPowerLog()},loadEmpowerBtn:function(){var e=new Element("div.o2_profile_emPower_Btnimg"),t=new Element("div.o2_profile_emPower_Btntext"),o=new Element("div.o2_profile_emPower_Add").adopt(e.cloneNode(),t.cloneNode().set("text",this.lp.empower.addEmPower)),i=new Element("div.o2_profile_emPower_WithDraw").adopt(e.cloneNode(),t.cloneNode().set("text",this.lp.empower.withdraw));this.tabEmpower.tabNodeContainerArea.adopt(i,o),this.tabEmpower.tabNodeContainerArea.getElements(".o2_profile_emPower_Add").addEvent("click",function(){var e=new MWF.xApplication.Profile.emPowerPopupForm(null,{},{style:"empower",width:"550",height:layout.desktop.session.user.identityList.length>1?"490":"440",hasTop:!0,hasIcon:!1,hasTopIcon:!1,hasTopContent:!1,draggable:!0,maxAction:!0,closeAction:!0,isFull:!1,startTime:null,endTime:null,isWholeday:!1,title:this.lp.createEmpower,defaultCalendarId:""},{app:this,container:this.content,lp:this.lp,actions:this.action,css:{}});layout.desktop.session.user.identityList.length>=1?e.create():this.notice(this.lp.empower.alert2,"error")}.bind(this)),this.tabEmpower.tabNodeContainerArea.getElements(".o2_profile_emPower_WithDraw").addEvent("click",function(){var e=this.tabEmpower.showPage.contentNode.getElements("td input[name=id]:checked"),t=0;e.forEach(function(e){this.action.deleteEmPower(e.get("value"),function(o){"success"==o.type&&(t+=1),e.getParent().getParent().getParent().destroy()}.bind(this),null,!1)}.bind(this)),0==e.length?this.notice(this.lp.empower.selectEmPower,"error"):e.length&&t==e.length&&this.notice(this.lp.empower.withdrawOk,"success"),1==this.myEmPower.getElements("tr").length&&this.myEmPowerNoDataDiv.setStyle("display","")}.bind(this))},loadMyEmPower:function(){this.myEmPower=this.tabEmpower.pages[0].contentNode,this.getAction(function(){this.action.getMyEmPower(function(e){var t=e.data;this.getEmPowerTable("myEmPower",t,this.myEmPower)}.bind(this))}.bind(this))},loadReceiveEmPower:function(){this.receiveEmPower=this.tabEmpower.pages[1].contentNode,this.getAction(function(){this.action.getReceiveEmPower(function(e){var t=e.data;this.getEmPowerTable("receiveEmPower",t,this.receiveEmPower)}.bind(this))}.bind(this))},loadMyEmPowerLog:function(){this.myEmPowerLog=this.tabEmpower.pages[2].contentNode,this.getEmPowerLogTable("myEmPowerLog","",this.myEmPowerLog)},loadReceiveEmPowerLog:function(){this.receiveEmPowerLog=this.tabEmpower.pages[3].contentNode,this.getEmPowerLogTable("receiveEmPowerLog","",this.receiveEmPowerLog)},getEmPowerLogTable:function(e,t,o){var i=this;new MWF.xApplication.Profile.Common.Content(o,{title:o.get("title"),searchItemList:[],columns:[{width:"30%",title:this.lp.empower.title,field:"subject",formatter:function(e,t){new Element("a",{text:e.title,style:"cursor:pointer"}).inject(t).addEvent("click",(function(t){var o={workId:e.work,appId:"process.Work"+e.work};i.desktop.openApplication(t,"process.Work",o)}))}},"myEmPowerLog"==e?{width:"10%",title:this.lp.empower.toPerson,field:"toPerson",formatter:function(e,t){new Element("div",{text:e.toPerson.split("@")[0]}).inject(t)}}:{width:"10%",title:this.lp.empower.fromPerson,field:"fromPerson",formatter:function(e,t){new Element("div",{text:e.fromPerson.split("@")[0]}).inject(t)}},{width:"15%",title:this.lp.empower.applicationName,field:"applicationName"},{width:"15%",title:this.lp.empower.processName,field:"processName"},{width:"15%",title:this.lp.empower.activityName,field:"activityName"},{width:"15%",title:this.lp.empower.createTime,field:"updateTime"}],opButtonList:[],onBeforeLoadData:function(){i.getAction(function(){"myEmPowerLog"==e?i.action.listWithCurrentPersonPaging(this.options.page,this.options.pageSize,"",function(e){this.dataList=e.data,this.total=e.count}.bind(this),null,!1):i.action.listToCurrentPersonPaging(this.options.page,this.options.pageSize,"",function(e){this.dataList=e.data,this.total=e.count}.bind(this),null,!1)}.bind(this))}}).load(),this[e+"NoDataDiv"]||(this[e+"NoDataDiv"]=new Element("div.o2_profile_emPower_noData").adopt(new Element("img",{src:"../x_component_Profile/$Main/newVersion/icon_wuweituo.png"}),new Element("div",{text:this.lp.noTask})).inject(o.getElement(".profile_common_tableDiv"))),1==o.getElements("tr").length?this[e+"NoDataDiv"].setStyle("display",""):this[e+"NoDataDiv"]&&this[e+"NoDataDiv"].setStyle("display","none")},getEmPowerTable:function(e,t,o){this.emPowerTable=o.getElement("table.emPowerTable"),this.emPowerTable||(this.emPowerTable=new Element("table.emPowerTable",{width:"100%",border:"0",cellpadding:"0",cellspacing:"0"}).inject(o)),this.userName=layout.desktop.session.user.distinguishedName;var i=new Element("tr.first");if("myEmPower"==e){var s=new Element("div.o2_profile_emPower_Btnimg"),n=new Element("div.o2_profile_emPower_Btntext");this.emPowerData={};var a=new Element("label.o2_profile_empower_checkbox").adopt(new Element("input",{name:"allEmpower",id:"allEmpower",type:"checkbox"})).setStyle("float","left").addEvent("click",(function(){this.getElement("input").get("checked")?(this.getParent().getParent().getParent().getElements("input[type=checkbox]").set("checked",!0),this.getParent().getParent().getParent().getElements("label").addClass("o2_profile_empower_checkbox__checked o2_profile_empower_checkbox_checked"),this.getParent().getParent().getParent().getElements("tr").addClass("selected")):(this.getParent().getParent().getParent().getElements("input[type=checkbox]").set("checked",!1),this.getParent().getParent().getParent().getElements("label").removeClass("o2_profile_empower_checkbox__checked o2_profile_empower_checkbox_checked"),this.getParent().getParent().getParent().getElements("tr").removeClass("selected"))}));i.adopt(new Element("th",{width:"16%"}).adopt(a,new Element("div",{text:this.lp.empower.toPerson}).setStyle("float","left")))}else i.adopt(new Element("th",{width:"16%"}).adopt(new Element("div",{text:this.lp.empower.fromPerson})));i.adopt(new Element("th",{width:"7%"}).adopt(new Element("div",{text:this.lp.empower.type}))),i.adopt(new Element("th",{width:"16%"}).adopt(new Element("div",{text:this.lp.empower.applicationName+"/"+this.lp.empower.processName}))),i.adopt(new Element("th",{width:"18%"}).adopt(new Element("div",{text:this.lp.empower.startTime}))),i.adopt(new Element("th",{width:"18%"}).adopt(new Element("div",{text:this.lp.empower.completedTime}))),"myEmPower"==e&&i.adopt(new Element("th",{width:"25%"}).adopt(new Element("div",{text:this.lp.action}))),this.emPowerTable.adopt(i),t.forEach(function(t){var o=new Element("tr"+(t.enable?"":".disabled")),i=new Element("td"),a=new Element("label.o2_profile_empower_checkbox").adopt(new Element("input",{name:"id",value:t.id,type:"checkbox"})).setStyle("float","left").addEvent("click",(function(){this.getElement("input").get("checked")?(this.addClass("o2_profile_empower_checkbox__checked o2_profile_empower_checkbox_checked"),this.getParent().getParent().addClass("selected")):(this.removeClass("o2_profile_empower_checkbox__checked o2_profile_empower_checkbox_checked"),this.getParent().getParent().removeClass("selected"))})),l=[];"myEmPower"==e?(this.emPowerData[t.id]=t,l.push(i.cloneNode().adopt(a,new Element("div",{name:"toPerson",text:t.toPerson.split("@")[0]})))):l.push(i.cloneNode().adopt(new Element("div",{name:"fromPerson",text:t.fromPerson.split("@")[0]}))),l.push(i.cloneNode().adopt(new Element("div",{name:"type",text:this.lp.empower["type_"+t.type]}))),l.push(i.cloneNode().adopt(new Element("div",{name:"typeName",text:t.applicationName||t.processName||("filter"==t.type?JSON.parse(t.filterListData)[0].value:"-")}))),l.push(i.cloneNode().adopt(new Element("div",{name:"startTime",text:t.startTime}))),l.push(i.cloneNode().adopt(new Element("div",{name:"completedTime",text:t.completedTime})));var r=this;if("myEmPower"==e){new Date(t.completedTime),new Date(t.startTime),new Date;var d=t.enable?"o2_profile_emPower_Disable":"o2_profile_emPower_Enable",c=t.enable?r.lp.empower.disable:r.lp.empower.enable,h=new Element("div."+d).adopt(s.cloneNode(),n.cloneNode().set("text",c)).addEvent("click",function(){this.enable=!this.enable,r.action.editEmPower(this.id,this,function(e){this.notice(this.lp.empower.saveOk,e.type),this.content.getElement(".o2_profile_emPower_tab").getElement("table").empty(),this.loadMyEmPower()}.bind(r),null,!1)}.bind(t));l.push(i.cloneNode().setStyles({margin:"auto"}).adopt(new Element("div.o2_profile_emPower_Edit").adopt(s.cloneNode(),n.cloneNode().set("text",this.lp.empower.edit)).addEvent("click",function(e){this.fromPerson=this.fromIdentity,this.toPerson=this.toIdentity,this.startTime=this.startTime,this.endTime=this.completedTime,new MWF.xApplication.Profile.emPowerPopupForm(null,this,{style:"empower",width:"550",height:layout.desktop.session.user.identityList.length>1?"490":"440",hasTop:!0,hasIcon:!1,hasTopIcon:!1,hasTopContent:!1,draggable:!0,maxAction:!0,closeAction:!0,isFull:!1,startTime:null,endTime:null,isWholeday:!1,title:r.lp.empower.editEmpower,configData:{Process:"process"==this.type?[{name:this.processName,id:this.process,editon:this.edition}]:[],Application:"application"==this.type?[{name:this.applicationName,id:this.application}]:[]},defaultCalendarId:""},{app:r,container:r.content,lp:r.lp,actions:r.action,css:{}}).edit()}.bind(t)),h,new Element("div.o2_profile_emPower_WithDraw").adopt(s.cloneNode(),n.cloneNode().set("text",this.lp.empower.withdraw)).set("empowerid",t.id).addEvent("click",(function(){var e=this;r.action.deleteEmPower(e.get("empowerid"),function(t){this.notice(this.lp.empower.withdrawOk,t.type),e.getParent().getParent().destroy()}.bind(r),null,!1)}))))}o.adopt(l),this.emPowerTable.adopt(o)}.bind(this)),this[e+"NoDataDiv"]||(this[e+"NoDataDiv"]=new Element("div.o2_profile_emPower_noData").adopt(new Element("img",{src:"../x_component_Profile/$Main/newVersion/icon_wuweituo.png"}),new Element("div",{text:this.lp.empower.noData}),"myEmPower"==e?new Element("div.o2_profile_emPower_Add.mainColor_color",{text:this.lp.createAuthorize}).addEvent("click",function(){var e=new MWF.xApplication.Profile.emPowerPopupForm(null,{},{style:"empower",width:"550",height:layout.desktop.session.user.identityList.length>1?"490":"440",hasTop:!0,hasIcon:!1,hasTopIcon:!1,hasTopContent:!1,draggable:!0,maxAction:!0,closeAction:!0,isFull:!1,startTime:null,endTime:null,isWholeday:!1,title:this.lp.createEmpower,defaultCalendarId:""},{app:this,container:this.content,lp:this.lp,actions:this.action,css:{}});layout.desktop.session.user.identityList.length>=1?e.create():this.notice(this.lp.empower.alert2,"error")}.bind(this)):"").inject(o)),1==this.emPowerTable.getElements("tr").length?this[e+"NoDataDiv"].setStyle("display",""):this[e+"NoDataDiv"]&&this[e+"NoDataDiv"].setStyle("display","none")},loadPasswordConfigActions:function(){var e=this.inBrowser||"Default"==layout.viewMode?3:4,t=this.tab.pages[e].contentNode.setStyle("min-height","300px").getElements("input");this.oldPasswordInputNode=t[0],this.passwordInputNode=t[1],this.morePasswordInputNode=t[2],this.savePasswordAction=this.tab.pages[e].contentNode.getElement(".o2_profile_savePasswordAction"),this.oldPasswordInputNode.addEvents({blur:function(){this.removeClass("o2_profile_inforContentInput_focus mainColor_border mainColor_color")},focus:function(){this.addClass("o2_profile_inforContentInput_focus mainColor_border mainColor_color")}}),this.passwordInputNode.addEvents({blur:function(){this.removeClass("o2_profile_inforContentInput_focus mainColor_border mainColor_color")},focus:function(){this.addClass("o2_profile_inforContentInput_focus mainColor_border mainColor_color")},keyup:function(){this.checkPassowrdStrength(encodeURIComponent(this.passwordInputNode.get("value")))}.bind(this)}),this.morePasswordInputNode.addEvents({blur:function(){this.removeClass("o2_profile_inforContentInput_focus mainColor_border mainColor_color")},focus:function(){this.addClass("o2_profile_inforContentInput_focus mainColor_border mainColor_color")}}),this.savePasswordAction.addEvent("click",function(){this.changePassword()}.bind(this)).addClass("mainColor_bg")},loadSSOConfigAction:function(){var e=this.inBrowser||"Default"==layout.viewMode?4:5;this.ssoConfigAreaNode=this.tab.pages[e].contentNode.setStyle("min-height","300px").getElement(".o2_profile_ssoConfigArea"),MWF.Actions.get("x_organization_assemble_authentication").listOauthServer(function(e){e.data.each(function(e){new Element("a",{class:"mainColor_color",styles:{"font-size":"14px",display:"block","margin-bottom":"10px"},text:e.displayName,target:"_blank",href:"../x_desktop/oauth.html?oauth="+encodeURIComponent(e.name)+"&redirect=&method=oauthBind"}).inject(this.ssoConfigAreaNode)}.bind(this))}.bind(this))},changeIcon:function(){var e="668",t="510";e=e.toInt(),t=t.toInt();var o=this.content.getSize(),i=(o.x-e)/2,s=(o.y-t)/2;i<0&&(i=0),s<0&&(s=0),layout.mobile&&(i=20,s=0);var n=this;MWF.require("MWF.xDesktop.Dialog",function(){MWF.require("MWF.widget.ImageClipper",function(){var o=new MWF.xDesktop.Dialog({title:this.lp.changePersonIcon,style:"image",top:s,left:i-20,fromTop:s,fromLeft:i-20,width:e,height:t,html:"<div></div>",maskNode:this.content,container:this.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){n.image.uploadImage(function(e){n.action.getPerson(function(e){e.data&&(this.personData=e.data,n.contentImgNode.set("src",n.action.getPersonIcon())),this.close()}.bind(this))}.bind(this),null)}},{text:MWF.LP.process.button.cancel,action:function(){n.image=null,this.close()}}]});o.show(),this.image=new MWF.widget.ImageClipper(o.content.getFirst(),{aspectRatio:1,description:"",imageUrl:this.action.getPersonIcon(),resetEnable:!1,data:null,parameter:null,action:this.action.action,method:"changeIcon"}),this.image.load()}.bind(this))}.bind(this))},uploadPersonIcon:function(){this.image&&this.image.getResizedImage()&&this.action.changeIcon(function(){this.action.getPerson(function(e){e.data&&(this.personData=e.data,this.contentImgNode.set("src",this.action.getPersonIcon()))}.bind(this))}.bind(this),null,this.image.getFormData(),this.image.resizedImage)},savePersonInfor:function(){this.personData.officePhone=this.officePhoneInputNode.get("value"),this.personData.mail=this.mailInputNode.get("value"),this.personData.mobile=this.mobileInputNode.get("value"),this.personData.weixin=this.weixinInputNode.get("value"),this.personData.qq=this.qqInputNode.get("value"),this.personData.ipAddress=this.ipAddressInputNode.get("value"),this.personData.signature=this.signatureInputNode.get("value"),this.personData.language=this.languageSelectNode.options[this.languageSelectNode.selectedIndex].value,this.action.updatePerson(this.personData,function(){this.notice(this.lp.saveInforOk,"success"),localStorage.setItem("o2.language",this.personData.language)}.bind(this))},loadDesktopBackground:function(e){var t=layout.desktop.options.style;MWF.UD.getDataJson("layoutDesktop",function(e){e&&(t=e.src)}.bind(this),!1),MWF.getJSON(layout.desktop.path+"styles.json",function(o){o.each(function(o){var i=MWF.defaultPath+"/xDesktop/$Layout/"+o.style+"/preview.jpg",s=new Element("div.o2_profile_previewBackground").inject(e);t==o.style&&(new Element("img.icon",{src:"../x_component_Profile/$Main/newVersion/icon_ok2_click_copy_2.png"}).inject(s),s.addClass("profile_previewBackground_current")),new Element("img",{src:i}).inject(s),s.store("dskimg",o.style);var n=this;s.addEvent("click",(function(){n.selectDesktopImg(this,e)}))}.bind(this))}.bind(this))},selectDesktopImg:function(e,t){var o=e.retrieve("dskimg");MWF.UD.putData("layoutDesktop",{src:o},function(){t.getChildren().each(function(e){e.removeClass("profile_previewBackground_current"),e.getElement(".icon")&&e.getElement(".icon").destroy()}.bind(this)),new Element("img.icon",{src:"../x_component_Profile/$Main/newVersion/icon_ok2_click_copy_2.png"}).inject(e),e.addClass("profile_previewBackground_current");var i=MWF.defaultPath+"/xDesktop/$Layout/"+o+"/desktop.jpg";layout.desktop.node.setStyle("background-image","url("+i+")")}.bind(this))},changePassword:function(){var e=this.oldPasswordInputNode.get("value"),t=this.passwordInputNode.get("value"),o=this.morePasswordInputNode.get("value"),i=this.contentNode.getElement(".o2_profile_passwordWarmming");if(t!=o)this.notice(this.lp.passwordNotMatch,"error"),this.passwordInputNode.setStyles(this.css.inforContentInputNode_error),this.morePasswordInputNode.setStyles(this.css.inforContentInputNode_error);else if(i)this.notice(i.get("text"),"error");else if(this.action.changePassword(e,t,o,function(){this.oldPasswordInputNode.set("value",""),this.passwordInputNode.set("value",""),this.morePasswordInputNode.set("value",""),this.notice(this.lp.changePasswordOk,"success")}.bind(this)),layout.config.mail){var s="http://"+layout.config.mail+"//names.nsf?changepassword&password="+encodeURIComponent(e)+"&passwordnew="+encodeURIComponent(t)+"&passwordconfirm="+encodeURIComponent(t),n=new Element("iframe",{styles:{display:"none"}}).inject(this.desktop.desktopNode);n.set("src",s),window.setTimeout(function(){n.destroy()}.bind(this),2e3)}},getAction:function(e){this.acrion||(this.action=MWF.Actions.get("x_organization_assemble_personal")),e&&e()},createPasswordStrengthNode:function(){var e=this.passwordRemindContainer,t=new Element("div",{styles:this.css.passwordStrengthNode}).inject(e);this.lowColorNode=new Element("div",{styles:this.css.passwordStrengthColor}).inject(t),this.lowTextNode=new Element("div",{styles:this.css.passwordStrengthText,text:this.lp.weak}).inject(t);var o=new Element("div",{styles:this.css.passwordStrengthNode}).inject(e);this.middleColorNode=new Element("div",{styles:this.css.passwordStrengthColor}).inject(o),this.middleTextNode=new Element("div",{styles:this.css.passwordStrengthText,text:this.lp.middle}).inject(o);var i=new Element("div",{styles:this.css.passwordStrengthNode}).inject(e);this.highColorNode=new Element("div",{styles:this.css.passwordStrengthColor}).inject(i),this.highTextNode=new Element("div",{styles:this.css.passwordStrengthText,text:this.lp.high}).inject(i)},getPasswordLevel:function(e,t){this.getAction(function(){this.action.checkPassword(e,function(e){t&&t(e.data.value)}.bind(this),null,!1)}.bind(this))},getPasswordComplex:function(e){if("string"!=typeof e)return!1;var t=0;e.length<8?t+=5:e.length<=10?t+=10:t+=25;var o=/[a-z]/,i=/[A-Z]/;e.match(o)&&e.match(i)?t+=25:e.match(o)||e.match(i)?t+=10:t+=0;return e.match(/[0-9]{3,}/)?t+=20:e.match(/[0-9]/)?t+=10:t+=0,t},checkPassowrdStrength:function(e){var t=this.inBrowser||"Default"==layout.viewMode?3:4,o=this.tab.pages[t].contentNode.getElement(".o2_profile_passwordStrengthArea"),i=this.tab.pages[t].contentNode.getElement(".o2_profile_passwordRemindNode"),s=o.getElements(".o2_profile_passwordStrengthColor"),n=s[0],a=s[1],l=s[2],r=(s=o.getElements(".o2_profile_passwordStrengthText"))[0],d=s[1],c=s[2];n.removeClass("o2_profile_passwordStrengthColor_low"),a.removeClass("o2_profile_passwordStrengthColor_middle"),l.removeClass("o2_profile_passwordStrengthColor_high"),r.removeClass("o2_profile_passwordStrengthText_current"),d.removeClass("o2_profile_passwordStrengthText_current"),c.removeClass("o2_profile_passwordStrengthText_current"),null==e||""==e||this.getPasswordLevel(e,function(t){if(t)i.addClass("o2_profile_passwordWarmming").set("text",t);else{var o=layout.config.passwordRegexHint||this.lp.paswordRule;i.removeClass("o2_profile_passwordWarmming").set("text",o);var s=this.getPasswordComplex(e);s<=40?(n.addClass("o2_profile_passwordStrengthColor_low"),r.addClass("o2_profile_passwordStrengthText_current")):s<=55?(a.addClass("o2_profile_passwordStrengthColor_middle"),d.addClass("o2_profile_passwordStrengthText_current")):(l.addClass("o2_profile_passwordStrengthColor_high"),c.addClass("o2_profile_passwordStrengthText_current"))}}.bind(this))}}),MWF.xDesktop.requireApp("Template","MPopupForm",null,!1),MWF.xApplication.Profile.emPowerPopupForm=new Class({Extends:MPopupForm,options:{style:"empower",width:"550",height:"440",hasTop:!0,hasIcon:!1,hasTopIcon:!1,hasTopContent:!1,draggable:!0,maxAction:!0,closeAction:!0,isFull:!1,startTime:null,endTime:null,isWholeday:!1,defaultCalendarId:"",onPostCreateBottom:function(){this.formBottomNode.getElement(".formOkActionNode").addClass("mainColor_bg")}},load:function(){this.cssPath="../x_component_Profile/$Main/"+this.options.style+"/css.wcss",this._loadCss(),this.configData=this.options.configData||{},this.lp=this.lp.empower},_createTableContent:function(){this.userName=layout.desktop.session.user.distinguishedName,this.userId=layout.desktop.session.user.id,this.userIdentityList=layout.desktop.session.user.identityList;var e,t,o,i,s,n,a=[],l=[];this.userIdentityList.each((function(e){a.push(e.name+"("+e.unitName+")"),l.push(e.distinguishedName)})),this.data.startTime&&this.data.endTime?(e=this.date="string"==typeOf(this.data.startTime)?Date.parse(this.data.startTime):this.data.startTime,t="string"==typeOf(this.data.endTime)?Date.parse(this.data.endTime):this.data.endTime,o=e.format("%Y-%m-%d"),i=e.format("%H:%M"),s=t.format("%Y-%m-%d"),n=t.format("%H:%M")):(t=(e=this.date=(new Date).increment("hour",1)).clone().increment("hour",1),o=e.format("%Y-%m-%d"),i=e.format("%H")+":00",s=t.format("%Y-%m-%d"),n=t.format("%H")+":00");var r={};this.formTableArea.set("html",this.getHtml()),MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.formTableArea,r,{isEdited:this.isEdited||this.isNew,style:"profile",itemTemplate:{fromPerson:{text:this.lp.fromPerson,type:"select",isEdited:a.length>1,selectText:a,selectValue:l,defaultValue:this.data.fromIdentity||l[0],style:{width:"310px",height:"36px","box-shadow":"rgb(153, 153, 153) 0px 0px 0px","line-height":"36px",background:"#FFFFFF",border:"1px solid #DEDEDE","border-radius":"100px","font-family":"MicrosoftYaHei",padding:"0 5px","font-size":"14px",color:"#666666",margin:"0 0 10px 0"}},toPerson:{text:this.lp.toPerson,type:"org",isEdited:this.isEdited||this.isNew,orgType:["identity"],count:1,orgWidgetOptions:{onLoadedInfor:function(e){}.bind(this)},defaultValue:this.data.toPerson},startDateInput:{text:this.lp.startTime,tType:"date",defaultValue:o,notEmpty:!0},startTimeInput:{tType:"time",defaultValue:i,className:(this.isNew||this.isEdited,"inputTimeUnformatWidth"),disable:r.isAllDayEvent},endDateInput:{text:this.lp.completedTime,tType:"date",defaultValue:s,notEmpty:!0},endTimeInput:{tType:"time",defaultValue:n,className:(this.isNew||this.isEdited,"inputTimeUnformatWidth"),disable:r.isAllDayEvent},type:{text:this.lp.type,type:"radio",selectText:[this.lp.type_all,this.lp.type_application,this.lp.type_process],selectValue:["all","application","process"],defaultValue:this.data.type||"all",event:{click:function(){var e=this.form.getItem("type").getValue();this.formTableArea.getElement("td[item=application]").parentNode.setStyle("display","none"),this.formTableArea.getElement("td[item=process]").parentNode.setStyle("display","none"),"all"==e||this.formTableArea.getElement("td[item="+e+"]").parentNode.setStyle("display","")}.bind(this)}}},onPostLoad:function(){this.formTableArea.getElements("td[item=type] div").forEach((function(e){var t=new Element("label.o2_profile_empower_radio"+(e.getElement("input").get("checked")?".o2_profile_empower_radio__checked.o2_profile_empower_radio_checked":"")).adopt(e.getElement("input")).addEvent("click",(function(){this.getParent().getParent().getElements("label").removeClass("o2_profile_empower_radio__checked o2_profile_empower_radio_checked"),this.addClass("o2_profile_empower_radio__checked o2_profile_empower_radio_checked")}));e.adopt(t,e.getElement("span"))}))}.bind(this)},this.app,this.css),this.form.load()}.bind(this)),this.applicationNode=this.formTableArea.getElement("td[item=application]"),this.selectApplicationNode=new Element("div.selectNode",{width:"30",height:"30"}).inject(this.applicationNode).setStyles(this.css.selectNode).addEvents({hover:function(){this.setStyle("background","url(../x_component_Profile/$Main/newVersion/icon_zengjia_blue2_click.png) center center no-repeat")},blur:function(){this.setStyle("background","url(../x_component_Profile/$Main/newVersion/icon_zengjia_blue2.png) center center no-repeat")}}),this.showApplicationNode=new Element("div.showNode",{width:"200",height:"30"}).inject(this.applicationNode).setStyles(this.css.showNode),this.createApplicationSelect(this.showApplicationNode,this.selectApplicationNode,"Application"),this.processNode=this.formTableArea.getElement("td[item=process]"),this.selectProcessNode=new Element("div.selectNode",{width:"30",height:"30"}).inject(this.processNode).setStyles(this.css.selectNode),this.showProcessNode=new Element("div.showNode",{width:"200",height:"30"}).inject(this.processNode).setStyles(this.css.showNode),this.createApplicationSelect(this.showProcessNode,this.selectProcessNode,"Process")},_ok:function(e,t){var o=[],i={};if(i.fromIdentity=e.fromPerson,i.fromPerson=e.fromPerson.split("@")[0],i.toIdentity=e.toPerson,i.toPerson=e.toPerson.split("@")[0],i.startTime=e.startDateInput+" "+e.startTimeInput+":00",i.completedTime=e.endDateInput+" "+e.endTimeInput+":00",Date.parse(i.completedTime)-Date.parse(i.startTime)<0)this.app.notice(this.lp.startTimeEarlyCompleteTime,"error");else{i.enable=!0,"all"==e.type?(i.type=e.type,o.push(i)):"application"==e.type?this.configData.Application.forEach((function(e){var t=JSON.parse(JSON.stringify(i));t.application=e.id,t.applicationName=e.name,t.applicationAlias=e.alias,t.type="application",o.push(t)})):"process"==e.type&&this.configData.Process.forEach((function(e){var t=JSON.parse(JSON.stringify(i));t.process=e.id,t.processName=e.name,t.processAlias=e.alias,t.edition=e.edition?e.edition:e.id,t.type="process",o.push(t)}));var s=0;if(o.forEach(function(e){this.data.id&&0==s?this.actions.editEmPower(this.data.id,e,function(e){s++}.bind(this),null,!1):this.actions.createEmPower(e,function(e){s++}.bind(this),null,!1)}.bind(this)),o.length||this.app.notice(this.lp.alert1,"error"),s>0)this.container.getElement(".o2_profile_emPower_tab").getElement("table").empty(),this.app.loadMyEmPower();o.length&&s==o.length?(this.app.notice(this.lp.saveOk,"success"),this.close()):s>0&&(this.app.notice(this.lp.saveNotAll,"error"),this.close())}},createApplicationSelect:function(e,t,o){this.configData[o]&&this.configData[o].length?MWF.require("MWF.widget.O2Identity",function(){new MWF.widget.O2Process(this.configData[o][0],e)}.bind(this)):this.configData[o]=[],t.addEvent("click",function(){MWF.xDesktop.requireApp("Selector","package",function(){var t={type:o,values:this.configData[o],count:0,onComplete:function(t){e.empty(),this[o]={},this.configData[o]=[],t.forEach(function(t,i){MWF.require("MWF.widget.O2Identity",function(){new MWF.widget.O2Process(t.data,e);this[o]={name:t.data.name,id:t.data.id,edition:t.data.edition,application:t.data.application,applicationName:t.data.applicationName,alias:t.data.alias},this.configData[o].include(this[o])}.bind(this))}.bind(this))}.bind(this)};new MWF.O2Selector(this.container,t)}.bind(this))}.bind(this))},getHtml:function(){return"<table width='100%' bordr='0' cellpadding='0' cellspacing='0' styles='formTable' id='empowerEditTable'><tr style='display:"+(this.userIdentityList.length>1?"":"none")+"'><td styles='formTableTitleRight' lable='fromPerson'></td>    <td styles='formTableValue' colspan='2'>       <div item='fromPerson'></div>   </td></tr><tr><td styles='formTableTitleRight' lable='toPerson'></td>    <td styles='formTableValue' colspan='2'>       <div item='toPerson'></div>   </td></tr><tr><td styles='formTableTitleRight' width='100' lable='startDateInput'></td>    <td styles='formTableValue' item='startDateInput' width='205'></td>    <td styles='formTableValue' item='startTimeInput'></td></tr><tr><td styles='formTableTitleRight' lable='endDateInput'></td>    <td styles='formTableValue' item='endDateInput'></td>    <td styles='formTableValue' item='endTimeInput'></td></tr><tr><td styles='formTableTitleRight' ></td>    <td styles='formTableValue' item='type' colspan='2'></td></tr><tr style='display:"+("application"==this.data.type?"":"none")+"'><td styles='formTableTitleRight' lable='application'>"+this.lp.application+"</td>    <td styles='formTableValue1' item='application' colspan='2'></td></tr><tr style='display:"+("process"==this.data.type?"":"none")+"'><td styles='formTableTitleRight' lable='process'>"+this.lp.process+"</td>    <td styles='formTableValue1' item='process' colspan='2'></td></tr></table>"}});