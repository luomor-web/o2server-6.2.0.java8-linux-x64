print("远程调用：渠道任务接收拒绝实时接口");var File=Java.type("java.io.File"),Root_Dir_Record="D:"+File.separator+"FTPFile"+File.separator+"ChannelTaskRecorder"+File.separator,recordFile=null,BranchWorkId=null,pw=null;function createRecordFile(){if(null!=BranchWorkId){var e=new(Java.type("java.util.Date")),r=Root_Dir_Record+new java.text.SimpleDateFormat("yyyy").format(e)+File.separator+new java.text.SimpleDateFormat("MM").format(e)+File.separator+new java.text.SimpleDateFormat("dd").format(e)+File.separator+"Res",t=new File(r);if(t.exists()||t.mkdirs()||(print("创建记录文件夹失败："+r),t=null),null!==t){var a=r+File.separator+BranchWorkId+".txt";(recordFile=new File(a)).exists()&&recordFile.delete(),recordFile.createNewFile()?print("创建记录文件:"+a):(print("不能记录文件:"+a),recordFile=null)}}}function printRecorder(e,r){r||print(e),null!=BranchWorkId&&(null===recordFile&&createRecordFile(),null!==recordFile&&(null===pw&&(pw=new java.io.PrintWriter(recordFile,"GBK")),pw.print(e),pw.write(13),pw.write(10)))}function getPureText(e){return null===e||('"'===e.substr(0,1)&&(e=e.substr(1,e.length-1)),'"'===e.substr(e.length-1,1)&&(e=e.substr(0,e.length-1))),e}function getWorkCompltedId(e){var r={filterList:[{logic:"and",path:"branchWorkId",title:"branchWorkId",comparison:"equals",comparisonTitle:"等于",value:e,formatType:"textValue"}]},t=resources.getWebservicesClient().jaxrsPut("x_query_assemble_surface","view/flag/workCompletedByBranch/query/channelTask/execute",JSON.stringify(r)).getAsJsonObject().get("grid");if(t){printRecorder("grid="+t);var a=t.getAsJsonArray();if(a.size()>0){printRecorder("workData="+a);var n=a.get(0);if(n&&null!=n){var o=n.get("data");if(o&&null!=o){var i=o.get("workCompletedId");if(i&&null!=i)return i=getPureText(i.toString())}}}}return null}function setWorkData(e,r,t){var a=getWorkCompltedId(e),n=null;if(null===a)return printRecorder(n="根据Sub_task_id'"+e+"'不能获取文件"),n;printRecorder("根据branchWorkId'"+e+"'获取workCompletedId为"+a),printRecorder("文件URL：../x_desktop/work.html?workcompletedid="+a);var o=resources.getWebservicesClient();try{return o.jaxrsPut("x_processplatform_assemble_surface","data/workcompleted/"+a+"/interfaceResTime",r),o.jaxrsPut("x_processplatform_assemble_surface","data/workcompleted/"+a+"/interfaceResStat",t),printRecorder("branchWorkId='"+e+"' workCompletedId='"+a+"'的工作保存完毕"),null}catch(e){return e.getMessage()}}function init(){var e,r="",t="";try{print("requestText="+requestText);var a=JSON.parse(requestText);print("type of requestJson = "+typeof a),"string"==typeof a&&(a=JSON.parse(a)),t=a.head.sign.Trans_ido;var n=a.body.msg.Sub_task_id;BranchWorkId=n;var o=a.body.msg.Task_state,i=a.body.msg.Time;BranchWorkId&&null!=BranchWorkId&&""!=BranchWorkId&&printRecorder("requestText="+requestText,!0),e=null==(r=setWorkData(n,i,o))?"0000":"8888"}catch(t){e="8888",t.printStackTrace(),null==pw?print(t.getMessage()):printRecorder(t.getMessage()),r=t.getMessage()}finally{var l="成功";"8888"==e&&(l=r||"反馈错误");var s={head:{sign:{service_name:"ChannelTaskRes",Trans_ido:t}},body:{msg:{Response_code:e,Response_desc:l}}};return null==pw?print("responseText="+JSON.stringify(s)):(printRecorder("responseText="+JSON.stringify(s)),pw.close()),s}}init();