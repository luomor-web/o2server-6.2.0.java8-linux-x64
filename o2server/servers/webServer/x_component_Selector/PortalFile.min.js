MWF.xApplication.Selector=MWF.xApplication.Selector||{},MWF.xDesktop.requireApp("Selector","Process",null,!1),MWF.xApplication.Selector.PortalFile=new Class({Extends:MWF.xApplication.Selector.Process,options:{style:"default",count:0,title:"",values:[],names:[],isImage:!1,accept:[],expand:!1,forceSearchInItem:!0},setInitTitle:function(){this.setOptions({title:MWF.xApplication.Selector.LP.selectFile})},_init:function(){this.selectType="file",this.className="PortalFile"},loadSelectItems:function(t){this.options.isImage&&(this.options.accept=["png","jpg","bmp","gif","jpeg","jpe"]),this.portalAction.listApplication(function(t){t.data.length&&t.data.each(function(t){this.portalAction.listFile(t.id,function(e){var i=e.data;if(this.options.accept&&this.options.accept.length&&(i=i.filter(function(t){var e=t.fileName.substring(t.fileName.lastIndexOf(".")+1,t.fileName.length).toLowerCase();return-1!==this.options.accept.indexOf(e)}.bind(this))),i.length){t.files=i;var n=this._newItemCategory(t,this,this.itemAreaNode);i.each(function(e){e.applicationName=t.name;var i=this._newItem(e,this,n.children);this.items.push(i)}.bind(this))}}.bind(this))}.bind(this))}.bind(this))},close:function(){this.fireEvent("close"),this.node.destroy(),this.container.unmask(),this.maskInterval&&(window.clearInterval(this.maskInterval),this.maskInterval=null),this.selectedItems.each((function(t){t.destroy()})),this.items.each((function(t){t.destroy()})),this.active=!1,MWF.release(this)},_getChildrenItemIds:function(t){return t.files||[]},_newItemCategory:function(t,e,i,n){return new MWF.xApplication.Selector.PortalFile.ItemCategory(t,e,i,n)},_newItemSelected:function(t,e,i){return new MWF.xApplication.Selector.PortalFile.ItemSelected(t,e,i)},_newItem:function(t,e,i,n){return new MWF.xApplication.Selector.PortalFile.Item(t,e,i,n)}}),MWF.xApplication.Selector.PortalFile.Item=new Class({Extends:MWF.xApplication.Selector.Process.Item,_setIcon:function(){this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/default/icon/attr.png)")},loadSubItem:function(){return!1},checkSelectedSingle:function(){this.selector.options.values.filter(function(t,e){return"object"===typeOf(t)?this.data.id===t.id||this.data.name===t.name:"string"===typeOf(t)&&(this.data.id===t||this.data.name===t)}.bind(this)).length&&this.selectedSingle()},checkSelected:function(){var t=this.selector.selectedItems.filter(function(t,e){return t.data.id===this.data.id||t.data.name===this.data.name}.bind(this));t.length&&(t[0].addItem(this),this.selectedItem=t[0],this.setSelected())},setEvent:function(){var t=MWF.xDesktop.getPortalFileUr(this.data.id,this.data.portal);this.data.url=t,this.node.addEvents({mouseover:function(){if(this.overItem(),!this.previewNode){var e=this.data.fileName.substring(this.data.fileName.lastIndexOf(".")+1,this.data.fileName.length).toLowerCase();if(-1!==["png","jpg","bmp","gif","jpeg","jpe"].indexOf(e)){this.previewNode=new Element("div",{styles:this.selector.css.filePreviewNode});new Element("img",{src:t,styles:this.selector.css.filePreviewNode}).inject(this.previewNode);this.tooltip=new mBox.Tooltip({content:this.previewNode,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,position:{y:["center"],x:["right","outside"]},transition:"flyin"})}}}.bind(this),mouseout:function(){this.outItem()}.bind(this),click:function(){this.clickItem()}.bind(this)})},destroy:function(){this.tooltip&&this.tooltip.destroy(),this.node.destroy()}}),MWF.xApplication.Selector.PortalFile.ItemSelected=new Class({Extends:MWF.xApplication.Selector.Process.ItemSelected,_getShowName:function(){return this.data.name},_setIcon:function(){this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/default/icon/attr.png)")},check:function(){if(this.selector.items.length){var t=this.selector.items.filter(function(t,e){return t.data.id===this.data.id||t.data.name===this.data.name}.bind(this));this.items=t,t.length&&t.each(function(t){t.selectedItem=this,t.setSelected()}.bind(this))}},setEvent:function(){var t=MWF.xDesktop.getPortalFileUr(this.data.id,this.data.portal);this.data.url=t,this.node.addEvents({mouseover:function(){if(this.overItem(),!this.previewNode){var e=this.data.fileName.substring(this.data.fileName.lastIndexOf(".")+1,this.data.fileName.length).toLowerCase();if(-1!==["png","jpg","bmp","gif","jpeg","jpe"].indexOf(e)){this.previewNode=new Element("div",{styles:this.selector.css.filePreviewNode}).inject(this.selector.node);new Element("img",{src:t,styles:this.selector.css.filePreviewNode}).inject(this.previewNode);this.tooltip=new mBox.Tooltip({content:this.previewNode,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,position:{y:["center"],x:["left","outside"]},transition:"flyin"})}}}.bind(this),mouseout:function(){this.outItem()}.bind(this),click:function(){this.clickItem()}.bind(this)})},destroy:function(){this.tooltip&&this.tooltip.destroy(),this.node.destroy()}}),MWF.xApplication.Selector.PortalFile.ItemCategory=new Class({Extends:MWF.xApplication.Selector.Process.ItemCategory,_getShowName:function(){return this.data.name},createNode:function(){this.node=new Element("div",{styles:this.selector.css.selectorItemCategory_department}).inject(this.container)},_setIcon:function(){this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/default/icon/applicationicon.png)")},afterLoad:function(){return!0},loadSub:function(t){this.loaded?t&&t():this.selector.portalAction.listFile(this.data.id,function(e){e.data.each(function(t){t.applicationName=this.data.name,t.application=this.data.id;var e=this.selector._newItem(t,this.selector,this.children,this.level+1);this.selector.items.push(e)}.bind(this)),this.loaded=!0,t&&t()}.bind(this),null,this.data.id)},_hasChild:function(){return!0},check:function(){}});