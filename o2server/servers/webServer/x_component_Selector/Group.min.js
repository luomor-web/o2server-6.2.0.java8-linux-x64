MWF.xDesktop.requireApp("Selector","Person",null,!1),MWF.xApplication.Selector.Group=new Class({Extends:MWF.xApplication.Selector.Person,options:{style:"default",count:0,title:"",groups:[],roles:[],values:[],names:[],include:[],selectType:"group"},setInitTitle:function(){this.setOptions({title:MWF.xApplication.Selector.LP.selectGroup})},_init:function(){this.selectType="group",this.className="Group"},checkLoadSelectItems:function(){this.options.include&&this.options.include.length?this.loadInclude():this.options.groups.length||this.options.roles.length?this.loadSelectItemsByCondition():this.loadSelectItems()},loadInclude:function(){this.options.include&&0!==this.options.include.length&&(this.includeGroup=[],this.options.include.each(function(t){var i="object"===typeOf(t)?t.distinguishedName:t;this.orgAction.listGroupByKey(function(t){t.data&&("array"===typeOf(t.data)?t.data:[t.data]).each(function(t){if(!this.isExcluded(t)){this.includeGroup.push(t.distinguishedName);var i=this._newItem(t,this,this.itemAreaNode,1);this.items.push(i)}}.bind(this))}.bind(this),null,i)}.bind(this)))},_listItemByKey:function(t,i,e){(this.options.groups.length||this.options.roles.length)&&(e=this.getLikeKey(e)),this.orgAction.listGroupByKey(function(i){this.includeGroup&&this.includeGroup.length>0&&(i.data=i.data.filter(function(t){return this.includeGroup.contains(t.distinguishedName)}.bind(this))),t&&t.apply(this,[i])}.bind(this),i,e)},_getItem:function(t,i,e,n){this.orgAction.getGroup(function(i){t&&t.apply(this,[i])}.bind(this),i,"string"===typeOf(e)?e:e.distinguishedName,n)},_newItemSelected:function(t,i,e,n){return new MWF.xApplication.Selector.Group.ItemSelected(t,i,e,n)},_listItemByPinyin:function(t,i,e){(this.options.groups.length||this.options.roles.length)&&(e=this.getLikeKey(e)),this.orgAction.listGroupByPinyin(function(i){this.includeGroup&&this.includeGroup.length>0&&(i.data=i.data.filter(function(t){return this.includeGroup.contains(t.distinguishedName)}.bind(this))),t&&t.apply(this,[i])}.bind(this),i,e)},_newItem:function(t,i,e){return new MWF.xApplication.Selector.Group.Item(t,i,e)},_listItemNext:function(t,i,e){this.orgAction.listGroupNext(t,i,function(t){e&&e.apply(this,[t])}.bind(this))},_getChildrenItemIds:function(t){return t.groupList},getLikeKey:function(t){var i=t;if(this.options.groups.length||this.options.roles.length){var e=[];this.options.groups.each(function(t){e.push("object"===typeOf(t)?t.distinguishedName:t)}.bind(this));var n=[];this.options.roles.each(function(t){n.push("object"===typeOf(t)?t.distinguishedName:t)}.bind(this)),i={key:t||"",groupList:e,roleList:n}}return i}}),MWF.xApplication.Selector.Group.Item=new Class({Extends:MWF.xApplication.Selector.Person.Item,_getShowName:function(){return this.data.name},_getTtiteText:function(){return this.data.name},_setIcon:function(){var t=this.selector.options.style;this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/"+t+"/icon/groupicon.png)")},loadSubItem:function(){this.selector.orgAction.listPersonNested(this.data.id,function(t){this.textNode.set("text",this.textNode.get("text")+" ("+t.data.length+")");var i="";t.data.each(function(t){i+=t.name+", "}.bind(this));var e=new Element("div",{styles:{"max-width":"300px"},text:i});Browser.Platform.ios||(this.tooltip=new mBox.Tooltip({content:e,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,transition:"flyin"}))}.bind(this))}}),MWF.xApplication.Selector.Group.ItemSelected=new Class({Extends:MWF.xApplication.Selector.Person.ItemSelected,_getShowName:function(){return this.data.name},_getTtiteText:function(){return this.data.name},_setIcon:function(){var t=this.selector.options.style;this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/"+t+"/icon/groupicon.png)")},loadSubItem:function(){this.selector.orgAction.listPersonNested(this.data.id,function(t){this.textNode.set("text",this.textNode.get("text")+" ("+t.data.length+")");var i="";t.data.each(function(t){i+=t.name+", "}.bind(this));var e=new Element("div",{styles:{"max-width":"300px"},text:i});Browser.Platform.ios||(this.tooltip=new mBox.Tooltip({content:e,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,transition:"flyin"}))}.bind(this))}}),MWF.xApplication.Selector.Group.Filter=new Class({Implements:[Options,Events],options:{style:"default",groups:[],roles:[]},initialize:function(t,i){this.setOptions(i),this.value=t,this.orgAction=MWF.Actions.get("x_organization_assemble_control")},filter:function(t,i){this.value=t;var e=this.value;(this.options.groups.length||this.options.roles.length)&&(e=this.getLikeKey(e)),this.orgAction.listGroupByKey(function(t){data=t.data,i&&i(data)}.bind(this),null,e)},getLikeKey:function(t){var i=t;if(this.options.groups.length||this.options.roles.length){var e=[];this.options.groups.each(function(t){e.push("object"===typeOf(t)?t.distinguishedName:t)}.bind(this));var n=[];this.options.roles.each(function(t){n.push("object"===typeOf(t)?t.distinguishedName:t)}.bind(this)),i={key:t||"",groupList:e,roleList:n}}return i}});