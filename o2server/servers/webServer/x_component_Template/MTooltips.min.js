var MTooltips=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"",axis:"y",position:{x:"auto",y:"auto"},priorityOfAuto:{x:["center","right","left"],y:["middle","bottom","top"]},offset:{x:0,y:0},isFitToContainer:!0,event:"mouseenter",hiddenDelay:200,displayDelay:0,hasArrow:!0,isAutoShow:!0,isAutoHide:!0,hasMask:!0,hasCloseAction:!1,hideByClickBody:!1,overflow:"hidden"},initialize:function(t,i,s,o,e,n){e&&this.setOptions(e),this.container=t,this.target=i,this.targetCoordinates=n,this.app=s,s&&(this.lp=s.lp),this.data=o,this.path="../x_component_Template/$MTooltips/",this.target&&this.setTargetEvents(),this.fireEvent("postInitialize",[this])},setTargetEvents:function(){"click"==this.options.event?this.options.isAutoShow&&(this.targetClickFun=function(t){"display"===this.status?this.hide():this.load(),t.stopPropagation()}.bind(this),this.target.addEvents({mousedown:function(t){t.stopPropagation()},click:this.targetClickFun})):((this.options.isAutoHide||this.options.isAutoShow)&&(this.targetMouseenterFun=function(){this.timer_hide&&clearTimeout(this.timer_hide)}.bind(this),this.target.addEvents({mouseenter:this.targetMouseenterFun})),this.options.isAutoShow&&(this.targetMouseenterFun2=function(){"display"!=this.status&&(this.timer_show=setTimeout(this.load.bind(this),this.options.displayDelay))}.bind(this),this.target.addEvents({mouseenter:this.targetMouseenterFun2})),(this.options.isAutoHide||this.options.isAutoShow)&&(this.targetMouseleaveFun=function(){this.timer_show&&clearTimeout(this.timer_show)}.bind(this),this.target.addEvents({mouseleave:this.targetMouseleaveFun})),this.options.isAutoHide&&(this.targetMouseleaveFun2=function(){"display"==this.status&&(this.timer_hide=setTimeout(this.hide.bind(this),this.options.hiddenDelay))}.bind(this),this.target.addEvents({mouseleave:this.targetMouseleaveFun2})))},load:function(){this.fireEvent("queryLoad",[this]),this.isEnable()&&(this.node?this.show():this.create(),"click"==this.options.event&&(this.options.isAutoHide&&(this.options.hasMask||(this.containerMousedownFun=function(t){"display"===this.status&&this.hide(),t.stopPropagation()}.bind(this),this.container.addEvent("mousedown",this.containerMousedownFun),this.node.addEvent("mousedown",(function(t){t.stopPropagation()})))),this.options.hideByClickBody&&(this.bodyMousedownFun=function(t){"display"===this.status&&this.hide(),t.stopPropagation()}.bind(this),$(document.body).addEvent("mousedown",this.bodyMousedownFun),this.node.addEvent("mousedown",(function(t){t.stopPropagation()}))))),this.fireEvent("postLoad",[this])},hide:function(){this.node&&(this.node.setStyle("display","none"),this.status="hidden",this.maskNode&&this.maskNode.setStyle("display","none"),this.containerMousedownFun&&(this.container.removeEvent("mousedown",this.containerMousedownFun),this.containerMousedownFun=null),this.fireEvent("hide",[this]))},show:function(){this.status="display",this.maskNode&&this.maskNode.setStyle("display",""),this.node.setStyle("display",""),this.setCoondinates(),this.fireEvent("show",[this])},create:function(){this.status="display",this.fireEvent("queryCreate",[this]),this.loadStyle(),this.fireEvent("loadStyle",[this]),this.node=new Element("div.tooltipNode",{styles:this.nodeStyles}).inject(this.container),this.contentNode?this.contentNode.inject(this.node):(this.contentNode=new Element("div",{styles:this.contentStyles}).inject(this.node),this.contentNode.set("html",this._getHtml())),this._customNode(this.node,this.contentNode),this.options.hasArrow&&(this.arrowNode=new Element("div.arrowNode",{styles:this.arrowStyles}).inject(this.node)),this.options.hasCloseAction&&(this.closeActionNode=new Element("div",{styles:this.closeActionStyles,events:{click:function(){this.hide()}.bind(this)}}).inject(this.node)),this._loadCustom(function(){this.setCoondinates()}.bind(this)),"click"==this.options.event?this.options.isAutoHide&&(this.options.hasMask&&(this.maskNode=new Element("div.maskNode",{styles:this.maskStyles,events:{mouseover:function(t){t.stopPropagation()},mouseout:function(t){t.stopPropagation()},click:function(t){this.hide(),t.stopPropagation()}.bind(this)}}).inject(this.node,"before")),this.app&&(this.hideFun_resize=this.hide.bind(this),this.app.addEvent("resize",this.hideFun_resize))):((this.options.isAutoHide||this.options.isAutoShow)&&this.node.addEvents({mouseenter:function(){this.timer_hide&&clearTimeout(this.timer_hide)}.bind(this)}),this.options.isAutoHide&&this.node.addEvents({mouseleave:function(){this.timer_hide=setTimeout(this.hide.bind(this),this.options.hiddenDelay)}.bind(this)})),this.fireEvent("postCreate",[this])},loadStyle:function(){this.options.style&&(this.cssPath=this.path+this.options.style+"/css.wcss",this._loadCss()),this.nodeStyles={"font-size":"12px",position:"absolute","max-width":"500px","min-width":"260px","z-index":"11","background-color":"#fff",padding:"10px","border-radius":"8px","box-shadow":"0 0 18px 0 #999999","-webkit-user-select":"text","-moz-user-select":"text"},this.options.nodeStyles?this.nodeStyles=Object.merge(this.nodeStyles,this.options.nodeStyles):this.css&&this.css.nodeStyles&&(this.nodeStyles=this.css.nodeStyles),this.css&&this.css.contentStyles?this.contentStyles=this.css.contentStyles:this.contentStyles={width:"100%",height:"100%"},this.options.hasArrow&&(this.css&&this.css.arrowStyles?this.arrowStyles=this.css.arrowStyles:this.arrowStyles={width:"x"==this.options.axis?"9px":"17px",height:"x"==this.options.axis?"17px":"9px",position:"absolute",background:"no-repeat url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAAlCAYAAACgc9J8AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAP9JREFUeNq01oENhCAMBdCWuIgTuP8WOoGj9GhSDaeUfjiuCSEm+iKFVllESGNdVzrPk55xHIfewHnItm1MrVDMG/u+i0aeyWZp3R9CJRaBIWRB5YUHItAL80AEqmI1EIFcrAQ1rwjUxEoQgULsAue+2ayc/W83p5+z6RXggOO1WQGhrsFXP/Oip58tAaQTZ4QMbEbyEB2GCKEBdtpmru4NsC4aHg8PLJ/3lim2xDv02jYDz1kNQsGEQgiYeqAQBPuZQF1jFKqBYTn1RLK1D4+v3E3NGfgNkJlfdKi0XrUZgc1OWyt0Dwz/z37tGhA20s+WR4t+1iBbzTJyaD8CDAB7WgNSzh/AnwAAAABJRU5ErkJggg==)"}),"click"==this.options.event&&this.options.isAutoHide&&(this.css&&this.css.maskStyles?this.maskStyles=this.css.maskStyles:this.maskStyles={width:"100%",height:"100%",opacity:0,position:"absolute","background-color":"#fff",top:"0px",left:"0px"}),this.options.hasCloseAction&&(this.css&&this.css.closeActionStyles?this.closeActionStyles=this.css.closeActionStyles:this.closeActionStyles={width:"24px",height:"24px",position:"absolute",top:"0px",right:"0px",background:"url(../x_component_Template/$MTooltips/default/icon/off_gray.png) no-repeat center center",cursor:"pointer"})},isEnable:function(){return!this.disable},setCoondinates:function(){"x"==this.options.axis?this.setCoondinates_x():this.setCoondinates_y()},setCoondinates_x:function(){var t=this.target?this.target.getCoordinates(this.container):this.targetCoordinates,i=this.node;this.resetWidth&&(i.setStyles({overflow:"visible",width:"auto"}),this.arrowNode&&this.arrowNode.setStyle("display",""),this.resetWidth=!1);var s,o,e,n,h=this.container.getScroll(),r=this.container.getSize(),a=i.getSize(),p="NaN"!==parseFloat(this.options.offset.x).toString()?parseFloat(this.options.offset.x):0;if(p+=this.options.hasArrow?10:0,"left"==this.options.position.x)s=t.left-a.x-p,this.positionX="left",o="right";else if("right"==this.options.position.x)s=t.right+p,this.positionX="right",o="left";else{if((l=this.options.priorityOfAuto)&&l.x)for(var d=0;d<l.x.length;d++){if("left"==l.x[d]&&t.left-h.x>r.x-t.right){s=t.left-a.x-p,this.positionX="left",o="right";break}if("right"==l.x[d]&&r.x+h.x-t.right>a.x){s=t.right+p,this.positionX="right",o="left";break}}s||(t.left-h.x>r.x-t.right?(s=t.left-a.x-p,this.positionX="left",o="right"):(s=t.right+p,this.positionX="right",o="left"))}if("middle"==this.options.position.y)n=t.top+t.height/2-a.y/2,this.positionY="middle",e="middle";else if("top"==this.options.position.y)n=t.bottom-a.y,this.positionY="top",e="bottom";else if("bottom"==this.options.position.y)n=t.top,this.positionY="bottom",e="top";else{var l;if((l=this.options.priorityOfAuto)&&l.y)for(d=0;d<l.y.length;d++){if("middle"==l.y[d]&&t.top+t.height/2-a.y/2>h.y&&t.bottom-t.height/2+a.y/2-h.y<r.y){n=t.top+t.height/2-a.y/2,this.positionY="middle",e="middle";break}if("top"==l.y[d]&&t.top-h.y>r.y-t.bottom){n=t.bottom-a.y,this.positionY="top",e="bottom";break}if("bottom"==l.y[d]&&r.y+h.y-t.bottom>a.y){n=t.top,this.positionY="bottom",e="top";break}}n||(t.top+t.height/2-a.y/2>h.y&&t.bottom-t.height/2+a.y/2-h.y<r.y?(n=t.top+t.height/2-a.y/2,this.positionY="middle",e="middle"):t.top-h.y>r.y-t.bottom?(n=t.bottom-a.y,this.positionY="top",e="bottom"):(n=t.top,this.positionY="bottom",e="top"))}var u=0;if(this.options.isFitToContainer&&(n<h.y?(u=h.y-n,n=h.y):n+a.y>r.y+h.y&&(u=r.y+h.y-n-a.y,n=r.y+h.y-a.y)),"scroll"==this.options.overflow&&(s<0?(i.setStyles({overflow:"auto",width:a.x+s-p}),this.resetWidth=!0,s=0):s+a.x>r.x+h.x&&(i.setStyles({overflow:"auto",width:Math.abs(r.x+h.x-s+p)}),s-=p,this.resetWidth=!0)),this.resetWidth)this.arrowNode&&this.arrowNode.setStyle("display","none");else if(this.options.hasArrow&&this.arrowNode){"left"==o?this.arrowNode.setStyles({left:"-8px",right:"auto","background-position":"0px 0px"}):this.arrowNode.setStyles({left:"auto",right:"-8px","background-position":"-11px 0px"});var y=this.arrowNode.getSize().y/2,c=Math.min(t.height,a.y)/2-y,f=0,g=0;"middle"==e?this.arrowNode.setStyles({top:a.y/2-y-u+"px",bottom:"auto"}):"top"==e?((g=(g=this.node.getStyle("border-top-"+o+"-radius"))?parseInt(g):0)>c&&(f=g-c),this.arrowNode.setStyles({top:c+f-u+"px",bottom:"auto"})):((g=(g=this.node.getStyle("border-bottom-"+o+"-radius"))?parseInt(g):0)>c&&(f=g-c),this.arrowNode.setStyles({top:"auto",bottom:c+f+u+"px"}));var m=n;f&&("top"==e?m-=f:"bottom"==e&&(m+=f))}i.setStyles({left:s,top:m||n}),this.fireEvent("postSetCoondinates",[o,e])},setCoondinates_y:function(){var t=this.target?this.target.getCoordinates(this.container):this.targetCoordinates,i=this.node;this.resetHeight&&(i.setStyles({overflow:"visible",height:"auto"}),this.arrowNode&&this.arrowNode.setStyle("display",""),this.resetHeight=!1);var s,o,e,n,h=this.container.getScroll(),r=this.container.getSize(),a=i.getSize(),p="NaN"!==parseFloat(this.options.offset.y).toString()?parseFloat(this.options.offset.y):0;if(p+=this.options.hasArrow?10:0,"top"==this.options.position.y)s=t.top-a.y-p,this.positionY="top",e="bottom";else if("bottom"==this.options.position.y)s=t.bottom+p,this.positionY="bottom",e="top";else{if((l=this.options.priorityOfAuto)&&l.y)for(var d=0;d<l.y.length;d++){if("top"==l.y[d]&&t.top-h.y>r.y-t.bottom){s=t.top-a.y-p,this.positionY="top",e="bottom";break}if("bottom"==l.y[d]&&r.y+h.y-t.bottom>a.y){s=t.bottom+p,this.positionY="bottom",e="top";break}}s||(t.top-h.y>r.y-t.bottom?(s=t.top-a.y-p,this.positionY="top",e="bottom"):(s=t.bottom+p,this.positionY="bottom",e="top"))}if("center"==this.options.position.x)n=t.left+t.width/2-a.x/2,this.positionX="center",o="center";else if("left"==this.options.position.x)n=t.right-a.x,this.positionX="left",o="right";else if("right"==this.options.position.x)n=t.left,this.positionX="right",o="left";else{var l;if((l=this.options.priorityOfAuto)&&l.x)for(d=0;d<l.x.length;d++){if("center"==l.x[d]&&t.left+t.width/2-a.x/2>h.x&&t.right-t.width/2+a.x/2-h.x<r.x){n=t.left+t.width/2-a.x/2,this.positionX="center",o="center";break}if("left"==l.x[d]&&t.left-h.x>r.x-t.right){n=t.right-a.x,this.positionX="left",o="right";break}if("right"==l.x[d]&&r.x+h.x-t.right>a.x){n=t.left,this.positionX="right",o="left";break}}n||(t.left+t.width/2-a.x/2>h.x&&t.right-t.width/2+a.x/2-h.x<r.x?(n=t.left+t.width/2-a.x/2,this.positionX="center",o="center"):t.left-h.x>r.x-t.right?(n=t.right-a.x,this.positionX="left",o="right"):(n=t.left,this.positionX="right",o="left"))}var u=0;if(this.options.isFitToContainer&&(n<h.x?(u=h.x-n,n=h.x):n+a.x>r.x+h.x&&(u=r.x+h.x-n-a.x,n=r.x+h.x-a.x)),"scroll"==this.options.overflow&&(s<0?(i.setStyles({overflow:"auto",height:a.y+s-p}),this.resetHeight=!0,s=0):s+a.y>r.y+h.y&&(i.setStyles({overflow:"auto",height:Math.abs(r.y+h.y-s+p)}),s-=p,this.resetHeight=!0)),this.resetHeight)this.arrowNode&&this.arrowNode.setStyle("display","none");else if(this.options.hasArrow&&this.arrowNode){"top"==e?this.arrowNode.setStyles({top:"-8px",bottom:"auto","background-position":"0px -18px"}):this.arrowNode.setStyles({top:"auto",bottom:"-8px","background-position":"0px -28px"});var y=this.arrowNode.getSize().x/2,c=Math.min(t.width,a.x)/2-y,f=0,g=0;"center"==o?this.arrowNode.setStyles({left:a.x/2-y-u+"px",right:"auto"}):"left"==o?((g=(g=this.node.getStyle("border-"+e+"-left-radius"))?parseInt(g):0)>c&&(f=g-c),this.arrowNode.setStyles({left:c+f-u+"px",right:"auto"})):((g=(g=this.node.getStyle("border-"+e+"-right-radius"))?parseInt(g):0)>c&&(f=g-c),this.arrowNode.setStyles({left:"auto",right:c+f+u+"px"}));var m=n;f&&("left"==o?m-=f:"right"==o&&(m+=f))}i.setStyles({left:m||n,top:s}),this.fireEvent("postSetCoondinates",[o,e])},setPosition:function(){"x"==this.options.axis?this.setPosition_x():this.setPosition_y()},setPosition_x:function(){var t,i,s=this.target?this.target.getCoordinates(this.container):this.targetCoordinates,o=this.node,e=o.getSize(),n="NaN"!==parseFloat(this.options.offset.x).toString()?parseFloat(this.options.offset.x):0;n+=this.options.hasArrow?10:0,"left"===this.positionX?i=s.left-e.x-n:"bottom"===this.positionX&&(i=s.right+n),"top"===this.positionY?t=s.top-e.y:"bottom"===this.positionY?t=s.bottom:"middle"===this.positionX&&(t=s.top+s.height/2-e.y/2),o.setStyles({left:i,top:t})},setPosition_y:function(){var t,i,s=this.target?this.target.getCoordinates(this.container):this.targetCoordinates,o=this.node,e=o.getSize(),n="NaN"!==parseFloat(this.options.offset.y).toString()?parseFloat(this.options.offset.y):0;n+=this.options.hasArrow?10:0,"top"===this.positionY?t=s.top-e.y-n:"bottom"===this.positionY&&(t=s.bottom+n),"left"===this.positionX?i=s.right-e.x:"right"===this.positionX?i=s.left:"center"===this.positionX&&(i=s.left+s.width/2-e.x/2),o.setStyles({left:i,top:t})},destroy:function(){"click"==this.options.event&&this.app&&this.hideFun_resize&&this.app.removeEvent("resize",this.hideFun_resize),this.targetClickFun&&this.target.removeEvent("click",this.targetClickFun),this.targetMouseenterFun&&this.target.removeEvent("mouseenter",this.targetMouseenterFun),this.targetMouseenterFun2&&this.target.removeEvent("mouseenter",this.targetMouseenterFun2),this.targetMouseleaveFun&&this.target.removeEvent("mouseleave",this.targetMouseleaveFun),this.targetMouseleaveFun2&&this.target.removeEvent("mouseleave",this.targetMouseleaveFun2),this.node&&(this.node.destroy(),this.node=null),this.fireEvent("destroy",[this]),MWF.release(this)},_getHtml:function(){return""},_customNode:function(t,i){this.fireEvent("customContent",[i,t])},_setContent:function(t){this.contentNode=t,this.node&&(this.node.empty(),this.contentNode.inject(this.node))},_loadCustom:function(t){t&&t()}});MWF.xApplication.Template=MWF.xApplication.Template||{},MWF.xApplication.Template.MTooltips=MTooltips;