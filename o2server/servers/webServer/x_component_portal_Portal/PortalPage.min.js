MWF.xApplication.portal.Portal.options.multitask=!0,MWF.xApplication.portal.Portal.Main=new Class({Implements:[Options,Events],options:{portalId:"",pageId:""},onQueryLoad:function(){this.lp=MWF.xApplication.portal.Portal.LP,this.status&&(this.options.portalId=this.status.portalId,this.options.pageId=this.status.pageId,this.options.parameters=this.status.parameters)},loadApplication:function(t){this.node=new Element("div",{styles:this.css.content}).inject(this.content),this.formNode=new Element("div",{styles:{"min-height":"100%","font-size":"14px"}}).inject(this.node),this.action=MWF.Actions.get("x_portal_assemble_surface"),this.options.isRefresh?this.loadPortal(this.options.parameters):this.maxSize(function(){this.loadPortal(this.options.parameters)}.bind(this)),t&&t()},toPortal:function(t,i,o){this.options.portalId=t,this.options.pageId=i,this.appForm&&this.appForm.fireEvent("beforeClose"),Object.keys(this.$events).each(function(t){this.removeEvents(t)}.bind(this)),MWF.release(this.appForm),this.appForm=null,this.formNode.empty(),this.loadPortal(o)},toPage:function(t,i){if(t){var o=layout.mobile?"getPageByNameMobile":"getPageByName";this.action[o](t,this.portal.id,function(t){var o=t.data.data?JSON.decode(MWF.decodeJsonString(t.data.data)):null;o&&(this.options.pageId=t.data.id,this.appForm&&this.appForm.fireEvent("beforeClose"),Object.keys(this.$events).each(function(t){this.removeEvents(t)}.bind(this)),MWF.release(this.appForm),this.appForm=null,this.formNode.empty(),this.page=o,this.openPortal(i))}.bind(this))}else if(this.options.pageId){o=layout.mobile?"getPageByNameMobile":"getPageByName";this.action[o](this.options.pageId,this.portal.id,function(t){var o=t.data.data?JSON.decode(MWF.decodeJsonString(t.data.data)):null;o&&(this.options.pageId=t.data.id,this.appForm&&this.appForm.fireEvent("beforeClose"),Object.keys(this.$events).each(function(t){this.removeEvents(t)}.bind(this)),MWF.release(this.appForm),this.appForm=null,this.formNode.empty(),this.page=o,this.openPortal(i))}.bind(this))}},loadPortal:function(t){this.action.getApplication(this.options.portalId,function(i){this.portal=i.data,this.setTitle(this.portal.name),this.options.pageId||(this.options.pageId=this.portal.firstPage),this.portal.icon&&this.taskitem&&this.taskitem.iconNode.setStyles({"background-image":"url(data:image/png;base64,"+this.portal.icon+")","background-size":"24px 24px"});var o=layout.mobile?"getPageByNameMobile":"getPageByName";this.action[o](this.options.pageId,this.options.portalId,function(i){this.page=i.data.data?JSON.decode(MWF.decodeJsonString(i.data.data)):null,this.openPortal(t)}.bind(this))}.bind(this))},openPortal:function(t){this.page&&MWF.xDesktop.requireApp("process.Xform","Form",function(){this.appForm=new MWF.APPForm(this.formNode,this.page,{macro:"PageContext",parameters:t}),this.appForm.businessData={control:{allowSave:!0},data:{}},this.appForm.workAction=this.action,this.appForm.app=this,this.appForm.load(),this.mask&&this.mask.hide()}.bind(this))},recordStatus:function(){return{portalId:this.options.portalId,pageId:this.options.pageId,parameters:this.options.parameters}},onPostClose:function(){this.appForm&&(this.appForm.modules.each((function(t){MWF.release(t)})),MWF.release(this.appForm))}});