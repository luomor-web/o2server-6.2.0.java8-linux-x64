MWF.xDesktop.requireApp("Attendance","Explorer",null,!1),MWF.xDesktop.requireApp("Selector","package",null,!1),MWF.xApplication.Attendance.PeopleDetail=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(t,e,i,a){this.setOptions(a),this.app=e,this.path="/x_component_Attendance/$PeopleDetail/",this.cssPath="/x_component_Attendance/$PeopleDetail/"+this.options.style+"/css.wcss",this._loadCss(),this.actions=i,this.node=$(t)},load:function(){this.loadTab()},loadTab:function(){this.tabNode=new Element("div",{styles:this.css.tabNode}).inject(this.node),this.detailArea=new Element("div",{styles:this.css.tabPageContainer}).inject(this.tabNode),this.detailStaticArea=new Element("div",{styles:this.css.tabPageContainer}).inject(this.tabNode),MWF.require("MWF.widget.Tab",function(){this.tabs=new MWF.widget.Tab(this.tabNode,{style:"attendance"}),this.tabs.load(),this.detailPage=this.tabs.addTab(this.detailArea,this.app.lp.personAttendanceDetail,!1),this.detailPage.contentNodeArea.set("class","detailPage"),this.detailPage.addEvent("show",function(){this.detailExplorer||(this.detailExplorer=new MWF.xApplication.Attendance.PeopleDetail.Explorer(this.detailArea,this),this.detailExplorer.load())}.bind(this)),this.detailStaticPage=this.tabs.addTab(this.detailStaticArea,this.app.lp.personAttendanceStatic,!1),this.detailStaticPage.contentNodeArea.set("class","detailStaticPage"),this.detailStaticPage.addEvent("show",function(){this.detailStaticExplorer||(this.detailStaticExplorer=new MWF.xApplication.Attendance.PeopleDetail.DetailStaticExplorer(this.detailStaticArea,this),this.detailStaticExplorer.load())}.bind(this)),this.tabs.pages[0].showTab()}.bind(this))}}),MWF.xApplication.Attendance.PeopleDetail.Explorer=new Class({Extends:MWF.xApplication.Attendance.Explorer,Implements:[Options,Events],initialize:function(t,e,i){this.setOptions(i),this.parent=e,this.app=e.app,this.css=e.css,this.path=e.path,this.actions=e.actions,this.node=$(t),this.initData(),this.peopleActions||(this.peopleActions=new MWF.xAction.org.express.RestActions)},initData:function(){this.toolItemNodes=[]},reload:function(){this.node.empty(),this.load()},load:function(){this.loadFilter(),this.loadContentNode(),this.setNodeScroll()},loadFilter:function(){var t=MWF.xApplication.Attendance.LP;this.fileterNode=new Element("div.fileterNode",{styles:this.css.fileterNode}).inject(this.node);this.fileterNode.set("html","<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='filterTable'><tr>    <td styles='filterTableValue' lable='q_empName'></td>    <td styles='filterTableTitle' item='q_empName'></td>    <td styles='filterTableTitle' lable='cycleYear'></td>    <td styles='filterTableValue' item='cycleYear'></td>    <td styles='filterTableTitle' lable='cycleMonth'></td>    <td styles='filterTableValue' item='cycleMonth'></td>    <td styles='filterTableTitle' lable='date'></td>    <td styles='filterTableValue' item='date'></td>    <td styles='filterTableTitle' lable='isAbsent'></td>    <td styles='filterTableValue' item='isAbsent'></td>    <td styles='filterTableTitle' lable='isLate'></td>    <td styles='filterTableValue' item='isLate'></td>    <td styles='filterTableTitle' lable='isLackOfTime'></td>    <td styles='filterTableValue' item='isLackOfTime'></td>    <td styles='filterTableValue' item='action'></td>    <td styles='filterTableValue' item='export'></td></tr></table>"),MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.fileterNode,{},{isEdited:!0,itemTemplate:{q_empName:{text:t.person,type:"org",orgType:"person",notEmpty:!0,style:{"min-width":"100px"}},cycleYear:{text:t.annuaal,type:"select",selectValue:function(){for(var t=[],e=(new Date).getFullYear(),i=0;i<6;i++)t.push(e--);return t},event:{change:function(t,e){var i=this.getDateSelectValue();t.form.getItem("date").resetItemOptions(i,i)}.bind(this)}},cycleMonth:{text:t.months,type:"select",defaultValue:function(){var t=((new Date).getMonth()+1).toString();return 1==t.length?"0"+t:t},selectValue:["","01","02","03","04","05","06","07","08","09","10","11","12"],event:{change:function(t,e){var i=this.getDateSelectValue();t.form.getItem("date").resetItemOptions(i,i)}.bind(this)}},date:{text:t.date,type:"select",selectValue:this.getDateSelectValue.bind(this)},isAbsent:{text:t.absent,type:"select",selectValue:["","true","false"],selectText:t.absendSelectText},isLate:{text:t.late,type:"select",selectValue:["","true","false"],selectText:t.lateSelectText},isLackOfTime:{text:t.lackOfTime,type:"select",selectValue:["","true","false"],selectText:t.truefalseSelectText},action:{value:t.query,type:"button",className:"filterButton",event:{click:function(){var t=this.form.getResult(!0,",",!0,!0,!1);t&&("string"==typeOf(t.isAbsent)&&(t.isAbsent=this.getBoolean(t.isAbsent)),"string"==typeOf(t.isLate)&&(t.isLate=this.getBoolean(t.isLate)),"string"==typeOf(t.isLackOfTime)&&(t.isLackOfTime=this.getBoolean(t.isLackOfTime)),t.date&&""!=t.date&&(t.q_date=t.cycleYear+"-"+t.cycleMonth+"-"+t.date),this.loadView(t))}.bind(this)}},export:{value:t.export,type:"button",className:"filterButton",event:{click:function(){var t=this.form.getResult(!0,",",!0,!0,!1);t&&(t.q_topUnitName||(t.q_topUnitName="0"),t.q_unitName||(t.q_unitName="0"),t.q_empName||(t.q_empName="0"),t.cycleYear||(t.cycleYear="0"),t.cycleMonth||(t.cycleMonth="0"),t.date&&""!=t.date?t.q_date=t.cycleYear+"-"+t.cycleMonth+"-"+t.date:t.q_date="0",t.isAbsent||(t.isAbsent="0"),t.isLackOfTime||(t.isLackOfTime="0"),t.isLate||(t.isLate="0"),this.actions.detailsExportStream(t.q_topUnitName,t.q_unitName,t.q_empName,t.cycleYear,t.cycleMonth,t.q_date,t.isAbsent,t.isLackOfTime,t.isLate,!0))}.bind(this)}}}},this.app,this.css),this.form.load()}.bind(this),!0)},getDateSelectValue:function(){if(this.form)var t=parseInt(this.form.getItem("cycleYear").getValue()),e=parseInt(this.form.getItem("cycleMonth").getValue())-1;else t=(new Date).getFullYear(),e=(new Date).getMonth();var i=new Date(t,e,1),a=[];for(a.push("");i.getMonth()===e;){var n=i.getDate().toString();1==n.length&&(n="0"+n),a.push(n),i.setDate(i.getDate()+1)}return a},getBoolean:function(t){return"true"===t||"false"!==t&&t},loadContentNode:function(){this.elementContentNode=new Element("div",{styles:this.css.elementContentNode}).inject(this.node),this.app.addEvent("resize",function(){this.setContentSize()}.bind(this))},loadView:function(t){this.elementContentNode.empty(),this.view&&delete this.view,this.view=new MWF.xApplication.Attendance.PeopleDetail.View(this.elementContentNode,this.app,this),this.view.filterData=t,this.view.load(),this.setContentSize()},setContentSize:function(){var t=this.parent.tabs?this.parent.tabs.tabNodeContainer.getSize():{x:0,y:0},e=this.fileterNode?this.fileterNode.getSize():{x:0,y:0},i=this.parent.node.getSize(),a=this.elementContentNode.getStyle("padding-top").toFloat(),n=this.elementContentNode.getStyle("padding-bottom").toFloat(),l=i.y-t.y-a-n-e.y-20;this.elementContentNode.setStyle("height",l+"px"),this.pageCount=(l/40).toInt()+5,this.view&&this.view.items.length<this.pageCount&&this.view.loadElementList(this.pageCount-this.view.items.length)}}),MWF.xApplication.Attendance.PeopleDetail.SelfHoliday=new Class({Extends:MWF.xApplication.Attendance.PeopleDetail.Explorer,loadView:function(t){this.elementContentNode.empty(),this.view&&delete this.view,this.view=new MWF.xApplication.Attendance.PeopleDetail.SelfHolidayView(this.elementContentNode,this.app,this),this.view.filterData=t,this.view.load(),this.setContentSize()}}),MWF.xApplication.Attendance.PeopleDetail.DetailStaticExplorer=new Class({Extends:MWF.xApplication.Attendance.PeopleDetail.Explorer,loadFilter:function(){var t=MWF.xApplication.Attendance.LP;this.fileterNode=new Element("div.fileterNode",{styles:this.css.fileterNode}).inject(this.node);this.fileterNode.set("html","<table width='100%' bordr='0' cellpadding='5' cellspacing='0' style='width: 460px;font-size: 14px;color:#666'><tr>    <td styles='filterTableValue' lable='q_empName'></td>    <td styles='filterTableTitle' item='q_empName'></td>    <td styles='filterTableTitle' lable='cycleYear'></td>    <td styles='filterTableValue' item='cycleYear'></td>    <td styles='filterTableTitle' lable='cycleMonth'></td>    <td styles='filterTableValue' item='cycleMonth'></td>    <td styles='filterTableValue' item='action'></td>    <td styles='filterTableValue' item='export'></td></tr></table>"),MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.fileterNode,{},{isEdited:!0,itemTemplate:{q_empName:{text:t.person,type:"org",orgType:"person",notEmpty:!0,style:{"min-width":"100px"}},cycleYear:{text:t.annuaal,type:"select",selectValue:function(){for(var t=[],e=(new Date).getFullYear(),i=0;i<6;i++)t.push(e--);return t}},cycleMonth:{text:t.months,type:"select",defaultValue:function(){var t=((new Date).getMonth()+1).toString();return 1==t.length?"0"+t:t},selectValue:["","01","02","03","04","05","06","07","08","09","10","11","12"]},action:{value:t.query,type:"button",className:"filterButton",event:{click:function(){var t=this.form.getResult(!0,",",!0,!0,!1);t&&this.loadView(t)}.bind(this)}},export:{value:t.export,type:"button",className:"filterButton",event:{click:function(){var t=this.form.getResult(!0,",",!0,!0,!1);t&&this.actions.exportPersonStatisticAttachment(t.q_empName,t.cycleYear,t.cycleMonth,!0)}.bind(this)}}}},this.app,this.css),this.form.load()}.bind(this),!0)},loadView:function(t){this.elementContentNode.empty(),this.view&&delete this.view,this.view=new MWF.xApplication.Attendance.PeopleDetail.DetailStaticView(this.elementContentNode,this.app,this),this.view.filterData=t,this.view.listItemUrl=this.path+"listItem_detailStatic.json",this.view.load(),this.setContentSize()}}),MWF.xApplication.Attendance.PeopleDetail.SelfHolidayStaticExplorer=new Class({Extends:MWF.xApplication.Attendance.PeopleDetail.Explorer,loadView:function(t){this.elementContentNode.empty(),this.view&&delete this.view,this.view=new MWF.xApplication.Attendance.PeopleDetail.SelfHolidayStaticView(this.elementContentNode,this.app,this),this.view.filterData=t,this.view.load(),this.setContentSize()}}),MWF.xApplication.Attendance.PeopleDetail.View=new Class({Extends:MWF.xApplication.Attendance.Explorer.View,_createItem:function(t){return new MWF.xApplication.Attendance.PeopleDetail.Document(this.table,t,this.explorer,this)},_getCurrentPageData:function(t,e){e||(e=20);var i=this.items.length?this.items[this.items.length-1].data.id:"(0)",a=this.filterData||{};a.key=this.sortField||this.sortFieldDefault||"",a.order=this.sortType||this.sortTypeDefault||"",this.actions.listDetailFilterNext(i,e,a,function(e){t&&t(e)}.bind(this))},_removeDocument:function(t,e){},_createDocument:function(){},_openDocument:function(t){}}),MWF.xApplication.Attendance.PeopleDetail.SelfHolidayView=new Class({Extends:MWF.xApplication.Attendance.Explorer.View,_createItem:function(t){return new MWF.xApplication.Attendance.PeopleDetail.SelfHolidayDocument(this.table,t,this.explorer,this)},_getCurrentPageData:function(t,e){var i=this.filterData||{};this.actions.listDetailFilter(i,function(e){t&&t(e)}.bind(this))},_removeDocument:function(t,e){},_createDocument:function(){},_openDocument:function(t){}}),MWF.xApplication.Attendance.PeopleDetail.DetailStaticView=new Class({Extends:MWF.xApplication.Attendance.Explorer.View,_createItem:function(t){return new MWF.xApplication.Attendance.PeopleDetail.DetailStaticDocument(this.table,t,this.explorer,this)},_getCurrentPageData:function(t,e){var i=this.filterData||{};""==i.cycleMonth&&(i.cycleMonth="(0)"),this.actions.listStaticMonthPerson(i.q_empName,i.cycleYear,i.cycleMonth,function(e){var i=e.data;i.sort((function(t,e){return parseInt(e.statisticYear+e.statisticMonth)-parseInt(t.statisticYear+t.statisticMonth)})),e.data=i,t&&t(e)}.bind(this))},_removeDocument:function(t,e){},_createDocument:function(){},_openDocument:function(t){}}),MWF.xApplication.Attendance.PeopleDetail.SelfHolidayStaticView=new Class({Extends:MWF.xApplication.Attendance.Explorer.View,_createItem:function(t){return new MWF.xApplication.Attendance.PeopleDetail.SelfHolidayStaticDocument(this.table,t,this.explorer,this)},_getCurrentPageData:function(t,e){var i=this.filterData||{};this.actions.listPeopleDetailFilter(i,function(e){t&&t(e)}.bind(this))},_removeDocument:function(t,e){},_createDocument:function(){},_openDocument:function(t){}}),MWF.xApplication.Attendance.PeopleDetail.Document=new Class({Extends:MWF.xApplication.Attendance.Explorer.Document}),MWF.xApplication.Attendance.PeopleDetail.SelfHolidayDocument=new Class({Extends:MWF.xApplication.Attendance.Explorer.Document}),MWF.xApplication.Attendance.PeopleDetail.DetailStaticDocument=new Class({Extends:MWF.xApplication.Attendance.Explorer.Document}),MWF.xApplication.Attendance.PeopleDetail.SelfHolidayStaticDocument=new Class({Extends:MWF.xApplication.Attendance.Explorer.Document});