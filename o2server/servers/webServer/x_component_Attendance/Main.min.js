MWF.xApplication.Attendance=MWF.xApplication.Attendance||{},MWF.require("MWF.widget.O2Identity",null,!1),MWF.xDesktop.requireApp("Attendance","Common",null,!1),MWF.xDesktop.requireApp("Template","MDomItem",null,!1),MWF.xApplication.Attendance.options={multitask:!1,executable:!0},MWF.xApplication.Attendance.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{curNaviId:null,style:"default",name:"Attendance",icon:"icon.png",width:"1400",height:"700",isResize:!0,isMax:!0,title:MWF.xApplication.Attendance.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.Attendance.LP},loadApplication:function(t){this.options.isRefresh?this.loadLayout():this.maxSize(function(){this.loadLayout()}.bind(this))},loadLayout:function(){this.manageUnits=[],this.manageTopUnits=[],this.enableType="",this.restActions=MWF.Actions.get("x_attendance_assemble_control"),this.personActions=MWF.Actions.get("x_organization_assemble_personal"),this.orgActions=MWF.Actions.get("x_organization_assemble_express"),this.createNode(),this.loadApplicationContent()},isAdmin:function(){return this.isTopUnitManager()||MWF.AC.isAttendanceManager()||MWF.AC.isAdministrator()},isUnitManager:function(){return this.manageUnits.length>0},isTopUnitManager:function(){return this.manageTopUnits.length>0},getNameFlag:function(t){var e=typeOf(t);if("array"===e){var i=[];return t.each((function(t){i.push("object"===typeOf(t)?t.distinguishedName||t.id||t.unique||t.name:t)})),i}return["object"===e?t.distinguishedName||t.id||t.unique||t.name:t]},loadController:function(t){this.restActions.listPermission(function(e){e.data=e.data||[],e.data.each(function(t){"COMPANY"==t.adminLevel&&t.adminName==layout.desktop.session.user.distinguishedName?this.manageTopUnits.push(t.unitName):"DEPT"==t.adminLevel&&t.adminName==layout.desktop.session.user.distinguishedName&&this.manageUnits.push(t.unitName)}.bind(this)),t&&t(e)}.bind(this))},loadEnableType:function(t){o2.Actions.load("x_attendance_assemble_control").AttendanceSettingAction.enableType(function(e){e.data&&e.data.value&&(this.enableType=e.data.value),t&&t(e)}.bind(this))},createNode:function(){this.content.setStyle("overflow","hidden"),this.node=new Element("div",{styles:{width:"100%",height:"100%",overflow:"hidden"}}).inject(this.content)},loadApplicationContent:function(){this.loadController(function(){this.loadEnableType(function(){this.loaNavi()}.bind(this))}.bind(this))},loaNavi:function(t){this.naviNode=new Element("div.naviNode",{styles:this.css.naviNode}).inject(this.node);var e={id:""};this.status&&(e.id=this.status.id),this.options.curNaviId&&(e.id=this.options.curNaviId),this.navi=new MWF.xApplication.Attendance.Navi(this,this.naviNode,e)},clearContent:function(){this.explorerContent&&(this.explorer&&this.explorer.destroy&&this.explorer.destroy(),this.explorerContent.destroy(),this.explorerContent=null)},openMyIndex:function(){MWF.xDesktop.requireApp("Attendance","MyIndex",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.MyIndex(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openMyDetail:function(){MWF.xDesktop.requireApp("Attendance","MyDetail",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.MyDetail(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openUnitIndex:function(){MWF.xDesktop.requireApp("Attendance","UnitIndex",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.UnitIndex(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openUnitDingdingIndex:function(){MWF.xDesktop.requireApp("Attendance","UnitDingdingIndex",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.UnitDingdingIndex(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openUnitQywxIndex:function(){MWF.xDesktop.requireApp("Attendance","UnitQywxIndex",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.UnitQywxIndex(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openUnitDetail:function(){MWF.xDesktop.requireApp("Attendance","UnitDetail",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.UnitDetail(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openDingdingUnitDetail:function(){MWF.xDesktop.requireApp("Attendance","UnitDingdingDetail",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.UnitDingdingDetail(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openQywxUnitDetail:function(){MWF.xDesktop.requireApp("Attendance","UnitQywxDetail",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.UnitQywxDetail(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openPeopleDetail:function(){MWF.xDesktop.requireApp("Attendance","PeopleDetail",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.PeopleDetail(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openDingdingPeopleDetail:function(){MWF.xDesktop.requireApp("Attendance","PeopleDingdingDetail",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.PeopleDingdingDetail(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openQywxPeopleDetail:function(){MWF.xDesktop.requireApp("Attendance","PeopleQywxDetail",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.PeopleQywxDetail(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openTopUnitDetail:function(){MWF.xDesktop.requireApp("Attendance","TopUnitDetail",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.TopUnitDetail(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openSelfHoliday:function(){MWF.xDesktop.requireApp("Attendance","SelfHoliday",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.SelfHoliday(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openMyAppealDeal:function(){MWF.xDesktop.requireApp("Attendance","MyAppeal",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.MyAppeal(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openAppealDeal:function(){MWF.xDesktop.requireApp("Attendance","AppealExplorer",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.AppealExplorer(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openImporting:function(){MWF.xDesktop.requireApp("Attendance","ImportExplorer",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.ImportExplorer(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openImportedInvalidInfor:function(){MWF.xDesktop.requireApp("Attendance","InvalidInfor",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.InvalidInfor(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openAbnormalExport:function(){MWF.xDesktop.requireApp("Attendance","AbnormalExport",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.AbnormalExport(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openScheduleSetting:function(){MWF.xDesktop.requireApp("Attendance","ScheduleExplorer",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.ScheduleExplorer(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openPermissionSetting:function(){MWF.xDesktop.requireApp("Attendance","PermissionExplorer",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.PermissionExplorer(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openHolidaySetting:function(){MWF.xDesktop.requireApp("Attendance","HolidayExplorer",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.HolidayExplorer(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openStaticsCycleExplorer:function(){MWF.xDesktop.requireApp("Attendance","StatisticsCycle",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.StatisticsCycle(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openAppSetting:function(){MWF.xDesktop.requireApp("Attendance","AppSetting",function(){new MWF.xApplication.Attendance.AppSetting(this,this.restActions).edit()}.bind(this))},openWeekendSetting:function(){MWF.xDesktop.requireApp("Attendance","WeekendSetting",function(){new MWF.xApplication.Attendance.WeekendSetting(this,this.restActions).edit()}.bind(this))},openAddressSetting:function(){MWF.xDesktop.requireApp("Attendance","AddressExplorer",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.AddressExplorer(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},openPersonSetting:function(){MWF.xDesktop.requireApp("Attendance","PersonSetting",function(){this.clearContent(),this.explorerContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.explorer=new MWF.xApplication.Attendance.PersonSetting(this.explorerContent,this,this.restActions,{isAdmin:this.isAdmin()}),this.explorer.load()}.bind(this))},recordStatus:function(){return this.navi&&this.navi.currentItem?this.navi.currentItem.retrieve("data"):{}}}),MWF.xApplication.Attendance.Navi=new Class({Implements:[Options,Events],options:{id:""},initialize:function(t,e,i){this.setOptions(i),this.app=t,this.node=$(e),this.css=this.app.css,this.currentMenu=null,this.currentItem=null,this.menus={},this.items={},this.elements=[],this.load()},load:function(){this.scrollNode=new Element("div.naviScrollNode",{styles:this.css.naviScrollNode}).inject(this.node),this.areaNode=new Element("div.naviAreaNode",{styles:this.css.naviAreaNode}).inject(this.scrollNode),this.setNodeScroll();var t=this.app.path+"navi.json";MWF.getJSON(t,function(t){t.each(function(t){t.access&&"admin"==t.access?this.app.isAdmin()&&this.createNaviNode(t):t.access&&"admin_dept"==t.access?(this.app.isUnitManager()||this.app.isAdmin())&&this.createNaviNode(t):t.access&&"dingding"==t.access?(this.app.isUnitManager()||this.app.isAdmin())&&"dingding"==this.app.enableType&&this.createNaviNode(t):t.access&&"qywx"==t.access?(this.app.isUnitManager()||this.app.isAdmin())&&"qywx"==this.app.enableType&&this.createNaviNode(t):this.createNaviNode(t)}.bind(this)),""==this.options.id&&this.elements[0].click(),this.setContentSize(),this.app.addEvent("resize",this.setContentSize.bind(this))}.bind(this))},setNodeScroll:function(){MWF.require("MWF.widget.DragScroll",function(){new MWF.widget.DragScroll(this.scrollNode)}.bind(this)),MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.scrollNode,{indent:!1})}.bind(this))},createNaviNode:function(t){if("sep"==t.type){var e=!0;"admin"==t.access?this.app.isAdmin()||(e=!1):t.access&&"admin_dept"==t.access&&(this.app.isUnitManager()||this.app.isAdmin()||(e=!1)),e&&new Element("div",{styles:this.css.viewNaviSepartorNode}).inject(this.areaNode)}else t.sub&&t.sub.length>0?this.createNaviMenuNode(t):(this.menus[t.id]={},this.createNaviItemNode(t,t.id))},createNaviMenuNode:function(t){if("admin"==t.access){if(!this.app.isAdmin())return}else if("admin_dept"==t.access&&!this.app.isUnitManager()&&!this.app.isAdmin())return;var e=this,i=new Element("div",{styles:this.css.naviMenuNode});i.store("data",t),i.store("type","menu"),new Element("div",{styles:this.css.naviMenuTextNode,text:t.title}).inject(i),i.inject(this.areaNode),this.menus[t.id]={},this.menus[t.id].node=i,this.elements.push(i),i.addEvents({mouseover:function(){e.currentMenu!=this&&this.setStyles(e.app.css.naviMenuNode_over)},mouseout:function(){e.currentMenu!=this&&this.setStyles(e.app.css.naviMenuNode)},mousedown:function(){e.currentMenu!=this&&this.setStyles(e.app.css.naviMenuNode_down)},mouseup:function(){e.currentMenu!=this&&this.setStyles(e.app.css.naviMenuNode_over)},click:function(){e.clickMenu.apply(e,[this])}}),t.sub.each(function(e){this.createNaviItemNode(e,t.id,i)}.bind(this))},clickMenu:function(t){var e=t.retrieve("data");e.action;this.closeCurrentMenu(),this.menus[e.id].itemNodes&&this.menus[e.id].itemNodes.each((function(t){t.setStyle("display","block")}));t.retrieve("type");e.target&&"_blank"==e.target||(t.setStyles(this.css.naviMenuNode_current),this.currentMenu=t)},closeCurrentMenu:function(){if(this.currentMenu){var t=this.currentMenu.retrieve("data");this.menus[t.id].itemNodes&&this.menus[t.id].itemNodes.each((function(t){t.setStyle("display","none")})),this.currentMenu.setStyles(this.css.naviMenuNode)}},createNaviItemNode:function(t,e){if("admin"==t.access){if(!this.app.isAdmin())return}else if(t.access&&"admin_dept"==t.access&&!this.app.isUnitManager()&&!this.app.isAdmin())return;var i=this,n=this.menus[e].itemNodes=this.menus[e].itemNodes||[],s=new Element("div",{styles:this.css.naviItemNode});s.setStyle("display","block"),n.push(s),s.store("data",t),s.store("type","item"),new Element("div",{styles:this.css.naviItemTextNode,text:t.title}).inject(s),s.inject(this.areaNode),this.elements.push(s),this.items[t.id]=s,s.addEvents({mouseover:function(){i.currentItem!=this&&this.setStyles(i.app.css.naviItemNode_over)},mouseout:function(){i.currentItem!=this&&this.setStyles(i.app.css.naviItemNode)},mousedown:function(){i.currentItem!=this&&this.setStyles(i.app.css.naviItemNode_down)},mouseup:function(){i.currentItem!=this&&this.setStyles(i.app.css.naviItemNode_over)},click:function(){i.clickItem.apply(i,[this])}}),t.id==this.options.id&&s.click()},clickItem:function(t){var e=t.retrieve("data");e.action,t.retrieve("type");e.target&&"_blank"==e.target||(this.currentItem&&this.currentItem.setStyles(this.css.naviItemNode),t.setStyles(this.css.naviItemNode_current),this.currentItem=t),e.action&&this.app[e.action]&&this.app[e.action].call(this.app,e)},setContentSize:function(){var t=this.app.content.getSize();this.scrollNode.setStyle("height",t.y-5)}});