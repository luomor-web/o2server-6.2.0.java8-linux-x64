MWF.xDesktop.requireApp("Template","Explorer",null,!1),MWF.xDesktop.requireApp("Attendance","Explorer",null,!1),MWF.xDesktop.requireApp("Selector","package",null,!1),MWF.xApplication.Attendance.ScheduleExplorer=new Class({Extends:MWF.xApplication.Attendance.Explorer,Implements:[Options,Events],initialize:function(e,t,i,a){this.setOptions(a),this.app=t,this.path="../x_component_Attendance/$ScheduleExplorer/",this.cssPath="../x_component_Attendance/$ScheduleExplorer/"+this.options.style+"/css.wcss",this._loadCss(),this.actions=i,this.node=$(e),this.initData(),this.personActions||(this.personActions=new MWF.xAction.org.express.RestActions)},loadView:function(){this.view=new MWF.xApplication.Attendance.ScheduleExplorer.View(this.elementContentNode,this.app,this,this.viewData,this.options.searchKey),this.view.load(),this.setContentSize()},createDocument:function(){this.view&&this.view._createDocument()}}),MWF.xApplication.Attendance.ScheduleExplorer.View=new Class({Extends:MWF.xApplication.Attendance.Explorer.View,_createItem:function(e){return new MWF.xApplication.Attendance.ScheduleExplorer.Document(this.table,e,this.explorer,this)},_getCurrentPageData:function(e,t){this.actions.listSchedule((function(t){t.data=t.data.map((function(e){return e.signProxy=e.signProxy?e.signProxy:1,e})),e&&e(t)}))},_removeDocument:function(e,t){this.actions.deleteSchedule(e.id,function(e){this.explorer.view.reload(),this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_createDocument:function(){new MWF.xApplication.Attendance.ScheduleExplorer.Schedule(this.explorer).create()},copyObject:function(e){if("object"!=typeof e)return e;var t=new Object(null);for(var i in e)t[i]=this.copyObject(e[i]);return t},_openDocument:function(e){var t=this.copyObject(e);new MWF.xApplication.Attendance.ScheduleExplorer.Schedule(this.explorer,t).edit()}}),MWF.xApplication.Attendance.ScheduleExplorer.Document=new Class({Extends:MWF.xApplication.Attendance.Explorer.Document}),MWF.xApplication.Attendance.ScheduleExplorer.Schedule=new Class({Extends:MWF.xApplication.Attendance.Explorer.PopupForm,options:{width:600,height:600,hasTop:!0,hasBottom:!0,title:"",draggable:!0,closeAction:!0},_createTableContent:function(){var e=this.app.lp.schedule,t=this.data.signProxy||1,i="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'><tr><td colspan='2' styles='formTableHead'>"+e.setSchedule+"</td></tr><tr><td styles='formTabelTitle' lable='unitName'></td>    <td styles='formTableValue' item='unitName'></td></tr><tr><td styles='formTabelTitle' lable='signProxy'></td>    <td styles='formTableValue' item='signProxy'></td></tr><tr><td styles='formTabelTitle' lable='onDutyTime'></td>    <td styles='formTableValue' item='onDutyTime'></td></tr><tr style='"+(t&&"0"!=t&&"1"!=t?"":"display: none")+"'><td styles='formTabelTitle' lable='middayRestStartTime'></td>    <td styles='formTableValue' item='middayRestStartTime'></td></tr><tr style='"+(t&&"0"!=t&&"1"!=t?"":"display: none")+"'><td styles='formTabelTitle' lable='middayRestEndTime'></td>    <td styles='formTableValue' item='middayRestEndTime'></td></tr><tr><td styles='formTabelTitle' lable='offDutyTime'></td>    <td styles='formTableValue' item='offDutyTime'></td></tr><tr><td styles='formTabelTitle' lable='lateStartTime'></td>    <td styles='formTableValue' item='lateStartTime'></td></tr><tr style='"+("3"!=t?"display: none":"")+"'><td styles='formTabelTitle' lable='leaveEarlyStartTimeMorning'></td>    <td styles='formTableValue' item='leaveEarlyStartTimeMorning'></td></tr><tr style='"+("3"!=t?"display: none":"")+"'><td styles='formTabelTitle' lable='lateStartTimeAfternoon'></td>    <td styles='formTableValue' item='lateStartTimeAfternoon'></td></tr><tr><td styles='formTabelTitle' lable='leaveEarlyStartTime'></td>    <td styles='formTableValue' item='leaveEarlyStartTime'></td></tr><tr><td styles='formTabelTitle' lable='absenceStartTime'></td>    <td styles='formTableValue' item='absenceStartTime'></td></tr></table>";this.formTableArea.set("html",i),MWF.xDesktop.requireApp("Template","MForm",function(){var i=Object;this.form=new MForm(this.formTableArea,this.data,{onPostLoad:function(){0!=t&&1!=t&&(this.options.height=3==t?670:570)}.bind(this),isEdited:this.isEdited||this.isNew,itemTemplate:{unitName:{text:e.unit,type:"org",orgType:"unit"},signProxy:{text:e.signProxy.name,type:"select",selectText:i.values(e.signProxy.select),selectValue:i.keys(e.signProxy.select),defaultValue:t,style:{width:"99%",border:"1px solid rgb(153, 153, 153)","border-radius":"3px","box-shadow":"rgb(204, 204, 204) 0px 0px 6px","min-height":"26px",overflow:"hidden"},event:{change:function(){var t=this.form.getItem("signProxy").getValue();if("1"!=t&&"0"!=t){this.formTableArea.getElement("[lable=middayRestStartTime]").getParent().setStyle("display","table-row"),this.formTableArea.getElement("[lable=middayRestEndTime]").getParent().setStyle("display","table-row");var i="570px";"3"==t?(this.formTableArea.getElement("[lable=leaveEarlyStartTimeMorning]").getParent().setStyle("display","table-row"),this.formTableArea.getElement("[lable=lateStartTimeAfternoon]").getParent().setStyle("display","table-row"),i="670px",this.form.options.itemTemplate.lateStartTimeAfternoon.notEmpty=!0):(this.formTableArea.getElement("[lable=leaveEarlyStartTimeMorning]").getParent().setStyle("display","none"),this.formTableArea.getElement("[lable=lateStartTimeAfternoon]").getParent().setStyle("display","none"),this.form.options.itemTemplate.lateStartTimeAfternoon.notEmpty=!1),this.formNode.setStyle("height",i),this.form.options.itemTemplate.middayRestStartTime.text=e.signProxy[t].middayRestStartTime,this.form.options.itemTemplate.middayRestEndTime.text=e.signProxy[t].middayRestEndTime,this.form.options.itemTemplate.middayRestStartTime.notEmpty=!0,this.form.options.itemTemplate.middayRestEndTime.notEmpty=!0}else this.formTableArea.getElement("[lable=middayRestStartTime]").getParent().setStyle("display","none"),this.formTableArea.getElement("[lable=middayRestEndTime]").getParent().setStyle("display","none"),this.formTableArea.getElement("[lable=leaveEarlyStartTimeMorning]").getParent().setStyle("display","none"),this.formTableArea.getElement("[lable=lateStartTimeAfternoon]").getParent().setStyle("display","none"),this.formNode.setStyle("height","500px"),this.form.options.itemTemplate.middayRestStartTime.notEmpty=!1,this.form.options.itemTemplate.middayRestEndTime.notEmpty=!1,this.form.options.itemTemplate.lateStartTimeAfternoon.notEmpty=!1;this.form.data[0].signProxy=t,this.form.load()}.bind(this)}},onDutyTime:{text:e.workTime,tType:"time",notEmpty:!0},middayRestStartTime:{text:e.signProxy[2].middayRestStartTime,tType:"time",notEmpty:0!=t&&1!=t},middayRestEndTime:{text:e.signProxy[2].middayRestEndTime,tType:"time",notEmpty:0!=t&&1!=t},offDutyTime:{text:e.offTime,tType:"time",notEmpty:!0},lateStartTime:{text:e.lateStartTime,tType:"time",notEmpty:!0},leaveEarlyStartTimeMorning:{text:e.leaveEarlyStartTimeMorning,tType:"time"},lateStartTimeAfternoon:{text:e.lateStartTimeAfternoon,tType:"time",notEmpty:0!=t&&1!=t},leaveEarlyStartTime:{text:e.leaveEarlyStartTime,tType:"time"},absenceStartTime:{text:e.absenteeismTime,tType:"time"}}},this.app),this.form.load()}.bind(this),!0)},_ok:function(e,t){var i=[],a=e.signProxy;i=1!=a?[e.onDutyTime,e.middayRestStartTime,e.middayRestEndTime,e.offDutyTime]:[e.onDutyTime,e.offDutyTime];for(var l=Date.parse,n=0;n<i.length;n++)if(0!=n&&l(i[n])-l(i[n-1])<0)return void this.app.notice(this.app.lp.schedule.illegal[a][n-1],"error",this.formNode,{x:"center",y:"center"});this.app.restActions.saveSchedule(e,function(e){t&&t(e)}.bind(this))}});