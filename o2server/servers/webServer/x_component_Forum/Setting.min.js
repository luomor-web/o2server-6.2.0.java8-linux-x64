MWF.xApplication.Forum=MWF.xApplication.Forum||{},MWF.xDesktop.requireApp("Template","Explorer",null,!1),MWF.xDesktop.requireApp("Template","MPopupForm",null,!1),MWF.require("MWF.widget.O2Identity",null,!1),MWF.xApplication.Forum.Setting=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",index:0},initialize:function(t,e,i,s){this.setOptions(s),this.app=e,this.lp=e.lp,this.path="../x_component_Forum/$Setting/",this.loadCss(),this.actions=i,this.node=$(t)},loadCss:function(){this.cssPath="../x_component_Forum/$Setting/"+this.options.style+"/css.wcss",this._loadCss()},load:function(){this.createNaviContent(),this.createContentDiv(),this.resizeWindowFun=this.resizeWindow.bind(this),this.resizeWindow(),this.app.addEvent("resize",this.resizeWindowFun)},destroy:function(){this.contentDiv&&this.contentDiv.empty(),this.explorer&&(this.explorer.destroy(),delete this.explorer),this.resizeWindowFun&&this.app.removeEvent("resize",this.resizeWindowFun),this.node.empty()},resizeWindow:function(){var t=this.app.node.getSize(),e=this.app.topNode?this.app.topNode.getSize():{x:0,y:0},i=t.y-e.y;this.naviDiv.setStyles({height:i+"px"}),this.naviContentDiv.setStyles({height:i-120+"px"}),this.contentDiv.setStyles({height:i+"px"})},createNaviContent:function(){this.naviDiv=new Element("div.naviDiv",{styles:this.css.naviDiv}).inject(this.node),this.naviTitleDiv=new Element("div.naviTitleDiv",{styles:this.css.naviTitleDiv,text:this.lp.setting}).inject(this.naviDiv),this.naviContentDiv=new Element("div.naviContentDiv",{styles:this.css.naviContentDiv}).inject(this.naviDiv),this.naviBottomDiv=new Element("div.naviBottomDiv",{styles:this.css.naviBottomDiv}).inject(this.naviDiv);var t=this.path+"navi.json";MWF.getJSON(t,function(t){t.each(function(t,e){var i=new Element("li.naviContentLi",{styles:this.css.naviContentLi}).inject(this.naviContentDiv);i.addEvents({mouseover:function(t){this.bindObj.currentNaviItem!=this.node&&this.node.setStyles(this.styles)}.bind({styles:this.css.naviContentLi_over,node:i,bindObj:this}),mouseout:function(t){this.bindObj.currentNaviItem!=this.node&&this.node.setStyles(this.styles)}.bind({styles:this.css.naviContentLi,node:i,bindObj:this}),click:function(t){this.bindObj.currentNaviItem&&this.bindObj.currentNaviItem.setStyles(this.bindObj.css.naviContentLi),this.node.setStyles(this.styles),this.bindObj.currentNaviItem=this.node,this.node.store("index",e),this.action&&this.bindObj[this.action]&&this.bindObj[this.action]()}.bind({styles:this.css.naviContentLi_current,node:i,bindObj:this,action:t.action})});new Element("img.naviContentImg",{styles:this.css.naviContentImg,src:this.path+this.options.style+"/icon/"+t.icon}).inject(i),new Element("span.naviContentSpan",{styles:this.css.naviContentSpan,text:t.title}).inject(i);e==this.options.index&&i.click()}.bind(this))}.bind(this))},createContentDiv:function(){this.contentDiv=new Element("div.contentDiv",{styles:this.css.contentDiv}).inject(this.node)},openCategorySetting:function(){this.contentDiv&&this.contentDiv.empty(),this.explorer&&(this.explorer.destroy(),delete this.explorer),this.explorer=new MWF.xApplication.Forum.Setting.CategorySettingExplorer(this.contentDiv,this.app,this,{style:this.options.style}),this.explorer.load()},openSectionSetting:function(){this.contentDiv&&this.contentDiv.empty(),this.explorer&&(this.explorer.destroy(),delete this.explorer),this.explorer=new MWF.xApplication.Forum.Setting.SectionSettingExplorer(this.contentDiv,this.app,this,{style:this.options.style}),this.explorer.load()},openSystemSetting:function(){this.contentDiv&&this.contentDiv.empty(),this.explorer&&(this.explorer.destroy(),delete this.explorer),this.explorer=new MWF.xApplication.Forum.Setting.SystemSettingExplorer(this.contentDiv,this.app,this,{style:this.options.style}),this.explorer.load()},openRoleSetting:function(){this.contentDiv&&this.contentDiv.empty(),this.explorer&&(this.explorer.destroy(),delete this.explorer),this.explorer=new MWF.xApplication.Forum.Setting.RoleSettingExplorer(this.contentDiv,this.app,this,{style:this.options.style}),this.explorer.load()},openPermissionSetting:function(){this.contentDiv&&this.contentDiv.empty(),this.explorer&&(this.explorer.destroy(),delete this.explorer),this.explorer=new MWF.xApplication.Forum.Setting.PermissionSettingExplorer(this.contentDiv,this.app,this,{style:this.options.style}),this.explorer.load()}}),MWF.xApplication.Forum.Setting.CategorySettingExplorer=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(t,e,i,s){this.container=t,this.parent=i,this.app=e,this.css=this.parent.css,this.lp=this.app.lp},load:function(){this.container.empty(),this.app.access.isAdmin()&&this.loadToolbar(),this.loadView()},destroy:function(){this.resizeWindowFun&&this.app.removeEvent("resize",this.resizeWindowFun),this.view.destroy()},loadToolbar:function(){this.toolbar=new Element("div",{styles:this.css.toolbar}).inject(this.container),this.createActionNode=new Element("div",{styles:this.css.toolbarActionNode,text:this.lp.createCategory}).inject(this.toolbar),this.createActionNode.addEvent("click",function(){new MWF.xApplication.Forum.Setting.CategorySettingForm(this,{},{onPostOk:function(){this.view.reload()}.bind(this)}).create()}.bind(this)),this.fileterNode=new Element("div",{styles:this.css.fileterNode}).inject(this.toolbar)},loadView:function(){this.viewContainer=Element("div",{styles:this.css.viewContainer}).inject(this.container),this.resizeWindow(),this.resizeWindowFun=this.resizeWindow.bind(this),this.app.addEvent("resize",this.resizeWindowFun),this.view=new MWF.xApplication.Forum.Setting.CategorySettingView(this.viewContainer,this.app,this,{templateUrl:this.parent.path+"listItemCategory.json",scrollEnable:!0}),this.view.load()},resizeWindow:function(){var t=this.container.getSize();this.toolbar?this.viewContainer.setStyles({height:t.y-121+"px"}):this.viewContainer.setStyles({height:t.y-56+"px"})}}),MWF.xApplication.Forum.Setting.CategorySettingView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t){return new MWF.xApplication.Forum.Setting.CategorySettingDocument(this.viewNode,t,this.explorer,this)},_getCurrentPageData:function(t,e){e||(e=20),this.actions.listCategoryAllByAdmin(function(e){t&&t(e)}.bind(this))},_removeDocument:function(t,e){this.actions.deleteCategory(t.id,function(t){this.reload(),this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_openDocument:function(t){var e=new MWF.xApplication.Forum.Setting.CategorySettingForm(this,t,{onPostOk:function(){this.reload()}.bind(this)});this.app.access.isAdmin()?e.edit():e.open()},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){}}),MWF.xApplication.Forum.Setting.CategorySettingDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){}}),MWF.xApplication.Forum.Setting.CategorySettingForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"default",width:"1011",height:"90%",hasTop:!0,hasIcon:!1,hasTopIcon:!0,hasTopContent:!0,hasBottom:!0,title:MWF.xApplication.Forum.LP.categoryFormTitle,draggable:!0,closeAction:!0},createContent:function(){this.formContentNode=new Element("div.formContentNode",{styles:this.css.formContentNode}).inject(this.formNode),this.formTableContainer=new Element("div.formTableContainer",{styles:this.css.formTableContainer}).inject(this.formContentNode),this.formTableArea=new Element("div.formTableArea",{styles:this.css.formTableArea}).inject(this.formTableContainer),this._createTableContent()},_createTableContent:function(){this.data.indexListStyle||(this.data.indexListStyle="type_1_0");this.formTableArea.set("html","<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'><tr>   <td styles='formTableTitle' lable='forumName' width='10%'></td>   <td styles='formTableValue' item='forumName' width='40%'></td>   <td styles='formTableTitle' width='10%'></td>   <td styles='formTableValue' width='40%'></td></tr><tr>   <td styles='formTableTitle' lable='forumStatus'></td>   <td styles='formTableValue' item='forumStatus'></td>   <td styles='formTableTitle' lable='creatorName'></td>   <td styles='formTableValue' item='creatorName'></td></tr><tr>   <td styles='formTableTitle' lable='forumManagerName'></td>   <td styles='formTableValue' item='forumManagerName'></td>   <td styles='formTableTitle' lable='orderNumber'></td>   <td styles='formTableValue' item='orderNumber'></td></tr><tr>   <td styles='formTableTitle' lable='forumVisible'></td>   <td styles='formTableValue' item='forumVisible'></td>   <td styles='formTableValue' colspan='2'>   </td></tr><tr>   <td></td>   <td colspan='3'>       <div item='forumVisibleResult'></div>   </td></tr><tr>   <td styles='formTableTitle' lable='forumColorArea'></td>   <td styles='formTableValue'>       <div item='forumColorArea' style='float:left;'></div>       <div item='forumColorButton' style='float:left;'></div>   </td>   <td styles='formTableTitle' lable='subjectType'></td>   <td styles='formTableValue' item='subjectType'></td></tr><tr>   <td styles='formTableTitle' lable='indexListStyleLable'></td>   <td styles='formTableValue' colspan='3'><div item='indexListStyleShow'></div><div item='indexListStyleButton'></div></td></tr><tr>   <td styles='formTableTitle' lable='forumNotice'></td>   <td styles='formTableValue' item='forumNotice' colspan='3'></td></tr></table>");(this.isEdited||this.isNew)&&this.data.forumVisible&&(this.data.forumVisible,this.lp.allPerson);var t=this.data.forumVisible&&this.data.forumVisible!=this.lp.allPerson?{display:""}:{display:"none"},e=this.isEdited||this.isNew?{}:{display:"none"};this.indexListStyleShow=this.formTableArea.getElements("[item='indexListStyleShow']")[0],this.data.indexListStyle&&this.getDefaultTypeTemplateList(function(){new Element("img",{src:this.defalutTypeTemplateList[this.data.indexListStyle].preview,styles:this.css.indexListStylePreview}).inject(this.indexListStyleShow)}.bind(this)),MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.formTableArea,this.data,{style:"forum",isEdited:this.isEdited||this.isNew,itemTemplate:{forumName:{text:this.lp.forumName,notEmpty:!0},forumManagerName:{type:"org",text:this.lp.forumManagerName,orgType:"person",defaultValue:this.app.userName,count:0},forumVisible:{text:this.lp.forumVisible,type:"select",selectValue:this.lp.forumVisibleValue.split(","),event:{change:function(t,e){var i=t.getValue()==this.lp.allPerson?{display:"none"}:{display:""};t.form.getItem("forumVisibleResult").setStyles(i)}.bind(this)}},forumVisibleResult:{type:"org",count:0,orgType:["person","unit"],value:function(){return this.getRoleMemberByCode("FORUM_GUEST_")}.bind(this),style:t},indexListStyleLable:{text:this.lp.indexListStyle},indexListStyleButton:{type:"button",value:this.lp.indexListStyleButton,event:{click:function(t,e){this.selectIndexType()}.bind(this)}},forumIndexStyle:{text:this.lp.forumIndexStyle,type:"select",selectValue:this.lp.forumIndexStyleValue.split(",")},indexRecommendable:{text:this.lp.indexRecommendable,type:"select",selectValue:["true","false"],selectText:this.lp.yesOrNo.split(",")},subjectNeedAudit:{text:this.lp.subjectNeedAudit,type:"select",selectValue:["true","false"],selectText:this.lp.yesOrNo.split(","),defaultValue:"false"},replyNeedAudit:{text:this.lp.replyNeedAudit,type:"select",selectValue:["true","false"],selectText:this.lp.yesOrNo.split(","),defaultValue:"false"},creatorName:{text:this.lp.creatorName,type:"org",isEdited:!1,defaultValue:this.app.userName},forumStatus:{text:this.lp.forumStatus,type:"select",selectValue:this.lp.forumStatusValue.split(",")},orderNumber:{text:this.lp.orderNumber,tType:"number"},forumColorArea:{text:this.lp.forumColor,type:"innerText"},forumColorButton:{value:this.lp.selectColor,type:"button",style:e,event:{click:function(t,e){this.selectColor()}.bind(this)}},subjectType:{text:this.lp.subjectType,type:"text",defaultValue:this.lp.subjectTypeDefaultValue},forumNotice:{text:this.lp.forumNotice,type:"rtf",RTFConfig:{skin:"bootstrapck"}}}},this.app),this.form.load();var i=this.formTableArea.getElements("[item='forumColorArea']")[0];this.forumColorNode=new Element("div",{styles:{"font-size":"12px",height:"24px","line-height":"24px",width:"70px","margin-right":"20px",color:"#fff","text-align":"center","background-color":this.data.forumColor||this.lp.defaultForumColor},text:this.lp.effect}).inject(i)}.bind(this),!0)},selectColor:function(){new MWF.xApplication.Forum.Setting.ForumColorForm(this,{},{onPostOk:function(t){this.forumColorNode.setStyle("background-color",t),this.data.forumColor=t}.bind(this)}).edit()},_ok:function(t,e){this.app.restActions.saveCategory(t,function(t){this.saveRole(t.data.id,function(){e&&e(t),this.fireEvent("postOk")}.bind(this))}.bind(this))},saveRole:function(t,e){var i=this.form.getResult(!0,null,!0,!1,!0);this.isNew&&(i.id=t),this.saveRoleMember(!0,"forumManagerName","FORUM_SUPER_MANAGER_",i,!0);var s=i.forumVisible!=this.lp.allPerson;this.saveRoleMember(s,"forumVisibleResult","FORUM_GUEST_",i),e&&e()},saveRoleMember:function(t,e,i,s,o,n){var l=[];t&&(o?s[e]&&s[e].each((function(t){""!=t&&l.push({objectName:t,objectType:"人员"})})):s[e]&&s[e].each((function(t){switch(t.substr(t.length-1,1).toLowerCase()){case"p":l.push({objectName:t,objectType:"人员"});break;case"u":l.push({objectName:t,objectType:"组织"});break;default:l.push({objectName:t,objectType:"人员"})}})));var a={bindObjectArray:l,bindRoleCode:i+this.data.id};this.app.restActions.bindRole(a,function(t){n&&n(json)}.bind(this))},getRoleMemberByCode:function(t){if(this.RoleMember||(this.RoleMember={}),this.RoleMember[t])return this.RoleMember[t];var e=this.RoleMember[t]=[];return this.data.id?(this.RoleMember[t]=e,this.data&&this.data.id&&this.actions.listRoleMemberByCode({bindRoleCode:t+this.data.id},(function(t){t.data=t.data||[],t.data.each(function(t){e.push(t.objectName)}.bind(this))}),(function(){}),!1),e):e},selectIndexType:function(){this.getDefaultTypeTemplateList(function(){this.selectTypeTemplate()}.bind(this))},getDefaultTypeTemplateList:function(t){if(this.defalutTypeTemplateList)t&&t();else{MWF.getJSON("../x_component_Forum/$ColumnTemplate/template/setting.json",function(e){this.defalutTypeTemplateList=e,t&&t()}.bind(this))}},selectTypeTemplate:function(t){this.typeTemplateList=null;var e=this,i=new Element("div",{styles:this.css.createTemplateMaskNode}).inject(this.app.content),s=new Element("div",{styles:this.css.createTypeTemplateAreaNode}).inject(this.app.content);s.fade("in");new Element("div",{styles:this.css.createTemplateFormTitleNode,text:this.app.lp.selectIndexType}).inject(s);var o=new Element("div",{styles:this.css.createTemplateFormCategoryNode}).inject(s),n=(new Element("div",{styles:this.css.createTemplateFormCategoryTitleNode,text:this.app.lp.typeColumn}).inject(o),new Element("div",{styles:this.css.createTemplateFormContentNode}).inject(s)),l=new Element("div",{styles:this.css.createTemplateFormCategoryItemNode,text:this.app.lp.all}).inject(o);l.addEvent("click",(function(){h()}));var a=[];this.getDefaultTypeTemplateList(function(){for(var t in this.defalutTypeTemplateList){var e=this.defalutTypeTemplateList[t];a.contains(e.column)||a.push(e.column)}}.bind(this)),a.each(function(t){new Element("div",{styles:this.css.createTemplateFormCategoryItemNode,text:t+MWF.xApplication.Forum.LP.column,value:t}).inject(o).addEvent("click",(function(){n.empty(),o.getElements("div").each((function(t,i){i>0&&t.setStyles(e.css.createTemplateFormCategoryItemNode)})),this.setStyles(e.css.createTemplateFormCategoryItemNode_current),d(this.get("value"))}))}.bind(this));var r=function(){var t=this.app.content.getSize(),e=.1*t.y/2,i=.1*t.x/2;e<0&&(e=0),i<0&&(i=0),s.setStyles({top:e+"px",left:i+"px"}),e=.9*t.y-o.getSize().y-70,n.setStyle("height",e+"px")}.bind(this);r(),this.app.addEvent("resize",r);var d=function(t){this.getDefaultTypeTemplateList(function(){for(var o in this.defalutTypeTemplateList){var l=this.defalutTypeTemplateList[o];if(!t||l.column==parseInt(t)){l.key=o;var a=new Element("div",{styles:this.css.typeTemplateNode}).inject(n),d=new Element("div",{styles:this.css.typeTemplateIconNode}).inject(a);a.store("template",l.key),new Element("img",{styles:this.css.typeTemplateIconImgNode}).inject(d).set("src",l.preview),a.addEvents({mouseover:function(){this.setStyles(e.css.typeTemplateNode_over)},mouseout:function(){this.setStyles(e.css.typeTemplateNode)},mousedown:function(){this.setStyles(e.css.typeTemplateNode_down)},mouseup:function(){this.setStyles(e.css.typeTemplateNode_over)},click:function(t){c(t,this.retrieve("template")),e.app.removeEvent("resize",r),s.destroy(),i.destroy()}})}}}.bind(this))}.bind(this),c=function(t,e){this.data.indexListStyle=e,this.indexListStyleShow.empty(),new Element("img",{src:this.defalutTypeTemplateList[e].preview,styles:this.css.indexListStylePreview}).inject(this.indexListStyleShow)}.bind(this),h=function(){n.empty(),o.getElements("div").each((function(t,i){i>0&&t.setStyles(e.css.createTemplateFormCategoryItemNode)})),l.setStyles(e.css.createTemplateFormCategoryItemNode_current),d()};h(),i.addEvent("click",function(){this.app.removeEvent("resize",r),s.destroy(),i.destroy()}.bind(this))}}),MWF.xApplication.Forum.Setting.ForumColorForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"default",width:"820",height:"280",hasTop:!0,hasIcon:!1,hasTopIcon:!0,hasTopContent:!0,hasBottom:!1,title:MWF.xApplication.Forum.LP.forumColorFormTitle,draggable:!0,closeAction:!0},_createTableContent:function(){var t=new Element("div",{styles:this.css.sectionFormContent}).inject(this.formTableArea);t.setStyle("margin-top","10px"),this.lp.optionsForumColors.each(function(e,i){e.each(function(e,i){var s=new Element("div",{styles:this.css.iconAreaNode}).inject(t);new Element("div",{styles:{height:"20px",width:"40px",margin:"5px 5px 5px 5px","background-color":e,cursor:"pointer"}}).inject(s);s.store("color",e),s.addEvents({click:function(){this.obj.fireEvent("postOk",this.node.retrieve("color")),this.obj.close()}.bind({obj:this,node:s})})}.bind(this))}.bind(this))}}),MWF.xApplication.Forum.Setting.SectionSettingExplorer=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(t,e,i,s){this.container=t,this.parent=i,this.app=e,this.css=this.parent.css,this.lp=this.app.lp},load:function(){this.container.empty(),this.loadToolbar()},destroy:function(){this.resizeWindowFun&&this.app.removeEvent("resize",this.resizeWindowFun),this.view.destroy()},loadToolbar:function(){this.toolbar=new Element("div",{styles:this.css.toolbar}).inject(this.container),this.createActionNode=new Element("div",{styles:this.css.toolbarActionNode,text:this.lp.createSection}).inject(this.toolbar),this.createActionNode.addEvent("click",function(){new MWF.xApplication.Forum.Setting.SectionSettingForm(this,{},{onPostOk:function(){this.view.reload()}.bind(this)}).create()}.bind(this)),this.loadCategoryBar()},loadCategoryBar:function(){var t=this;this.allCategoryNode=new Element("li.allCategoryNode",{styles:this.css.categoryNode,text:MWF.xApplication.Forum.LP.all1}).inject(this.toolbar),this.allCategoryNode.addEvents({mouseover:function(){this.currentCategoryNode!=this.allCategoryNode&&this.allCategoryNode.setStyles(this.css.categoryNode_over)}.bind(this),mouseout:function(){this.currentCategoryNode!=this.allCategoryNode&&this.allCategoryNode.setStyles(this.css.categoryNode)}.bind(this),click:function(){this.currentCategoryNode&&this.currentCategoryNode.setStyles(this.css.categoryNode),this.currentCategoryNode=this.allCategoryNode,this.allCategoryNode.setStyles(this.css.categoryNode_current),this.loadView()}.bind(this)});var e=!1;this.forumAdminObj={},this.app.restActions.listCategoryAllByAdmin(function(i){i.data=i.data||[],i.data.each(function(i){var s=this.app.access.hasForumAdminAuthority(i);this.forumAdminObj[i.id]=s,e||(e=s);var o=new Element("li.categoryNode",{styles:this.css.categoryNode,text:i.forumName}).inject(this.toolbar);o.store("categoryId",i.id),o.addEvents({mouseover:function(){t.currentCategoryNode!=this.node&&this.node.setStyles(t.css.categoryNode_over)}.bind({node:o}),mouseout:function(){t.currentCategoryNode!=this.node&&this.node.setStyles(t.css.categoryNode)}.bind({node:o}),click:function(){t.currentCategoryNode&&t.currentCategoryNode.setStyles(t.css.categoryNode),t.currentCategoryNode=this.node,this.node.setStyles(t.css.categoryNode_current),t.loadView()}.bind({name:i.id,node:o})})}.bind(this))}.bind(this),null,!1),e||this.createActionNode.destroy(),this.allCategoryNode.click()},loadView:function(){var t;this.currentCategoryNode&&(t=this.currentCategoryNode.retrieve("categoryId")),t=t||"all",this.viewContainer&&this.viewContainer.destroy(),this.viewContainer=Element("div",{styles:this.css.viewContainer}).inject(this.container),this.resizeWindow(),this.resizeWindowFun=this.resizeWindow.bind(this),this.app.addEvent("resize",this.resizeWindowFun),this.view=new MWF.xApplication.Forum.Setting.SectionSettingView(this.viewContainer,this.app,this,{templateUrl:this.parent.path+"listItemSection.json",scrollEnable:!0,categoryId:t}),this.view.load()},resizeWindow:function(){var t=this.container.getSize();this.viewContainer.setStyles({height:t.y-65+"px"})}}),MWF.xApplication.Forum.Setting.SectionSettingView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t){return new MWF.xApplication.Forum.Setting.SectionSettingDocument(this.viewNode,t,this.explorer,this)},_getCurrentPageData:function(t,e){e||(e=20),"all"==this.options.categoryId?this.actions.listSectionAll(function(e){e.data||(e.data=[]),t&&t(e)}.bind(this)):this.actions.listSectionByAdmin(this.options.categoryId,function(e){e.data||(e.data=[]),t&&t(e)}.bind(this))},_removeDocument:function(t,e){this.actions.deleteSection(t.id,function(t){this.reload(),this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_openDocument:function(t){var e=new MWF.xApplication.Forum.Setting.SectionSettingForm(this,t,{title:this.lp.sectionFormTitle+" - "+t.sectionName,onPostOk:function(){this.reload()}.bind(this)});this.app.access.hasForumAdminAuthority(t.forumId,(function(t){t?e.edit():e.open()}))},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){}}),MWF.xApplication.Forum.Setting.SectionSettingDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,mouseoverSection:function(t,e){var i=t.getElements("[styles='sectionRemoveNode']")[0];i&&i.setStyle("opacity",1)},mouseoutSection:function(t,e){var i=t.getElements("[styles='sectionRemoveNode']")[0];i&&i.setStyle("opacity",0)},_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){}}),MWF.xApplication.Forum.Setting.SectionSettingForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"default",width:"1100",height:"90%",hasTop:!0,hasIcon:!1,hasTopIcon:!0,hasTopContent:!0,hasBottom:!0,title:MWF.xApplication.Forum.LP.sectionFormTitle,draggable:!0,closeAction:!0},createToolbar:function(){var t,e=this;this.toolbar=new Element("div",{styles:this.css.formToolbar}).inject(this.formNode),(t=new Element("li.categoryNode",{styles:this.css.formCategoryNode,text:this.lp.baseSetting}).inject(this.toolbar)).addEvents({mouseover:function(){e.currentCategoryNode!=this.node&&this.node.setStyles(e.css.formCategoryNode_over)}.bind({node:t}),mouseout:function(){e.currentCategoryNode!=this.node&&this.node.setStyles(e.css.formCategoryNode)}.bind({node:t}),click:function(){e.currentCategoryNode&&e.currentCategoryNode.setStyles(e.css.formCategoryNode),e.currentCategoryNode=this.node,this.node.setStyles(e.css.formCategoryNode_current),e.baseContainer.setStyle("display",""),e.permissionContainer.setStyle("display","none")}.bind({node:t})}),t.setStyles(this.css.formCategoryNode_current),e.currentCategoryNode=t,(t=new Element("li.categoryNode",{styles:this.css.formCategoryNode,text:this.lp.permissionSetting}).inject(this.toolbar)).addEvents({mouseover:function(){e.currentCategoryNode!=this.node&&this.node.setStyles(e.css.formCategoryNode_over)}.bind({node:t}),mouseout:function(){e.currentCategoryNode!=this.node&&this.node.setStyles(e.css.formCategoryNode)}.bind({node:t}),click:function(){e.currentCategoryNode&&e.currentCategoryNode.setStyles(e.css.formCategoryNode),e.currentCategoryNode=this.node,this.node.setStyles(e.css.formCategoryNode_current),e.baseContainer.setStyle("display","none"),e.permissionContainer.setStyle("display","")}.bind({node:t})})},createContent:function(){this.createToolbar(),this.formContentNode=new Element("div.formContentNode",{styles:this.css.formContentNode}).inject(this.formNode),this.formTableContainer=new Element("div.formTableContainer",{styles:this.css.formTableContainer}).inject(this.formContentNode),this.formTableArea=new Element("div.formTableArea",{styles:this.css.formTableArea}).inject(this.formTableContainer),this._createTableContent()},_createTableContent:function(){_self=this,this.baseContainer=new Element("div").inject(this.formTableArea);var t="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'><tr>   <td styles='formTableTitle' lable='sectionName' width='10%'></td>   <td styles='formTableValue' item='sectionName' width='40%'></td>   <td styles='formTableTitle' lable='forumId' width='10%'></td>   <td styles='formTableValue' item='forumId' width='40%'></td></tr><tr>   <td styles='formTableTitle' lable='sectionStatus'></td>   <td styles='formTableValue' item='sectionStatus'></td>   <td styles='formTableTitle' lable='orderNumber'></td>   <td styles='formTableValue' item='orderNumber'></td></tr><tr>   <td styles='formTableTitle' lable='typeCatagory'></td>   <td styles='formTableValue' item='typeCatagory'></td>   <td styles='formTableTitle' lable='subjectType'></td>   <td styles='formTableValue' item='subjectType'></td></tr><tr>   <td styles='formTableTitle' lable='creatorName'></td>   <td styles='formTableValue' item='creatorName'></td>   <td styles='formTableTitle' lable='createTime'></td>   <td styles='formTableValue' item='createTime'></td></tr><tr>   <td styles='formTableTitle' lable='sectionIcon'></td>   <td styles='formTableValue' item='sectionIconArea' colspan='3' valign='bottom'></td></tr><tr>   <td styles='formTableTitle' lable='sectionDescription'></td>   <td styles='formTableValue' item='sectionDescription' colspan='3'></td></tr><tr>   <td styles='formTableTitle' lable='sectionNotice'></td>   <td styles='formTableValue' item='sectionNotice' colspan='3'></td></tr></table>";this.baseContainer.set("html",t),this.permissionContainer=new Element("div",{styles:{display:"none"}}).inject(this.formTableArea);t="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'><tr>   <td styles='formTableTitle' lable='moderatorNames'></td>   <td styles='formTableValue' item='moderatorNames' colspan='3'></td></tr><tr>   <td styles='formTableTitle' lable='sectionVisible' width='10%'></td>   <td styles='formTableValue' item='sectionVisible' width='20%'></td>   <td styles='formTableValue' width='70%' colspan='2'></td></tr><tr>   <td></td>   <td styles='formTableValue' colspan='3'>       <div styles='formItemSpan' item='sectionVisibleResult'></div> </td></tr><tr>   <td styles='formTableTitle' lable='subjectPublishAble'></td>   <td styles='formTableValue' item='subjectPublishAble'></td>   <td styles='formTableValue' colspan='2'></td></tr><tr>   <td></td>   <td styles='formTableValue' colspan='3'>       <div styles='formItemSpan' item='subjectPublishResult'></div> </td></tr><tr>   <td styles='formTableTitle' lable='replyPublishAble'></td>   <td styles='formTableValue' item='replyPublishAble'></td>   <td styles='formTableValue' colspan='2'></td></tr><tr>   <td></td>   <td styles='formTableValue' colspan='3'>       <div styles='formItemSpan' item='replyPublishResult'></div> </td></tr><tr>   <td styles='formTableTitle' lable='sectionGrade'></td>   <td styles='formTableValue' item='sectionGrade'></td>   <td styles='formTableValue' colspan='2'></td></tr></tr><tr item='indexRecommendTr' style='"+(this.data.sectionVisible==this.lp.byPermission?"display:none;":"display:;")+"'>   <td styles='formTableTitle' lable='indexRecommendable'></td>   <td styles='formTableValue' item='indexRecommendable'></td>   <td styles='formTableTitle' lable='indexRecommenPerson' style='"+(0==this.data.indexRecommendable?"display:none;":"display:;")+"'></td>   <td styles='formTableValue' item='indexRecommenPerson' style='"+(0==this.data.indexRecommendable?"display:none;":"display:;")+"'></td></tr></table>";this.permissionContainer.set("html",t);var e=[""],i=[""];this.app.restActions.listCategoryAllByAdmin(function(t){t.data.each(function(t){this.isNew?this.app.access.hasForumAdminAuthority(t)&&(e.push(t.forumName),i.push(t.id)):(e.push(t.forumName),i.push(t.id))}.bind(this))}.bind(this),null,!1),this.data.typeCategory?this.data.typeCatagory="string"==typeof this.data.typeCategory?this.data.typeCategory.split("|"):this.data.typeCategory:this.data.typeCatagory=this.lp.typeCategorySelectValue.split("|"),this.data.subjectTypeList&&this.data.subjectTypeList.length>0&&(this.data.subjectType=this.data.subjectTypeList.join("|")),this.data.sectionGrade&&(this.data.sectionGrade="是"),MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.formTableArea,this.data,{style:"forum",isEdited:this.isEdited||this.isNew,itemTemplate:{sectionName:{text:this.lp.sectionName,notEmpty:!0},forumId:{text:this.lp.owneForum,type:"select",selectText:e,selectValue:i,notEmpty:!0,isEdited:function(){return this.isNew}.bind(this)},sectionVisible:{text:this.lp.sectionVisible,type:"select",selectValue:this.lp.sectionVisibleValue.split(","),event:{change:function(t,e){this.setItemStyle(t,"sectionVisible"),t.getValue()==this.lp.allPerson?this.formTableArea.getElements("[item='indexRecommendTr']")[0].setStyle("display",""):this.formTableArea.getElements("[item='indexRecommendTr']")[0].setStyle("display","none")}.bind(this)}},sectionVisibleResult:{type:"org",orgType:["person","unit"],count:0,value:function(){return this.getRoleMemberByCode("SECTION_GUEST_")}.bind(this),style:this.getContainerStyle("sectionVisible")},subjectPublishAble:{text:this.lp.subjectPublishAble,type:"select",selectValue:this.lp.subjectPublishAbleValue.split(","),event:{change:function(t,e){this.setItemStyle(t,"subjectPublish")}.bind(this)}},subjectPublishResult:{type:"org",orgType:["person","unit"],count:0,value:function(){return this.getRoleMemberByCode("SECTION_SUBJECT_PUBLISHER_")}.bind(this),style:this.getContainerStyle("subjectPublishAble")},replyPublishAble:{text:this.lp.replyPublishAble,type:"select",selectValue:this.lp.replyPublishAbleValue.split(","),event:{change:function(t,e){this.setItemStyle(t,"replyPublish")}.bind(this)}},replyPublishResult:{type:"org",orgType:["person","unit"],count:0,value:function(){return this.getRoleMemberByCode("SECTION_REPLY_PUBLISHER_")}.bind(this),style:this.getContainerStyle("replyPublishAble")},indexRecommendable:{text:this.lp.indexRecommendable,type:"select",selectValue:["true","false"],selectText:this.lp.yesOrNo.split(","),defaultValue:"true",event:{change:function(t,e){var i="true"==t.getValue()?{display:""}:{display:"none"};this.permissionContainer.getElements("[item='indexRecommenPerson']")[0].setStyles(i),this.permissionContainer.getElements("[lable='indexRecommenPerson']")[0].setStyles(i)}.bind(this)}},indexRecommenPerson:{type:"org",text:this.lp.indexRecommenPerson,orgType:"person",count:0,value:function(){var t=this.getRoleMemberByCode("SECTION_RECOMMENDER_");return""==t?this.app.userName:t}.bind(this)},subjectNeedAudit:{text:this.lp.subjectNeedAudit,type:"select",selectValue:["true","false"],selectText:this.lp.yesOrNo.split(","),defaultValue:"false",event:{change:function(t,e){var i="true"==t.getValue()?{display:""}:{display:"none"};this.permissionContainer.getElements("[item='subjectAuditPerson']")[0].setStyles(i),this.permissionContainer.getElements("[lable='subjectAuditPerson']")[0].setStyles(i)}.bind(this)}},subjectAuditPerson:{type:"org",text:this.lp.auditPerson,orgType:"person",count:0,value:function(){return this.getRoleMemberByCode("SECTION_SUBJECT_AUDITOR_")}.bind(this)},replyNeedAudit:{text:this.lp.replyNeedAudit,type:"select",selectValue:["true","false"],selectText:this.lp.yesOrNo.split(","),defaultValue:"false",event:{change:function(t,e){var i="true"==t.getValue()?{display:""}:{display:"none"};this.permissionContainer.getElements("[item='replyAuditPerson']")[0].setStyles(i),this.permissionContainer.getElements("[lable='replyAuditPerson']")[0].setStyles(i)}.bind(this)}},replyAuditPerson:{type:"org",text:this.lp.auditPerson,orgType:"person",count:0,value:function(){return this.getRoleMemberByCode("SECTION_REPLY_AUDITOR_")}.bind(this)},moderatorNames:{type:"org",text:this.lp.moderatorNames,orgType:"person",count:0,defaultValue:this.app.userName},sectionType:{text:this.lp.sectionType,type:"select",selectValue:this.lp.sectionTypeValue.split(",")},creatorName:{text:this.lp.creatorName,type:"org",isEdited:!1,defaultValue:this.app.userName},createTime:{text:this.lp.createTime,type:"innerText"},sectionStatus:{text:this.lp.sectionStatus,type:"select",selectValue:this.lp.sectionStatusValue.split(",")},sectionGrade:{text:this.lp.sectionGrade,type:"select",selectValue:this.lp.sectionGradeValue.split(",")},orderNumber:{text:this.lp.orderNumber,tType:"number"},subjectType:{text:this.lp.subjectType,defaultValue:this.lp.subjectTypeDefaultValue},typeCatagory:{text:this.lp.typeCatagory,selectValue:this.lp.typeCategorySelectValue.split("|"),type:"checkbox",notEmpty:!0},sectionDescription:{text:this.lp.sectionDescription,type:"textarea",style:{height:"45px"}},sectionNotice:{text:this.lp.sectionNotice,type:"rtf",RTFConfig:{skin:"bootstrapck"}},sectionIcon:{text:this.lp.sectionIcon}}},this.app),this.form.load(),this.formTableArea.getElement("[lable='indexRecommenPerson']").setStyle("text-align","right"),this.createIconNode()}.bind(this),!0)},saveRole:function(t,e){var i=this.form.getResult(!0,null,!0,!1,!0);this.isNew&&(i.id=t),this.saveRoleMember(!0,"moderatorNames","SECTION_MANAGER_",i,!0);var s=i.sectionVisible!=this.lp.allPerson;this.saveRoleMember(s,"sectionVisibleResult","SECTION_GUEST_",i),s=i.subjectPublishAble!=this.lp.allPerson,this.saveRoleMember(s,"subjectPublishResult","SECTION_SUBJECT_PUBLISHER_",i),s=i.replyPublishAble!=this.lp.allPerson,this.saveRoleMember(s,"replyPublishResult","SECTION_REPLY_PUBLISHER_",i),s="true"==i.indexRecommendable,this.saveRoleMember(s,"indexRecommenPerson","SECTION_RECOMMENDER_",i,!0),s="true"==i.subjectNeedAudit,this.saveRoleMember(s,"subjectAuditPerson","SECTION_SUBJECT_AUDITOR_",i,!0),s="true"==i.replyNeedAudit,this.saveRoleMember(s,"replyAuditPerson","SECTION_REPLY_AUDITOR_",i,!0),e&&e()},saveRoleMember:function(t,e,i,s,o,n){var l=[];t&&(o?s[e]&&s[e].each((function(t){""!=t&&l.push({objectName:t,objectType:"人员"})})):s[e]&&s[e].each((function(t){switch(t.substr(t.length-1,1).toLowerCase()){case"p":l.push({objectName:t,objectType:"人员"});break;case"u":l.push({objectName:t,objectType:"组织"});break;default:l.push({objectName:t,objectType:"人员"})}})));var a={bindObjectArray:l,bindRoleCode:i+this.data.id};this.app.restActions.bindRole(a,function(t){n&&n(json)}.bind(this))},getRoleMemberByCode:function(t){if(this.RoleMember||(this.RoleMember={}),this.RoleMember[t])return this.RoleMember[t];var e=this.RoleMember[t]=[];return this.data.id?(this.RoleMember[t]=e,this.data&&this.data.id&&this.actions.listRoleMemberByCode({bindRoleCode:t+this.data.id},(function(t){t.data=t.data||[],t.data.each(function(t){e.push(t.objectName)}.bind(this))}),(function(){}),!1),e):e},getButtonStyle:function(t){return this.isEdited||this.isNew?this.getContainerStyle(t):{display:"none"}},getContainerStyle:function(t){return this.data[t]&&this.data[t]!=this.lp.allPerson?{display:""}:{display:"none"}},setItemStyle:function(t,e){var i=t.getValue()==this.lp.allPerson?{display:"none"}:{display:""};t.form.getItem(e+"Result").setStyles(i)},createIconNode:function(){var t="../x_component_Forum/$Setting/"+this.options.style+"/sectionIcon/"+"forum_icon.png",e=this.formTableArea.getElements("[item='sectionIconArea']")[0];(this.iconNode=new Element("img",{styles:this.css.iconNode}).inject(e),this.data.icon?this.iconNode.set("src","data:image/png;base64,"+this.data.icon):this.iconNode.set("src",t),this.isEdited||this.isNew)&&new Element("div",{styles:this.css.changeIconActionNode,text:this.lp.uploadIcon}).inject(e).addEvent("click",function(){this.changeIcon()}.bind(this))},selectIcon:function(){new MWF.xApplication.Forum.Setting.SectionIconForm(this,{},{onPostOk:function(t){this.formData&&(this.formData=null),this.iconNode.set("src",t.path)}.bind(this)}).edit()},changeIcon:function(){if(!this.uploadFileAreaNode){this.uploadFileAreaNode=new Element("div");this.uploadFileAreaNode.set("html",'<input name="file" type="file"/>'),this.fileUploadNode=this.uploadFileAreaNode.getFirst(),this.fileUploadNode.addEvent("change",function(){var e=t.files;if(e.length)for(var i=0;i<e.length;i++){var s=e.item(i);if(s.type.match("image.*")&&(this.file=s,this.formData=new FormData,this.formData.append("file",this.file),window.FileReader)){var o=new FileReader;o.onload=function(t){return function(t){this.iconNode.set("src",t.target.result)}.bind(this)}.bind(this)(s),o.readAsDataURL(s)}}}.bind(this))}var t=this.uploadFileAreaNode.getFirst();t.click()},saveIcon:function(t,e){this.app.restActions.uploadSectionIcon(t,function(){e&&e()}.bind(this),null,this.formData,this.file)},_ok:function(t,e){"string"===typeOf(t.moderatorNames)&&(t.moderatorNames=t.moderatorNames.split(",")),t.sectionLevel=MWF.xApplication.Forum.LP.mainSection,t.typeCategory=t.typeCatagory.split(",").join("|");var i=t.subjectType;(i=i.replace(/[^\x00-\xff]/g,"xx"))&&i.length>255&&(t.subjectType=this.lp.subjectTypeDefaultValue),t.sectionGrade&&"是"===t.sectionGrade&&(t.sectionGrade=!0),this.app.restActions.saveSection(t,function(t){this.formData?this.saveIcon(t.data.id,function(){this.saveRole(t.data.id,function(i){e&&e(t)}.bind(this))}.bind(this)):this.saveRole(t.data.id,function(i){e&&e(t)}.bind(this)),this.fireEvent("postOk")}.bind(this))},setFormNodeSize:function(t,e,i,s){t||(t=this.options.width?this.options.width:"50%"),e||(e=this.options.height?this.options.height:"50%"),i||(i=this.options.top?this.options.top:0),s||(s=this.options.left?this.options.left:0);var o=this.app.content.getSize(),n=o.x,l=o.y;"string"==typeof t&&1<t.length&&"%"==t.substr(t.length-1,1)&&(t=parseInt(n*parseInt(t,10)/100,10)),"string"==typeof e&&1<e.length&&"%"==e.substr(e.length-1,1)&&(e=parseInt(l*parseInt(e,10)/100,10)),300>t&&(t=300),220>e&&(e=220),i=i||parseInt((l-e)/2,10),s=s||parseInt((n-t)/2,10),this.formAreaNode.setStyles({width:t+"px",height:e+"px",top:i+"px",left:s+"px"}),this.formNode.setStyles({width:t+"px",height:e+"px"});var a=this.formIconNode?this.formIconNode.getSize():{x:0,y:0},r=this.formTopNode?this.formTopNode.getSize():{x:0,y:0},d=this.formBottomNode?this.formBottomNode.getSize():{x:0,y:0},c=this.toolbar?this.toolbar.getSize():{x:0,y:0},h=e-a.y-r.y-d.y-c.y;this.formContentNode.setStyles({height:h+"px"}),this.formTableContainer.setStyles({height:h+"px"})}}),MWF.xApplication.Forum.Setting.SectionIconForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"default",width:"650",height:"400",hasTop:!0,hasIcon:!1,hasTopIcon:!0,hasTopContent:!0,hasBottom:!1,title:MWF.xApplication.Forum.LP.sectionIconFormTitle,draggable:!0,closeAction:!0},_createTableContent:function(){var t="../x_component_Forum/$Setting/"+this.options.style+"/sectionIcon/",e=new Element("div",{styles:this.css.sectionFormContent}).inject(this.formTableArea);MWF.getJSON("../x_component_Forum/$Setting/sectionIcon.json",function(i){i.icons.each(function(i,s){var o=new Element("div",{styles:this.css.iconAreaNode}).inject(e);new Element("img",{styles:this.css.iconSelectNode,src:t+i}).inject(o);o.store("iconName",i),o.store("iconPath",t+i),o.addEvents({mouseover:function(){this.node.setStyles(this.obj.css.iconAreaNodeOver)}.bind({obj:this,node:o}),mouseout:function(){this.node.setStyles(this.obj.css.iconAreaNode)}.bind({obj:this,node:o}),click:function(){var t={path:this.node.retrieve("iconPath"),name:this.node.retrieve("iconName")};this.obj.fireEvent("postOk",t),this.obj.close()}.bind({obj:this,node:o})})}.bind(this))}.bind(this))}}),MWF.xApplication.Forum.Setting.SystemSettingExplorer=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(t,e,i,s){this.container=t,this.parent=i,this.app=e,this.css=this.parent.css,this.lp=this.app.lp},load:function(){this.container.empty(),this.loadView()},destroy:function(){this.resizeWindowFun&&this.app.removeEvent("resize",this.resizeWindowFun),this.view.destroy()},loadView:function(){this.viewContainer=Element("div",{styles:this.css.viewContainer}).inject(this.container),this.resizeWindow(),this.resizeWindowFun=this.resizeWindow.bind(this),this.app.addEvent("resize",this.resizeWindowFun),this.view=new MWF.xApplication.Forum.Setting.SystemSettingView(this.viewContainer,this.app,this,{templateUrl:this.parent.path+"listItemSystem.json",scrollEnable:!0}),this.view.load()},resizeWindow:function(){var t=this.container.getSize();this.viewContainer.setStyles({height:t.y+"px"})}}),MWF.xApplication.Forum.Setting.SystemSettingView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t){return new MWF.xApplication.Forum.Setting.SystemSettingDocument(this.viewNode,t,this.explorer,this)},_getCurrentPageData:function(t,e){e||(e=20),this.actions.listSystemSettingAll(function(e){t&&t(e)}.bind(this))},_removeDocument:function(t,e){},_openDocument:function(t){var e=new MWF.xApplication.Forum.Setting.SystemSettingForm(this,t,{onPostOk:function(){this.reload()}.bind(this)});MWF.AC.isBBSManager()?e.edit():e.open()}}),MWF.xApplication.Forum.Setting.SystemSettingDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){}}),MWF.xApplication.Forum.Setting.SystemSettingForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"default",width:"600",height:"320",hasTop:!0,hasIcon:!1,hasTopIcon:!0,hasTopContent:!0,hasBottom:!0,title:MWF.xApplication.Forum.LP.systemSettingFormTitle,draggable:!0,closeAction:!0},_createTableContent:function(){this.formTableArea.set("html","<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'><tr><td styles='formTableTitle' lable='configName' width='20%'></td>    <td styles='formTableValue' item='configName' width='80%'></td></tr><tr><td styles='formTableTitle' lable='configValue'></td>    <td styles='formTableValue' item='configValue'></td></tr><tr><td styles='formTableTitle' lable='orderNumber'></td>    <td styles='formTableValue' item='orderNumber'></td></tr><tr><td styles='formTableTitle' lable='description'></td>    <td styles='formTableValue' item='description'></td></tr></table>");var t={text:this.lp.configValue,tType:"text"};MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.formTableArea,this.data,{style:"execution",isEdited:this.isEdited||this.isNew,itemTemplate:{configName:{text:this.lp.configName,type:"innerText"},configValue:t,orderNumber:{text:this.lp.orderNumber,type:"innerText"},description:{text:this.lp.description,type:"innerText"}}},this.app),this.form.load()}.bind(this),!0)},_ok:function(t,e){this.app.restActions.saveSystemSetting(t,function(t){e&&e(t),this.fireEvent("postOk")}.bind(this))}}),MWF.xApplication.Forum.Setting.SelectOrgForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"default",width:"900",height:"230",hasTop:!0,hasIcon:!1,hasTopIcon:!0,hasTopContent:!0,hasBottom:!0,title:MWF.xApplication.Forum.LP.SelectOrgForm,draggable:!0,closeAction:!0},_createTableContent:function(){this.formTableArea.set("html","<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'><tr><td styles='formTableTitle' lable='person' width='15%'></td>    <td styles='formTableValue' item='person' colspan='3' width='85%'></td></tr><tr><td styles='formTableTitle' lable='unit'></td>    <td styles='formTableValue' item='unit' colspan='3'></td></tr></table>"),MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.formTableArea,this.data,{style:"forum",isEdited:this.isEdited||this.isNew,itemTemplate:{person:{type:"org",text:this.lp.selectPerson,orgType:"person",count:0},unit:{type:"org",text:this.lp.selectDepartment,orgType:"unit",count:0}}},this.app),this.form.load()}.bind(this),!1)},_ok:function(t,e){var i=[];t.person.split(",").each((function(t){i.push(t+"#人员")})),t.department.split(",").each((function(t){i.push(t+"#组织")})),t.company.split(",").each((function(t){i.push(t+"#组织")})),this.app.restActions.saveRole(t,function(s){this.app.restActions.getRole(t.id,(function(t){var o={bindObjectArray:i,bindRoleCode:t.roleCode};this.app.restActions.bindRole(o,function(t){e&&e(s),this.fireEvent("postOk")}.bind(this))}))}.bind(this))}});