window.MWFForum=window.MWFForum||MWF.xApplication.Forum,MWFForum.NaviType={main:"main",all:"all",recommand:"recommand",cream:"cream",category:"category",section:"section"},MWF.xApplication.Forum.NaviMode=MWFForum.NaviMode=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",id:"",type:MWFForum.NaviType.all},initialize:function(t,e,i){this.setOptions(i),this.path="../x_component_Forum/$NaviMode/",this.cssPath="../x_component_Forum/$NaviMode/"+this.options.style+"/css.wcss",this._loadCss(),this.app=t,this.container=$(e)},load:function(){this.naviContainer=new Element("div.naviContainer",{styles:this.css.naviContainer}).inject(this.container),this.naviNode=new Element("div.naviNode",{styles:this.css.naviNode}).inject(this.naviContainer),this.viewContainer=new Element("div.viewContainer",{styles:this.css.viewContainer}).inject(this.container),this.allItem=new MWFForum.NaviMode.AllItem(this,this.naviNode),this.recommandItem=new MWFForum.NaviMode.RecommandItem(this,this.naviNode),this.creamItem=new MWFForum.NaviMode.CreamItem(this,this.naviNode),this.categoryItemList=[],this.categoryItemMap={},this.sectionItemMap={},MWF.Actions.get("x_bbs_assemble_control").listCategoryAll(function(t){(t.data||[]).each(function(t){var e=new MWFForum.NaviMode.CategoryItem(this,this.naviNode,t);this.categoryItemList.push(e),this.categoryItemMap[t.id]=e,this.fireEvent("postLoad")}.bind(this))}.bind(this)),this.setNodeSizeFun=function(){this.setNodeSize()}.bind(this),this.app.addEvent("resize",this.setNodeSizeFun),this.setNodeSize()},close:function(){this.back()},setTitle:function(t){var e=this.app.inBrowser&&MWFForum.getSystemConfigValue(MWFForum.BBS_TITLE_TAIL)||"";this.app.setTitle(t+e)},back:function(t){var e=this.currentItem;switch(t||(t=e?e.type:"main"),this.view&&this.view.destroy(),this.app.clearContent(),this.app.node&&this.app.node.destroy(),t){case MWFForum.NaviType.category:MWF.xDesktop.requireApp("ForumCategory","MainInContainer",null,!1);var i=new MWF.xApplication.ForumCategory.MainInContainer(this.app.desktop,{hasTop:!0,hasBreadCrumb:!0,categoryId:e.data.id,naviMode:!1,autoWidth:!1},this.app.content,this.app.content,this.app.content);i.inBrowser=this.app.inBrowser,i.window=this.app.window,i.taskitem=this.app.taskitem,i.load(),this.setTitle(e.data.forumName),this.destroy();break;case MWFForum.NaviType.section:MWF.xDesktop.requireApp("ForumSection","MainInContainer",null,!1);var s=new MWF.xApplication.ForumSection.MainInContainer(this.app.desktop,{hasTop:!0,hasBreadCrumb:!0,sectionId:e.data.id,naviMode:!1,autoWidth:!1},this.app.content,this.app.content,this.app.content);s.inBrowser=this.app.inBrowser,s.window=this.app.window,s.taskitem=this.app.taskitem,s.load(),this.setTitle(e.data.sectionName),this.destroy();break;default:MWF.xDesktop.requireApp("Forum","MainInContainer",null,!1);var n=new MWF.xApplication.Forum.MainInContainer(this.app.desktop,{hasTop:!0,hasBreadCrumb:!0,naviMode:!1,autoWidth:!1},this.app.content,this.app.content,this.app.content);n.inBrowser=this.app.inBrowser,n.window=this.app.window,n.taskitem=this.app.taskitem,n.load(),this.setTitle(MWFForum.getBBSName()||MWF.xApplication.Forum.LP.title),this.destroy()}},goto:function(t,e){switch(t){case MWFForum.NaviType.main:this.back(MWFForum.NaviType.main);break;case MWFForum.NaviType.all:this.allItem.setCurrent();break;case MWFForum.NaviType.recommand:this.recommandItem.setCurrent();break;case MWFForum.NaviType.cream:this.creamItem.setCurrent();break;case MWFForum.NaviType.category:var i=this.categoryItemMap[e];i&&i.setCurrent();break;case MWFForum.NaviType.section:var s=this.sectionItemMap[e];s&&s.setCurrent()}},scrollToTop:function(){this.app.contentContainerNode.scrollTo(0,0)},setNodeSize:function(){var t=this.app.node.getSize(),e=this.app.topObject?this.app.topObject.topContainerNode.getSize():{x:0,y:0},i=this.app.contentContainerNode.getStyle("padding-top").toFloat(),s=this.app.contentContainerNode.getStyle("padding-bottom").toFloat(),n=t.y-i-s;this.app.contentContainerNode.setStyle("height",n+"px");var o=t.y-e.y-20,a=this.naviNode.getSize(),r=this.viewContainer.getFirst(),d=r?r.getSize():{x:0,y:0};this.naviContainer.setStyle("min-height",Math.max(o,a.y,d.y)),this.viewContainer.setStyle("min-height",Math.max(o,a.y,d.y))},destroy:function(){this.setNodeSizeFun&&this.app.removeEvent("resize",this.setNodeSizeFun),this.naviNode&&this.naviNode.destroy()}}),MWFForum.NaviMode.CategoryItem=new Class({initialize:function(t,e,i){this.type=MWFForum.NaviType.category,this.navi=t,this.app=t.app,this.data=i,this.container=$(e),this.css=t.css,this.load()},load:function(){var t=this;this.isCurrent=!1,this.isExpended=!0,this.hasSub=!0,this.sectionItemList=[],this.navi.options.id==this.data.id&&this.navi.options.type==MWFForum.NaviType.category&&(this.isCurrent=!0),this.node=new Element("div.categoryNode",{styles:this.css.categoryNode}).inject(this.container),this.expendNode=new Element("div.categoryExpendNode").inject(this.node),this.setExpendNodeStyle(),this.hasSub&&this.expendNode.addEvent("click",function(t){this.triggerExpend(),t.stopPropagation()}.bind(this)),this.textNode=new Element("div.categoryTextNode",{styles:this.css.categoryTextNode,text:this.data.forumName}).inject(this.node),this.node.addEvents({mouseover:function(){t.isCurrent||(this.setStyles(t.css.categoryNode_over),t.setExpendNodeStyle(!0))},mouseout:function(){t.isCurrent||(this.setStyles(t.css.categoryNode),t.setExpendNodeStyle())},click:function(){t.setCurrent(this)}}),this.listNode=new Element("div.sectionListNode",{styles:this.css.sectionListNode}).inject(this.container),this.loadListContent(),this.isCurrent&&this.setCurrent()},setExpendNodeStyle:function(t){var e;e=this.hasSub?this.isExpended?t?this.css.categoryExpendNode_over:this.isCurrent?this.css.categoryExpendNode_selected:this.css.categoryExpendNode:t?this.css.categoryCollapseNode_over:this.isCurrent?this.css.categoryCollapseNode_selected:this.css.categoryCollapseNode:this.css.emptyExpendNode,this.expendNode.setStyles(e)},triggerExpend:function(){this.hasSub&&(this.isExpended?(this.isExpended=!1,this.listNode.setStyle("display","none")):(this.isExpended=!0,this.listNode.setStyle("display","")),this.setExpendNodeStyle())},setCurrent:function(){this.navi.currentItem&&this.navi.currentItem.cancelCurrent(),this.node.setStyles(this.css.categoryNode_selected),this.hasSub&&(this.isExpended?this.expendNode.setStyles(this.css.categoryExpendNode_selected):this.expendNode.setStyles(this.css.categoryCollapseNode_selected)),this.isCurrent=!0,this.navi.currentItem=this,this.navi.setTitle(this.data.forumName),this.loadView()},cancelCurrent:function(){this.isCurrent=!1,this.node.setStyles(this.css.categoryNode),this.hasSub&&(this.isExpended?this.expendNode.setStyles(this.css.categoryExpendNode):this.expendNode.setStyles(this.css.categoryCollapseNode))},loadView:function(t){this.app.openView(this,this.data,this.viewData||this.defaultRevealData,t||"",this)},loadListContent:function(){var t=this.data;t.forumStatus!=MWF.xApplication.Forum.LP.disable&&MWF.Actions.get("x_bbs_assemble_control").listSection(t.id,function(t){(t.data||[]).each(function(t){var e=new MWFForum.NaviMode.SectionItem(this.navi,this,this.listNode,t);this.sectionItemList.push(e)}.bind(this))}.bind(this)),new Element("div",{styles:this.css.categorySepartorNode}).inject(this.listNode)},getCategoryId:function(){return this.data.id},loadView:function(){this.navi.view&&this.navi.view.destroy(),this.navi.viewContainer.empty(),MWF.xDesktop.requireApp("ForumCategory","MainInContainer",null,!1);var t=this.navi.viewContainer,e=this.app.content,i=this.navi.view=new MWF.xApplication.ForumCategory.MainInContainer(this.app.desktop,{hasTop:!1,hasBreadCrumb:!0,categoryId:this.data.id,naviMode:!0,autoWidth:!0,onPostLoadCategory:function(){this.navi.setNodeSize(),this.navi.scrollToTop()}.bind(this)},t,this.app.content,e);i.forumNavi=this.navi,i.inBrowser=this.navi.app.inBrowser,i.window=this.app.window,i.taskitem=this.navi.app.taskitem,i.load()}}),MWFForum.NaviMode.SectionItem=new Class({initialize:function(t,e,i,s){this.type=MWFForum.NaviType.section,this.navi=t,this.category=e,this.app=t.app,this.data=s,this.container=$(i),this.css=t.css,this.load()},load:function(){this.navi.sectionItemMap[this.data.id]=this;this.isCurrent=!1,this.navi.options.type==MWFForum.NaviType.section&&this.navi.options.id==this.data.id&&(this.isCurrent=!0);var t=this;this.node=new Element("div.sectionNode",{styles:this.css.sectionNode,text:this.data.sectionName}).inject(this.container),this.node.addEvents({mouseover:function(){t.isCurrent||this.setStyles(t.css.sectionNode_over)},mouseout:function(){t.isCurrent||this.setStyles(t.css.sectionNode)},click:function(e){t.setCurrent()}}),this.isCurrent&&this.setCurrent()},setCurrent:function(){this.navi.currentItem&&this.navi.currentItem.cancelCurrent(),this.node.setStyles(this.css.sectionNode_selected),this.isCurrent=!0,this.navi.currentItem=this,this.navi.setTitle(this.data.sectionName),this.loadView()},cancelCurrent:function(){this.isCurrent=!1,this.node.setStyles(this.css.sectionNode)},getCategoryId:function(){return this.category.data.id},loadView:function(){this.navi.view&&this.navi.view.destroy(),this.navi.viewContainer.empty(),MWF.xDesktop.requireApp("ForumSection","MainInContainer",null,!1);var t=this.navi.viewContainer,e=this.app.content,i=this.navi.view=new MWF.xApplication.ForumSection.MainInContainer(this.app.desktop,{hasTop:!1,hasBreadCrumb:!0,sectionId:this.data.id,naviMode:!0,autoWidth:!0,onPostCreateViewBody:function(){this.navi.setNodeSize(),this.navi.scrollToTop()}.bind(this)},t,this.app.content,e);i.forumNavi=this.navi,i.inBrowser=this.navi.app.inBrowser,i.window=this.navi.app.window,i.taskitem=this.navi.app.taskitem,i.load()}}),MWFForum.NaviMode.AllItem=new Class({initialize:function(t,e){this.type=MWFForum.NaviType.all,this.navi=t,this.app=t.app,this.container=$(e),this.css=t.css,this.load()},load:function(){this.isCurrent=!1,this.navi.options.type==MWFForum.NaviType.all&&(this.isCurrent=!0);var t=this;this.node=new Element("div.allNode",{styles:this.css.allNode,text:MWF.xApplication.Forum.LP.all1}).inject(this.container),this.node.addEvents({mouseover:function(){t.isCurrent||this.setStyles(t.css.allNode_over)},mouseout:function(){t.isCurrent||this.setStyles(t.css.allNode)},click:function(e){t.setCurrent()}}),this.isCurrent&&this.setCurrent()},setCurrent:function(){this.navi.currentItem&&this.navi.currentItem.cancelCurrent(),this.node.setStyles(this.css.allNode_selected),this.isCurrent=!0,this.navi.currentItem=this,this.navi.setTitle(MWF.xApplication.Forum.LP.allSubject),this.loadView()},cancelCurrent:function(){this.isCurrent=!1,this.node.setStyles(this.css.allNode)},getCategoryId:function(){return null},loadView:function(){this.navi.view&&this.navi.view.destroy(),this.navi.viewContainer.empty(),this.viewWarp=new Element("div").inject(this.navi.viewContainer);var t=this.topNode=new Element("div.topNode",{styles:this.css.topNode}).inject(this.viewWarp),e=new Element("div.topTitleMiddleNode",{styles:this.css.topTitleMiddleNode}).inject(t),i=new Element("div.topItemTitleNode",{styles:this.css.topItemTitleNode,text:MWFForum.getBBSName()||MWF.xApplication.Forum.LP.title}).inject(e);new Element("div.topItemSepNode",{styles:this.css.topItemSepNode,text:">"}).inject(e);i.addEvent("click",function(){this.navi.goto(MWFForum.NaviType.main)}.bind(this));i=new Element("div.topItemTitleNode",{styles:this.css.topItemTitleLastNode,text:MWF.xApplication.Forum.LP.allSubject}).inject(e);var s=this.navi.view=new MWFForum.NaviMode.AllView(this.viewWarp,this.app,this,{templateUrl:this.navi.path+this.navi.options.style+"/listItem.json",pagingEnable:!0,pagingPar:{hasReturn:!1,currentPage:this.navi.options.viewPageNum,countPerPage:30},onPostCreateViewBody:function(){this.navi.setNodeSize(),this.navi.scrollToTop()}.bind(this)});s.pagingContainerTop=this.pagingBarTop,s.pagingContainerBottom=this.pagingBarBottom,s.load()}}),MWFForum.NaviMode.RecommandItem=new Class({initialize:function(t,e){this.type=MWFForum.NaviType.recommand,this.navi=t,this.app=t.app,this.container=$(e),this.css=t.css,this.load()},load:function(){this.isCurrent=!1,this.navi.options.type==MWFForum.NaviType.recommand&&(this.isCurrent=!0);var t=this;this.node=new Element("div.recommandNode",{styles:this.css.recommandNode,text:MWF.xApplication.Forum.LP.recommanded}).inject(this.container),this.node.addEvents({mouseover:function(){t.isCurrent||this.setStyles(t.css.recommandNode_over)},mouseout:function(){t.isCurrent||this.setStyles(t.css.recommandNode)},click:function(e){t.setCurrent()}}),this.isCurrent&&this.setCurrent()},setCurrent:function(){this.navi.currentItem&&this.navi.currentItem.cancelCurrent(),this.node.setStyles(this.css.recommandNode_selected),this.isCurrent=!0,this.navi.currentItem=this,this.navi.setTitle(MWF.xApplication.Forum.LP.recommandedSubject),this.loadView()},cancelCurrent:function(){this.isCurrent=!1,this.node.setStyles(this.css.recommandNode)},getCategoryId:function(){return null},loadView:function(){this.navi.view&&this.navi.view.destroy(),this.navi.viewContainer.empty(),this.viewWarp=new Element("div").inject(this.navi.viewContainer);var t=this.topNode=new Element("div.topNode",{styles:this.css.topNode}).inject(this.viewWarp),e=new Element("div.topTitleMiddleNode",{styles:this.css.topTitleMiddleNode}).inject(t),i=new Element("div.topItemTitleNode",{styles:this.css.topItemTitleNode,text:MWFForum.getBBSName()||MWF.xApplication.Forum.LP.title}).inject(e);new Element("div.topItemSepNode",{styles:this.css.topItemSepNode,text:">"}).inject(e);i.addEvent("click",function(){this.navi.goto(MWFForum.NaviType.main)}.bind(this));i=new Element("div.topItemTitleNode",{styles:this.css.topItemTitleLastNode,text:MWF.xApplication.Forum.LP.recommandedSubject}).inject(e);var s=this.navi.view=new MWFForum.NaviMode.RecommandView(this.viewWarp,this.app,this,{templateUrl:this.navi.path+this.navi.options.style+"/listItem.json",pagingEnable:!0,pagingPar:{hasReturn:!1,currentPage:this.navi.options.viewPageNum,countPerPage:30},onPostCreateViewBody:function(){this.navi.setNodeSize(),this.navi.scrollToTop()}.bind(this)});s.pagingContainerTop=this.pagingBarTop,s.pagingContainerBottom=this.pagingBarBottom,s.load()}}),MWFForum.NaviMode.CreamItem=new Class({initialize:function(t,e){this.type=MWFForum.NaviType.cream,this.navi=t,this.app=t.app,this.container=$(e),this.css=t.css,this.load()},load:function(){this.isCurrent=!1,this.navi.options.type==MWFForum.NaviType.cream&&(this.isCurrent=!0);var t=this;this.node=new Element("div.cream",{styles:this.css.recommandNode,text:MWF.xApplication.Forum.LP.prime}).inject(this.container),this.node.addEvents({mouseover:function(){t.isCurrent||this.setStyles(t.css.recommandNode_over)},mouseout:function(){t.isCurrent||this.setStyles(t.css.recommandNode)},click:function(e){t.setCurrent()}}),this.isCurrent&&this.setCurrent()},setCurrent:function(){this.navi.currentItem&&this.navi.currentItem.cancelCurrent(),this.node.setStyles(this.css.recommandNode_selected),this.isCurrent=!0,this.navi.currentItem=this,this.navi.setTitle(MWF.xApplication.Forum.LP.primeSubject),this.loadView()},cancelCurrent:function(){this.isCurrent=!1,this.node.setStyles(this.css.recommandNode)},getCategoryId:function(){return null},loadView:function(){this.navi.view&&this.navi.view.destroy(),this.navi.viewContainer.empty(),this.viewWarp=new Element("div").inject(this.navi.viewContainer);var t=this.topNode=new Element("div.topNode",{styles:this.css.topNode}).inject(this.viewWarp),e=new Element("div.topTitleMiddleNode",{styles:this.css.topTitleMiddleNode}).inject(t),i=new Element("div.topItemTitleNode",{styles:this.css.topItemTitleNode,text:MWFForum.getBBSName()||MWF.xApplication.Forum.LP.title}).inject(e);new Element("div.topItemSepNode",{styles:this.css.topItemSepNode,text:">"}).inject(e);i.addEvent("click",function(){this.navi.goto(MWFForum.NaviType.main)}.bind(this));i=new Element("div.topItemTitleNode",{styles:this.css.topItemTitleLastNode,text:MWF.xApplication.Forum.LP.primeSubject}).inject(e);var s=this.navi.view=new MWFForum.NaviMode.CreamView(this.viewWarp,this.app,this,{templateUrl:this.navi.path+this.navi.options.style+"/listItem.json",pagingEnable:!0,pagingPar:{hasReturn:!1,currentPage:this.navi.options.viewPageNum,countPerPage:30},onPostCreateViewBody:function(){this.navi.setNodeSize(),this.navi.scrollToTop()}.bind(this)});s.pagingContainerTop=this.pagingBarTop,s.pagingContainerBottom=this.pagingBarBottom,s.load()}}),MWFForum.NaviMode.AllView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t,e){return new MWFForum.NaviMode.Document(this.viewNode,t,this.explorer,this,null,e)},_getCurrentPageData:function(t,e,i){this.clearBody(),e||(e=30),i||(i=1);var s=this.filterData||{};this.actions.listSubjectFilterPage(i,e,s,function(e){e.data||(e.data=[]),e.count||(e.count=0),t&&t(e)}.bind(this))},_removeDocument:function(t,e){this.actions.deleteSubject(t.id,function(e){this.reload(),this.app.reloadAllParents(t.sectionId),this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_openDocument:function(t,e){var i="ForumDocument"+t.id;this.app.desktop.apps[i]?this.app.desktop.apps[i].setCurrent():this.app.desktop.openApplication(null,"ForumDocument",{sectionId:t.sectionId,id:t.id,appId:i,isEdited:!1,isNew:!1,index:e})},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){},isAdmin:function(){return!1}}),MWFForum.NaviMode.RecommandView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t,e){return new MWFForum.NaviMode.Document(this.viewNode,t,this.explorer,this,null,e)},_getCurrentPageData:function(t,e,i){this.clearBody(),e||(e=30),i||(i=1);var s=this.filterData||{subjectId:"",voteOptionId:"",forumId:"",mainSectionId:"",sectionId:"",searchContent:"",creatorName:"",needPicture:"",withTopSubject:!0};this.actions.listRecommendedPage(i,e,s,function(e){e.data||(e.data=[]),e.count||(e.count=0),t&&t(e)}.bind(this))},_removeDocument:function(t,e){this.actions.deleteSubject(t.id,function(e){this.reload(),this.app.reloadAllParents(t.sectionId),this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_openDocument:function(t,e){var i="ForumDocument"+t.id;this.app.desktop.apps[i]?this.app.desktop.apps[i].setCurrent():this.app.desktop.openApplication(null,"ForumDocument",{sectionId:t.sectionId,id:t.id,appId:i,isEdited:!1,isNew:!1,index:e})},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){}}),MWFForum.NaviMode.CreamView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t,e){return new MWFForum.NaviMode.Document(this.viewNode,t,this.explorer,this,null,e)},_getCurrentPageData:function(t,e,i){this.clearBody(),e||(e=30),i||(i=1);var s=this.filterData||{};this.actions.listCreamSubjectFilterPage(i,e,s,function(e){e.data||(e.data=[]),e.count||(e.count=0),t&&t(e)}.bind(this))},_removeDocument:function(t,e){this.actions.deleteSubject(t.id,function(e){this.reload(),this.app.reloadAllParents(t.sectionId),this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_openDocument:function(t,e){var i="ForumDocument"+t.id;this.app.desktop.apps[i]?this.app.desktop.apps[i].setCurrent():this.app.desktop.openApplication(null,"ForumDocument",{sectionId:t.sectionId,id:t.id,appId:i,isEdited:!1,isNew:!1,index:e})},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){}}),MWFForum.NaviMode.Document=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){},open:function(t){this.view._openDocument(this.data,this.index)},edit:function(){var t="ForumDocument"+this.data.id;this.app.desktop.apps[t]?this.app.desktop.apps[t].setCurrent():this.app.desktop.openApplication(null,"ForumDocument",{sectionId:this.data.sectionId,id:this.data.id,appId:t,isEdited:!0,isNew:!1,index:this.index})},openSection:function(t){var e=this.data;if(this.view.explorer&&this.view.explorer.navi)this.view.explorer.navi.goto(MWFForum.NaviType.section,e.sectionId);else{var i="ForumSection"+e.sectionId;this.app.desktop.apps[i]?this.app.desktop.apps[i].setCurrent():this.app.desktop.openApplication(t,"ForumSection",{sectionId:e.sectionId,appId:i})}t.stopPropagation()},isAdmin:function(){return this.app.access.isAdmin()}});