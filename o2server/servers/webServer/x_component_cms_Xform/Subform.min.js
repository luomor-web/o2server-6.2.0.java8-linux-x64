MWF.xDesktop.requireApp("process.Xform","Subform",null,!1),MWF.xApplication.cms.Xform.Subform=MWF.CMSSubform=new Class({Extends:MWF.APPSubform,getSubform:function(s){if("script"===this.json.subformType){if(this.json.subformScript&&this.json.subformScript.code){var t,o=this.form.Macro.exec(this.json.subformScript.code,this);if(o)"string"===typeOf(o)?t=o:(o.application&&(e=o.application),o.subform&&(t=o.subform)),t?(e||(e=this.form.businessData.document.appId||this.form.businessData.document.application),MWF.Actions.get("x_cms_assemble_control").getFormWithColumn(t,e,function(t){this.getSubformData(t.data),s&&s()}.bind(this))):s&&s();else s&&s()}}else if(this.json.subformSelected&&"none"!==this.json.subformSelected){var e,i=this.form.app.relatedFormMap?this.form.app.relatedFormMap[this.json.subformSelected]:null;if(i)this.getSubformData({data:i.data}),s&&s();else e=this.json.subformAppSelected?this.json.subformAppSelected:this.form.businessData.document.appId||this.form.businessData.document.application,MWF.Actions.get("x_cms_assemble_control").getFormWithColumn(this.json.subformSelected,e,function(t){this.getSubformData(t.data),s&&s()}.bind(this))}else s&&s()}});