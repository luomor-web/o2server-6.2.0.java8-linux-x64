MWF.xDesktop.requireApp("Template","MPopupForm",null,!1),MWF.xApplication.cms=MWF.xApplication.cms||{},MWF.xApplication.cms.Index=MWF.xApplication.cms.Index||{},MWF.require("MWF.xAction.org.express.RestActions",null,!1),MWF.require("MWF.widget.Mask",null,!1),MWF.xApplication.cms.Index.Newer=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"default",popupStyle:"o2platform",width:"850",height:"510",hasTop:!0,hasIcon:!1,hasTopContent:!0,hasBottom:!1,draggable:!0,closeAction:!0,latest:!0,ignoreTitle:!1,ignoreDrafted:!1,selectColumnEnable:!0,restrictToColumn:!1,documentData:null,identity:null,categoryFlag:"",columnFlag:"",appFlag:""},initialize:function(t,e,s,i,n){this.path="../x_component_cms_Index/$Newer/",this.cssPath="../x_component_cms_Index/$Newer/"+this.options.style+"/css.wcss",this._loadCss(),MWF.xDesktop.requireApp("cms.Index","$Newer.lp."+MWF.language,null,!1),this.lp=MWF.xApplication.cms.Index.Newer.lp,this.options.title=this.lp.createDocument,this.orginOptions={},"object"===o2.typeOf(n)&&(this.orginOptions=Object.clone(n)),this.setOptions(n),this.columnData=t,this.categoryData=e,this.app=s,this.view=i,this.container=this.app.content,this.columnData||this.initData(),this.parseConfig(),this.documentAction=MWF.Actions.get("x_cms_assemble_control")},initData:function(){var t=this.options.appFlag||this.options.columnFlag;!this.columnData&&t&&MWF.Actions.get("x_cms_assemble_control").getColumn(t,function(t){this.columnData=t.data}.bind(this),null,!1);var e=this.options.categoryFlag;!this.categoryData&&e&&MWF.Actions.get("x_cms_assemble_control").getCategory(e,function(t){this.categoryData=t.data,this.columnData||MWF.Actions.get("x_cms_assemble_control").getColumn(this.categoryData.appId,function(t){this.columnData=t.data}.bind(this),null,!1)}.bind(this),null,!1)},parseConfig:function(){if(this.columnData){this.columnData.config=this.columnData.config||{},"string"===typeOf(this.columnData.config)?this.columnData.config=JSON.parse(this.columnData.config||"{}"):this.columnData.config=Object.clone(this.columnData.config||{});var t=this.orginOptions;"boolean"!==typeOf(t.ignoreTitle)&&"boolean"===typeOf(this.columnData.config.ignoreTitle)&&(this.options.ignoreTitle=this.columnData.config.ignoreTitle),"boolean"!==typeOf(t.latest)&&"boolean"===typeOf(this.columnData.config.latest)&&(this.options.latest=this.columnData.config.latest)}},load:function(){if(this.initData(),this.identityList=this.getIdentities(),this.categoryData)if(this.categoryData.workflowAppId&&this.categoryData.workflowFlag)this._load(),this.fireEvent("postLoad");else if(this.options.ignoreDrafted)this._load(),this.fireEvent("postLoad");else{var t={categoryIdList:[this.categoryData.id],creatorList:[layout.desktop.session.user.distinguishedName]};this.documentAction.listDraftNext("(0)",1,t,function(t){t.data.length>0?(this._openDocument(t.data[0].id),this.fireEvent("postLoad")):(this._load(),this.fireEvent("postLoad"))}.bind(this))}else this._load(),this.fireEvent("postLoad")},_load:function(){this.categoryData&&this.isIgnoreTitle()&&1==this.identityList.length?this.okStart():(this.isNew=!0,this.isEdited=!0,this._open(),this.checkSubject(),this.options.selectColumnEnable&&this.openSel())},openSel:function(){this.formTopTextNode.set("text",this.lp.selCategory),this.sel||(this.sel=new MWF.xApplication.cms.Index.Newer.CategorySel(this.app,this.formContentNode,this,this.columnData,this.categoryData,{restrictToColumn:this.options.restrictToColumn})),this.sel.load()},_loadCss:function(){var t=encodeURIComponent(this.cssPath);MWF.widget.css[t]?this.css=MWF.widget.css[t]:(this.cssPath=-1!=this.cssPath.indexOf("?")?this.cssPath+"&v="+COMMON.version:this.cssPath+"?v="+COMMON.version,new Request.JSON({url:this.cssPath,secure:!1,async:!1,method:"get",noCache:!1,onSuccess:function(e,s){this.css=e,MWF.widget.css[t]=e}.bind(this),onError:function(t,e){alert(e+t)}}).send())},_createTableContent:function(){var t=this.categoryData?this.categoryData.name||this.categoryData.categoryName:this.lp.selectCategory,e="";this.options.selectColumnEnable&&(this.selectArea=new Element("div",{styles:this.css.selectArea}).inject(this.formTableArea),this.selectContainer=new Element("div",{styles:this.css.selectContainer}).inject(this.selectArea),e="<div id='form_startColumn' style='float:left'></div><div id='form_startCategory' style='float:left'></div>",this.selectContainer.set("html",e),this.setSelectContent()),this.inputContainer=new Element("div",{styles:this.css.inputContainer}).inject(this.formTableArea),e="<table width='100%' height='90%' border='0' cellPadding='0' cellSpacing='0'; ><tr><td colSpan='2' style='height: 60px; line-height: 60px; text-align: center; font-size: 24px; ' id='form_startTitle'>"+this.lp.start+" - "+t+"</td></tr><tr><td style='height: 38px; line-height: 38px; text-align: left; font-size:16px;color:#333;min-width: 100px;'>"+this.lp.department+"：</td><td style='; text-align: left;' id='form_startDepartment'></td></tr><tr><td style='height: 38px; line-height: 38px;  text-align: left; font-size:16px;color:#333'>"+this.lp.identity+"：</td><td style='; text-align: left;'><div id='form_startIdentity'></div></td></tr><tr><td style='height: 38px; line-height: 38px;  text-align: left; font-size:16px;color:#333'>"+this.lp.date+"：</td><td style='; text-align: left;'><div id='form_startDate'></div></td></tr><tr><td style='height: 38px; line-height: 38px;  text-align: left; font-size:16px;color:#333'>"+this.lp.subject+"：</td><td style='; text-align: left;'><input type='text' id='form_startSubject' style='width: 99%; border:1px solid #999; background-color:#FFF; border-radius: 3px; box-shadow: 0px 0px 6px #CCC;height: 26px;'/></td></tr><tr><td style='height: 38px; line-height: 38px; text-align: left; font-size:16px;color:#333'></td><td style='text-align: left;' id='form_startAction'></td></tr></table>",this.inputContainer.set("html",e),this.setStartFormContent(),this.startActionContainer=this.inputContainer.getElementById("form_startAction"),this.startTitleNode=this.inputContainer.getElementById("form_startTitle"),this.startOkActionNode=new Element("div",{styles:this.css.startOkActionNode,text:this.lp.ok}).inject(this.startActionContainer),this.cancelActionNode=new Element("div",{styles:this.css.cancelActionNode,text:this.lp.cancel}).inject(this.startActionContainer),this.cancelActionNode.addEvent("click",function(t){this.cancelStart(t)}.bind(this)),this.startOkActionNode.addEvent("click",function(t){this.okStart(t)}.bind(this))},isIgnoreTitle:function(){return!!this.options.ignoreTitle||this.categoryData&&![this.lp.documentTypeInfor,"信息"].contains(this.categoryData.documentType)},checkSubject:function(){this.categoryData&&(this.isIgnoreTitle()?this.subjectInput&&this.subjectInput.getParent("tr").setStyle("display","none"):this.subjectInput&&this.subjectInput.getParent("tr").setStyle("display",""))},setSelectContent:function(){this.columnContainer=this.selectContainer.getElementById("form_startColumn"),this.columnContainer.setStyles(this.css.columnContainer),this.selectContainer.addEvents({mouseover:function(){this.columnSelectNode.setStyles(this.css.columnSelectNode_over)}.bind(this),mouseout:function(){this.columnSelectNode.setStyles(this.css.columnSelectNode)}.bind(this),click:function(){this.openSel()}.bind(this)}),this.columnIconNode=new Element("img",{styles:this.css.columnIconNode}).inject(this.columnContainer),this.columnData?this.columnData.appIcon?this.columnIconNode.set("src","data:image/png;base64,"+this.columnData.appIcon):this.columnIconNode.set("src","../x_component_cms_Index/$Main/default/icon/column.png"):this.columnIconNode.set("src","../x_component_cms_Index/$Main/default/icon/all_40.png"),this.columnTextNode=new Element("div",{styles:this.css.columnTextNode,text:this.lp.all}).inject(this.columnContainer),this.columnSelectNode=new Element("div",{styles:this.css.columnSelectNode}).inject(this.columnContainer),this.categoryContainer=this.selectContainer.getElementById("form_startCategory"),this.categoryContainer.setStyles(this.css.categoryContainer),this.categoryTextNode=new Element("div",{styles:this.css.categoryTextNode,text:this.lp.clickForSelect}).inject(this.categoryContainer)},setCurrentColumn:function(t){this.currentColumn&&this.currentColumn!=t&&(this.currentColumn.node.setStyles(this.css.columnItemNode),this.currentColumn.options.isCurrent=!1),this.currentColumn=t},setCurrentCategory:function(t){this.currentCategory&&this.currentCategory!=t&&(this.currentCategory.node.setStyles(this.css.categoryItemNode),this.currentCategory.options.isCurrent=!1),this.currentCategory=t;var e={categoryIdList:[t.data.id],creatorList:[layout.desktop.session.user.distinguishedName]};this.documentAction.getColumn(t.data.appId,function(s){this.columnData=s.data,this.parseConfig(),this.documentAction.listDraftNext("(0)",1,e,function(e){e.data&&e.data.length>0&&this.options.latest?(this._openDocument(e.data[0].id),this.close()):(this.columnData.appIcon?this.columnIconNode.set("src","data:image/png;base64,"+this.columnData.appIcon):this.columnIconNode.set("src","../x_component_cms_Index/$Main/default/icon/column.png"),this.columnTextNode.set("text",this.columnData.appName),this.formTopTextNode.set("text",this.lp.createDocument),this.categoryData=t.data,this.checkSubject(),this.categoryTextNode.set("text",this.categoryData.categoryName),this.startTitleNode.set("text",this.lp.start+" - "+this.categoryData.categoryName),this.sel.closeArea(),this.isIgnoreTitle()&&1==this.identityList.length&&this.okStart())}.bind(this))}.bind(this))},setStartFormContent:function(){this.dateArea=this.formTableArea.getElementById("form_startDate");var t=new Date;this.dateArea.set("text",t.format("%Y-%m-%d %H:%M")),this.departmentSelArea=this.formTableArea.getElementById("form_startDepartment"),this.identityArea=this.formTableArea.getElementById("form_startIdentity"),this.subjectInput=this.formTableArea.getElementById("form_startSubject"),this.loadDepartments()},getIdentities:function(){var t=[];return MWF.Actions.get("x_organization_assemble_personal").getPerson(function(e){(e.data&&e.data.woIdentityList?e.data.woIdentityList:[]).each(function(e){this.options.identity?this.options.identity==e.distinguishedName&&e.distinguishedName&&t.push(e):e.distinguishedName&&t.push(e)}.bind(this))}.bind(this),null,!1),t},loadDepartments:function(){var t=this.identityList||this.getIdentities()||[],e=1==t.length;t.each(function(t){var s=new MWF.xApplication.cms.Index.Newer.DepartmentSel(t,this,this.departmentSelArea,this.identityArea);e&&s.selected()}.bind(this))},cancelStart:function(t){var e=this;this.subjectInput&&this.subjectInput.get("value")?this.app.confirm("warn",t,this.lp.start_cancel_title,this.lp.start_cancel,"320","120",(function(){e.close(),this.close()}),(function(){this.close()})):this.close()},okStart:function(){this.categoryData?this.categoryData.workflowAppId&&this.categoryData.workflowFlag?this._createProcessDocument():this._createDocument():this.app.notice(this.lp.selectCategory,"error")},_createDocument:function(t){var e=this.subjectInput?this.subjectInput.get("value"):"";!e&&this.options.documentData&&(e=this.options.documentData.title||this.options.documentData.subject||"");var s="";this.options.identity?s=this.options.identity:this.identityArea?s=this.identityArea.get("value"):this.identityList.length>0&&(s=this.identityList[0].distinguishedName);var i={id:this.documentAction.getUUID(),isNewDocument:!0,title:e,creatorIdentity:s,identity:s,appId:this.categoryData.appId,categoryId:this.categoryData.id,form:this.categoryData.formId,formName:this.categoryData.formName,docStatus:"draft",categoryName:this.categoryData.name||this.categoryData.categoryName,categoryAlias:this.categoryData.alias||this.categoryData.categoryAlias,attachmentList:[]};this.options.documentData&&(i.docData=this.options.documentData),i.title||this.isIgnoreTitle()?i.creatorIdentity?(this.isIgnoreTitle()&&!i.title&&(i.title=this.lp.untitled),this.formAreaNode&&(this.mask=new MWF.widget.Mask({style:"desktop"}),this.mask.loadNode(this.formAreaNode)),this.documentAction.addDocument(i,function(t){this.mask&&this.mask.hide(),this.close(),this.fireEvent("started",[t.data.id,i]),this._openDocument(t.data.id),this.app.notice(this.lp.Started,"success")}.bind(this),function(t,e,s){if(t&&t.response&&"string"===typeOf(t.response))try{var i=JSON.parse(t.response);this.app.notice(i.message,"error")}catch(t){}this.mask&&this.mask.hide()}.bind(this))):(this.departmentSelArea.setStyle("border-color","red"),this.app.notice(this.lp.selectStartId,"error")):(this.subjectInput&&this.subjectInput.setStyle("border-color","red"),this.subjectInput&&this.subjectInput.focus(),this.app.notice(this.lp.inputSubject,"error"))},_openDocument:function(t,e){var s=this,i="cms.Document"+t;if(s.app.desktop.apps[i])s.app.desktop.apps[i].setCurrent();else{var n={readonly:!1,documentId:t,appId:i,onPostPublish:function(t){this.fireEvent("postPublish",t)}.bind(this),onAfterPublish:function(t){s.view&&s.view.reload&&s.view.reload(),s.fireEvent("afterPublish",t)}};"boolean"==typeOf(this.options.autoSave)&&(n.autoSave=this.options.autoSave),"boolean"==typeOf(this.options.saveOnClose)&&(n.saveOnClose=this.options.saveOnClose),layout.inBrowser?(window.o2RefreshCMSView||(window.o2CreateCMSDocumentCount=(window.o2CreateCMSDocumentCount||0)+1,window.o2RefreshCMSView=function(){try{s.view&&s.view.reload&&s.view.reload()}catch(t){}window.o2CreateCMSDocumentCount&&window.o2CreateCMSDocumentCount--,(!window.o2CreateCMSDocumentCount||window.o2CreateCMSDocumentCount<0)&&(window.o2RefreshCMSView=null)}.bind(this)),this.app.desktop.openApplication(e,"cms.Document",n)):this.app.desktop.openApplication(e,"cms.Document",n)}},_createProcessDocument:function(t){var e=this.subjectInput?this.subjectInput.get("value"):"";!e&&this.options.documentData&&(e=this.options.documentData.title||this.options.documentData.subject||"");var s="";this.options.identity?s=this.options.identity:this.identityArea?s=this.identityArea.get("value"):this.identityList.length>0&&(s=this.identityList[0].distinguishedName);var i=this.categoryData.workflowFlag,n={title:e,identity:s};if(n.title||this.isIgnoreTitle())if(n.identity){var o;this.isIgnoreTitle()&&!e&&(e=this.lp.untitled),(o=this.options.documentData?Object.clone(this.options.documentData):{}).cmsDocument={isNewDocument:!0,title:e,creatorIdentity:n.identity,identity:n.identity,appId:this.categoryData.appId,categoryId:this.categoryData.id,docStatus:"draft",categoryName:this.categoryData.name,categoryAlias:this.categoryData.alias,createTime:(new Date).format("db"),attachmentList:[]},this.formAreaNode&&(this.mask=new MWF.widget.Mask({style:"desktop"}),this.mask.loadNode(this.formAreaNode)),MWF.Actions.get("x_processplatform_assemble_surface").startWork(function(t){this.mask&&this.mask.hide(),this.close(),this.afterStartProcess(t.data,n.title,this.categoryData.workflowName,o),this.app.notice(this.lp.Started,"success")}.bind(this),null,i,n)}else this.departmentSelArea.setStyle("border-color","red"),this.app.notice(this.lp.selectStartId,"error");else this.subjectInput.setStyle("border-color","red"),this.subjectInput.focus(),this.app.notice(this.lp.inputSubject,"error")},afterStartProcess:function(t,e,s,i){var n=[],o=[];t.each(function(t){-1!=t.currentTaskIndex&&o.push(t.taskList[t.currentTaskIndex].work),n.push(this.getStartWorkInforObj(t))}.bind(this));var a=o[0];MWF.Actions.get("x_processplatform_assemble_surface").saveData(function(){if(this.fireEvent("started",[a,i]),1==o.length){var t={workId:a};this.app.desktop.openApplication(null,"process.Work",t),this.createStartWorkResault(n,e,s,!1)}else this.createStartWorkResault(n,e,s,!0)}.bind(this),null,a,i)},getStartWorkInforObj:function(t){var e=[],s="";return t.taskList.each(function(i,n){e.push(i.identity.split("@")[0]+"("+i.unit.split("@")[0]+")"),t.currentTaskIndex==n&&(s=i.id)}.bind(this)),{activity:t.fromActivityName,users:e,currentTask:s}},createStartWorkResault:function(t,e,s,i){var n="";t.each(function(t){n+="<div><b>"+this.lp.nextActivity+"<font style='color: #ea621f'>"+t.activity+"</font>, "+this.lp.nextUser+"<font style='color: #ea621f'>"+t.users.join(", ")+"</font></b>",t.currentTask&&i?n+="&nbsp;&nbsp;&nbsp;&nbsp;<span value='"+t.currentTask+"'>"+this.lp.deal+"</span></div>":n+="</div>"}.bind(this));var o={subject:this.lp.processStarted,content:"<div>"+this.lp.processStartedMessage+"“["+s+"]"+e+"”</div>"+n},a=layout.desktop.message.addTooltip(o),r=layout.desktop.message.addMessage(o);this.setStartWorkResaultAction(a),this.setStartWorkResaultAction(r)},setStartWorkResaultAction:function(t){var e=t.node.getElements("span");e.setStyles(this.css.dealStartedWorkAction);var s=this;e.addEvent("click",(function(t){var e={taskId:this.get("value")};s.app.desktop.openApplication(t,"process.Work",e)}))}}),MWF.xApplication.cms.Index.Newer.DepartmentSel=new Class({initialize:function(t,e,s,i){this.data=t,this.starter=e,this.container=s,this.idArea=i,this.css=this.starter.css,this.isSelected=!1,this.load()},load:function(){this.node=new Element("div",{styles:this.css.departSelNode}).inject(this.container);this.data.woUnit?this.data.woUnit.name:this.lp.unnamedUnit;this.node.set("text",this.data.woUnit.name),this.node.addEvents({mouseover:function(){this.isSelected||this.node.setStyles(this.css.departSelNode_over)}.bind(this),mouseout:function(){this.isSelected||this.node.setStyles(this.css.departSelNode_out)}.bind(this),click:function(){this.selected()}.bind(this)})},selected:function(){this.isSelected||(this.starter.currentDepartment&&this.starter.currentDepartment.unSelected(),this.node.setStyles(this.css.departSelNode_selected),this.isSelected=!0,this.starter.currentDepartment=this,this.idArea.set({text:this.data.name,value:this.data.distinguishedName}))},unSelected:function(){this.isSelected&&(this.starter.currentDepartment&&(this.starter.currentDepartment=null),this.node.setStyles(this.css.departSelNode),this.isSelected=!1)}}),MWF.xApplication.cms.Index.Newer.CategorySel=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",restrictToColumn:!1},initialize:function(t,e,s,i,n,o){this.setOptions(o),this.node=e,this.newer=s,this.lp=s.lp,this.css=s.css,this.action=s.documentAction,this.columnData=i,this.categoryData=n},load:function(){this.areaNode||this.createArea(),this.areaNode.fade("1")},closeArea:function(){this.areaNode&&this.areaNode.fade("out")},createArea:function(){this.areaNode=new Element("div.categorySelAreaNode",{styles:this.css.categorySelAreaNode}).inject(this.node),this.areaNode.addEvent("click",function(t){}.bind(this)),this.columnContainer=new Element("div",{styles:this.css.selColumnAreaNode}).inject(this.areaNode),this.columnScrollNode=new Element("div.columnScrollNode",{styles:this.css.selColumnScrollNode}).inject(this.columnContainer),this.setScrollBar(this.columnScrollNode),this.columnContentNode=new Element("div.selColumnContentNode",{styles:this.css.selColumnContentNode}).inject(this.columnScrollNode),this.categoryContainer=new Element("div",{styles:this.css.selCategoryAreaNode}).inject(this.areaNode),this.categoryScrollNode=new Element("div",{styles:this.css.selCategoryScrollNode}).inject(this.categoryContainer),this.setScrollBar(this.categoryScrollNode),this.categoryContentNode=new Element("div",{styles:this.css.selCategoryContentNode}).inject(this.categoryScrollNode),this.options.restrictToColumn&&this.columnData?new MWF.xApplication.cms.Index.Newer.CategorySel.Column(this.columnData,this.app,this.newer,this.columnContentNode,this.categoryContentNode,{needGetCategorys:!0,isCurrent:!0,currentCategory:this.categoryData?this.categoryData.id:"",restrictToColumn:this.options.restrictToColumn}):this.listColumns()},listColumns:function(){var t={wrapOutCategoryList:[]};this.action.listColumnByPublish(function(e){e.data.each(function(e){e.name||(e.name=e.appName),e.wrapOutCategoryList&&e.wrapOutCategoryList.length&&e.wrapOutCategoryList.each(function(e){t.wrapOutCategoryList.push(e)}.bind(this))}.bind(this)),new MWF.xApplication.cms.Index.Newer.CategorySel.Column(t,this.app,this.newer,this.columnContentNode,this.categoryContentNode,{needGetCategorys:!1,isAll:!0,isCurrent:!this.columnData,currentCategory:this.categoryData?this.categoryData.id:"",restrictToColumn:this.options.restrictToColumn}),e.data.each(function(t){t.name||(t.name=t.appName),new MWF.xApplication.cms.Index.Newer.CategorySel.Column(t,this.app,this.newer,this.columnContentNode,this.categoryContentNode,{needGetCategorys:!1,isCurrent:!(!this.columnData||this.columnData.id!=t.id),currentCategory:this.categoryData?this.categoryData.id:"",restrictToColumn:this.options.restrictToColumn})}.bind(this))}.bind(this))}}),MWF.xApplication.cms.Index.Newer.CategorySel.Column=new Class({Implements:[Options],options:{needGetCategorys:!1,isAll:!1,isCurrent:!1,currentCategory:"",restrictToColumn:!1},initialize:function(t,e,s,i,n,o){this.setOptions(o),this.data=t,this.app=e,this.newer=s,this.lp=s.lp,this.css=s.css,this.action=s.documentAction,this.container=i,this.categoryContainer=n,this.load()},load:function(){this.node=new Element("div",{styles:this.css.columnItemNode}).inject(this.container);this.iconNode=new Element("img",{styles:this.css.columnItemIconNode}).inject(this.node);this.options.isAll?this.iconNode.set("src","../x_component_cms_Index/$Main/default/icon/all_40.png"):this.data.appIcon?this.iconNode.set("src","data:image/png;base64,"+this.data.appIcon):this.iconNode.set("src","../x_component_cms_Index/$Main/default/icon/column.png"),this.textNode=new Element("div",{styles:this.css.columnItemTextNode}).inject(this.node),this.options.isAll?this.textNode.set("text",this.lp.all):this.textNode.set("text",this.data.name||this.data.appName),this.options.isAll,this.node.addEvents({mouseover:function(){this.options.isCurrent||this.node.setStyles(this.css.columnItemNode_over)}.bind(this),mouseout:function(){this.options.isCurrent||this.node.setStyles(this.css.columnItemNode)}.bind(this),click:function(){this.setCurrent()}.bind(this)}),this.options.isCurrent&&this.setCurrent()},setCurrent:function(){this.options.isCurrent=!0,this.node.setStyles(this.css.columnItemNode_current),this.newer.setCurrentColumn(this),this.loadCategory()},loadCategory:function(){if(this.categoryContainer.empty(),this.options.needGetCategorys)this.action.listCategoryByPublisher(this.data.id,function(t){if(t.data.length){var e=1==t.data.length&&(this.options.restrictToColumn||this.options.isAll);t.data.each(function(t){new MWF.xApplication.cms.Index.Newer.CategorySel.Category(t,this,this.categoryContainer,{isCurrent:this.options.currentCategory==t.id||e})}.bind(this))}else this.node.setStyle("display","none")}.bind(this),null,this.data.id);else if(this.data.wrapOutCategoryList&&this.data.wrapOutCategoryList.length){var t=1==this.data.wrapOutCategoryList.length&&(this.options.restrictToColumn||this.options.isAll);this.data.wrapOutCategoryList.each(function(e){new MWF.xApplication.cms.Index.Newer.CategorySel.Category(e,this,this.categoryContainer,{isCurrent:this.options.currentCategory==e.id||t})}.bind(this))}else this.node.setStyle("display","none")}}),MWF.xApplication.cms.Index.Newer.CategorySel.Category=new Class({Implements:[Options],options:{isCurrent:!1},initialize:function(t,e,s,i){this.setOptions(i),this.data=t,this.column=e,this.app=this.column.app,this.newer=this.column.newer,this.container=s,this.css=this.newer.css,this.load()},load:function(){this.data.name||(this.data.name=this.data.categoryName),this.node=new Element("div.categoryItem",{styles:this.css.categoryItemNode}).inject(this.container),this.options.isCurrent&&this.node.setStyles(this.css.categoryItemNode_over),this.textNode=new Element("div",{styles:this.css.categoryItemTextNode}).inject(this.node),this.textNode.set({text:this.data.categoryName});this.node.addEvents({mouseover:function(t){this.options.isCurrent||this.node.setStyles(this.css.categoryItemNode_over)}.bind(this),mouseout:function(t){this.options.isCurrent||this.node.setStyles(this.css.categoryItemNode)}.bind(this),click:function(t){this.setCurrent()}.bind(this)}),this.options.isCurrent&&this.setCurrent()},setCurrent:function(){this.options.isCurrent=!0,this.node.setStyles(this.css.categoryItemNode_current),this.newer.setCurrentCategory(this)}});