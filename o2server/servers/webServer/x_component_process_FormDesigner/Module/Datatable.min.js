MWF.xApplication.process.FormDesigner.Module=MWF.xApplication.process.FormDesigner.Module||{},MWF.xDesktop.requireApp("process.FormDesigner","Module.$Container",null,!1),MWF.xDesktop.requireApp("process.FormDesigner","Module.$Component",null,!1),MWF.xDesktop.requireApp("process.FormDesigner","Module.Datatable$Data",null,!1),MWF.xDesktop.requireApp("process.FormDesigner","Module.Datatable$Title",null,!1),MWF.xDesktop.requireApp("process.FormDesigner","Module.Table$Td",null,!1),MWF.xApplication.process.FormDesigner.Module.Datatable=MWF.FCDatatable=new Class({Extends:MWF.FC$Component,Implements:[Options,Events],options:{style:"default",propertyPath:"../x_component_process_FormDesigner/Module/Datatable/datatable.html"},initialize:function(t,e){this.setOptions(e),this.path="../x_component_process_FormDesigner/Module/Datatable/",this.cssPath="../x_component_process_FormDesigner/Module/Datatable/"+this.options.style+"/css.wcss",this._loadCss(),this.moduleType="component",this.moduleName="datatable",this.form=t,this.container=null,this.containerNode=null,this.containers=[],this.elements=[],this.selectedMultiTds=[]},clearTemplateStyles:function(t){t&&(t.styles&&this.removeStyles(t.styles,"styles"),t.tableStyles&&this.removeStyles(t.tableStyles,"tableStyles"),t.titleStyles&&this.removeStyles(t.titleStyles,"titleStyles"),t.contentStyles&&this.removeStyles(t.contentStyles,"contentStyles"),t.actionStyles&&this.removeStyles(t.actionStyles,"actionStyles"),t.editStyles&&this.removeStyles(t.editStyles,"editStyles"),t.amountStyles&&this.removeStyles(t.amountStyles,"amountStyles"),t.itemTitleStyles&&this.removeStyles(t.itemTitleStyles,"itemTitleStyles"),t.properties&&this.removeStyles(t.properties,"properties"))},setTemplateStyles:function(t){t.styles&&this.copyStyles(t.styles,"styles"),t.tableStyles&&this.copyStyles(t.tableStyles,"tableStyles"),t.titleStyles&&this.copyStyles(t.titleStyles,"titleStyles"),t.contentStyles&&this.copyStyles(t.contentStyles,"contentStyles"),t.actionStyles&&this.copyStyles(t.actionStyles,"actionStyles"),t.editStyles&&this.copyStyles(t.editStyles,"editStyles"),t.amountStyles&&this.copyStyles(t.amountStyles,"amountStyles"),t.itemTitleStyles&&this.copyStyles(t.itemTitleStyles,"itemTitleStyles"),t.properties&&this.copyStyles(t.properties,"properties")},setImpExpTableStyles:function(){this.form.templateStyles&&this.form.templateStyles.table&&(this.json.impExpTableStyles=Object.merge(this.json.impExpTableStyles||{},this.form.templateStyles.table.styles||{}),this.json.impExpTableTitleStyles=Object.merge(this.json.impExpTableTitleStyles||{},this.form.templateStyles.table.titleStyles||{}),this.json.impExpTableContentStyles=Object.merge(this.json.impExpTableContentStyles||{},this.form.templateStyles.table.contentStyles||{}),this.json.impExpTableProperties=Object.merge(this.json.impExpTableProperties||{},this.form.templateStyles.table.properties||{}))},_createMoveNode:function(){this.moveNode=new Element("div",{html:'<table border="0" cellpadding="0" cellspacing="2" width="100%" align="center"><tr><th></th><th></th><th></th></tr><tr><td></td><td></td><td></td></tr></table>'}).inject(this.form.container),this.moveNode.setStyles(this.css.moduleNodeMove),this._setTableStyle()},_setTableStyle:function(){this.moveNode.getElements("td").setStyles({border:"1px dashed #999",height:"20px"}),this.moveNode.getElements("th").setStyles({background:"#C3CEEA",border:"1px dashed #999",height:"20px"})},_getContainers:function(){var t=this.node.getElements("td");this.form.getTemplateData("Datatable$Data",function(e){t.each(function(t){var s=this.form.getDomjson(t),i=null;if(s){o=Object.clone(e);Object.merge(o,s),Object.merge(s,o),(i=new MWF.FCDatatable$Data(this.form)).load(s,t,this)}else{var o=Object.clone(e);(i=new MWF.FCDatatable$Data(this.form)).load(o,t,this)}this.containers.push(i)}.bind(this))}.bind(this),!1)},_getElements:function(){var t=this.node.getElements("th");this.form.getTemplateData("Datatable$Title",function(e){t.each(function(t){var s=this.form.getDomjson(t),i=null;if(s){o=Object.clone(e);Object.merge(o,s),Object.merge(s,o),(i=new MWF.FCDatatable$Title(this.form)).load(s,t,this)}else{var o=Object.clone(e);(i=new MWF.FCDatatable$Title(this.form)).load(o,t,this)}this.elements.push(i)}.bind(this))}.bind(this),!1)},_createNode:function(t){var e=this,s=this.path+"datatableCreate.html";MWF.require("MWF.widget.Dialog",function(){var i=$(document.body).getSize(),o=i.x/2-180,l=i.y/2-130;new MWF.DL({title:"Create Datatable",style:"property",top:l,left:o-40,fromTop:i.y/2-65,fromLeft:i.x/2,width:360,height:260,url:s,lp:MWF.xApplication.process.FormDesigner.LP.propertyTemplate,buttonList:[{text:MWF.APPFD.LP.button.ok,action:function(){e._createTableNode(),t(),this.close()}}]}).show()}.bind(this))},_createTableNode:function(){var t=$("MWFNewTableColumn").get("value"),e=$("MWFNewTableWidth").get("value"),s=$("MWFNewTableWidthUnit"),i=s.options[s.selectedIndex].value,o=$("MWFNewTableBorder").get("value"),l=$("MWFNewTableCellpadding").get("value"),n=$("MWFNewTableCellspacing").get("value"),r="";r="percent"==i?e+"%":e+"px",this.json.properties.width=r,this.json.properties.border=o,this.json.properties.cellpadding=l,this.json.properties.cellspacing=n;var p='<table border="'+o+'" cellpadding="'+l+'" cellspacing="'+n+'" width="'+r+'" align="center">';p+="<tr>";for(var a=0;a<t.toInt();a++)p+="<th></th>";p+="</tr>",p+="<tr>";for(a=0;a<t.toInt();a++)p+="<td></td>";p+="</tr></table>",this.node=new Element("div",{id:this.json.id,MWFType:"datatable",html:p,styles:this.css.moduleNode,events:{selectstart:function(t){t.preventDefault()}}}).inject(this.form.node),this.table=this.node.getElement("table")},_dragComplete:function(){this.node?this._dragMoveComplete():this._createNode(function(){this._dragMoveComplete()}.bind(this))},_dragMoveComplete:function(){this._resetTreeNode(),this.node.inject(this.copyNode,"before"),this._initModule();var t=this.node.retrieve("thisDisplay");t&&this.node.setStyle("display",t),this.copyNode&&this.copyNode.destroy(),this.moveNode&&this.moveNode.destroy(),this.moveNode=null,this.copyNode=null,this.nextModule=null,this.form.moveModule=null,this.form.json.moduleList[this.json.id]=this.json,this.selected()},_initModule:function(){this.initialized||("yes"!==this.json.initialized&&this.setStyleTemplate(),this.table=this.node.getElement("table"),this._getElements(),this._getContainers(),this.setPropertiesOrStyles("styles"),this.setPropertiesOrStyles("tableStyles"),this.setPropertiesOrStyles("properties"),this.json.impExpTableStyles||this.setImpExpTableStyles(),this._setNodeProperty(),this.form.isSubform||this._createIconAction(),this._setNodeEvent(),this.setDatatableStyles(),this._setEditStyle_custom("impexpType"),this.initialized=!0,this.json.initialized="yes")},setPropertiesOrStyles:function(t){if("styles"==t){var e=this.node.getStyle("border");this.node.clearStyles(),this.node.setStyles(this.css.moduleNode),this.node.setStyle("border",e),Object.each(this.json.styles,function(t,e){e.test(/^border\w*/gi)||this.node.setStyle(e,t)}.bind(this))}"tableStyles"==t&&(this.table.clearStyles(),Object.each(this.json.tableStyles,function(t,e){e.test(/^border\w*/gi)||this.table.setStyle(e,t)}.bind(this))),"properties"==t&&this.node.getFirst().setProperties(this.json.properties)},_setEditStyle_custom:function(t,e,s){if("id"==t&&t!=s){var i=new RegExp("^"+s,"i");this.containers.each(function(t){var e=t.json.id,s=e.replace(i,this.json.id);t.json.id=s,delete this.form.json.moduleList[e],this.form.json.moduleList[s]=t.json,t._setEditStyle("id")}.bind(this))}"titleStyles"==t&&this.table.getElements("th").each(function(t){var e=t.getStyle("opacity");this.setCustomNodeStyles(t,this.json.titleStyles),e&&t.setStyle("opacity",e)}.bind(this));"contentStyles"==t&&this.table.getElements("td").each(function(t){var e=t.getStyle("opacity");this.setCustomNodeStyles(t,this.json.contentStyles),e&&t.setStyle("opacity",e)}.bind(this));var o=function(){if(["centerTop","centerBottom"].contains(this.json.impexpPosition)){var t=2;this.exportActionNode&&(t=t+this.exportActionNode.getSize().x+this.exportActionNode.getStyle("padding-left").toFloat()+ +this.exportActionNode.getStyle("padding-right").toFloat()+ +this.exportActionNode.getStyle("margin-left").toFloat()+ +this.exportActionNode.getStyle("margin-right").toFloat()),this.importActionNode&&(t=t+this.importActionNode.getSize().x+this.importActionNode.getStyle("padding-left").toFloat()+ +this.importActionNode.getStyle("padding-right").toFloat()+ +this.importActionNode.getStyle("margin-left").toFloat()+ +this.importActionNode.getStyle("margin-right").toFloat()),this.importExportAreaNode.setStyle("width",t+"px")}else this.importExportAreaNode.setStyle("width","auto")}.bind(this);if("impexpType"===t){var l="impexp"===this.json.impexpType||"imp"===this.json.impexpType,n="impexp"===this.json.impexpType||"exp"===this.json.impexpType;if(this.impexpNode&&this.impexpNode.destroy(),this.impexpNode=null,this.impexpNode=this.node.getElement("div.impexpNode"),this.impexpNode&&this.impexpNode.destroy(),this.impexpNode=null,!n&&!l)return;var r=["leftTop","centerTop","rightTop"].contains(this.json.impexpPosition||"")?"top":"bottom";this.impexpNode=new Element("div.impexpNode",{styles:{width:"100%",overflow:"hidden"}}).inject(this.node,r);var p,a=new Element("div.importExportAreaNode").inject(this.impexpNode);["leftTop","leftBottom"].contains(this.json.impexpPosition||"")?a.setStyles({float:"left",margin:"0px"}):["rightTop","rightBottom"].contains(this.json.impexpPosition||"")?a.setStyles({float:"right",margin:"0px"}):a.setStyles({float:"none",margin:"0px auto"}),this.importExportAreaNode=a;if(n){var h=new Element("div.exportActionStyles",{text:this.json.exportActionText}).inject(a);p=this.json.exportActionStyles?Object.clone(this.json.exportActionStyles):{color:"#777","border-radius":"5px",border:"1px solid #ccc",cursor:"pointer",height:"26px",float:"left","line-height":"26px",padding:"0px 5px","background-color":"#efefef",margin:"5px"},h.setStyles(p),this.exportActionNode=h}if(l){var d=new Element("div.importActionNode",{text:this.json.importActionText}).inject(a);p=this.json.importActionStyles?Object.clone(this.json.importActionStyles):{color:"#777","border-radius":"5px",border:"1px solid #ccc",cursor:"pointer",height:"26px",float:"left","line-height":"26px",padding:"0px 5px","background-color":"#efefef",margin:"5px"},d.setStyles(p),this.importActionNode=d}o()}if("impexpPosition"===t&&this.impexpNode&&this.importExportAreaNode){r=["leftTop","centerTop","rightTop"].contains(this.json.impexpPosition||"")?"top":"bottom";this.impexpNode.inject(this.node,r);a=this.importExportAreaNode;["leftTop","leftBottom"].contains(this.json.impexpPosition||"")?a.setStyles({float:"left",margin:"0px"}):["rightTop","rightBottom"].contains(this.json.impexpPosition||"")?a.setStyles({float:"right",margin:"0px"}):a.setStyles({float:"none",margin:"0px auto"}),o()}"importActionText"===t&&this.importActionNode&&(this.importActionNode.set("text",this.json.importActionText),o()),"exportActionText"===t&&this.exportActionNode&&(this.exportActionNode.set("text",this.json.exportActionText),o()),"importActionStyles"===t&&this.importActionNode&&(this.importActionNode.setStyles(this.json.importActionStyles||{}),o()),"exportActionStyles"===t&&this.exportActionNode&&(this.exportActionNode.setStyles(this.json.exportActionStyles||{}),o())},setDatatableStyles:function(){this.json.titleStyles&&this.table.getElements("th").each(function(t){var e=t.getStyle("opacity");this.setCustomNodeStyles(t,this.json.titleStyles),e&&t.setStyle("opacity",e)}.bind(this));this.json.contentStyles&&this.table.getElements("td").each(function(t){var e=t.getStyle("opacity");this.setCustomNodeStyles(t,this.json.contentStyles),e&&t.setStyle("opacity",e)}.bind(this))},setAllStyles:function(){this.setPropertiesOrStyles("styles"),this.setPropertiesOrStyles("tableStyles"),this.setPropertiesOrStyles("properties"),this.setDatatableStyles(),this.setImpExpTableStyles(),this.reloadMaplist()},getContainerNodes:function(){return this.node.getElements("td")},copyComponentJsonData:function(t,e){var s=t.getElements("td"),i=t.getElements("th");s.each(function(t,s){var i=Object.clone(this.containers[s].json);i.id=this.containers[s]._getNewId(e),this.form.json.moduleList[i.id]=i,t.set("id",i.id)}.bind(this)),i.each(function(t,s){var i=Object.clone(this.elements[s].json);i.id=this.elements[s]._getNewId(e),this.form.json.moduleList[i.id]=i,t.set("id",i.id)}.bind(this))}});