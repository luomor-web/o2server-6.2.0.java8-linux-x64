MWF.xApplication.process.FormDesigner.Module=MWF.xApplication.process.FormDesigner.Module||{},MWF.xDesktop.requireApp("process.FormDesigner","Module.$Component",null,!1),MWF.xDesktop.requireApp("process.FormDesigner","Module.Tab$Page",null,!1),MWF.xDesktop.requireApp("process.FormDesigner","Module.Tab$Content",null,!1),MWF.require("MWF.widget.Tab",null,!1),MWF.xApplication.process.FormDesigner.Module.Tab=MWF.FCTab=new Class({Extends:MWF.FC$Component,Implements:[Options,Events],options:{style:"default",propertyPath:"../x_component_process_FormDesigner/Module/Tab/tab.html",actions:[{name:"move",icon:"move1.png",event:"mousedown",action:"move",title:MWF.APPFD.LP.formAction.move},{name:"copy",icon:"copy1.png",event:"mousedown",action:"copy",title:MWF.APPFD.LP.formAction.copy},{name:"add",icon:"add.png",event:"click",action:"addPage",title:MWF.APPFD.LP.formAction.add},{name:"delete",icon:"delete1.png",event:"click",action:"delete",title:MWF.APPFD.LP.formAction.delete}]},initialize:function(t,e){this.setOptions(e),this.path="../x_component_process_FormDesigner/Module/Tab/",this.cssPath="../x_component_process_FormDesigner/Module/Tab/"+this.options.style+"/css.wcss",this._loadCss(),this.moduleType="component",this.moduleName="tab",this.form=t,this.container=null,this.containerNode=null,this.containers=[],this.elements=[]},clearTemplateStyles:function(t){t&&(t.styles&&this.removeStyles(t.styles,"styles"),t.properties&&this.removeStyles(t.properties,"properties"),t.tabAreaStyles&&this.removeStyles(t.tabAreaStyles,"tabNodeContainer"),t.contentAreaStyles&&this.removeStyles(t.contentAreaStyles,"contentNodeContainer"),t.tabStyles&&this.removeStyles(t.tabStyles,"tabStyles"),t.tabTextStyles&&this.removeStyles(t.tabTextStyles,"tabTextStyles"),t.tabCurrentStyles&&this.removeStyles(t.tabCurrentStyles,"tabCurrentStyles"),t.tabCurrentTextStyles&&this.removeStyles(t.tabCurrentTextStyles,"tabTextCurrentStyles"))},setTemplateStyles:function(t){t.styles&&this.copyStyles(t.styles,"styles"),t.properties&&this.copyStyles(t.properties,"properties"),t.tabAreaStyles&&this.copyStyles(t.tabAreaStyles,"tabNodeContainer"),t.contentAreaStyles&&this.copyStyles(t.contentAreaStyles,"contentNodeContainer"),t.tabStyles&&this.copyStyles(t.tabStyles,"tabStyles"),t.tabTextStyles&&this.copyStyles(t.tabTextStyles,"tabTextStyles"),t.tabCurrentStyles&&this.copyStyles(t.tabCurrentStyles,"tabCurrentStyles"),t.tabCurrentTextStyles&&this.copyStyles(t.tabCurrentTextStyles,"tabTextCurrentStyles")},_createMoveNode:function(){this.moveNode=new Element("div",{styles:this.css.moduleNodeMove}).inject(this.form.container);var t=new Element("div",{styles:this.css.moduleNodeMove_tab_current}),e=new Element("div",{styles:this.css.moduleNodeMove_tab}),s=new Element("div",{styles:this.css.moduleNodeMove_content});t.inject(this.moveNode),e.inject(this.moveNode),s.inject(this.moveNode)},_createNode:function(t){this.node=new Element("div",{id:this.json.id,MWFType:"tab",styles:this.css.moduleNode,events:{selectstart:function(t){t.preventDefault()}}}).inject(this.form.node);var e="form";"Mobile"==this.form.options.mode&&(e="mobileForm"),this.tabWidget=new MWF.widget.Tab(this.node,{style:e}),this._loadPageStyle(),this.tabWidget.load();var s=new Element("div");this.tabWidget.addTab(s,"page1",!1),s=new Element("div"),this.tabWidget.addTab(s,"page2",!1),s=new Element("div"),this.tabWidget.addTab(s,"page3",!1),s=new Element("div"),this.tabWidget.addTab(s,"page4",!1)},_createTabWidget:function(){var t="form";"Mobile"==this.form.options.mode&&(t="mobileForm");var e=this.node.getElement(".MWFMenu");e&&e.destroy(),this.tabWidget=new MWF.widget.Tab(this.node,{style:t}),this._loadPageStyle(),this.tabWidget.tabNodeContainer=this.node.getFirst(),this.tabWidget.contentNodeContainer=this.tabWidget.tabNodeContainer.getNext();var s,i=this.tabWidget.tabNodeContainer.getLast();i&&i.hasClass("tabNodeContainerLeft")?(this.tabWidget.tabNodeContainerRight=this.tabWidget.tabNodeContainer.getFirst(),this.tabWidget.tabNodeContainerLeft=i,this.tabWidget.tabNodeContainerArea=i.getFirst(),this.tabWidget.load(),s=this.tabWidget.tabNodeContainerArea.getChildren("div")):(s=this.tabWidget.tabNodeContainer.getChildren("div"),this.tabWidget.load()),this.tabWidget.contentNodeContainer.getChildren().each(function(t,e){var i=s[e],n=new MWF.widget.TabPage(t.getFirst(),"",this.tabWidget,{isClose:!1});n.contentNodeArea=t,i&&(n.tabNode=i,n.textNode=i.getFirst(),n.textNode&&(n.closeNode=n.textNode.getFirst())),n.load(),this.tabWidget.pages.push(n)}.bind(this))},_loadPageStyle:function(){this.json.tabNodeContainer&&Object.keys(this.json.tabNodeContainer).length||(this.json.tabNodeContainer=Object.clone(this.tabWidget.css.tabNodeContainer)),this.json.contentNodeContainer&&Object.keys(this.json.contentNodeContainer).length||(this.json.contentNodeContainer=Object.clone(this.tabWidget.css.contentNodeContainer)),this.json.tabStyles&&Object.keys(this.json.tabStyles).length||(this.json.tabStyles=Object.clone(this.tabWidget.css.tabNode)),this.json.tabTextStyles&&Object.keys(this.json.tabTextStyles).length||(this.json.tabTextStyles=Object.clone(this.tabWidget.css.tabTextNode)),this.json.tabCurrentStyles&&Object.keys(this.json.tabCurrentStyles).length||(this.json.tabCurrentStyles=Object.clone(this.tabWidget.css.tabNodeCurrent)),this.json.tabTextCurrentStyles&&Object.keys(this.json.tabTextCurrentStyles).length||(this.json.tabTextCurrentStyles=Object.clone(this.tabWidget.css.tabTextNodeCurrent)),this.json.contentNodeContainer&&Object.keys(this.json.contentNodeContainer).length||(this.json.contentNodeContainer.clear="both"),this._setTabWidgetStyles()},_setTabWidgetStyles:function(){this.tabWidget.css.tabNodeContainer=this.json.tabNodeContainer,this.tabWidget.css.contentNodeContainer=this.json.contentNodeContainer,this.tabWidget.css.tabNode=this.json.tabStyles,this.tabWidget.css.tabTextNode=this.json.tabTextStyles,this.tabWidget.css.tabNodeCurrent=this.json.tabCurrentStyles,this.tabWidget.css.contentNodeContainer.clear="both",this.tabWidget.css.tabTextNodeCurrent=this.json.tabTextCurrentStyles},_getElements:function(){this.tabWidget||this._createTabWidget(),this.form.getTemplateData("Tab$Page",function(t){this.tabWidget.pages.each(function(e){var s=null,i=this.form.getDomjson(e.tabNode);if(i){n=Object.clone(t);Object.merge(n,i),Object.merge(i,n),(s=new MWF.FCTab$Page(this,e)).page=e,s.load(i,e.tabNode,this)}else{var n;(n=Object.clone(t)).name=e.tabNode.get("text"),(s=new MWF.FCTab$Page(this,e)).page=e,s.load(n,e.tabNode,this)}s&&this.elements.push(s)}.bind(this))}.bind(this)),this.tabWidget.showPage||this.tabWidget.pages[0].showTabIm()},_getContainers:function(){this.tabWidget||this._createTabWidget(),this.form.getTemplateData("Tab$Content",function(t){this.tabWidget.pages.each(function(e){var s=null,i=this.form.getDomjson(e.contentNode);if(i){n=Object.clone(t);Object.merge(n,i),Object.merge(i,n),(s=new MWF.FCTab$Content(this,e)).page=e,s.load(i,e.contentNode,this)}else{var n=Object.clone(t);(s=new MWF.FCTab$Content(this,e)).page=e,s.load(n,e.contentNode,this)}s&&this.containers.push(s)}.bind(this))}.bind(this))},_setEditStyle_custom:function(t){"tabNodeContainer"==t&&(this.tabWidget.tabNodeContainer.clearStyles(),this.tabWidget.tabNodeContainer.setStyles(this.json.tabNodeContainer),this._setTabWidgetStyles()),"contentNodeContainer"==t&&(this.tabWidget.contentNodeContainer.clearStyles(),this.tabWidget.contentNodeContainer.setStyles(this.json.contentNodeContainer),this._setTabWidgetStyles()),"tabStyles"==t&&(this.tabWidget.pages.each(function(t){t.isShow||(t.tabNode.clearStyles(),t.tabNode.setStyles(this.json.tabStyles))}.bind(this)),this._setTabWidgetStyles()),"tabTextStyles"==t&&(this.tabWidget.pages.each(function(t){t.isShow||(t.textNode.clearStyles(),t.textNode.setStyles(this.json.tabTextStyles))}.bind(this)),this._setTabWidgetStyles()),"tabCurrentStyles"==t&&(this.tabWidget.pages.each(function(t){t.isShow&&(t.tabNode.clearStyles(),t.tabNode.setStyles(this.json.tabCurrentStyles))}.bind(this)),this._setTabWidgetStyles()),"tabTextCurrentStyles"==t&&(this.tabWidget.pages.each(function(t){t.isShow&&(t.textNode.clearStyles(),t.textNode.setStyles(this.json.tabTextCurrentStyles))}.bind(this)),this._setTabWidgetStyles())},setTabStyles:function(){this._setEditStyle_custom("tabNodeContainer"),this._setEditStyle_custom("contentNodeContainer"),this._setEditStyle_custom("tabStyles"),this._setEditStyle_custom("tabTextStyles"),this._setEditStyle_custom("tabCurrentStyles"),this._setEditStyle_custom("tabTextCurrentStyles")},setAllStyles:function(){this.setPropertiesOrStyles("styles"),this.setPropertiesOrStyles("properties"),this.setTabStyles(),this.reloadMaplist()},addPage:function(){tabNode=new Element("div");var t=this.tabWidget.addTab(tabNode,"page",!1);return this.form.getTemplateData("Tab$Page",function(e){var s=Object.clone(e);s.name=t.tabNode.get("text");var i=new MWF.FCTab$Page(this,t);i.load(s,t.tabNode,this),this.elements.push(i)}.bind(this)),this.form.getTemplateData("Tab$Content",function(e){var s=Object.clone(e),i=new MWF.FCTab$Content(this,t);i.load(s,t.contentNode,this),this.containers.push(i)}.bind(this)),t.showTabIm(),t},copyComponentJsonData:function(t,e){var s,i=t.getFirst(),n=i.getNext().getChildren(),o=i.getLast();if(o&&o.hasClass("tabNodeContainerLeft")){var a=o.getFirst(),l=t.getElement(".MWFMenu");l&&l.destroy(),s=a.getChildren("div")}else s=i.getChildren("div");n.each(function(t,i){var n=Object.clone(this.containers[i].json),o=Object.clone(this.elements[i].json),a=s[i];n.id=this.containers[i]._getNewId(e),this.form.json.moduleList[n.id]=n,t.getFirst().set("id",n.id),o.id=this.elements[i]._getNewId(e),this.form.json.moduleList[o.id]=o,a.set("id",o.id)}.bind(this))},_preprocessingModuleData:function(){this.recoveryWidgetstyle=this.node.get("style"),this.node.clearStyles(),this.json.recoveryStyles=Object.clone(this.json.styles),this.json.recoveryStyles&&Object.each(this.json.recoveryStyles,function(t,e){-1!=t.indexOf("x_processplatform_assemble_surface")||-1!=t.indexOf("x_portal_assemble_surface")||(this.node.setStyle(e,t),delete this.json.styles[e])}.bind(this))},_recoveryModuleData:function(){this.recoveryWidgetstyle&&this.node.set("style",this.recoveryWidgetstyle),this.recoveryWidgetstyle=null,this.json.recoveryStyles&&(this.json.styles=this.json.recoveryStyles),this.json.recoveryStyles=null}});