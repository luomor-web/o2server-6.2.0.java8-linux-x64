MWF.xApplication.process.FormDesigner.Module=MWF.xApplication.process.FormDesigner.Module||{},MWF.xDesktop.requireApp("process.FormDesigner","Module.$Element",null,!1),MWF.xApplication.process.FormDesigner.Module.Tab$Page=MWF.FCTab$Page=new Class({Extends:MWF.FC$Element,Implements:[Options,Events],options:{style:"default",propertyPath:"../x_component_process_FormDesigner/Module/Tab$Page/tab$Page.html",actions:[{name:"move",icon:"move1.png",event:"mousedown",action:"move",title:MWF.APPFD.LP.formAction.move},{name:"add",icon:"add.png",event:"click",action:"addPage",title:MWF.APPFD.LP.formAction.add},{name:"delete",icon:"delete1.png",event:"click",action:"delete",title:MWF.APPFD.LP.formAction.delete}],injectActions:null},initialize:function(e,t,s){this.setOptions(s),this.path="../x_component_process_FormDesigner/Module/Tab$Page/",this.cssPath="../x_component_process_FormDesigner/Module/Tab$Page/"+this.options.style+"/css.wcss",this._loadCss(),this.moduleType="element",this.moduleName="tab$Page",this.form=e.form,this.tab=e,this.page=t},setAllStyles:function(){},_initModule:function(){this._setNodeProperty(),this.form.isSubform||this._createIconAction(),this._setNodeEvent(),-1!=this.form.moduleElementNodeList.indexOf(this.node)&&this.form.moduleElementNodeList.erase(this.node)},load:function(e,t,s){if(this.json=e,this.node=t,this.node.store("module",this),this.node.setStyles(this.css.moduleNode),!this.json.id){var o=this._getNewId(s.json.id);this.json.id=o}this.json.name&&this.page.textNode.set("text",this.json.name),t.set({MWFType:"tab$Page",id:this.json.id}),this.form.json.moduleList[this.json.id]||(this.form.json.moduleList[this.json.id]=this.json),this._initModule(),this._loadTreeNode(s),this.parentContainer=this.treeNode.parentNode.module,this.page.setOptions({onPostShow:function(){this.initialStyles=this.page.tab.css.tabNodeCurrent,this.node.store("normalBorder",this.page.tab.css.tabNodeCurrent)}.bind(this),onPostHide:function(){this.initialStyles=this.page.tab.css.tabNode,this.node.store("normalBorder",this.page.tab.css.tabNode)}.bind(this)}),this._setEditStyle_custom("id"),this.json.moduleName=this.moduleName},_setEditStyle_custom:function(e){"width"==e&&this.json.width&&this.json.width.toInt()>60&&this.node.setStyle("width",this.json.width+"px"),"name"==e&&this.page.textNode.set("text",this.json.name)},addPage:function(){var e=this.tab.addPage();e.tabNode.inject(this.page.tabNode,"before"),e.contentNodeArea.inject(this.page.contentNodeArea,"before"),e.showTabIm()},delete:function(e){var t=this;this.form.designer.confirm("warn",e,MWF.APPFD.LP.notice.deleteElementTitle,MWF.APPFD.LP.notice.deleteElement,300,120,(function(){if(t.tab.containers.length<=1)t.tab.destroy();else{var e=t.page.contentNode.retrieve("module");t.destroy(),t.tab.elements.erase(t),e.destroy(),t.tab.containers.erase(e),t.page.closeTab()}this.close()}),(function(){this.close()}),null)},destroy:function(){this.form.moduleList.erase(this),this.form.moduleNodeList.erase(this.node),this.form.moduleElementNodeList.erase(this.node),this.node.destroy(),this.actionArea.destroy(),delete this.form.json.moduleList[this.json.id],this.json=null,delete this.json,this.treeNode.destroy()},move:function(e){var t=[];this.tab.tabWidget.pages.each(function(e){e!=this.page&&t.push(e.tabNode)}.bind(this)),this._createMoveNode(),this._setNodeMove(t,e)},_createMoveNode:function(){this.moveNode=this.node.clone(),this.moveNode.inject(this.form.node),this.moveNode.setStyles({border:"2px dashed #ffa200",opacity:.7,position:"absolute"})},_onEnterOther:function(){},_createCopyNode:function(){this.copyNode=new Element("div"),this.copyNode.setStyles(this.css.moduleNodeShow),this.copyNode.addEvent("selectstart",(function(){return!1}))},_setNodeMove:function(e,t){this._setMoveNodePosition(t);var s=this.moveNode.getPosition(),o=this.moveNode.getSize(),i=this.tab.node.getPosition(),n=this.tab.node.getSize();new Drag.Move(this.moveNode,{droppables:e,limit:{x:[i.x,i.x+n.x],y:[s.y,s.y+o.y]},onEnter:function(e,t){var s=t.retrieve("module");s&&s._dragIn(this),this._onEnterOther(e,t)}.bind(this),onLeave:function(e,t){var s=t.retrieve("module");s&&s._dragOut(this),this._onLeaveOther(e,t)}.bind(this),onDrop:function(e,t){if(t){var s=t.retrieve("module");s&&s._dragDrop(this),this._nodeDrop(s),s&&this.page.contentNodeArea.inject(s.page.contentNodeArea,"before")}else this._dragCancel(e)}.bind(this),onCancel:function(e){this._dragCancel(e)}.bind(this)}).start(t),this.form.moveModule=this,this.form.recordCurrentSelectedModule=this.form.currentSelectedModule,this.form.selected()},_preprocessingModuleData:function(){this.recoveryWidgetstyle=this.node.get("style"),this.node.clearStyles(),this.json.recoveryStyles=Object.clone(this.json.styles),this.json.recoveryStyles&&Object.each(this.json.recoveryStyles,function(e,t){-1!=e.indexOf("x_processplatform_assemble_surface")||-1!=e.indexOf("x_portal_assemble_surface")||(this.node.setStyle(t,e),delete this.json.styles[t])}.bind(this))},_recoveryModuleData:function(){this.recoveryWidgetstyle&&this.node.set("style",this.recoveryWidgetstyle),this.recoveryWidgetstyle=null,this.json.recoveryStyles&&(this.json.styles=this.json.recoveryStyles),this.json.recoveryStyles=null},setCustomStyles:function(){this._recoveryModuleData()}});