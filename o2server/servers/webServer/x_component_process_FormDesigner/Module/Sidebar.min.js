MWF.xApplication.process.FormDesigner.Module=MWF.xApplication.process.FormDesigner.Module||{},MWF.xDesktop.requireApp("process.FormDesigner","Module.$Element",null,!1),MWF.require("MWF.widget.Toolbar",null,!1),MWF.xApplication.process.FormDesigner.Module.Sidebar=MWF.FCSidebar=new Class({Extends:MWF.FC$Element,Implements:[Options,Events],options:{style:"default",propertyPath:"../x_component_process_FormDesigner/Module/Sidebar/sidebar.html"},addAction:function(){},initialize:function(t,e){this.setOptions(e),this.path="../x_component_process_FormDesigner/Module/Sidebar/",this.cssPath="../x_component_process_FormDesigner/Module/Sidebar/"+this.options.style+"/css.wcss",this._loadCss(),this.moduleType="component",this.moduleName="sidebar",this.Node=null,this.form=t,this.container=null,this.containerNode=null,this.systemTools=[]},setTemplateStyles:function(t){this.json.style=t.style},clearTemplateStyles:function(t){this.json.style="xform_side_blue_simple"},setAllStyles:function(){this._refreshActionbar()},_createMoveNode:function(){this.moveNode=new Element("div",{MWFType:"sidebar",id:this.json.id,styles:this.css.moduleNodeMove,events:{selectstart:function(t){t.preventDefault()}}}).inject(this.form.container)},_createNode:function(t){this.node=new Element("div",{id:this.json.id,MWFType:"actionbar",styles:this.css.moduleNode,events:{selectstart:function(t){t.preventDefault()}}}).inject(this.form.node),"Mobile"==this.form.options.mode?(this.node.set("text",MWF.APPFD.LP.notice.notUseModuleInMobile+"("+this.moduleName+")"),this.node.setStyles({height:"24px","line-height":"24px","background-color":"#999"})):(this.toolbarNode=new Element("div").inject(this.node),this.toolbarWidget=new MWF.widget.Toolbar(this.toolbarNode,{style:this.json.style},this),MWF.getJSON(this.path+"toolbars.json",function(t){this.json.defaultTools=t,this.setToolbars(t,this.toolbarNode),this.toolbarWidget.load()}.bind(this),!1))},_initModule:function(){this.setStyleTemplate(),this._setNodeProperty(),this.form.isSubform||this._createIconAction(),this._setNodeEvent(),this._refreshActionbar(),this.loadPosition(),this.form.designer.designNode.addEvent("scroll",function(){}.bind(this))},position:function(){if(this.parentContainer){this.sideNode=this.parentContainer.node;var t=this.sideNode.getPosition(),e=this.sideNode.getSize();this.sidePosition&&this.sidePosition.p.x==t.x&&this.sidePosition.p.y==t.y&&this.sidePosition.s.x==e.x&&this.sidePosition.s.y==e.y||this.loadPosition()}},loadPosition:function(){this.sideNode=this.parentContainer.node;var t=this.form.designer.designNode.getSize(),e=(this.form.designer.designNode.getScroll(),this.sideNode.getSize()),s=this.sideNode.getPosition(this.sideNode.getOffsetParent()),o=this.node.getSize();if(e.y>t.y){var i=t.y/2-o.y/2;if(i<s.y)this.node.setStyle("top",s.y+"px");else if(i>s.y+e.y){var n=s.y+e.y-o.y;this.node.setStyle("top",n+"px")}else this.node.setStyle("top",i+"px")}else{var l=s.y+e.y/2-o.y/2;if(l>t.y)if(s.y+o.y>t.y)this.node.setStyle("top",s.y+"px");else{n=t.y-o.y;this.node.setStyle("top",n+"px")}else if(l<=45)if(s.y+e.y<o.y+45){n=s.y+e.y-o.y;this.node.setStyle("top",n+"px")}else this.node.setStyle("top","45px");else this.node.setStyle("top",l+"px")}var d=e.x+s.x+5;this.node.setStyle("left",d+"px"),this.node.setStyle("position","absolute"),this.json.styles=this.node.getStyles(["top","left","bottom","right","position"]),this.json.styles.bottom="auto",this.json.styles.right="auto";var h=this.sideNode.getPosition(),r=this.sideNode.getSize();this.sidePosition={p:h,s:r},this.node.setStyles({right:"auto",bottom:"auto"})},_refreshActionbar:function(){if("Mobile"==this.form.options.mode)this.node.set("text",MWF.APPFD.LP.notice.notUseModuleInMobile+"("+this.moduleName+")"),this.node.setStyles({height:"24px","line-height":"24px","background-color":"#999"});else if(this.toolbarNode=this.node.getFirst("div"),this.toolbarNode.empty(),this.toolbarWidget=new MWF.widget.Toolbar(this.toolbarNode,{style:this.json.style},this),this.json.defaultTools){var t=Array.clone(this.json.defaultTools);this.json.tools&&t.append(this.json.tools),this.setToolbars(t,this.toolbarNode),this.toolbarWidget.load()}else MWF.getJSON(this.path+"toolbars.json",function(t){this.json.defaultTools=t;t=Array.clone(this.json.defaultTools);this.json.tools&&t.append(this.json.tools),this.setToolbars(t,this.toolbarNode),this.toolbarWidget.load()}.bind(this),!1)},setToolbars:function(t,e){t.each(function(t){var s=new Element("div",{MWFnodetype:t.type,MWFButtonImage:this.path+""+this.options.style+"/tools/"+t.img,title:t.title,MWFButtonAction:t.action,MWFButtonText:t.text}).inject(e);if(this.systemTools.push(s),t.sub){var o=e.getLast();this.setToolbars(t.sub,o)}}.bind(this))},_setEditStyle_custom:function(t){"hideSystemTools"==t&&(this.json.hideSystemTools?this.systemTools.each((function(t){t.setStyle("display","none")})):this.systemTools.each((function(t){t.setStyle("display","block")}))),"barPosition"!=t&&"styles"!=t||this.loadPosition(),"defaultTools"!=t&&"tools"!=t||this._refreshActionbar()}});