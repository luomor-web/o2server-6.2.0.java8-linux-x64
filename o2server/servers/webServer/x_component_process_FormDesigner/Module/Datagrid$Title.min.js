MWF.xApplication.process.FormDesigner.Module=MWF.xApplication.process.FormDesigner.Module||{},MWF.xDesktop.requireApp("process.FormDesigner","Module.$Container",null,!1),MWF.xApplication.process.FormDesigner.Module.Datagrid$Title=MWF.FCDatagrid$Title=new Class({Extends:MWF.FC$Element,Implements:[Options,Events],options:{style:"default",propertyPath:"../x_component_process_FormDesigner/Module/Datagrid$Title/datagrid$Title.html",actions:[{name:"insertCol",icon:"insertCol1.png",event:"click",action:"insertCol",title:MWF.LP.process.formAction.insertCol},{name:"deleteCol",icon:"deleteCol1.png",event:"click",action:"deleteCol",title:MWF.LP.process.formAction.deleteCol}]},initialize:function(e,t){this.setOptions(t),this.path="../x_component_process_FormDesigner/Module/Datagrid$Title/",this.cssPath="../x_component_process_FormDesigner/Module/Datagrid$Title/"+this.options.style+"/css.wcss",this._loadCss(),this.moduleType="element",this.moduleName="datagrid$Title",this.Node=null,this.form=e},setAllStyles:function(){Object.each(this.json.styles,function(e,t){t.test(/^border\w*/gi)||t&&this.node.setStyle(t,e)}.bind(this)),this.setPropertiesOrStyles("properties"),this.reloadMaplist()},_dragIn:function(e){this.parentContainer._dragIn(e)},over:function(){-1==this.form.selectedModules.indexOf(this)&&(this.form.moveModule||this.form.currentSelectedModule!=this&&this.node.setStyles({"border-width":"1px","border-color":"#0072ff"}))},unOver:function(){-1==this.form.selectedModules.indexOf(this)&&(this.form.moveModule||this.form.currentSelectedModule!=this&&this.node.setStyles({"border-width":"1px","border-color":"#999"}))},unSelected:function(){this.node.setStyles({"border-width":"1px","border-color":"#999"}),this._hideActions(),this.form.currentSelectedModule=null,this.hideProperty()},load:function(e,t,s){if(this.json=e,this.node=t,this.node.store("module",this),this.node.setStyles(this.css.moduleNode),this.node.set("text",this.json.name||"DataTitle"),!this.json.id){var i=this._getNewId(s.json.id);this.json.id=i}t.set({MWFType:"datagrid$Title",id:this.json.id}),this.form.json.moduleList[this.json.id]||(this.form.json.moduleList[this.json.id]=this.json),this._initModule(),this._loadTreeNode(s),this.parentContainer=this.treeNode.parentNode.module,this._setEditStyle_custom("id"),this.json.moduleName=this.moduleName,!1===this.json.isShow&&this._switchShow()},_createMoveNode:function(){return!1},_dragInLikeElement:function(e){return!1},setCustomStyles:function(){this._recoveryModuleData();var e=this.node.getStyle("border");this.node.clearStyles(),this.node.setStyles(this.css.moduleNode),this.initialStyles&&this.node.setStyles(this.initialStyles),this.node.setStyle("border",e),Object.each(this.json.styles,function(e,t){t.test(/^border\w*/gi)||this.node.setStyle(t,e)}.bind(this)),this.setCustomNodeStyles(this.node,this.parentContainer.json.titleStyles),!1===this.json.isShow&&this._switchShow()},insertCol:function(){var e=this,t=this.path+"insertCol.html";MWF.require("MWF.widget.Dialog",function(){var s=$(document.body).getSize(),i=s.x/2-150,o=s.y/2-90;new MWF.DL({title:"Insert Col",style:"property",top:o,left:i-40,fromTop:s.y/2-45,fromLeft:s.x/2,width:300,height:180,url:t,lp:MWF.xApplication.process.FormDesigner.LP.propertyTemplate,buttonList:[{text:MWF.APPFD.LP.button.ok,action:function(){e._insertCol(),this.close()}},{text:MWF.APPFD.LP.button.cancel,action:function(){this.close()}}]}).show()}.bind(this))},_insertCol:function(){for(var e=$("MWFInsertColNumber").get("value"),t=document.getElementsByName("MWFInsertColPosition"),s="before",i=0;i<t.length;i++)if(t[i].checked){s=t[i].value;break}for(var o=this.node.getParent("tr").getParent("table"),n=this.node.cellIndex,r=o.rows[0],l=o.rows[1],d=r.cells[n],h=1;h<=e;h++){var a=new Element("th").inject(d,s);this.form.getTemplateData("Datagrid$Title",function(e){var t=Object.clone(e),s=new MWF.FCDatagrid$Title(this.form);s.load(t,a,this.parentContainer),this.parentContainer.elements.push(s)}.bind(this))}for(var c=l.cells[n],u=1;u<=e;u++){var m=new Element("td").inject(c,s);this.form.getTemplateData("Datagrid$Data",function(e){var t=Object.clone(e),s=new MWF.FCDatagrid$Data(this.form);s.load(t,m,this.parentContainer),this.parentContainer.containers.push(s)}.bind(this))}this.unSelected(),this.selected()},deleteCol:function(e){var t=this;this.form.designer.confirm("warn",e,MWF.LP.process.notice.deleteColTitle,MWF.LP.process.notice.deleteCol,300,120,(function(){t._deleteCol(),this.close()}),(function(){this.close()}),null)},_deleteCol:function(){var e=this.node.getParent("tr"),t=e.getParent("table"),s=this.node.cellIndex,i=t.rows[0],o=t.rows[1];if(this.unSelected(),e.cells.length<=1)this.parentContainer.destroy();else{var n=i.cells[s],r=o.cells[s],l=n.retrieve("module");l&&(l.parentContainer.elements.erase(l),l.destroy());var d=r.retrieve("module");d&&(d.parentContainer.containers.erase(d),d.destroy())}},_setEditStyle_custom:function(e){"name"==e&&(this.json.name?this.node.set("text",this.json.name):this.node.set("text","DataTitle")),"isShow"==e&&this._switchShow(!0)},_switchShow:function(e){var t=this.node.getParent("tr").getParent("table"),s=this.node.cellIndex,i=!1!==this.json.isShow,o=t.rows[0].cells[s];if(o&&o.setStyle("opacity",i?"1":"0.3"),e){var n=t.rows[1].cells[s];if(n){var r=n.retrieve("module");r&&r._switchShow(i)}}}});