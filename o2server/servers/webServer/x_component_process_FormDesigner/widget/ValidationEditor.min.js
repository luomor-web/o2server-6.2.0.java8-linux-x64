MWF.xApplication.process.FormDesigner.widget=MWF.xApplication.process.FormDesigner.widget||{},MWF.require("MWF.widget.UUID",null,!1),MWF.xApplication.process.FormDesigner.widget.ValidationEditor=new Class({Implements:[Options,Events],Extends:MWF.widget.Common,options:{style:"default",maxObj:document.body},initialize:function(t,e,i){this.setOptions(i),this.node=$(t),this.designer=e,this.path="../x_component_process_FormDesigner/widget/$ValidationEditor/",this.cssPath="../x_component_process_FormDesigner/widget/$ValidationEditor/"+this.options.style+"/css.wcss",this._loadCss(),this.items=[]},load:function(t){this.titleNode=new Element("div",{styles:this.css.titleNode,text:this.designer.lp.validation.validation}).inject(this.node),this.editorNode=new Element("div",{styles:this.css.editorNode}).inject(this.node),this.actionNode=new Element("div",{styles:this.css.actionNode}).inject(this.node),this.listNode=new Element("div",{styles:this.css.listNode}).inject(this.node),this.loadEditorNode(),this.loadActionNode(),this.loadListNode(t)},loadEditorNode:function(){this.editorNode.set("html","<table width='100%' border='0' cellpadding='5' cellspacing='0' class='editTable'><tr><td></td></tr><tr><td></td></tr><tr><td></td></tr></table>");var t=this.editorNode.getElements("td").setStyles(this.css.editTableTdValue);this.loadStatus(t),this.loadConditions(t),this.loadPrompt(t)},loadStatus:function(t){var e="<table width='100%' border='0' cellpadding='0' cellspacing='0'><tr><td width='140px'><input type='radio' value='all' checked />"+this.designer.lp.validation.anytime+"<input type='radio' value='decision' />"+this.designer.lp.validation.decision+"</td><td><input type='text' value='"+this.designer.lp.validation.decisionName+"'></td></tr></table>";t[0].set("html",e);var i=t[0].getElements("input"),s=(new MWF.widget.UUID).toString();i[0].set("name","condition"+s),i[1].set("name","condition"+s),i[2].setStyles(this.css.decisionNameInput),this.decisionInputNode=i[2],this.statusRadioNodes=i,this.statusRadioNodes.pop(),this.decisionInputNode.addEvents({focus:function(){this.decisionInputNode.get("value")==this.designer.lp.validation.decisionName&&this.decisionInputNode.set("value","")}.bind(this),blur:function(){this.decisionInputNode.get("value")||this.decisionInputNode.set("value",this.designer.lp.validation.decisionName)}.bind(this)})},loadConditions:function(t){var e="<table width='100%' border='0' cellpadding='0' cellspacing='0'><tr><td width='140px'><select><option value='value'>"+this.designer.lp.validation.value+"</option><option value='length'>"+this.designer.lp.validation.length+"</option></select>&nbsp;<select><option value='isnull'>"+this.designer.lp.validation.isnull+"</option><option value='notnull'>"+this.designer.lp.validation.notnull+"</option><option value='gt'>"+this.designer.lp.validation.gt+"</option><option value='lt'>"+this.designer.lp.validation.lt+"</option><option value='equal'>"+this.designer.lp.validation.equal+"</option><option value='neq'>"+this.designer.lp.validation.neq+"</option><option value='contain'>"+this.designer.lp.validation.contain+"</option><option value='notcontain'>"+this.designer.lp.validation.notcontain+"</option></select></td><td><input style='display: none' type='text' value='"+this.designer.lp.validation.valueInput+"'/></td></tr></table>";t[1].set("html",e);var i=t[1].getElements("select");i.setStyles(this.css.valueSelect),this.valueTypeSelectNode=i[0],this.operateorSelectNode=i[1],this.valueInputNode=t[1].getElement("input").setStyles(this.css.valueInput),this.operateorSelectNode.addEvent("change",function(){var t=this.operateorSelectNode.options[this.operateorSelectNode.selectedIndex].value;t&&"isnull"!=t&&"notnull"!=t?this.valueInputNode.setStyle("display","inline"):this.valueInputNode.setStyle("display","none")}.bind(this)),this.valueInputNode.addEvents({focus:function(){this.valueInputNode.get("value")==this.designer.lp.validation.valueInput&&this.valueInputNode.set("value","")}.bind(this),blur:function(){this.valueInputNode.get("value")||this.valueInputNode.set("value",this.designer.lp.validation.valueInput)}.bind(this)})},loadPrompt:function(t){var e="<table width='100%' border='0' cellpadding='0' cellspacing='0'><tr><td width='60px'>"+this.designer.lp.validation.prompt+"</td><td><input type='text' /></td></tr></table>";t[2].set("html",e),t[2].getElements("td")[0].setStyles(this.css.titleTd),this.promptInputNode=t[2].getElement("input").setStyles(this.css.promptInput)},loadActionNode:function(){this.actionAreaNode=new Element("div",{styles:this.css.actionAreaNode}).inject(this.actionNode),this.addAction=new Element("div",{styles:this.css.addAction,text:this.designer.lp.validation.add}).inject(this.actionAreaNode),this.modifyAction=new Element("div",{styles:this.css.modifyAction_disabled,text:this.designer.lp.validation.modify}).inject(this.actionAreaNode),this.addAction.addEvent("click",function(){this.addValidation()}.bind(this)),this.modifyAction.addEvent("click",function(){this.modifyValidation()}.bind(this))},getData:function(){var t=this.getStatusValue(),e=this.decisionInputNode.get("value"),i=this.valueTypeSelectNode.options[this.valueTypeSelectNode.selectedIndex].value,s=this.operateorSelectNode.options[this.operateorSelectNode.selectedIndex].value,o=this.valueInputNode.get("value"),n=this.promptInputNode.get("value");return e==this.designer.lp.validation.decisionName&&(e=""),o==this.designer.lp.validation.valueInput&&(o=""),{status:t,decision:e,valueType:i,operateor:s,value:o,prompt:n}},addValidation:function(){this.hideErrorNode();var t=this.getData();if("all"!=t.status&&(!t.decision||t.decision==this.designer.lp.validation.decisionName))return this.showErrorNode(this.designer.lp.validation.inputDecisionName),!1;if("isnull"!=t.operateor&&"notnull"!=t.operateor&&(!t.value||t.value==this.designer.lp.validation.valueInput))return this.showErrorNode(this.designer.lp.validation.inputValue),!1;if(!t.prompt)return this.showErrorNode(this.designer.lp.validation.inputPrompt),!1;var e=new MWF.xApplication.process.FormDesigner.widget.ValidationEditor.Item(t,this);this.items.push(e),e.selected(),this.fireEvent("change")},showErrorNode:function(t){this.errorNode=new Element("div",{styles:this.css.errorNode}).inject(this.actionNode,"before"),this.errorTextNode=new Element("div",{styles:this.css.errorTextNode}).inject(this.errorNode),this.errorTextNode.set("text",t),this.errorNode.addEvent("click",function(){this.hideErrorNode()}.bind(this))},hideErrorNode:function(){this.errorNode&&this.errorNode.destroy()},getStatusValue:function(){for(var t=0;t<this.statusRadioNodes.length;t++){var e=this.statusRadioNodes[t];if(e.checked)return e.value}return""},modifyValidation:function(){if(this.currentItem){this.hideErrorNode();var t=this.getData();if("all"!=t.status&&(!t.decision||t.decision==this.designer.lp.validation.decisionName))return this.showErrorNode(this.designer.lp.validation.inputDecisionName),!1;if("isnull"!=t.operateor&&"notnull"!=t.operateor&&(!t.value||t.value==this.designer.lp.validation.valueInput))return this.showErrorNode(this.designer.lp.validation.inputValue),!1;if(!t.prompt)return this.showErrorNode(this.designer.lp.validation.inputPrompt),!1;this.currentItem.reload(t),this.currentItem.unSelected(),this.disabledModify(),this.fireEvent("change")}},loadListNode:function(t){t&&t.length&&t.each(function(t){var e=new MWF.xApplication.process.FormDesigner.widget.ValidationEditor.Item(t,this);this.items.push(e)}.bind(this))},enabledModify:function(){this.modifyAction.setStyles(this.css.modifyAction)},disabledModify:function(){this.modifyAction.setStyles(this.css.modifyAction_disabled)},setData:function(t){if(t.decision&&this.decisionInputNode.set("value",t.decision),t.status){for(var e=0;e<this.statusRadioNodes.length;e++)if(t.status==this.statusRadioNodes[e].get("value")){this.statusRadioNodes[e].set("checked",!0);break}}else this.statusRadioNodes[0].set("checked",!0);for(e=0;e<this.valueTypeSelectNode.options.length;e++)if(t.valueType==this.valueTypeSelectNode.options[e].get("value")){this.valueTypeSelectNode.options[e].set("selected",!0);break}for(e=0;e<this.operateorSelectNode.options.length;e++)if(t.operateor==this.operateorSelectNode.options[e].get("value")){this.operateorSelectNode.options[e].set("selected",!0);break}t.value&&this.valueInputNode.set("value",t.value),t.prompt&&this.promptInputNode.set("value",t.prompt)},deleteItem:function(t){this.currentItem==t&&t.unSelected(),this.items.erase(t),t.node.destroy(),MWF.release(t),this.fireEvent("change")},getValidationData:function(){var t=[];return this.items.each((function(e){t.push(e.data)})),t}}),MWF.xApplication.process.FormDesigner.widget.ValidationEditor.Item=new Class({initialize:function(t,e){this.data=t,this.editor=e,this.container=this.editor.listNode,this.css=this.editor.css,this.lp=this.editor.designer.lp,this.load()},load:function(){this.node=new Element("div",{styles:this.css.itemNode}).inject(this.container),this.deleteNode=new Element("div",{styles:this.css.itemDeleteNode}).inject(this.node),this.contentNode=new Element("div",{styles:this.css.itemContentNode}).inject(this.node),this.contentNode.set("text",this.getText()),this.contentNode.addEvent("click",function(){this.selected()}.bind(this)),this.deleteNode.addEvent("click",function(t){this.deleteItem(t)}.bind(this))},reload:function(t){this.data=t,this.contentNode.set("text",this.getText())},getText:function(){var t="";return t="all"==this.data.status?this.lp.validation.anytime+" ":this.lp.validation.when+this.lp.validation.decision+' "'+this.data.decision+'" '+this.lp.validation.as+" ",t+=this.lp.validation[this.data.valueType]+" ",t+=this.lp.validation[this.data.operateor]+" ",t+=' "'+this.data.value+'" ',t+=this.lp.validation.prompt+': "'+this.data.prompt+'"'},selected:function(){this.editor.currentItem&&this.editor.currentItem.unSelected(),this.node.setStyles(this.css.itemNode_current),this.editor.currentItem=this,this.editor.setData(this.data),this.editor.enabledModify()},unSelected:function(){this.node.setStyles(this.css.itemNode),this.editor.currentItem=this,this.editor.disabledModify()},deleteItem:function(t){var e=this;this.editor.designer.confirm("warn",t,this.lp.validation.delete_title,this.lp.validation.delete_text,300,120,(function(){e.destroy(),this.close()}),(function(){this.close()}))},destroy:function(){this.editor.deleteItem(this)}});