MWF.require("MWF.widget.Common",null,!1),MWF.require("MWF.widget.JsonTemplate",null,!1),MWF.xApplication.process.FormDesigner.Property=MWF.FCProperty=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",path:"../x_component_process_FormDesigner/property/property.html"},initialize:function(t,e,i,n){this.setOptions(n),this.module=t,this.form=t.form,this.data=t.json,this.data.pid=this.form.options.mode+this.form.json.id+this.data.id,this.htmlPath=this.options.path,this.designer=i,this.maplists={},this.propertyNode=e},load:function(){this.fireEvent("queryLoad")&&MWF.getRequestText(this.htmlPath,function(t,e){this.htmlString=t,this.fireEvent("postLoad")}.bind(this)),this.propertyNode.addEvent("keydown",(function(t){t.stopPropagation()}))},editProperty:function(t){},getHtmlString:function(t){this.htmlString?t&&t():MWF.getRequestText(this.htmlPath,function(e,i){this.htmlString=e,t&&t()}.bind(this))},show:function(){this.propertyContent?this.propertyContent.setStyle("display","block"):this.getHtmlString(function(){var t;this.htmlString&&(t="cms"===this.options.appType?MWF.xApplication.cms.FormDesigner.LP.propertyTemplate:MWF.xApplication.process.FormDesigner.LP.propertyTemplate,this.htmlString=o2.bindJson(this.htmlString,{lp:t}),this.JsonTemplate=new MWF.widget.JsonTemplate(this.data,this.htmlString),this.propertyContent=new Element("div",{styles:{overflow:"hidden"}}).inject(this.propertyNode),this.propertyContent.set("html",this.JsonTemplate.load()),this.setEditNodeEvent(),this.setEditNodeStyles(this.propertyContent),this.loadPropertyTab(),this.loadMaplist(),this.loadStylesList(),this.loadDivTemplateType(),this.loadPersonInput(),this.loadFormFieldInput(),this.loadScriptArea(),this.loadCssArea(),this.loadHtmlEditorArea(),this.loadTreeData(),this.loadArrayList(),this.loadEventsEditor(),this.loadActionArea(),this.loadActionStylesArea(),this.loadHTMLArea(),this.loadJSONArea(),this.loadFormSelect(),this.loadSubformSelect(),this.loadWidgetSelect(),this.loadANNModelSelect(),this.loadValidation(),this.loadIconSelect(),this.loadLabelFlagSelect(),this.loadImageClipper(),this.loadImageFileSelect(),this.loadParameterEditor(),this.loadContextRoot(),this.loadUnitTypeSelector(),this.loadSourceTestRestful(),this.loadSidebarPosition(),this.loadViewFilter(),this.loadStatementFilter(),this.loadDocumentTempleteSelect(),this.loadFieldConfig(),this.loadHelp())}.bind(this)),new Fx.Scroll(layout.desktop.node).toTop()},hide:function(){this.propertyContent&&this.propertyContent.setStyle("display","none")},destroy:function(){this.propertyContent&&this.propertyContent.destroy(),MWF.release(this)},loadTreeData:function(){this.propertyContent.getElements(".MWFTreeData").each(function(t){var e=t.get("title"),i=t.get("name"),n=this.data[i];n||(n=[]),MWF.require("MWF.widget.TreeEditor",function(){var s=new MWF.widget.TreeEditor(t,{title:e,maxObj:this.propertyNode.parentElement.parentElement.parentElement,onChange:function(){this.data[i]=s.toJson(),this.module.json[i]=this.data[i],this.module._refreshTree()}.bind(this)});s.load(n)}.bind(this)),t.addEvent("keydown",(function(t){t.stopPropagation()}))}.bind(this))},loadJSONArea:function(){var t=this.propertyContent.getElement(".MWFJSONArea");t&&this.propertyTab.pages.each(function(e){e.contentNode===t.parentElement&&e.setOptions({onShow:function(){t.empty(),MWF.require("MWF.widget.JsonParse",function(){this.json=new MWF.widget.JsonParse(this.module.json,t,null),this.json.load()}.bind(this))}.bind(this)})}.bind(this))},loadHTMLArea:function(){var t=this.propertyContent.getElement(".MWFHTMLArea");if(t){var e=this.module.node.clone(!0,!0);e.clearStyles(!0),t.set("text",e.outerHTML),e.destroy(),this.propertyTab.pages.each(function(e){e.contentNode==t.parentElement&&e.setOptions({onShow:function(){var e=this.module.node.clone(!0,!0);e.clearStyles(!0),o2.load("JSBeautifier_html",function(){t.set("text",html_beautify(e.outerHTML,{indent_size:1})),o2.require("o2.widget.ace",function(){MWF.widget.ace.load(function(){o2.load("../o2_lib/ace/src-min-noconflict/ext-static_highlight.js",function(){ace.require("ace/ext/static_highlight")(t,{mode:"ace/mode/html",theme:"ace/theme/eclipse",fontSize:16})}.bind(this))}.bind(this))}.bind(this)),e.destroy()}.bind(this))}.bind(this)})}.bind(this))}},loadSidebarPosition:function(){var t=this.propertyContent.getElements(".MWFSidebarReposition");t.length&&t.each(function(t){t.addEvent("click",function(){this.module.json.styles.top="",this.module.loadPosition()}.bind(this))}.bind(this))},loadANNModelSelect:function(){var t=this.propertyContent.getElements(".MWFANNModelSelect");t.length&&this.getModelList(function(){t.each(function(t){var e=new Element("select").inject(t);e.addEvent("change",function(t){this.setValue(t.target.getParent("div").get("name"),t.target.options[t.target.selectedIndex].value,e)}.bind(this)),this.setModelSelectOptions(t,e),new Element("div",{styles:this.form.css.propertyRefreshFormNode}).inject(t).addEvent("click",function(i){this.getModelList(function(){this.setModelSelectOptions(t,e)}.bind(this),!0)}.bind(this))}.bind(this))}.bind(this))},getModelList:function(t,e){if(!this.models||e){var i=o2.Actions.get("x_query_assemble_designer");i.listModel&&i.listModel(function(e){this.models=e.data,t&&t()}.bind(this))}else t&&t()},setModelSelectOptions:function(t,e){var i=t.get("name");e.empty();new Element("option",{text:"none"}).inject(e);this.models.each(function(t){new Element("option",{text:t.name,value:t.id,selected:this.data[i]==t.id}).inject(e)}.bind(this))},loadFormSelect:function(){var t=this.propertyContent.getElements(".MWFFormSelect");t.length&&this.getFormList(function(){t.each(function(t){var e=new Element("select").inject(t);e.addEvent("change",function(t){var i=t.target.options[t.target.selectedIndex].value;this.setValue(t.target.getParent("div").get("name"),i,e)}.bind(this)),this.setFormSelectOptions(t,e),new Element("div",{styles:this.form.css.propertyRefreshFormNode}).inject(t).addEvent("click",function(i){this.getFormList(function(){this.setFormSelectOptions(t,e)}.bind(this),!0)}.bind(this))}.bind(this))}.bind(this))},setFormSelectOptions:function(t,e){var i=t.get("name");e.empty();new Element("option",{text:"none"}).inject(e);this.forms.each(function(t){if(this.form.json.id!==t.id)new Element("option",{text:t.name,value:t.id,selected:this.data[i]==t.id}).inject(e)}.bind(this))},getFormList:function(t,e){!this.forms||e?this.form.designer.actions.listForm(this.form.designer.application.id,function(e){this.forms=e.data,t&&t()}.bind(this)):t&&t()},loadSubformSelect:function(){var t=this.propertyContent.getElements(".MWFSubFormSelectContainer");t.length&&t.each(function(t){var e,i=t.getElement(".MWFSubformAppSelect"),n=t.getElement(".MWFSubformSelect"),s=i.get("name"),o=n.get("name");this.loadProcessApplictionSelect(i,s,function(t){var i=this.data[s]||"";this.data[s]=t.length?t[0].data.id:"",i!==this.data[s]&&this.getSubFormList(function(){this.setSubformSelectOptions(n,e),e.fireEvent("change")}.bind(this),!0,s)}.bind(this)),e=this._loadSubformSelect(n,o,s)}.bind(this))},loadProcessApplictionSelect:function(t,e,i){var n=e?this.data[e]:"";MWF.xDesktop.requireApp("process.ProcessDesigner","widget.PersonSelector",function(){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.form.designer,{title:this.form.designer.lp.selectApplication,type:"application",count:1,names:n?[{id:n}]:[],onChange:function(t){i(t)}.bind(this)})}.bind(this))},_loadSubformSelect:function(t,e,i){var n;return this.getSubFormList(function(){(n=new Element("select").inject(t)).addEvent("change",function(t){var i=n.options[n.selectedIndex].value;this.setValue(e,i,n)}.bind(this)),this.setSubformSelectOptions(t,n),new Element("div",{styles:this.form.css.propertyRefreshFormNode}).inject(t).addEvent("click",function(e){this.getSubFormList(function(){this.setSubformSelectOptions(t,n)}.bind(this),!0,i)}.bind(this))}.bind(this),!1,i),n},setSubformSelectOptions:function(t,e){var i=t.get("name");e.empty();new Element("option",{text:"none"}).inject(e);this.subforms.each(function(t){if(this.form.json.id!==t.id)new Element("option",{text:t.name,value:t.id,selected:this.data[i]==t.id}).inject(e)}.bind(this))},getSubFormList:function(t,e,i){var n=i?this.data[i]:"";!this.subforms||e?this.form.designer.actions.listForm(n||this.form.designer.application.id,function(e){this.subforms=e.data,t&&t()}.bind(this),null,!1):t&&t()},loadPageSelect:function(){var t=this.propertyContent.getElements(".MWFPageSelect");t.length&&this.getPageList(function(){t.each(function(t){var e=new Element("select").inject(t);e.addEvent("change",function(t){var i=t.target.options[t.target.selectedIndex].value;this.setValue(t.target.getParent("div").get("name"),i,e)}.bind(this)),this.setPageSelectOptions(t,e),new Element("div",{styles:this.form.css.propertyRefreshFormNode}).inject(t).addEvent("click",function(i){this.getPageList(function(){this.setPageSelectOptions(t,e)}.bind(this),!0)}.bind(this))}.bind(this))}.bind(this))},setPageSelectOptions:function(t,e){var i=t.get("name");e.empty();new Element("option",{text:"none"}).inject(e);this.pages.each(function(t){if(this.form.json.id!==t.id)new Element("option",{text:t.name,value:t.id,selected:this.data[i]==t.id}).inject(e)}.bind(this))},getPageList:function(t,e){!this.pages||e?this.form.designer.actions.listPage(this.form.designer.application.id,function(e){this.pages=e.data,t&&t()}.bind(this)):t&&t()},loadWidgetSelect:function(){var t=this.propertyContent.getElements(".MWFWidgetSelect");t.length&&this.getWidgetList(function(){t.each(function(t){var e=new Element("select").inject(t);e.addEvent("change",function(t){var i=t.target.options[t.target.selectedIndex].value;this.setValue(t.target.getParent("div").get("name"),i,e)}.bind(this)),this.setWidgetSelectOptions(t,e),new Element("div",{styles:this.form.css.propertyRefreshFormNode}).inject(t).addEvent("click",function(i){this.getWidgetList(function(){this.setWidgetSelectOptions(t,e)}.bind(this),!0)}.bind(this))}.bind(this))}.bind(this))},setWidgetSelectOptions:function(t,e){var i=t.get("name");e.empty();new Element("option",{text:"none"}).inject(e);this.widgets.each(function(t){if(this.form.json.id!==t.id)new Element("option",{text:t.name,value:t.id,selected:this.data[i]==t.id}).inject(e)}.bind(this))},getWidgetList:function(t,e){!this.widgets||e?this.form.designer.actions.listWidget(this.form.designer.application.id,function(e){this.widgets=e.data,t&&t()}.bind(this)):t&&t()},loadDocumentTempleteSelect:function(){var t=this.propertyContent.getElements(".MWFDocumentTempleteSelect");t.length&&o2.getJSON("../x_component_process_FormDesigner/Module/Documenteditor/templete/templete.json",function(e){t.each(function(t){var i=t.get("name");Object.each(e,function(e,n){new Element("option",{text:e.name,value:n,selected:this.data[i]==n}).inject(t)}.bind(this)),t.addEvent("change",function(e){var i=this.data[s],n=e.target.options[e.target.selectedIndex].value,s=e.target.options[e.target.selectedIndex].get("text");this.changeJsonDate([s],n),this.changeData(s,t,i)}.bind(this))}.bind(this))}.bind(this))},loadStatementFilter:function(){var t=this.propertyContent.getElements(".MWFStatementFilter"),e=this.data.filterList;t.each(function(t){MWF.xDesktop.requireApp("query.StatementDesigner","widget.ViewFilter",function(){var i=this;this.viewFilter=new MWF.xApplication.query.StatementDesigner.widget.ViewFilter(t,this.form.designer,{filtrData:e,customData:null,parameterData:null},{statementId:this.data.queryStatement?this.data.queryStatement.id:"",withForm:!0,onChange:function(t){var e=this.getData();i.changeJsonDate(["filterList"],e.filterData)}})}.bind(this))}.bind(this))},loadViewFilter:function(){var t=this.propertyContent.getElements(".MWFViewFilter"),e=this.data.filterList;t.each(function(t){MWF.xDesktop.requireApp("query.ViewDesigner","widget.ViewFilter",function(){var i=this;new MWF.xApplication.query.ViewDesigner.widget.ViewFilter(t,this.form.designer,{filtrData:e,customData:null},{onChange:function(t){var e=this.getData();i.changeJsonDate(["filterList"],e.data)}})}.bind(this))}.bind(this))},loadViewSelect:function(){var t=this.propertyContent.getElements(".MWFViewSelect");t.length&&this.getViewList(function(){t.each(function(t){var e=new Element("select").inject(t);e.addEvent("change",function(t){var e=t.target.options[t.target.selectedIndex].value,i=t.target.options[t.target.selectedIndex].get("text");this.setValue(t.target.getParent("div").get("name"),e),this.setValue(t.target.getParent("div").get("name")+"Name",i)}.bind(this)),this.setViewSelectOptions(t,e),new Element("div",{styles:this.form.css.propertyRefreshFormNode}).inject(t).addEvent("click",function(i){this.getViewList(function(){this.setViewSelectOptions(t,e)}.bind(this),!0)}.bind(this))}.bind(this))}.bind(this))},setViewSelectOptions:function(t,e){var i=t.get("name");e.empty();new Element("option",{text:"none"}).inject(e);this.views.each(function(t){new Element("option",{text:t.name,value:t.id,selected:this.data[i]==t.id}).inject(e)}.bind(this))},getViewList:function(t,e){!this.views||e?this.form.designer.actions.listView(this.form.designer.application.id,function(e){this.views=e.data,t&&t()}.bind(this)):t&&t()},loadValidation:function(){var t=this.propertyContent.getElements(".MWFValidation");t.length&&t.each(function(t){var e=t.get("name");MWF.xDesktop.requireApp("process.FormDesigner","widget.ValidationEditor",function(){var i=new MWF.xApplication.process.FormDesigner.widget.ValidationEditor(t,this.designer,{onChange:function(){var t=i.getValidationData();this.data[e]=t}.bind(this)});i.load(this.data[e])}.bind(this))}.bind(this))},loadFieldConfig:function(){var t=this.propertyContent.getElements(".MWFFieldConfigArea");t.length&&t.each(function(t){var e,i=t.get("name");e=this.data[i]?this.data[i]:this.data[i]=[],MWF.xDesktop.requireApp("process.FormDesigner","widget.FiledConfigurator",function(){var n=new MWF.xApplication.process.FormDesigner.widget.FiledConfigurator(t,this.designer,{onChange:function(){this.data[i]=n.getData()}.bind(this)},e);n.load()}.bind(this))}.bind(this))},loadIconSelect:function(){var t=this.propertyContent.getElements(".MWFIcon");t.length&&t.each(function(t){var e=t.get("name"),i=this.data[e],n=new Element("div",{styles:this.form.css.processIconNode}).inject(t);i&&n.setStyles({background:"url("+i+") center center no-repeat"}),new Element("div",{styles:this.form.css.processIconSelectNode,text:this.form.designer.lp.selectIcon}).inject(t).addEvent("click",function(){this.selectIcon(t)}.bind(this))}.bind(this))},selectIcon:function(t){if(!t.iconMenu){var e=new MWF.widget.Menu(t,{event:"click",style:"processIcon"});e.load(),t.iconMenu=e;for(var i=this,n=0;n<=48;n++){var s="../x_component_process_ProcessManager/$Explorer/default/processIcon/process_icon_"+n+".png";e.addMenuItem("","click",(function(){var e=t.get("name"),n=this.item.getElement("img").get("src");i.data[e]=n,t.getFirst("div").setStyle("background-image","url("+n+")")}),s).iconName=s}}},loadLabelFlagSelect:function(){var t=this.propertyContent.getElements(".MWFLabelFlag");t.length&&t.each(function(t){var e=t.get("name"),i=this.data[e],n=new Element("div",{styles:this.form.css.labelFlagNode}).inject(t);i&&n.setStyles({background:"url("+i+") center center no-repeat"}),new Element("div",{styles:this.form.css.processIconSelectNode,text:this.form.designer.lp.empty}).inject(t).addEvent("click",function(e){var i=t.get("name");this.data[i]="",t.getFirst("div").setStyle("background-image",""),this.changeData(i),e.stopPropagation()}.bind(this)),new Element("div",{styles:this.form.css.processIconSelectNode,text:this.form.designer.lp.select}).inject(t).addEvent("click",function(){this.selectLabelFlag(t)}.bind(this))}.bind(this))},selectLabelFlag:function(t){if(!t.iconMenu){var e=new MWF.widget.Menu(t,{event:"click",style:"labelFlag"});e.load(),t.iconMenu=e;for(var i=this,n=1;n<=21;n++){var s="../x_component_process_FormDesigner/Module/Label/default/icon/flag/"+n+".png";e.addMenuItem("","click",(function(){var e=t.get("name"),n=this.item.getElement("img").get("src");i.data[e]=n,t.getFirst("div").setStyle("background-image","url("+n+")"),i.changeData(e)}),s).iconName=s}}},loadImageFileSelect:function(){},setFileSelectOptions:function(t,e){var i=t.get("name");e.empty();new Element("option",{text:"none"}).inject(e);this.files.each(function(t){new Element("option",{text:t.name,value:t.id,selected:this.data[i]==t.id}).inject(e)}.bind(this))},getFileList:function(t,e){!this.files||e?this.form.designer.actions.listFile(this.form.designer.application.id,function(e){this.files=e.data,t&&t()}.bind(this)):t&&t()},loadImageClipper:function(){var t=this.propertyContent.getElements(".MWFImageClipper");t.length&&t.each(function(t){var e=t.get("name");new Element("div",{styles:this.form.css.processIconSelectNode,text:this.form.designer.lp.selectImage}).inject(t).addEvent("click",function(){this.selectImage(t,e)}.bind(this))}.bind(this))},createUploadFileAreaNode:function(t,e){this.uploadFileAreaNode=new Element("div");this.uploadFileAreaNode.set("html",'<input name="file" multiple type="file" accept="images/*" />'),this.fileUploadNode=this.uploadFileAreaNode.getFirst(),this.fileUploadNode.addEvent("change",function(){var i=this.fileUploadNode.files;if(i.length){i.length;for(var n=0;n<i.length;n++){var s=i.item(n),o=new FormData;o.append("file",s),MWF.xDesktop.uploadImage(this.form.json.id,"page"==this.module.form.moduleType?"portalPage":"processPlatformForm",o,s,function(i){var n=i.id,s={imageSrc:MWF.xDesktop.getImageSrc(n),imageId:n};this.changeJsonDate(e,s),this.changeData(e,t,null)}.bind(this))}}}.bind(this))},selectImage:function(t,e){this.uploadFileAreaNode||this.createUploadFileAreaNode(t,e),this.fileUploadNode.set("multiple",!1);var i=this.uploadFileAreaNode.getFirst();i.set("accept",".png,.jpg,.bmp,.gif,.jpeg,.jpe"),i.click()},loadEventsEditor:function(){var t=this.propertyContent.getElement(".MWFEventsArea");if(t){var e=t.get("name"),i=this.data[e];MWF.xDesktop.requireApp("process.FormDesigner","widget.EventsEditor",function(){new MWF.xApplication.process.FormDesigner.widget.EventsEditor(t,this.designer,{maxObj:this.designer.formContentNode||this.designer.pageContentNode}).load(i,this.data,e)}.bind(this))}},testRestful:function(){var t=this.propertyContent.getElements(".MWFTestRestful");if(t){t.getLast();t.getFirst().addEvent("click",function(){}.bind(this))}},loadContextRoot:function(){var t=this.propertyContent.getElements(".MWFContextRoot");t&&t.each(function(t){var e=t.get("name"),i=t.getElements("select"),n=i[0],s=i[1],o=i[2],a=t.getElement("input"),r=function(){var t;try{t=JSON.parse(this.data[e])}catch(i){t={root:this.data[e],action:"",method:"",uri:""}}return t}.bind(this),d=r(),c=function(){var t=n.options[n.selectedIndex].value,e=o2.Actions.load(t);s.empty(),o.empty(),a.set("value","");var i=r();return Object.each(e,(function(t,e){new Element("option",{value:e,text:e,selected:i.action==e}).inject(s)})),JSON.stringify({root:t,action:"",method:"",uri:""})},h=function(){var t=n.options[n.selectedIndex].value,e=s.options[s.selectedIndex].value,i=o2.Actions.load(t);o.empty(),a.set("value","");var d=r();return Object.each(i[e].action.actions,(function(t,e){new Element("option",{value:e,text:e,selected:d.method==e}).inject(o)})),JSON.stringify({root:t,action:e,method:"",uri:""})},l=function(){var t=n.options[n.selectedIndex].value,e=s.options[s.selectedIndex].value,i=o.options[o.selectedIndex].value,r=o2.Actions.load(t)[e].action.actions[i].uri;return a.set("value",r),JSON.stringify({root:t,action:e,method:i,uri:r})};Object.each(layout.serviceAddressList,function(t,e){new Element("option",{value:e,text:t.name,selected:d.root==e}).inject(n)}.bind(this)),c(),h(),l(),n.addEvent("change",function(){c(),h();var i=l();this.changeJsonDate(e,i),this.changeData(e,t,d)}.bind(this)),s.addEvent("change",function(){h();var i=l();this.changeJsonDate(e,i),this.changeData(e,t,d)}.bind(this)),o.addEvent("change",function(){var i=l();this.changeJsonDate(e,i),this.changeData(e,t,d)}.bind(this))}.bind(this))},loadSourceTestRestful:function(){var t=this.propertyContent.getElements(".MWFSourceTestRestful");t.length&&t.each(function(t){var e=t.getFirst(),i=t.getLast();e.addEvent("click",function(t){this.testSourceRestful(i)}.bind(this))}.bind(this))},testSourceRestful:function(t){var e;try{e=JSON.parse(this.module.json.contextRoot)}catch(t){e={root:this.module.json.contextRoot,action:"",method:"",url:""}}var i=this._getO2Address(e.root),n=this._getO2Uri(this.module,i);this._invoke(this.module,n,function(e){t.empty(),MWF.require("MWF.widget.JsonParse",function(){new MWF.widget.JsonParse(e,t,null).load()}.bind(this))}.bind(this))},_getO2Address:function(t){var e=layout.serviceAddressList[t],i="";if(e)i=layout.config.app_protocol+"//"+e.host+(80==e.port?"":":"+e.port)+e.context;else{var n=layout.desktop.centerServer.host||window.location.hostname,s=layout.desktop.centerServer.port;i=layout.config.app_protocol+"//"+n+("80"==s?"":":"+s)+"/x_program_center"}return i},_getO2Uri:function(t,e){var i=t.json.path,n={};MWF.require("MWF.xScript.Macro",null,!1);var s=new MWF.Macro.PageContext({businessData:{},json:{},options:{}});t.json.parameters&&Object.each(t.json.parameters,function(t,e){if(-1!==i.indexOf("{"+e+"}")){var o=new RegExp("{"+e+"}","g");i=i.replace(o,encodeURIComponent(t&&t.code?s.exec(t.code,this)||"":t))}else n[e]=t}.bind(this));var o=null;if(t.json.requestBody&&t.json.requestBody.code&&(o=s.exec(t.json.requestBody.code,this)),"GET"===t.json.httpMethod||"OPTIONS"===t.json.httpMethod||"HEAD"===t.json.httpMethod||"DELETE"===t.json.httpMethod){var a="?";-1!==i.indexOf("?")&&(a="&"),Object.each(n,function(t,e){var n=t&&t.code?s.exec(t.code,this)||"":t;i=i+a+e+"="+n}.bind(this))}else Object.each(n,function(t,e){o||(o={});var i=t&&t.code?s.exec(t.code,this)||"":t;o[e]=i}.bind(this));return this.body=o,{uri:e+i,body:o}},_invoke:function(t,e,i){MWF.restful(t.json.httpMethod,e.uri,JSON.encode(e.body),function(t){i&&i(t)}.bind(this),!0,!0)},loadUnitTypeSelector:function(){var t=this.propertyContent.getElements(".MWFFormUnitTypeSelector");t.length&&this.getUnitTypeList(function(){t.each(function(t){var e=new Element("select").inject(t);e.addEvent("change",function(t){this.setValue(t.target.getParent("div").get("name"),t.target.options[t.target.selectedIndex].value)}.bind(this)),this.setUnitTypeSelectOptions(t,e),this.setValue(e.getParent("div").get("name"),e.options[e.selectedIndex].value)}.bind(this))}.bind(this))},setUnitTypeSelectOptions:function(t,e){var i=t.get("name");e.empty();new Element("option",{value:"all",text:this.form.designer.lp.all,selected:!this.data[i]||"all"===this.data[i]}).inject(e);this.unitTypeList.each(function(t){new Element("option",{text:t,value:t,selected:this.data[i]===t}).inject(e)}.bind(this))},getUnitTypeList:function(t,e){!this.unitTypeList||e?MWF.Actions.get("x_organization_assemble_control").listUnitType(function(e){this.unitTypeList=e.data.valueList,t&&t()}.bind(this)):t&&t()},loadParameterEditor:function(){var t=this.propertyContent.getElements(".MWFParameterArea");t&&t.each(function(t){var e=t.get("name");this.data[e]||(this.data[e]={});var i=this.data[e];MWF.xDesktop.requireApp("process.FormDesigner","widget.ParameterEditor",function(){new MWF.xApplication.process.FormDesigner.widget.ParameterEditor(t,this.designer,{maxObj:this.designer.formContentNode}).load(i,this.data,e)}.bind(this))}.bind(this))},loadArrayList:function(){this.propertyContent.getElements(".MWFArraylist").each(function(t){var e=t.get("title"),i=t.get("name"),n=this.data[i];n||(n=[]),MWF.require("MWF.widget.Arraylist",function(){var s=new MWF.widget.Arraylist(t,{title:e,onChange:function(){this.data[i]=s.toArray()}.bind(this)});s.load(n)}.bind(this)),t.addEvent("keydown",(function(t){t.stopPropagation()}))}.bind(this))},loadHtmlEditorArea:function(){this.propertyContent.getElements(".MWFHtmlEditorArea").each(function(t){var e=t.get("title"),i=t.get("name"),n=this.data[i];MWF.require("MWF.widget.HtmlEditorArea",function(){var s=new MWF.widget.HtmlEditorArea(t,{title:e,maxObj:this.designer.formContentNode||this.designer.pageContentNode,onChange:function(){this.data[i]=s.getValue(),this.changeData(i),s.isChanged=!0}.bind(this),onSave:function(){this.designer.saveForm()}.bind(this)});s.load({code:n})}.bind(this))}.bind(this))},loadStylesList:function(){var t=this;this.propertyContent.getElements(".MWFFormStyle").each(function(e){if(this.module.form.stylesList){this.data.formStyleType||(this.data.formStyleType="default");var i="mobile"===(this.form.options.mode||"").toLowerCase()?"mobile":"pc";Object.each(this.module.form.stylesList,function(t,n){t.mode.contains(i)&&new Element("option",{text:t.name,value:n,selected:!this.data.formStyleType&&"default"==n||this.data.formStyleType==n}).inject(e)}.bind(this))}else e.getParent("tr").setStyle("display","none");new Element("div",{styles:this.form.css.propertyRefreshFormNode}).inject(e,"after").addEvent("click",function(e){t.changeData(this.get("name"),this)}.bind(e))}.bind(this))},loadDivTemplateType:function(){var t=this.propertyContent.getElements(".MWFDivTemplate");if(t.length){var e=[];if(this.module.form.templateStyles&&this.module.form.templateStyles[this.module.moduleName]){var i=this.module.form.templateStyles[this.module.moduleName];i&&Object.each(i,function(t,i){e.push(i)}.bind(this))}t.each(function(t){t.empty(),new Element("option",{text:"default",value:"default",selected:!this.data.templateType||"default"==this.data.templateType}).inject(t),e.length?e.each(function(e){new Element("option",{text:i[e].name,value:e,selected:this.data.templateType==e}).inject(t)}.bind(this)):t.getParent("tr").setStyle("display","none")}.bind(this))}},loadPersonInput:function(){var personIdentityNodes=this.propertyContent.getElements(".MWFPersonIdentity"),personUnitNodes=this.propertyContent.getElements(".MWFPersonUnit"),dutyNodes=this.propertyContent.getElements(".MWFDutySelector"),dutyNameNodes=this.propertyContent.getElements(".MWFPersonDuty"),viewNodes=this.propertyContent.getElements(".MWFViewSelect"),cmsviewNodes=this.propertyContent.getElements(".MWFCMSViewSelect"),queryviewNodes=this.propertyContent.getElements(".MWFQueryViewSelect"),queryStatementNodes=this.propertyContent.getElements(".MWFQueryStatementSelect"),querystatNodes=this.propertyContent.getElements(".MWFQueryStatSelect"),fileNodes=this.propertyContent.getElements(".MWFImageFileSelect"),processFileNodes=this.propertyContent.getElements(".MWFProcessImageFileSelect"),scriptNodes=this.propertyContent.getElements(".MWFScriptSelect"),formStyleNodes=this.propertyContent.getElements(".MWFFormStyleSelect"),dictionaryNodes=this.propertyContent.getElements(".MWFDictionarySelect"),queryImportModelNodes=this.propertyContent.getElements(".MWFQueryImportModelSelect");MWF.xDesktop.requireApp("process.ProcessDesigner","widget.PersonSelector",function(){personIdentityNodes.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.form.designer,{type:"identity",names:this.data[t.get("name")],onChange:function(e){this.savePersonItem(t,e)}.bind(this)})}.bind(this)),personUnitNodes.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.form.designer,{type:"unit",names:this.data[t.get("name")],onChange:function(e){this.savePersonItem(t,e)}.bind(this)})}.bind(this)),dutyNodes.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.form.designer,{type:"duty",names:this.data[t.get("name")],onChange:function(e){this.addDutyItem(t,e)}.bind(this),onRemoveDuty:function(e){this.removeDutyItem(t,e)}.bind(this)})}.bind(this)),dutyNameNodes.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.form.designer,{type:"dutyName",names:this.data[t.get("name")],onChange:function(e){this.savePersonItem(t,e)}.bind(this)})}.bind(this)),viewNodes.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.form.designer,{type:"View",count:1,names:[this.data[t.get("name")]],onChange:function(e){this.saveViewItem(t,e)}.bind(this)})}.bind(this)),cmsviewNodes.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.form.designer,{type:"CMSView",count:1,names:[this.data[t.get("name")]],onChange:function(e){this.saveViewItem(t,e)}.bind(this)})}.bind(this)),queryviewNodes.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.form.designer,{type:"QueryView",count:1,names:[this.data[t.get("name")]],onChange:function(e){this.saveViewItem(t,e)}.bind(this)})}.bind(this)),queryStatementNodes.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.form.designer,{type:"QueryStatement",count:1,names:[this.data[t.get("name")]],onChange:function(e){this.saveViewItem(t,e)}.bind(this)})}.bind(this)),querystatNodes.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.form.designer,{type:"QueryStat",count:1,names:[this.data[t.get("name")]],onChange:function(e){this.saveViewItem(t,e)}.bind(this)})}.bind(this)),queryImportModelNodes.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.form.designer,{type:"QueryImportModel",count:1,names:[this.data[t.get("name")]],onChange:function(e){this.saveViewItem(t,e)}.bind(this)})}.bind(this)),scriptNodes.each(function(t){var e=new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.form.designer,{type:"Script",count:t.dataset.count||1,names:t.dataset.count&&1!=t.dataset.count.toInt()?this.data[t.get("name")]:[this.data[t.get("name")]],onChange:function(e){this.saveScriptSelectItem(t,e)}.bind(this)});t.store("selector",e);var i=t.getNext();if(i.hasClass("MWFScriptSelectAction")){var n=this,s=i.getFirst(),o=i.getLast();s.store("slectNode",t),o.store("slectNode",t),s.addEvent("click",(function(e){if(this.retrieve("slectNode")){var i=t.get("name"),s=n.data[i];if(s){var o=JSON.encode(s);o2.DL.open({isTitle:!1,width:400,height:500,html:"<textarea style='width: 99%; height: 98%'>"+o+"</textarea>",buttonList:[{type:"ok",text:"ok",action:function(){this.close()}}]})}}})),o.addEvent("click",(function(t){var e=this.retrieve("slectNode");e&&o2.DL.open({isTitle:!1,width:400,height:500,html:"<textarea style='width: 99%; height: 98%'></textarea>",buttonList:[{type:"ok",text:"ok",action:function(){var t=this.content.getElement("textarea").get("value");try{var i=JSON.decode(t),s=e.retrieve("selector");s.setData(i),n.saveScriptSelectItem(e,s.identitys)}catch(t){throw t}this.close()}},{type:"cancel",text:"cancel",action:function(){this.close()}}]})}))}}.bind(this));var _self=this;formStyleNodes.each(function(node){var data=this.data[node.get("name")];if("string"===typeOf(data))for(var key in this.module.form.stylesList){var s=this.module.form.stylesList[key];if(!data&&"default"==key||data==key){data={name:s.name,id:key};break}}new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(node,this.form.designer,{type:"FormStyle",count:1,names:[data],selectorOptions:{mode:"mobile"===(this.form.options.mode||"").toLowerCase()?"mobile":"pc"},validFun:function(ids){var flag=!0;return 0===ids.length?(this.designer.notice(MWF.APPFD.LP.mustSelectFormStyle,"error"),flag=!1):"script"===ids[0].data.type&&this.designer.actions.getScriptByName(ids[0].data.name,ids[0].data.application,function(json){try{var f=eval("(function(){\n return "+json.data.text+"\n})"),j=f();"object"!==typeOf(j)&&(this.designer.notice(MWF.APPFD.LP.notValidJson,"error"),flag=!1)}catch(t){this.designer.notice(MWF.APPFD.LP.notValidJson+"："+t.message,"error"),flag=!1}}.bind(this),(function(){flag=!1}),!1),flag}.bind(this),onChange:function(t){var e,i=t[0].data;e="script"===i.type?{type:"script",name:i.name,alias:i.alias,id:i.id,appName:i.appName||i.applicationName,appId:i.appId,application:i.application}:i.id;var n=node.get("name"),s=this.data[n];this.data[n]=e,this.changeData(n,node,s)}.bind(this)});var next=node.getNext();if(next&&"MWFScriptSelectRefresh"===next.get("class")){var refreshNode=new Element("div",{styles:this.form.css.propertyRefreshFormNode}).inject(next);refreshNode.addEvent("click",function(t){_self.changeData(this.get("name"),this)}.bind(node))}}.bind(this)),dictionaryNodes.each(function(t){var e=this.data[t.get("name")];new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.form.designer,{type:"Dictionary",count:0,names:"array"===typeOf(e)?e:[e],onChange:function(e){var i=[],n=t.get("name");e.length>0&&e.each((function(t){var e=t.data;i.push({type:"dictionary",name:e.name,alias:e.alias,id:e.id,appName:e.appName||e.applicationName,appAlias:e.appAlias||e.applicationAlias,appId:e.appId,application:e.application,appType:e.appType})}));var s=this.data[n];this.data[n]=i,this.changeData(n,t,s)}.bind(this)})}.bind(this)),fileNodes.each(function(t){var e=this.data[t.get("name")],i=e||{};e&&"string"===typeOf(e)&&(i=this.form.page?{id:e,portal:this.form.application}:{id:e,application:this.form.application}),new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.form.designer,{type:"PortalFile",count:1,isImage:!0,values:i.id?[i.id]:[],onChange:function(e){this.saveFileItem(t,e)}.bind(this)})}.bind(this)),processFileNodes.each(function(t){var e=this.data[t.get("name")],i=e||{};e&&"string"===typeOf(e)&&(i=this.form.page?{id:e,portal:this.form.application}:{id:e,application:this.form.application}),new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.form.designer,{type:"ProcessFile",count:1,isImage:!0,values:i.id?[i.id]:[],onChange:function(e){this.saveFileItem(t,e)}.bind(this)})}.bind(this))}.bind(this))},loadDictionaryIncluder:function(){var t=this.propertyContent.getElements(".MWFDictionaryIncluder");t.length&&t.each(function(t){var e=t.get("name");MWF.xDesktop.requireApp("process.FormDesigner","widget.DictionaryIncluder",function(){var i=new MWF.xApplication.process.FormDesigner.widget.DictionaryIncluder(t,this.designer,{onChange:function(){var t=i.getData();this.data[e]=t}.bind(this)});i.load(this.data[e])}.bind(this))}.bind(this))},loadScriptIncluder:function(){var t=this.propertyContent.getElements(".MWFScriptIncluder");t.length&&t.each(function(t){var e=t.get("name");MWF.xDesktop.requireApp("process.FormDesigner","widget.ScriptIncluder",function(){var i=new MWF.xApplication.process.FormDesigner.widget.ScriptIncluder(t,this.designer,{onChange:function(){var t=i.getData();this.data[e]=t}.bind(this)});i.load(this.data[e])}.bind(this))}.bind(this))},saveFileItem:function(t,e){if(e[0]){var i=e[0].data;this.data[t.get("name")]=i}else this.data[t.get("name")]=null;this.changeData(t.get("name"))},saveViewItem:function(t,e){if(e[0]){var i=e[0].data,n={name:i.name,alias:i.alias,id:i.id,appName:i.appName||i.applicationName||i.query,appId:i.appId,application:i.application||i.query};this.data[t.get("name")]=n}else this.data[t.get("name")]=null;this.module._checkView&&this.module._checkView()},removeViewItem:function(t,e){},saveScriptSelectItem:function(t,e){if(1==(t.dataset.count||1).toInt()){if(e[0]){var i=e[0].data,n={appType:i.appType,type:"script",name:i.name,alias:i.alias,id:i.id,appName:i.appName||i.applicationName,appId:i.appId,application:i.application},s=t.get("name"),o=this.data[s];this.data[s]=n,this.changeData(s,t,o)}}else{var a=[];e.each(function(t){var e={appType:t.data.appType,type:"script",name:t.data.name,alias:t.data.alias,id:t.data.id,appName:t.data.appName||t.data.applicationName,appId:t.data.appId,application:t.data.application};a.push(e)}.bind(this));s=t.get("name"),o=this.data[s];this.data[s]=a,this.changeData(s,t,o)}},removeDutyItem:function(t,e){if(e.data.id){var i=JSON.decode(this.data[t.get("name")]||[]);i.filter((function(t){return t.id==e.data.id})).each((function(t){i=i.erase(t)})),this.data[t.get("name")]=JSON.encode(i)}e.node.destroy(),MWF.release(e),delete e},addDutyItem:function(t,e){var i=this.data[t.get("name")]||"";i||(i="[]");var n=JSON.decode(i);e.each(function(t){if(t.data.dutyId){for(var e=0;e<n.length;e++)if(n[e].dutyId===t.data.dutyId){n[e].name=t.data.name,n[e].code=t.data.code;break}}else t.data.dutyId=(new MWF.widget.UUID).toString(),n.push({name:t.data.name,id:t.data.id,dutyId:t.data.dutyId,code:t.data.code})}.bind(this)),this.data[t.get("name")]=JSON.encode(n)},loadFormFieldInput:function(){var t=this.propertyContent.getElements(".MWFFormFieldPerson");MWF.xDesktop.requireApp("process.ProcessDesigner","widget.PersonSelector",function(){t.each(function(t){new MWF.xApplication.process.ProcessDesigner.widget.PersonSelector(t,this.form.designer,{type:"formField",application:this.form.json.application,fieldType:"person",names:this.data[t.get("name")],onChange:function(e){this.savePersonItem(t,e)}.bind(this)})}.bind(this))}.bind(this))},savePersonItem:function(t,e){var i=[];e.each(function(t){i.push(MWF.org.parseOrgData(t.data))}.bind(this)),this.data[t.get("name")]=i},loadScriptArea:function(){var t=this.propertyContent.getElements(".MWFScriptArea"),e=this.propertyContent.getElements(".MWFFormulaArea");this.loadScriptEditor(t),this.loadScriptEditor(e,"formula")},loadScriptEditor:function(t,e){t.each(function(t){var i=t.get("title"),n=t.get("name");this.data[n]||(this.data[n]={code:"",html:""});var s=this.data[n],o=t.dataset.mode;MWF.require("MWF.widget.ScriptArea",function(){var a=new MWF.widget.ScriptArea(t,{title:i,mode:o||"javascript",maxObj:this.designer.formContentNode||this.designer.pageContentNode,onChange:function(){this.data[n]||(this.data[n]={code:"",html:""},this.module.form.scriptDesigner&&this.module.form.scriptDesigner.addScriptItem(this.data[n],"code",this.data,n));var t=a.toJson();this.data[n].code=t.code}.bind(this),onSave:function(){this.designer.saveForm()}.bind(this),style:e||"default",runtime:"web"});a.load(s)}.bind(this))}.bind(this))},loadCssArea:function(t){this.propertyContent.getElements(".MWFCssArea").each(function(e){var i=e.get("title"),n=e.get("name");this.data[n]||(this.data[n]={code:"",html:""});var s=this.data[n];o2.require("o2.widget.CssArea",function(){var o=new o2.widget.CssArea(e,{title:i,maxObj:this.designer.formContentNode||this.designer.pageContentNode,onChange:function(){this.data[n]||(this.data[n]={code:"",html:""},this.module.form.scriptDesigner&&this.module.form.scriptDesigner.addScriptItem(this.data[n],"code",this.data,n));var t=o.toJson();this.data[n].code=t.code,o.isChanged=!0}.bind(this),onBlur:function(){o.isChanged&&(this.changeData(n,e,""),o.isChanged=!1)}.bind(this),onSave:function(){this.designer.saveForm()}.bind(this),style:t||"default"});o.load(s)}.bind(this))}.bind(this))},loadActionStylesArea:function(){var t=this;this.propertyContent.getElements(".MWFActionStylesArea").each(function(e){var i=e.get("name"),n=this.data[i];MWF.require("MWF.widget.Maplist",function(){var s=[];Object.each(n,function(n,o){var a=new Element("div").inject(e);a.empty();var r=new MWF.widget.Maplist(a,{title:o,collapse:!0,onChange:function(){var n=t.data[i];s.each(function(e){t.data[i][e.key]=e.map.toJson()}.bind(this)),t.changeData(i,e,n)}});s.push({key:o,map:r}),r.load(n)}.bind(this))}.bind(this))}.bind(this))},loadActionArea:function(){this.propertyContent.getElements(".MWFMultiActionArea").each(function(t){var e=t.get("name"),i=this.data[e];MWF.xDesktop.requireApp("process.FormDesigner","widget.ActionsEditor",function(){var n=new MWF.xApplication.process.FormDesigner.widget.ActionsEditor(t,this.designer,this.data,{maxObj:this.propertyNode.parentElement.parentElement.parentElement,isSystemTool:!0,onChange:function(){this.data[e]=n.data,this.changeData(e)}.bind(this)});n.load(i)}.bind(this))}.bind(this)),this.propertyContent.getElements(".MWFActionArea").each(function(t){var e=t.get("name"),i=this.data[e];MWF.xDesktop.requireApp("process.FormDesigner","widget.ActionsEditor",function(){var n=new MWF.xApplication.process.FormDesigner.widget.ActionsEditor(t,this.designer,this.data,{maxObj:this.propertyNode.parentElement.parentElement.parentElement,onChange:function(){this.data[e]=n.data,this.changeData(e)}.bind(this)});n.load(i)}.bind(this))}.bind(this)),this.propertyContent.getElements(".MWFDefaultActionArea").each(function(t){var e=t.get("name"),i=this.data[e]||this.module.defaultToolBarsData;MWF.xDesktop.requireApp("process.FormDesigner","widget.ActionsEditor",function(){var n=new MWF.xApplication.process.FormDesigner.widget.ActionsEditor(t,this.designer,this.data,{maxObj:this.propertyNode.parentElement.parentElement.parentElement,isSystemTool:!0,noCreate:!0,noDelete:!1,noCode:!0,noReadShow:!0,target:t.get("data-target"),noEditShow:!0,onChange:function(){this.data[e]=n.data,this.changeData(e)}.bind(this)});n.load(i)}.bind(this))}.bind(this))},loadMaplist:function(){this.propertyContent.getElements(".MWFMaplist").each(function(t){var e=t.get("title"),i=t.get("name"),n=i.toLowerCase(),s=t.get("collapse"),o=this.data[i];o||(o={}),MWF.require("MWF.widget.Maplist",function(){t.empty();var a=new MWF.widget.Maplist(t,{title:e,collapse:!!s,onChange:function(){var t=this.data[i];this.changeJsonDate(i,a.toJson()),this.changeStyle(i,t),this.changeData(i)}.bind(this),onDelete:function(t){this.module.deletePropertiesOrStyles(i,t)}.bind(this),isProperty:n.contains("properties")||n.contains("property")||n.contains("attribute")});a.load(o),this.maplists[i]=a}.bind(this))}.bind(this))},loadPropertyTab:function(){var t=this.propertyContent.getElements(".MWFTab"),e={};for(var i in t.length&&t.each(function(t){var i=t.get("data-group")||"default";e[i]=e[i]||[],e[i].push(t)}.bind(this)),e)if("default"===i){var n=this.propertyContent.getFirst(),s=new Element("div",{styles:this.form.css.propertyTabNode}).inject(n,"before");MWF.require("MWF.widget.Tab",function(){var t=new MWF.widget.Tab(s,{style:"formPropertyList"});t.load();var i=[];e.default.each(function(e){if("none"!=e.getStyle("display")){var n=t.addTab(e,e.get("title"),!1);i.push(n),n.contentScrollNode=new Element("div",{styles:{height:"100%",overflow:"hidden"}}).inject(n.contentNodeArea),e.inject(n.contentScrollNode),this.setScrollBar(n.contentScrollNode,"small",null,null)}}.bind(this)),i[0].showTab(),this.propertyTab=t,this.designer.resizeNode()}.bind(this),!1)}else{n=e[i][0],s=new Element("div",{styles:this.form.css.propertyTabNode}).inject(n,"before");MWF.require("MWF.widget.Tab",function(){var t=new MWF.widget.Tab(s,{style:n.get("data-style")||"formPropertyList"});t.load();var o=[];e[i].each(function(e){var i=t.addTab(e,e.get("title"),!1);o.push(i),e.store("tab",i),"none"===e.getStyle("display")&&(i.disableTab(!0),e.show())}.bind(this));for(var a=0;a<o.length;a++)if(!o[a].disabled){o[a].showTab();break}}.bind(this),!1)}},setEditNodeEvent:function(){var t=this;this.propertyContent.getElements("input").each(function(e){var i=e.get("name");if(this.module){var n=this.data.pid;e.set("name",n+i)}if(i)switch(e.get("type").toLowerCase()){case"radio":e.addEvent("change",(function(e){t.setRadioValue(i,this)})),e.addEvent("blur",(function(e){t.setRadioValue(i,this)})),e.addEvent("keydown",(function(t){t.stopPropagation()})),t.setRadioValue(i,e);break;case"checkbox":e.addEvent("change",(function(e){t.setCheckboxValue(i,this)})),e.addEvent("click",(function(e){t.setCheckboxValue(i,this)})),e.addEvent("keydown",(function(t){t.stopPropagation()}));break;default:e.addEvent("change",(function(e){t.setValue(i,this.value,this)})),e.addEvent("blur",(function(e){t.setValue(i,this.value,this)})),e.addEvent("keydown",(function(e){13==e.code&&t.setValue(i,this.value,this),e.stopPropagation()}))}}.bind(this)),this.propertyContent.getElements("select").each((function(e){var i=e.get("name");i&&e.addEvent("change",(function(e){t.setSelectValue(i,this)}))})),this.propertyContent.getElements("textarea").each(function(e){var i=e.get("name");i&&(e.addEvent("change",(function(e){t.setValue(i,this.value)})),e.addEvent("blur",(function(e){t.setValue(i,this.value)})),e.addEvent("keydown",(function(t){t.stopPropagation()})))}.bind(this))},changeStyle:function(t,e){this.module.setPropertiesOrStyles(t,e)},changeData:function(t,e,i){this.module._setEditStyle(t,e,i)},changeJsonDate:function(t,e){"array"!==typeOf(t)&&(t=[t]);var i=this.data,n=t.length-1;t.each(function(t,e){i[t]||(i[t]={}),e<n&&(i=i[t])}.bind(this)),i[t[n]]=e},setRadioValue:function(t,e){if(e.checked){var i=t.indexOf("*"),n=-1==i?t.split("."):t.substr(i+1,t.length).split("."),s=e.value;"false"==s&&(s=!1),"true"==s&&(s=!0);for(var o=this.data,a=0;a<n.length;a++){if(!o[n[a]]){o=null;break}o=o[n[a]]}this.changeJsonDate(n,s),this.changeData(t,e,o)}},setCheckboxValue:function(t,e){var i=this.data.pid,n=$$("input[name='"+i+t+"']"),s=[];n.each((function(t){t.get("checked")&&s.push(t.value)}));var o=this.data[t];this.changeJsonDate(t,s),this.changeData(t,e,o)},setSelectValue:function(t,e){var i=e.selectedIndex,n=e.getElements("option"),s="";n[i]&&(s=n[i].get("value"));var o=this.data[t];this.changeJsonDate(t,s),this.changeData(t,e,o)},setValue:function(t,e,i){if("id"===t&&e!==this.module.json.id){if(!e)return this.designer.notice(MWF.APPFD.LP.notNullId,"error",this.module.form.designer.propertyContentArea,{x:"right",y:"bottom"}),i.focus(),!1;if(this.module.form.checkModuleId(e,this.module.json.type).elementConflict)return this.designer.notice(MWF.APPFD.LP.repetitionsId,"error",this.module.form.designer.propertyContentArea,{x:"right",y:"bottom"}),i.focus(),!1;var n=this.module.form.json.moduleList[this.module.json.id];this.module.form.json.moduleList[e]=n,delete this.module.form.json.moduleList[this.module.json.id]}for(var s=t.split("."),o=this.data,a=0;a<s.length;a++){if(!o[s[a]]){o=null;break}o=o[s[a]]}this.changeJsonDate(s,e),this.changeData(t,i,o)},setEditNodeStyles:function(t){var e=t.getChildren();e.length&&e.each(function(t){var e=t.get("class");e&&this.form.css[e]&&t.setStyles(this.form.css[e]),this.setEditNodeStyles(t)}.bind(this))},loadScriptInput:function(){this.propertyContent.getElements(".MWFScript").each(function(t){MWF.require("MWF.widget.ScriptEditor",function(){var e=new MWF.widget.ScriptEditor(t,{onPostSave:function(e){this.saveScriptItem(t,e)}.bind(this),onQueryDelete:function(e){this.deleteScriptItem(t,e)}.bind(this)});this.setScriptItems(e,t)}.bind(this))}.bind(this))},deleteScriptItem:function(t,e){var i=t.get("name");this.data[i].erase(e.data.id),this.process.scripts[e.data.id]=null,delete this.process.scripts[e.data.id],this.process.process.scriptList.erase(e.data)},saveScriptItem:function(t,e){var i=t.get("name"),n=this.data[i],s=e.data;this.process.scripts[e.data.id]||(this.process.process.scriptList.push(s),this.process.scripts[e.data.id]=s),-1==n.indexOf(s.id)&&this.data[i].push(s.id)},setScriptItems:function(t,e){var i=e.get("name");this.data[i].each(function(e){if(e){var i=this.process.scripts[e];i&&t.setScriptItem(i)}}.bind(this))},loadHelp:function(){var t=this.propertyContent.getElements(".MWFHelp");t.length&&t.each(function(t){var e=t.get("text");t.empty(),MWF.xDesktop.requireApp("Template","MTooltips",function(){new MTooltips(this.designer.node,t,this.designer,{},{nodeStyles:{"max-width":"370px",width:"370px","line-height":"24px","font-size":"14px"},onCustomContent:function(t,i){t.set("html",e)}})}.bind(this))}.bind(this))}}),MWF.xApplication.process.FormDesigner.PropertyMulti=new Class({Extends:MWF.xApplication.process.FormDesigner.Property,Implements:[Options,Events],initialize:function(t,e,i,n,s){this.setOptions(s),this.modules=e,this.form=t,this.data={},this.htmlPath=this.options.path,this.designer=n,this.maplists={},this.propertyNode=i},load:function(){this.fireEvent("queryLoad")&&MWF.getRequestText(this.htmlPath,function(t,e){this.htmlString=t,MWF.require("MWF.widget.JsonTemplate",function(){this.fireEvent("postLoad")}.bind(this))}.bind(this))},show:function(){this.propertyContent?this.propertyContent.setStyle("display","block"):this.htmlString&&(this.htmlString=o2.bindJson(this.htmlString,{lp:MWF.xApplication.process.FormDesigner.LP.propertyTemplate}),this.JsonTemplate=new MWF.widget.JsonTemplate({},this.htmlString),this.propertyContent=new Element("div",{styles:{overflow:"hidden"}}).inject(this.propertyNode),this.propertyContent.set("html",this.JsonTemplate.load()),this.setEditNodeEvent(),this.setEditNodeStyles(this.propertyContent),this.loadPropertyTab(),this.loadMaplist(),this.loadScriptArea(),this.loadTreeData(),this.loadArrayList())},hide:function(){this.propertyContent&&this.propertyContent.destroy()},changeStyle:function(t){this.modules.each(function(e){e.setPropertiesOrStyles(t)}.bind(this))},changeData:function(t,e,i){this.modules.each(function(n){n._setEditStyle(t,e,i)}.bind(this))},changeJsonDate:function(t,e){this.modules.each(function(i){i.json[t]=e}.bind(this))}});