MWF.xAction.RestActions.Action.x_cms_assemble_control=new Class({Extends:MWF.xAction.RestActions.Action,getUUID:function(a){var t="";return this.action.invoke({name:"getId",async:!1,parameter:{count:"1"},success:function(e){t=e.data[0],a&&a(t)},failure:null}),t},saveColumn:function(a,t,e){a.isNewColumn?this.addColumn(a,t,e):this.updateColumn(a,t,e)},addColumn:function(a,t,e){this.action.invoke({name:"addColumn",data:a,success:t,failure:e})},updateColumn:function(a,t,e){this.action.invoke({name:"updateColumn",data:a,parameter:{id:a.id},success:t,failure:e})},updataColumnIcon:function(a,t,e,i,n){this.action.invoke({name:"updataColumnIcon",parameter:{id:a},data:i,file:n,success:t,failure:e})},listCategory:function(a,t,e,i){var n=this;this.action.invoke({name:"listCategory",parameter:{appId:a},async:i,success:function(a){n.transCategoryData(a),t.call(this,a)},failure:e})},listCategoryByPublisher:function(a,t,e,i){var n=this;this.action.invoke({name:"listCategoryByPublisher",parameter:{appId:a},async:i,success:function(a){n.transCategoryData(a),t.call(this,a)},failure:e})},getCategory:function(a,t,e,i){var n=this;this.action.invoke({name:"getCategory",parameter:{id:a},success:function(a){n.transCategoryData(a),t.call(this,a)},failure:e,async:i})},saveCategory:function(a,t,e){a.isNew?this.addCategory(a,t,e):this.updateCategory(a,t,e)},addCategory:function(a,t,e){this.action.invoke({name:"addCategory",data:a,success:t,failure:e})},updateCategory:function(a,t,e){this.action.invoke({name:"updateCategory",data:a,parameter:{id:a.id},success:t,failure:e})},transCategoryData:function(a){var t=function(a){a.name||(a.name=a.categoryName),a.alias||(a.alias=a.categoryAlias),a.categoryName||(a.categoryName=a.name),a.categoryAlias||(a.categoryAlias=a.alias)};a.data?"array"==typeOf(a.data)?a.data.each((function(a){t(a)})):t(a.data):a.data=[]},saveFile:function(a,t,e,i){a.id?this.updataFile(a.id,a,t,e,i):this.getUUID(function(n){a.id=n,this.addFile(a,t,e,i)}.bind(this),!1)},saveForm:function(a,t,e,i,n){a.isNewForm?this.addForm(a,t,e,i,n):this.updateForm(a,t,e,i,n)},updateForm:function(a,t,e,i,n){var o,s;a&&(o=MWF.encodeJsonString(JSON.encode(a))),t&&(s=MWF.encodeJsonString(JSON.encode(t)));var c=null;a&&a.json.includeScripts&&a.json.includeScripts.length&&(c={},a.json.includeScripts.each((function(a){c[a.id]="process"===a.appType?"processPlatform":a.appType})));var d=null;t&&t.json.includeScripts&&t.json.includeScripts.length&&(d={},t.json.includeScripts.each((function(a){d[a.id]="process"===a.appType?"processPlatform":a.appType})));var r={id:a.json.id,name:a.json.name,alias:a.json.name,description:a.json.description,appId:a.json.application,formFieldList:e,relatedScriptMap:c,relatedFormList:a&&a.json.subformList?a.json.subformList:[],mobileRelatedScriptMap:d,mobileRelatedFormList:t&&t.json.subformList?t.json.subformList:[]};a&&(r.data=o),t&&(r.mobileData=s),this.action.invoke({name:"updataForm",data:r,parameter:{id:a.json.id},success:i,failure:n})},addForm:function(a,t,e,i,n){var o,s;if(a.json.id){a&&(o=MWF.encodeJsonString(JSON.encode(a))),t&&!t.json.id&&(t.json.id=a.json.id),t&&(s=MWF.encodeJsonString(JSON.encode(t)));var c={id:a.json.id,name:a.json.name,alias:a.json.name,description:a.json.description,appId:a.json.application,formFieldList:e};a&&(c.data=o),t&&(c.mobileData=s),this.action.invoke({name:"addForm",data:c,parameter:{id:a.json.categoryId},success:i,failure:n})}else this.getUUID(function(c){a.json.id=c,a&&(o=MWF.encodeJsonString(JSON.encode(a))),t&&!t.json.id&&(t.json.id=c),t&&(s=MWF.encodeJsonString(JSON.encode(t)));var d=null;a&&a.json.includeScripts&&a.json.includeScripts.length&&(d={},a.json.includeScripts.each((function(a){d[a.id]="process"===a.appType?"processPlatform":a.appType})));var r=null;t&&t.json.includeScripts&&t.json.includeScripts.length&&(r={},t.json.includeScripts.each((function(a){r[a.id]="process"===a.appType?"processPlatform":a.appType})));var u={id:a.json.id,name:a.json.name,alias:a.json.name,description:a.json.description,appId:a.json.application,formFieldList:e,relatedScriptMap:d,relatedFormList:a&&a.json.subformList?a.json.subformList:[],mobileRelatedScriptMap:r,mobileRelatedFormList:t&&t.json.subformList?t.json.subformList:[]};a&&(u.data=o),t&&(u.mobileData=s),this.action.invoke({name:"addForm",data:u,parameter:{id:a.json.id},success:i,failure:n})}.bind(this))},addFormTemplate:function(a,t,e,i,n){var o,s;this.getUUID(function(c){if(e.id=c,a){var d=Object.clone(a);d.json.id=c,d.json.name=e.name,o=MWF.encodeJsonString(JSON.encode(d))}if(t){var r=Object.clone(t);r.json.id=c,r.json.name=e.name,s=MWF.encodeJsonString(JSON.encode(r))}a&&(e.data=o),t&&(e.mobileData=s),this.action.invoke({name:"addFormTemplate",data:e,success:i,failure:n})}.bind(this))},saveDictionary:function(a,t,e){a.id||a.appDictId?this.updateDictionary(a,t,e):this.addDictionary(a,t,e)},updateDictionary:function(a,t,e){a.alias&&""!=a.alias||(a.alias=a.name),this.action.invoke({name:"updataDictionary",data:a,parameter:{appDictId:a.id},success:t,failure:e})},addDictionary:function(a,t,e){a.id||this.getUUID(function(i){a.id=i,a.appDictId=i,a.alias&&""!=a.alias||(a.alias=a.name),this.action.invoke({name:"addDictionary",data:a,parameter:{appDictId:a.id},success:t,failure:e})}.bind(this))},getScript:function(a,t,e,i){var n=this;this.action.invoke({name:"getScript",async:i,parameter:{id:a},success:function(a){n.transScriptData(a),t.call(this,a)},failure:e})},getScriptByName:function(a,t,e,i,n){var o=this;this.action.invoke({name:"getScriptByName",async:n,parameter:{name:a,appId:t},success:function(a){o.transScriptData(a),e.call(this,a)},failure:i})},saveScript:function(a,t,e){a.isNewScript?this.addScript(a,t,e):this.updateScript(a,t,e)},updateScript:function(a,t,e){this.transScriptData(a,"send"),this.action.invoke({name:"updataScript",data:a,parameter:{id:a.id},success:t,failure:e})},addScript:function(a,t,e){this.transScriptData(a,"send");a.id?this.action.invoke({name:"addScript",data:a,success:t,failure:e}):this.getUUID(function(i){a.id=i,this.action.invoke({name:"addScript",data:a,success:t,failure:e})}.bind(this))},transScriptData:function(a,t){var e=function(a){t&&"send"==t?(a.appId||(a.appId=a.application),a.appName||(a.appName=a.applicationName),a.application&&delete a.application,a.applicationName&&delete a.applicationName):(a.appId||(a.appId=a.application),a.appName||(a.appName=a.applicationName),a.application||(a.application=a.appId),a.applicationName||(a.application=a.appName))};"array"==typeOf(a)?a.each((function(a){e(a)})):e(a)},saveView:function(a,t,e){a.isNew?this.addView(a,t,e):this.updateView(a,t,e)},addView:function(a,t,e){this.action.invoke({name:"addView",data:a,success:t,failure:e})},updateView:function(a,t,e){this.action.invoke({name:"updateView",data:a,parameter:{id:a.id},success:t,failure:e})},saveViewColumn:function(a,t,e,i){a.isNew?this.addViewColumn(a,t,e,i):this.updateViewColumn(a,t,e,i)},saveCategoryView:function(a,t,e,i){a.isNew?this.addViewColumn(a,t,e,i):this.updateViewColumn(a,t,e,i)},saveQueryView:function(a,t,e,i){a.isNewView?(a.isNewView=!1,this.addQueryView(a,t,e,i)):this.updateQueryView(a,t,e,i)},addQueryView:function(a,t,e,i){var n=a.data,o=JSON.encode(a.data);a.data=o,n.id?(this.action.invoke({name:"addQueryView",data:a,success:t,failure:e,async:i}),a.data=n):this.getUUID(function(o){a.id=o,this.action.invoke({name:"addQueryView",data:a,success:t,failure:e,async:i}),a.data=n}.bind(this))},updateQueryView:function(a,t,e,i){var n=a.data,o=JSON.encode(a.data);a.data=o,this.action.invoke({name:"updateQueryView",data:a,async:i,parameter:{id:a.id},success:t,failure:e}),a.data=n},saveDocument:function(a,t,e,i){a.isNewDocument?this.addDocument(a,t,e,i):this.updateDocument(a,t,e,i)},addDocument:function(a,t,e,i){delete a.attachmentList,this.action.invoke({name:"addDocument",data:a,success:t,failure:e,async:i})},updateDocument:function(a,t,e,i){delete a.attachmentList,this.action.invoke({name:"updateDocument",data:a,parameter:{id:a.id},success:t,failure:e,async:i})},saveData:function(a,t,e,i,n){i.isNew?this.addData(a,t,e,i,n):this.updateData(a,t,e,i,n)},uploadAttachment:function(a,t,e,i,n){this.action.invoke({name:"uploadAttachment",parameter:{id:a},data:i,file:n,success:t,failure:e})},replaceAttachment:function(a,t,e,i,n,o){this.action.invoke({name:"replaceAttachment",parameter:{documentid:t,id:a},data:n,file:o,success:e,failure:i})},getAttachmentData:function(a,t){this.action.getActions(function(){var e=this.action.actions.getAttachmentData.uri;e=(e=e.replace("{id}",encodeURIComponent(a))).replace("{documentid}",encodeURIComponent(t)),window.open(o2.filterUrl(this.action.address+e))}.bind(this))},getAttachmentStream:function(a,t){this.action.getActions(function(){var e=this.action.actions.getAttachmentStream.uri;e=(e=e.replace("{id}",encodeURIComponent(a))).replace("{documentid}",encodeURIComponent(t)),window.open(o2.filterUrl(this.action.address+e))}.bind(this))},getAttachmentUrl:function(a,t,e){this.action.getActions(function(){var i=this.action.actions.getAttachmentData.uri;i=(i=i.replace("{id}",encodeURIComponent(a))).replace("{documentid}",encodeURIComponent(t)),e&&e(o2.filterUrl(this.action.address+i))}.bind(this))},convertLocalImageToBase64:function(a,t,e,i,n){this.action.invoke({name:"convertLocalImageToBase64",parameter:{size:a},data:i,file:n,success:t,failure:e})},getImageUrl:function(a,t,e){this.action.getActions(function(){var i=this.action.actions.getImage.uri;i=(i=i.replace("{id}",encodeURIComponent(a))).replace("{documentid}",encodeURIComponent(t)),e&&e(o2.filterUrl(this.action.address+i))}.bind(this))},listDocumentFilterNext:function(a,t,e,i,n,o){e&&!e.documentType&&(e.documentType="全部"),this.action.invoke({name:"listDocumentFilterNext",async:o,data:e,parameter:{id:a,count:t},success:i,failure:n})},listDocumentFilterPrev:function(a,t,e,i,n,o){e&&!e.documentType&&(e.documentType="全部"),this.action.invoke({name:"listDocumentFilterPrev",async:o,data:e,parameter:{id:a,count:t},success:i,failure:n})},listDraftNext:function(a,t,e,i,n,o){e&&!e.documentType&&(e.documentType="全部"),this.action.invoke({name:"listDraftNext",async:o,data:e,parameter:{id:a,count:t},success:i,failure:n})},listDraftPrev:function(a,t,e,i,n,o){e&&!e.documentType&&(e.documentType="全部"),this.action.invoke({name:"listDraftPrev",async:o,data:e,parameter:{id:a,count:t},success:i,failure:n})},importDocumentFormExcel:function(a,t,e,i,n){this.action.invoke({name:"importDocumentFormExcel",parameter:{categoryId:a},data:i,file:n,success:t,failure:e})},getCategoryByAlias:function(a,t,e){var i=this;this.action.invoke({name:"getCategoryByAlias",parameter:{alias:a},success:function(a){i.transCategoryData(a),t.call(this,a)},failure:e})},batchModifyData:function(a,t,e,i){this.action.invoke({name:"batchModifyData",data:{docIds:a,dataChanges:t},success:e,failure:i})}});