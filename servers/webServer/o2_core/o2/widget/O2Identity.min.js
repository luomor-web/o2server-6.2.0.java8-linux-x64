o2.widget=o2.widget||{},o2.require("o2.widget.Common",null,!1),o2.require("o2.xDesktop.Common",null,!1),o2.require("o2.xDesktop.Actions.RestActions",null,!1),o2.widget.O2Identity=new Class({Implements:[Options,Events],Extends:o2.widget.Common,options:{style:"default",canRemove:!1,lazy:!1,disableInfor:!1},initialize:function(t,e,i){this.setOptions(i),this.loadedInfor=!1,this.path=o2.session.path+"/widget/$O2Identity/",this.cssPath=o2.session.path+"/widget/$O2Identity/"+this.options.style+"/css.wcss",this._loadCss(),this.container=$(e),this.data=t,this.style=this.css,this.action=new o2.xDesktop.Actions.RestActions("","x_organization_assemble_control","x_component_Org"),this.load()},setText:function(){var t;if(this.data.displayName)t=this.data.displayName;else{var e,i=this.data.name||o2.name.cn(this.data.distinguishedName);if(this.data.unitName)e=this.data.unitName;else if(this.data.unitLevelName){var a=this.data.unitLevelName.split("/");e=a[a.length-1]}t=i+(e?"("+e+")":"")}this.node.set("text",this.data.displayName||t)},load:function(){var t=layout.mobile&&this.style.identityNode_mobile?this.style.identityNode_mobile:this.style.identityNode;this.options.lazy||this.options.disableInfor||this.getPersonData(),this.node=new Element("div",{styles:t}).inject(this.container),this.setText(),this.options.canRemove&&(this.removeNode=new Element("div",{styles:this.style.identityRemoveNode}).inject(this.node),this.removeNode.addEvent("click",function(t){this.fireEvent("remove",[this,t]),t.stopPropagation()}.bind(this))),this.options.disableInfor||layout.mobile||(this.options.lazy?this.node.addEvents({mouseover:function(){this.loadedInfor||(this.getPersonData(),this.createInforNode(function(){this.fireEvent("loadedInfor",[this])}.bind(this)))}.bind(this)}):this.createInforNode(function(){this.fireEvent("loadedInfor",[this])}.bind(this))),this.setEvent(),layout.mobile||this.node.addEvents({mouseover:function(){this.node.setStyles(this.style.identityNode_over)}.bind(this),mouseout:function(){this.node.setStyles(this.style.identityNode)}.bind(this)})},setEvent:function(){this.open&&this.node.addEvents({click:function(t){this.open(t),t.stopPropagation()}.bind(this)})},getPersonData:function(){if(!this.data.dutys){var t=o2.Actions.get("x_organization_assemble_control"),e=this.data.distinguishedName||this.data.id||this.data.unique;e&&t.listUnitdutyByIdentity(e,function(t){this.data.dutys=t.data}.bind(this),null,!1)}return this.data.woPerson?this.data.woPerson:(this.action.actions={getPerson:{uri:"/jaxrs/person/{flag}"},getIdentity:{uri:"/jaxrs/identity/{id}"}},this.data.person?this.action.invoke({name:"getPerson",async:!1,parameter:{flag:this.data.person},success:function(t){this.data.woPerson=i,i=t.data}.bind(this)}):this.action.invoke({name:"getIdentity",async:!1,parameter:{id:this.data.id||this.data.name},success:function(t){this.data=t.data,i=t.data.woPerson}.bind(this)}),i);var i},createInforNode:function(t){var e=this.getPersonData();if(e){this.inforNode=new Element("div",{styles:this.style.identityInforNode});var i=new Element("div",{styles:this.style.identityInforNameNode}).inject(this.inforNode),a="/jaxrs/person/{flag}/icon";a=a.replace("{flag}",e.id||e.unique||e.distinguishedName),this.action.getAddress(),a=this.action.address+a,a=o2.filterUrl(a),img="<img width='50' height='50' border='0' src='"+a+"' style='border-radius:25px'/>";new Element("div",{styles:this.style.identityInforPicNode,html:img}).inject(i);var s=new Element("div",{styles:this.style.identityInforRightTextNode}).inject(i),n=(new Element("div",{styles:this.style.identityInforNameTextNode,text:e.name}).inject(s),new Element("div",{styles:this.style.identityInforEmployeeTextNode,text:e.employee||""}).inject(s),[]);this.data.dutys&&this.data.dutys.length&&this.data.dutys.each((function(t){var e=t.name+"("+t.woUnit.levelName+")";n.push(e)}));new Element("div",{styles:this.style.identityInforPhoneNode,html:"<div style='width:30px; float:left'>"+o2.LP.desktop.person.duty+": </div><div style='width:160px; float:left; margin-left:10px'>"+n.join(",")+"</div>"}).inject(this.inforNode);this.loadedInfor=!0,this.tooltip=new mBox.Tooltip({content:this.inforNode,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,transition:"flyin"})}t&&t()},destroy:function(){this.tooltip&&this.tooltip.destroy(),this.node.destroy(),o2.release(this)}}),o2.widget.O2Person=new Class({Extends:o2.widget.O2Identity,getPersonData:function(){return this.data.distinguishedName||(this.action.actions={getPerson:{uri:"/jaxrs/person/{id}"}},this.action.invoke({name:"getPerson",async:!1,parameter:{id:this.data.id||this.data.name},success:function(t){this.data=t.data;var e=[];this.data.woIdentityList&&this.data.woIdentityList.length&&this.data.woIdentityList.each((function(t){t.woUnitDutyList&&t.woUnitDutyList.length&&(e=e.concat(t.woUnitDutyList))})),this.data.dutys=e}.bind(this)})),this.data},setText:function(){this.node.set("text",this.data.displayName||this.data.name)}}),o2.widget.O2Unit=new Class({Extends:o2.widget.O2Identity,getPersonData:function(){this.data.distinguishedName&&this.data.levelName||(this.action.actions={getUnit:{uri:"/jaxrs/unit/{id}"}},this.action.invoke({name:"getUnit",async:!1,parameter:{id:this.data.id||this.data.name},success:function(t){this.data=t.data}.bind(this)}))},createInforNode:function(){this.inforNode=new Element("div",{styles:this.style.identityInforNode});new Element("div",{styles:this.style.identityInforNameNode,text:this.data.levelName}).inject(this.inforNode);this.tooltip=new mBox.Tooltip({content:this.inforNode,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,transition:"flyin"})},setText:function(){this.node.set("text",this.data.displayName||this.data.name)}}),o2.widget.O2Duty=new Class({Extends:o2.widget.O2Identity,getPersonData:function(){return this.data},createInforNode:function(){return!1},setText:function(){this.node.set("text",this.data.displayName||this.data.name)}}),o2.widget.O2Group=new Class({Extends:o2.widget.O2Unit,getPersonData:function(){this.data.distinguishedName||(this.action.actions={getGroup:{uri:"/jaxrs/group/{id}"}},this.action.invoke({name:"getGroup",async:!1,parameter:{id:this.data.id||this.data.name},success:function(t){this.data=t.data}.bind(this)}))},setText:function(){this.node.set("text",this.data.displayName||this.data.name)},createInforNode:function(){return!1}}),o2.widget.O2Application=new Class({Extends:o2.widget.O2Group,getPersonData:function(){this.data.name||(this.action=new o2.xDesktop.Actions.RestActions("","x_processplatform_assemble_surface",""),this.action.actions={getApplication:{uri:"/jaxrs/application/{id}"}},this.action.invoke({name:"getApplication",async:!1,parameter:{id:this.data.id||this.data.name},success:function(t){this.data=t.data}.bind(this)}))}}),o2.widget.O2CMSApplication=new Class({Extends:o2.widget.O2Group,getPersonData:function(){this.data.name||o2.Actions.get("x_cms_assemble_control").getApplication(this.data.id||this.data.name,function(t){this.data=t.data}.bind(this),null,!1)}}),o2.widget.O2Process=new Class({Extends:o2.widget.O2Group,getPersonData:function(){this.data.name||(this.action=new o2.xDesktop.Actions.RestActions("","x_processplatform_assemble_surface",""),this.action.actions={getProces:{uri:"/jaxrs/process/{id}/complex"}},this.action.invoke({name:"getProces",async:!1,parameter:{id:this.data.id||this.data.name},success:function(t){this.data=t.data}.bind(this)}))},createInforNode:function(){this.inforNode=new Element("div",{styles:this.style.identityInforNode});new Element("div",{styles:this.style.identityInforNameNode,text:this.data.name||this.data.applicationName||this.data.appName}).inject(this.inforNode);this.tooltip=new mBox.Tooltip({content:this.inforNode,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,transition:"flyin"})},open:function(t){if(this.data.id&&this.data.application){var e="process.ProcessManager"+this.data.application;if(layout.desktop.apps[e])layout.desktop.apps[e].setCurrent();else{var i={application:{id:this.data.application,name:this.data.applicationName||""}};layout.desktop.openApplication(t,"process.ProcessManager",i)}}}}),o2.widget.O2CMSCategory=new Class({Extends:o2.widget.O2Group,getPersonData:function(){this.data.name||o2.Actions.get("x_cms_assemble_control").getCategory(this.data.id||this.data.name,function(t){this.data=t.data}.bind(this),null,!1)},createInforNode:function(){this.inforNode=new Element("div",{styles:this.style.identityInforNode});new Element("div",{styles:this.style.identityInforNameNode,text:this.data.applicationName||this.data.appName}).inject(this.inforNode);this.tooltip=new mBox.Tooltip({content:this.inforNode,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,transition:"flyin"})},open:function(t){if(this.data.id&&this.data.appId){var e={navi:"categoryConfig",column:{id:this.data.appId,appName:this.data.appName||""},currentCategoryId:this.data.id};layout.desktop.openApplication(t,"cms.ColumnManager",e)}}}),o2.widget.O2View=new Class({Extends:o2.widget.O2Group,getPersonData:function(){if(!this.data.query&&this.data.id){var t=null;return o2.Actions.get("x_query_assemble_surface").getStatById(this.data.id,(function(e){t=e.data}),null,!1),this.data=t,t}return this.data},createInforNode:function(){this.inforNode=new Element("div",{styles:this.style.identityInforNode});new Element("div",{styles:this.style.identityInforNameNode,text:this.data.applicationName||this.data.appName||this.data.name}).inject(this.inforNode);this.tooltip=new mBox.Tooltip({content:this.inforNode,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,transition:"flyin"})}}),o2.widget.O2CMSView=new Class({Extends:o2.widget.O2View}),o2.widget.O2QueryView=new Class({Extends:o2.widget.O2View,getPersonData:function(){if(!this.data.query&&this.data.id){var t=null;return o2.Actions.get("x_query_assemble_surface").getViewById(this.data.id,(function(e){t=e.data}),null,!1),this.data=t,t}return this.data},open:function(t){if(this.data.id&&this.data.query){var e="query.ViewDesigner"+this.data.id;if(layout.desktop.apps[e])layout.desktop.apps[e].setCurrent();else{var i={id:this.data.id,application:this.data.query,appId:e};layout.desktop.openApplication(t,"query.ViewDesigner",i)}}}}),o2.widget.O2QueryStatement=new Class({Extends:o2.widget.O2View,getPersonData:function(){if(!this.data.query&&this.data.id){var t=null;return o2.Actions.load("x_query_assemble_designer").StatementAction.get(this.data.id,(function(e){t=e.data}),null,!1),this.data=t,t}return this.data},open:function(t){if(this.data.id&&this.data.query){var e="query.StatementDesigner"+this.data.id;if(layout.desktop.apps[e])layout.desktop.apps[e].setCurrent();else{var i={id:this.data.id,application:this.data.query,appId:e};layout.desktop.openApplication(t,"query.StatementDesigner",i)}}}}),o2.widget.O2QueryStat=new Class({Extends:o2.widget.O2View,getPersonData:function(){if(!this.data.query&&this.data.id){var t=null;return o2.Actions.get("x_query_assemble_surface").getStatById(this.data.id,(function(e){t=e.data}),null,!1),this.data=t,t}return this.data},open:function(t){if(this.data.id&&this.data.query){var e="query.StatDesigner"+this.data.id;if(layout.desktop.apps[e])layout.desktop.apps[e].setCurrent();else{var i={id:this.data.id,application:this.data.query,appId:e};layout.desktop.openApplication(t,"query.StatDesigner",i)}}}}),o2.widget.O2QueryTable=new Class({Extends:o2.widget.O2View,getPersonData:function(){if(!this.data.query&&this.data.id){var t=null;return o2.Actions.get("x_query_assemble_surface").getTableById(this.data.id,(function(e){t=e.data}),null,!1),this.data=t,t}return this.data},open:function(t){if(this.data.id&&this.data.query){var e="query.TableDesigner"+this.data.id;if(layout.desktop.apps[e])layout.desktop.apps[e].setCurrent();else{var i={id:this.data.id,application:this.data.query,appId:e};layout.desktop.openApplication(t,"query.TableDesigner",i)}}}}),o2.widget.O2QueryImportModel=new Class({Extends:o2.widget.O2View,getPersonData:function(){if(!this.data.query&&this.data.id){var t=null;return o2.Actions.get("x_query_assemble_surface").getImportModelById(this.data.id,(function(e){t=e.data}),null,!1),this.data=t,t}return this.data},open:function(t){if(this.data.id&&this.data.query){var e="query.ImporterDesigner"+this.data.id;if(layout.desktop.apps[e])layout.desktop.apps[e].setCurrent();else{var i={id:this.data.id,application:this.data.query,appId:e};layout.desktop.openApplication(t,"query.ImporterDesigner",i)}}}}),o2.widget.O2FormField=new Class({Extends:o2.widget.O2Group,getPersonData:function(){return this.data}}),o2.widget.O2Role=new Class({Extends:o2.widget.O2Group,getPersonData:function(){this.data.distinguishedName||(this.action.actions={getRole:{uri:"/jaxrs/role/{id}"}},this.action.invoke({name:"getRole",async:!1,parameter:{id:this.data.id||this.data.name},success:function(t){this.data=t.data}.bind(this)}))}}),o2.widget.O2File=new Class({Extends:o2.widget.O2Group,createInforNode:function(){this.inforNode=new Element("div",{styles:this.style.identityInforNode});var t=this.data.fileName.substring(this.data.fileName.lastIndexOf(".")+1,this.data.fileName.length).toLowerCase();if(-1!==["png","jpg","bmp","gif","jpeg","jpe"].indexOf(t)){var e=this.data.portal?MWF.xDesktop.getPortalFileUr(this.data.id,this.data.portal):MWF.xDesktop.getProcessFileUr(this.data.id,this.data.application);new Element("img",{src:e,styles:{"max-width":"280px","max-height":"140px"}}).inject(this.inforNode)}else new Element("div",{styles:this.style.identityInforNameNode,text:this.data.applicationName||this.data.appName||this.data.name}).inject(this.inforNode);this.tooltip=new mBox.Tooltip({content:this.inforNode,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,transition:"flyin"})},getPersonData:function(){return this.data}}),o2.widget.O2Script=new Class({Extends:o2.widget.O2Group,getPersonData:function(){return this.data},createInforNode:function(){if(!this.data.appType)return!1;this.inforNode=new Element("div",{styles:this.style.identityInforNode});new Element("div",{text:o2.LP[this.data.appType+"Name"]}).inject(this.inforNode),new Element("div",{text:this.data.applicationName||this.data.appName}).inject(this.inforNode);this.tooltip=new mBox.Tooltip({content:this.inforNode,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,transition:"flyin"})},open:function(t){if(this.data.id&&this.data.appId&&this.data.appType){var e;"cms"===this.data.appType?e="cms.ScriptDesigner":"portal"===this.data.appType?e="portal.ScriptDesigner":"process"===this.data.appType&&(e="process.ScriptDesigner");var i=e+this.data.id;if(layout.desktop.apps[i])layout.desktop.apps[i].setCurrent();else{var a={id:this.data.id,appId:i,application:this.data.appId};layout.desktop.openApplication(t,e,a)}}}}),o2.widget.O2FormStyle=new Class({Extends:o2.widget.O2Group,getPersonData:function(){return this.data},open:function(t){if("object"===typeOf(this.data)&&this.data.id&&this.data.appId&&"script"===this.data.type){var e,i=(e="cms"===this.data.appType?"cms.ScriptDesigner":"process.ScriptDesigner")+this.data.id;if(layout.desktop.apps[i])layout.desktop.apps[i].setCurrent();else{var a={id:this.data.id,appId:i,application:this.data.appId};layout.desktop.openApplication(t,e,a)}}}}),o2.widget.O2Dictionary=new Class({Extends:o2.widget.O2Group,getPersonData:function(){return this.data},createInforNode:function(){if(!this.data.appType)return!1;this.inforNode=new Element("div",{styles:this.style.identityInforNode});new Element("div",{text:o2.LP[this.data.appType+"Name"]}).inject(this.inforNode),new Element("div",{text:this.data.applicationName||this.data.appName}).inject(this.inforNode);this.tooltip=new mBox.Tooltip({content:this.inforNode,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,transition:"flyin"})},open:function(t){if(this.data.id&&this.data.appId&&this.data.appType){var e;"cms"===this.data.appType?e="cms.DictionaryDesigner":"process"===this.data.appType&&(e="process.DictionaryDesigner");var i=e+this.data.id;if(layout.desktop.apps[i])layout.desktop.apps[i].setCurrent();else{var a={id:this.data.id,appId:i,application:this.data.appId};layout.desktop.openApplication(t,e,a)}}}}),o2.widget.O2Other=new Class({Extends:o2.widget.O2Group,getPersonData:function(){return this.data}}),o2.widget.O2Org=function(t,e,i){var a="string"===o2.typeOf(t)?{name:t}:t.distinguishedName,s=a.distinguishedName||a.name||"";if(s)switch(s.substr(s.length-1,1).toLowerCase()){case"i":return new o2.widget.O2Identity(a,e,i);case"p":return new o2.widget.O2Person(a,e,i);case"u":return new o2.widget.O2Unit(a,e,i);case"g":return new o2.widget.O2Group(a,e,i);case"r":return new o2.widget.O2Role(a,e,i);case"d":return new o2.widget.O2Duty(a,e,i);default:return new o2.widget.O2Other(a,e,i)}return null};