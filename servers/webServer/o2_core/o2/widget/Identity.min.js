o2.widget=o2.widget||{},o2.require("o2.widget.Common",null,!1),o2.widget.Identity=new Class({Implements:[Options,Events],Extends:o2.widget.Common,options:{style:"default"},initialize:function(t,e,i,n,s,o){this.setOptions(o),this.path=o2.session.path+"/widget/$Identity/",this.cssPath=o2.session.path+"/widget/$Identity/"+this.options.style+"/css.wcss",this._loadCss(),this.container=$(e),this.data=t,this.style=this.css,this.explorer=i,this.canRemove=n||!1,this.removeAction=s,this.load()},load:function(){this.node=new Element("div",{styles:this.style.identityNode,text:this.data.name}).inject(this.container),this.canRemove&&(this.removeNode=new Element("div",{styles:this.style.identityRemoveNode}).inject(this.node),this.removeAction&&this.removeNode.addEvent("click",this.removeAction.bind(this))),this.createInforNode(function(){this.fireEvent("loadedInfor")}.bind(this)),this.node.addEvents({mouseover:function(){this.node.setStyles(this.style.identityNode_over)}.bind(this),mouseout:function(){this.node.setStyles(this.style.identityNode)}.bind(this)}),this.setEvent()},setEvent:function(){},getPerson:function(t){var e="getPersonByIdentity",i=this.data.name;this.explorer.actions.getPersonByIdentity||(e="getPerson",i=this.data.person),this.explorer.actions[e]((function(e){t&&t(e)}),null,i)},createInforNode:function(t){this.getPerson(function(e){if(e.data){this.inforNode=new Element("div",{styles:this.style.identityInforNode});var i=new Element("div",{styles:this.style.identityInforNameNode}).inject(this.inforNode);e.data.icon?img="<img width='50' height='50' border='0' src='data:image/png;base64,"+e.data.icon+"'></img>":"f"==e.genderType?img="<img width='50' height='50' border='0' src='../x_component_Organization/$PersonExplorer/default/icon/female.png'></img>":img="<img width='50' height='50' border='0' src='../x_component_Organization/$PersonExplorer/default/icon/man.png'></img>";new Element("div",{styles:this.style.identityInforPicNode,html:img}).inject(i),new Element("div",{styles:this.style.identityInforNameTextNode,text:e.data.display}).inject(i),new Element("div",{styles:this.style.identityInforPhoneNode,html:"<div style='width:30px; float:left'>"+this.explorer.app.lp.phone+": </div><div style='width:90px; float:left; margin-left:10px'>"+(e.data.mobile||"")+"</div>"}).inject(this.inforNode),new Element("div",{styles:this.style.identityInforPhoneNode,html:"<div style='width:30px; float:left'>"+this.explorer.app.lp.mail+": </div><div style='width:90px; float:left; margin-left:10px'>"+(e.data.mail||"")+"</div>"}).inject(this.inforNode);new mBox.Tooltip({content:this.inforNode,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,transition:"flyin"})}t&&t()}.bind(this))}}),o2.widget.Person=new Class({Implements:[Options,Events],Extends:o2.widget.Identity,getPerson:function(t){if(this.data.name&&this.data.id)t&&t({data:this.data});else{var e=this.data.name;this.explorer.actions.getPerson((function(e){t&&t(e)}),null,e)}}}),o2.widget.Department=new Class({Implements:[Options,Events],Extends:o2.widget.Identity,createInforNode:function(){return!0}}),o2.widget.Company=new Class({Extends:o2.widget.Department}),o2.widget.Application=new Class({Extends:o2.widget.Department}),o2.widget.Process=new Class({Extends:o2.widget.Department}),o2.widget.FormField=new Class({Extends:o2.widget.Department});