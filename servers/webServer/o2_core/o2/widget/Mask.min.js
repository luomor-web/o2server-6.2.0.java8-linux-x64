o2.widget=o2.widget||{},o2.require("o2.widget.Common",null,!1),o2.widget.Mask=new Class({Implements:[Options,Events],Extends:o2.widget.Common,options:{style:"default",zIndex:100,loading:!0,progress:!1},initialize:function(t){this.setOptions(t),this.path=o2.session.path+"/widget/$Mask/",this.cssPath=o2.session.path+"/widget/$Mask/"+this.options.style+"/css.wcss",this._loadCss(),this._createMaskNodes()},_createMaskNodes:function(){this.container=new Element("div",{styles:this.css.container}),this.container.setStyle("z-index",this.options.zIndex),this.maskBar=new Element("iframe",{styles:this.css.mask}),this.maskBar.setStyle("z-index",this.options.zIndex),this.backgroundBar=new Element("div",{styles:this.css.backgroundBar}),this.backgroundBar.setStyle("z-index",this.options.zIndex+1),this.maskBar.inject(this.container),this.backgroundBar.inject(this.container),this.options.loading&&(this.loadBar=new Element("div",{styles:this.css.loadingBar,html:'<table width="80%" border="0" cellspacing="0" cellpadding="0"><tr valign="middle" height="30"><td align="right"><img src="'+o2.session.path+"/widget/$Mask/"+this.options.style+'/loading.gif" /></td><td align="center">loading...</td></tr></table>'}),this.loadBar.setStyle("z-index",this.options.zIndex+2),this.loadBar.inject(this.container)),this.options.progress&&(this.progressNode=new Element("div",{styles:this.css.progressNode}).inject(this.container),this.progressNode.setStyle("z-index",this.options.zIndex+2))},hide:function(t){new Fx.Morph(this.container,{duration:500}).start({opacity:0}).chain(function(){this.container.destroy(),t&&t()}.bind(this))},load:function(){if(this.fireEvent("queryLoad")){if(this.container.inject($(document.body)),this.options.loading){this.loadBar.setStyle("display","block");var t=this.container.getSize(),s=(t.x-120)/2,i=(t.y-30)/2;i<=0&&(i=(window.screen.height-30)/2),this.loadBar.setStyle("left",s+"px"),this.loadBar.setStyle("top",i+"px")}else this.loadBar&&this.loadBar.setStyle("display","none");this.fireEvent("postLoad")}},loadNode:function(t){if(this.fireEvent("queryLoad")){if(this.container.inject($(t)),this.options.loading){this.loadBar.setStyle("display","block");var s=$(t).getSize(),i=s.x/2,e=(s.y-30)/2;e<=0&&(e=(window.screen.height-30)/2-100),this.loadBar.setStyle("left",i+"px"),this.loadBar.setStyle("top",e+"px")}else this.loadBar&&this.loadBar.setStyle("display","none");this.fireEvent("postLoad")}}});