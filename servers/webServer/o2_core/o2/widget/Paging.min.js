o2.widget=o2.widget||{},o2.require("o2.widget.Common",null,!1),o2.widget.Paging=new Class({Implements:[Options,Events],Extends:o2.widget.Common,options:{style:"default",countPerPage:20,visiblePages:10,currentPage:1,itemSize:0,pageSize:0,hasFirstPage:!0,hasLastPage:!0,hasNextPage:!0,hasPrevPage:!0,hasBatchTuring:!0,hasTruningBar:!0,hasJumper:!0,hiddenWithDisable:!1,hiddenWithNoItem:!0,text:{preBatchTuring:"...",nextBatchTuring:"...",prePage:"",nextPage:"",firstPage:"",lastPage:""}},initialize:function(t,e,s){this.setOptions(e||{}),this.container=$(t),this.path=o2.session.path+"/widget/$Paging/",this.cssPath=o2.session.path+"/widget/$Paging/"+this.options.style+"/css.wcss",this._loadCss(),s&&(this.css=Object.clone(this.css),this.css=Object.merge(this.css,s))},load:function(){this.fireEvent("queryLoad",this),this.options.pageSize=Math.ceil(this.options.itemSize/this.options.countPerPage),0==this.options.pageSize&&this.options.hiddenWithNoItem||(this.container.empty(),this.createNode(),this.fireEvent("postLoad",this))},destroy:function(){this.container.empty()},createNode:function(){var t,e,s;this.wraper=new Element("div.pagingBarWraper",{styles:this.css.pagingBarWraper}).inject(this.container),this.node=new Element("div.pagingBar",{styles:this.css.pagingBar}).inject(this.wraper);var i=!this.options.hiddenWithDisable,n=this.options.pageSize,a=this.options.currentPage,o=this.options.visiblePages,h=Math.floor(o/2);if(n<=o?(s=1,e=n):a+h>n?(s=n-o,e=n):a-h<1?(s=1,e=o):(s=a-h,e=a+h),this.options.hasFirstPage&&(s>1||i)&&this.createFirst(),this.options.hasPrevPage&&(1!=a||i)&&this.createPrev(),this.options.hasTruningBar&&this.options.hasBatchTuring&&s>1&&this.createPrevBatch(s),this.options.hasTruningBar)for(this.pageTurnContainer=new Element("div",{styles:this.css.pageTurnContainer}).inject(this.node),this.pageTurnNodes=[],t=s;t<=e;t++)a==t?this.currentPage=new Element("div.currentPage",{styles:this.css.currentPage,text:t}).inject(this.pageTurnContainer):this.pageTurnNodes.push(this.createPageTurnNode(t));this.options.hasTruningBar&&this.options.hasBatchTuring&&e<n&&this.createNextBatch(e),this.options.hasNextPage&&(a!=n||i)&&this.createNext(),this.options.hasLastPage&&(e<n||i)&&this.createLast(),this.options.hasJumper&&this.createPageJumper()},createFirst:function(){var t=this.firstPage=new Element("div.firstPage",{styles:this.css.firstPage}).inject(this.node);this.options.text.firstPage&&t.set("text",this.options.text.firstPage),t.addEvents({mouseover:function(t){t.target.setStyles(this.css.firstPage_over)}.bind(this),mouseout:function(t){t.target.setStyles(this.css.firstPage)}.bind(this),click:function(){this.gotoPage(1)}.bind(this)})},createLast:function(){var t=this.lastPage=new Element("div.lastPage",{styles:this.css.lastPage}).inject(this.node);this.options.text.lastPage&&t.set("text",this.options.text.lastPage),t.addEvents({mouseover:function(t){t.target.setStyles(this.css.lastPage_over)}.bind(this),mouseout:function(t){t.target.setStyles(this.css.lastPage)}.bind(this),click:function(){this.gotoPage(this.options.pageSize)}.bind(this)})},createPrev:function(){var t=this.prePage=new Element("div.prePage",{styles:this.css.prePage}).inject(this.node);this.options.text.prePage&&t.set("text",this.options.text.prePage),t.addEvents({mouseover:function(t){t.target.setStyles(this.css.prePage_over)}.bind(this),mouseout:function(t){t.target.setStyles(this.css.prePage)}.bind(this),click:function(){this.gotoPage(this.options.currentPage-1)}.bind(this)})},createNext:function(){var t=this.nextPage=new Element("div.nextPage",{styles:this.css.nextPage}).inject(this.node);this.options.text.nextPage&&t.set("text",this.options.text.nextPage),t.addEvents({mouseover:function(t){t.target.setStyles(this.css.nextPage_over)}.bind(this),mouseout:function(t){t.target.setStyles(this.css.nextPage)}.bind(this),click:function(){this.gotoPage(this.options.currentPage+1)}.bind(this)})},createPageTurnNode:function(t){var e=new Element("div.pageItem",{styles:this.css.pageItem,text:t}).inject(this.pageTurnContainer);return e.addEvents({mouseover:function(t){t.target.setStyles(this.css.pageItem_over)}.bind(this),mouseout:function(t){t.target.setStyles(this.css.pageItem)}.bind(this),click:function(){this.obj.gotoPage(this.num)}.bind({obj:this,num:t})}),e},createPrevBatch:function(t){this.preBatchPage=new Element("div.prePage",{styles:this.css.preBatchPage}).inject(this.node),this.options.text.preBatchTuring&&this.preBatchPage.set("text",this.options.text.preBatchTuring),this.preBatchPage.addEvents({mouseover:function(t){t.target.setStyles(this.css.preBatchPage_over)}.bind(this),mouseout:function(t){t.target.setStyles(this.css.preBatchPage)}.bind(this),click:function(){var e;(e=this.options.visiblePages%2==1?t-Math.ceil(this.options.visiblePages/2):t-Math.ceil(this.options.visiblePages/2)-1)<1&&(e=1),this.gotoPage(e)}.bind(this)})},createNextBatch:function(t){this.nextBatchPage=new Element("div.prePage",{styles:this.css.nextBatchPage}).inject(this.node),this.options.text.nextBatchTuring&&this.nextBatchPage.set("text",this.options.text.nextBatchTuring),this.nextBatchPage.addEvents({mouseover:function(t){t.target.setStyles(this.css.nextBatchPage_over)}.bind(this),mouseout:function(t){t.target.setStyles(this.css.nextBatchPage)}.bind(this),click:function(){var e;(e=this.options.visiblePages%2==1?t+Math.ceil(this.options.visiblePages/2):t+Math.ceil(this.options.visiblePages/2)+1)>this.options.pageSize&&(e=this.options.pageSize),this.gotoPage(e)}.bind(this)})},createPageJumper:function(){var t=this,e=this.pageJumper=new Element("input.pageJumper",{styles:this.css.pageJumper,title:o2.LP.widget.pageJumperTitle}).inject(this.node);this.pageJumperText=new Element("div.pageText",{styles:this.css.pageJumperText,text:"/"+this.options.pageSize}).inject(this.node),e.addEvents({focus:function(t){t.target.setStyles(this.css.pageJumper_over)}.bind(this),blur:function(e){var s=this.value;t.pageJumper.set("value",""),s&&t.gotoPage(s),e.target.setStyles(t.css.pageJumper)},keyup:function(t){this.value=this.value.replace(/[^0-9_]/g,"")},keydown:function(e){if(13==e.code&&""!=this.value){var s=this.value;t.pageJumper.set("value",""),t.gotoPage(s),e.stopPropagation()}}})},gotoPage:function(t){"string"===typeOf(t)&&(t=t.toInt()),t<1||t>this.options.pageSize||(this.fireEvent("jumpingPage",[t]),this.options.currentPage=t,this.load())},gotoItem:function(t){var e=Math.ceil(t/this.options.countPerPage),s=t%this.options.countPerPage;this.fireEvent("jumpingPage",[e,t,s]),this.options.currentPage=e,this.load()}});