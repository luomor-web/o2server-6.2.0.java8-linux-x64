o2.widget.SimpleToolbar=new Class({Extends:o2.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(t,s,i){this.setOptions(s),this.bindObject=i,this.items=[],this.children=[],this.childrenButton=[],this.childrenMenu=[],this.path=o2.session.path+"/widget/$SimpleToolbar/",this.cssPath=o2.session.path+"/widget/$SimpleToolbar/"+this.options.style+"/css.wcss",this._loadCss(),this.node=$(t),this.node.onselectstart=function(){return!1},this.node.oncontextmenu=function(){return!1}},load:function(){this.fireEvent("queryLoad")&&(this.node.set("styles",this.css.container),this._loadToolbarItemNode(),this._loadToolbarItems(),this.fireEvent("postLoad"))},_loadToolbarItemNode:function(){this.node.getChildren().each(function(t,s){var i=t.get("MWFnodetype");i&&("array"==typeOf(this[i])||(this[i]=[]),this[i].push(t))}.bind(this))},_loadToolbarItems:function(){this._loadToolBarButton(this.MWFToolBarButton)},_loadToolBarButton:function(t){t&&t.each(function(t,s){var i=new o2.widget.SimpleToolbarButton(t,this,this.options);i.load(),this.fireEvent("buttonLoad",[i]),i.buttonID&&(this.items[i.buttonID]=i),this.children.push(i),this.childrenButton.push(i)}.bind(this))}}),o2.widget.SimpleToolbarButton=new Class({Implements:[Options,Events],options:{text:"",title:"",pic:"",pic_over:"",action:"",actionScript:"",disable:!1},initialize:function(t,s,i){if(this.setOptions(i),this.node=$(t),this.toolbar=s,this.buttonID=this.node.MWFnodeid||this.node.id,this.node){var o=this.node.get("MWFButtonText");o&&(this.options.text=o);var e=this.node.get("title");e&&(this.options.title=e);var n=this.node.get("MWFButtonImage");n&&(this.options.pic=n);var h=this.node.get("MWFButtonImageOver");h&&(this.options.pic_over=h),this.node.get("MWFButtonDisable")&&(this.options.disable=!0);var d=this.node.get("MWFButtonAction");d&&(this.options.action=d)}else this.node=new Element("div").inject(this.toolbar.node);this.modifiyStyle=!0},load:function(){this._addButtonEvent(),this.node.title=this.options.title,this.node.set("styles",this.toolbar.css.button),this.options.pic&&(this.picNode=this._createImageNode(this.options.pic)),this.options.text&&(this.textNode=this._createTextNode(this.options.text)),this.setDisable(this.options.disable)},enable:function(){this.options.disable&&(this.setDisable(!1),this.options.disable=!1)},disable:function(){this.options.disable||(this.setDisable(!0),this.options.disable=!0)},setDisable:function(t){if(t){if(this.node.set("styles",this.toolbar.css.buttonDisable),this.picNode){this.picNode.set("styles",this.toolbar.css.buttonImgDivDisable);var s=(o=(i=this.picNode.getElement("img")).get("src")).substr(o.lastIndexOf("."),o.length);o=(o=o.substr(0,o.lastIndexOf(".")))+"_gray"+s,this.src_gray=o,i.set("src",o)}this.textNode&&this.textNode.set("styles",this.toolbar.css.buttonTextDivDisable)}else{var i,o;if(this.node.set("styles",this.toolbar.css.button),this.picNode)this.picNode.set("styles",this.toolbar.css.buttonImgDiv),o=(o=(i=this.picNode.getElement("img")).get("src")).replace("_gray",""),this.src_gray=o,i.set("src",o);this.textNode&&this.textNode.set("styles",this.toolbar.css.buttonTextDiv)}},_createImageNode:function(t){if(t){var s=new Element("span",{styles:this.toolbar.css.buttonImgDiv}).inject(this.node);this.img=new Element("img",{styles:this.toolbar.css.buttonImg,src:t}).inject(s);return s}return null},_createTextNode:function(t){return t?new Element("span",{styles:this.toolbar.css.buttonTextDiv,text:t}).inject(this.node):null},_addButtonEvent:function(){this.node.addEvent("mouseover",this._buttonMouseOver.bind(this)),this.node.addEvent("mouseout",this._buttonMouseOut.bind(this)),this.node.addEvent("mousedown",this._buttonMouseDown.bind(this)),this.node.addEvent("mouseup",this._buttonMouseUp.bind(this)),this.node.addEvent("click",this._buttonClick.bind(this))},_buttonMouseOver:function(){this.modifiyStyle&&(this.options.disable||(this.options.pic_over&&this.img.set("src",this.options.pic_over),this.node.set("styles",this.toolbar.css.buttonOver)))},_buttonMouseOut:function(){this.modifiyStyle&&(this.options.disable||(this.img.set("src",this.options.pic),this.node.set("styles",this.toolbar.css.buttonOut)))},_buttonMouseDown:function(){this.modifiyStyle&&(this.options.disable||this.node.set("styles",this.toolbar.css.buttonDown))},_buttonMouseUp:function(){this.modifiyStyle&&(this.options.disable||this.node.set("styles",this.toolbar.css.buttonUp))},_buttonClick:function(t){if(!this.options.disable&&this.options.action){var s=this.options.action.split(":"),i=s.shift(),o=this.toolbar.bindObject?this.toolbar.bindObject:window;o[i]?(s.push(this),s.push(t),o[i].apply(o,s)):window[i]&&window[i].apply(this,s)}}});