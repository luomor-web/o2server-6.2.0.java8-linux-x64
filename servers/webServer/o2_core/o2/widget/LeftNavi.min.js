o2.widget=o2.widget||{},o2.require("o2.widget.Common",null,!1),o2.require("o2.widget.Tree",null,!1),o2.widget.LeftNavi=new Class({Extends:o2.widget.Tree,Implements:[Options,Events],options:{style:"default",expand:!1},jsonMapping:{expand:"expand",title:"title",text:"text",action:"action",icon:"icon",sub:"sub"},initialize:function(e,t){this.setOptions(t),this.path=o2.session.path+"/widget/$LeftNavi/",this.cssPath=o2.session.path+"/widget/$LeftNavi/"+this.options.style+"/css.wcss",this._loadCss(),this.container=$(e),this.children=[],this.treeJson=null,this.treeXML=null},appendChild:function(e){var t=new o2.widget.LeftNavi.Menu(this,e);return this.children.length?(t.previousSibling=this.children[this.children.length-1],t.previousSibling.nextSibling=t):this.firstChild=t,t.load(),t.node.inject(this.node),this.children.push(t),t},expand:function(e){this.fireEvent("queryExpand",[e])&&e.childrenNode.setStyle("display","block"),this.fireEvent("postExpand",[e])},collapse:function(e){this.fireEvent("queryCollapse",[e])&&e.childrenNode.setStyle("display","none"),this.fireEvent("postCollapse",[e])}}),o2.widget.LeftNavi.Menu=new Class({Extends:o2.widget.Tree.Node,Implements:[Options,Events],insertChild:function(e){var t=new o2.widget.LeftNavi.Node(this.tree,e),i=this.previousSibling;return this.previousSibling=t,t.nextSibling=this,t.previousSibling=i,i?i.nextSibling=t:this.parentNode.firstChild=t,t.parentNode=this.parentNode,t.level=this.level,t.load(),t.node.inject(this.node,"before"),this.parentNode.children.push(t),t},appendChild:function(e){var t=new o2.widget.LeftNavi.Node(this.tree,e);return this.children.length?(t.previousSibling=this.children[this.children.length-1],t.previousSibling.nextSibling=t):(this.firstChild=t,this.setOperateIcon()),t.level=this.level+1,t.parentNode=this,t.load(),t.node.inject(this.childrenNode),this.children.push(t),t},load:function(){this.nodeTable=new Element("table",{border:"0",cellpadding:"0",cellspacing:"0",styles:this.tree.css.nodeTable}).inject(this.itemNode);var e=new Element("tbody").inject(this.nodeTable);this.nodeArea=new Element("tr").inject(e),this.createLevelNode(),this.createOperateNode(),this.createIconNode(),this.createTextNode(),this.setOtherEvent()},setOtherEvent:function(){this.operateNode.removeEvents("click"),this.textNode.getFirst("div").removeEvents("click"),this.itemNode.addEvent("click",function(){this.clickNode()}.bind(this))},clickNode:function(){this.expand()},expand:function(){this.tree.currentMenu!=this&&this.selectNode()},selectNode:function(){this.tree.currentMenu&&(this.tree.currentMenu.itemNode.setStyles(this.tree.css.treeItemNode),this.tree.currentMenu.collapseNode()),this.itemNode.setStyles(this.tree.css.treeItemNodeSelected),this.expandNode(),this.tree.currentMenu=this},expandNode:function(){var e=new Fx.Morph(this.childrenNode,{duration:100});this.childrenNode.setStyles({display:"block",height:"0px"}),e.start({height:40*this.children.length}).chain(function(){}.bind(this))},collapseNode:function(){new Fx.Morph(this.childrenNode,{duration:100}).start({height:0}).chain(function(){this.childrenNode.setStyle("display","none")}.bind(this))}}),o2.widget.LeftNavi.Node=new Class({Extends:o2.widget.Tree.Node,Implements:[Options,Events],insertChild:function(e){var t=new o2.widget.LeftNavi.Node(this.tree,e),i=this.previousSibling;return this.previousSibling=t,t.nextSibling=this,t.previousSibling=i,i?i.nextSibling=t:this.parentNode.firstChild=t,t.parentNode=this.parentNode,t.level=this.level,t.load(),t.node.inject(this.node,"before"),this.parentNode.children.push(t),t},appendChild:function(e){var t=new o2.widget.LeftNavi.Node(this.tree,e);return this.children.length?(t.previousSibling=this.children[this.children.length-1],t.previousSibling.nextSibling=t):(this.firstChild=t,this.setOperateIcon()),t.level=this.level+1,t.parentNode=this,t.load(),t.node.inject(this.childrenNode),this.children.push(t),t},load:function(){this.nodeTable=new Element("table",{border:"0",cellpadding:"0",cellspacing:"0",styles:this.tree.css.nodeTable}).inject(this.itemNode);var e=new Element("tbody").inject(this.nodeTable);this.nodeArea=new Element("tr").inject(e),this.createLevelNode(),this.createOperateNode(),this.createIconNode(),this.createTextNode(),this.setLevelStyle(),this.setOtherEvent()},setOtherEvent:function(){0==this.level&&(this.operateNode.removeEvents("click"),this.itemNode.addEvent("click",function(){this.menuClickNode()}.bind(this)))},menuClickNode:function(){this.selectNode(),this.expandOrCollapse()},selectNode:function(){if(this.tree.currentNode){var e=this.tree.currentNode.itemNode;this.level>0?e.setStyles(this.tree.css.treeItemNodeSub):e.setStyles(this.tree.css.treeItemNode)}e=this.itemNode;this.level>0?e.setStyles(this.tree.css.treeItemNodeSelectedSub):e.setStyles(this.tree.css.treeItemNodeSelected),this.tree.currentNode=this},setLevelStyle:function(){this.tree.css.treeNodeSub&&this.node.setStyles(this.tree.css.treeNodeSub),this.tree.css.treeItemNodeSub&&this.itemNode.setStyles(this.tree.css.treeItemNodeSub),this.tree.css.treeChildrenNodeSub&&this.childrenNode.setStyles(this.tree.css.treeChildrenNodeSub),this.tree.css.nodeTableSub&&this.nodeTable.setStyles(this.tree.css.nodeTableSub),this.tree.css.textDivNodeSub&&this.textNode.getFirst("div").setStyles(this.tree.css.textDivNodeSub),this.tree.css.iconNodeSub&&this.iconNode.setStyles(this.tree.css.iconNodeSub),this.tree.css.blankLevelNodeSub&&this.levelNode.each((function(e){e.setStyles(this.tree.css.blankLevelNodeSub)}))}});