o2.widget=o2.widget||{},o2.widget.JsonView=new Class({Implements:[Options,Events],Extends:o2.widget.Common,options:{title:"JsonView",style:"default",width:400,height:400,top:0,left:0,isMove:!0,isClose:!0,isMax:!0,isExpand:!0,isResize:!0,target:null},initialize:function(t,e){this.setOptions(e),this.json=t,this.jsonString=JSON.encode(t),this.node=new Element("div")},load:function(){this.fireEvent("queryLoad")&&(o2.require("o2.widget.Panel",function(){this.jsonObjectNode=this.createJsonObjectNode(),this.jsonStringNode=this.createJsonStringNode(),o2.require("o2.widget.Tab",function(){this.tab=new o2.widget.Tab(this.node,{style:"moduleList"}),this.tab.load(),this.objectTabPage=this.tab.addTab(this.jsonObjectNode,"JSON",!1),this.stringTabPage=this.tab.addTab(this.jsonStringNode,"Text",!1),this.objectTabPage.showTab()}.bind(this)),this.options.onResize=function(){this.setPanelSize()}.bind(this),this.jsonPanel=new o2.widget.Panel(this.node,this.options),this.jsonPanel.load(),this.jsonPanel.show(),this.setPanelSize()}.bind(this)),this.fireEvent("postLoad"))},setPanelSize:function(){var t=this.jsonPanel.content.getSize(),e=this.jsonPanel.content.getStyle("padding-top").toFloat(),o=this.jsonPanel.content.getStyle("padding-bottom").toFloat(),i=this.tab.tabNodeContainer.getSize(),n=this.tab.tabNodeContainer.getStyle("margin-top").toFloat(),s=this.tab.tabNodeContainer.getStyle("margin-bottom").toFloat(),a=this.stringTabPage.contentNodeArea.getStyle("margin-top").toFloat(),h=this.stringTabPage.contentNodeArea.getStyle("margin-bottom").toFloat(),d=t.y-e-o-i.y-n-s-a-h-5;d<10&&(d=10),this.jsonStringNode.setStyle("height",d),this.jsonObjectNode.setStyle("height",d-20)},createJsonObjectNode:function(){return this.jsonObjectNode=new Element("div",{styles:{overflow:"hideen","margin-top":"0px",height:"auto"}}),this.loadObjectTree(),this.jsonObjectNode},loadObjectTree:function(){this.objectTree&&(this.objectTree.node.destroy(),this.objectTree=null),o2.require("o2.widget.Tree",function(){this.objectTree=new o2.widget.Tree(this.jsonObjectNode,{style:"jsonview"}),this.objectTree.load(),this.parseJsonObject(this.objectTree,"JSON",this.json,!0)}.bind(this))},parseJsonObject:function(t,e,o,n){var s={expand:n,title:"",text:"",action:"",icon:""};switch(typeOf(o)){case"object":s.text=e,s.icon="object.png";var a=t.appendChild(s);for(i in o)this.parseJsonObject(a,i,o[i],!1);break;case"array":s.text=e,s.icon="array.png";a=t.appendChild(s);o.each(function(t,e){this.parseJsonObject(a,"["+e+"]",t,!1)}.bind(this));break;default:s.text=e+" : "+o,s.icon="string.png";a=t.appendChild(s)}},createJsonStringNode:function(){var t=new Element("textarea",{readonly:!1,styles:{width:"99%",overflow:"auto",border:"0px"}});return t.set("text",JSON.format(this.json)),t}});