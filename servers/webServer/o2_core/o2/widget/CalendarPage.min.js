o2.widget=o2.widget||{},o2.require("o2.widget.Calendar",null,!1),o2.widget.CalendarPage=o2.CalendarPage=new Class({Extends:o2.widget.Calendar,Implements:[Options,Events],initialize:function(t,s){Locale.use("zh-CHS"),this.setOptions(s),this.path=o2.session.path+"/widget/$Calendar/",this.cssPath=o2.session.path+"/widget/$Calendar/"+this.options.style+"/css.wcss",this._loadCss(),this.options.isTime?this.options.format=Locale.get("Date").shortDate+" %H:%M":this.options.format=Locale.get("Date").shortDate,this.options.containerPath=this.options.path+this.options.style+"/container.html",this.options.dayPath=this.options.path+this.options.style+"/day.html",this.options.monthPath=this.options.path+this.options.style+"/month.html",this.options.yearPath=this.options.path+this.options.style+"/year.html",this.options.timePath=this.options.path+this.options.style+"/time.html",this.today=new Date,this.currentView=this.options.defaultView,this.node=$(t),this.visible=!1,this.container=this.createContainer(),this.container.inject(this.node),this.contentTable=this.createContentTable(),this.contentTable.inject(this.contentDateNode),this.addEvents(),this.fireEvent("init")},addEvents:function(){this.prevNode.addEvent("click",function(){this.getPrev()}.bind(this)),this.nextNode.addEvent("click",function(){this.getNext()}.bind(this)),this.currentTextNode.addEvent("click",function(){this.changeView()}.bind(this))},show:function(){if(!this.visible){var t=this.node.get("value");switch(t&&(this.options.baseDate=Date.parse(t.substr(0,10))),this.currentView=this.options.defaultView,this.currentView){case"day":this.changeViewToDay();break;case"month":this.showMonth();break;case"year":this.showYear();break;case"time":this.showTime(this.options.baseDate);break;default:this.showDay()}this.container.setStyle("display","block"),this.visible=!0,this.fireEvent("show")}},_selectDate:function(t,s){var e=new Date(t);e.format(this.options.format);if(this.options.isTime)this.changeViewToTime(e);else if(this.fireEvent("queryComplate",t)){var i=this.currentTextNode.retrieve("year"),o=this.currentTextNode.retrieve("month");baseDate=new Date,baseDate.setFullYear(i),baseDate.setMonth(o-1);for(var a=new Date(t),n=(s?s.getParent("tbody"):this.contentTable.getElement("tbody")).getElements("td"),h=0;h<n.length;h++){var r=new Date(n[h].retrieve("dateValue"));r.clearTime(),r.clearTime().toString()==this.today.clearTime().toString()?(n[h].setStyles(this.css["today_"+this.options.style]),n[h].setStyle("border","0px solid #AAA")):r.clearTime().toString()==a.clearTime().toString()?(n[h].addClass("current_"+this.options.style),n[h].setStyles(this.css["current_"+this.options.style]),n[h].removeClass("gray_"+this.options.style),n[h].removeClass("past_"+this.options.style),n[h].setStyle("border","1px solid #FFF")):baseDate.getMonth()!=r.getMonth()?(n[h].addClass("gray_"+this.options.style),n[h].setStyles(this.css["gray_"+this.options.style]),n[h].removeClass("current_"+this.options.style),n[h].removeClass("past_"+this.options.style),n[h].setStyle("border","1px solid #FFF")):r.diff(this.today)>0?(this.css["past_"+this.options.style]&&n[h].setStyles(this.css["past_"+this.options.style]),n[h].addClass("past_"+this.options.style),n[h].removeClass("current_"+this.options.style),n[h].removeClass("gray_"+this.options.style)):(n[h].setStyles(this.css["normal_"+this.options.style]),n[h].addClass("normal_"+this.options.style),n[h].removeClass("current_"+this.options.style),n[h].removeClass("gray_"+this.options.style),n[h].removeClass("past_"+this.options.style),n[h].setStyle("border","1px solid #FFF"))}this.fireEvent("complate")}}});