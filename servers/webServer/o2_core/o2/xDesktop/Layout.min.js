MWF.xDesktop=MWF.xDesktop||{},MWF.xDesktop.requireApp=function(t,e,i,s){o2.requireApp(t,e,i,s)},MWF.xApplication=MWF.xApplication||{},MWF.require("MWF.xDesktop.Lnk",null,!1),MWF.require("MWF.xDesktop.Message",null,!1),MWF.require("MWF.xDesktop.shortcut",null,!1),MWF.xDesktop.requireApp("Common","Widget",null,!1),MWF.require("MWF.xDesktop.WebSocket",null,!1),MWF.xDesktop.Layout=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",defaultStyle:"default",topShim:"layout_top_shim",top:"layout_top",desktop:"layout_desktop",content:"desktop_content",navi:"desktop_navi"},categoryCount:20,processCount:40,initialize:function(t,e){this.setOptions(e),this.type="layout",this.path=MWF.defaultPath+"/xDesktop/$Layout/",this.initData(),this.initNode(t)},getPublicStyleLoad:function(t){MWF.UD.getPublicData("defaultLayout",function(e){e&&(this.status=e),this.initNode(t),this.load()}.bind(this))},loadCss:function(){var t=new URI(window.location.href),e=t.getData("style"),i=t.getData("styletype");e?"custom"==i?MWF.UD.getPublicData(e,function(t){t&&t.data.desktop&&t.data.window?(this.css=t.data.desktop,this.windowCss=t.data.window):(MWF.UD.deletePublicData(e),this.options.style=this.options.defaultStyle,this.cssPath=MWF.defaultPath+"/xDesktop/$Layout/"+this.options.style+"/css.wcss",this._loadCss())}.bind(this),!1):(this.options.style=e,this.cssPath=MWF.defaultPath+"/xDesktop/$Layout/"+this.options.style+"/css.wcss",this._loadCss()):this.status&&this.status.style&&"custom"==this.status.styleType?MWF.UD.getPublicData(this.status.style,function(t){t&&t.data.desktop&&t.data.window?(this.css=t.data.desktop,this.windowCss=t.data.window):(MWF.UD.deletePublicData(this.status.style),this.options.style=this.options.defaultStyle,this.cssPath=MWF.defaultPath+"/xDesktop/$Layout/"+this.options.style+"/css.wcss",this._loadCss())}.bind(this),!1):(this.status&&this.status.style&&(this.options.style=this.status.style),this.cssPath=MWF.defaultPath+"/xDesktop/$Layout/"+this.options.style+"/css.wcss",this._loadCss(),this.css||(this.options.style=this.options.defaultStyle,this.cssPath=MWF.defaultPath+"/xDesktop/$Layout/"+this.options.style+"/css.wcss",this._loadCss()))},initNode:function(t){this.loadCss(),this.node=$(t),this.topShimNode=this.node.getElement("#"+this.options.topShim),this.topNode=this.node.getElement("#"+this.options.top),this.topAreaNode=this.node.getElement("#"+this.options.top),this.desktopNode=this.node.getElement("#"+this.options.desktop),this.contentNode=this.node.getElement("#"+this.options.content),this.naviNode=this.node.getElement("#"+this.options.navi),this.node&&this.node.setStyles(this.css.layoutNode),this.topShimNode&&this.topShimNode.setStyles(this.css.layoutTopShimNode),this.topNode&&this.topNode.setStyles(this.css.layoutTopNode),this.desktopNode&&this.desktopNode.setStyles(this.css.desktopNode),this.contentNode&&this.contentNode.setStyles(this.css.contentNode),this.naviNode&&this.naviNode.setStyles(this.css.naviNode);this.css.desktop.background;this.node.setStyle("background-image",this.css.desktop.background)},initData:function(){this.apps={},this.widgets={},this.appCurrentList=[],this.lnkAreas=[],this.lnks=[],this.currentApp=null,this.session={};var t=new URI(window.location.href),e=t.getData("default")||"";this.noDefault="false"===e.toString().toLowerCase();var i=t.getData("app"),s=t.getData("option"),n=s?JSON.decode(s):null;i?(this.status=layout.userLayout,this.status.apps={},this.status.apps[i]=n||{},this.status.apps[i].name=i,this.status.apps[i].appId=i,this.status.apps[i].window={isMax:!0,isHide:!1},this.status.currentApp=i):this.status=layout.userLayout,this.session.user=layout.session.user,this.serviceAddressList=layout.serviceAddressList,this.centerServer=layout.centerServer,this.status&&this.status.style&&(this.options.style=this.status.style),this.status&&this.status.styleType&&(this.options.styleType=this.status.styleType),layout.openApplication=this.openApplication.bind(this)},load:function(){document.body.addEventListener&&document.body.addEventListener("dragover",function(t){t.stopPropagation(),t.preventDefault()}.bind(this),!1),this.status&&this.status.style&&this.options.style!==this.status.style&&this.changStyle(this.status.style),this.getNodeBackground(),this.loadDesktop(),this.session.user.passwordExpired&&(this.openApplication({page:{x:0,y:0}},"Profile",{tab:"passwordConfigPage"}),window.setTimeout(function(){MWF.xDesktop.notice("error",{y:"top",x:"left"},MWF.LP.desktop.notice.changePassword,this.desktopNode)}.bind(this),500)),MWF.AC.isAdministrator(),this.fireEvent("load")},checkO2Collect:function(){var t=new MWF.xDesktop.Actions.RestActions("/xDesktop/Actions/action.json","x_program_center");t.invoke({name:"collectConnected",success:function(e){e.data.value?t.invoke({name:"collectValidate",success:function(t){t.data.value||this.openApplication({page:{x:0,y:0}},"Collect")}.bind(this),failure:function(){this.openApplication({page:{x:0,y:0}},"Collect")}.bind(this)}):this.showMessageNotConnectCollect()}.bind(this),failure:function(){this.showMessageNotConnectCollect()}.bind(this)})},showMessageNotConnectCollect:function(){var t={subject:MWF.LP.desktop.collect.collectNotConnected,content:MWF.LP.desktop.collect.collectNotConnectedText};layout.desktop.message.addTooltip(t),layout.desktop.message.addMessage(t)},loadDesktop:function(){this.setHeight();var t=this.desktopNode.getSize();this.size={x:t.x,y:t.y},this.loadTop(),this.loadLnkArea(),this.setEvent(),this.loadWidget(),this.loadStatus(function(){this.openWebSocket()}.bind(this))},openWebSocket:function(){this.socket=new MWF.xDesktop.WebSocket},checkWebSocket:function(){this.socket&&1===this.socket.webSocket.readyState?this.socket.heartbeat("heartbeat"):this.socket=new MWF.xDesktop.WebSocket,window.setTimeout(this.checkWebSocket.bind(this),3e4)},loadWidget:function(){},loadLnkAreaContainer:function(){this.lnkAreaContainer=new Element("div",{styles:{height:"100%",overflow:"hidden"}}).inject(this.contentNode)},loadLnkArea:function(){this.lnkAreaContainer||this.loadLnkAreaContainer();var t=new Element("div",{styles:this.css.dsektopLnkArea}).inject(this.lnkAreaContainer);this.lnkAreas.push(t);var e=t.getSize().x*this.lnkAreas.length,i=this.contentNode.getSize();this.lnkAreaContainer.setStyle("width",Math.max(e,i.x)+"px"),this.setCurrentLnkArea()},setCurrentLnkArea:function(){if(this.lnkAreas.length>1){var t=this.lnkAreas[0].getSize().x,e=t*this.lnkAreas.length,i=this.contentNode.getSize(),s=this.lnkAreas[this.lnkAreas.length-1];e<i.x?(e-=t,s.setStyles({width:"auto","margin-left":e+"px",float:"none"})):s.setStyles(this.css.dsektopLnkArea)}else this.lnkAreas.length&&this.lnkAreas[0].setStyles({width:"auto","margin-left":"0px",float:"none"})},addLnkArea:function(){this.lnkAreas.length&&this.lnkAreas[this.lnkAreas.length-1].setStyles(this.css.dsektopLnkArea),this.loadLnkArea()},addLnk:function(t){var e=new MWF.xDesktop.Lnk(t.icon,t.title,t.par);this.lnkAreas.length||this.loadLnkArea(),e.inject(this.lnkAreas[this.lnkAreas.length-1]),this.lnks.push(e)},resizeLnk:function(){if(this.lnkAreaContainer)if(this.lnkAreas.length>1){var t=this.lnkAreas[0].getSize().x*this.lnkAreas.length,e=this.contentNode.getSize();this.lnkAreaContainer.setStyle("width",Math.max(t,e.x)+"px")}else this.lnkAreaContainer.setStyle("width",this.contentNode.getSize().x+"px");var i=0,s=0;if(this.lnks.each(function(t,e){for(;!this.lnkAreas[i];)this.addLnkArea();var n=this.lnkAreas[i];t.inject(n),s++,(t.node.getSize().y+t.node.getStyle("margin-top").toFloat())*(s+1)>n.getSize().y&&(e<this.lnks.length-1&&i++,s=0)}.bind(this)),this.lnkAreas.length)for(;this.lnkAreas.length>i+1;)this.lnkAreas.pop().destroy();this.setCurrentLnkArea()},refreshApp:function(t){if(t.window){var e={id:t.appId,name:t.options.name,style:t.options.style,appId:t.appId,window:{size:{x:t.window.css.to.width.toFloat(),y:t.window.css.to.height.toFloat()},position:{x:t.window.css.to.left.toFloat(),y:t.window.css.to.top.toFloat()},isMax:t.window.isMax,isHide:t.window.isHide,style:t.window.options.style},app:null};t.recordStatus&&(e.app=t.recordStatus()),t.close(),this.openApplicationWithStatus(e)}},openApplicationWithStatus:function(t){var e=t.name,i=t.style?t.style:this.options.defaultStyle;this.requireApp(e,function(e){var s=new e.Main(this,{style:i,isRefresh:!0,onLoadWindow:function(){this.window.setOptions({top:t.window.position.y,left:t.window.position.x,width:t.window.size.x,height:t.window.size.y}),this.window.reStyle()},onPostLoadWindow:function(){t.window.isMax&&this.maxSize(function(){this.fireAppEvent("postLoadWindowMax")}.bind(this)),t.window.isHide&&this.minSize(function(){this.fireAppEvent("postLoadWindowMin")}.bind(this))},onPostLoad:function(){}});s.desktop=this,s.appId=t.id,s.taskitem=new MWF.xDesktop.Layout.Taskitem(s,this),this.apps[t.id]=s,s.status=t.app,this.appCurrentList.push(s),s.loadNoAnimation(!0,t.window.isMax,t.window.isHide)}.bind(this))},loadStatus:function(t){this.status&&(this.status.apps&&Object.each(this.status.apps,function(t,e){var i=t.name,s=t.style?t.style:this.options.defaultStyle;this.requireApp(i,function(i){var n=new i.Main(this,{style:s,isRefresh:!0,onLoadWindow:function(){this.window.setOptions({top:t.window.position?t.window.position.y:10,left:t.window.position?t.window.position.x:10,width:t.window.size?t.window.size.x:this.options.width,height:t.window.size?t.window.size.y:this.options.height}),this.window.reStyle()},onPostLoadWindow:function(){t.window.isMax&&this.maxSize(function(){this.fireAppEvent("postLoadWindowMax")}.bind(this)),t.window.isHide&&this.minSize(function(){this.fireAppEvent("postLoadWindowMin")}.bind(this))},onPostLoad:function(){}});n.desktop=this,n.appId=e,n.taskitem=new MWF.xDesktop.Layout.Taskitem(n,this),this.apps[e]=n,n.status=t.app,this.appCurrentList.push(n),n.loadNoAnimation(this.status.currentApp==e,t.window.isMax,t.window.isHide)}.bind(this))}.bind(this)),this.status.widgets&&Object.each(this.status.widgets,function(t,e){var i=t.name,s=t.appName;this.requireApp(s,function(s){var n=new s[i](this,{position:t.position,onLoadWidget:function(){this.widget.setOptions({position:t.position})}});n.desktop=this,n.widgetId=e,this.widgets[e]=n,n.status=t.widget,n.load()}.bind(this),i)}.bind(this)),this.status.lnks&&(this.status.lnks.each(function(t){this.addLnk(t)}.bind(this)),this.resizeLnk()));var e=!1,i=!1,s=function(){e&&i&&t&&t()},n=MWF.defaultPath+"/xDesktop/$Layout/applications.json";MWF.getJSON(n,function(t){t.each(function(t,e){t.widgetName&&t.widgetStart&&this.openWidget(null,t.widgetName,t.path)}.bind(this)),e=!0,s()}.bind(this)),new MWF.xDesktop.Actions.RestActions("/xDesktop/Actions/action.json","x_component_assemble_control").invoke({name:"listComponent",success:function(t){var e=this.session.user,n=[e.name,e.distinguishedName,e.id,e.unique];e.roleList&&(n=n.concat(e.roleList)),e.groupList&&(n=n.concat(e.groupList)),t.data.each(function(t,e){if(t.visible){var i=!t.allowList.length||t.allowList.isIntersect(n);(!(!!t.denyList.length&&t.denyList.isIntersect(n))&&i||MWF.AC.isAdministrator())&&t.widgetName&&t.widgetStart&&this.openWidget(null,t.widgetName,t.path)}}.bind(this)),i=!0,s()}.bind(this)})},setEvent:function(){this.node.addEvent("selectstart",(function(t){var e="text";t.target.getStyle("-webkit-user-select")&&(e=t.target.getStyle("-webkit-user-select").toString().toLowerCase()),"text"!==e.toString()&&"auto"!==e.toString()&&t.preventDefault()})),window.onunload=function(t){}.bind(this),window.onbeforeunload=function(t){if(!this.isLogout)return this.notRecordStatus||this.recordDesktopStatus(),this.socket&&this.socket.webSocket&&(this.socket.reConnect=!1,this.socket.webSocket.close()),this.fireEvent("unload"),(t=t||window.event).returnValue=MWF.LP.desktop.notice.unload,MWF.LP.desktop.notice.unload}.bind(this)},recordDesktopStatus:function(t){Object.each(this.apps,function(t,e){t.options.desktopReload||this.closeApp(t)}.bind(this)),this.recordStatusData((function(){t&&t()}))},getLayoutStatusData:function(){var t={viewMode:"Layout",style:this.options.style,styleType:this.options.styleType||"",flatStyle:this.status.flatStyle||"blue",currentApp:this.currentApp?this.currentApp.appId:"Homepage",apps:{},lnks:[],flatLnks:this.status.flatLnks&&"array"===o2.typeOf(this.status.flatLnks)?this.status.flatLnks:[],widgets:{}};return Object.each(this.apps,(function(e,i){if(e.window&&e.options.desktopReload){var s={title:e.options.title,appId:e.appId,name:e.options.name,style:e.options.style,window:{size:{x:e.window.css.to.width.toFloat(),y:e.window.css.to.height.toFloat()},position:{x:e.window.css.to.left.toFloat(),y:e.window.css.to.top.toFloat()},isMax:e.window.isMax,isHide:e.window.isHide,style:e.window.options.style},app:null};e.recordStatus&&(s.app=e.recordStatus()),t.apps[i]=s}})),this.lnks.each((function(e){t.lnks.push({icon:e.icon,title:e.title,par:e.par})})),Object.each(this.widgets,(function(e,i){var s={name:e.options.name,appName:e.options.appName,position:e.options.position,widget:null};e.recordStatus&&(s.widget=e.recordStatus()),t.widgets[i]=s})),t},recordStatusData:function(t){var e=this.getLayoutStatusData();MWF.UD.putData("layout",e,(function(){t&&t()}))},getPageDesignerStyle:function(t){this.pageDesignerStyle?t&&t():(this.pageDesignerStyle="default",MWF.UD.getData("pageDesignerStyle",function(e){if(e.data){var i=JSON.decode(e.data);this.pageDesignerStyle=i.style}t&&t()}.bind(this)))},getFormDesignerStyle:function(t){this.formDesignerStyle?t&&t():(this.formDesignerStyle="default",MWF.UD.getData("formDesignerStyle",function(e){if(e.data){var i=JSON.decode(e.data);this.formDesignerStyle=i.style}t&&t()}.bind(this)))},recordStatusCookies:function(t){var e=JSON.encode(t);Cookie.write("xdesktop",e)},setHeight:function(){this.resizeHeight(),$(window).addEvent("resize",function(){this.resizeHeight()}.bind(this))},resizeHeight:function(){var t=this.topNode.getSize().y,e=$(document.body).getSize().y-t;this.desktopNode.setStyle("height",e+"px"),this.desktopHeight=e,e-=this.naviNode.getSize().y,this.contentNode.setStyle("height",e+"px"),this.resizeApps(),this.resizeLnk(),this.resizeMessage(),this.setTaskitemSize(),this.top&&this.top.userPanel&&this.top.userPanel.setPosition(),this.fireEvent("resize")},setTaskitemSize:function(){if(this.top){var t=this.top.taskbar.getSize(),e=this.top.taskbar.getChildren(),i=0;if(e.length){for(var s=e[0].getStyles("border-left-width","border-right-width","margin-left","margin-right","padding-left","padding-right"),n=0;n<e.length;n++)e[n].setStyle("width","auto"),i+=e[n].getSize().x+s["border-left-width"].toInt()+s["border-right-width"].toInt()+s["margin-left"].toInt()+s["margin-right"].toInt()+s["padding-left"].toInt()+s["padding-right"].toInt();if(i>t.x-10){var o=(t.x-10)/e.length-s["border-left-width"].toInt()-s["border-right-width"].toInt()-s["margin-left"].toInt()-s["margin-right"].toInt()-s["padding-left"].toInt()-s["padding-right"].toInt();e.each((function(t){t.setStyle("width",o+"px")}))}else e.each((function(t){t.setStyle("width","auto")}))}}},resizeMessage:function(){this.message&&this.message.resize()},resizeApps:function(){var t=$(document.body).getSize();Object.each(this.apps,function(e,i){var s=e.window.css.to.left.toFloat(),n=e.window.css.to.top.toFloat();s>t.x&&(s=t.x-100),n>t.y&&(n=t.y-100),e.window.css.to.left=s+"px",e.window.css.to.top=n+"px",e.window.css.spacerTo&&(e.window.css.spacerTo.left=s+"px"),e.window.css.spacerTo&&(e.window.css.spacerTo.top=n+"px"),e.window.isHide||(e.window.isMax?e.window.maxSizeIm():e.window.restoreIm())}.bind(this))},loadTop:function(){this.top||(this.top=new MWF.xDesktop.Layout.Top(this.topNode,this),this.top.load())},loadNavi:function(){this.navi||(this.navi=new MWF.xDesktop.Layout.Navi(this.naviNode,this),this.navi.load())},getNodeBackground:function(){MWF.UD.getDataJson("layoutDesktop",function(t){var e=this.css.desktop.background;t&&(currentSrc=t.src,e="url("+MWF.defaultPath+"/xDesktop/$Layout/"+currentSrc+"/desktop.jpg)"),this.node.setStyle("background-image",e)}.bind(this),!1)},changStyle:function(t,e){e?(this.options.style=t,this.options.styleType="custom",MWF.UD.getPublicData(t,function(t){this.css=t.data.desktop,this.windowCss=t.data.window}.bind(this),!1)):(this.options.style=t,this.options.styleType="default",this.cssPath=MWF.defaultPath+"/xDesktop/$Layout/"+this.options.style+"/css.wcss",this._loadCss()),MWF.require("MWF.widget.Mask",function(){window.setTimeout(function(){this.node&&this.node.setStyles(this.css.layoutNode),this.topShimNode&&this.topShimNode.setStyles(this.css.layoutTopShimNode),this.topNode&&this.topNode.setStyles(this.css.layoutTopNode),this.desktopNode&&this.desktopNode.setStyles(this.css.desktopNode),this.contentNode&&this.contentNode.setStyles(this.css.contentNode),this.naviNode&&this.naviNode.setStyles(this.css.naviNode),this.message&&this.message.unreadNode&&(this.message.unreadNode.clearStyles(),this.message.unreadNode.setStyles(this.css.messageUnreadCountNode)),this.getNodeBackground(),this.changeAppsStyle(),this.top&&this.top.changStyle(),this.navi&&this.navi.changStyle(),Object.each(this.apps,(function(t){t.taskitem&&t.taskitem.changStyle()})),this.resizeHeight()}.bind(this),0)}.bind(this))},changeAppsStyle:function(){Object.each(this.apps,function(t,e){t.window.options.style="desktop_"+this.options.style,t.window.changeStyle()}.bind(this))},openProcessApp:function(t,e){var i={id:e.id,appId:"process.Application"+e.id};this.openApplication(t,"process.Application",i)},openQueryApp:function(t,e){var i={id:e.id,appId:"query.Query"+e.id};this.openApplication(t,"query.Query",i)},openPortalApp:function(t,e){var i={portalId:e.id,appId:"portal.Portal"+e.id};this.openApplication(t,"portal.Portal",i)},openCMSApp:function(t,e){var i="cms.Module"+e.id;this.apps[i]?this.apps[i].setCurrent():this.openApplication(t,"cms.Module",{columnData:e,appId:i})},openWidget:function(t,e,i,s,n){this.requireApp(i,function(o){this.widgets[i+e]||this.createNewWidget(t,o,i+e,e,s,n)}.bind(this),e)},openApplication:function(t,e,i,s,n){if("@url"===e.substring(0,4)){var o=e.replace(/\@url\:/i,""),a=new Element("a",{href:o,target:"_blank"});return a.click(),a.destroy(),a=null,!0}var l=e.split("."),c=l[l.length-1];this.requireApp(e,function(e){e.options.multitask?i&&i.appId&&this.apps[i.appId]?this.apps[i.appId].setCurrent():this.createNewApplication(t,e,c,i,s,n):this.apps[c]?this.apps[c].setCurrent():this.createNewApplication(t,e,c,i,s,n)}.bind(this))},createNewWidget:function(t,e,i,s,n,o){var a=new e[s](this,n);a.desktop=this,o&&Object.each(o,(function(t,e){app[e]=t})),a.load(!0);var l=i;n&&n.widgetId&&(l=n.widgetId),a.widgetId=l,this.widgets[l]=a},createNewApplication:function(t,e,i,s,n,o){s?s.event=t:s={event:t};var a=new e.Main(this,s);a.desktop=this,n&&Object.each(n,(function(t,e){a[e]=t})),o?a.inBrowser=!0:a.taskitem=new MWF.xDesktop.Layout.Taskitem(a,this),a.load(!0);var l=i;return s.appId?l=s.appId:e.options.multitask&&(l=l+"-"+new MWF.widget.UUID),a.appId=l,this.apps[l]=a,a},closeApp:function(t){var e=t.appId;this.appCurrentList.erase(t),this.setTaskitemSize(),this.apps[e]=null,delete this.apps[e]},closeWidget:function(t){var e=t.widgetId;delete this.widgets[e]},requireApp:function(t,e,i){var s=t.split("."),n=(s[s.length-1],"MWF.xApplication."+t),o=(MWF.language,MWF.xApplication);s.each(function(t,e){e<s.length-1?o[t]=o[t]||{}:o[t]=o[t]||{options:Object.clone(MWF.xApplication.Common.options)},o=o[t]}.bind(this)),o.options||(o.options=Object.clone(MWF.xApplication.Common.options)),MWF.xDesktop.requireApp(t,"lp."+MWF.language,{onRequestFailure:function(){MWF.xDesktop.requireApp(t,"lp.zh-cn",null,!1)}.bind(this),onSuccess:function(){}.bind(this)},!1),MWF.xDesktop.requireApp(t,i,(function(){e&&e(o)}))},playMessageAudio:function(){var t=!0;this.playMessageAudioTime&&((new Date).getTime()-this.playMessageAudioTime.getTime()<5e3&&(t=!1));if(t){if(!this.messageAudioNode){var e=MWF.defaultPath+"/xDesktop/$Layout/"+layout.desktop.options.style+"/sound/message.wav",i=MWF.defaultPath+"/xDesktop/$Layout/"+layout.desktop.options.style+"/sound/message.mp3";this.messageAudioNode=new Element("div",{html:'<audio autoplay="autoplay" volume=0.6 preload="metadata"><source src="'+e+'" type="audio/x-wav"><source src="'+i+'" type="audio/mpeg"></source></audio>',styles:{display:"none"}}).inject(this.node),this.messageAudio=this.messageAudioNode.getFirst()}this.messageAudio.play(),this.playMessageAudioTime=new Date}},logout:function(){this.isLogout=!0,this.notRecordStatus?(layout.authentication||new o2.xDesktop.Authentication).logout():this.recordDesktopStatus(function(){(layout.authentication||new o2.xDesktop.Authentication).logout()}.bind(this.layout))}}),MWF.xDesktop.Layout.Taskitem=new Class({initialize:function(t,e){this.layout=e,this.app=t,this.node=new Element("div",{styles:this.layout.css.taskItemNode,title:this.app.options.title+(this.app.appId?"-"+this.app.appId:"")}).inject(this.layout.top.taskbar),this.iconNode=new Element("div",{styles:this.layout.css.taskItemIconNode}).inject(this.node),this.iconNode.setStyle("background-image","url("+this.app.options.icon+")"),this.closeNode=new Element("div",{styles:this.layout.css.taskItemCloseNode}).inject(this.node),this.textNode=new Element("div",{styles:this.layout.css.taskItemTextNode}).inject(this.node),this.textNode.set("text",this.app.options.title),this.setTaskitemSize(),this.setEvent()},setTaskitemSize:function(){var t=this.layout.top.taskbar.getSize(),e=this.layout.top.taskbar.getChildren(),i=0;if(e.length){for(var s=e[0].getStyles("border-left-width","border-right-width","margin-left","margin-right","padding-left","padding-right"),n=0;n<e.length;n++)e[n].setStyle("width","auto"),i+=e[n].getSize().x+s["border-left-width"].toInt()+s["border-right-width"].toInt()+s["margin-left"].toInt()+s["margin-right"].toInt()+s["padding-left"].toInt()+s["padding-right"].toInt();if(i>t.x-10){var o=(t.x-10)/e.length-s["border-left-width"].toInt()-s["border-right-width"].toInt()-s["margin-left"].toInt()-s["margin-right"].toInt()-s["padding-left"].toInt()-s["padding-right"].toInt();e.each((function(t){t.setStyle("width",o+"px")}))}else e.each((function(t){t.setStyle("width","auto")}))}},setText:function(t){this.textNode.set("text",t||this.app.options.title)},setEvent:function(){this.textNode.addEvents({mouseover:function(){this.layout.currentApp&&this.layout.currentApp.taskitem==this||this.node.setStyles(this.layout.css.taskItemNode_over)}.bind(this),mouseout:function(){this.layout.currentApp&&this.layout.currentApp.taskitem==this||this.node.setStyles(this.layout.css.taskItemNode)}.bind(this),mousedown:function(){this.layout.currentApp&&this.layout.currentApp.taskitem==this||this.node.setStyles(this.layout.css.taskItemNode_down)}.bind(this),mouseup:function(){this.layout.currentApp&&this.layout.currentApp.taskitem==this||this.node.setStyles(this.layout.css.taskItemNode_over)}.bind(this),click:function(){this.layout.currentApp==this.app?this.app.minSize():this.app.setCurrent()}.bind(this)}),this.iconNode.addEvents({mouseover:function(){this.layout.currentApp&&this.layout.currentApp.taskitem==this||this.node.setStyles(this.layout.css.taskItemNode_over)}.bind(this),mouseout:function(){this.layout.currentApp&&this.layout.currentApp.taskitem==this||this.node.setStyles(this.layout.css.taskItemNode)}.bind(this),mousedown:function(){this.layout.currentApp&&this.layout.currentApp.taskitem==this||this.node.setStyles(this.layout.css.taskItemNode_down)}.bind(this),mouseup:function(){this.layout.currentApp&&this.layout.currentApp.taskitem==this||this.node.setStyles(this.layout.css.taskItemNode_over)}.bind(this),click:function(){this.layout.currentApp==this.app?this.app.minSize():this.app.setCurrent()}.bind(this)}),this.node.addEvents({mouseover:function(){this.closeNode.fade("in")}.bind(this),mouseout:function(){this.closeNode.fade("out")}.bind(this)}),this.closeNode.addEvent("click",function(){this.app.close()}.bind(this))},selected:function(){this.node.setStyles(this.layout.css.taskItemNode_current)},unSelected:function(){this.node.setStyles(this.layout.css.taskItemNode)},changStyle:function(){this.node&&(this.layout.currentApp&&this.layout.currentApp.taskitem==this?(this.node.setStyles(this.layout.css.taskItemNode),this.node.setStyles(this.layout.css.taskItemNode_current)):this.node.setStyles(this.layout.css.taskItemNode)),this.iconNode&&this.iconNode.setStyles(this.layout.css.taskItemIconNode),this.textNode&&this.textNode.setStyles(this.layout.css.taskItemTextNode)},destroy:function(){this.node.destroy(),o2.release(this)}}),MWF.xDesktop.Layout.Top=new Class({initialize:function(t,e){this.layout=e,this.node=$(t),this.userApplicationsLog=[],this.sysApplicationsLog=[]},load:function(){this.loadMenuAction(),this.loadSeparate(),this.loadShowDesktop(),this.loadClock(),this.loadSeparate("right"),this.loadUserMenu(),this.loadStyleAction(),this.loadUserChat(),this.loadMessageAction(),this.loadSeparate("right"),this.loadTaskbar()},loadMenuAction:function(){this.loadMenuAction=new Element("div",{styles:this.layout.css.loadMenuAction,title:MWF.LP.desktop.menuAction}).inject(this.node),this.loadMenuAction.addEvent("click",function(){this.loadMenu()}.bind(this))},loadShowDesktop:function(){this.showDesktopAction=new Element("div",{styles:this.layout.css.showDesktopAction}).inject(this.node),this.showDesktopAction.addEvents({mouseover:function(){this.showDesktopAction.setStyles(this.layout.css.showDesktopAction_over)}.bind(this),mouseout:function(){this.showDesktopAction.setStyles(this.layout.css.showDesktopAction)}.bind(this),click:function(){var t=!0;Object.each(this.layout.apps,function(e,i){e.window.isHide||(t=!1,e.minSize())}.bind(this)),t&&Object.each(this.layout.apps,function(t,e){t.setCurrent()}.bind(this))}.bind(this)})},loadMenu:function(){this.createApplicationMenuArea(),this.showApplicationMenu(),window.setTimeout(function(){o2.require("o2.widget.PinYin",null,!1),this.getApplicationsCatalogue(function(t){var e=this.layout.session.user,i=[e.name,e.distinguishedName,e.id,e.unique];e.roleList&&(i=i.concat(e.roleList)),e.groupList&&(i=i.concat(e.groupList)),t.each(function(t,e){var s=!0;t.allowList&&(s=!t.allowList.length||t.allowList.isIntersect(i));var n=!1;t.denyList&&(n=!!t.denyList.length&&t.denyList.isIntersect(i)),(!n&&s||MWF.AC.isAdministrator())&&this.createApplicationMenu(t,e)}.bind(this)),this.getComponentList(function(t){t.data.each(function(t,e){if(t.visible){var s=!t.allowList.length||t.allowList.isIntersect(i);(!(!!t.denyList.length&&t.denyList.isIntersect(i))&&s||MWF.AC.isAdministrator())&&this.createApplicationMenu(t,e)}}.bind(this))}.bind(this)),new MWF.xDesktop.Actions.RestActions("/xDesktop/Actions/action.json","x_portal_assemble_surface").invoke({name:"listPortalApplication",success:function(t){t.data&&t.data.each(function(t){this.createPortalAppMenu(t)}.bind(this))}.bind(this)})}.bind(this)),this.getProcessApplications(function(t){}.bind(this))}.bind(this),0)},showApplicationMenu:function(){this.applicationMenuAreaMark.fade(.7),this.applicationMenuArea.fade("in")},closeApplicationMenu:function(){this.applicationMenuSearchBar&&this.closeApplicationMenuSearchBar(),this.isApplicationMenuScroll||(this.applicationMenuAreaMark.destroy(),this.applicationMenuArea.destroy(),this.applicationMenuFxScroll=null,this.userApplicationsLog=[],this.sysApplicationsLog=[],this.layout.removeEvent("resize",this.resizeApplicationMenuSizeFun)),this.currentApplicationMenuContent="app",this.isApplicationMenuScroll=!1,this.closeApplicationMenuFun&&document.body.removeEvent("keydown",this.closeApplicationMenuFun)},closeApplicationMenuEsc:function(t){"esc"===t.key&&(this.applicationMenuSearchBar||this.closeApplicationMenu())},createCMSAppMenu:function(t){var e=new Element("div",{styles:this.layout.css.applicationMenuNode,title:t.appName}).inject(this.applicationMenuProcessArea);this.userApplicationsLog.push({node:e,py:t.appName.toPY().toLowerCase(),name:t.appName.toLowerCase(),first:t.appName.toPYFirst().toLowerCase()});var i=new Element("div",{styles:this.layout.css.applicationMenuIconNode}).inject(e),s="";s=t.appIcon?"url(data:image/png;base64,"+t.appIcon+")":"url(../x_component_cms_Index/$Main/default/icon/column.png)",i.setStyle("background-image",s),new Element("div",{styles:this.layout.css.applicationMenuTextNode,text:t.appName}).inject(e),e.addEvent("click",function(e){this.layout.openCMSApp(e,t),this.closeApplicationMenu()}.bind(this)),e.makeLnk({par:{icon:s,title:t.name,par:'cms.Module#{"columnId": "'+t.id+'", "appId": "cms.Module'+t.id+'"}'},onStart:function(){this.applicationMenuAreaMark.fade("out"),this.applicationMenuArea.fade("out")}.bind(this),onComplete:function(){this.showApplicationMenu()}.bind(this)})},createPortalAppMenu:function(t){var e=new Element("div",{styles:this.layout.css.applicationMenuNode,title:t.name}).inject(this.applicationMenuAppIconArea);this.userApplicationsLog.push({node:e,py:t.name.toPY().toLowerCase(),name:t.name.toLowerCase(),first:t.name.toPYFirst().toLowerCase()});var i=new Element("div",{styles:this.layout.css.applicationMenuIconNode}).inject(e),s="";s=t.icon?"url(data:image/png;base64,"+t.icon+")":"url(../x_component_portal_PortalExplorer/$Main/default/icon/application.png)",i.setStyle("background-image",s),new Element("div",{styles:this.layout.css.applicationMenuTextNode,text:t.name}).inject(e),e.addEvent("click",function(e){this.layout.openPortalApp(e,t),this.closeApplicationMenu()}.bind(this)),e.makeLnk({par:{icon:s,title:t.name,par:'portal.Portal#{"portalId": "'+t.id+'", "appId": "portal.Portal'+t.id+'"}'},onStart:function(){this.applicationMenuAreaMark.fade("out"),this.applicationMenuArea.fade("out")}.bind(this),onComplete:function(){this.showApplicationMenu()}.bind(this)})},createQueryAppMenu:function(t){var e=new Element("div",{styles:this.layout.css.applicationMenuNode,title:t.name}).inject(this.applicationMenuProcessArea);this.userApplicationsLog.push({node:e,py:t.name.toPY().toLowerCase(),name:t.name.toLowerCase(),first:t.name.toPYFirst().toLowerCase()});var i=new Element("div",{styles:this.layout.css.applicationMenuIconNode}).inject(e),s="";s=t.icon?"url(data:image/png;base64,"+t.icon+")":"url(../x_component_query_Query/$Main/appicon.png)",i.setStyle("background-image",s),new Element("div",{styles:this.layout.css.applicationMenuTextNode,text:t.name}).inject(e),e.addEvent("click",function(e){this.layout.openQueryApp(e,t),this.closeApplicationMenu()}.bind(this)),e.makeLnk({par:{icon:s,title:t.name,par:'query.Query#{"id": "'+t.id+'", "appId": "query.Query'+t.id+'"}'},onStart:function(){this.applicationMenuAreaMark.fade("out"),this.applicationMenuArea.fade("out")}.bind(this),onComplete:function(){this.showApplicationMenu()}.bind(this)})},createProcessAppMenu:function(t){var e=new Element("div",{styles:this.layout.css.applicationMenuNode,title:t.name}).inject(this.applicationMenuProcessArea);this.userApplicationsLog.push({node:e,py:t.name.toPY().toLowerCase(),name:t.name.toLowerCase(),first:t.name.toPYFirst().toLowerCase()});var i=new Element("div",{styles:this.layout.css.applicationMenuIconNode}).inject(e),s="";s=t.icon?"url(data:image/png;base64,"+t.icon+")":"url(../x_component_process_ApplicationExplorer/$Main/default/icon/application.png)",i.setStyle("background-image",s),new Element("div",{styles:this.layout.css.applicationMenuTextNode,text:t.name}).inject(e),e.addEvent("click",function(e){this.layout.openProcessApp(e,t),this.closeApplicationMenu()}.bind(this)),e.makeLnk({par:{icon:s,title:t.name,par:'process.Application#{"id": "'+t.id+'", "appId": "process.Application'+t.id+'"}'},onStart:function(){this.applicationMenuAreaMark.fade("out"),this.applicationMenuArea.fade("out")}.bind(this),onComplete:function(){this.showApplicationMenu()}.bind(this)})},createApplicationMenu:function(t,e){var i=new Element("div",{styles:this.layout.css.applicationMenuNode,title:t.title}).inject(this.applicationMenuAppIconArea);this.sysApplicationsLog.push({node:i,py:t.title.toPY().toLowerCase(),name:t.title.toLowerCase(),first:t.title.toPYFirst().toLowerCase()});var s,n=new Element("div",{styles:this.layout.css.applicationMenuIconNode}).inject(i);s="@url"===t.path.substring(0,4)?t.iconPath?t.iconPath:"../x_component_Setting/$Main/default/icon/site.png":"../x_component_"+t.path.replace(/\./g,"_")+"/$Main/"+t.iconPath,n.setStyle("background-image","url("+s+")"),new Element("div",{styles:this.layout.css.applicationMenuTextNode,text:t.title}).inject(i),i.addEvent("click",function(e){this.layout.openApplication(e,t.path),this.closeApplicationMenu()}.bind(this)),i.makeLnk({par:{icon:s,title:t.title,par:t.path},onStart:function(){this.applicationMenuAreaMark.fade("out"),this.applicationMenuArea.fade("out")}.bind(this),onComplete:function(){this.showApplicationMenu()}.bind(this)});t.path},createApplicationWidgetMenu:function(t,e,i,s){var n=new Element("div",{styles:this.layout.css.widgetMenuNode,title:e}).inject(this.applicationMenuWidgetArea),o=new Element("div",{styles:this.layout.css.widgetMenuIconNode}).inject(n);i="../x_component_"+s.replace(/\./g,"_")+"/$"+t+"/"+i;o.setStyle("background-image","url("+i+")"),new Element("div",{styles:this.layout.css.applicationMenuTextNode,text:e}).inject(n),n.addEvent("click",function(e){this.layout.openWidget(e,t,s),this.closeApplicationMenu()}.bind(this))},createApplicationMenuArea:function(){var t=MWF.xDesktop.zIndexPool.zIndex;this.applicationMenuAreaMark=new Element("iframe",{styles:this.layout.css.applicationMenuAreaMark}).inject(this.layout.node),this.applicationMenuAreaMark.setStyle("z-index",t),this.applicationMenuArea=new Element("div",{styles:this.layout.css.applicationMenuArea}).inject(this.layout.node),this.applicationMenuArea.setStyle("z-index",t+1),this.applicationMenuLeftAction=new Element("div",{styles:this.layout.css.applicationMenuLeftAction}).inject(this.applicationMenuArea),this.applicationMenuRightAction=new Element("div",{styles:this.layout.css.applicationMenuRightAction}).inject(this.applicationMenuArea),this.applicationMenuScrollArea=new Element("div",{styles:this.layout.css.applicationMenuScrollArea}).inject(this.applicationMenuArea),this.applicationMenuContentArea=new Element("div",{styles:this.layout.css.applicationMenuContentArea}).inject(this.applicationMenuScrollArea),this.applicationMemuAppContent=new Element("div",{styles:this.layout.css.applicationMemuAppContent}).inject(this.applicationMenuContentArea),this.applicationMenuAppTitleArea=new Element("div",{styles:this.layout.css.applicationMenuAppTitleArea,text:MWF.LP.desktop.application}).inject(this.applicationMemuAppContent),this.applicationMenuAppIconScrollArea=new Element("div",{styles:this.layout.css.applicationMenuAppIconScrollArea}).inject(this.applicationMemuAppContent),this.applicationMenuAppIconArea=new Element("div",{styles:this.layout.css.applicationMenuAppIconArea}).inject(this.applicationMenuAppIconScrollArea),this.applicationMemuProcessContent=new Element("div",{styles:this.layout.css.applicationMemuProcessContent}).inject(this.applicationMenuContentArea),this.applicationMenuProcessTitleArea=new Element("div",{styles:this.layout.css.applicationMenuProcessTitleArea,text:MWF.LP.desktop.process}).inject(this.applicationMemuProcessContent),this.applicationMenuProcessScrollArea=new Element("div",{styles:this.layout.css.applicationMenuProcessScrollArea}).inject(this.applicationMemuProcessContent),this.applicationMenuProcessArea=new Element("div",{styles:this.layout.css.applicationMenuProcessArea}).inject(this.applicationMenuProcessScrollArea),this.setApplicationMenuSize(),this.setApplicationMenuEvent()},setApplicationMenuSize:function(){this.resizeApplicationMenuSize(),this.resizeApplicationMenuSizeFun=this.resizeApplicationMenuSize.bind(this),this.layout.addEvent("resize",this.resizeApplicationMenuSizeFun)},resizeApplicationMenuSize:function(){var t=this.applicationMenuScrollArea.getSize();this.applicationMemuAppContent.setStyle("width",t.x+"px"),this.applicationMemuProcessContent.setStyle("width",t.x+"px");var e=2*t.x;this.applicationMenuContentArea.setStyle("width",e+"px");var i=this.applicationMenuArea.getSize(),s=this.applicationMenuAppTitleArea.getSize(),n=this.applicationMenuAppTitleArea.getStyle("margin-top").toInt(),o=this.applicationMenuAppTitleArea.getStyle("margin-bottom").toInt(),a=this.applicationMenuAppIconScrollArea.getStyle("margin-top").toInt(),l=this.applicationMenuAppIconScrollArea.getStyle("margin-bottom").toInt(),c=i.y-s.y-n-o-a-l;this.applicationMenuAppIconScrollArea.setStyle("height",c+"px"),s=this.applicationMenuProcessTitleArea.getSize(),n=this.applicationMenuProcessTitleArea.getStyle("margin-top").toInt(),o=this.applicationMenuProcessTitleArea.getStyle("margin-bottom").toInt(),a=this.applicationMenuProcessScrollArea.getStyle("margin-top").toInt(),l=this.applicationMenuProcessScrollArea.getStyle("margin-bottom").toInt(),c=i.y-s.y-n-o-a-l,this.applicationMenuProcessScrollArea.setStyle("height",c+"px")},setApplicationMenuEvent:function(){MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.applicationMenuAppIconScrollArea,{style:"xDesktop_Menu",where:"after",distance:30,friction:4,axis:{x:!1,y:!0},onScrollStart:function(){this.isApplicationMenuScroll=!0}.bind(this)}),new MWF.widget.ScrollBar(this.applicationMenuProcessScrollArea,{style:"xDesktop_Menu",where:"after",distance:30,friction:4,axis:{x:!1,y:!0},onScrollStart:function(){this.isApplicationMenuScroll=!0}.bind(this)})}.bind(this)),this.applicationMenuRightAction.addEvent("click",function(t){this.closeApplicationMenuSearchBar(),this.currentApplicationMenuContent||(this.currentApplicationMenuContent="app");var e="",i=null,s=null;"app"==this.currentApplicationMenuContent&&(i=this.applicationMemuProcessContent,e="process",s=this.applicationMemuAppContent),"process"==this.currentApplicationMenuContent&&(i=this.applicationMemuAppContent,e="app",s=this.applicationMemuProcessContent),this.applicationMenuFxScroll||(this.applicationMenuFxScroll=new Fx.Scroll(this.applicationMenuScrollArea,{wheelStops:!1})),i.inject(s,"after"),this.applicationMenuFxScroll.set(0),this.applicationMenuFxScroll.toElement(i,"x").chain(function(){}.bind(this)),this.currentApplicationMenuContent=e,t.stopPropagation()}.bind(this)),this.applicationMenuLeftAction.addEvent("click",function(t){this.closeApplicationMenuSearchBar(),this.currentApplicationMenuContent||(this.currentApplicationMenuContent="app");var e="",i=null,s=null;"app"==this.currentApplicationMenuContent&&(i=this.applicationMemuProcessContent,e="process",s=this.applicationMemuAppContent),"process"==this.currentApplicationMenuContent&&(i=this.applicationMemuAppContent,e="app",s=this.applicationMemuProcessContent),this.applicationMenuFxScroll||(this.applicationMenuFxScroll=new Fx.Scroll(this.applicationMenuScrollArea,{wheelStops:!1})),i.inject(s,"before"),this.applicationMenuFxScroll.set(this.applicationMenuScrollArea.getScrollSize().x),this.applicationMenuFxScroll.toElement(i),this.currentApplicationMenuContent=e,t.stopPropagation()}.bind(this)),this.applicationMenuArea.addEvent("click",function(){this.closeApplicationMenu()}.bind(this)),this.closeApplicationMenuFun=this.closeApplicationMenuEsc.bind(this),document.body.addEvent("keydown",this.closeApplicationMenuFun),this.showApplicationSearchFun=this.showApplicationSearch.bind(this),document.body.addEvent("keydown",this.showApplicationSearchFun)},showApplicationSearch:function(t){"esc"===t.key?this.applicationMenuSearchBar&&this.closeApplicationMenuSearchBar():this.applicationMenuSearchBar||this.createApplicationMenuSearchBar(t)},closeApplicationMenuSearchBar:function(){this.applicationMenuSearchBar&&(this.applicationMenuSearchBar.destroy(),this.applicationMenuSearchBar=null,"process"!==this.currentApplicationMenuContent&&this.currentApplicationMenuContent||this.userApplicationsLog.each(function(t){t.node.setStyle("display","block")}.bind(this)),"app"===this.currentApplicationMenuContent&&this.sysApplicationsLog.each(function(t){t.node.setStyle("display","block")}.bind(this)))},createApplicationMenuSearchBar:function(t){this.applicationMenuSearchBar=new Element("div",{styles:this.layout.css.applicationMenuSearchBar}).inject(this.applicationMenuArea),this.applicationMenuSearchBarBox=new Element("div",{styles:this.layout.css.applicationMenuSearchBarBox}).inject(this.applicationMenuSearchBar),this.applicationMenuSearchBarClose=new Element("div",{styles:this.layout.css.applicationMenuSearchBarClose}).inject(this.applicationMenuSearchBarBox),this.applicationMenuSearchBarInputBox=new Element("div",{styles:this.layout.css.applicationMenuSearchBarInputBox}).inject(this.applicationMenuSearchBarBox),this.applicationMenuSearchBarInput=new Element("input",{styles:this.layout.css.applicationMenuSearchBarInput}).inject(this.applicationMenuSearchBarInputBox),this.applicationMenuSearchBarInput.focus(),this.applicationMenuSearchBarInput.addEvent("keydown",function(t){"esc"===t.key&&this.closeApplicationMenuSearchBar(),"enter"===t.key&&this.doApplicationMenuSearch(),t.stopPropagation()}.bind(this)),this.applicationMenuSearchBarInput.addEvent("click",function(t){t.stopPropagation()}.bind(this)),this.applicationMenuSearchBarClose.addEvent("click",function(t){this.closeApplicationMenuSearchBar()}.bind(this))},doApplicationMenuSearch:function(){var t=this.applicationMenuSearchBarInput.get("value").toLowerCase();t&&("process"!==this.currentApplicationMenuContent&&this.currentApplicationMenuContent||this.userApplicationsLog.each(function(e){-1===e.py.indexOf(t)&&-1===e.first.indexOf(t)&&-1===e.name.indexOf(t)?e.node.setStyle("display","none"):e.node.setStyle("display","block")}.bind(this)),"app"===this.currentApplicationMenuContent&&this.sysApplicationsLog.each(function(e){-1===e.py.indexOf(t)&&-1===e.first.indexOf(t)&&-1===e.name.indexOf(t)?e.node.setStyle("display","none"):e.node.setStyle("display","block")}.bind(this)))},getApplicationsCatalogue:function(t){var e=MWF.defaultPath+"/xDesktop/$Layout/applications.json";MWF.getJSON(e,function(e){t&&t(e)}.bind(this))},getProcessApplications:function(t){action=new MWF.xDesktop.Actions.RestActions("/xDesktop/Actions/action.json","x_processplatform_assemble_surface"),action.invoke({name:"listApplication",success:function(t){t.data&&t.data.each(function(t){this.createProcessAppMenu(t)}.bind(this))}.bind(this)}),action=new MWF.xDesktop.Actions.RestActions("/xDesktop/Actions/action.json","x_cms_assemble_control"),action.invoke({name:"listCMSApplication",success:function(t){t.data&&t.data.each(function(t){t.name=t.appName,t.icon=t.appIcon,this.createCMSAppMenu(t)}.bind(this))}.bind(this)}),action=MWF.Actions.get("x_query_assemble_surface"),action.listQuery(function(t){t.data&&t.data.each(function(t){this.createQueryAppMenu(t)}.bind(this))}.bind(this))},getComponentList:function(t){new MWF.xDesktop.Actions.RestActions("/xDesktop/Actions/action.json","x_component_assemble_control").invoke({name:"listComponent",success:function(e){t&&t(e)}.bind(this)})},loadConfigAction:function(){this.configActionNode=new Element("div",{styles:this.layout.css.configActionNode,title:MWF.LP.desktop.configAction}).inject(this.node),this.configActionNode.addEvent("click",(function(){alert("show config")}))},loadSeparate:function(t){var e=new Element("div.separateNode",{styles:this.layout.css.separateNode}).inject(this.node);t&&e.setStyle("float",t)},loadTaskbar:function(){this.taskbar=new Element("div",{styles:this.layout.css.taskbar}).inject(this.node)},loadUserChat:function(){this.userChatNode=new Element("div",{styles:this.layout.css.userChatNode,title:MWF.LP.desktop.userChat}).inject(this.node),this.userChatNode.addEvents({mouseover:function(){this.layout.css.userChatNode_over&&this.userChatNode.setStyles(this.layout.css.userChatNode_over)}.bind(this),mouseout:function(){this.userChatNode.setStyles(this.layout.css.userChatNode)}.bind(this)}),this.userChatNode.addEvent("click",function(t){return this.userConfig(),!1}.bind(this))},userConfig:function(t){this.layout.openApplication(t,"Profile")},logout:function(){this.layout.isLogout=!0,this.notRecordStatus?(layout.authentication||new o2.xDesktop.Authentication).logout():this.layout.recordDesktopStatus(function(){(layout.authentication||new o2.xDesktop.Authentication).logout()}.bind(this.layout))},loadStyleAction:function(){this.styleActionNode=new Element("div",{styles:this.layout.css.styleActionNode,title:MWF.LP.desktop.styleAction}).inject(this.node),this.styleActionNode.addEvents({mouseover:function(){this.layout.css.styleActionNode_over&&this.styleActionNode.setStyles(this.layout.css.styleActionNode_over)}.bind(this),mouseout:function(){this.styleActionNode.setStyles(this.layout.css.styleActionNode)}.bind(this)}),this.setChangeStyle()},setChangeStyle:function(){this.styleMenu||(this.styleMenu=new MWF.xDesktop.Menu(this.styleActionNode,{event:"click",style:"desktopStyle",offsetX:-60,offsetY:10,container:this.layout.node,onQueryShow:function(){this.styleMenu.items.each(function(t){this.layout.options.style==t.styleName?t.setDisable(!0):t.setDisable(!1)}.bind(this))}.bind(this)}),this.styleMenu.load(),MWF.UD.getPublicData("indexThemes",function(t){MWF.getJSON(this.layout.path+"styles.json",function(e){e.each(function(e){if(!t||-1!=t.indexOf(e.style)){var i=MWF.defaultPath+"/xDesktop/$Layout/"+e.style+"/preview.jpg";this.styleMenu.addMenuItem(e.title,"click",function(){this.changeLayoutStyle(e.style)}.bind(this),i).styleName=e.style}}.bind(this))}.bind(this)),MWF.UD.getPublicData("indexStyleList",function(t){this.indexStyleList=t,this.indexStyleList||(this.indexStyleList={styleList:[]}),this.indexStyleList.styleList.each(function(t){if(t.enabled){var e=t.preview;this.styleMenu.addMenuItem(t.title,"click",function(){this.changeLayoutStyle(t.id,!0)}.bind(this),e).styleName=t.id}}.bind(this)),this.styleMenu.addMenuLine();var e=this.styleMenu.addMenuItem(o2.LP.flat_style,"click",function(t){this.changeToFlatStyle(t)}.bind(this)),i=e.item.getFirst();new Element("div",{styles:e.menu.css.menuItemImg}).inject(i).setStyle("background-color","#4A90E2")}.bind(this))}.bind(this)))},changeToFlatStyle:function(t){var e=new URI(window.location.href);e.setData("view","default"),e.go()},changeLayoutStyle:function(t,e){MWF.UD.deleteData("layoutDesktop",function(){this.layout.changStyle(t,e)}.bind(this))},loadMessageAction:function(){this.messageActionNode=new Element("div",{styles:this.layout.css.messageActionNode,title:MWF.LP.desktop.showMessage}).inject(this.node),this.messageActionNode.addEvents({mouseover:function(){this.layout.css.messageActionNode_over&&this.messageActionNode.setStyles(this.layout.css.messageActionNode_over)}.bind(this),mouseout:function(){this.messageActionNode.setStyles(this.layout.css.messageActionNode)}.bind(this)}),this.layout.message=new MWF.xDesktop.Message(this.layout),this.layout.message.load(),this.messageActionNode.addEvent("click",function(){this.showDesktopMessage()}.bind(this))},showDesktopMessage:function(){this.layout.message.isShow||this.layout.message.show()},loadUserMenu:function(){this.userMenuNode=new Element("div",{styles:this.layout.css.userMenuNode,title:MWF.LP.desktop.userMenu}).inject(this.node),this.userMenuNode.addEvents({mouseover:function(){this.layout.css.userMenuNode_over&&this.userMenuNode.setStyles(this.layout.css.userMenuNode_over)}.bind(this),mouseout:function(){this.userMenuNode.setStyles(this.layout.css.userMenuNode)}.bind(this)}),this.userMenu=new MWF.xDesktop.Menu(this.userMenuNode,{event:"click",style:"desktopUser",offsetX:-10,offsetY:10,container:this.layout.node}),this.userMenu.load();var t=MWF.defaultPath+"/xDesktop/$Layout/"+this.layout.options.style+"/usermenu/config.png";this.userMenu.addMenuItem(MWF.LP.desktop.userConfig,"click",function(t){this.userConfig(t)}.bind(this),t),this.userMenu.addMenuLine(),t=MWF.defaultPath+"/xDesktop/$Layout/"+this.layout.options.style+"/usermenu/logout.png",this.userMenu.addMenuItem(MWF.LP.desktop.logout,"click",function(){this.logout()}.bind(this),t)},loadClock:function(){this.clockNode=new Element("div",{styles:this.layout.css.clockNode}).inject(this.node),this.setTime()},setTime:function(){var t=new Date,e=1e3-t.getMilliseconds(),i=60-t.getSeconds(),s=t.format("%Y/%m/%d#%H:%M");dl=s.split("#"),this.clockNode.set("html",dl[1]+"<br/>"+dl[0]),window.setTimeout(this.setTime.bind(this),1e3*i+e)},changStyle:function(){this.loadMenuAction&&this.loadMenuAction.setStyles(this.layout.css.loadMenuAction),this.configActionNode&&this.configActionNode.setStyles(this.layout.css.configActionNode);var t=this.layout.css.separateNode;delete t.float,this.node.getElements(".separateNode").setStyles(t),this.userChatNode&&this.userChatNode.setStyles(this.layout.css.userChatNode),this.styleActionNode&&this.styleActionNode.setStyles(this.layout.css.styleActionNode),this.messageActionNode&&this.messageActionNode.setStyles(this.layout.css.messageActionNode),this.clockNode&&this.clockNode.setStyles(this.layout.css.clockNode),this.userMenuNode&&this.userMenuNode.setStyles(this.layout.css.userMenuNode),this.styleActionNode&&this.styleActionNode.setStyles(this.layout.css.styleActionNode),this.userActionNode&&this.userActionNode.setStyles(this.layout.css.userActionNode),this.taskbar&&this.taskbar.setStyles(this.layout.css.taskbar),this.userPanel&&this.userPanel.changStyle(this.layout.options.style)}}),MWF.xDesktop.Layout.Navi=new Class({initialize:function(t,e){this.layout=e,this.node=$(t),this.navis=[]},load:function(){this.createNaviArea(),this.loadNavis()},createNaviArea:function(){this.naviNodeBottomArea=new Element("div",{styles:this.layout.css.naviNodeBottomArea}).inject(this.node),this.naviNodeArea=new Element("div",{styles:this.layout.css.naviNodeArea}).inject(this.node)},editQuickNavi:function(){},loadNavis:function(){MWF.getJSON(this.layout.path+"quickStart.json",function(t){t.navi.each(function(t){this.navis.push(this.createNaviNode(t))}.bind(this))}.bind(this))},createNaviNode:function(t){var e=new Element("div",{styles:this.layout.css.mainNaviNode}).inject(this.naviNodeArea);e.store("navi",t),new Element("div",{styles:this.layout.css.mainNaviIconNode}).inject(e).setStyle("background-image","url("+MWF.defaultPath+"/xDesktop/$Layout/"+this.layout.options.style+"/navi/"+t.icon+")"),new Element("div",{styles:this.layout.css.mainNaviTextNode,text:t.title}).inject(e);var i=this;return e.addEvents({mouseover:function(){var t=this.retrieve("navi");this.setStyle("background","#CCC");var e=t.icon.replace(".","_over.");this.getFirst("div").setStyle("background-image","url("+MWF.defaultPath+"/xDesktop/$Layout/"+i.layout.options.style+"/navi/"+e+")"),this.getLast("div").setStyle("color","#444")},mouseout:function(){this.setStyle("background","transparent");var t=this.retrieve("navi");this.setStyle("background","transparent"),this.getFirst("div").setStyle("background-image","url("+MWF.defaultPath+"/xDesktop/$Layout/"+i.layout.options.style+"/navi/"+t.icon+")"),this.getLast("div").setStyle("color","#FFF")},mousedown:function(){this.setStyle("background","#FFF")},mouseup:function(){this.setStyle("background","#CCC")},click:function(t){var e=this.retrieve("navi");i.layout.openApplication(t,e.action)}}),e},changStyle:function(){this.naviNodeBottomArea&&this.naviNodeBottomArea.setStyles(this.layout.css.naviNodeBottomArea),this.naviNodeArea&&this.naviNodeArea.setStyles(this.layout.css.naviNodeArea),this.navis.each(function(t){t.setStyles(this.layout.css.mainNaviNode),t.getFirst("div").setStyles(this.layout.css.mainNaviIconNode),t.getLast("div").setStyles(this.layout.css.mainNaviTextNode)}.bind(this))}}),MWF.xDesktop.zIndexPool={zIndex:100,applyZindex:function(){var t=this.zIndex;return this.zIndex=this.zIndex+2,t}};