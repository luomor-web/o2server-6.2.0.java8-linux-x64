MWF.xDesktop.requireApp("process.TaskCenter","List",null,!1),MWF.xApplication.process.TaskCenter.TaskCompletedList=new Class({Extends:MWF.xApplication.process.TaskCenter.List,createAppFilterNodes:function(){var t={name:this.app.lp.all,application:"",count:0};this.allAppFilterNode=this.createAppFilterNode(t,"appFilterNode_current"),this.currentFilterNode=this.allAppFilterNode,this.filterListNode=new Element("div",{styles:this.css.filterListNode}).inject(this.applicationFilterAreaNode)},createFilterItemNode:function(t,e){var i=this,s=new Element("div",{styles:this.css.filterListItemNode}).inject(this.filterListNode),o=new Element("div",{styles:this.css.filterListItemActionNode}).inject(s);new Element("div",{styles:this.css.filterListItemTextNode}).inject(s).set("text",this.app.lp[t]+": "+e.name),o.store("key",t),s.addEvents({mouseover:function(){this.setStyles(i.css.filterListItemNode_over),this.getLast().setStyles(i.css.filterListItemTextNode_over),this.getFirst().setStyles(i.css.filterListItemActionNode_over)},mouseout:function(){this.setStyles(i.css.filterListItemNode),this.getLast().setStyles(i.css.filterListItemTextNode),this.getFirst().setStyles(i.css.filterListItemActionNode)}}),o.addEvent("click",(function(){var t=this.retrieve("key");i.filterData[t]&&(i.filterData[t]=null),delete i.filterData[t],this.destroy(),i.refilter()}))},_getCurrentPageData:function(t,e){this.app.getAction(function(){if(this.filterData){this.filterListNode.empty();var i={};Object.each(this.filterData,function(t,e){"key"!==e?t&&(i[this.app.options.filterMap[e]]||(i[this.app.options.filterMap[e]]=[]),i[this.app.options.filterMap[e]].push(t.value),this.createFilterItemNode(e,t)):i.key=t}.bind(this)),this.filterData.key&&this.createFilterItemNode("key",{name:this.filterData.key});var s=this.items.length?this.items[this.items.length-1].data.id:"(0)";this.app.action.listTaskCompletedFilter((function(e){t&&t(e)}),null,s,e||this.pageCount,i)}else{s=this.items.length?this.items[this.items.length-1].data.id:"(0)";this.app.action.listTaskCompletedNext((function(e){t&&t(e)}),null,s,e||this.pageCount)}}.bind(this))},_getApplicationCount:function(t){this.app.getAction(function(){this.app.action.listTaskCompletedApplication(function(e){t&&t(e)}.bind(this))}.bind(this))},_createItem:function(t){return new MWF.xApplication.process.TaskCenter.TaskCompletedList.Item(t,this)}}),MWF.xApplication.process.TaskCenter.TaskCompletedList.Item=new Class({Extends:MWF.xApplication.process.TaskCenter.List.Item,loadActions:function(){this.showTaskCompletedNode=new Element("div",{styles:this.list.css.titleActionShowNode}).inject(this.actionContentNode),this.closeTaskCompletedNode=new Element("div",{styles:this.list.css.titleActionCloseNode}).inject(this.actionContentNode)},setTimeIcon:function(){if(this.data.completed)return this.newIconNode.setStyle("background-image","url(../x_component_process_TaskCenter/$Main/default/time/pic_ok.png)"),!0},setEvent:function(){this.node.addEvents({mouseover:function(){this.showAction()}.bind(this),mouseout:function(){this.hideAction()}.bind(this)}),this.showTaskCompletedNode&&this.showTaskCompletedNode.addEvent("click",function(t){this.showTaskCompleted()}.bind(this)),this.closeTaskCompletedNode&&this.closeTaskCompletedNode.addEvent("click",function(t){this.closeTaskCompleted()}.bind(this)),this.rightContentNode&&this.rightContentNode.addEvent("click",function(t){this.showTaskCompleted(t)}.bind(this))},setFlowChart:function(t){var e=0;t.workLogTokenList={};var i=t.workLogList.shift();return t.workLogList.push(i),t.workLogList.each(function(i){t.workLogTokenList[i.fromActivityToken]=i,i.taskCompletedList||(i.taskCompletedList=[]),i.taskList||(i.taskList=[]),(i.taskCompletedList.length||i.taskList.length)&&(this.createFlowInforWorklogNode(i.fromActivityName,i.taskCompletedList,i.taskList||[],e,i.fromActivityToken==t.taskCompleted.activityToken),e++)}.bind(this)),e},showAction:function(){},hideAction:function(){},_getJobByTaskComplete:function(){this.list.app.action.getSimpleJobByTaskCompleted(function(t){callback&&callback(t.data)}.bind(this),null,this.data.id)},showTaskCompleted:function(){layout.mobile?this.showTaskCompleted_mobile():this.showTaskCompleted_pc()},showTaskCompleted_mobile:function(){this.nodeClone||this._getSimpleJobByTaskComplete(function(t){this.nodeClone=this.mainContentNode.clone(!1),this.nodeClone.inject(this.mainContentNode,"after"),this.mainContentNode.setStyles(this.list.css.itemNode_edit_from_mobile),this.mainContentNode.position({relativeTo:this.nodeClone,position:"topleft",edge:"topleft"}),this.showEditTaskCompletedNode(t)}.bind(this))},showTaskCompleted_pc:function(){this.nodeClone||(this.list.app.content.mask({destroyOnHide:!0,id:"mask_"+this.data.id,style:this.list.css.maskNode}),this._getSimpleJobByTaskComplete(function(t){this.nodeClone=this.mainContentNode.clone(!1),this.nodeClone.inject(this.mainContentNode,"after"),this.mainContentNode.setStyles(this.list.css.itemNode_edit_from),this.mainContentNode.position({relativeTo:this.nodeClone,position:"topleft",edge:"topleft"}),this.showEditTaskCompletedNode(t)}.bind(this)))},_getSimpleJobByTaskComplete:function(t){this.list.app.action.getSimpleJobByTaskCompleted(function(e){t&&t(e.data)}.bind(this),null,this.data.id)},showEditTaskCompletedNode:function(t,e){layout.mobile?this.showEditTaskCompletedNode_mobile(t,e):this.showEditTaskCompletedNode_pc(t,e)},showEditTaskCompletedNode_mobile:function(t,e){var i=this.list.app.tabAreaNode.getPosition(this.list.app.content),s=this.list.app.contentNode.getSize(),o=this.list.app.tabAreaNode.getSize(),n=s.y+o.y;this.list.css.itemNode_edit.top=i.y+"px",this.list.css.itemNode_edit.left=i.x+"px",this.list.css.itemNode_edit.width=s.x+"px",this.list.css.itemNode_edit.height=n+"px",document.body.setStyle("-webkit-overflow-scrolling","auto"),this.showTaskCompletedNode.setStyle("display","none"),new Fx.Morph(this.mainContentNode,{duration:200,transition:Fx.Transitions.Expo.easeOut,onComplete:function(){this.resizeEditNodeFun=this.resizeEditNode.bind(this),this.list.app.addEvent("resize",this.resizeEditNodeFun),this.setEditTaskCompleledNodes(t),this.closeTaskCompletedNode.setStyle("display","block"),e&&e()}.bind(this)}).start(this.list.css.itemNode_edit)},showEditTaskCompletedNode_pc:function(t,e){var i=this.getEditNodePosition();this.list.css.itemNode_edit.top=i.y+"px",this.list.css.itemNode_edit.left=i.x+"px",this.showTaskCompletedNode.setStyle("display","none"),new Fx.Morph(this.mainContentNode,{duration:200,transition:Fx.Transitions.Expo.easeOut,onComplete:function(){this.resizeEditNodeFun=this.resizeEditNode.bind(this),this.list.app.addEvent("resize",this.resizeEditNodeFun),this.setEditTaskCompleledNodes(t),this.closeTaskCompletedNode.setStyle("display","block"),e&&e()}.bind(this)}).start(this.list.css.itemNode_edit)},setEditTaskCompleledNodes:function(t){this.flowInforNode=new Element("div",{styles:this.list.css.flowInforNode}).inject(this.mainContentNode),this.workInforNode=new Element("div",{styles:this.list.css.workInforNode}).inject(this.mainContentNode),MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.workInforNode,{style:"xApp_Task_infor",where:"before",distance:30,friction:4,axis:{x:!1,y:!0}})}.bind(this)),this.setFlowInfor(t),this.setWorkInfor(t)},setWorkInfor:function(t){var e=this.list.app.lp;new Element("div",{styles:this.list.css.taskCompletedWorkInforTitleNode,text:e.currentFileStatus}).inject(this.workInforNode);t.workList.each(function(i){var s=t.workLogTokenList[i.activityToken];if(s){var o=[];s.taskList.each(function(t){var e=t.department||t.unit||"";e=e.substring(0,e.indexOf("@")),o.push(t.person.substring(0,t.person.indexOf("@"))+(e?"("+e+")":""))}.bind(this));var n='<table border="0" width="96%" align="center"><tr><td style="white-space: normal;word-break: break-all;word-wrap:break-word;">'+e.fileat+'<font style="color: #00F"> '+s.fromTime.substr(0,s.fromTime.lastIndexOf(":"))+" </font>"+e.flowto+'<font style="color: #00F"> ['+s.fromActivityName+'] </font><br/><font style="font-weight:bold">'+e.list_owner+": </font>"+o.join(", ")+'</td><td style="width:60px; text-align:right"><div id="'+i.id+'">'+e.open+"</div></td></tr></table>",l=new Element("div",{styles:this.list.css.taskCompletedWorkInforNode,html:n}).inject(this.workInforNode),d=(l.getElement("table"),l.getElement("div"));if(d){d.setStyles(this.list.css.taskCompletedOpenNode);var a=this;d.addEvent("click",(function(t){var e=this.get("id");a.openWorkByTaskCompleted(t,e)}))}}}.bind(this)),t.workCompletedList.each(function(t){var i='<table border="0" width="90%" align="center"><tr><td style="white-space: normal;word-break: break-all;word-wrap:break-word;">'+t.title+"‚Äù"+e.fileat+t.completedTime+e.completed+'</td><td><div id="'+t.id+'">'+e.open+"</div></td></tr></table>",s=new Element("div",{styles:this.list.css.taskCompletedWorkInforNode,html:i}).inject(this.workInforNode).getElement("div");if(s){s.setStyles(this.list.css.taskCompletedOpenNode);var o=this;s.addEvent("click",(function(t){var e=this.get("id");o.openWorkCompleteedByTaskCompleted(t,e)}))}}.bind(this))},openWorkByTaskCompleted:function(t,e){var i={workId:e,readonly:!0,appId:"process.Work"+e};this.list.app.desktop.openApplication(t,"process.Work",i)},openWorkCompleteedByTaskCompleted:function(t,e){var i={workCompletedId:e,readonly:!0,appId:"process.Work"+e};this.list.app.desktop.openApplication(t,"process.Work",i)},closeTaskCompleted:function(t){this.closeTaskCompletedNode.setStyle("display","none"),this.flowInforLeftNode.destroy(),this.flowInforRightNode.destroy(),this.flowInforContentNode.destroy(),this.flowInforScrollNode.destroy(),this.flowInforNode.destroy(),this.workInforNode.destroy(),this.flowInforScrollFx=null,this.flowInforLeftNode=null,this.flowInforRightNode=null,this.flowInforScrollNode=null,this.flowInforContentNode=null,this.flowInforNode=null,this.workInforNode=null,delete this.flowInforScrollFx,delete this.flowInforLeftNode,delete this.flowInforRightNode,delete this.flowInforScrollNode,delete this.flowInforContentNode,delete this.flowInforNode,delete this.workInforNode,this.closeTaskCompletedDom()},closeTaskCompletedDom:function(t){var e=this.nodeClone.getPosition(this.list.app.content);this.list.css.itemNode_edit_from.top=e.y+"px",this.list.css.itemNode_edit_from.left=e.x+"px",new Fx.Morph(this.mainContentNode,{duration:200,transition:Fx.Transitions.Expo.easeIn,onComplete:function(){this.nodeClone.destroy(),this.nodeClone=null,this.list.app.content.unmask(),this.mainContentNode.setStyles(this.list.css.itemMainContentAreaNode),this.mainContentNode.setStyle("opacity",1),document.body.setStyle("-webkit-overflow-scrolling","touch"),this.list.app.removeEvent("resize",this.resizeEditNodeFun),this.showTaskCompletedNode.setStyle("display","block"),t&&t()}.bind(this)}).start(this.list.css.itemNode_edit_from)}});