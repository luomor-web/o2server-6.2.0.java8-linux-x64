MWF.xApplication.process.TaskCenter.List=new Class({initialize:function(t,e,i){this.container=$(t),this.app=e,this.css=this.app.css,this.currentPageData=[],this.nextPageData=[],this.prevPageData=[],this.initData(),this.filterData=null,i&&(this.filterData=i),this.load()},initData:function(){this.count=0,this.isCountShow=!1,this.currentPage=1,this.pageCount=20,this.pages=0,this.items=[],this.isItemsLoaded=!1,this.isItemLoadding=!1,this.loadItemQueue=0,this.filterApplication="",this.currentFilterNode=null,this.filterListNode=null},load:function(){this.mask=new MWF.widget.Mask({style:"desktop"}),this.mask.loadNode(this.app.content),this.contentNode=new Element("div",{styles:this.css.listContentNode}).inject(this.container),this.createActionBarNode(),this.createListAreaNode(),this.resetListAreaHeight(),this.app.addEvent("resize",this.resetListAreaHeight.bind(this))},refresh:function(){this.mask=new MWF.widget.Mask({style:"desktop"}),this.mask.loadNode(this.app.content),this.initData(),this.filterData=null,this.applicationFilterAreaNode&&this.applicationFilterAreaNode.empty(),this.createAppFilterNodes(),this.listAreaNode.empty(),this.resetListAreaHeight(),this.app.getWorkCounts()},refilter:function(){this.mask=new MWF.widget.Mask({style:"desktop"}),this.mask.loadNode(this.app.content),this.initData(),this.applicationFilterAreaNode.empty(),this.createAppFilterNodes(),this.listAreaNode.empty(),this.resetListAreaHeight()},listItemNext:function(t){this.isItemsLoaded||(this.isItemLoadding?this.loadItemQueue++:(this.isItemLoadding=!0,this._getCurrentPageData(function(t){this.count=t.count,this.isCountShow||(this.currentFilterNode.getFirst("span").set("text","("+this.count+")"),this.isCountShow=!0),t.count<=this.items.length&&(this.isItemsLoaded=!0),t.data.each(function(t){this.items.push(this._createItem(t))}.bind(this)),this.isItemLoadding=!1,this.loadItemQueue>0&&(this.loadItemQueue--,this.listItemNext()),this.mask.hide()}.bind(this),t)))},createActionBarNode:function(){this.actionBarNode=new Element("div",{styles:this.css.actionBarNode}).inject(this.contentNode),this.isFilterOpen=!1,this.filterActionNode=new Element("div",{styles:this.css.filterActionNode,text:this.app.lp.filter}).inject(this.actionBarNode),this.filterActionNode.addEvents({click:function(t){this.showOrHideFilter(),t.stopPropagation()}.bind(this)}),this.applicationFilterAreaNode=new Element("div",{styles:this.css.applicationFilterAreaNode}).inject(this.actionBarNode),this.createAppFilterNodes()},showOrHideFilter:function(){this.isFilterOpen?!this.filterAreaMorph&&this.filterAreaMorph.isRunning()||this.hideFilter():this.filterAreaMorph&&this.filterAreaMorph.isRunning()||this.showFilter()},showFilter:function(){this.filterActionNode.setStyles(this.css.filterActionNode_check),this.filterAreaNode||this.createFilterAreaNode(),this.filterAreaTipNode.setStyle("display","block"),this.filterAreaNode.setStyle("display","block"),this.resizeFilterAreaNode();var t=this.app.content.getSize(),e={width:layout.mobile?t.x+"px":"460px",height:layout.mobile?t.y+"px":"500px"};this.isFilterOpen=!0,this.filterAreaMorph.start(e).chain(function(){this.createFilterAreaTitle(),this.createFilterAreaContent(),this.hideFilterFun=this.hideFilter.bind(this),$(document.body).addEvent("click",this.hideFilterFun)}.bind(this))},hideFilter:function(){if(this.filterAreaNode){this.filterAreaNode.empty(),this.isFilterOpen=!1,this.filterAreaMorph.start({width:"460px",height:"0px"}).chain(function(){this.filterAreaNode.eliminate("input"),this.filterAreaNode.setStyle("display","none"),this.filterAreaTipNode.setStyle("display","none"),this.filterActionNode.setStyles(this.css.filterActionNode)}.bind(this)),$(document.body).removeEvent("click",this.hideFilterFun)}},createFilterAreaContent:function(){var t=new Element("div",{styles:this.css.applicationFilterAreaContentListNode}).inject(this.filterAreaNode),e=new Element("div",{styles:this.css.applicationFilterAreaContentScrollNode}).inject(t),i=new Element("div",{styles:{overflow:"hidden","padding-bottom":"20px"}}).inject(e);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(e,{style:"default",distance:30,friction:4,axis:{x:!1,y:!0}})}.bind(this));var s=this;this.app.getAction(function(){this._getFilterCount(function(t){var e=t.data;Object.each(e,function(t,e){new Element("div",{styles:this.css.applicationFilterCategoryNode}).inject(i).set("text",this.app.lp[e]);var o=new Element("div",{styles:this.css.applicationFilterItemAreaNode}).inject(i);t.each(function(t){var i=new Element("div",{styles:this.css.applicationFilterItemNode}).inject(o);i.set("text",t.name),i.store("value",t.value),i.store("textname",t.name),i.store("key",e),i.addEvent("click",(function(){this.hasClass("applicationFilterItemNode_over")?s.unSelectedFilterItem(this):s.selectedFilterItem(this)})),this.filterData&&this.filterData[e]&&t.value===this.filterData[e].value&&this.selectedFilterItem(i)}.bind(this))}.bind(this))}.bind(this))}.bind(this))},_getFilterCount:function(t){this.app.action.listTaskCompletedFilterCount((function(e){t&&t(e)}))},unSelectedFilterItem:function(t){if(t.hasClass("applicationFilterItemNode_over")){var e=t.retrieve("key");t.setStyles(this.css.applicationFilterItemNode),t.removeClass("applicationFilterItemNode_over"),t.addClass("applicationFilterItemNode"),this.filterData||(this.filterData={}),this.filterData[e]=null,delete this.filterData[e],t.getParent().eliminate("current")}},selectedFilterItem:function(t){if(!t.hasClass("applicationFilterItemNode_over")){var e=t.getParent().retrieve("current");e&&this.unSelectedFilterItem(e);var i=t.retrieve("value"),s=t.retrieve("key"),o=t.retrieve("textname");t.setStyles(this.css.applicationFilterItemNode_over),t.removeClass("applicationFilterItemNode"),t.addClass("applicationFilterItemNode_over"),this.filterData||(this.filterData={}),this.filterData[s]={value:i,name:o},t.getParent().store("current",t)}},createFilterAreaTitle:function(){var t=new Element("div",{styles:this.app.css.filterAreaTitleNode}).inject(this.filterAreaNode),e=new Element("div",{styles:this.app.css.filterAreaTitleActionOkNode,text:this.app.lp.ok}).inject(t);new Element("div",{styles:this.app.css.filterAreaTitleActionClearNode,text:this.app.lp.clear}).inject(t).addEvent("click",function(){this.filterAreaNode.getElements(".filterItem").each(function(t){this.unSelectedFilterItem(t)}.bind(this)),this.filterAreaNode.retrieve("input").set("value",""),this.filterData=null,this.hideFilter(),this.refilter()}.bind(this)),e.addEvent("click",function(){var t=this.filterAreaNode.retrieve("input");this.filterData||(this.filterData={});var e=t.get("value");e&&e!==this.app.lp.searchKey?this.filterData.key=e:(this.filterData.key="",delete this.filterData.key),this.hideFilter(),this.refilter()}.bind(this));var i=new Element("div",{styles:this.app.css.filterAreaTitleSearchNode}).inject(t),s=(new Element("div",{styles:this.app.css.filterAreaTitleSearchIconNode}).inject(i),new Element("div",{styles:this.app.css.filterAreaTitleSearchInputAreaNode}).inject(i)),o=new Element("input",{styles:this.app.css.filterAreaTitleSearchInputNode,value:this.app.lp.searchKey}).inject(s);this.filterData&&this.filterData.key&&o.set("value",this.filterData.key),this.filterAreaNode.store("input",o);var n=this.app.lp.searchKey;o.addEvents({blur:function(){this.get("value")||this.set("value",n)},focus:function(){this.get("value")===n&&this.set("value","")}})},createFilterAreaNode:function(){this.filterAreaNode=new Element("div",{styles:this.app.css.filterAreaNode}).inject(this.container),this.filterAreaNode.addEvent("click",(function(t){t.stopPropagation()})),this.filterAreaTipNode=new Element("div",{styles:this.app.css.filterAreaTipNode}).inject(this.container),this.filterAreaNode.setStyles({width:layout.mobile?this.app.content.getSize().x+"px":"460px",height:"0px"}),this.filterAreaNode.position({relativeTo:this.filterActionNode,position:"bottomRight",edge:"upperRight",offset:{x:10,y:7}}),this.filterAreaTipNode.position({relativeTo:this.filterAreaNode,position:"topRight",edge:"bottomRight",offset:{x:-26,y:1}}),this.app.addEvent("resize",function(){this.resizeFilterAreaNode()}.bind(this)),this.filterAreaMorph=new Fx.Morph(this.filterAreaNode,{duration:"100",transition:Fx.Transitions.Sine.easeInOut})},resizeFilterAreaNode:function(){this.filterAreaNode&&(this.filterAreaNode.position({relativeTo:this.filterActionNode,position:"bottomRight",edge:"upperRight",offset:{x:10,y:7}}),this.filterAreaTipNode&&this.filterAreaTipNode.position({relativeTo:this.filterAreaNode,position:"topRight",edge:"bottomRight",offset:{x:-26,y:1}}))},createAppFilterNodes:function(){var t={name:this.app.lp.all,application:"",count:0};this.allAppFilterNode=this.createAppFilterNode(t,"appFilterNode_current"),this.currentFilterNode=this.allAppFilterNode,this._getApplicationCount(function(t){t.data.each(function(t){this.createAppFilterNode(t)}.bind(this))}.bind(this))},createAppFilterNode:function(t,e){e=e||"appFilterNode";var i=new Element("div",{styles:this.app.css[e]}).inject(this.applicationFilterAreaNode),s=t.count?t.name+"<span>("+t.count+")</span>":t.name+"<span></span>";i.set({html:s,id:t.value});var o=this;return i.addEvent("click",(function(t){o.filterByApplication(this)})),i},filterByApplication:function(t){var e=t.get("id");e?(this.currentFilterNode&&this.currentFilterNode.setStyles(this.app.css.appFilterNode),this.initData(),this.filterApplication=e,this.listAreaNode.empty(),this.resetListAreaHeight(),this.currentFilterNode=t,this.currentFilterNode.setStyles(this.app.css.appFilterNode_current)):this.refresh()},createListAreaNode:function(){this.listScrollAreaNode=new Element("div",{styles:this.css.listScrollAreaNode}).inject(this.contentNode),this.listAreaNode=new Element("div",{styles:this.css.listAreaNode}).inject(this.listScrollAreaNode);var t=this;MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.listScrollAreaNode,{style:"xApp_TaskList",where:"before",distance:30,friction:4,axis:{x:!1,y:!0},onScroll:function(e,i){var s=t.listScrollAreaNode.getScrollSize(),o=t.listScrollAreaNode.getSize();e+200>s.y-o.y&&(t.isElementLoaded||t.listItemNext())}})}.bind(this))},resetListAreaHeight:function(){layout.mobile?this.resetListAreaHeight_mobile():this.resetListAreaHeight_pc()},resetListAreaHeight_mobile:function(){var t=this.app.contentNode.getSize();this.contentNode.setStyle("width",t.x+"px");var e=this.contentNode.getSize(),i=e.y;if(this.actionBarNode){var s=this.actionBarNode.getSize();i=e.y-s.y}this.listScrollAreaNode.setStyle("height",i+"px"),this.listAreaNode&&(this.pageCount=50,this.items.length<this.pageCount&&this.listItemNext(this.pageCount-this.items.length))},resetListAreaHeight_pc:function(){var t=this.app.contentNode.getSize();this.contentNode.setStyle("width",t.x+"px");var e=this.contentNode.getSize(),i=e.y;if(this.actionBarNode){var s=this.actionBarNode.getSize();i=e.y-s.y}if(this.listScrollAreaNode.setStyle("height",i+"px"),this.listAreaNode){var o=(e.x/350).toInt(),n=350*o,l=(e.x-n)/2;this.listAreaNode.setStyles({width:n+"px","margin-left":l+"px"}),this.actionBarNode&&this.actionBarNode.setStyles({width:n+"px","margin-left":l+"px"});var a=(i/182).toInt()+1;this.pageCount=o*a,this.items.length<this.pageCount&&this.listItemNext(this.pageCount-this.items.length)}},show:function(){this.app.currentList&&this.app.currentList.hide(),this.app.currentList=this,this.contentNode.setStyle("display","block")},hide:function(){this.contentNode.setStyle("display","none")},_getCurrentPageData:function(t,e){this.app.getAction(function(){var i;this.filterApplication?(i=this.items.length?this.items[this.items.length-1].data.id:"(0)",this.app.action.listTaskNextByApp((function(e){t&&t(e)}),null,i,e||this.pageCount,this.filterApplication)):(i=this.items.length?this.items[this.items.length-1].data.id:"(0)",this.app.action.listTaskNext((function(e){t&&t(e)}),null,i,e||this.pageCount))}.bind(this))},_getApplicationCount:function(t){this.app.getAction(function(){this.app.action.listTaskApplication(function(e){t&&t(e)}.bind(this))}.bind(this))},_createItem:function(t){return new MWF.xApplication.process.TaskCenter.TaskList.Item(t,this)},showDatch:function(){this.datchActionNode||(this.datchActionNode=new Element("div",{styles:this.css.datchActionNode,text:this.app.lp.datch}).inject(this.app.content),this.datchActionNode.position({relativeTo:this.actionBarNode,position:"centerbottom",edge:"centerbottom"}),this.datchActionNode.addEvent("click",function(t){this.datchProcess()}.bind(this)))},hideDatch:function(){this.datchActionNode&&(this.datchActionNode.destroy(),this.datchActionNode=null)},datchProcess:function(){size=this.app.content.getSize();var t=(size.x-"580")/2,e=(size.y-"260")/2;t<0&&(t=0),e<0&&(e=0);var i=this;MWF.require("MWF.xDesktop.Dialog",function(){var s=new MWF.xDesktop.Dialog({title:this.app.lp.datch,style:"datch",top:e-20,left:t,fromTop:e-20,fromLeft:t,width:"580",height:"260",html:"",maskNode:this.app.content,container:this.app.content});s.show(),MWF.xDesktop.requireApp("process.Work","Processor",function(){new MWF.xApplication.process.Work.Processor(s.content,this.selectedTask[0].data,{style:"task",onCancel:function(){s.close()},onSubmit:function(t,e,o){i.submitDatchTask(t,e,o,this),s.close()}})}.bind(this))}.bind(this))},submitDatchTask:function(t,e,i,s){this.hideDatch(),this.selectedTask.each(function(o){o.submitTask(t,e,i,s,!0)}.bind(this)),this.selectedTask=[]}}),MWF.xApplication.process.TaskCenter.List.Item=new Class({initialize:function(t,e){this.data=t,this.list=e,this.container=this.list.listAreaNode,this.load()},load:function(){this.node=new Element("div",{styles:this.list.css.itemNode}).inject(this.container),layout.mobile&&this.node.setStyles(this.list.css.itemNode_mobile),this.mainContentNode=new Element("div",{styles:this.list.css.itemMainContentAreaNode}).inject(this.node),this.timeContentNode=new Element("div",{styles:this.list.css.itemTimeContentAreaNode}).inject(this.node),this.leftContentNode=new Element("div",{styles:this.list.css.itemMainLeftContentAreaNode}).inject(this.mainContentNode),this.applicationIconAreaNode=new Element("div",{styles:this.list.css.itemApplicationIconAreaNode,title:this.data.applicationName}).inject(this.leftContentNode),this.timeIconNode=new Element("div",{styles:this.list.css.itemTimeIconNode}).inject(this.leftContentNode),this.applicationIconNode=new Element("div",{styles:this.list.css.itemApplicationIconNode}).inject(this.applicationIconAreaNode),this.actionContentNode=new Element("div",{styles:this.list.css.itemMainActionContentAreaNode}).inject(this.mainContentNode),this.rightContentNode=new Element("div",{styles:this.list.css.itemMainRightContentAreaNode}).inject(this.mainContentNode),this.applicationTitleNode=new Element("div",{styles:this.list.css.itemApplicationTitleNode}).inject(this.rightContentNode),this.titleNode=new Element("div",{styles:this.list.css.itemTitleNode}).inject(this.rightContentNode),this.activityNode=new Element("div",{styles:this.list.css.itemActivityNode}).inject(this.rightContentNode),this.newIconNode=new Element("div",{styles:this.list.css.itemNewIconNode}).inject(this.node),this.getApplicationIcon(function(t){var e="../x_component_process_ApplicationExplorer/$Main/default/icon/application.png";t.icon&&(e="data:image/png;base64,"+t.icon),this.applicationIconNode.makeLnk({par:this._getLnkPar(e)})}.bind(this)),this.setContent(),this.setNewIcon(),this.setEvent(),this.setTimeIcon(),this.node.fade("in")},_getLnkPar:function(t){return{icon:t,title:"["+this.data.processName+"]"+(this.data.title||this.list.app.lp.unnamed),par:this.data.workCompleted?'process.Work#{"workCompletedId":"'+this.data.workCompleted+'"}':'process.Work#{"workId":"'+this.data.work+'"}'}},setTimeIcon:function(){if(this.data.completed)return this.newIconNode.setStyle("background-image","url(../x_component_process_TaskCenter/$Main/default/time/pic_ok.png)"),!0;if(this.timeIconNode.empty(),this.data.expireTime){var t=Date.parse(this.data.expireTime),e=Date.parse(this.data.createTime),i=new Date,s=e.diff(i,"second"),o=(i.diff(t,"second"),s/e.diff(t,"second")),n="",l=this.list.app.lp.expire1;l=l.replace(/{time}/g,this.data.expireTime),o<.5?n="1.png":o<.75?n="2.png":o<1?(l=this.list.app.lp.expire2.replace(/{time}/g,this.data.expireTime),n="3.png",this.newIconNode.setStyle("background-image","url(../x_component_process_TaskCenter/$Main/default/time/pic_jichao.png)")):o<2?(l=this.list.app.lp.expire3.replace(/{time}/g,this.data.expireTime),n="4.png",this.newIconNode.setStyle("background-image","url(../x_component_process_TaskCenter/$Main/default/time/pic_yichao.png)")):(l=this.list.app.lp.expire3.replace(/{time}/g,this.data.expireTime),n="5.png",this.newIconNode.setStyle("background-image","url(../x_component_process_TaskCenter/$Main/default/time/pic_yanchao.png)")),this.timeIconNode.setStyle("background-image","url("+this.list.app.path+this.list.app.options.style+"/time/"+n+")"),this.timeIconNode.set("title",l)}},setEvent:function(){this.node.addEvents({mouseover:function(){this.showAction()}.bind(this),mouseout:function(){this.hideAction()}.bind(this)}),this.editNode&&this.editNode.addEvent("click",function(t){this.editTask()}.bind(this)),this.closeNode&&this.closeNode.addEvent("click",function(t){this.closeEditTask()}.bind(this)),this.rightContentNode&&this.rightContentNode.addEvent("click",function(t){this.openTask(t)}.bind(this)),this.applicationIconNode&&this.applicationIconNode.addEvent("click",function(t){this.selectTask(t)}.bind(this))},selectTask:function(){this.list.selectedTask||(this.list.selectedTask=[]),this.selectedStatus?(this.list.selectedTask.erase(this),this.mainContentNode.setStyles(this.list.css.itemMainContentAreaNode),this.mainContentNode.setStyle("border",this.mainContentNodeBorder),this.selectedStatus=!1):(this.list.selectedTask.push(this),this.mainContentNodeBorder=this.mainContentNode.getStyle("border"),this.mainContentNode.setStyles(this.list.css.itemMainContentAreaNode_selected),this.selectedStatus=!0),this.checkProcess()?this.list.showDatch():this.list.hideDatch()},checkProcess:function(){var t="";if(!this.list.selectedTask.length)return!1;for(var e=0;e<this.list.selectedTask.length;e++){var i=this.list.selectedTask[e];if(!i.data.allowRapid)return!1;if(t){if(t!=i.data.activity||!i.data.allowRapid)return!1}else t=i.data.activity}return!0},showAction:function(){},hideAction:function(){},openTask:function(t){var e={workId:this.data.work,appId:"process.Work"+this.data.work};this.list.app.desktop.openApplication(t,"process.Work",e)},closeEditTask:function(t){this.closeNode.setStyle("display","none"),this.flowInforLeftNode.destroy(),this.flowInforRightNode.destroy(),this.flowInforContentNode.destroy(),this.flowInforScrollNode.destroy(),this.flowInforNode.destroy(),this.processNode.destroy(),this.flowInforScrollFx=null,this.flowInforLeftNode=null,this.flowInforRightNode=null,this.flowInforScrollNode=null,this.flowInforContentNode=null,delete this.flowInforScrollFx,delete this.flowInforLeftNode,delete this.flowInforRightNode,delete this.flowInforScrollNode,delete this.flowInforContentNode,delete this.flowInforNode,delete this.processNode;var e=this.node.getPosition(this.list.app.content);this.list.css.itemNode_edit_from.top=e.y+"px",this.list.css.itemNode_edit_from.left=e.x+"px",new Fx.Morph(this.mainContentNode,{duration:200,transition:Fx.Transitions.Expo.easeIn,onComplete:function(){this.nodeClone.destroy(),this.nodeClone=null,this.list.app.content.unmask(),document.body.setStyle("-webkit-overflow-scrolling","touch"),this.mainContentNode.setStyles(this.list.css.itemMainContentAreaNode),this.mainContentNode.setStyle("opacity",1),this.list.app.removeEvent("resize",this.resizeEditNodeFun),this.editNode.setStyle("display","block"),t&&t()}.bind(this)}).start(this.list.css.itemNode_edit_from)},editTask:function(){layout.mobile?this.editTask_mobile():this.editTask_pc()},editTask_mobile:function(){this.nodeClone||this._getJobByTask(function(t){this.nodeClone=this.mainContentNode.clone(!1),this.nodeClone.inject(this.mainContentNode,"after"),this.mainContentNode.setStyles(this.list.css.itemNode_edit_from_mobile),this.mainContentNode.position({relativeTo:this.nodeClone,position:"topleft",edge:"topleft"}),this.showEditNode(t)}.bind(this))},editTask_pc:function(){this.list.app.content.mask({destroyOnHide:!0,id:"mask_"+this.data.id,style:this.list.css.maskNode}),this._getJobByTask(function(t){this.nodeClone=this.mainContentNode.clone(!1),this.nodeClone.inject(this.mainContentNode,"after"),this.mainContentNode.setStyles(this.list.css.itemNode_edit_from),this.mainContentNode.position({relativeTo:this.nodeClone,position:"topleft",edge:"topleft"}),this.showEditNode(t)}.bind(this))},setEditTaskNodes:function(t){this.flowInforNode=new Element("div",{styles:this.list.css.flowInforNode}).inject(this.mainContentNode),this.processNode=new Element("div",{styles:this.list.css.processNode}).inject(this.mainContentNode),this.setFlowInfor(t),this.setProcessor()},setFlowChart:function(t){var e=0;return t.workLogList.each(function(i){i.taskCompletedList||(i.taskCompletedList=[]),i.taskList||(i.taskList=[]),(i.taskCompletedList.length||i.taskList.length)&&(this.createFlowInforWorklogNode(i.fromActivityName,i.taskCompletedList,i.taskList||[],e,i.fromActivityToken==t.task.activityToken),e++)}.bind(this)),e},setFlowInfor:function(t){this.flowInforLeftNode=new Element("div",{styles:this.list.css.flowInforLeftNode}).inject(this.flowInforNode),this.flowInforRightNode=new Element("div",{styles:this.list.css.flowInforRightNode}).inject(this.flowInforNode),this.flowInforScrollNode=new Element("div",{styles:this.list.css.flowInforScrollNode}).inject(this.flowInforNode),this.flowInforContentNode=new Element("div",{styles:this.list.css.flowInforContentNode}).inject(this.flowInforScrollNode);var e=this.setFlowChart(t),i=40*e+16*(e-1);this.flowInforContentNode.setStyle("width",i+"px"),this.setFlowInforScroll()},toFlowInforLeft:function(){var t=this.flowInforScrollNode.getSize(),e=this.flowInforScrollNode.getScrollSize(),i=this.flowInforScrollNode.getScroll();if(i.x>0){var s=i.x-t.x;s<0&&(s=0),s>0||this.flowInforLeftNode.setStyle("background-image",""),s+t.x<e.x&&this.flowInforRightNode.setStyle("background-image","url(../x_component_process_TaskCenter/$Main/default/processor/right.png)"),this.flowInforScrollFx.start(s)}},toFlowInforRight:function(){var t=this.flowInforScrollNode.getSize(),e=this.flowInforScrollNode.getScrollSize(),i=this.flowInforScrollNode.getScroll();if(i.x+t.x<e.x){var s=i.x+t.x;s>e.x&&(s=e.x),s>0&&this.flowInforLeftNode.setStyle("background-image","url(../x_component_process_TaskCenter/$Main/default/processor/left.png)"),s+t.x<e.x||this.flowInforRightNode.setStyle("background-image",""),this.flowInforScrollFx.start(s)}},setFlowInforScroll:function(){var t=this.flowInforScrollNode.getSize(),e=this.flowInforScrollNode.getScrollSize();this.flowInforScrollNode.getScroll();e.x>t.x&&(this.flowInforScrollFx||(this.flowInforScrollFx=new Fx.Scroll(this.flowInforScrollNode,{wheelStops:!1})),this.flowInforScrollFx.toRight(),this.flowInforLeftNode.setStyle("background-image","url(../x_component_process_TaskCenter/$Main/default/processor/left.png)"),this.flowInforLeftNode.addEvent("click",function(){this.toFlowInforLeft()}.bind(this)),this.flowInforRightNode.addEvent("click",function(){this.toFlowInforRight()}.bind(this)))},createFlowInforWorklogNode:function(t,e,i,s,o){if(0!=s)new Element("div",{styles:this.list.css.logLineNode}).inject(this.flowInforContentNode);var n=new Element("div",{styles:this.list.css.logActivityNode}).inject(this.flowInforContentNode),l=new Element("div",{styles:this.list.css.logActivityIconNode}).inject(n),a=(new Element("div",{styles:this.list.css.logActivityTextNode,text:t}).inject(n),"user"),h="";e.length+i.length>1&&(a="users"),o&&(h="_red");var d=new Element("div",{styles:this.list.css.logInforNode});e.each(function(t){new Element("div",{styles:this.list.css.logRouteNode}).inject(d).set("text",t.person.substring(0,t.person.indexOf("@"))+": ");var e=new Element("div",{styles:this.list.css.logOpinionNode}).inject(d);t.opinion||(t.opinion=""),e.set("text","["+t.routeName+"] "+t.opinion),new Element("div",{styles:this.list.css.logTimeNode}).inject(d).set("text",t.completedTime),this.list.app.desktop.session.user.distinguishedName===t.person&&(h||(h="_yellow"))}.bind(this)),i.each(function(t){new Element("div",{styles:this.list.css.taskTextNode}).inject(d).set("text",t.person.substring(0,t.person.indexOf("@"))+" "+this.list.app.lp.processing)}.bind(this));var r="url(../x_component_process_TaskCenter/$Main/default/processor/"+a+h+".png)";if(l.setStyle("background-image",r),i.length){var c=new Element("div",{styles:this.list.css.logTaskCountNode}).inject(n),p=i.length;c.set("text",p)}new mBox.Tooltip({content:d,setStyles:{content:{padding:10,lineHeight:20}},attach:n,transition:"flyin",offset:{x:this.list.app.contentNode.getScroll().x,y:this.list.listScrollAreaNode.getScroll().y}})},setProcessor:function(){var t=this;MWF.xDesktop.requireApp("process.Work","Processor",function(){new MWF.xApplication.process.Work.Processor(this.processNode,this.data,{style:"task",mediaNode:this.mainContentNode,onCancel:function(){t.closeEditTask()},onSubmit:function(e,i,s){t.submitTask(e,i,s,this)}})}.bind(this))},addMessage:function(t){if(layout.desktop.message){var e="";t.length?t.each(function(t){var i=[];t.taskList.each(function(t){i.push(t.person+"("+t.department+")")}.bind(this)),e+="<div><b>"+this.list.app.lp.nextActivity+'<font style="color: #ea621f">'+t.fromActivityName+"</font>, "+this.list.app.lp.nextUser+'<font style="color: #ea621f">'+i.join(", ")+"</font></b></div>"}.bind(this)):e+=this.list.app.lp.workCompleted;var i={subject:this.list.app.lp.taskProcessed,content:"<div>"+this.list.app.lp.taskProcessedMessage+"“"+this.data.title+"”</div>"+e};layout.desktop.message.addTooltip(i),layout.desktop.message.addMessage(i)}},submitTask:function(t,e,i,s,o){e||(e=t),this.data.routeName=t,this.data.opinion=e;var n=[];i.length&&i.each(function(t){var e=new FormData;e.append("file",t),e.append("site","$mediaOpinion"),this.list.app.action.uploadAttachment(this.data.work,e,t,function(t){n.push(t.data.id)}.bind(this),null,!1)}.bind(this)),n.length&&(this.data.mediaOpinion=n.join(",")),this.list.app.action.processTask(function(t){s&&s.destroy(),o?(this.node.destroy(),this.list.refresh(),this.addMessage(t.data)):this.closeEditTask(function(){this.node.destroy(),this.list.refresh(),this.addMessage(t.data)}.bind(this))}.bind(this),null,this.data.id,this.data)},resizeEditNode:function(){var t=this.getEditNodePosition(),e=this.list.app.content.getSize(),i=this.list.app.window.node.getElement("#mask_"+this.data.id);i&&i.setStyles({width:e.x+"px",height:e.y+"px"}),this.mainContentNode.setStyles({top:t.y+"px",left:t.x+"px"})},getEditNodePosition:function(){var t=this.list.app.content.getSize(),e=this.node.getPosition(this.list.app.content),i=e.y,s=e.x,o=this.list.css.itemNode_edit.width.toInt(),n=this.list.css.itemNode_edit.height.toInt();return i+n>t.y&&(i=t.y-n)<0&&(i=0),s+o>t.x&&(s=t.x-o)<0&&(s=0),{x:s,y:i}},showEditNode:function(t,e){layout.mobile?this.showEditNode_mobile(t,e):this.showEditNode_pc(t,e)},showEditNode_mobile:function(t,e){var i=this.list.app.tabAreaNode.getPosition(this.list.app.content),s=this.list.app.contentNode.getSize(),o=this.list.app.tabAreaNode.getSize(),n=s.y+o.y;this.list.css.itemNode_edit.top=i.y+"px",this.list.css.itemNode_edit.left=i.x+"px",this.list.css.itemNode_edit.width=s.x+"px",this.list.css.itemNode_edit.height=n+"px",document.body.setStyle("-webkit-overflow-scrolling","auto"),this.editNode.setStyle("display","none"),new Fx.Morph(this.mainContentNode,{duration:200,transition:Fx.Transitions.Expo.easeOut,onComplete:function(){this.resizeEditNodeFun=this.resizeEditNode.bind(this),this.list.app.addEvent("resize",this.resizeEditNodeFun),this.setEditTaskNodes(t),this.closeNode.setStyle("display","block"),e&&e()}.bind(this)}).start(this.list.css.itemNode_edit)},showEditNode_pc:function(t,e){var i=this.getEditNodePosition();this.list.css.itemNode_edit.top=i.y+"px",this.list.css.itemNode_edit.left=i.x+"px",this.editNode.setStyle("display","none"),new Fx.Morph(this.mainContentNode,{duration:200,transition:Fx.Transitions.Expo.easeOut,onComplete:function(){this.resizeEditNodeFun=this.resizeEditNode.bind(this),this.list.app.addEvent("resize",this.resizeEditNodeFun),this.setEditTaskNodes(t),this.closeNode.setStyle("display","block"),e&&e()}.bind(this)}).start(this.list.css.itemNode_edit)},_getJobByTask:function(t){this.list.app.action.getSimpleJobByTask(function(e){t&&t(e.data)}.bind(this),null,this.data.id)},setContent:function(){this.applicationTitleNode.set("text",this.data.applicationName),this.titleNode.set("html",'<font style="color: #333;">['+this.data.processName+"]&nbsp;&nbsp;</font>"+o2.txt(this.data.title)),this.titleNode.set("title",this.data.title),this.activityNode.set("text","( "+(this.data.activityName||this.list.app.lp.completed)+" )"),this.timeContentNode.set("text",this.list.app.lp.list_comedate+": "+this.data.startTime),this.loadActions(),this.loadApplicationIcon()},loadActions:function(){this.data.allowRapid&&(this.editNode=new Element("div",{styles:this.list.css.titleActionEditNode}).inject(this.actionContentNode),this.closeNode=new Element("div",{styles:this.list.css.titleActionCloseNode}).inject(this.actionContentNode))},loadApplicationIcon:function(){this.getApplicationIcon(function(t){t.icon?this.applicationIconNode.setStyle("background-image","url(data:image/png;base64,"+t.icon+")"):(this.mainContentNode.setStyle("border-top","4px solid #4e82bd"),this.applicationIconNode.setStyle("background-image","url(../x_component_process_ApplicationExplorer/$Main/default/icon/application.png)"))}.bind(this))},getApplicationIcon:function(t){var e=this.list.app.appIcons[this.data.application];e?t&&t(e):this.list.app.action.getApplicationIcon(function(e){e.data?e.data&&(this.list.app.appIcons[this.data.application]=e.data,t&&t(e.data)):(this.invalidItem=!0,t&&t({icon:"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAEgElEQVR4Xu1aPXMTSRB9vUaGQqs6iCgi4Bfgq7I2lqWrSwgQMQHyPzAJIeguvOT4BxbBxYjgkquTrFiiCvkXYCKKCFMSFEjs9tWsrEKWvTtfuyvXrTbd6ZnuN69fz842IecP5Tx+rAFYMyDnCKxTYBUE4MrWta9UuLu49hWeHlJveJy1P6kzQAT7eWPzPgN1MFeI6FpckMx8DKIeAe2iP3mVNiipADALuvAIQAOgLbtd5SGAVtGfvkgDjMQB+Fz1ngXgPdlO64IimOGAnhe7/d90bePGJwbAuOY9AqMJwu0kHTwzF+MIhKbb6b9IYh1rAATdxxub+yRyPMOHgbbrT3Zt08IKgHGlvIUN7NvnuSlyPISPXbc3EDph9BgDMPplu4KAXiad67pRhFXD4Qelf1/3dG3FeCMARPDEzoHJgmnZMAU7JiBoAyBozw4OVr3zy0AKJlCAHd100ALgpL4frC7nZfzhYdGf7ugIoxYAo5r3Mmu1l4V8hglAu9TpP1C1UwZgXC03QLSvOvFKxzHvut1BS8UHDQC8t6kfclQ8VhnDOHK7/TsqQ5UAGFW9JhGeqUy4PIZu3AR/eG9iChtbcPDY7b5+LltYCkB40nMKb01U/9Kv93D5yVN8++N3fP/nb5kvp97b2IqJRFVwg+kdmSBKARhXt/dAzp9a3gOYBzC30wHBxvaUnwoskANQK7/RLXvLAeiAYGN7dpN46HYGP8dtXiwAJ5cZH3V2X+Tt1b/akSZxTIgKfj7Zl4d1bT0p+pPrcWkQC4Bp6ZMFch4IJjZKGyMpibEAjGpem4D7SgstDdIJSGesri8MvCp1+pGf6vEAVMsfTdR/7qRKYGKsqBRRj454njeHqAal7uB61PzxKVDzWBfx5fEyEOLmtw1+Prfb6UfGGfnCRACjgjEBIanghU9GACT9za8DQpLBh4eimLuCSAYkDYBwRAWEpINfA3BRGKCy+zonRh1xNkqB3IugQHic5zIoABjVyscE+kmHbotjZbQXgpf6QQj8qdQZRP6QXR+F43Y39x9DJkL4v/ocDoWw6g1BONXNIdMEm0sNG9szfjEO3W4/tj9BfiOU9yux2e/vwpFJNbC52LSxDY+/4E+uP71tfSkalsM8X4vP82pc9URnxi1Z/l+I94x3brev1Kki1YAfAOT819jsZGh+R5gVM2R3gMt+KDMgFBbR/uZs9nTLYlbBg3FYDCYVmfAt+qMFQHguEA0SG+iZVIU0gRCqTz4qqTZIzANI47bIFpzMWmQWQQBTe9VMEDsP4rpJf5CIRTsFFncqbJNzqLUyTWAcIuCGLu2tNGCZqieNki3TP0im1Bdq7/qTho7gnbeWFQNOsUG00IBEq2y6hyXGO4Cbqi0wMoATA+DHgWl7j4maSWtDqPIsApd3fciCTjQFzltsdl641ACchrU+iDxH0CoG31u2dE81BaJQn4FRqDNRXRylZMwIVR3UI+Z2MZi20wg6dQaoUDDsNV54TMuYylpxYxLXAFuHsrZfA5A14hdtvTUDLtqOZO1P7hnwH8CljF98DV13AAAAAElFTkSuQmCC",iconHue:"#4e82bd"}))}.bind(this),function(){this.invalidItem=!0,t&&t({icon:"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAEgElEQVR4Xu1aPXMTSRB9vUaGQqs6iCgi4Bfgq7I2lqWrSwgQMQHyPzAJIeguvOT4BxbBxYjgkquTrFiiCvkXYCKKCFMSFEjs9tWsrEKWvTtfuyvXrTbd6ZnuN69fz842IecP5Tx+rAFYMyDnCKxTYBUE4MrWta9UuLu49hWeHlJveJy1P6kzQAT7eWPzPgN1MFeI6FpckMx8DKIeAe2iP3mVNiipADALuvAIQAOgLbtd5SGAVtGfvkgDjMQB+Fz1ngXgPdlO64IimOGAnhe7/d90bePGJwbAuOY9AqMJwu0kHTwzF+MIhKbb6b9IYh1rAATdxxub+yRyPMOHgbbrT3Zt08IKgHGlvIUN7NvnuSlyPISPXbc3EDph9BgDMPplu4KAXiad67pRhFXD4Qelf1/3dG3FeCMARPDEzoHJgmnZMAU7JiBoAyBozw4OVr3zy0AKJlCAHd100ALgpL4frC7nZfzhYdGf7ugIoxYAo5r3Mmu1l4V8hglAu9TpP1C1UwZgXC03QLSvOvFKxzHvut1BS8UHDQC8t6kfclQ8VhnDOHK7/TsqQ5UAGFW9JhGeqUy4PIZu3AR/eG9iChtbcPDY7b5+LltYCkB40nMKb01U/9Kv93D5yVN8++N3fP/nb5kvp97b2IqJRFVwg+kdmSBKARhXt/dAzp9a3gOYBzC30wHBxvaUnwoskANQK7/RLXvLAeiAYGN7dpN46HYGP8dtXiwAJ5cZH3V2X+Tt1b/akSZxTIgKfj7Zl4d1bT0p+pPrcWkQC4Bp6ZMFch4IJjZKGyMpibEAjGpem4D7SgstDdIJSGesri8MvCp1+pGf6vEAVMsfTdR/7qRKYGKsqBRRj454njeHqAal7uB61PzxKVDzWBfx5fEyEOLmtw1+Prfb6UfGGfnCRACjgjEBIanghU9GACT9za8DQpLBh4eimLuCSAYkDYBwRAWEpINfA3BRGKCy+zonRh1xNkqB3IugQHic5zIoABjVyscE+kmHbotjZbQXgpf6QQj8qdQZRP6QXR+F43Y39x9DJkL4v/ocDoWw6g1BONXNIdMEm0sNG9szfjEO3W4/tj9BfiOU9yux2e/vwpFJNbC52LSxDY+/4E+uP71tfSkalsM8X4vP82pc9URnxi1Z/l+I94x3brev1Kki1YAfAOT819jsZGh+R5gVM2R3gMt+KDMgFBbR/uZs9nTLYlbBg3FYDCYVmfAt+qMFQHguEA0SG+iZVIU0gRCqTz4qqTZIzANI47bIFpzMWmQWQQBTe9VMEDsP4rpJf5CIRTsFFncqbJNzqLUyTWAcIuCGLu2tNGCZqieNki3TP0im1Bdq7/qTho7gnbeWFQNOsUG00IBEq2y6hyXGO4Cbqi0wMoATA+DHgWl7j4maSWtDqPIsApd3fciCTjQFzltsdl641ACchrU+iDxH0CoG31u2dE81BaJQn4FRqDNRXRylZMwIVR3UI+Z2MZi20wg6dQaoUDDsNV54TMuYylpxYxLXAFuHsrZfA5A14hdtvTUDLtqOZO1P7hnwH8CljF98DV13AAAAAElFTkSuQmCC",iconHue:"#f44336"})}.bind(this),this.data.application)},setNewIcon:function(){var t=(new Date).parse(this.data.startTime);(new Date).getTime()-t.getTime()<864e5&&this.newIconNode.setStyle("background-image","url(../x_component_process_TaskCenter/$Main/default/time/new.png)")},setTimeIconNode:function(){var t=["#FF0000","#00d400","#f6ff0c"][(3*Math.random()).toInt()];this.timeIconNode.setStyle("background-color",t)}});