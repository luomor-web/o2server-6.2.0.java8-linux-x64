MWF.xApplication.Profile.Common={},MWF.xApplication.Profile.Common.Pagination=new Class({Implements:[Events,Options],options:{page:1,pageSize:10,showNumber:!0,showText:!1},initialize:function(t,e){this.setOptions(e),this.target="string"==typeof t?$(t):t,this.total=this.options.total,this.length=this.options.length,this.currentPage=0,this.pageSize=this.options.pageSize,this.pageNode=new Element("div"),this.target.empty(),this.pageNode.inject(this.target)},create:function(t){if(t.empty(),1!=this.page){if(this.currentPage>0){var e=new Element("div",{text:"",class:"pagination-previous page",events:{click:this.click.bind(this,this.currentPage-1)}});t.grab(e)}if(this.options.showNumber){var i=this.currentPage-2<0?0:this.currentPage-2,n=this.currentPage+2>this.page?this.page:this.currentPage+2;i>0&&t.grab(this.createNumber(0)),i>1&&t.grab(this.createNumber(1)),i>2&&t.grab(this.createSplit());for(var a=i;a<n;a++)t.grab(this.createNumber(a));n<this.page-2&&t.grab(this.createSplit()),n<this.page-1&&t.grab(this.createNumber(this.page-2)),n<this.page&&t.grab(this.createNumber(this.page-1))}if(this.currentPage<this.page-1){var s=new Element("div",{text:"",class:"pagination-next page",events:{click:this.click.bind(this,this.currentPage+1)}});t.grab(s)}this.options.showText&&t.grab(this.createText())}},createNumber:function(t){var e=new Element("div",{text:t+1,class:"pagination-link page",events:{click:this.click.bind(this,t)}});return t===this.currentPage&&e.set("class","pagination-link page is-current mainColor_bg"),e},createSplit:function(){return new Element("div.page",{text:"..."})},createText:function(){var t=MWF.xApplication.Profile.LP.pageText.replace("{n}",this.currentPage+1+"/"+this.page);return new Element("span",{text:t,style:"margin:0 3px;"})},click:function(t){this.currentPage=t,this.load(),this.fireEvent("afterLoad",[this.currentPage+1])},load:function(){this.fireEvent("beforeLoad"),this.page=this.total?Math.ceil(this.total/this.pageSize):this.currentPage+Math.ceil(this.length+1/this.pageSize),this.create(this.pageNode)},reload:function(t){this.currentPage=0,this.load()},setpageSize:function(t){this.pageSize=t,this.reload()}}),MWF.xApplication.Profile.Common.Content=new Class({Implements:[Events,Options],options:{pageSize:10,page:1,pagination:!0,search:!1,columns:[],title:"",searchItemList:[]},initialize:function(t,e){this.setOptions(e),this.searchItemList=this.options.searchItemList,this.opButtonList=this.options.opButtonList,this.columns=this.options.columns,this.contentNode=t,this.contentNode.empty()},load:function(){this.createTable(),this.createPagination()},reload:function(t){this.currentPage=0,this.load()},createPagination:function(){this.paginationNode&&this.paginationNode.remove(),this.paginationNode=new Element("div",{class:"pagination ",style:"padding: 10px;"}).inject(this.contentNode),new MWF.xApplication.Profile.Common.Pagination(this.paginationNode,{total:this.total,length:this.dataList.length,pageSize:this.options.pageSize,showNumber:!0,showText:!1,onAfterLoad:function(t){this.options.page=t,this.createTbody()}.bind(this)}).load()},createOp:function(){this.opNode=new Element("div",{class:"container is-fluid buttons",style:"margin-left:10px;margin-bottom:0px"}).inject(this.contentNode),this.opButtonList.each(function(t){var e=new Element("a",{class:"button is-link",text:t.text}).inject(this.opNode);t.action&&e.addEvent("click",function(e){t.action(e,this)}.bind(this))}.bind(this))},createNavi:function(){this.subNaviNode=new Element("div",{style:"background-color:#3273dc;color:#fff;padding:0.5em 0.5em;margin-bottom:0.5em;display:block",html:this.options.title}).inject(this.contentNode)},createSearch:function(){this.searchItemNode=new Element("div",{style:"padding: 0.5rem"}).inject(this.contentNode),this.searchItemList.each(function(t){var e;if("date"!==t.type&&"input"!==t.type||(e=new Element("input",{class:"input control",name:t.name,placeholder:t.title,style:"width:200px;margin:5px;"}).inject(this.searchItemNode),"date"===t.type&&new MWF.widget.Calendar(e,{style:"xform",onComplate:function(){}})),"select"===t.type){var i=new Element("div",{class:"select"}).inject(this.searchItemNode);e=new Element("select",{style:"width:200px;margin:5px;",name:t.name}).inject(i),t.options.each((function(t){new Element("option",{text:t.split("|")[0],value:t.split("|").length>1?t.split("|")[1]:t.split("|")[0]}).inject(e)}))}t.click&&e.addEvent("click",(function(i){t.click(i,e)}))}.bind(this)),this.searchOkButton=new Element("a",{class:"button is-link",style:"margin:5px;",text:MWF.xApplication.Profile.LP.search}).inject(this.searchItemNode).addEvent("click",function(){this.options.page=1,this.createTbody(),this.createPagination()}.bind(this)),this.searchCancleButton=new Element("a",{class:"button",style:"margin:5px;",text:MWF.xApplication.Profile.LP.cancel1}).inject(this.searchItemNode).addEvent("click",function(){this.searchItemList.each(function(t){$$("[name="+t.name+"]").set("value","")}.bind(this)),this.options.page=1,this.createTbody(),this.createPagination()}.bind(this))},getMtSelects:function(){var t=[];return $$('input[name="mtSelectItem"]').each((function(e){e.checked&&t.push(e.getParent().getParent().retrieve("data"))})),t},createTable:function(){this.tableDivNode=new Element("div.profile_common_tableDiv").inject(this.contentNode),this.tableNode=new Element("table",{class:"table is-fullwidth is-hoverable emPowerTable",style:"margin-bottom:0px",width:"100%",border:"0",cellpadding:"0",cellspacing:"0"}).inject(this.tableDivNode),this.createThead(),this.createTbody()},createThead:function(){this.theadNode=new Element("thead").inject(this.tableNode);var t=new Element("tr.first").inject(this.theadNode);this.columns.each((function(e){var i=new Element("th").inject(t);if(e.title&&i.set("text",e.title),e.width&&i.setStyle("width",e.width),e.type&&"checkbox"===e.type){var n=new Element("input",{type:"checkbox",name:"mtSelectAll"}).inject(i);n.addEvent("click",(function(){$$('input[name="mtSelectItem"]').each((function(t){n.checked?t.checked="checked":t.checked=""}))}))}}))},createTbody:function(){this.tbodyNode&&this.tbodyNode.remove(),this.tbodyNode=new Element("tbody").inject(this.tableNode),this.fireEvent("beforeLoadData"),this.dataList.each(function(t){var e=new Element("tr").inject(this.tbodyNode);e.store("data",t),this.columns.each(function(i){var n=new Element("td").inject(e);(i.formatter?i.formatter(t,n):n.set("text",t[i.field]),i.type)&&("operation"===i.type&&i.opButtonList.each(function(e){var i=new Element("a",{class:"button is-link",text:e.text}).inject(n);e.action&&i.addEvent("click",function(i){e.action(t)}.bind(this))}.bind(this)),"checkbox"===i.type&&new Element("input",{type:"checkbox",name:"mtSelectItem"}).inject(n).addEvent("click",(function(t){if(t.target.checked){var e=0;$$('input[name="mtSelectItem"]').each((function(t){t.checked||(e+=1)})),0===e&&($$('input[name="mtSelectAll"]')[0].checked="checked")}else $$('input[name="mtSelectAll"]')[0].checked=""})))}.bind(this))}.bind(this))}});