MWF.xApplication.Setting.Document=new Class({Implements:[Options,Events],initialize:function(t,e,i){this.setOptions(i),this.explorer=t,this.app=this.explorer.app,this.lp=this.app.lp,this.actions=this.app.actions,this.css=this.app.css,this.contentAreaNode=e,this.load()},load:function(){this.node=new Element("div",{styles:{overflow:"hidden","padding-bottom":"80px"}}).inject(this.contentAreaNode),this.titleName=new Element("div",{styles:this.explorer.css.explorerContentTitleNode}).inject(this.node),this.titleName.set("text",this.lp.base_nameSetting),this.baseTitleInput=new MWF.xApplication.Setting.Document.Input(this.explorer,this.node,{lp:{title:this.lp.base_title,infor:this.lp.base_title_infor,action:this.lp.base_title_action},data:{key:"collectData",valueKey:"title",notEmpty:!0,infor:this.lp.base_title_empty},value:this.explorer.collectData.title}),this.baseFooterInput=new MWF.xApplication.Setting.Document.Input(this.explorer,this.node,{lp:{title:this.lp.base_footer,infor:this.lp.base_footer_infor,action:this.lp.base_footer_action},data:{key:"collectData",valueKey:"footer",notEmpty:!1},value:this.explorer.collectData.footer}),this.baseVersionNode=new Element("div",{styles:this.css.explorerContentItemTitleNode,text:this.lp.base_version}).inject(this.node),new Element("div",{styles:this.css.explorerContentInputInforNode,text:"V"+layout.config.version}).inject(this.node)},destroy:function(){this.node.destroy(),this.contentAreaNode.empty(),MWF.release(this)}}),MWF.xApplication.Setting.Document.Input=new Class({Implements:[Options,Events],initialize:function(t,e,i,s){this.setOptions(s),this.explorer=t,this.app=this.explorer.app,this.lp=this.app.lp,this.contentAreaNode=e,this.actions=this.app.actions,this.css=this.app.css,this.data=i,this.load()},load:function(){this.loadInput(this.data.lp.title,this.data.lp.infor,this.data.value,!0,this.data.lp.action,function(){this.inputValueArea.empty(),this.input||(this.input=new Element("input",{disabled:!0,styles:this.css.explorerContentInputNode}).inject(this.inputValueArea)),this.input.set("value",this.data.value),this.input.set({disabled:!1,styles:this.css.explorerContentInputNode_edit}),this.button.setStyle("display","none"),this.input.focus(),this.okButton||(this.okButton=this.createButton(this.lp.ok,function(t){if(this.data.lp.confirm){var e=this;this.app.confirm("warn",t,"",{html:this.data.lp.confirm},400,200,(function(){e.submitData()&&e.editCancel(),this.close()}),(function(){this.close()}))}else this.submitData()&&this.editCancel()}.bind(this)).inject(this.button,"after")),this.cancelButton||(this.cancelButton=this.createButton(this.lp.cancel,function(){this.fireEvent("cancel"),this.editCancel()}.bind(this)).inject(this.okButton,"after")),this.okButton.setStyle("display","block"),this.cancelButton.setStyle("display","block")}.bind(this))},editCancel:function(){this.input.set({disabled:!0,styles:this.css.explorerContentInputNode,value:this.data.value}),this.inputValueArea.empty(),this.input=null,this.inputValueArea.set("text",this.data.show||this.data.value),this.okButton.setStyle("display","none"),this.cancelButton.setStyle("display","none"),this.button.setStyle("display","block")},submitData:function(){var t=this.input.get("value");if(this.data.data.notEmpty&&!t)return this.app.notice(this.data.data.infor,"error"),!1;this.explorer[this.data.data.key][this.data.data.valueKey]=t,this.data.value=t;var e="";return"collectData"==this.data.data.key&&(e="setCollect"),"personData"==this.data.data.key&&(e="setPerson"),"portalData"==this.data.data.key&&(e="setPortal"),"tokenData"==this.data.data.key&&(e="setToken"),"proxyData"==this.data.data.key&&(e="setProxy"),"nativeData"==this.data.data.key&&(e="setAppStyle",this.explorer.nativeData.indexPortal?this.explorer.nativeData.indexType="portal":this.explorer.nativeData.indexType="default"),this.actions[e](this.explorer[this.data.data.key],function(){this.fireEvent("editSuccess"),this.app.notice(this.lp.setSaved,"success")}.bind(this)),!0},createButton:function(t,e){var i=new Element("div",{type:"button",styles:this.css.explorerContentButtonNode,text:t});return i.addEvents({click:function(){e&&e(i)}.bind(this),mouseover:function(){this.setStyle("border","1px solid #999999")},mouseout:function(){this.setStyle("border","1px solid #eeeeee")}}),i},loadInput:function(t,e,i,s,n,a){new Element("div",{styles:this.css.explorerContentItemTitleNode,text:t}).inject(this.contentAreaNode),new Element("div",{styles:this.css.explorerContentInputInforNode,text:e}).inject(this.contentAreaNode);var o=new Element("div",{styles:this.css.explorerContentInputAreaNode}).inject(this.contentAreaNode);this.inputValueArea=new Element("div",{styles:this.css.explorerContentInputValueAreaNode}).inject(o),this.inputValueArea.set("text",this.data.show||i),s&&(this.button=this.createButton(n,a).inject(o))}}),MWF.xApplication.Setting.Document.Check=new Class({Extends:MWF.xApplication.Setting.Document.Input,loadInput:function(t,e,i,s,n,a){new Element("div",{styles:this.css.explorerContentItemTitleNode,text:t}).inject(this.contentAreaNode);if(e)new Element("div",{styles:this.css.explorerContentInputInforNode,text:e}).inject(this.contentAreaNode);var o=new Element("div",{styles:this.css.explorerContentInputAreaNode}).inject(this.contentAreaNode);this.inputValueArea=new Element("div").inject(o),this.inputPoint=new Element("div").inject(this.inputValueArea),this.inputInfor=new Element("div",{styles:this.css.explorerContentCheckInforValueAreaNode}).inject(o),i?(this.inputPoint.setStyles(this.css.explorerContentCheckPointValueAreaNode_on),this.inputValueArea.setStyles(this.css.explorerContentCheckValueAreaNode_on),this.inputInfor.set("text",this.lp.on)):(this.inputPoint.setStyles(this.css.explorerContentCheckPointValueAreaNode_off),this.inputValueArea.setStyles(this.css.explorerContentCheckValueAreaNode_off),this.inputInfor.set("text",this.lp.off)),s&&this.inputValueArea.addEvent("click",function(){if(this.data.value){if(this.data.value=!1,-1!=this.data.data.valueKey.indexOf(".")){var t=this.explorer[this.data.data.key];(e=this.data.data.valueKey.split(".")).each(function(i,s){s==e.length-1?t[i]=!1:t=t[i]}.bind(this))}else this.explorer[this.data.data.key][this.data.data.valueKey]=!1;this.inputPoint.setStyles(this.css.explorerContentCheckPointValueAreaNode_off),this.inputValueArea.setStyles(this.css.explorerContentCheckValueAreaNode_off),this.inputInfor.set("text",this.lp.off)}else{if(this.data.value=!0,-1!=this.data.data.valueKey.indexOf(".")){var e;t=this.explorer[this.data.data.key];(e=this.data.data.valueKey.split(".")).each(function(i,s){s==e.length-1?t[i]=!0:t=t[i]}.bind(this))}else this.explorer[this.data.data.key][this.data.data.valueKey]=!0;this.inputPoint.setStyles(this.css.explorerContentCheckPointValueAreaNode_on),this.inputValueArea.setStyles(this.css.explorerContentCheckValueAreaNode_on),this.inputInfor.set("text",this.lp.on)}var i="";"collectData"==this.data.data.key&&(i="setCollect"),"personData"==this.data.data.key&&(i="setPerson"),"portalData"==this.data.data.key&&(i="setPortal"),"tokenData"==this.data.data.key&&(i="setToken"),"proxyData"==this.data.data.key&&(i="setProxy"),"mobileStyleData"==this.data.data.key&&(i="setProxy"),"nativeData"==this.data.data.key&&(i="setAppStyle",this.explorer.nativeData.indexPortal?this.explorer.nativeData.indexType="portal":this.explorer.nativeData.indexType="default"),this.actions[i](this.explorer[this.data.data.key],function(){this.fireEvent("editSuccess")}.bind(this))}.bind(this))}}),MWF.xApplication.Setting.Document.Select=new Class({Extends:MWF.xApplication.Setting.Document.Input,loadInput:function(t,e,i,s,n,a){new Element("div",{styles:this.css.explorerContentItemTitleNode,text:t}).inject(this.contentAreaNode);if(e)new Element("div",{styles:this.css.explorerContentInputInforNode,text:e}).inject(this.contentAreaNode);var o=new Element("div",{styles:this.css.explorerContentInputAreaNode}).inject(this.contentAreaNode);this.inputValueArea=new Element("div",{styles:this.css.explorerContentInputValueAreaNode}).inject(o),this.input=new Element("select",{styles:this.css.explorerContentSelectValueAreaNode}).inject(this.inputValueArea);("function"===typeOf(this.data.options)?this.data.options():this.data.options).each(function(t){new Element("option",{value:t.value,text:t.text,selected:i==t.value}).inject(this.input)}.bind(this)),s&&this.input.addEvent("change",function(){var t=this.input.options[this.input.selectedIndex].get("value");if(this.data.value=t,-1!=this.data.data.valueKey.indexOf(".")){var e=this.explorer[this.data.data.key],i=this.data.data.valueKey.split(".");i.each(function(s,n){n==i.length-1?e[s]=t:e=e[s]}.bind(this))}else this.explorer[this.data.data.key][this.data.data.valueKey]=t;var s="";"collectData"==this.data.data.key&&(s="setCollect"),"personData"==this.data.data.key&&(s="setPerson"),"portalData"==this.data.data.key&&(s="setPortal"),"tokenData"==this.data.data.key&&(s="setToken"),"proxyData"==this.data.data.key&&(s="setProxy"),"nativeData"==this.data.data.key&&(s="setAppStyle",this.explorer.nativeData.indexPortal?this.explorer.nativeData.indexType="portal":this.explorer.nativeData.indexType="default"),this.actions[s](this.explorer[this.data.data.key],function(){this.fireEvent("editSuccess")}.bind(this))}.bind(this))}}),MWF.xApplication.Setting.Document.Button=new Class({Extends:MWF.xApplication.Setting.Document.Input,loadInput:function(t,e,i,s,n,a){new Element("div",{styles:this.css.explorerContentItemTitleNode,text:t}).inject(this.contentAreaNode);if(e)new Element("div",{styles:this.css.explorerContentInputInforNode,text:e}).inject(this.contentAreaNode);var o=new Element("div",{styles:this.css.explorerContentInputAreaNode}).inject(this.contentAreaNode);this.itemArea=new Element("div",{styles:this.css.explorerContentListActionAreaNode}).inject(o),this.itemIconArea=new Element("div",{styles:this.css.explorerContentListItemIconAreaNode}).inject(this.itemArea),this.itemIcon=new Element("div",{styles:this.css.explorerContentListItemIconNode}).inject(this.itemIconArea),this.itemTextArea=new Element("div",{styles:this.css.explorerContentListActionTextAreaNode}).inject(this.itemArea),this.itemIcon.setStyle("background","url("+this.app.path+this.app.options.style+"/icon/"+this.data.icon+") no-repeat center center");var l=this.data.itemTitle,h=l.match(/\{.+?\}/g);if(h&&h.length)for(var r=0;r<h.length;r++){var c=h[r].substr(0,h[r].lastIndexOf("}"));c=c.substr(c.indexOf("{")+1,c.length);i=this.data[c];var d=new RegExp("\\{"+c+"\\}","g");l=l.replace(d,i)}this.itemTextArea.set("text",l);var p=this;this.itemArea.addEvents({mouseover:function(){p.isSelected||this.setStyles(p.css.explorerContentListActionAreaNode_over)},mouseout:function(){p.isSelected||this.setStyles(p.css.explorerContentListActionAreaNode)},mousedown:function(){p.isSelected||this.setStyles(p.css.explorerContentListActionAreaNode_down)},mouseup:function(){p.isSelected||this.setStyles(p.css.explorerContentListActionAreaNode_over)},click:function(t){p.data.action(t)}})}}),MWF.xApplication.Setting.Document.Image=new Class({Extends:MWF.xApplication.Setting.Document.Input,loadInput:function(t,e,i,s,n,a){var o=new Element("div",{styles:this.css.explorerContentItemTitleNode,text:t}).inject(this.contentAreaNode);if(e)new Element("div",{styles:this.css.explorerContentInputInforNode,text:e}).inject(this.contentAreaNode);var l=new Element("div",{styles:this.css.explorerContentImgInputAreaNode}).inject(this.contentAreaNode);if(this.itemArea=new Element("div",{styles:this.css.explorerContentImgActionAreaNode}).inject(l),this.itemIconArea=new Element("div",{styles:this.css.explorerContentImgItemIconAreaNode}).inject(this.itemArea),this.itemIcon=new Element("div",{styles:this.css.explorerContentImgItemIconNode}).inject(this.itemIconArea),this.data.iconData?this.img=new Element("img",{src:"data:image/png;base64,"+this.data.iconData}).inject(this.itemIcon):this.itemIcon.setStyle("background","url("+this.app.path+this.app.options.style+"/icon/"+this.list.data.icon+") no-repeat center center"),this.itemTextArea=new Element("div",{styles:this.css.explorerContentImgActionTextAreaNode}).inject(this.itemArea),this.itemTextDefaultArea=new Element("div",{styles:this.css.explorerContentImgActionTextAreaNode}).inject(this.itemArea),this.img){var h=this.img.getSize(),r=Math.round(h.x),c=Math.round(h.y);o.set("text",t+this.lp.imgSize+r+" * "+c)}var d=this.data.itemTitle,p=d.match(/\{.+?\}/g);if(p&&p.length)for(var u=0;u<p.length;u++){var m=p[u].substr(0,p[u].lastIndexOf("}"));m=m.substr(m.indexOf("{")+1,m.length);i=this.data[m];var x=new RegExp("\\{"+m+"\\}","g");d=d.replace(x,i)}this.itemTextArea.set("text",d),this.itemTextDefaultArea.set("text",this.lp.defaultImg);var y=this;this.itemTextArea.addEvents({mouseover:function(){this.itemTextArea.setStyles(this.css.explorerContentImgActionTextAreaNode_over)}.bind(this),mouseout:function(){this.itemTextArea.setStyles(this.css.explorerContentImgActionTextAreaNode)}.bind(this),click:function(t){y.changeImage(t)}}),this.itemTextDefaultArea.addEvents({mouseover:function(){this.itemTextDefaultArea.setStyles(this.css.explorerContentImgActionTextAreaNode_over)}.bind(this),mouseout:function(){this.itemTextDefaultArea.setStyles(this.css.explorerContentImgActionTextAreaNode)}.bind(this),click:function(t){y.defaultImage(t)}})},changeImage:function(t){var e="";switch(this.data.value.name){case"launch_logo":e="imageLaunchLogo";break;case"login_avatar":e="imageLoginAvatar";break;case"index_bottom_menu_logo_blur":e="imageMenuLogoBlur";break;case"index_bottom_menu_logo_focus":e="imageMenuLogoFocus";break;case"people_avatar_default":e="imagePeopleAvatarDefault";break;case"process_default":e="imageProcessDefault";break;case"setup_about_logo":e="imageSetupAboutLogo"}MWF.require("MWF.widget.Upload",function(){new MWF.widget.Upload(this.app.content,{data:null,action:this.actions.action,method:e,onCompleted:function(t){this.actions.mobile_currentStyle(function(t){var e=t.data.images.filter(function(t){return t.name==this.data.value.name}.bind(this))[0].value;this.img.set("src","data:image/png;base64,"+e)}.bind(this))}.bind(this)}).load()}.bind(this))},defaultImage:function(t){var e=this,i=this.lp.mobile_style_imgs[this.data.value.name],s=this.lp.mobile_style_imgs_defaultInfor.replace("{name}",i);this.app.confirm("infor",t,this.lp.mobile_style_imgs_defaultTitle,s,360,150,(function(){e.setDefaultImage(),this.close()}),(function(){this.close()}))},setDefaultImage:function(){var t="";switch(this.data.value.name){case"launch_logo":t="imageLaunchLogoErase";break;case"login_avatar":t="imageLoginAvatarErase";break;case"index_bottom_menu_logo_blur":t="imageMenuLogoBlurErase";break;case"index_bottom_menu_logo_focus":t="imageMenuLogoFocusErase";break;case"people_avatar_default":t="imagePeopleAvatarDefaultErase";break;case"process_default":t="imageProcessDefaultErase";break;case"setup_about_logo":t="imageSetupAboutLogoErase"}this.actions[t](function(){this.actions.mobile_currentStyle(function(t){t.data.images.filter(function(t){return t.name==this.data.value.name}.bind(this))[0].data;this.img.set("src","data:image/png;base64,"+this.data.iconData)}.bind(this))}.bind(this))}}),MWF.xApplication.Setting.Document.List=new Class({Extends:MWF.xApplication.Setting.Document.Input,loadInput:function(t,e,i,s,n,a){this.items=[];new Element("div",{styles:this.css.explorerContentItemTitleNode,text:t}).inject(this.contentAreaNode);if(e)new Element("div",{styles:this.css.explorerContentInputInforNode,text:e}).inject(this.contentAreaNode);var o=new Element("div",{styles:this.css.explorerContentListAreaNode}).inject(this.contentAreaNode);if(this.type="object"==typeOf(i)?"object":"list",n){this.actionArea=new Element("div",{styles:this.css.explorerContentListActionAreaNode}).inject(o);var l=new Element("div",{styles:this.css.explorerContentListActionIconAreaNode}).inject(this.actionArea),h=new Element("div",{styles:this.css.explorerContentListActionIconNode}).inject(l);"object"==this.type&&h.setStyle("background","url("+this.app.path+this.app.options.style+"/icon/edit.png) no-repeat center center");new Element("div",{styles:this.css.explorerContentListActionTextAreaNode,text:n}).inject(this.actionArea);this.actionArea.addEvents({mouseover:function(){this.actionArea.setStyles(this.css.explorerContentListActionAreaNode_over)}.bind(this),mouseout:function(){this.actionArea.setStyles(this.css.explorerContentListActionAreaNode)}.bind(this),mousedown:function(){this.actionArea.setStyles(this.css.explorerContentListActionAreaNode_down)}.bind(this),mouseup:function(){this.actionArea.setStyles(this.css.explorerContentListActionAreaNode_over)}.bind(this),click:function(){"list"==this.type&&this.addItem(),"object"==this.type&&this.items[0].edit()}.bind(this)})}this.itemArea=new Element("div",{styles:{overflow:"hidden",clear:"both"}}).inject(o),"list"==this.type&&i.length&&i.length&&i.each(function(t){this.createItem(t)}.bind(this)),"object"==this.type&&this.createItem(i)},createItem:function(t){this.items.push(new MWF.xApplication.Setting.Document.List.Item(this,t))},addItem:function(){new MWF.xApplication.Setting.Document.List.ItemEditor(this,Object.clone(this.data.addItem),function(t){this.data.value.push(t),this.save(t)}.bind(this))},save:function(t){if("publicData"==this.data.data.key)o2.UD.putPublicData("faceKeys",this.explorer[this.data.data.key],function(){this.fireEvent("editSuccess"),this.reloadItems()}.bind(this));else{var e="";"collectData"==this.data.data.key&&(e="setCollect"),"personData"==this.data.data.key&&(e="setPerson"),"portalData"==this.data.data.key&&(e="setPortal"),"tokenData"==this.data.data.key&&(e="setToken"),"proxyData"==this.data.data.key&&(e="setProxy"),"nativeData"==this.data.data.key&&(e="setAppStyle",this.explorer.nativeData.indexPortal?this.explorer.nativeData.indexType="portal":this.explorer.nativeData.indexType="default"),this.actions[e](this.explorer[this.data.data.key],function(){this.fireEvent("editSuccess"),this.reloadItems()}.bind(this))}},reloadItems:function(){this.itemArea.empty(),this.items=[],"list"==this.type&&this.data.value.length&&this.data.value.length&&this.data.value.each(function(t){this.createItem(t)}.bind(this)),"object"==this.type&&this.createItem(this.data.value)}}),MWF.xApplication.Setting.Document.List.ItemEditor=new Class({initialize:function(t,e,i,s){this.list=t,this.title=s,this.explorer=this.list.explorer,this.app=this.explorer.app,this.lp=this.app.lp,this.actions=this.app.actions,this.css=this.app.css,this.data=e,this.isSelected=!1,this.saveAction=i,this.load()},load:function(){var t=this.list.actionArea?this.list.actionArea.getPosition(this.app.content):this.list.itemArea.getPosition(this.app.content),e=.9*(n=this.app.content.getSize()).x;e>600&&(e=600);var i=0;Object.each(this.data,function(t,e){if(this.list.data.readonly&&-1==this.list.data.readonly.indexOf(e)||!this.list.data.readonly)switch(typeOf(t)){case"string":i+=80;break;case"object":i+=180;break;default:i+=80}}.bind(this));var s=i+80,n=this.app.content.getSize();s>n.y&&(s=n.y);var a=(n.x-e)/2,o=(n.y-s)/2,l=this;MWF.require("MWF.xDesktop.Dialog",function(){var i=new MWF.xDesktop.Dialog({title:this.title||this.list.data.lp.action||this.list.data.lp.editAction,style:"setting",top:o,left:a,fromTop:t.y,fromLeft:t.x,width:e,height:s,html:"",maskNode:this.app.content,container:this.app.content,buttonList:[{text:this.lp.ok,action:function(){l.save(this)}},{text:this.lp.cancel,action:function(){this.close()}}]});i.show(),this.content=new Element("div",{styles:this.css.explorerContentListEditAreaNode}).inject(i.content),this.inputs={},Object.each(this.data,function(t,e){if(this.list.data.readonly&&-1==this.list.data.readonly.indexOf(e)||!this.list.data.readonly){if(new Element("div",{styles:this.css.explorerContentListEditTitleNode,text:this.lp.list[e]||e}).inject(this.content),"string"==typeOf(t)&&(this.inputs[e]=new Element("input",{styles:this.css.explorerContentListEditInputNode,value:t}).inject(this.content)),"number"==typeOf(t)&&(this.inputs[e]=new Element("input",{styles:this.css.explorerContentListEditInputNode,value:t}).inject(this.content)),"object"==typeOf(t)){var i=new Element("div",{styles:this.css.explorerContentListEditMapNode}).inject(this.content);MWF.require("MWF.widget.Maplist",function(){var s=new MWF.widget.Maplist(i,{title:this.lp.list[e],style:"setting"});s.load(t),this.inputs[e]=s}.bind(this))}"boolean"==typeOf(t)&&(this.inputs[e]=new Element("select",{html:"<option value='true' "+(t?"selected":"")+">yes</option><option value='false' "+(t?"":"selected")+">no</option>"}).inject(this.content),this.inputs[e].getValue=function(){return this.options[this.selectedIndex].value})}}.bind(this))}.bind(this))},save:function(t){Object.keys(this.inputs);var e={},i=!0;Object.each(this.inputs,function(t,s){if(this.list.data.readonly&&-1==this.list.data.readonly.indexOf(s)||!this.list.data.readonly){var n="element"==typeOf(t)&&"select"!=t.tagName.toString().toLowerCase()?t.get("value"):t.getValue();if(this.list.data.data.notEmpty&&!n&&!1!==n)return i=!1,this.app.notice(this.lp.pleaseInput+(this.lp.list[s]||s),"error"),!1;e[s]=n,"proxyHost"===s&&n.indexOf("http")>-1&&(i=!1,this.app.notice(this.lp.list.infoProxyHost,"error"))}}.bind(this)),i&&(Object.each(this.data,function(t,i){"number"==typeOf(this.data[i])&&(this.data[i]=e[i].toFloat()),"boolean"==typeOf(this.data[i])?this.data[i]="true"===e[i]:this.list.data.data.notEmpty?this.data[i]=e[i]||t:this.data[i]=e[i]||""}.bind(this)),this.saveAction&&this.saveAction(this.data),t.close())}}),MWF.xApplication.Setting.Document.List.Item=new Class({initialize:function(t,e){this.list=t,this.explorer=this.list.explorer,this.app=this.explorer.app,this.lp=this.app.lp,this.content=this.list.itemArea,this.actions=this.app.actions,this.css=this.app.css,this.data=e,this.isSelected=!1,this.load()},load:function(){this.itemArea=new Element("div",{styles:this.css.explorerContentListActionAreaNode}).inject(this.content),this.itemIconArea=new Element("div",{styles:this.css.explorerContentListItemIconAreaNode}).inject(this.itemArea),this.itemIcon=new Element("div",{styles:this.css.explorerContentListItemIconNode}).inject(this.itemIconArea),this.itemTextArea=new Element("div",{styles:this.css.explorerContentListActionTextAreaNode}).inject(this.itemArea),this.list.data.iconData?(this.itemArea.setStyles(this.css.explorerContentListActionAreaNode_img),this.itemIconArea.setStyles(this.css.explorerContentListItemIconAreaNode_img),this.img=new Element("img",{src:"data:image/png;base64,"+this.list.data.iconData}).inject(this.itemIcon)):this.itemIcon.setStyle("background","url("+this.app.path+this.app.options.style+"/icon/"+this.list.data.icon+") no-repeat center center");var t=this.list.data.itemTitle,e=t.match(/\{.+?\}/g);if(e&&e.length)for(var i=0;i<e.length;i++){var s=e[i].substr(0,e[i].lastIndexOf("}"));s=s.substr(s.indexOf("{")+1,s.length);var n=this.data[s],a=new RegExp("\\{"+s+"\\}","g");t=t.replace(a,n)}this.itemTextArea.set("text",t);var o=this;this.itemArea.addEvents({mouseover:function(){o.isSelected||this.setStyles(o.css.explorerContentListActionAreaNode_over)},mouseout:function(){o.isSelected||this.setStyles(o.css.explorerContentListActionAreaNode)},mousedown:function(){o.isSelected||this.setStyles(o.css.explorerContentListActionAreaNode_down)},mouseup:function(){o.isSelected||this.setStyles(o.css.explorerContentListActionAreaNode_over)},click:function(){o.isSelected||o.clickItem(this)}})},clickItem:function(){this.list.items.each(function(t){t.isSelected&&t.unSelected()}.bind(this)),"object"!=this.list.type&&this.list.data.lp.action?(this.itemArea.setStyles(this.css.explorerContentListActionAreaNode_selected),this.isSelected=!0,this.createAction()):this.edit()},unSelected:function(){this.itemArea.setStyles(this.css.explorerContentListActionAreaNode),this.actionArea&&this.actionArea.setStyle("display","none"),this.isSelected=!1},createAction:function(){this.actionArea?this.actionArea.setStyle("display","block"):(this.actionArea=new Element("div",{styles:this.css.explorerContentListItemActionAreaNode}).inject(this.itemArea),this.createActionButton(this.lp.delete,function(t,e){var i=this;this.app.confirm("infor",e,this.lp.deleteItem,this.lp.deleteItemInfor,400,150,(function(){i.deleteItem(),this.close()}),(function(){this.close()}))}.bind(this)),this.createActionButton(this.lp.edit,function(t,e){this.edit()}.bind(this)))},edit:function(){new MWF.xApplication.Setting.Document.List.ItemEditor(this.list,this.data,function(t){this.list.save(t)}.bind(this),this.list.data.lp.editAction)},createActionButton:function(t,e){var i=new Element("div",{styles:this.css.explorerContentListItemActionNode,text:t}).inject(this.actionArea);i.addEvents({click:function(t){e&&e(i,t)}.bind(this),mouseover:function(){this.setStyle("border","1px solid #999999")},mouseout:function(){this.setStyle("border","1px solid #eeeeee")}})},deleteItem:function(){this.list.data.value.erase(this.data),this.list.save(),this.destroy()},destroy:function(){this.itemArea.destroy(),MWF.release(this)}});