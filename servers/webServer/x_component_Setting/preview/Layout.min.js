MWF.xApplication.Setting.preview=MWF.xApplication.Setting.preview||{},MWF.xApplication.Setting.preview.Layout=new Class({Extends:MWF.xDesktop.Layout,Implements:[Options,Events],options:{style:"default",topShim:"layout_top_shim",top:"layout_top",desktop:"layout_desktop",content:"desktop_content",navi:"desktop_navi"},categoryCount:20,processCount:40,initialize:function(t,e){this.setOptions(e),this.initData(),this.session.user=layout.desktop.session.user,this.node=$(t)},initNode:function(t){this.path=MWF.defaultPath+"/xDesktop/$Layout/";this.node.set("html",'<div id="layout" style="overflow: hidden; height: 100%; background-size: cover;">\n            <div id="layout_top_shim"></div>\n            <div id="layout_top"></div>\n            <div id="layout_desktop">\n            <div id="desktop_content">\n         \n            <div id="desktop_navi"></div>\n        </div>\n        </div>'),this.node=this.node.getFirst(),this.topShimNode=this.node.getElement("#"+this.options.topShim),this.topNode=this.node.getElement("#"+this.options.top),this.topAreaNode=this.node.getElement("#"+this.options.top),this.desktopNode=this.node.getElement("#"+this.options.desktop),this.contentNode=this.node.getElement("#"+this.options.content),this.naviNode=this.node.getElement("#"+this.options.navi),this.node&&this.node.setStyles(this.css.layoutNode),this.topShimNode&&this.topShimNode.setStyles(this.css.layoutTopShimNode),this.topNode&&this.topNode.setStyles(this.css.layoutTopNode),this.desktopNode&&this.desktopNode.setStyles(this.css.desktopNode),this.contentNode&&this.contentNode.setStyles(this.css.contentNode),this.naviNode&&this.naviNode.setStyles(this.css.naviNode),this.node.setStyle("background-image",this.css.desktop.background),this.node.setStyles(this.options.styles)},initData:function(t){this.apps={},this.widgets={},this.appCurrentList=[],this.lnkAreas=[],this.lnks=[],this.currentApp=null,this.status=null,this.session={},this.serviceAddressList=null},load:function(){this.initNode(),this.loadDesktop(),this.loadWindow()},loadWindow:function(){var t={style:"desktop_default",title:"app",isResize:!0,isMax:!0,isRefresh:!0,container:this.node,width:"400",height:"280",top:"100",left:"50",fromTop:"0",fromLeft:"0",isMove:!1};this.window=new MWF.xDesktop.Window(this.app,t),this.window.css=this.windowCss,this.content=this.window.content,this.window.reStyle(),this.window.showNoAnimation(!1,!1)},maxOrRestoreSize:function(){},loadDesktop:function(){this.setHeight();var t=this.desktopNode.getSize();this.size={x:t.x,y:t.y},this.loadTop(),this.loadLnkArea()},loadLnkAreaContainer:function(){this.lnkAreaContainer=new Element("div",{styles:{height:"100%",overflow:"hidden"}}).inject(this.contentNode)},loadLnkArea:function(){this.lnkAreaContainer||this.loadLnkAreaContainer();var t=new Element("div",{styles:this.css.dsektopLnkArea}).inject(this.lnkAreaContainer);this.lnkAreas.push(t);var e=t.getSize().x*this.lnkAreas.length,s=this.contentNode.getSize();this.lnkAreaContainer.setStyle("width",Math.max(e,s.x)+"px"),this.setCurrentLnkArea()},setCurrentLnkArea:function(){if(this.lnkAreas.length>1){var t=this.lnkAreas[0].getSize().x,e=t*this.lnkAreas.length,s=this.contentNode.getSize(),i=this.lnkAreas[this.lnkAreas.length-1];e<s.x?(e-=t,i.setStyles({width:"auto","margin-left":e+"px",float:"none"})):i.setStyles(this.css.dsektopLnkArea)}else this.lnkAreas.length&&this.lnkAreas[0].setStyles({width:"auto","margin-left":"0px",float:"none"})},addLnkArea:function(){this.lnkAreas.length&&this.lnkAreas[this.lnkAreas.length-1].setStyles(this.css.dsektopLnkArea),this.loadLnkArea()},addLnk:function(t){var e=new MWF.xDesktop.Lnk(t.icon,t.title,t.par);this.lnkAreas.length||this.loadLnkArea(),e.inject(this.lnkAreas[this.lnkAreas.length-1]),this.lnks.push(e)},resizeLnk:function(){if(this.lnkAreaContainer)if(this.lnkAreas.length>1){var t=this.lnkAreas[0].getSize().x*this.lnkAreas.length,e=this.contentNode.getSize();this.lnkAreaContainer.setStyle("width",Math.max(t,e.x)+"px")}else this.lnkAreaContainer.setStyle("width",this.contentNode.getSize().x+"px");var s=0,i=0;if(this.lnks.each(function(t,e){for(;!this.lnkAreas[s];)this.addLnkArea();var o=this.lnkAreas[s];t.inject(o),i++,(t.node.getSize().y+t.node.getStyle("margin-top").toFloat())*(i+1)>o.getSize().y&&(e<this.lnks.length-1&&s++,i=0)}.bind(this)),this.lnkAreas.length)for(;this.lnkAreas.length>s+1;)this.lnkAreas.pop().destroy();this.setCurrentLnkArea()},setHeight:function(){this.resizeHeight(),$(window).addEvent("resize",function(){this.resizeHeight()}.bind(this))},resizeHeight:function(){var t=this.topNode.getSize().y,e=this.node.getSize().y-t;this.desktopNode.setStyle("height",e+"px"),this.desktopHeight=e,e-=this.naviNode.getSize().y,this.contentNode.setStyle("height",e+"px"),this.resizeLnk(),this.resizeMessage(),this.setTaskitemSize(),this.top&&this.top.userPanel&&this.top.userPanel.setPosition(),this.fireEvent("resize")},setTaskitemSize:function(){if(this.top){var t=this.top.taskbar.getSize(),e=this.top.taskbar.getChildren(),s=0;if(e.length){for(var i=e[0].getStyles("border-left-width","border-right-width","margin-left","margin-right","padding-left","padding-right"),o=0;o<e.length;o++)e[o].setStyle("width","auto"),s+=e[o].getSize().x+i["border-left-width"].toInt()+i["border-right-width"].toInt()+i["margin-left"].toInt()+i["margin-right"].toInt()+i["padding-left"].toInt()+i["padding-right"].toInt();if(s>t.x-10){var n=(t.x-10)/e.length-i["border-left-width"].toInt()-i["border-right-width"].toInt()-i["margin-left"].toInt()-i["margin-right"].toInt()-i["padding-left"].toInt()-i["padding-right"].toInt();e.each((function(t){t.setStyle("width",n+"px")}))}else e.each((function(t){t.setStyle("width","auto")}))}}},resizeMessage:function(){this.message&&this.message.resize()},loadTop:function(){this.top||(this.top=new MWF.xApplication.Setting.preview.Layout.Top(this.topNode,this),this.top.load())},getNodeBackground:function(){MWF.UD.getDataJson("layoutDesktop",function(t){var e=MWF.defaultPath+"/xDesktop/$Layout/"+this.options.style+"/desktop.jpg";t&&(currentSrc=t.src,e=MWF.defaultPath+"/xDesktop/$Layout/"+currentSrc+"/desktop.jpg"),this.node.setStyle("background-image","url("+e+")")}.bind(this),!1)}}),MWF.xApplication.Setting.preview.Layout.Taskitem=new Class({initialize:function(t,e){this.layout=e,this.app=t,this.node=new Element("div",{styles:this.layout.css.taskItemNode,title:this.app.options.title+(this.app.appId?"-"+this.app.appId:"")}).inject(this.layout.top.taskbar),this.iconNode=new Element("div",{styles:this.layout.css.taskItemIconNode}).inject(this.node),this.iconNode.setStyle("background-image","url("+this.app.options.icon+")"),this.closeNode=new Element("div",{styles:this.layout.css.taskItemCloseNode}).inject(this.node),this.textNode=new Element("div",{styles:this.layout.css.taskItemTextNode}).inject(this.node),this.textNode.set("text",this.app.options.title),this.setTaskitemSize(),this.setEvent()},setTaskitemSize:function(){var t=this.layout.top.taskbar.getSize(),e=this.layout.top.taskbar.getChildren(),s=0;if(e.length){for(var i=e[0].getStyles("border-left-width","border-right-width","margin-left","margin-right","padding-left","padding-right"),o=0;o<e.length;o++)e[o].setStyle("width","auto"),s+=e[o].getSize().x+i["border-left-width"].toInt()+i["border-right-width"].toInt()+i["margin-left"].toInt()+i["margin-right"].toInt()+i["padding-left"].toInt()+i["padding-right"].toInt();if(s>t.x-10){var n=(t.x-10)/e.length-i["border-left-width"].toInt()-i["border-right-width"].toInt()-i["margin-left"].toInt()-i["margin-right"].toInt()-i["padding-left"].toInt()-i["padding-right"].toInt();e.each((function(t){t.setStyle("width",n+"px")}))}else e.each((function(t){t.setStyle("width","auto")}))}},setText:function(t){this.textNode.set("text",t||this.app.options.title)},setEvent:function(){this.textNode.addEvents({mouseover:function(){this.layout.currentApp&&this.layout.currentApp.taskitem==this||this.node.setStyles(this.layout.css.taskItemNode_over)}.bind(this),mouseout:function(){this.layout.currentApp&&this.layout.currentApp.taskitem==this||this.node.setStyles(this.layout.css.taskItemNode)}.bind(this),mousedown:function(){this.layout.currentApp&&this.layout.currentApp.taskitem==this||this.node.setStyles(this.layout.css.taskItemNode_down)}.bind(this),mouseup:function(){this.layout.currentApp&&this.layout.currentApp.taskitem==this||this.node.setStyles(this.layout.css.taskItemNode_over)}.bind(this),click:function(){this.layout.currentApp==this.app?this.app.minSize():this.app.setCurrent()}.bind(this)}),this.iconNode.addEvents({mouseover:function(){this.layout.currentApp&&this.layout.currentApp.taskitem==this||this.node.setStyles(this.layout.css.taskItemNode_over)}.bind(this),mouseout:function(){this.layout.currentApp&&this.layout.currentApp.taskitem==this||this.node.setStyles(this.layout.css.taskItemNode)}.bind(this),mousedown:function(){this.layout.currentApp&&this.layout.currentApp.taskitem==this||this.node.setStyles(this.layout.css.taskItemNode_down)}.bind(this),mouseup:function(){this.layout.currentApp&&this.layout.currentApp.taskitem==this||this.node.setStyles(this.layout.css.taskItemNode_over)}.bind(this),click:function(){this.layout.currentApp==this.app?this.app.minSize():this.app.setCurrent()}.bind(this)}),this.node.addEvents({mouseover:function(){this.closeNode.fade("in")}.bind(this),mouseout:function(){this.closeNode.fade("out")}.bind(this)}),this.closeNode.addEvent("click",function(){this.app.close()}.bind(this))},selected:function(){this.node.setStyles(this.layout.css.taskItemNode_current)},unSelected:function(){this.node.setStyles(this.layout.css.taskItemNode)},changStyle:function(){this.node&&(this.layout.currentApp&&this.layout.currentApp.taskitem==this?(this.node.setStyles(this.layout.css.taskItemNode),this.node.setStyles(this.layout.css.taskItemNode_current)):this.node.setStyles(this.layout.css.taskItemNode)),this.iconNode&&this.iconNode.setStyles(this.layout.css.taskItemIconNode),this.textNode&&this.textNode.setStyles(this.layout.css.taskItemTextNode)},destroy:function(){this.node.destroy()}}),MWF.xApplication.Setting.preview.Layout.Top=new Class({initialize:function(t,e){this.layout=e,this.node=$(t),this.userApplicationsLog=[],this.sysApplicationsLog=[]},load:function(){this.loadMenuAction(),this.loadSeparate(),this.loadShowDesktop(),this.loadClock(),this.loadSeparate("right"),this.loadUserMenu(),this.loadStyleAction(),this.loadUserChat(),this.loadMessageAction(),this.loadSeparate("right"),this.loadTaskbar()},loadMenuAction:function(){this.loadMenuAction=new Element("div",{styles:this.layout.css.loadMenuAction,title:MWF.LP.desktop.menuAction}).inject(this.node)},loadShowDesktop:function(){this.showDesktopAction=new Element("div",{styles:this.layout.css.showDesktopAction}).inject(this.node)},loadSeparate:function(t){var e=new Element("div.separateNode",{styles:this.layout.css.separateNode}).inject(this.node);t&&e.setStyle("float",t)},loadTaskbar:function(){this.taskbar=new Element("div",{styles:this.layout.css.taskbar}).inject(this.node)},loadUserChat:function(){this.userChatNode=new Element("div",{styles:this.layout.css.userChatNode,title:MWF.LP.desktop.userChat}).inject(this.node)},loadStyleAction:function(){this.styleActionNode=new Element("div",{styles:this.layout.css.styleActionNode,title:MWF.LP.desktop.styleAction}).inject(this.node)},loadMessageAction:function(){this.messageActionNode=new Element("div",{styles:this.layout.css.messageActionNode,title:MWF.LP.desktop.showMessage}).inject(this.node)},loadUserMenu:function(){this.userMenuNode=new Element("div",{styles:this.layout.css.userMenuNode,title:MWF.LP.desktop.userMenu}).inject(this.node)},loadClock:function(){this.clockNode=new Element("div",{styles:this.layout.css.clockNode}).inject(this.node),this.setTime()},setTime:function(){var t=new Date,e=1e3-t.getMilliseconds(),s=60-t.getSeconds(),i=t.format("%Y/%m/%d#%H:%M");dl=i.split("#"),this.clockNode.set("html",dl[1]+"<br/>"+dl[0]),window.setTimeout(this.setTime.bind(this),1e3*s+e)}});