var MDomItem_ClassType={text:"Text",textarea:"Textarea",hidden:"Hidden",password:"Password",radio:"Radio",checkbox:"Checkbox",select:"Select",multiselect:"Multiselect",innertext:"Innertext",innerhtml:"Innerhtml",img:"Img",button:"Button",mselector:"MSelector",imageclipper:"ImageClipper",rtf:"Rtf",org:"Org",a:"A"},MDomItem=new Class({Implements:[Options,Events],options:{name:"",value:"",text:"",type:"",isEdited:!0,tType:"",orgType:"",unitType:"",count:1,units:[],groups:[],exclude:[],expandSubEnable:!0,orgStyle:"",unsetDefaultEvent:!1,event:null,selectValue:"",selectText:"",defaultValue:"",className:"",style:{},attr:{},notEmpty:!1,defaultValueAsEmpty:!1,emptyTip:null,disable:!1,warningType:"batch",validImmediately:!1,validRule:null,validMessage:null,RTFConfig:null,mSelectorOptions:null,calendarOptions:null,orgWidgetOptions:null},initialize:function(t,e,i,s,n){this.form=i,this.tr=i,this.parent=i,this.app=s,this.container=$(t),this.css=n,this.valSeparator=/,|;|\^\^|\|/,this.mElement=this.container,this.items=[],this.setOptionList(e)},setOptionList:function(t){var e=[];for(var i in t)if("validRule"!=i&&"validMessage"!=i&&"on"!=i.substr(0,2)&&"function"==typeOf(t[i])){var s=t[i];s.length&&"callback"==/\(\s*([\s\S]*?)\s*\)/.exec(s)[1].split(/\s*,\s*/)[0]?e.push(i):t[i]=s(t)}this.setFunOption(t,e,!0)},setFunOption:function(t,e,i){if(this.optionsReady=!1,0==e.length)this.setOptions(t),this.optionsReady=!0,this.loadFunctionCalled&&this.load();else{i&&(t=Object.merge({},t));var s=e.shift();(0,t[s])(function(i){t[s]=i,this.setFunOption(t,e,!1)}.bind(this),t)}},load:function(){this.optionsReady?this.options.disable||(this.options.type||(this.options.type=this.options.orgType?"org":"text"),this.options.type=this.options.type.toLowerCase(),this.fireEvent("queryLoad"),this.createElement(),this.fireEvent("postLoad",[this])):this.loadFunctionCalled=!0},editMode:function(){this.options.isEdited=!0,this.dispose(),this.load()},save:function(){this.options.value=this.getValue()},readMode:function(){this.options.isEdited=!1,this.dispose(),this.load()},enable:function(){this.options.disable=!1,this.dispose(),this.load()},disable:function(){this.options.disable=!0,this.dispose()},createElement:function(){if(!this.options.disable){var t=MDomItem_ClassType[this.options.type];return t&&(this.dom=new MDomItem[t](this),this.dom.load()),this.container}},get:function(t){return this.options.disable?{text:"",value:""}:this.dom?this.dom.get(t):void 0},getValue:function(t,e){var i=this.get(null,e).value;return t&&"array"==typeOf(i)?i.join(t):i},getText:function(t,e){var i=this.get(null,e).text;return t&&"array"==typeOf(i)?i.join(t):i},getModifiedValue:function(t){var e=this.getValue(t);return e==this.options.value?null:e},getModifiedText:function(){this.getText();return text==this.options.text?null:text},getVaildValue:function(t,e,i,s){return!(t&&!this.verify(!i))&&(s?this.getModifiedValue(e):this.getValue(e))},set:function(t,e){this.setValue(e)},resetItemOptions:function(t,e,i){if(this.options.disable){if(!i)return;this.options.disable=!1}"radio,checkbox,select,multiselect".split(",").contains(this.options.type)&&(this.dispose(),this.options.selectValue=t,this.options.selectText=e,this.createElement())},reset:function(){this.setValue(this.options.defaultValue||"")},setValue:function(t){this.dom&&this.dom.setValue(t)},setStyles:function(t){this.options.disable||this.items.each((function(e){e.setStyles(t)}))},getElements:function(){return this.options.disable?null:this.mElement.getElements("[name='"+this.options.name+"']")},dispose:function(){this.container.empty()},verify:function(t){var e=!0;if(!this.options.isEdited)return e;if(this.options.disable)return e;if("batch"==this.options.warningType)this.isNotEmpty(t)||(e=!1),this.checkValid(t)||(e=!1);else if(!this.isNotEmpty(t)||!this.checkValid(t))return!1;return e},isNotEmpty:function(t){return!this.options.isEdited||(!!this.options.disable||!!(1!=this.options.notEmpty&&"yes"!=this.options.notEmpty||this.checkNotEmpty(t)))},checkNotEmpty:function(t){if(this.options.disable)return!0;var e=this.getValue(),i="array"===typeOf(e)?0==e.length:""==e||" "==e;if(!i&&this.options.defaultValueAsEmpty&&(i="array"===typeOf(e)?1==e.length&&e[0]==this.options.defaultValue:e==this.options.defaultValue),!i)return this.clearWarning("empty"),!0;if(!t)return!1;var s=this.options.text,n=this.mElement.getElements("[name='"+this.options.name+"']"),o="";try{if(o=this.options.emptyTip||this.dom&&this.dom.getErrorText()||MWF.xApplication.Template.LP.MDomItem.emptyTip.replace("{text}",s),"batch"==this.options.warningType)this.setWarning(o,"empty");else if("single"==this.options.warningType)this.setWarning(o,"empty");else{if(this.app&&this.app.notice){if(!this.container.isIntoView()){for(var a=this.container.getParent();a&&(a.getScrollSize().y-(a.getComputedSize().height+1)<=0||"visible"===a.getStyle("overflow"));)a=a.getParent();a||(a=document.body),a.scrollToNode(this.container,"bottom")}var l=this.container.getSize().y;this.app.notice(o,"error",this.container,{x:"right",y:"top"},{x:10,y:l})}this.options.validImmediately||["text","password","textarea","select","multiselect"].contains(this.options.type)&&n[0].focus()}this.fireEvent("empty",this)}catch(t){}return!1},clearWarning:function(t){this.tipNode&&this.setedEmpty&&(this.fireEvent("unempty",this),this.tipNode.empty(),this.setedEmpty=!1),"empty"==t?this.warningEmptyNode&&(this.fireEvent("unempty",this),this.warningEmptyNode.destroy(),this.warningEmptyNode=null):this.warningInvalidNode&&(this.fireEvent("unempty",this),this.warningInvalidNode.destroy(),this.warningInvalidNode=null),this.warningStatus=!1},setWarning:function(t,e){var i;"empty"==e?this.tipNode?(this.setedEmpty=!0,(i=this.tipNode).set("html","")):this.warningEmptyNode?(i=this.warningEmptyNode).set("html",""):(i=this.warningEmptyNode=new Element("div")).inject(this.container):this.tipNode?(this.setedEmpty=!0,(i=this.tipNode).set("html","")):this.warningInvalidNode?(i=this.warningInvalidNode).set("html",""):(i=this.warningInvalidNode=new Element("div")).inject(this.container),this.warningStatus=!0,"array"!=typeOf(t)&&(t=[t]),t.each(function(t){new Element("div",{text:t,styles:this.css.warningMessageNode}).inject(i)}.bind(this))},checkValid:function(t){if(this.options.disable)return!0;var e=this.getValue(),i=this.options.validRule;if(!i)return!0;var s=[],n=!0;for(var o in i){var a=!0,l=i[o];if("function"==typeof l)a=l.call(this,e,this);else if(this.validMethod[o]){a=this.validMethod[o].call(this,e,l,this)}if(!a&&t){var h=this.getValidMessage(o,l);""!=h&&s.push(h)}a||(n=!1)}if(s.length>0){if("batch"==this.options.warningType)this.setWarning(s,"invaild");else if("single"==this.options.warningType)this.setWarning(s,"invaild");else if(this.app&&this.app.notice){if(!this.container.isIntoView()){for(var r=this.container.getParent();r&&(r.getScrollSize().y-(r.getComputedSize().height+1)<=0||"visible"===r.getStyle("overflow"));)r=r.getParent();r||(r=document.body),r.scrollToNode(this.container,"bottom")}var p=this.container.getSize().y;this.app.notice(s.join("\n"),"error",this.container,{x:"right",y:"top"},{x:10,y:p})}this.fireEvent("empty",this)}else this.warningInvalidNode&&(this.warningInvalidNode.destroy(),this.warningInvalidNode=null),this.fireEvent("unempty",this);return n},validMethod:{email:function(t){return/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(t)},url:function(t){return/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(t)},phoneNumber:function(t){return/^0?1[0-9]\d{9}$/.test(t)},date:function(t){return!/Invalid|NaN/.test(new Date(t).toString())},dateISO:function(t){return/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(t)},number:function(t){return/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(t)},digits:function(t){return/^\d+$/.test(t)},minlength:function(t,e){return t.length>=e},maxlength:function(t,e){return t.length<=e},rangelength:function(t,e){return t.length>=e[0]&&t.length<=e[1]},min:function(t,e){return t>=e},max:function(t,e){return t<=e},range:function(t,e){return t>=e[0]&&t<=e[1]},extension:function(t,e){return e="array"==typeOf(e)?e.join("|"):e.replace(/,/g,"|"),t.match(new RegExp(".("+e+")$","i"))}},getValidMessage:function(t,e){var i=this.options.validMessage;if(i&&"object"==typeOf(i)&&i[t])return"function"==typeof i[t]?i[t].call(this):i[t];var s=MWF.xApplication.Template.LP.MDomItem;switch(t){case"email":return s.emailTip;case"url":return s.urlTip;case"phoneNumber":return s.phoneNumberTip;case"date":return s.dateTip;case"dateISO":return s.dateISOTip;case"number":return s.numberTip;case"digits":return s.digitsTip;case"maxlength":return s.maxlengthTip.replace("{n}",e);case"minlength":return s.minlengthTip.replace("{n}",e);case"rangelength":return s.rangelengthTip.replace("{n0}",e[0]).replace("{n1}",e[1]);case"range":return s.rangeTip.replace("{n0}",e[0]).replace("{n1}",e[1]);case"min":return s.minTip.replace("{n}",e);case"max":return s.maxTip.replace("{n}",e);case"extension":return s.extensionTip.replace("{text}",e);default:return s.defaultTip.replace("{text}",this.options.text)}},destroy:function(){this.dom&&this.dom.OrgWidgetList&&this.dom.OrgWidgetList.each((function(t){t.destroy()})),this.mElement&&this.mElement.empty(),MWF.release(this)}});MDomItem.Util={selectCalendar:function(t,e,i,s){var n,o=i.type,a={style:"xform",isTime:"time"==o||"datetime"==o.toLowerCase(),timeOnly:"time"==o,target:e,onComplate:function(t,e){s&&s(t,e)}.bind(this)};return i.calendarOptions&&(a=Object.merge(a,i.calendarOptions)),MWF.require("MWF.widget.Calendar",function(){(n=new MWF.widget.Calendar(t,a)).show()}.bind(this),!1),n},selectPerson:function(t,e,i){MWF.xDesktop.requireApp("Selector","package",null,!1);var s="",n=[],o=e.type;"array"==typeOf(o)?o.length>1?n=o:s=0==o.length?"person":o[0]||"person":s=o||"person";var a={type:s,types:n,title:e.title,count:e.count,values:e.selectedValues||[],units:e.units,unitType:e.unitType,groups:e.groups,expand:e.expand,exclude:e.exclude||[],expandSubEnable:e.expandSubEnable,onComplete:function(t){i&&i(t)}.bind(this)};0===a.types.length&&(a.types=null);new MWF.O2Selector(t,a)},replaceText:function(t,e,i,s){"number"==typeOf(t)&&(t=[t]),"number"==typeOf(e)&&(e=[e]),"number"==typeOf(i)&&(i=[i]);for(var n="array"==typeOf(t)?t:t.split(s),o="array"==typeOf(e)?e:e.split(s),a="array"==typeOf(i)?i:i.split(s),l=0;l<n.length;l++)for(var h=0;h<o.length;h++)n[l]==o[h]&&(n[l]=a[h]);return n},getEvents:function(events){if(events&&""!=events&&"$none"!=events){if("string"==typeof events)if(events.indexOf("^^")>-1){var eventsArr=events.split("##");if(2!=eventsArr[0].split("^^").length)return;events={};for(var i=0;i<eventsArr.length;i++){var ename=eventsArr[i].split("^^")[0],efunction=eventsArr[i].split("^^")[1];events[ename]=eval("(function(){ return "+efunction+" })()")}}else eval("var events = "+events);return events}},bindEvent:function(t,e,i){if(i=MDomItem.Util.getEvents(i),"object"==typeOf(i))for(var s in i)e.addEvent(s,function(e){this.fun.call(e?e.target:null,t.module||t,e)}.bind({fun:i[s]}))}},MDomItem.Text=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.app=t.app,this.items=t.items,this.container=this.mElement=t.container},load:function(){this.options.isEdited?this.loadEdit():this.loadRead()},loadEdit:function(){var t,e,i=this.module,s=this.options;e="boolean"===typeOf(s.value)?s.value.toString():s.value||s.defaultValue;var n=i.container,o=this.getClassName();(t=new Element("input",{type:"text",name:s.name,value:e})).set(s.attr||{}),o&&this.css&&this.css[o]&&t.setStyles(this.css[o]),t.setStyles(s.style||{}),this.bindDefaultEvent(t),MDomItem.Util.bindEvent(this,t,s.event),n&&t.inject(n),this.items.push(t)},loadRead:function(){var t,e,i=this.module,s=this.options,n=this.getClassName(),o=i.container;e="boolean"===typeOf(s.value)?s.value.toString():s.value||s.defaultValue,(t=new Element("span",{name:s.name,text:e})).set(s.attr),n&&this.css&&this.css[n]&&t.setStyles(this.css[n]),t.setStyles(s.style||{}),o&&t.inject(o),this.items.push(t)},get:function(t){if(this.options.disable)return"value"==t||"text"==t?null:{value:null,text:null};var e,i=this.options.name,s=this.mElement.getElement("[name='"+i+"']");return e=this.options.isEdited?s.get("value"):s.get("text"),"value"==t||"text"==t?e:{value:e,text:e}},setValue:function(t){if(!this.options.disable){var e=this.mElement.getElement("[name='"+this.options.name+"']");this.options.isEdited?e.set("value",t):e.set("text",t)}},getErrorText:function(){return MWF.xApplication.Template.LP.MDomItem.emptyTip.replace("{text}",this.options.text)},getClassName:function(){var t=this.options.tType,e=null;return"none"==this.options.className||(""!=this.options.className?e=this.options.className:this.options.isEdited&&(e="array"==typeOf(t)?t.contains("identity")||t.contains("person")||t.contains("unit")?"inputPerson":"inputText":t?"number"==t?"inputText":"time"==t||"date"==t||"datetime"==t.toLowerCase()?"inputTime":"identity"==t||"person"==t||"unit"==t.toLowerCase()?"inputPerson":"inputText":"inputText")),e},bindDefaultEvent:function(t){if(!this.options.unsetDefaultEvent){var e=this.options.tType;"array"==typeOf(e)||"identity"==e||"person"==e.toLowerCase()||"unit"==e?t.addEvent("click",function(i){this.module.fireEvent("querySelect",this.module);var s=this.options,n={type:e,title:s.text,count:s.count,selectedValues:this.get("value").split(","),units:s.units,unitType:s.unitType,groups:s.groups,expand:s.expand};MDomItem.Util.selectPerson(this.app.content,n,function(e){t.empty(),this.orgData=this.module.orgData=[],this.orgObject=this.module.orgObject=e,e.each(function(t){this.orgData.push(t.data.distinguishedName||t.data.name)}.bind(this)),t.set("value",this.orgData.join(",")),this.items[0].fireEvent("change",[this.module,i]),this.options.validImmediately&&this.module.verify(!0)}.bind(this))}.bind(this)):"number"==e?(t.addEvent("keyup",(function(){this.value=this.value.replace(/[^\d.]/g,"")})),this.options.validImmediately&&t.addEvent("blur",function(){this.module.verify(!0)}.bind(this))):"time"==e||"datetime"==e.toLowerCase()||"date"==e?t.addEvent("click",function(i){this.module.fireEvent("querySelect",this.module),this.calendarSelector?this.calendarSelector.show():this.calendarSelector=MDomItem.Util.selectCalendar(t,this.app.content,{calendarOptions:this.options.calendarOptions,type:e},function(t,e){this.items[0].fireEvent("change",[this.module,i]),this.options.validImmediately&&this.module.verify(!0)}.bind(this))}.bind(this)):this.options.validImmediately&&t.addEvent("blur",function(){this.module.verify(!0)}.bind(this))}}}),MDomItem.Textarea=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.app=t.app,this.items=t.items,this.container=this.mElement=t.container},load:function(){this.options.isEdited?this.loadEdit():this.loadRead()},loadEdit:function(){var t,e,i=this.module,s=this.options;e="boolean"===typeOf(s.value)?s.value.toString():s.value||s.defaultValue;var n=i.container,o=this.getClassName();(t=new Element("textarea",{name:s.name,value:e})).set(s.attr||{}),o&&this.css&&this.css[o]&&t.setStyles(this.css[o]),t.setStyles(s.style||{}),this.bindDefaultEvent(t),MDomItem.Util.bindEvent(this,t,s.event),n&&t.inject(n),this.items.push(t)},loadRead:function(){var t,e,i=this.module,s=this.options,n=this.getClassName(),o=i.container;e="boolean"===typeOf(s.value)?s.value.toString():s.value||s.defaultValue,(t=new Element("span",{name:s.name,text:e})).set(s.attr||{}),n&&this.css&&this.css[n]&&t.setStyles(this.css[n]),t.setStyles(s.style||{}),o&&t.inject(o),this.items.push(t)},bindDefaultEvent:function(t){this.options.unsetDefaultEvent||this.options.validImmediately&&t.addEvent("blur",function(){this.module.verify(!0)}.bind(this))},get:function(t){if(this.options.disable)return"value"==t||"text"==t?null:{value:null,text:null};var e,i=this.options.name,s=this.mElement.getElement("[name='"+i+"']");return e=this.options.isEdited?s.get("value"):s.get("text"),"value"==t||"text"==t?e:{value:e,text:e}},setValue:function(t){if(!this.options.disable){var e=this.mElement.getElement("[name='"+this.options.name+"']");this.options.isEdited?e.set("value",t):e.set("text",t)}},getErrorText:function(){return MWF.xApplication.Template.LP.MDomItem.emptyTip.replace("{text}",this.options.text)},getClassName:function(){this.options.tType;var t=null;return"none"==this.options.className||(""!=this.options.className?t=this.options.className:this.options.isEdited&&(t="inputTextarea")),t}}),MDomItem.Hidden=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.app=t.app,this.items=t.items,this.container=this.mElement=t.container},load:function(){var t=this.container,e=new Element("input",{type:"hidden",name:this.options.name,value:this.options.value});e.set(this.options.attr||{}),t&&e.inject(t),this.items.push(e)},get:function(t){if(this.options.disable)return"value"==t||"text"==t?null:{value:null,text:null};var e,i=this.options.name,s=this.mElement.getElement("[name='"+i+"']");return e=this.options.isEdited?s.get("value"):s.get("text"),"value"==t||"text"==t?e:{value:e,text:e}},setValue:function(t){this.options.disable||this.mElement.getElement("[name='"+this.options.name+"']").set("value",t)},getErrorText:function(){return MWF.xApplication.Template.LP.MDomItem.emptyTip.replace("{text}",this.options.text)}}),MDomItem.Password=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.app=t.app,this.items=t.items,this.container=this.mElement=t.container},load:function(){this.options.isEdited&&this.loadEdit()},loadEdit:function(){var t,e,i=this.module,s=this.options;e="boolean"===typeOf(s.value)?s.value.toString():s.value||s.defaultValue;var n=i.container,o=this.getClassName();(t=new Element("input",{type:"password",name:s.name,value:e})).set(s.attr||{}),o&&this.css&&this.css[o]&&t.setStyles(this.css[o]),t.setStyles(s.style||{}),this.bindDefaultEvent(t),MDomItem.Util.bindEvent(this,t,s.event),n&&t.inject(n),this.items.push(t)},loadRead:function(){},bindDefaultEvent:function(t){this.options.unsetDefaultEvent||this.options.validImmediately&&t.addEvent("blur",function(){this.module.verify(!0)}.bind(this))},get:function(t){if(this.options.disable)return"value"==t||"text"==t?null:{value:null,text:null};var e,i=this.options.name,s=this.mElement.getElement("[name='"+i+"']");return e=this.options.isEdited?s.get("value"):options.value||options.defaultValue,"value"==t||"text"==t?e:{value:e,text:e}},setValue:function(t){this.options.disable||(this.options.isEdited?this.mElement.getElement("[name='"+this.options.name+"']").set("value",t):this.options.value=t)},getErrorText:function(){return MWF.xApplication.Template.LP.MDomItem.emptyTip.replace("{text}",this.options.text)},getClassName:function(){this.options.tType;var t=null;return"none"==this.options.className||(""!=this.options.className?t=this.options.className:this.options.isEdited&&(t="inputPassword")),t}}),MDomItem.Radio=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.app=t.app,this.items=t.items,this.container=this.mElement=t.container,this.valSeparator=t.valSeparator},load:function(){this.options.isEdited?this.loadEdit():this.loadRead()},loadEdit:function(){var t,e,s=this,n=this.options.name;e="boolean"===typeOf(this.options.value)?this.options.value.toString():this.options.value||this.options.defaultValue;var o=this.options.selectValue||this.options.selectText,a=this.options.selectText||this.options.selectValue,l=this.options.event,h=this.options.style||{},r=this.options.attr||{},p=this.container,u=this.getClassName(),c="array"==typeOf(o)?o:o.split(this.valSeparator),m="array"==typeOf(a)?a:a.split(this.valSeparator);for(i=0;i<c.length;i++){t=new Element("div"),u&&this.css&&this.css[u]&&t.setStyles(this.css[u]),t.setStyles(h);var d=new Element("input",{type:"radio",name:n,value:c[i],checked:c[i]==e}).inject(t);d.set(r),new Element("span",{text:m[i]}).inject(t).addEvent("click",function(t){this.input.checked=!this.input.checked;var e=MDomItem.Util.getEvents(s.options.event);"object"==typeOf(e)&&(e.change&&e.change.call(this.input,s.module,t),e.click&&e.click.call(this.input,s.module,t)),s.options.validImmediately&&s.module.verify(!0)}.bind({input:d})),this.options.validImmediately&&d.addEvent("click",function(){this.module.verify(!0)}.bind(this)),MDomItem.Util.bindEvent(this,t,l),p&&t.inject(p),this.items.push(t)}},loadRead:function(){var t,e,i=this.options.name;e="boolean"===typeOf(this.options.value)?this.options.value.toString():this.options.value||this.options.defaultValue;var s=this.options.selectValue||this.options.selectText,n=this.options.selectText||this.options.selectValue,o=this.options.style||{},a=this.options.attr||{},l=this.container,h=this.getClassName();s&&n&&(e=(e=MDomItem.Util.replaceText(e,s,n,this.valSeparator)).join(",")),(t=new Element("span",{name:i,text:e})).set(a),h&&this.css&&this.css[h]&&t.setStyles(this.css[h]),t.setStyles(o),l&&t.inject(l),this.items.push(t)},get:function(t){if(this.options.disable)return"value"==t||"text"==t?null:{value:null,text:null};var e,i,s,n=this.options.name;if(s=this.mElement.getElements("[name='"+n+"']"),this.options.isEdited?s.each((function(t){t.checked&&(e=t.get("value"),i=t.getParent().get("text").trim())})):(i=s[0].get("text"),e=this.options.selectValue&&this.options.selectText?MDomItem.Util.replaceText(i,this.options.selectText,this.options.selectValue,this.valSeparator).join():i),e||(e=""),i||(i=e),"value"==t)return e;if("text"==t)return i;var o={};return o.value=e,o.text=i,o},setValue:function(t){if(!this.options.disable){var e=this.mElement.getElements("[name='"+this.options.name+"']");this.options.isEdited?e.each((function(e){e.get("value")==t&&(e.checked=!0)})):(t=(t=MDomItem.Util.replaceText(t,this.options.selectValue,this.options.selectText,this.valSeparator)).join(","),e[0].set("text",t))}},getErrorText:function(){return MWF.xApplication.Template.LP.MDomItem.selectTip.replace("{text}",this.options.text)},getClassName:function(){var t=null;return"none"==this.options.className||(""!=this.options.className?t=this.options.className:this.options.isEdited&&(t="inputRadio")),t}}),MDomItem.Checkbox=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.app=t.app,this.items=t.items,this.container=this.mElement=t.container,this.valSeparator=t.valSeparator},load:function(){this.options.isEdited?this.loadEdit():this.loadRead()},loadEdit:function(){var t,e,i,s=this,n=this.options.name;i="boolean"===typeOf(this.options.value)?this.options.value.toString():this.options.value||this.options.defaultValue;var o=this.options.selectValue||this.options.selectText,a=this.options.selectText||this.options.selectValue,l=this.options.event,h=this.options.style||{},r=this.options.attr||{},p=(this.options.isEdited,this.mElement=this.container),u=this.getClassName();e="string"==typeOf(i)?i.split(this.valSeparator):i,e="array"==typeOf(i)?i:[i];for(var c="array"==typeOf(o)?o:o.split(this.valSeparator),m="array"==typeOf(a)?a:a.split(this.valSeparator),d=0;d<c.length;d++){t=new Element("div"),u&&this.css&&this.css[u]&&t.setStyles(this.css[u]),t.setStyles(h);var v=new Element("input",{type:"checkbox",name:n,value:c[d],checked:e.contains(c[d])}).inject(t);v.set(r),new Element("span",{text:m[d]}).inject(t).addEvent("click",function(t){this.input.checked=!this.input.checked;var e=MDomItem.Util.getEvents(s.options.event);"object"==typeOf(e)&&(e.change&&e.change.call(this.input,s.module,t),e.click&&e.click.call(this.input,s.module,t)),s.options.validImmediately&&s.module.verify(!0)}.bind({input:v})),this.options.validImmediately&&t.addEvent("click",function(){this.module.verify(!0)}.bind(this)),MDomItem.Util.bindEvent(this,t,l),p&&t.inject(p),this.items.push(t)}},loadRead:function(){var t,e,i=this.options.name;e="boolean"===typeOf(this.options.value)?this.options.value.toString():this.options.value||this.options.defaultValue;var s=this.options.selectValue||this.options.selectText,n=this.options.selectText||this.options.selectValue,o=this.options.style||{},a=this.options.attr||{},l=this.mElement=this.container,h=this.getClassName();s&&n&&(e=(e=MDomItem.Util.replaceText(e,s,n,this.valSeparator)).join(",")),(t=new Element("span",{name:i,text:e})).set(a),h&&this.css&&this.css[h]&&t.setStyles(this.css[h]),t.setStyles(o),l&&t.inject(l),this.items.push(t)},get:function(t){if(this.options.disable)return"value"==t||"text"==t?null:{value:null,text:null};var e,i,s,n=this.options.name;if(s=this.mElement.getElements("[name='"+n+"']"),this.options.isEdited?(e=[],i=[],s.each((function(t){t.checked&&(e.push(t.get("value")),i.push(t.getParent().get("text").trim()))}))):(i=s[0].get("text"),e=this.options.selectValue&&this.options.selectText?MDomItem.Util.replaceText(i,this.options.selectText,this.options.selectValue,this.valSeparator):i),e||(e=""),i||(i=e),"value"==t)return e;if("text"==t)return i;var o={};return o.value=e,o.text=i,o},setValue:function(t){if(!this.options.disable){var e=this.mElement.getElements("[name='"+this.options.name+"']");if(this.options.isEdited){var i="array"==typeOf(t)?t:t.split("^^");e.each((function(t){i.contains(t.get("value"))?t.checked=!0:t.checked=!1}))}else t=(t=MDomItem.Util.replaceText(t,this.options.selectValue,this.options.selectText,this.valSeparator)).join(","),e[0].set("text",t)}},getErrorText:function(){return MWF.xApplication.Template.LP.MDomItem.selectTip.replace("{text}",this.options.text)},getClassName:function(){this.options.tType;var t=null;return"none"==this.options.className||(""!=this.options.className?t=this.options.className:this.options.isEdited&&(t="inputCheckbox")),t}}),MDomItem.Select=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.app=t.app,this.items=t.items,this.container=this.mElement=t.container,this.valSeparator=t.valSeparator},load:function(){this.options.disable||(this.options.isEdited?this.loadEdit():this.loadRead())},loadEdit:function(){var t,e,s=this.options.name;e="boolean"===typeOf(this.options.value)?this.options.value.toString():this.options.value||this.options.defaultValue;var n=this.options.selectValue||this.options.selectText,o=this.options.selectText||this.options.selectValue,a=this.options.event,l=this.options.style||{},h=this.options.attr||{},r=this.container,p=this.getClassName();(t=new Element("select",{name:s})).set(h),p&&this.css&&this.css[p]&&t.setStyles(this.css[p]),t.setStyles(l);var u="array"==typeOf(n)?n:n.split(this.valSeparator),c="array"==typeOf(o)?o:o.split(this.valSeparator);for(i=0;i<u.length;i++)new Element("option",{value:u[i],selected:u[i]==e,text:c[i]}).inject(t);this.options.validImmediately&&t.addEvent("change",function(){this.module.verify(!0)}.bind(this)),MDomItem.Util.bindEvent(this,t,a),r&&t.inject(r),this.items.push(t)},loadRead:function(){var t,e,i=this.options.name;e="boolean"===typeOf(this.options.value)?this.options.value.toString():this.options.value||this.options.defaultValue;var s=this.options.selectValue||this.options.selectText,n=this.options.selectText||this.options.selectValue,o=this.options.style||{},a=this.options.attr||{},l=this.mElement=this.container,h=this.getClassName();s&&n&&(e=(e=MDomItem.Util.replaceText(e,s,n,this.valSeparator)).join(",")),(t=new Element("span",{name:i,text:e})).set(a),h&&this.css&&this.css[h]&&t.setStyles(this.css[h]),t.setStyles(o),l&&t.inject(l),this.items.push(t)},get:function(t){if(this.options.disable)return"value"==t||"text"==t?null:{value:null,text:null};var e,i,s,n=this.options.name;if(s=this.mElement.getElements("[name='"+n+"']"),this.options.isEdited?s[0].getElements("option").each((function(t){t.selected&&(e=t.get("value"),i=t.get("text").trim())})):(i=s[0].get("text"),e=this.options.selectValue&&this.options.selectText?MDomItem.Util.replaceText(i,this.options.selectText,this.options.selectValue,this.valSeparator).join():i),e||(e=""),i||(i=e),"value"==t)return e;if("text"==t)return i;var o={};return o.value=e,o.text=i,o},setValue:function(t){if(!this.options.disable){var e=this.mElement.getElements("[name='"+this.options.name+"']");this.options.isEdited?e[0].getElements("option").each((function(e){e.get("value")==t&&(e.selected=!0)})):(t=(t=MDomItem.Util.replaceText(t,this.options.selectValue,this.options.selectText,this.valSeparator)).join(","),e[0].set("text",t))}},getErrorText:function(){return MWF.xApplication.Template.LP.MDomItem.selectTip.replace("{text}",this.options.text)},getClassName:function(){this.options.tType;var t=null;return"none"==this.options.className||(""!=this.options.className?t=this.options.className:this.options.isEdited&&(t="inputSelect")),t}}),MDomItem.Multiselect=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.app=t.app,this.items=t.items,this.container=this.mElement=t.container,this.valSeparator=t.valSeparator},load:function(){this.options.disable||(this.options.isEdited?this.loadEdit():this.loadRead())},loadEdit:function(){var t,e,s,n=this.options.name;s="boolean"===typeOf(this.options.value)?this.options.value.toString():this.options.value||this.options.defaultValue;var o=this.options.selectValue||this.options.selectText,a=this.options.selectText||this.options.selectValue,l=this.options.event,h=this.options.style||{},r=this.options.attr||{},p=this.container,u=this.getClassName();e="string"==typeOf(s)?s.split(this.valSeparator):s,e="array"==typeOf(s)?s:[s],(t=new Element("select",{name:n,multiple:!0})).set(r),u&&this.css&&this.css[u]&&t.setStyles(this.css[u]),t.setStyles(h);var c="array"==typeOf(o)?o:o.split(this.valSeparator),m="array"==typeOf(a)?a:a.split(this.valSeparator);for(i=0;i<c.length;i++)new Element("option",{value:c[i],selected:e.contains(c[i]),text:m[i]}).inject(t);this.options.validImmediately&&t.addEvent("change",function(){this.module.verify(!0)}.bind(this)),MDomItem.Util.bindEvent(this,t,l),p&&t.inject(p),this.items.push(t)},loadRead:function(){var t,e,i=this.options.name;e="boolean"===typeOf(this.options.value)?this.options.value.toString():this.options.value||this.options.defaultValue;var s=this.options.selectValue||this.options.selectText,n=this.options.selectText||this.options.selectValue,o=this.options.style||{},a=this.options.attr||{},l=this.container,h=this.getClassName();s&&n&&(e=(e=MDomItem.Util.replaceText(e,s,n,this.valSeparator)).join(",")),(t=new Element("span",{name:i,text:e})).set(a),h&&this.css&&this.css[h]&&t.setStyles(this.css[h]),t.setStyles(o),l&&t.inject(l),this.items.push(t)},get:function(t){if(this.options.disable)return"value"==t||"text"==t?null:{value:null,text:null};var e,i,s,n=this.options.name;if(s=this.mElement.getElements("[name='"+n+"']"),this.options.isEdited?(e=[],i=[],s[0].getElements("option").each((function(t){t.selected&&(e.push(t.get("value")),i.push(t.get("text").trim()))}))):(i=s[0].get("text"),e=this.options.selectValue&&this.options.selectText?MDomItem.Util.replaceText(i,this.options.selectText,this.options.selectValue,this.valSeparator):i),e||(e=""),i||(i=e),"value"==t)return e;if("text"==t)return i;var o={};return o.value=e,o.text=i,o},setValue:function(t){if(!this.options.disable){var e=this.mElement.getElements("[name='"+this.options.name+"']");if(this.options.isEdited){var i="array"==typeOf(t)?t:t.split("^^");e[0].getElements("option").each((function(t){i.contains(t.get("value"))?t.selected=!0:t.selected=!1}))}else t=(t=MDomItem.Util.replaceText(t,this.options.selectValue,this.options.selectText,this.valSeparator)).join(","),e[0].set("text",t)}},getErrorText:function(){return MWF.xApplication.Template.LP.MDomItem.selectTip.replace("{text}",this.options.text)},getClassName:function(){this.options.tType;var t=null;return"none"==this.options.className||(""!=this.options.className?t=this.options.className:this.options.isEdited&&(t="inputMultiselect")),t}}),MDomItem.Innertext=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.app=t.app,this.items=t.items,this.container=this.mElement=t.container,this.valSeparator=t.valSeparator},load:function(){if(!this.options.disable){var t,e,i=this.options.name;e="boolean"===typeOf(this.options.value)?this.options.value.toString():this.options.value||this.options.defaultValue;var s=this.options.selectValue||this.options.selectText,n=this.options.selectText||this.options.selectValue,o=this.options.style||{},a=this.options.attr||{},l=this.mElement=this.container,h=this.getClassName();s&&n&&(e=(e=MDomItem.Util.replaceText(e,s,n,this.valSeparator)).join(",")),(t=new Element("span",{name:i,text:e})).set(a),h&&this.css&&this.css[h]&&t.setStyles(this.css[h]),t.setStyles(o),this.options.isEdited&&MDomItem.Util.bindEvent(this,t,this.options.event),l&&t.inject(l),this.items.push(t)}},get:function(t){if(this.options.disable)return"value"==t||"text"==t?null:{value:null,text:null};var e,i,s=this.options.name;if(i=this.mElement.getElement("[name='"+s+"']").get("text"),(e=this.options.selectValue&&this.options.selectText?MDomItem.Util.replaceText(i,this.options.selectText,this.options.selectValue,this.valSeparator):i)||(e=""),i||(i=e),"value"==t)return e;if("text"==t)return i;var n={};return n.value=e,n.text=i,n},setValue:function(t){this.options.disable||(t=(t=MDomItem.Util.replaceText(t,this.options.selectValue,this.options.selectText,this.valSeparator)).join(","),this.mElement.getElement("[name='"+this.options.name+"']").set("text",t))},getErrorText:function(){return MWF.xApplication.Template.LP.MDomItem.emptyTip.replace("{text}",this.options.text)},getClassName:function(){this.options.tType;var t=null;return"none"==this.options.className||(""!=this.options.className?t=this.options.className:this.options.isEdited),t}}),MDomItem.Innerhtml=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.app=t.app,this.items=t.items,this.container=this.mElement=t.container,this.valSeparator=t.valSeparator},load:function(){if(!this.options.disable){var t,e,i=this.options.name;e="boolean"===typeOf(this.options.value)?this.options.value.toString():this.options.value||this.options.defaultValue;var s=this.options.selectValue||this.options.selectText,n=this.options.selectText||this.options.selectValue,o=this.options.style||{},a=this.options.attr||{},l=this.mElement=this.container,h=this.getClassName();s&&n&&(e=(e=MDomItem.Util.replaceText(e,s,n,this.valSeparator)).join(",")),(t=new Element("span",{name:i,html:e})).set(a),h&&this.css&&this.css[h]&&t.setStyles(this.css[h]),t.setStyles(o),this.options.isEdited&&MDomItem.Util.bindEvent(this,t,this.options.event),l&&t.inject(l),this.items.push(t)}},get:function(t){if(this.options.disable)return"value"==t||"text"==t?null:{value:null,text:null};var e,i,s=this.options.name;if(i=this.mElement.getElement("[name='"+s+"']").get("html"),(e=this.options.selectValue&&this.options.selectText?MDomItem.Util.replaceText(i,this.options.selectText,this.options.selectValue,this.valSeparator):i)||(e=""),i||(i=e),"value"==t)return e;if("text"==t)return i;var n={};return n.value=e,n.text=i,n},setValue:function(t){this.options.disable||(t=(t=MDomItem.Util.replaceText(t,this.options.selectValue,this.options.selectText,this.valSeparator)).join(","),this.mElement.getElement("[name='"+this.options.name+"']").set("html",t))},getErrorText:function(){return MWF.xApplication.Template.LP.MDomItem.emptyTip.replace("{text}",this.options.text)},getClassName:function(){this.options.tType;var t=null;return"none"==this.options.className||(""!=this.options.className?t=this.options.className:this.options.isEdited),t}}),MDomItem.Img=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.items=t.items,this.container=this.mElement=t.container},load:function(){if(!this.options.disable){var t,e=this.options.name,i=this.options.value||this.options.defaultValue,s=this.options.event,n=this.options.style||{},o=this.options.attr||{},a=this.container,l=this.getClassName();(t=new Element("img",{name:e,src:i})).set(o),l&&this.css&&this.css[l]&&t.setStyles(this.css[l]),t.setStyles(n),MDomItem.Util.bindEvent(this,t,s),a&&t.inject(a),this.items.push(t)}},get:function(t){if(this.options.disable)return"value"==t||"text"==t?null:{value:null,text:null};var e,i,s=this.options.name;if((e=this.mElement.getElement("[name='"+s+"']").get("src"))||(e=""),i||(i=e),"value"==t)return e;if("text"==t)return i;var n={};return n.value=e,n.text=i,n},setValue:function(t){this.options.disable||this.mElement.getElement("[name='"+this.options.name+"']").set("src",t)},getErrorText:function(){return MWF.xApplication.Template.LP.MDomItem.emptyTip.replace("{text}",this.options.text)},getClassName:function(){this.options.tType;var t=null;return"none"==this.options.className||(""!=this.options.className?t=this.options.className:this.options.isEdited),t}}),MDomItem.Button=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.items=t.items,this.container=this.mElement=t.container},load:function(){if(!this.options.disable){var t,e,i=this.options.name;e="boolean"===typeOf(this.options.value)?this.options.value.toString():this.options.value||this.options.defaultValue;var s=this.options.event,n=this.options.style||{},o=this.options.attr||{},a=this.container,l=this.getClassName();(t=new Element("button",{type:"button",name:i,value:e,text:e})).set(o),l&&this.css&&this.css[l]&&t.setStyles(this.css[l]),t.setStyles(n),MDomItem.Util.bindEvent(this,t,s),a&&t.inject(a),this.items.push(t)}},get:function(t){if(this.options.disable)return"value"==t||"text"==t?null:{value:null,text:null};var e,i,s=this.options.name;if((e=this.mElement.getElement("[name='"+s+"']").get("value"))||(e=""),i||(i=e),"value"==t)return e;if("text"==t)return i;var n={};return n.value=e,n.text=i,n},setValue:function(t){this.options.disable||this.mElement.getElement("[name='"+this.options.name+"']").set("value",t)},getErrorText:function(){return MWF.xApplication.Template.LP.MDomItem.emptyTip.replace("{text}",this.options.text)},getClassName:function(){var t=null;return"none"==this.options.className||(""!=this.options.className?t=this.options.className:this.options.isEdited&&(t="inputButton")),t}}),MDomItem.A=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.items=t.items,this.container=this.mElement=t.container},load:function(){if(!this.options.disable){var t,e,i=this.options.name;e="boolean"===typeOf(this.options.value)?this.options.value.toString():this.options.value||this.options.defaultValue;var s=this.options.event,n=this.options.style||{},o=this.options.attr||{},a=this.container,l=this.getClassName();(t=new Element("a",{name:i,value:e,text:e})).set(o),l&&this.css&&this.css[l]&&t.setStyles(this.css[l]),t.setStyles(n),MDomItem.Util.bindEvent(this,t,s),a&&t.inject(a),this.items.push(t)}},get:function(t){if(this.options.disable)return"value"==t||"text"==t?null:{value:null,text:null};var e,i,s=this.options.name;if((e=this.mElement.getElement("[name='"+s+"']").get("value"))||(e=""),i||(i=e),"value"==t)return e;if("text"==t)return i;var n={};return n.value=e,n.text=i,n},setValue:function(t){this.options.disable||this.mElement.getElement("[name='"+this.options.name+"']").set("value",t)},getErrorText:function(){return MWF.xApplication.Template.LP.MDomItem.emptyTip.replace("{text}",this.options.text)},getClassName:function(){var t=null;return"none"==this.options.className||(""!=this.options.className?t=this.options.className:this.options.isEdited&&(t="inputA")),t}}),MDomItem.MSelector=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.app=t.app,this.items=t.items,this.container=this.mElement=t.container,this.valSeparator=t.valSeparator},load:function(){if(!this.options.disable){var t;MWF.xDesktop.requireApp("Template","MSelector",null,!1),t="boolean"===typeOf(this.options.value)?this.options.value.toString():this.options.value||this.options.defaultValue;var e=this.options.selectValue||this.options.selectText,i=this.options.selectText||this.options.selectValue;if(this.mSelectorOptions={style:"default",width:"230px",height:"30px",defaultOptionLp:MWF.xApplication.Template.LP.MDomItem.defaultOption,trigger:"delay",isSetSelectedValue:!0,inputEnable:!1,isCreateReadNode:!1,textField:"",valueField:"",value:t,text:"",defaultVaue:this.options.defaultValue,selectValue:e,selectText:i,isEdited:this.options.isEdited},this.options.mSelectorOptions&&(this.mSelectorOptions=Object.merge(this.mSelectorOptions,this.options.mSelectorOptions)),this.mSelectorOptions.value=t,!this.options.isEdited){var s,n=this.options.name,o=this.options.attr||{},a=this.getClassName(),l=this.options.style||{},h=this.container;this.mSelectorOptions.onLoadReadNode=function(t){this.items.length>0&&h.empty(),(s=new Element("span",{name:n,text:t})).set(o),a&&this.css&&this.css[a]&&s.setStyles(this.css[a]),s.setStyles(l),h&&s.inject(h),this.items.push(s)}.bind(this)}this.mSelector=new MSelector(this.container,this.mSelectorOptions,this.app,this.css),this.mSelector.load()}},get:function(t){return this.options.disable?"value"==t||"text"==t?null:{value:null,text:null}:"value"==t?this.mSelector.getValue():"text"==t?this.mSelector.getText():this.mSelector.get()},setValue:function(t){this.mSelector.setValue(t)},getErrorText:function(){return MWF.xApplication.Template.LP.MDomItem.emptyTip.replace("{text}",this.options.text)},getClassName:function(){var t=null;return"none"==this.options.className||(""!=this.options.className?t=this.options.className:this.options.isEdited),t}}),MDomItem.ImageClipper=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.app=t.app,this.items=t.items,this.container=this.mElement=t.container,this.valSeparator=t.valSeparator},load:function(){this.options.disable||(this.options.isEdited?this.loadEdit():this.loadRead())},loadEdit:function(){var t;this.options.name;t="boolean"===typeOf(this.options.value)?this.options.value.toString():this.options.value||this.options.defaultValue;var e=this.options.style||{},i=this.container;this.imageId=this.module.imageId=t,t&&i&&(e.imageWrapStyle&&(this.imageWrap=new Element("div",{styles:e.imageWrapStyle}).inject(i)),this.image=new Element("img",{src:MWF.xDesktop.getImageSrc(t)}).inject(this.imageWrap||i),this.image.addEvent("click",function(){window.open(o2.filterUrl(MWF.xDesktop.getImageSrc(this.imageId)),"_blank")}.bind(this)),e.imageStyle&&this.image.setStyles(e.imageStyle));var s=new Element("button",{text:MWF.xApplication.Template.LP.MDomItem.setPicture}).inject(i);e.actionStyle&&s.setStyles(e.actionStyle),s.addEvents({click:function(){MWF.xDesktop.requireApp("Template","widget.ImageClipper",null,!1),this.clipper=new MWF.xApplication.Template.widget.ImageClipper(this.app,{imageUrl:t?MWF.xDesktop.getImageSrc(t):"",aspectRatio:this.options.aspectRatio||0,ratioAdjustedEnable:this.options.ratioAdjustedEnable||!1,reference:this.options.reference,referenceType:this.options.referenceType,onChange:function(){this.image&&this.image.destroy(),this.imageWrap&&this.imageWrap.destroy(),e.imageWrapStyle&&(this.imageWrap=new Element("div",{styles:e.imageWrapStyle}).inject(i,"top")),this.image=new Element("img",{src:this.clipper.imageSrc}).inject(this.imageWrap||i,"top"),e.imageStyle&&this.image.setStyles(e.imageStyle),this.image.addEvent("click",function(){window.open(o2.filterUrl(MWF.xDesktop.getImageSrc(this.imageId)),"_blank")}.bind(this)),this.imageId=this.module.imageId=this.clipper.imageId,this.options.validImmediately&&this.module.verify(!0)}.bind(this)}),this.clipper.load()}.bind(this)})},loadRead:function(){var t=this.options.value||this.options.defaultValue,e=this.container;if(this.imageId=this.module.imageId=t,t&&e){this.image=new Element("img",{src:MWF.xDesktop.getImageSrc(t)}).inject(e);var i=this.options.style||{};i.imageStyle&&this.image.setStyles(i.imageStyle)}},get:function(t){if(this.options.disable)return"value"==t||"text"==t?null:{value:null,text:null};var e=this.imageId;if("value"==t)return e;if("text"==t)return e;var i={};return i.value=e,i.text=e,i},setValue:function(t){if(!this.options.disable){var e=this.options.style||{};this.imageId=this.module.imageId=t,t&&(this.image?this.image.set("src",MWF.xDesktop.getImageSrc(t)):(e.imageWrapStyle&&(this.imageWrap=new Element("div",{styles:e.imageWrapStyle}).inject(this.container)),this.image=new Element("img",{src:MWF.xDesktop.getImageSrc(t)}).inject(this.imageWrap||this.container),e.imageStyle&&this.image.setStyles(e.imageStyle)))}},getErrorText:function(){return MWF.xApplication.Template.LP.MDomItem.uploadPictureNotice+"："+this.options.text}}),MDomItem.Rtf=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.app=t.app,this.items=t.items,this.container=this.mElement=t.container,this.valSeparator=t.valSeparator},load:function(){this.options.disable||(this.options.isEdited?this.loadEdit():this.loadRead())},loadEdit:function(){var t=this,e=this.options.name,i=this.options.value||this.options.defaultValue,s=this.options.attr||{},n=this.container;COMMON.AjaxModule.load("ckeditor",function(){CKEDITOR.disableAutoInline=!0;var o=new Element("div",{name:e,id:e});o.set(s),n&&o.inject(n),i&&o.set("html",i);var a={resize_enabled:!0,autoParagraph:!0,autoUpdateElement:!0,enterMode:1,readOnly:!1,language:MWF.language||"zh-cn","extraAllowedContent ":"img[onerror,data-id]"};this.options.RTFConfig&&(a=Object.merge(a,this.options.RTFConfig)),a.skin&&(a.skin="moono-lisa"),a.filebrowserFilesImage||a.cloudFileDisable||(a.filebrowserFilesImage=function(e,i){MWF.xDesktop.requireApp("File","FileSelector",(function(){t.selector_cloud=new MWF.xApplication.File.FileSelector(document.body,{style:"default",title:MWF.xApplication.Template.LP.MDomItem.selectCoundPicture,toBase64:!0,listStyle:"preview",selectType:"images",onPostSelectAttachment:function(t,e){i&&i(t,e)}}),t.selector_cloud.load()}),!0)}),this.editor=this.module.editor=CKEDITOR.replace(o,a);var l=MWF.xDesktop.getImageSrc().split("/x_file_assemble_control/")[0];this.editor.on("instanceReady",(function(t){var e=t.editor.editable&&t.editor.editable();if(e)for(var i=e.find("img"),s=0;s<i.count();s++){var n=i.getItem(s),o=n.getAttribute("src");if(o&&o.indexOf("/x_file_assemble_control/")>-1&&l!==o.split("/x_file_assemble_control/")[0]){var a=n.getAttribute("data-id");if(a){var h=MWF.xDesktop.getImageSrc(a);h&&(n.setAttribute("src",h),n.setAttribute("data-cke-saved-src",h))}}}})),this.items.push(this.editor)}.bind(this))},loadRead:function(){var t,e=this.options.name,i=this.options.value||this.options.defaultValue,s=this.options.style||{},n=this.options.attr||{},o=this.container;(t=new Element("span",{name:e,html:i})).set(n),t.setStyles(s),o&&t.inject(o),this.items.push(t)},get:function(t){if(this.options.disable)return"value"==t||"text"==t?null:{value:null,text:null};var e,i;if(this.options.isEdited)if(this.options.RTFConfig&&this.options.RTFConfig.isSetImageMaxWidth){var s=new Element("div",{styles:{display:"none"},html:this.editor.getData()}).inject(this.container);s.getElements("img").each((function(t){t.setStyle("max-width","100%")})),e=s.get("html"),s.destroy()}else e=this.editor.getData();else e=this.mElement.getElement("[name='"+name+"']").get("html");if(e||(e=""),i||(i=e),"value"==t)return e;if("text"==t)return i;var n={};return n.value=e,n.text=i,n},setValue:function(t){this.options.disable||(this.options.isEdited?this.editor.setData(t):this.mElement.getElement("[name='"+this.options.name+"']").set("html",t))},getErrorText:function(){return MWF.xApplication.Template.LP.MDomItem.emptyTip.replace("{text}",this.options.text)},getClassName:function(){var t=null;return"none"==this.options.className||(""!=this.options.className?t=this.options.className:this.options.isEdited),t}}),MDomItem.Org=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.app=t.app,this.items=t.items,this.container=this.mElement=t.container,this.valSeparator=t.valSeparator},load:function(){this.options.disable||(this.options.isEdited?this.loadEdit():this.loadRead())},loadEdit:function(){var t,e=this.options.name,i=this.options.value||this.options.defaultValue,s=this.options.style||{},n=this.options.attr||{},o=this.container,a=this.getClassName();i?"array"==typeOf(i)?this.orgData=i:"string"==typeOf(i)?this.orgData=i.split(this.valSeparator):"object"==typeOf(i)?this.orgData=[i]:this.orgData=[]:this.orgData=[],(t=new Element("div",{name:e})).set(n),a&&this.css&&this.css[a]&&t.setStyles(this.css[a]),t.setStyles(s),this.loadOrgWidget(this.orgData,t,!0),this.bindDefaultEvent(t),MDomItem.Util.bindEvent(this,t,this.options.event),o&&t.inject(o),this.items.push(t)},loadRead:function(){var t,e=this.options.name,i=this.options.value||this.options.defaultValue,s=this.options.style||{},n=this.options.attr||{},o=this.container,a=this.getClassName();i?"array"==typeOf(i)?this.orgData=i:"string"==typeOf(i)?this.orgData=i.split(this.valSeparator):this.orgData=[]:this.orgData=[],this.module.orgData=this.orgData,(t=new Element("div",{name:e})).set(n),a&&this.css&&this.css[a]&&t.setStyles(this.css[a]),t.setStyles(s),this.loadOrgWidget(this.orgData,t,!1),o&&t.inject(o),this.items.push(t)},getData:function(t){var e=[];return this.OrgWidgetList.each(function(i){e.push(t?MWF.org.parseOrgData(i.data,!0):i.data)}.bind(this)),e},get:function(t){if(this.options.disable)return"value"==t||"text"==t?null:{value:null,text:null};var e=this.orgData;if("value"==t)return e;if("text"==t)return e;var i={};return i.value=e,i.text=e,i},setValue:function(t){if(!this.options.disable){var e=this.mElement.getElement("[name='"+this.options.name+"']");t?"array"==typeOf(t)?this.orgData=t:"string"==typeOf(t)?this.orgData=t.split(this.valSeparator):this.orgData=[]:this.orgData=[],e.empty(),this.loadOrgWidget(this.orgData,e,this.options.isEdited),this.module.orgData=this.orgData}},getErrorText:function(){return MWF.xApplication.Template.LP.MDomItem.selectTip.replace("{text}",this.options.text)},bindDefaultEvent:function(t){this.options.unsetDefaultEvent||t.addEvent("click",function(e){this.module.fireEvent("querySelect",this.module);var i=this.options,s={type:i.orgType,title:i.text,count:i.count,selectedValues:this.orgObjData||this.orgData,units:i.units,unitType:i.unitType,groups:i.groups,expand:i.expand,exclude:i.exclude,expandSubEnable:i.expandSubEnable};MDomItem.Util.selectPerson(this.app.content,s,function(i){t.empty(),this.orgData=this.module.orgData=[],this.orgObjData=[],this.orgObject=this.module.orgObject=i,i.each(function(t){this.orgData.push(t.data.distinguishedName||t.data.name),this.orgObjData.push(t.data)}.bind(this)),this.OrgWidgetList=[],this.loadOrgWidget(this.orgObjData,t,!0),this.modified=!0,this.items[0].fireEvent("change",[this.module,e]),this.options.validImmediately&&this.module.verify(!0)}.bind(this))}.bind(this))},getValueByType:function(t){var e="string"==typeOf(t)?t.split(","):t;e=e.map((function(t,e){switch(t.toLowerCase()){case"person":return"p";case"identity":return"i";case"unit":return"u";case"group":return"g";case"role":return"r";default:return t.toLowerCase()}}));var i=[];return this.get("value").each((function(t){var s=t.substr(t.length-1,1);e.contains(s.toLowerCase())&&i.push(t)})),i},loadOrgWidget:function(t,e,i){this.OrgWidgetList=this.OrgWidgetList||[],MWF.require("MWF.widget.O2Identity",null,!1);var s={style:this.options.orgStyle||"xform",canRemove:i,onRemove:this.removeOrgItem};this.options.orgWidgetOptions&&(s=Object.merge(s,this.options.orgWidgetOptions)),t.each(function(t){var i,n=(i="string"===typeOf(t)?t:t.distinguishedName||t.name||"").substr(i.length-1,1),o={name:i};switch(n.toLowerCase()){case"i":var a=new MWF.widget.O2Identity(o,e,s);break;case"p":a=new MWF.widget.O2Person(o,e,s);break;case"u":a=new MWF.widget.O2Unit(o,e,s);break;case"g":a=new MWF.widget.O2Group(o,e,s);break;default:var l=this.options.orgType,h="array"==typeOf(l)&&1==l.length?l[0]:l;if("identity"==(h="string"==typeOf(h)?h.toLowerCase():""))a=new MWF.widget.O2Identity(o,e,s);else if("person"==h)a=new MWF.widget.O2Person(o,e,s);else if("unit"==h)a=new MWF.widget.O2Unit(o,e,s);else if("group"==h)a=new MWF.widget.O2Group(o,e,s);else if("process"==h){var r={id:i};a=new MWF.widget.O2Process(r,e,s)}else if("CMSView"==h)r={id:i},a=new MWF.widget.O2CMSView(r,e,s);else a=new MWF.widget.O2Other(o,e,s)}a.field=this,this.OrgWidgetList.push(a)}.bind(this))},removeOrgItem:function(t,e){var i=this.field,s=t.data.distinguishedName||t.data.name,n=[];i.orgData.each((function(t,e){t!=s&&n.push(t)})),i.orgData=n,i.orgObject&&(n=[],i.orgObject.each((function(t){t.distinguishedName?t.distinguishedName!=s&&n.push(t):t.name!=s&&n.push(t)})),i.orgObject=n),this.node.destroy(),i.items[0].fireEvent("change"),e.stopPropagation()},getClassName:function(){var t=null;return"none"==this.options.className||(""!=this.options.className?t=this.options.className:this.options.isEdited&&(t="inputPerson")),t}}),MDomItem.File=new Class({initialize:function(t){this.module=t,this.options=t.options,this.css=t.css,this.app=t.app,this.items=t.items,this.container=this.mElement=t.container,this.valSeparator=t.valSeparator},load:function(){this.options.disable||(this.options.isEdited?this.loadEdit():this.loadRead())},loadEdit:function(){},loadRead:function(){},get:function(t){},setValue:function(t){},getErrorText:function(){}});