MWF.xApplication.Selector=MWF.xApplication.Selector||{},MWF.xApplication.Template=MWF.xApplication.Template||{},MWF.xApplication.Template.Selector=MWF.xApplication.Template.Selector||{},MWF.xDesktop.requireApp("Selector","Person",null,!1),MWF.xDesktop.requireApp("Selector","Unit",null,!1),MWF.xApplication.Template.Selector.Custom=new Class({Extends:MWF.xApplication.Selector.Person,options:{style:"default",count:0,title:"选择列表",values:[],selectableItems:[],names:[],category:!1,expand:!0,categorySelectable:!1,expandSubEnable:!0,uniqueFlag:!1,defaultExpandLevel:1},initialize:function(t,e){this.setOptions(e),this.path="../x_component_Selector/$Selector/",this.cssPath="../x_component_Selector/$Selector/"+this.options.style+"/css.wcss",this._loadCss(!0),this.container=$(t),this.selectedItems=[],this.items=[],this.subCategorys=[],this.subItems=[]},loadSelectItems:function(t){this.options.category?this.options.selectableItems.each(function(t,e){if(t.isItem){t=this._newItem(t,this,this.itemAreaNode);this.items.push(t),this.subItems.push(t)}else if(this.options.categorySelectable){var s=this._newItemCategorySelectable(t,this,this.itemAreaNode);this.items.push(s),this.subItems.push(s),this.subCategorys.push(s)}else{s=this._newItemCategory(t,this,this.itemAreaNode);this.subCategorys.push(s)}}.bind(this)):this.options.selectableItems.each(function(t){var e="string"===typeOf(t)?t:t.name,s="string"===typeOf(t)?t:t.id,i=this._newItem({name:e,id:s},this,this.itemAreaNode);this.items.push(i),this.subItems.push(i)}.bind(this)),this.afterLoadSelectItem&&this.afterLoadSelectItem()},_scrollEvent:function(t){return!0},_getChildrenItemIds:function(t){return t.subItemList||[]},_newItemCategory:function(t,e,s,i,a,o){return new MWF.xApplication.Template.Selector.Custom.ItemCategory(t,e,s,i,a,o)},_newItemCategorySelectable:function(t,e,s,i,a,o){return new MWF.xApplication.Template.Selector.Custom.ItemCategorySelectable(t,e,s,i,a,o)},_listItemByKey:function(t,e,s){s?(this.initSearchArea(!0),this.searchInItems(s)):this.initSearchArea(!1)},_newItemSelected:function(t,e,s,i,a,o){return new MWF.xApplication.Template.Selector.Custom.ItemSelected(t,e,s,i,a,o)},_listItemByPinyin:function(t,e,s){s?(this.initSearchArea(!0),this.searchInItems(s)):this.initSearchArea(!1)},nestData:function(t,e){this.nestedData||(this.nestedData={});var s=function(t,e){e?this.nestedData[t.id||t.name]=t:this.options.categorySelectable?(this.nestedData[t.id||t.name]={id:t.id,name:t.name},t.subItemList&&this.nestData(t.subItemList,!0),t.subCategoryList&&this.nestData(t.subCategoryList)):(t.subItemList&&this.nestData(t.subItemList,!0),t.subCategoryList&&this.nestData(t.subCategoryList))}.bind(this);if(t)for(var i=0;i<t.length;i++){s(a=t[i],e)}else for(i=0;i<this.options.selectableItems.length;i++){var a;s(a=this.options.selectableItems[i],a.isItem)}},_getItem:function(t,e,s,i,a){this.nestedData||this.nestData(),t&&t.apply(s,[{data:this.nestedData[s]||{id:s}}])},_newItem:function(t,e,s,i,a,o){return new MWF.xApplication.Template.Selector.Custom.Item(t,e,s,i,a,o)},createItemsSearchData:function(t){this.itemsSearchData?t&&t():(this.itemsSearchData=[],MWF.require("MWF.widget.PinYin",function(){var e=[];this.items.each(function(t){if(-1==e.indexOf(t.data.name)){var s=t._getShowName().toLowerCase(),i=s.toPY().toLowerCase(),a=s.toPYFirst().toLowerCase();this.itemsSearchData.push({text:s,pinyin:i,firstPY:a,data:t.data}),e.push(t.data.name)}}.bind(this)),delete e,t&&t()}.bind(this)))}}),MWF.xApplication.Template.Selector.Custom.Item=new Class({Extends:o2.xApplication.Selector.Person.Item,_getShowName:function(){return this.data.name},_setIcon:function(){var t=this.selector.options.style;this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/"+t+"/icon/processicon.png)")},_getTtiteText:function(){return this.data.name},loadSubItem:function(){return!1},checkSelectedSingle:function(){this.selector.options.values.filter(function(t,e){if(this.selector.options.uniqueFlag){var s=this.selector.options.uniqueFlag;if("object"===typeOf(t))return this.data[s]&&this.data[s]===t[s];if("string"===typeOf(t))return this.data[s]&&this.data[s]===t}else{if("object"===typeOf(t))return this.data.id&&this.data.id===t.id||this.data.name&&this.data.name===t.name;if("string"===typeOf(t))return this.data.id&&this.data.id===t||this.data.name&&this.data.name===t}return!1}.bind(this)).length&&this.selectedSingle()},checkSelected:function(){var t=this.selector.selectedItems.filter(function(t,e){if(this.selector.options.uniqueFlag){var s=this.selector.options.uniqueFlag;return t.data[s]&&t.data[s]===this.data[s]}return t.data.id&&t.data.id===this.data.id||t.data.name&&t.data.name===this.data.name}.bind(this));t.length&&(t[0].addItem(this),this.selectedItem=t[0],this.setSelected())},destroy:function(){this.isSelected&&this.unSelected(),this.selector.items.erase(this),this.category&&(this.category.subCategorys&&this.category.subCategorys.length&&this.category.subCategorys.erase(this),this.category.subItems&&this.category.subItems.length&&this.category.subItems.erase(this)),this.node&&this.node.destroy()}}),MWF.xApplication.Template.Selector.Custom.ItemSelected=new Class({Extends:o2.xApplication.Selector.Person.ItemSelected,_getShowName:function(){return this.data.name},_setIcon:function(){var t=this.selector.options.style;this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/"+t+"/icon/processicon.png)")},_getTtiteText:function(){return this.data.name},check:function(){if(this.selector.items.length){var t=this.selector.items.filter(function(t,e){if(this.selector.options.uniqueFlag){var s=this.selector.options.uniqueFlag;return t.data[s]&&t.data[s]===this.data[s]}return t.data.id&&t.data.id===this.data.id||t.data.name&&t.data.name===this.data.name}.bind(this));this.items=t,t.length&&t.each(function(t){t.selectedItem=this,t.setSelected()}.bind(this))}this.afterCheck&&this.afterCheck()}}),MWF.xApplication.Template.Selector.Custom.ItemCategory=new Class({Extends:o2.xApplication.Selector.Person.ItemCategory,_getShowName:function(){return this.data.name},createNode:function(){this.node=new Element("div",{styles:this.selector.css.selectorItemCategory_department}).inject(this.container)},_setIcon:function(){var t=this.selector.options.style;this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/"+t+"/icon/applicationicon.png)")},_getTtiteText:function(){return this.data.name},clickItem:function(t){if(this._hasChild()||this.selector.options.expandEmptyCategory){var e=!this.loaded;e&&!this.selector.options.expandEmptyCategory||(this.isExpand?this.selector.fireEvent("collapse",[this]):this.selector.fireEvent("expand",[this])),this.loadSub(function(){e&&this._hasChild()?this.selector.isFlatCategory||(this.children.setStyles({display:"block",height:"auto"}),this.actionNode.setStyles(this.selector.css.selectorItemCategoryActionNode_expand),this.isExpand=!0):"none"===this.children.getStyle("display")?(this.children.setStyles({display:"block",height:"auto"}),this.actionNode.setStyles(this.selector.css.selectorItemCategoryActionNode_expand),this.isExpand=!0):(this.children.setStyles({display:"none",height:"0px"}),this.actionNode.setStyles(this.selector.css.selectorItemCategoryActionNode_collapse),this.isExpand=!1);t&&t()}.bind(this))}},destroy:function(){for(;this.subItems.length;)this.subItems[0].destroy();for(;this.subCategorys.length;)this.subCategorys[0].destroy();this.category&&this.category.subCategorys&&this.category.subCategorys.length&&this.category.subCategorys.erase(this),this.node&&this.node.destroy()},reloadSub:function(t){for(;this.subItems.length;)this.subItems[0].destroy();for(this.subItems=[];this.subCategorys.length;)this.subCategorys[0].destroy();this.subCategorys=[],this.loaded=!1,this.loadSub(t)},loadSub:function(t){this.loaded||(this._hasChildItem()&&this.data.subItemList.each(function(t,e){var s=this.selector._newItem(t,this.selector,this.children,this.level+1,this);this.selector.items.push(s),this.subItems&&this.subItems.push(s)}.bind(this)),this._hasChildCategory()&&this.data.subCategoryList.each(function(t,e){var s=this.selector._newItemCategory(t,this.selector,this.children,this.level+1,this);this.subCategorys.push(s)}.bind(this)),this.loaded=!0),t&&t()},_hasChildCategory:function(){return this.data.subCategoryList&&this.data.subCategoryList.length},_hasChildItem:function(){return this.data.subItemList&&this.data.subItemList.length},_hasChild:function(){return this._hasChildCategory()||this._hasChildItem()},check:function(){},afterLoad:function(){this.level<=this.selector.options.defaultExpandLevel&&this._hasChild()?this.clickItem():(this.children.hide(),this.actionNode.setStyles(this.selector.css.selectorItemCategoryActionNode_collapse),this.isExpand=!1)}}),MWF.xApplication.Template.Selector.Custom.ItemCategorySelectable=new Class({Extends:o2.xApplication.Selector.Unit.Item,_getShowName:function(){return this.data.name},createNode:function(){},_setIcon:function(){var t=this.selector.options.style;this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/"+t+"/icon/applicationicon.png)")},_getTtiteText:function(){return this.data.name},destroy:function(){for(this.isSelected&&this.unSelected(),this.selector.items.erase(this);this.subItems.length;)this.subItems[0].destroy();for(;this.subCategorys.length;)this.subCategorys[0].destroy();this.category&&(this.category.subCategorys&&this.category.subCategorys.length&&this.category.subCategorys.erase(this),this.category.subItems&&this.category.subItems.length&&this.category.subItems.erase(this)),this.node&&this.node.destroy()},reloadSub:function(t){for(;this.subItems.length;)this.subItems[0].destroy();for(this.subItems=[];this.subCategorys.length;)this.subCategorys[0].destroy();this.subCategorys=[],this.loaded=!1,this.loadSubItems(t)},loadSubItems:function(t){this.loaded?this.children.setStyle("display","block"):(this.children||(this.children=new Element("div",{styles:this.selector.css.selectorItemCategoryChildrenNode}).inject(this.node,"after")),this.children.setStyle("display","block"),this._hasChildItem()&&this.data.subItemList.each(function(t,e){var s=this.selector._newItem(t,this.selector,this.children,this.level+1,this);this.selector.items.push(s),this.subItems&&this.subItems.push(s)}.bind(this)),this._hasChildCategory()&&this.data.subCategoryList.each(function(t,e){var s=this.selector._newItemCategorySelectable(t,this.selector,this.children,this.level+1,this);this.selector.items.push(s),this.subCategorys.push(s)}.bind(this)),this.loaded=!0,t&&t())},loadCategoryChildren:function(t){this.categoryLoaded||(this._hasChildCategory()&&this.data.subCategoryList.each(function(t,e){var s=this.selector._newItemCategorySelectable(t,this.selector,this.children,this.level+1,this);this.selector.items.push(s),this.subCategorys.push(s)}.bind(this)),this.categoryLoaded=!0),t&&t()},loadItemChildren:function(t){this.itemLoaded||(this._hasChildItem()&&this.data.subItemList.each(function(t,e){var s=this.selector._newItem(t,this.selector,this.children,this.level+1,this);this.selector.items.push(s),this.subItems&&this.subItems.push(s)}.bind(this)),this.itemLoaded=!0),t&&t()},_hasChildCategory:function(){return this.data.subCategoryList&&this.data.subCategoryList.length},_hasChildItem:function(){return this.data.subItemList&&this.data.subItemList.length},_hasChild:function(){return this._hasChildCategory()||this._hasChildItem()},checkSelectedSingle:function(){this.selector.options.values.filter(function(t,e){if(this.selector.options.uniqueFlag){var s=this.selector.options.uniqueFlag;if("object"===typeOf(t))return this.data[s]&&this.data[s]===t[s];if("string"===typeOf(t))return this.data[s]&&this.data[s]===t}else{if("object"===typeOf(t))return this.data.id&&this.data.id===t.id||this.data.name&&this.data.name===t.name;if("string"===typeOf(t))return this.data.id&&this.data.id===t||this.data.name&&this.data.name===t}return!1}.bind(this)).length&&this.selectedSingle()},checkSelected:function(){var t=this.selector.selectedItems.filter(function(t,e){if(this.selector.options.uniqueFlag){var s=this.selector.options.uniqueFlag;return t.data[s]&&t.data[s]===this.data[s]}return t.data.id&&t.data.id===this.data.id||t.data.name&&t.data.name===this.data.name}.bind(this));t.length&&(t[0].addItem(this),this.selectedItem=t[0],this.setSelected())},check:function(){this.checkSelected()},afterLoad:function(){}});