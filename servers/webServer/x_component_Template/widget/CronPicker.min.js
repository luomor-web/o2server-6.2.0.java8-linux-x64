MWF.xApplication.Template=MWF.xApplication.Template||{},MWF.xApplication.Template.widget=MWF.xApplication.Template.widget||{},MWF.xDesktop.requireApp("Template","MTooltips",null,!1),MWF.xDesktop.requireApp("Template","MForm",null,!1),MWF.xApplication.Template.widget.CronPicker=new Class({Implements:[Options,Events],Extends:MTooltips,options:{style:"default",axis:"y",position:{x:"auto",y:"auto"},event:"click",modules:["second","mintue","hour","date","month","week","year"],moudulesLp:{second:"秒",mintue:"分钟",hour:"小时",date:"日",month:"月",week:"周",year:"年"},isShowResult:!0,isShowText:!0,value:""},_loadCornCss:function(e){this.cornCssPath="../x_component_Template/widget/$CronPicker/"+this.options.style+"/css.wcss";var t=encodeURIComponent(this.cornCssPath);!e&&MWF.widget.css[t]?this.css=MWF.widget.css[t]:(this.cornCssPath=-1!=this.cornCssPath.indexOf("?")?this.cornCssPath+"&v="+COMMON.version:this.cornCssPath+"?v="+COMMON.version,new Request.JSON({url:this.cornCssPath,secure:!1,async:!1,method:"get",noCache:!1,onSuccess:function(e,s){MWF.widget.css[t]=this.css=Object.merge(this.css||{},e)}.bind(this),onError:function(e,t){alert(t+e)}}).send())},_customNode:function(e){this._loadCornCss(),this.options.value&&(this.values=this.options.value.split(" ")),this.formStyle="cronpicker"+("default"==this.options.style?"":"_"+this.options.style),this.tabNode=new Element("div",{styles:this.css.tabNode}).inject(this.contentNode),this.options.modules.each(function(e,t){var s=this[e+"Tab"]=new Element("div",{text:this.options.moudulesLp[e],styles:this.css.tab}).inject(this.tabNode);this[e+"Node"]=new Element("div",{styles:this.css.moduleNode}).inject(this.contentNode),this["load"+e.capitalize()+"Form"](),s.addEvents({click:function(){var e=this.obj;e.currentTab&&e.currentTab.setStyles(e.css.tab),e.currentNode&&e.currentNode.setStyles({display:"none"}),e.currentTab=e[this.m+"Tab"],e.currentNode=e[this.m+"Node"],e[this.m+"Tab"].setStyles(e.css.tab_current),e[this.m+"Node"].setStyles({display:""})}.bind({obj:this,m:e}),mouseover:function(){var e=this.obj;e[this.m+"Tab"]!=e.currentTab&&e[this.m+"Tab"].setStyles(e.css.tab_over)}.bind({obj:this,m:e}),mouseout:function(){var e=this.obj;e[this.m+"Tab"]!=e.currentTab&&e[this.m+"Tab"].setStyles(e.css.tab)}.bind({obj:this,m:e})}),0==t&&s.click()}.bind(this)),this.helpNode=new Element("a",{styles:this.css.helpNode,href:"../x_component_Template/widget/$CronPicker/cron_express_description.html",target:"_blank"}).inject(this.tabNode),this.options.isShowResult},setCronValue:function(e){var t=e.split(" ");this.setSecondItemValue(t[0]),this.setMintueItemValue(t[1]),this.setHourItemValue(t[2]),this.setDateItemValue(t[3]),this.setMonthItemValue(t[4]),this.setWeekItemValue(t[5]),t.length>6&&this.setYearItemValue(t[6])},setValue:function(){var e=[];["second","mintue","hour","date","month","week","year"].each(function(t){var s=this["set"+t.capitalize()+"Value"]();s&&e.push(s)}.bind(this)),this.fireEvent("select",[e.join(" ")])},addZero:function(e,t){var s="";e=e.toString();for(var i=0;i<t;i++)s+="0";var n=s+e;return n.substr(n.length-t,t)},loadSecondForm:function(){var e=this;this.secondNode.set("html","<table width='100%' bordr='0' cellpadding='0' cellspacing='0' styles='formTable' style='margin-top: 10px; '><tr><td styles='formTableValue14' style='width:60px;'>       <div item='second'></div>   </td>    <td styles='formTableValue14' style='vertical-align: top;'>       <div>允许的通配符[, - * /]</div>       <div>从 <span item='sfrom'></span>-<span item='sto'></span> 秒</div>       <div>从<span item='sbegin'></span>秒开始,每<span item='scount'></span>秒执行一次</div>       <div></div></td></tr><tr><td styles='formTableValue14' item='sspecify' colspan='2' style='padding-left: 10px;'></td></tr></table>"),this.secondForm=new MForm(this.secondNode,{},{isEdited:!0,style:this.formStyle,hasColon:!0,itemTemplate:{second:{type:"radio",selectValue:["secondly","cycle","from","specify"],selectText:["每秒","周期","","指定"],defaultValue:"secondly",event:{click:function(){this.setValue()}.bind(this)}},sfrom:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},sto:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},sbegin:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},scount:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},sspecify:{type:"checkbox",selectText:function(){for(var t=[],s=0;s<60;s++)t.push(e.addZero(s,2));return t},selectValue:function(){for(var e=[],t=0;t<60;t++)e.push(t);return e},event:{change:function(){this.setValue()}.bind(this)}}}}),this.secondForm.load(),this.values&&this.setSecondItemValue(this.values[0])},setSecondValue:function(){if(!this.secondForm)return"*";var e=this.secondForm.getResult(!1,null,!1,!1,!0);switch(e.second){case"secondly":return"*";case"cycle":return e.sfrom+"-"+e.sto;case"from":return e.sbegin+"/"+e.scount;case"specify":return e.sspecify.length?e.sspecify.join(","):"?";default:return"*"}},setSecondItemValue:function(e){if(e&&this.secondForm)if("*"==e)this.secondForm.getItem("second").setValue("secondly");else if(e.indexOf("-")>-1){this.secondForm.getItem("second").setValue("cycle");var t=e.split("-");this.secondForm.getItem("sfrom").setValue(t[0]||""),this.secondForm.getItem("sto").setValue(t[1]||"")}else if(e.indexOf("/")>-1){this.secondForm.getItem("second").setValue("from");t=e.split("/");this.secondForm.getItem("sbegin").setValue(t[0]||""),this.secondForm.getItem("scount").setValue(t[1]||"")}else this.secondForm.getItem("second").setValue("specify"),this.secondForm.getItem("sspecify").setValue(e.split(","))},getSecondDefaultValue:function(){this.options.value&&(this.values=this.options.value.split(" "));var e={type:"secondly"};if(this.values){var t=this.values[0];if("*"==t);else if(t.indexOf("-")>-1){e.type="cycle";var s=t.split("-");e.from=s[0]||"",e.to=s[1]||""}else if(t.indexOf("/")>-1){e.type="from";s=t.split("/");e.sbegin=s[0]||"",e.scount=s[1]||""}else e.type="specify",e.sspecify=t.split(",")}return e},loadMintueForm:function(){var e=this;this.mintueNode.set("html","<table width='100%' bordr='0' cellpadding='0' cellspacing='0' styles='formTable' style='margin-top: 10px; '><tr><td styles='formTableValue14' style='width:80px;'>       <div item='mintue'></div>   </td>    <td styles='formTableValue14' style='vertical-align: top;'>       <div>允许的通配符[, - * /]</div>       <div>从 <span item='mfrom'></span>-<span item='mto'></span> 分钟</div>       <div>从<span item='mbegin'></span>分钟开始,每<span item='mcount'></span>分钟执行一次</div>       <div></div></td></tr><tr><td styles='formTableValue14' item='mspecify' colspan='2' style='padding-left: 10px;'></td></tr></table>"),this.mintueForm=new MForm(this.mintueNode,{},{isEdited:!0,style:this.formStyle,hasColon:!0,itemTemplate:{mintue:{type:"radio",selectValue:["mintuely","cycle","from","specify"],selectText:["每分钟","周期","","指定"],defaultValue:"mintuely",event:{click:function(){this.setValue()}.bind(this)}},mfrom:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},mto:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},mbegin:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},mcount:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},mspecify:{type:"checkbox",selectText:function(){for(var t=[],s=0;s<60;s++)t.push(e.addZero(s,2));return t},selectValue:function(){for(var e=[],t=0;t<60;t++)e.push(t);return e},event:{change:function(){this.setValue()}.bind(this)}}}}),this.mintueForm.load(),this.values&&this.setMintueItemValue(this.values[1])},setMintueValue:function(){if(!this.mintueForm)return"*";var e=this.mintueForm.getResult(!1,null,!1,!1,!0);switch(e.mintue){case"mintuely":return"*";case"cycle":return e.mfrom+"-"+e.mto;case"from":return e.mbegin+"/"+e.mcount;case"specify":return e.mspecify.length?e.mspecify.join(","):"?";default:return"*"}},setMintueItemValue:function(e){if(e&&this.mintueForm)if("*"==e)this.mintueForm.getItem("mintue").setValue("mintuely");else if(e.indexOf("-")>-1){this.mintueForm.getItem("mintue").setValue("cycle");var t=e.split("-");this.mintueForm.getItem("mfrom").setValue(t[0]||""),this.mintueForm.getItem("mto").setValue(t[1]||"")}else if(e.indexOf("/")>-1){this.mintueForm.getItem("mintue").setValue("from");t=e.split("/");this.mintueForm.getItem("mbegin").setValue(t[0]||""),this.mintueForm.getItem("mcount").setValue(t[1]||"")}else this.mintueForm.getItem("mintue").setValue("specify"),this.mintueForm.getItem("mspecify").setValue(e.split(","))},loadHourForm:function(){var e=this;this.hourNode.set("html","<table width='100%' bordr='0' cellpadding='0' cellspacing='0' styles='formTable' style='margin-top: 10px; '><tr><td styles='formTableValue14' style='width:80px;'>       <div item='hour'></div>   </td>    <td styles='formTableValue14' style='vertical-align: top;'>       <div>允许的通配符[, - * /]</div>       <div>从 <span item='hfrom'></span>-<span item='hto'></span> 小时</div>       <div>从<span item='hbegin'></span>小时开始,每<span item='hcount'></span>小时执行一次</div>       <div></div></td></tr><tr><td styles='formTableValue14' item='hspecify' colspan='2' style='padding-left: 10px;'></td></tr></table>"),this.hourForm=new MForm(this.hourNode,{},{isEdited:!0,style:this.formStyle,hasColon:!0,itemTemplate:{hour:{type:"radio",selectValue:["hourly","cycle","from","specify"],selectText:["每小时","周期","","指定"],defaultValue:"hourly",event:{click:function(){this.setValue()}.bind(this)}},hfrom:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},hto:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},hbegin:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},hcount:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},hspecify:{type:"checkbox",selectText:function(){for(var t=[],s=0;s<24;s++)t.push(e.addZero(s,2));return t},selectValue:function(){for(var e=[],t=0;t<24;t++)e.push(t);return e},event:{change:function(){this.setValue()}.bind(this)}}}}),this.hourForm.load(),this.values&&this.setHourItemValue(this.values[2])},setHourValue:function(){if(!this.hourForm)return"*";var e=this.hourForm.getResult(!1,null,!1,!1,!0);switch(e.hour){case"hourly":return"*";case"cycle":return e.hfrom+"-"+e.hto;case"from":return e.hbegin+"/"+e.hcount;case"specify":return e.hspecify.length?e.hspecify.join(","):"?";default:return"*"}},setHourItemValue:function(e){if(e&&this.hourForm)if("*"==e)this.hourForm.getItem("hour").setValue("hourly");else if(e.indexOf("-")>-1){this.hourForm.getItem("hour").setValue("cycle");var t=e.split("-");this.hourForm.getItem("hfrom").setValue(t[0]||""),this.hourForm.getItem("hto").setValue(t[1]||"")}else if(e.indexOf("/")>-1){this.hourForm.getItem("hour").setValue("from");t=e.split("/");this.hourForm.getItem("hbegin").setValue(t[0]||""),this.hourForm.getItem("hcount").setValue(t[1]||"")}else this.hourForm.getItem("hour").setValue("specify"),this.hourForm.getItem("hspecify").setValue(e.split(","))},loadDateForm:function(){var e=this;this.dateNode.set("html","<table width='100%' bordr='0' cellpadding='0' cellspacing='0' styles='formTable' style='margin-top: 10px; '><tr><td styles='formTableValue14' style='width:120px;'>       <div item='date'></div>   </td>    <td styles='formTableValue14' style='vertical-align: top;'>       <div>允许的通配符[, - * / L W ?]</div>       <div>　</div>       <div>从 <span item='dfrom'></span>-<span item='dto'></span> 日</div>       <div>从<span item='dbegin'></span>日开始,每<span item='dcount'></span>天执行一次</div>       <div>每月<span item='dnearly'></span>号最近的那个工作日</div>       <div></div>       <div></div></td></tr><tr><td styles='formTableValue14' item='dspecify' colspan='2' style='padding-left: 10px;'></td></tr></table>"),this.dateForm=new MForm(this.dateNode,{},{isEdited:!0,style:this.formStyle,hasColon:!0,itemTemplate:{date:{type:"radio",selectValue:["daily","notspecify","cycle","from","nearly","last","specify"],selectText:["每天","不指定","周期","","","本月最后一天","指定"],defaultValue:"daily",event:{click:function(){this.setValue()}.bind(this)}},dfrom:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},dto:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},dbegin:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},dcount:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},dnearly:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},dspecify:{type:"checkbox",selectText:function(){for(var t=[],s=1;s<32;s++)t.push(e.addZero(s,2));return t},selectValue:function(){for(var e=[],t=1;t<32;t++)e.push(t);return e},event:{change:function(){this.setValue()}.bind(this)}}}}),this.dateForm.load(),this.values&&this.setDateItemValue(this.values[3])},setDateValue:function(){if(!this.dateForm)return"*";var e=this.dateForm.getResult(!1,null,!1,!1,!0);switch(e.date){case"daily":return"*";case"notspecify":return"?";case"cycle":return e.dfrom+"-"+e.dto;case"from":return e.dbegin+"/"+e.dcount;case"nearly":return e.dnearly+"W";case"last":return"L";case"specify":return e.dspecify.length?e.dspecify.join(","):"?";default:return"*"}},setDateItemValue:function(e){if(e&&this.dateForm)if("*"==e)this.dateForm.getItem("date").setValue("daily");else if("?"==e)this.dateForm.getItem("date").setValue("notspecify");else if(e.indexOf("-")>-1){this.dateForm.getItem("date").setValue("cycle");var t=e.split("-");this.dateForm.getItem("dfrom").setValue(t[0]||""),this.dateForm.getItem("dto").setValue(t[1]||"")}else if(e.indexOf("/")>-1){this.dateForm.getItem("date").setValue("from");t=e.split("/");this.dateForm.getItem("dbegin").setValue(t[0]||""),this.dateForm.getItem("dcount").setValue(t[1]||"")}else if("W"==e.substr(e.length-1,1)){this.dateForm.getItem("date").setValue("nearly");var s=e.substr(0,e.length-1);this.dateForm.getItem("dnearly").setValue(s)}else"L"==e?this.dateForm.getItem("date").setValue("last"):(this.dateForm.getItem("date").setValue("specify"),this.dateForm.getItem("dspecify").setValue(e.split(",")))},loadMonthForm:function(){var e=this;this.monthNode.set("html","<table width='100%' bordr='0' cellpadding='0' cellspacing='0' styles='formTable' style='margin-top: 10px; '><tr><td styles='formTableValue14' style='width:80px;'>       <div item='month'></div>   </td>    <td styles='formTableValue14' style='vertical-align: top;'>       <div>允许的通配符[, - * / ?]</div>       <div>　</div>       <div>从 <span item='mofrom'></span>-<span item='moto'></span> 月</div>       <div>从<span item='mobegin'></span>月开始,每<span item='mocount'></span>月执行一次</div>       <div></div></td></tr><tr><td styles='formTableValue14' item='mospecify' colspan='2' style='padding-left: 10px;'></td></tr></table>"),this.monthForm=new MForm(this.monthNode,{},{isEdited:!0,style:this.formStyle,hasColon:!0,itemTemplate:{month:{type:"radio",selectValue:["monthly","notspecify","cycle","from","specify"],selectText:["每月","不指定","周期","","指定"],defaultValue:"monthly",event:{click:function(){this.setValue()}.bind(this)}},mofrom:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},moto:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},mobegin:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},mocount:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},monearly:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},mospecify:{type:"checkbox",selectText:function(){for(var t=[],s=1;s<13;s++)t.push(e.addZero(s,2));return t},selectValue:function(){for(var e=[],t=1;t<13;t++)e.push(t);return e},event:{change:function(){this.setValue()}.bind(this)}}}}),this.monthForm.load(),this.values&&this.setMonthItemValue(this.values[4])},setMonthValue:function(){if(!this.monthForm)return"*";var e=this.monthForm.getResult(!1,null,!1,!1,!0);switch(e.month){case"monthly":return"*";case"notspecify":return"?";case"cycle":return e.mofrom+"-"+e.moto;case"from":return e.mobegin+"/"+e.mocount;case"specify":return e.mospecify.length?e.mospecify.join(","):"?";default:return"*"}},setMonthItemValue:function(e){if(e&&this.monthForm)if("*"==e)this.monthForm.getItem("month").setValue("monthly");else if("?"==e)this.monthForm.getItem("month").setValue("notspecify");else if(e.indexOf("-")>-1){this.monthForm.getItem("month").setValue("cycle");var t=e.split("-");this.monthForm.getItem("mofrom").setValue(t[0]||""),this.monthForm.getItem("moto").setValue(t[1]||"")}else if(e.indexOf("/")>-1){this.monthForm.getItem("month").setValue("from");t=e.split("/");this.monthForm.getItem("mobegin").setValue(t[0]||""),this.monthForm.getItem("mocount").setValue(t[1]||"")}else this.monthForm.getItem("month").setValue("specify"),this.monthForm.getItem("mospecify").setValue(e.split(","))},loadWeekForm:function(){var e=this;this.weekNode.set("html","<table width='100%' bordr='0' cellpadding='0' cellspacing='0' styles='formTable' style='margin-top: 10px; '><tr><td styles='formTableValue14' style='width:80px;'>       <div item='week'></div>   </td>    <td styles='formTableValue14' style='vertical-align: top;'>       <div>允许的通配符[, - * / L # ?]</div>       <div>　</div>       <div>从星期 <span item='wfrom'></span>-<span item='wto'></span> </div>       <div>第<span item='wnumber'></span>周的星期<span item='wday'></span></div>       <div>本月最后一个星期<span item='wlast'></span></div>       <div></div></td></tr><tr><td styles='formTableValue14' item='wspecify' colspan='2' style='padding-left: 10px;'></td></tr></table>"),this.weekForm=new MForm(this.weekNode,{},{isEdited:!0,style:this.formStyle,hasColon:!0,itemTemplate:{week:{type:"radio",selectValue:["weekly","notspecify","cycle","from","last","specify"],selectText:["每周","不指定","周期","","","指定"],defaultValue:"notspecify",event:{click:function(){this.setValue()}.bind(this)}},wfrom:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},wto:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},wnumber:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},wday:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},wlast:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},wspecify:{type:"checkbox",selectText:function(){for(var t=[],s=1;s<8;s++)t.push(e.addZero(s,2));return t},selectValue:function(){for(var e=[],t=1;t<8;t++)e.push(t);return e},event:{change:function(){this.setValue()}.bind(this)}}}}),this.weekForm.load(),this.values&&this.setWeekItemValue(this.values[5])},setWeekValue:function(){if(!this.weekForm)return"?";var e=this.weekForm.getResult(!1,null,!1,!1,!0);switch(e.week){case"weekly":return"*";case"notspecify":return"?";case"cycle":return e.wfrom+"-"+e.wto;case"from":return e.wnumber+"/"+e.wday;case"last":return e.wlast+"L";case"specify":return e.wspecify.length?e.wspecify.join(","):"?";default:return"?"}},setWeekItemValue:function(e){if(e&&this.weekForm)if("*"==e)this.weekForm.getItem("week").setValue("weekly");else if("?"==e)this.weekForm.getItem("week").setValue("notspecify");else if(e.indexOf("-")>-1){this.weekForm.getItem("week").setValue("cycle");var t=e.split("-");this.weekForm.getItem("wfrom").setValue(t[0]||""),this.weekForm.getItem("wto").setValue(t[1]||"")}else if(e.indexOf("/")>-1){this.weekForm.getItem("week").setValue("from");t=e.split("/");this.weekForm.getItem("wbegin").setValue(t[0]||""),this.weekForm.getItem("wcount").setValue(t[1]||"")}else if("L"==e.substr(e.length-1,1)){this.weekForm.getItem("week").setValue("last");var s=e.substr(0,e.length-1);this.weekForm.getItem("wlast").setValue(s)}else this.weekForm.getItem("week").setValue("specify"),this.weekForm.getItem("wspecify").setValue(e.split(","))},loadYearForm:function(){this.yearNode.set("html","<table width='100%' bordr='0' cellpadding='0' cellspacing='0' styles='formTable' style='margin-top: 10px; '><tr><td styles='formTableValue14' style='width:80px;'>       <div item='year'></div>   </td>    <td styles='formTableValue14' style='vertical-align: top;'>       <div>允许的通配符[, - * /] 非必填</div>       <div>　</div>       <div>从<span item='yfrom'></span>-<span item='yto'></span>年</div></td></tr></table>"),this.yearForm=new MForm(this.yearNode,{},{isEdited:!0,style:this.formStyle,hasColon:!0,itemTemplate:{year:{type:"radio",selectValue:["notspecify","yearly","cycle"],selectText:["不指定","每年","周期"],defaultValue:"notspecify",event:{click:function(){this.setValue()}.bind(this)}},yfrom:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}},yto:{tType:"number",event:{blur:function(){this.setValue()}.bind(this)}}}}),this.yearForm.load(),this.values&&this.values.length>6&&this.setYearItemValue(this.values[6])},setYearValue:function(){if(!this.yearForm)return"";var e=this.yearForm.getResult(!1,null,!1,!1,!0);switch(e.year){case"notspecify":return"";case"yearly":return"*";case"cycle":return e.yfrom+"-"+e.yto;default:return""}},setYearItemValue:function(e){if(e&&this.yearForm)if("*"==e)this.yearForm.getItem("year").setValue("yearly");else if("?"==e)this.yearForm.getItem("year").setValue("notspecify");else if(e.indexOf("-")>-1){this.yearForm.getItem("year").setValue("cycle");var t=e.split("-");this.yearForm.getItem("yfrom").setValue(t[0]||""),this.yearForm.getItem("yto").setValue(t[1]||"")}}});