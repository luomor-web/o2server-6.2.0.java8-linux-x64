MWF.xApplication.process.ProcessDesigner.widget=MWF.xApplication.process.ProcessDesigner.widget||{},MWF.xApplication.process.ProcessDesigner.widget.ScriptSelector=new Class({Implements:[Options,Events],Extends:MWF.widget.Common,options:{style:"default",maskNode:$(document.body)},initialize:function(t,e,i,s){this.setOptions(s),this.node=$(t),this.app=i,this.script=e,this.path="../x_component_process_ProcessDesigner/widget/$ScriptSelector/",this.cssPath="../x_component_process_ProcessDesigner/widget/$ScriptSelector/"+this.options.style+"/css.wcss",this._loadCss(),this.selNode=new Element("div",{styles:this.css.selScriptNode}).inject(this.node,"before"),this.delNode=new Element("div",{styles:this.css.delScriptNode}).inject(this.node,"before"),this.node.setStyles(this.css.contentNode),this.loadValue(e),this.selNode.addEvent("click",function(t){this.editScript()}.bind(this)),this.delNode.addEvent("click",function(t){this.delScript()}.bind(this))},loadValue:function(t){t&&t.toString()&&this.app.actions.getScriptByName(t,this.app.application.id,function(e){this.scriptData=e.data,this.createScriptNode(t)}.bind(this))},delScript:function(){this.fireEvent("delete")},editScript:function(){this.loadWindow(),this.loadContent()},loadWindow:function(){this.options.maskNode.mask({destroyOnHide:!0,style:this.css.maskNode}),this.windowNode=new Element("div",{styles:this.css.containerNode}),this.titleNode=new Element("div",{styles:this.css.titleNode}).inject(this.windowNode),this.titleActionNode=new Element("div",{styles:this.css.titleActionNode}).inject(this.titleNode),this.titleTextNode=new Element("div",{styles:this.css.titleTextNode,text:"Select Script"}).inject(this.titleNode),this.titleActionNode.addEvent("click",function(){this.close()}.bind(this)),this.windowContentNode=new Element("div",{styles:this.css.windowContentNode}).inject(this.windowNode),this.windowNode.inject(this.options.maskNode),this.windowNode.position({relativeTo:this.options.maskNode,position:"center",edge:"center"});var t=this.options.maskNode.getSize(),e=this.windowNode.getSize();this.windowNode.makeDraggable({handle:this.titleNode,limit:{x:[0,t.x-e.x],y:[0,t.y-e.y]}})},loadAction:function(){this.okActionNode=new Element("button",{styles:this.css.okActionNode,text:this.app.lp.selectorButton.ok}).inject(this.actionNode),this.cancelActionNode=new Element("button",{styles:this.css.cancelActionNode,text:this.app.lp.selectorButton.cancel}).inject(this.actionNode),this.okActionNode.addEvent("click",function(){this.fireEvent("complete",[this.selectedItems]),this.close()}.bind(this)),this.cancelActionNode.addEvent("click",function(){this.close()}.bind(this))},loadContent:function(){this.restActions||(this.restActions=MWF.Actions.get("x_organization_assemble_control")),this.scriptConfigurator=new MWF.xApplication.process.ProcessDesigner.widget.ScriptSelector.ScriptExplorer(this.windowContentNode,this.app.actions),this.scriptConfigurator.app=this.app,this.scriptConfigurator.window=this,this.scriptConfigurator.load()},selected:function(t){this.scriptData=t.data,this.createScriptNode(t),this.fireEvent("selected",[t.data]),this.close()},createScriptNode:function(){this.node.empty();this.scriptNode=new Element("div",{styles:{cursor:"pointer",color:"#0000FF"},text:this.scriptData.name}).inject(this.node),this.scriptNode.addEvent("click",function(t){this.openScript(t)}.bind(this))},openScript:function(t){var e=this.scriptData.id,i=this,s={onQueryLoad:function(){this.actions=i.app.actions,this.options.id=e,this.application=i.app.application}};this.app.desktop.openApplication(t,"process.ScriptDesigner",s)},close:function(){this.windowNode.destroy(),this.options.maskNode.unmask()}}),MWF.xDesktop.requireApp("process.ProcessManager","ScriptExplorer",null,!1),MWF.xApplication.process.ProcessDesigner.widget.ScriptSelector.ScriptExplorer=new Class({Extends:MWF.xApplication.process.ProcessManager.ScriptExplorer,loadToolbar:function(){this.toolbarNode=new Element("div",{styles:this.css.toolbarNode}),this.toolbarNode.setStyle("height","40px"),this.createCreateElementNode(),this.createElementNode.setStyles({height:"40px",width:"40px"}),this.toolbarNode.inject(this.node)},loadContentNode:function(){this.elementContentNode=new Element("div",{styles:this.css.elementContentNode}).inject(this.node),this.elementContentListNode=new Element("div",{styles:this.css.elementContentListNode}).inject(this.elementContentNode),this.setContentSize()},_getItemObject:function(t){return new MWF.xApplication.process.ProcessDesigner.widget.ScriptSelector.ScriptExplorer.Script(this,t)}}),MWF.xApplication.process.ProcessDesigner.widget.ScriptSelector.ScriptExplorer.Script=new Class({Extends:MWF.xApplication.process.ProcessManager.ScriptExplorer.Script,_open:function(t){var e=this,i={onQueryLoad:function(){this.actions=e.explorer.actions,this.category=e,this.options.id=e.data.id,this.application=e.explorer.app.application,this.explorer=e.explorer}};this.explorer.app.desktop.openApplication(t,"process.ScriptDesigner",i)},_getLnkPar:function(){return{icon:this.explorer.path+this.explorer.options.style+"/scriptIcon/lnk.png",title:this.data.name,par:'process.ScriptDesigner#{"id": "'+this.data.id+'", "applicationId": "'+this.explorer.app.application.id+'"}'}},_customNodes:function(){this.data.validated||(new Element("div",{styles:this.explorer.css.itemErrorNode}).inject(this.node),this.node.setStyle("background-color","#f9e8e8")),this.node.setStyle("cursor","pointer"),this.nodeColor=this.node.getStyle("background-color");var t=this;this.node.removeEvents("mouseover"),this.node.removeEvents("mouseout"),this.node.addEvents({mouseover:function(){this.setStyle("background-color","#dcdcdc")},mouseout:function(){this.setStyle("background-color",t.nodeColor)},click:function(){this.selected()}.bind(this)});var e=new Element("div",{styles:{"font-size":"14px"},text:this.explorer.app.lp.selectScript+this.data.name+" ("+this.data.alias+") "});new mBox.Tooltip({theme:"BlackGradient",content:e,offset:{x:0,y:0},setStyles:{content:{padding:10,lineHeight:20}},attach:this.node,transition:"flyin"})},selected:function(){this.explorer.window.selected(this)}});