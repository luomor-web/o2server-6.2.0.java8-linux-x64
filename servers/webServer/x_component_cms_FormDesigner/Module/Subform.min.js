MWF.xApplication.cms.FormDesigner.Module=MWF.xApplication.cms.FormDesigner.Module||{},MWF.xDesktop.requireApp("process.FormDesigner","Module.Subform",null,!1),MWF.xApplication.cms.FormDesigner.Module.Subform=MWF.CMSFCSubform=new Class({Extends:MWF.FCSubform,Implements:[MWF.CMSFCMI],openSubform:function(e){this.json.subformSelected&&"none"!==this.json.subformSelected&&"script"!==this.json.subformType&&layout.desktop.openApplication(e,"cms.FormDesigner",{id:this.json.subformSelected,appId:"FormDesigner"+this.json.subformSelected})},refreshSubform:function(){this.json.subformSelected&&"none"!==this.json.subformSelected&&"script"!==this.json.subformType&&MWF.Actions.get("x_cms_assemble_control").getForm(this.json.subformSelected,function(e){if(this.subformData.updateTime!==e.data.updateTime){var t=null;this.property&&(t=$(this.property.data.pid+"selectSubform").getElement("select")),this.clearSubformList(this.json.subformSelected),this.reloadSubform(e.data,t,"")}}.bind(this))},redoSelectedSubform:function(e,t,s){if("none"===this.json.subformSelected&&(this.json.subformSelected=""),this.json.subformSelected&&"none"!==this.json.subformSelected)if(this.form.subformList&&this.form.subformList[this.json.subformSelected]){var o=this.node.getPosition(document.bosy);if(this.form.designer.alert("error",{event:{x:o.x+150,y:o.y+80}},this.form.designer.lp.subformConflictTitle,this.form.designer.lp.subformConflictInfor,400,120),this.json.subformSelected=s,t)for(var i=0;i<t.options.length;i++)if(t.options[i].value===s){t.options[i].set("selected",!0);break}this.node.empty(),this.loadIcon()}else MWF.Actions.get("x_cms_assemble_control").getForm(this.json.subformSelected,function(e){this.reloadSubform(e.data,t,s)}.bind(this));else this.subformData=null,this.clearSubformList(s),this.node.empty(),this.loadIcon()},regetSubformData:function(){var e=!1;return this.json.subformSelected&&"none"!==this.json.subformSelected&&"script"!==this.json.subformType&&MWF.Actions.get("x_cms_assemble_control").getForm(this.json.subformSelected,function(t){this.subformData&&this.subformData.updateTime===t.data.updateTime||(this.getSubformData(t.data),e=!0)}.bind(this),null,!1),e},checkSubform:function(e,t){var s=this.getConflictFields();if(s.length){var o=this.form.designer.lp.subformNameConflictInfor;return o=o.replace("{name}",s.join(", ")),this.form.designer.notice(o,"error",this.node),!1}return!0},loadSubform:function(e){this.subformData.json.style=this.form.json.style,this.subformData.json.properties=this.form.json.properties,this.subformData.json.jsheader={code:"",html:""},this.subformData.json.events={},this.subformData.json.formStyleType=this.form.json.formStyleType,this.subformModule=new MWF.CMSFCSubform.Form(this.form,this.node),this.subformModule.load(this.subformData)}}),MWF.xApplication.cms.FormDesigner.Module.Subform.Form=new Class({Extends:MWF.CMSFCForm,initialize:function(e,t,s){this.parentform=e,this.css=this.parentform.css,this.container=t,this.form=this,this.isSubform=!0,this.moduleType="subform",this.moduleList=[],this.moduleNodeList=[],this.moduleContainerNodeList=[],this.moduleElementNodeList=[],this.moduleComponentNodeList=[],this.dataTemplate={},this.designer=this.parentform.designer,this.selectedModules=[]},load:function(e){this.data=e,this.json=e.json,this.html=e.html,this.json.mode=this.options.mode,this.container.set("html",this.html),this.loadDomModules(),"Mobile"===this.options.mode&&oldStyleValue&&this._setEditStyle("formStyleType",null,oldStyleValue)},loadDomModules:function(){this.node=this.container.getFirst(),this.node.set("id",this.json.id),this.node.setStyles("Mobile"===this.options.mode?this.css.formMobileNode:this.css.formNode),this.node.store("module",this),this.loadDomTree()},loadDomTree:function(){this.createFormTreeNode(),this.parseModules(this,this.node)},createFormTreeNode:function(){this.treeNode={insertChild:function(){return this},appendChild:function(){return this},selectNode:function(){},node:null,parentNode:{}},this.treeNode.module=this}});