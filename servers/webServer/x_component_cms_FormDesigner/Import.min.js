MWF.xApplication=MWF.xApplication||{},MWF.xApplication.cms=MWF.xApplication.cms||{},MWF.xApplication.cms.FormDesigner=MWF.xApplication.cms.FormDesigner||{},MWF.xDesktop.requireApp("portal.PageDesigner","Import",null,!1),MWF.xApplication.cms.FormDesigner.Import=MWF.CMSFormImport=new Class({Extends:MWF.FormImport}),MWF.CMSFormImport.O2=new Class({Extends:MWF.FormImport.O2}),MWF.CMSFormImport.Html=new Class({Extends:MWF.FormImport.Html,parseImplodeCSS:function(t,e,i){for(var o,n=/(url\(.*\))/g;null!==(o=n.exec(t));){var s=o[0],r=s.length,l=s.substring(s.length-2,s.length-1),a="'"===l||'"'===l?2:1;s=s.substring(s.lastIndexOf("/")+1,s.length-a);var c="x_cms_assemble_control",p=c+o2.Actions.get(c).action.actions.readFile.uri,m=(p="url('"+(p=(p=p.replace("{flag}",s)).replace("{applicationFlag}",this.form.json.application||this.form.json.portal))+"')").length;t=t.substring(0,o.index)+p+t.substring(n.lastIndex,t.length),n.lastIndex=n.lastIndex+(m-r)}return t},convertImgNode:function(t,e){return this.getImplodeModuleJson(e,"Image",t.get("id")||"image",t,function(e,i){var o=t.get("src");if(o){var n="x_cms_assemble_control",s=o.substring(o.lastIndexOf("/")+1,o.length),r=n+o2.Actions.get(n).action.actions.readFile.uri;r=(r=r.replace("{flag}",s)).replace("{applicationFlag}",this.form.json.application||this.form.json.portal),i.properties.src=r,t.set("src",r)}t.set({mwftype:"img",id:e})}.bind(this)),t}}),MWF.CMSFormImport.Office=new Class({Extends:MWF.CMSFormImport.Html,options:{stylePath:"../x_component_portal_PageDesigner/$Import/{style}/style_office.css"},init:function(){this.inforText=this.form.designer.lp.importOffice_infor,this.inforText2=this.form.designer.lp.importOffice_infor2,this.panelTitle=this.form.designer.lp.importOffice,this.panelWidth=800,this.panelHeight=240,this.editorMode="html"},loadEditor:function(){this.contentCss&&this.contentCss.destroy(),this.inforText2Node&&this.inforText2Node.destroy(),this.file=new Element("input.importFile",{type:"file",accept:".doc,.docx,.xls,.xlsx"}).inject(this.contentHtml)},loadEvent:function(){this.cancelNode.addEvent("click",function(){this.implodePanel.closePanel()}.bind(this)),this.okNode.addEvent("click",function(t){var e=this.file.files;if(!e.length)return this.form.designer.notice(this.form.designer.lp.implodeOfficeEmpty,"error",this.node),!1;var i=this;this.form.designer.confirm("warn",t,this.form.designer.lp.implodeConfirmTitle,this.form.designer.lp.implodeConfirmText,400,100,(function(){i.implodeOffice(e),this.close()}),(function(){this.close()}))}.bind(this))},implodeOffice:function(t){var e=t.item(0),i=new FormData;i.append("file",e),MWF.Actions.get("x_general_assemble_control").convertHtml(i,e,function(t){var e=t.data.value;this.implode(e)}.bind(this))}}),MWF.CMSFormImport.create=function(t,e,i){return new(MWF.CMSFormImport[t.capitalize()])(e,i)};