MWF.xApplication.process=MWF.xApplication.process||{},MWF.xApplication.cms.FormDesigner=MWF.xApplication.cms.FormDesigner||{},MWF.xApplication.cms.FormDesigner.widget=MWF.xApplication.cms.FormDesigner.widget||{},MWF.xDesktop.requireApp("Selector","package",null,!1),MWF.xDesktop.requireApp("process.ProcessDesigner","widget.PersonSelector",null,!1),MWF.require("MWF.widget.O2Identity",null,!1),MWF.widget.O2CMSApplication=new Class({Extends:MWF.widget.O2Application,getPersonData:function(){this.data.distinguishedName||(this.action=new MWF.xDesktop.Actions.RestActions("","x_cms_assemble_control",""),this.action.actions={getCMSApplication:{uri:"/jaxrs/appinfo/{id}"}},this.action.invoke({name:"getCMSApplication",async:!1,parameter:{id:this.data.id||this.data.name},success:function(t){this.data=t.data,this.data.name=this.data.appName}.bind(this)}))}}),MWF.widget.O2CMSCategory=new Class({Extends:MWF.widget.O2CMSApplication,getPersonData:function(){this.data.distinguishedName||(this.action=new MWF.xDesktop.Actions.RestActions("","x_cms_assemble_control",""),this.action.actions={getCMSCategory:{uri:"/jaxrs/categoryinfo/{id}"}},this.action.invoke({name:"getCMSCategory",async:!1,parameter:{id:this.data.id||this.data.name},success:function(t){this.data=t.data,this.data.name=this.data.categoryName}.bind(this)}))}}),MWF.xApplication.cms.FormDesigner.widget.PersonSelector=new Class({Implements:[Options,Events],Extends:MWF.xApplication.process.ProcessDesigner.widget.PersonSelector,options:{style:"default",type:"identity",names:[]},loadIdentitys:function(){var t={actions:this.restActions,app:{lp:this.app.lp}};this.options.names&&("duty"==this.options.type.toLowerCase()?JSON.decode(this.options.names).each(function(i){var e=new MWF.widget.Duty(i,this.node,t,!0,(function(t){var i=this,e=this.selector.app.lp.deleteDutyText.replace(/{duty}/g,this.data.name);this.selector.app.confirm("warm",t,this.selector.app.lp.deleteDutyTitle,e,300,120,(function(){i.selector.fireEvent("removeDuty",[i]),this.close()}),(function(){this.close()})),t.stopPropagation()}));e.selector=this,e.explorer=t,this.identitys.push(e)}.bind(this)):this.options.names.each(function(t){MWF.require("MWF.widget.O2Identity",function(){"identity"==this.options.type.toLowerCase()&&this.identitys.push(new MWF.widget.O2Identity({name:t.name,id:t.id},this.node,{})),"unit"==this.options.type.toLowerCase()&&this.identitys.push(new MWF.widget.O2Unit({name:t.name,id:t.id},this.node,{})),"person"==this.options.type.toLowerCase()&&this.identitys.push(new MWF.widget.O2Person({name:t.name,id:t.id},this.node,{})),"application"==this.options.type.toLowerCase()&&this.identitys.push(new MWF.widget.O2CMSApplication({name:t.name,id:t.id},this.node,{})),"category"==this.options.type.toLowerCase()&&this.identitys.push(new MWF.widget.O2CMSCategory({name:t.name,id:t.id},this.node,{})),"formfield"==this.options.type.toLowerCase()&&this.identitys.push(new MWF.widget.O2FormField({name:t,id:t},this.node,{})),"view"===this.options.type.toLowerCase()&&this.identitys.push(new MWF.widget.O2View(data,this.node)),"cmsview"===this.options.type.toLowerCase()&&this.identitys.push(new MWF.widget.O2CMSView(data,this.node))}.bind(this))}.bind(this)))},createAddNode:function(){this.addNode=new Element("div",{styles:this.css.addPersonNode}).inject(this.node,"before"),this.addNode.addEvent("click",function(t){var i=[];this.identitys.each((function(t){i.push(t.data.id)}));var e={actions:this.restActions,app:{lp:this.app.lp}},s=this.options.type;"application"==s?s="CMSApplication":"category"==s?s="CMSCategory":"formField"==s&&(s="CMSFormField");var n={type:s,application:this.options.application,fieldType:this.options.fieldType,count:"duty"==this.options.type.toLowerCase()?1:0,values:i,zIndex:2e4,form:this.options.form,onComplete:function(t){this.identitys=[],"duty"!=this.options.type.toLowerCase()&&this.node.empty(),MWF.require("MWF.widget.O2Identity",function(){t.each(function(t){"identity"==this.options.type.toLowerCase()&&this.identitys.push(new MWF.widget.O2Identity(t.data,this.node,{})),"unit"==this.options.type.toLowerCase()&&this.identitys.push(new MWF.widget.O2Unit(t.data,this.node,{})),"person"==this.options.type.toLowerCase()&&this.identitys.push(new MWF.widget.O2Person(t.data,this.node,{})),"application"==this.options.type.toLowerCase()&&this.identitys.push(new MWF.widget.O2CMSApplication(t.data,this.node,{})),"category"==this.options.type.toLowerCase()&&this.identitys.push(new MWF.widget.O2CMSCategory(t.data,this.node,{})),"formfield"==this.options.type.toLowerCase()&&this.identitys.push(new MWF.widget.O2FormField(t.data,this.node,{})),"view"===this.options.type.toLowerCase()&&this.identitys.push(new MWF.widget.O2View(data,this.node)),"cmsview"===this.options.type.toLowerCase()&&this.identitys.push(new MWF.widget.O2CMSView(data,this.node))}.bind(this)),"duty"==this.options.type.toLowerCase()&&t.each(function(t){new MWF.xApplication.cms.FormDesigner.widget.PersonSelector.DutyInput(this,t.data,this.node,e,2e4)}.bind(this)),this.fireEvent("change",[this.identitys])}.bind(this))}.bind(this)};new MWF.O2Selector(this.app.content,n)}.bind(this))}}),MWF.xApplication.cms.FormDesigner.widget.PersonSelector.DutyInput=Class({Extends:MWF.xApplication.process.ProcessDesigner.widget.PersonSelector.DutyInput});