var MWFCalendar=MWF.xApplication.Calendar=MWF.xApplication.Calendar||{};MWF.require("MWF.xDesktop.UserData",null,!1),MWF.require("MWF.xAction.org.express.RestActions",null,!1),MWF.xDesktop.requireApp("Calendar","Common",null,!1),MWF.xDesktop.requireApp("Template","MDomItem",null,!1),MWF.xApplication.Calendar.options.multitask=!1,MWFCalendar.LeftNaviWidth=250,MWF.xApplication.Calendar.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"Calendar",icon:"icon.png",width:"1000",height:"600",isResize:!0,isMax:!0,eventId:"",title:MWF.xApplication.Calendar.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.Calendar.LP,this.menuMode="show",this.isManager=MWF.AC.isAdministrator(),this.userName=(layout.desktop.session.user||layout.user).distinguishedName,this.actions||(this.actions=MWF.Actions.get("x_calendar_assemble_control"))},loadApplication:function(e){this.canlendarData=null,MWF.UD.getDataJson("calendarConfig",function(t){this.calendarConfig=t||{},MWF.UD.getPublicData("calendarConfig",function(t){var i=t||{};for(var n in i.process?this.calendarConfig.process=i.process:this.calendarConfig.process=null,i.weekBegin&&(this.calendarConfig.weekBegin=i.weekBegin),i)"process"!=n&&"weekBegin"!=n&&(this.calendarConfig[n]=i[n]);this.calendarConfig.disableViewList||(this.calendarConfig.disableViewList=[]),this.createNode(),this.options.isRefresh?this.listCalendar(function(){this.loadLayout()}.bind(this)):this.maxSize(function(){this.listCalendar(function(){this.loadLayout()}.bind(this))}.bind(this)),e&&e()}.bind(this))}.bind(this))},listCalendar:function(e){this.canlendarData?e&&e(this.canlendarData):this.actions.listMyCalendar(function(t){0==(t.data.myCalendars||[]).length?this.createDefaultCalendar((function(){e&&e(t.data)})):(this.canlendarData=t.data,this.calendarDataList=t.data.myCalendars,this.currentCalendarData=t.data.myCalendars[0],e&&e(t.data))}.bind(this))},getSelectedCalendarId:function(){return this.leftNavi?this.leftNavi.getSelectedCalendarId():null},createDefaultCalendar:function(e){this.actions.listMyCalendar(function(t){0==(t.data.myCalendars||[]).length||(this.canlendarData=t.data,this.calendarDataList=t.data.myCalendars,this.currentCalendarData=t.data.myCalendars[0],e&&e())}.bind(this))},createNode:function(){this.content.setStyle("overflow","hidden"),this.node=new Element("div",{styles:{width:"100%",height:"100%",overflow:"hidden"}}).inject(this.content),this.naviContainerNode=new Element("div.naviContainerNode",{styles:this.css.naviContainerNode}).inject(this.node),this.leftTitleNode=new Element("div.leftTitleNode",{styles:this.css.leftTitleNode}).inject(this.naviContainerNode),this.rightContentNode=new Element("div",{styles:this.css.rightContentNode}).inject(this.node)},loadLayout:function(){this.status&&this.status.action?this.defaultAction=this.status.action:this.options.defaultAction?this.defaultAction=this.options.defaultAction:this.calendarConfig.defaultView?this.defaultAction=this.calendarConfig.defaultView:this.defaultAction="toMonth",this.calendarConfig.disableViewList.contains(this.defaultAction)&&(this.defaultAction=""),this.loadNaviTitleNode(),this.loadLeftNavi(),this.topMenu=new Element("div",{styles:this.css.topMenu}).inject(this.rightContentNode),this.contentNode=new Element("div",{styles:this.css.contentNode}).inject(this.rightContentNode),this.loadTopMenus(),this.resizeNodes(),this.resizeNodesFun=this.resizeNodes.bind(this),this.addEvent("resize",this.resizeNodesFun)},loadNaviTitleNode:function(){this.titleContentNode=new Element("div.titleContentNode",{styles:this.css.titleContentNode}).inject(this.leftTitleNode),this.newCalendarNode=new Element("div",{styles:this.css.newCalendarNode,text:this.lp.createNewCalendar,events:{mouseover:function(e){e.target.setStyles(this.css.newCalendarNode_over)}.bind(this),mouseout:function(e){e.target.setStyles(this.css.newCalendarNode)}.bind(this),click:function(){this.addCalendar()}.bind(this)}}).inject(this.titleContentNode)},loadLeftNavi:function(){this.naviNode=new Element("div.naviNode",{styles:this.css.naviNode}).inject(this.naviContainerNode),this.leftNavi=new MWF.xApplication.Calendar.Navi(this,this.naviNode,{})},loadTopMenus_middle:function(){},loadTopMenus_right:function(){this.topMenuRight=new Element("div",{styles:this.css.topMenuRight}).inject(this.topMenu),this.createTopMenu_right(this.lp.addEvent,"icon_newapply","addCalendarEvent"),this.createTopMenu_right(this.lp.setting,"icon_shezhi","config").setStyle("float","right")},createTopMenu_right:function(e,t,i){var n=new Element("div",{styles:this.css.topMenuNode_right,title:e}).inject(this.topMenuRight),s=new Element("div",{styles:this.css.topMenuIconNode}).inject(n);new Element("div",{styles:this.css.topMenuTextNode,text:e}).inject(n);s.setStyle("background","url(../x_component_Calendar/$Main/default/icon/"+t+".png) no-repeat center center"),n.store("icon",t),n.store("iconNode",s);var a=this;return n.addEvents({mouseover:function(){this.node.setStyles(a.css.topMenuNode_over),this.node.retrieve("iconNode").setStyle("background","url(../x_component_Calendar/$Main/default/icon/"+this.node.retrieve("icon")+"_click.png) no-repeat center center")}.bind({node:n}),mouseout:function(){this.node.setStyles(a.css.topMenuNode_right),this.node.retrieve("iconNode").setStyle("background","url(../x_component_Calendar/$Main/default/icon/"+this.node.retrieve("icon")+".png) no-repeat center center")}.bind({node:n}),click:function(){this.node.setStyles(a.css.topMenuNode_down),this.node.retrieve("iconNode").setStyle("background","url(../x_component_Calendar/$Main/default/icon/"+this.node.retrieve("icon")+"_click.png) no-repeat center center"),a[i]&&a[i].apply(a)}.bind({node:n})}),n},loadTopMenus:function(){this.createTopMenu(this.lp.month,"icon_yue","toMonth"),this.createTopMenu(this.lp.week,"icon_zhou","toWeek"),this.createTopMenu(this.lp.day,"icon_ri","toDay"),this.createTopMenu(this.lp.list,"icon_liebiao","toList"),this.loadTopMenus_middle(),this.loadTopMenus_right()},isViewAvailable:function(e){return!this.calendarConfig.disableViewList.contains(e)},createTopMenu:function(e,t,i){if(!this.calendarConfig.disableViewList.contains(i)){this.calendarConfig[i+"ViewName"]&&(e=this.calendarConfig[i+"ViewName"]);var n=new Element("div",{styles:this.css.topMenuNode}).inject(this.topMenu),s=new Element("div",{styles:this.css.topMenuIconNode}).inject(n);s.setStyle("background","url(../x_component_Calendar/$Main/default/icon/"+t+".png) no-repeat center center");new Element("div",{styles:this.css.topMenuTextNode,text:e}).inject(n);n.store("icon",t),n.store("iconNode",s),n.store("action",i);var a=this;return n.addEvents({mouseover:function(){this.node!=a.currentTopMenuNode&&(this.node.setStyles(a.css.topMenuNode_over),this.node.retrieve("iconNode").setStyle("background","url(../x_component_Calendar/$Main/default/icon/"+this.node.retrieve("icon")+"_click.png) no-repeat center center"))}.bind({node:n}),mouseout:function(){this.node!=a.currentTopMenuNode&&(this.node.setStyles(a.css.topMenuNode),this.node.retrieve("iconNode").setStyle("background","url(../x_component_Calendar/$Main/default/icon/"+this.node.retrieve("icon")+".png) no-repeat center center"))}.bind({node:n}),click:function(){this.node!=a.currentTopMenuNode&&(this.node.setStyles(a.css.topMenuNode_down),this.node.retrieve("iconNode").setStyle("background","url(../x_component_Calendar/$Main/default/icon/"+this.node.retrieve("icon")+"_click.png) no-repeat center center")),a.currentTopMenuNode&&this.node!=a.currentTopMenuNode&&(a.currentTopMenuNode.setStyles(a.css.topMenuNode),a.currentTopMenuNode.retrieve("iconNode").setStyle("background","url(../x_component_Calendar/$Main/default/icon/"+a.currentTopMenuNode.retrieve("icon")+".png) no-repeat center center")),a.currentTopMenuNode=this.node,a[i]&&a[i].apply(a)}.bind({node:n})}),this.defaultAction?this.defaultAction==i&&n.click():this.loaded||(n.click(),this.loaded=!0),this.resizeNodes(),n}},hideCurrentView:function(){this.currentView&&(this.currentView.hide(),this.currentView=null)},toList:function(){this.contentNode&&this.contentNode.setStyle("background","#EEE"),this.currentView&&(this.currentView.destroy(),this.currentView=null),this.listView=null,this.getListView(function(){this.listView.show(),this.currentView=this.listView,this.options.eventId&&(this.openEvent(this.options.eventId),this.options.eventId="")}.bind(this))},getListView:function(e){this.listView?e&&e():MWF.xDesktop.requireApp("Calendar","ListView",function(){var t;this.status&&this.status.options?t=this.status.options:this.currentDate,this.listView=new MWF.xApplication.Calendar.ListView(this.contentNode,this,t),t&&this.status&&(this.status.options=null),e&&e()}.bind(this))},toMonth:function(){this.contentNode&&this.contentNode.setStyle("background","#EEE"),this.currentView&&(this.currentView.destroy(),this.currentView=null),this.monthView=null,this.getMonthView(function(){this.monthView.show(),this.currentView=this.monthView,this.options.eventId&&(this.openEvent(this.options.eventId),this.options.eventId="")}.bind(this))},getMonthView:function(e){this.monthView?e&&e():MWF.xDesktop.requireApp("Calendar","MonthView",function(){var t;this.status&&this.status.options?t=this.status.options:this.currentDate,this.monthView=new MWF.xApplication.Calendar.MonthView(this.contentNode,this,t),t&&this.status&&(this.status.options=null),e&&e()}.bind(this))},toWeek:function(){this.contentNode&&this.contentNode.setStyle("background","#EEE"),this.currentView&&(this.currentView.destroy(),this.currentView=null),this.weekView=null,this.getWeekView(function(){this.weekView.show(),this.currentView=this.weekView,this.options.eventId&&(this.openEvent(this.options.eventId),this.options.eventId="")}.bind(this))},getWeekView:function(e){this.weekView?e&&e():MWF.xDesktop.requireApp("Calendar","WeekView",function(){var t;this.status&&this.status.options?t=this.status.options:this.currentDate,this.weekView=new MWF.xApplication.Calendar.WeekView(this.contentNode,this,t),t&&this.status&&(this.status.options=null),e&&e()}.bind(this))},toDay:function(e){this.contentNode&&this.contentNode.setStyle("background","#EEE"),this.currentView&&(this.currentView.destroy(),this.currentView=null),this.dayView=null,this.getDayView(function(){this.dayView.show(),this.currentView=this.dayView,this.options.eventId&&(this.openEvent(this.options.eventId),this.options.eventId="")}.bind(this),e)},getDayView:function(e,t){this.dayView?(this.dayView.toDay(t),e&&e()):MWF.xDesktop.requireApp("Calendar","DayView",function(){var i;this.status&&this.status.options?i=this.status.options:t?i={date:t}:this.currentDate,this.dayView=new MWF.xApplication.Calendar.DayView(this.contentNode,this,i),this.status&&this.status&&(this.status.options=null),e&&e()}.bind(this))},addCalendarEvent:function(e,t,i,n){MWF.UD.getPublicData("calendarConfig",function(s){var a=s?s.process:null;if(a)this.loadCalendarProcess(a);else{var o=new MWF.xApplication.Calendar.EventForm(this,{},{date:e,hour:t,minute:i,defaultCalendarId:n},{app:this});o.view=this,o.create()}}.bind(this))},addCalendar:function(){var e=new MWF.xApplication.Calendar.CalendarForm(this,{},{},{app:this});e.view=this.leftNavi,e.create()},editCalendar:function(e){var t=new MWF.xApplication.Calendar.CalendarForm(this,e,{},{app:this});t.view=this.leftNavi,this.isEventEditable(e)?t.edit():t.open()},openCalendar:function(e){var t=new MWF.xApplication.Calendar.CalendarForm(this,e,{},{app:this});t.view=this.leftNavi,t.open()},loadCalendarProcess:function(e){this.getProcess(e,function(e){MWF.xDesktop.requireApp("process.TaskCenter","ProcessStarter",function(){new MWF.xApplication.process.TaskCenter.ProcessStarter(e,this,{onStarted:function(e,t,i){this.afterStartProcess(e,t,i)}.bind(this)}).load()}.bind(this))}.bind(this))},afterStartProcess:function(e,t,i){var n=[],s=[];if(e.each(function(e){-1!==e.currentTaskIndex&&s.push(e.taskList[e.currentTaskIndex].work),n.push(this.getStartWorkInforObj(e))}.bind(this)),1===s.length){var a={workId:s[0],appId:s[0]};this.desktop.openApplication(null,"process.Work",a),this.createStartWorkResault(n,t,i,!1)}else this.createStartWorkResault(n,t,i,!0)},createStartWorkResault:function(e,t,i,n){var s="";e.each(function(e){var t=[];e.users.each((function(e){t.push(MWF.name.cn(e))})),s+="<div><b>"+this.lp.nextActivity+'<font style="color: #ea621f">'+e.activity+"</font>, "+this.lp.nextUser+'<font style="color: #ea621f">'+t.join(", ")+"</font></b>",e.currentTask&&n?s+='&nbsp;&nbsp;&nbsp;&nbsp;<span value="'+e.currentTask+'">'+this.lp.deal+"</span></div>":s+="</div>"}.bind(this));var a={subject:this.lp.processStarted,content:"<div>"+this.lp.processStartedMessage+"“["+i+"]"+t+"”</div>"+s},o=layout.desktop.message.addTooltip(a),l=layout.desktop.message.addMessage(a);this.setStartWorkResaultAction(o),this.setStartWorkResaultAction(l)},getStartWorkInforObj:function(e){var t=[],i="";return e.taskList.each(function(n,s){t.push(n.person+"("+n.department+")"),e.currentTaskIndex===s&&(i=n.id)}.bind(this)),{activity:e.fromActivityName,users:t,currentTask:i}},setStartWorkResaultAction:function(e){var t=e.node.getElements("span");t.setStyles(this.app.css.dealStartedWorkAction);var i=this;t.addEvent("click",(function(e){var t={taskId:this.get("value"),appId:this.get("value")};i.desktop.openApplication(e,"process.Work",t)}))},getProcess:function(e,t){t&&t(e)},config:function(){new MWF.xApplication.Calendar.Config(this,this.calendarConfig)},recordStatus:function(){return{action:this.currentTopMenuNode?this.currentTopMenuNode.retrieve("action"):"toMyCalendar",options:this.currentView.recordStatus?this.currentView.recordStatus():null}},reloadView:function(){this.currentView&&this.currentView.reload()},reload:function(){this.refresh()},loadSideBar:function(){},resizeNodes:function(){if(this.showLeftNavi=!0,this.inContainer)var e=this.container.getSize();else e=this.node.getSize();this.naviContainerNode.setStyle("height",e.y+"px"),this.showLeftNavi&&this.rightContentNode.setStyle("width",e.x-MWFCalendar.LeftNaviWidth),this.currentView&&this.currentView.resetNodeSize(),this.leftNavi&&this.leftNavi.resizeNode()},openEvent:function(e){this.actions.getEvent(e,function(e){var t=new MWF.xApplication.Calendar.EventForm(this,e.data,{isFull:!0},{app:this});t.view=this.currentView,t.open()}.bind(this))},isEventEditable:function(e){return!!MWF.AC.isAdministrator()||(!!(e.manageablePersonList||[]).contains(layout.desktop.session.user.distinguishedName)||e.createPerson===layout.desktop.session.user.distinguishedName)}}),MWF.xApplication.Calendar.Navi=new Class({Implements:[Options,Events],options:{},initialize:function(e,t,i){this.setOptions(i),this.app=e,this.lp=this.app.lp,this.node=$(t),this.css=this.app.css,this.load()},load:function(){this.naviContainer=new Element("div",{styles:{overflow:"hidden"}}).inject(this.node),this.naviNode=new Element("div").inject(this.naviContainer),this.myCalendarNaviItem=[],this.unitCalendarNaviItem=[],this.followCalendarNaviItem=[],this.app.listCalendar(function(e){this.myCalendars=e.myCalendars,this.unitCalendars=e.unitCalendars,this.followCalendars=e.followCalendars,this.app.canlendarData=null,this.loadNode()}.bind(this)),o2.require("MWF.widget.ScrollBar",function(){this.scrollBar=new MWF.widget.ScrollBar(this.naviContainer,{indent:!1,style:"default",where:"before",distance:60,friction:4,axis:{x:!1,y:!0},onScroll:function(e){}.bind(this)})}.bind(this))},loadNode:function(){this.loadMyCalendar(),this.loadUnitCalendar(),this.loadFollowCalendar(),this.loadMoreCalendarNode()},reload:function(){this.node.empty(),this.load()},loadMoreCalendarNode:function(){this.seeMore=new Element("div.seeMore",{styles:this.css.seeMoreNode,text:this.lp.calendarMarket,events:{mouseover:function(e){e.target.setStyles(this.css.seeMoreNode_over)}.bind(this),mouseout:function(e){e.target.setStyles(this.css.seeMoreNode)}.bind(this),click:function(e){var t=new MWF.xApplication.Calendar.CalendarMarket(this.app,{},{},{app:this.app});t.view=this.leftNavi,t.create()}.bind(this)}}).inject(this.node)},selectSingleCalendar:function(e){this.myCalendarNaviItem.each((function(t){t.isSelected&&t.data.id!==e&&t.cancelSelect(),t.isSelected||t.data.id!=e||t.select()})),this.unitCalendarNaviItem.each((function(t){t.isSelected&&t.data.id!==e&&t.cancelSelect(),t.isSelected||t.data.id!=e||t.select()})),this.followCalendarNaviItem.each((function(t){t.isSelected&&t.data.id!==e&&t.cancelSelect(),t.isSelected||t.data.id!=e||t.select()})),this.app.reloadView()},getSelectedCalendarId:function(){var e=[];return this.myCalendarNaviItem.each((function(t){t.isSelected&&e.push(t.data.id)})),this.unitCalendarNaviItem.each((function(t){t.isSelected&&e.push(t.data.id)})),this.followCalendarNaviItem.each((function(t){t.isSelected&&e.push(t.data.id)})),e},loadMyCalendar:function(){var e=this.createCategoryNode(this.lp.myCalendar);this.myCalendars.each(function(t){this.myCalendarNaviItem.push(new MWF.xApplication.Calendar.NaviItem(this,e,t,{isSelected:!0}))}.bind(this))},loadUnitCalendar:function(){var e=this.createCategoryNode(this.lp.unitCalendar);this.unitCalendars.each(function(t){this.unitCalendarNaviItem.push(new MWF.xApplication.Calendar.NaviItem(this,e,t,{isSelected:!0}))}.bind(this))},loadFollowCalendar:function(){var e=this.createCategoryNode(this.lp.myFollowCalendar);this.followCalendars.each(function(t){this.followCalendarNaviItem.push(new MWF.xApplication.Calendar.NaviItem(this,e,t,{isSelected:!0}))}.bind(this))},createCategoryNode:function(e){var t=this,i=new Element("div.categoryNaviNode",{styles:this.css.categoryNaviNode}).inject(this.naviNode),n=new Element("div.categoryExpendNode",{styles:this.css.categoryExpendNode}).inject(i);i.addEvent("click",function(e){var i=this.categoryNaviNode;i.retrieve("isExpended")?(i.store("isExpended",!1),i.retrieve("expendNode").setStyles(t.css.categoryCollapseNode),i.retrieve("listNode").setStyle("display","none")):(i.store("isExpended",!0),i.retrieve("expendNode").setStyles(t.css.categoryExpendNode),i.retrieve("listNode").setStyle("display",""))}.bind({categoryNaviNode:i}));var s=new Element("div.categoryNaviTextNode",{styles:this.css.categoryNaviTextNode,text:e}).inject(i),a=new Element("div.viewNaviListNode",{styles:this.css.viewNaviListNode}).inject(this.naviNode);return i.store("isExpended",!0),i.store("expendNode",n),i.store("textNode",s),i.store("listNode",a),a},resizeNode:function(){if(this.app.inContainer)var e=this.app.container.getSize();else e=this.app.node.getSize();this.node.setStyle("height",e.y-80),this.naviContainer.setStyle("height",e.y-122)}}),MWF.xApplication.Calendar.NaviItem=new Class({Implements:[Options,Events],options:{style:"default",index:0,isSelected:!0},initialize:function(e,t,i,n){this.setOptions(n),this.navi=e,this.app=e.app,this.data=i,this.container=$(t),this.css=this.app.css,this.load()},load:function(){this.isSelected=this.options.isSelected;var e=this;this.node=new Element("div.naviItemNode",{styles:this.css.naviItemNode}).inject(this.container),this.node.addEvents({mouseover:function(){this.setStyles(e.css.naviItemNode_over),e.actionNode.fade("in")},mouseout:function(){this.setStyles(e.css.naviItemNode),e.actionNode.fade("out")},click:function(t){e.isSelected?e.cancelSelect(!0):e.select(!0)}}),this.actionNode=new Element("div.naviItemActionNode",{styles:this.css.naviItemActionNode,events:{click:function(e){e.stopPropagation()}.bind(this)}}).inject(this.node),this.colorNode=new Element("div",{styles:this.css.naviColorNode}).inject(this.node),this.colorNode.setStyle("border-color",this.data.color),this.textNode=new Element("div.naviItemTextNode",{styles:this.css.naviItemTextNode,text:this.data.name,title:this.data.name}).inject(this.node),this.isSelected&&this.select(),this.loadActionsMenu()},select:function(e){this.isSelected=!0,this.colorNode.setStyle("background-color",this.data.color),this.colorNode.setStyles(this.css.naviColorNode_selected),e&&this.app.reloadView()},cancelSelect:function(e){this.isSelected=!1,this.colorNode.setStyle("background-color","transparent"),this.colorNode.setStyles(this.css.naviColorNode),this.colorNode.setStyle("border-color",this.data.color),e&&this.app.reloadView()},loadActionsMenu:function(){this.menu=new MWF.xApplication.Calendar.CalendarMenu(this.actionNode,{},this.app,{},this.app.node),this.menu.calendarData=this.data,this.menu.load()}}),MWF.xDesktop.requireApp("Template","MSelector",null,!1),MWF.xApplication.Calendar.CalendarMenu=new Class({Extends:MSelector,options:{style:"arrow",width:"150px",height:"36px",defaultOptionLp:MWF.xApplication.Calendar.LP.font,textField:"name",valueField:"val",event:"mouseenter",isSetSelectedValue:!1,isChangeOptionStyle:!1,emptyOptionEnable:!1,containerIsTarget:!0,tooltipsOptions:{axis:"x",hasArrow:!0}},_selectItem:function(e,t,i){this[t.val]&&this[t.val](i)},showThis:function(){this.app.leftNavi.selectSingleCalendar(this.calendarData.id)},createEvent:function(){this.app.addCalendarEvent(null,null,null,this.calendarData.id)},openCalendar:function(){this.app.actions.getCalendar(this.calendarData.id,function(e){this.app.openCalendar(e.data)}.bind(this))},editCalendar:function(){this.app.actions.getCalendar(this.calendarData.id,function(e){this.app.editCalendar(e.data)}.bind(this))},deleteCalendar:function(e){var t=MWF.xApplication.Calendar.LP,i=this;i.app.confirm("warn",e,t.deleteCalendarTitle,t.deleteCalendarContent.replace("{name}",i.calendarData.name),300,120,(function(){i.app.actions.deleteCalendar(i.calendarData.id,function(e){i.app.notice(t.deleteSuccess),i.app.leftNavi.reload()}.bind(this)),this.close()}),(function(){this.close()}),null)},_loadData:function(e){var t=MWF.xApplication.Calendar.LP,i=[{name:t.onlyViewCurrent,val:"showThis"}];(this.calendarData.publishable||this.calendarData.manageable)&&i.push({name:t.addEvent,val:"createEvent"}),this.calendarData.manageable?i.push({name:t.editCalendar,val:"editCalendar"},{name:t.deleteCalendar,val:"deleteCalendar"}):i.push({name:t.viewCalendar,val:"openCalendar"}),e&&e(i)},_postCreateItem:function(e,t){e.setStyles({cursor:"pointer","font-size":"14px","min-height":"36px","line-height":"36px"})}}),MWF.xApplication.Calendar.CalendarMarket=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"meeting",width:"1100",height:"80%",hasTop:!0,hasIcon:!1,hasBottom:!1,hasTopIcon:!1,hasTopContent:!1,draggable:!0,maxAction:!0,closeAction:!0,title:MWF.xApplication.Calendar.LP.calendarMarket},_createTableContent:function(){var e=MWF.xApplication.Calendar.LP,t=this;this.formTableContainer.setStyles({width:"auto","padding-top":"20px","padding-left":"20px"}),this.formTableArea.setStyle("overflow","hidden"),this.app.actions.listPublicCalendar(function(i){i.data&&0!=i.data.length?(i.data||[]).each(function(i){var n=new Element("div",{styles:this.css.marketNode}).inject(this.formTableArea);n.setStyle("border-left","5px solid "+i.color);var s=new Element("div",{styles:this.css.marketItemNode}).inject(n),a=new Element("div",{styles:this.css.marketItemTopNode}).inject(s);new Element("div",{styles:this.css.marketItemTitleNode,text:i.name}).inject(a).setStyle("color",i.color);var o=new Element("div",{styles:this.css.marketItemMiddleNode}).inject(s);new Element("div",{styles:this.css.marketItemTopLable,text:e.create+"："}).inject(o),new Element("div",{styles:this.css.marketItemTopInfor,text:i.createor.split("@")[0]+"，"}).inject(o),new Element("div",{styles:this.css.marketItemTopLable,text:e.time+"："}).inject(o),new Element("div",{styles:this.css.marketItemTopInfor,text:i.createTime.split(" ")[0]}).inject(o);o=new Element("div",{styles:this.css.marketItemMiddleNode}).inject(s);new Element("div",{styles:this.css.marketItemTopLable,text:e.type+"："}).inject(o),new Element("div",{styles:this.css.marketItemTopInfor,text:"PERSON"==i.type?e.personal:e.unit2}).inject(o),"UNIT"==i.type&&(new Element("div",{styles:this.css.marketItemTopLable,text:e.belongTo+"："}).inject(o),new Element("div",{styles:this.css.marketItemTopInfor,text:i.target.split("@")[0],title:i.target.split("@")[0]}).inject(o));o=new Element("div",{styles:this.css.marketItemMiddleNode}).inject(s);new Element("div",{styles:this.css.marketItemTopLable,text:e.description+"："}).inject(o),new Element("div",{styles:this.css.marketItemDescriptiontInfor,text:i.description||"",title:i.description||""}).inject(o);var l=new Element("div",{styles:this.css.marketItemFollowedAction,text:e.followed,title:e.clickToCancelFollow,events:{click:function(){t.app.actions.followCalendarCancel(i.id,function(){t.app.notice(e.cancelFollowSuccess),t.needReload=!0,this.followedAction.setStyle("display","none"),this.followAction.setStyle("display","")}.bind({followedAction:l,followAction:d}))}.bind(this)}}).inject(n);i.followed||l.setStyle("display","none");var d=new Element("div",{styles:this.css.marketItemFollowAction,text:e.follow,events:{click:function(){t.app.actions.followCalendar(i.id,function(){t.app.notice(e.followSuccess),t.needReload=!0,this.followedAction.setStyle("display",""),this.followAction.setStyle("display","none")}.bind({followedAction:l,followAction:d}))}.bind(this)}}).inject(n);i.followed&&d.setStyle("display","none")}.bind(this)):this.noCalendarNode=new Element("div",{styles:this.css.noCalendarNode,text:e.noPublicCalendar}).inject(this.formTableArea)}.bind(this))},_close:function(){this.needReload&&this.app.reload()}}),MWF.xApplication.Calendar.Config=new Class({Implements:[Events],initialize:function(e){this.app=e,this.css=this.app.css,this.lp=this.app.lp,this.configData=this.app.calendarConfig||{},this.process=null,MWF.UD.getPublicData("calendarConfig",function(e){var t=e||{};for(var i in t.weekBegin&&(this.configData.weekBegin=t.weekBegin),t)"process"!=i&&"weekBegin"!=i&&"mobileCreateEnable"!=i&&(this.configData[i]=t[i]);this.load()}.bind(this))},load:function(){this.node=new Element("div",{styles:this.css.configNode}).inject(this.app.node),this.contentNode=new Element("div",{styles:this.css.configContentNode}).inject(this.node);var e="font-size:14px;color:#666;heigh:16px;margin-top:6px;margin-left:10px;",t="float:right; width:120px; border:1px solid #ccc",i=this.configData,n=(this.lp.config,"<div class='configTitle'>"+this.lp.config.default+"</div><div>");i.disableViewList.contains("toMonth")||(n+="   <div style='"+e+"'><input type='radio' name='configSelectDefaultView' "+("toMonth"==i.defaultView?"checked":"")+" value='toMonth'>"+(i.toMonthViewName||this.lp.month)+"   </div>"),i.disableViewList.contains("toWeek")||(n+="   <div style='"+e+"'><input type='radio' name='configSelectDefaultView' "+("toWeek"==i.defaultView?"checked":"")+" value='toWeek'>"+(i.toWeekViewName||this.lp.week)+"   </div>"),i.disableViewList.contains("toDay")||(n+="   <div style='"+e+"'><input type='radio' name='configSelectDefaultView' "+("toDay"==i.defaultView?"checked":"")+" value='toDay'>"+(i.toDayViewName||this.lp.day)+"   </div>"),i.disableViewList.contains("toList")||(n+="   <div style='"+e+"'><input type='radio' name='configSelectDefaultView' "+("toList"==i.defaultView?"checked":"")+" value='toList'>"+(i.toListViewName||this.lp.list)+"   </div>"),n+="</div>",MWF.AC.isAdministrator()&&(i.disableViewList=i.disableViewList||[],n+="<div class='line'></div><div class='configTitle'>"+this.lp.config.viewSetting+"</div><div>   <div style='"+e+"'><input type='checkbox' name='configAvailableView' "+(i.disableViewList.contains("toMonth")?"":"checked")+" value='toMonth'>"+this.lp.month+"<input type='text' name='toMonthViewName' value='"+(i.toMonthViewName||"")+"' style='"+t+"' placeholder='"+this.lp.config.viewCustomName+"' >   </div>   <div style='"+e+"'><input type='checkbox' name='configAvailableView' "+(i.disableViewList.contains("toWeek")?"":"checked")+" value='toWeek'>"+this.lp.week+"<input type='text' name='toWeekViewName' value='"+(i.toWeekViewName||"")+"' style='"+t+"' placeholder='"+this.lp.config.viewCustomName+"' >   </div>   <div style='"+e+"'><input type='checkbox' name='configAvailableView' "+(i.disableViewList.contains("toDay")?"":"checked")+" value='toDay'>"+this.lp.day+"<input type='text' name='toDayViewName' value='"+(i.toDayViewName||"")+"' style='"+t+"' placeholder='"+this.lp.config.viewCustomName+"' >   </div>   <div style='"+e+"'><input type='checkbox' name='configAvailableView' "+(i.disableViewList.contains("toList")?"":"checked")+" value='toList'>"+this.lp.list+"<input type='text' name='toListViewName' value='"+(i.toListViewName||"")+"' style='"+t+"' placeholder='"+this.lp.config.viewCustomName+"' >   </div></div><div class='line'></div><div class='configTitle'>"+this.lp.config.weekBegin+"</div><div><select name='configSelectWeekBeign'><option value='0' "+("0"==i.weekBegin?"selected":"")+">"+this.lp.weeks.Sun+"</option><option value='1' "+("1"==i.weekBegin?"selected":"")+">"+this.lp.weeks.Mon+"</option></select></div>"),this.contentNode.set("html",n),this.contentNode.getElements("div.line").setStyles(this.css.configContentLine),this.contentNode.getElements("div.configTitle").setStyles(this.css.configTitleDiv),MWF.AC.isAdministrator(),this.actionNode=new Element("div",{styles:this.css.configActionNode}).inject(this.node),this.cancelNode=new Element("div",{styles:this.css.configActionCancelNode,text:this.app.lp.cancel}).inject(this.actionNode),this.saveNode=new Element("div",{styles:this.css.configActionSaveNode,text:this.app.lp.save}).inject(this.actionNode),this.cancelNode.addEvent("click",this.hide.bind(this)),this.saveNode.addEvent("click",this.save.bind(this)),this.node.addEvent("mousedown",function(e){e.stopPropagation()}.bind(this)),this.setSize(),this.show()},setSize:function(){var e=this.node.getSize().y;if(this.app.inContainer)var t=this.app.container.getSize().y;else t=this.app.content.getSize().y;e>t-50&&this.node.setStyle("height",t-50)},createApplicationSelect:function(){this.configData.process&&MWF.require("MWF.widget.O2Identity",function(){new MWF.widget.O2Process(this.configData.process,this.processNode)}.bind(this)),this.processNode.addEvent("click",function(){MWF.xDesktop.requireApp("Selector","package",function(){var e={type:"Process",values:[this.process||this.configData.process],count:1,onComplete:function(e){this.processNode.empty(),this.process=null,this.configData.process=null,e.length&&MWF.require("MWF.widget.O2Identity",function(){new MWF.widget.O2Process(e[0].data,this.processNode);this.process={name:e[0].data.name,id:e[0].data.id,application:e[0].data.application,applicationName:e[0].data.applicationName,alias:e[0].data.alias},this.configData.process=this.process}.bind(this))}.bind(this)};new MWF.O2Selector(this.app.content,e)}.bind(this))}.bind(this))},save:function(){for(var e="toMyCalendar",t=this.contentNode.getElements("input[name='configSelectDefaultView']"),i=0;i<t.length;i++)if(t[i].checked){e=t[i].get("value");break}if(MWF.UD.putData("calendarConfig",{defaultView:e},null,!1),MWF.AC.isAdministrator()){var n=[],s=this.contentNode.getElements("input[name='configAvailableView']");for(i=0;i<s.length;i++)s[i].checked||n.push(s[i].get("value"));var a=this.contentNode.getElement("select[name='configSelectWeekBeign']"),o="0";a&&(o=a.options[a.selectedIndex].get("value")),MWF.UD.putPublicData("calendarConfig",{weekBegin:o,disableViewList:n,toMonthViewName:this.contentNode.getElement("input[name='toMonthViewName']").get("value"),toWeekViewName:this.contentNode.getElement("input[name='toWeekViewName']").get("value"),toDayViewName:this.contentNode.getElement("input[name='toDayViewName']").get("value"),toListViewName:this.contentNode.getElement("input[name='toListViewName']").get("value")},null,!1)}this.app.notice(this.app.lp.config_saveSuccess,"success"),this.hide()},show:function(){this.node.setStyles(this.css.configNode),new Fx.Morph(this.node,{duration:"500",transition:Fx.Transitions.Expo.easeOut}).start({opacity:1}).chain(function(){this.hideFun=this.hide.bind(this),this.app.node.addEvent("mousedown",this.hideFun)}.bind(this))},hide:function(){this.node.destroy(),this.app.node.removeEvent("mousedown",this.hideFun),MWF.release(this)}});