MWF.xApplication.portal=MWF.xApplication.portal||{},MWF.xApplication.portal.PortalExplorer=MWF.xApplication.portal.PortalExplorer||{},MWF.xDesktop.requireApp("process.ApplicationExplorer","",null,!1),MWF.xApplication.portal.PortalExplorer.Main=new Class({Extends:MWF.xApplication.process.ApplicationExplorer.Main,Implements:[Options,Events],options:{style:"default",name:"portal.PortalExplorer",mvcStyle:"style.css",icon:"icon.png",width:"1500",height:"760",isResize:!0,isMax:!0,title:MWF.xApplication.portal.PortalExplorer.LP.title,maxWidth:840,minWidth:540},onQueryLoad:function(){this.lp=MWF.xApplication.portal.PortalExplorer.LP,this.viewPath=this.path+this.options.style+"/view.html",this.restActions=MWF.Actions.get("x_portal_assemble_designer"),this.deleteElements=[]},loadControl:function(){this.control={},this.control.canCreate=MWF.AC.isPortalPlatformCreator(),this.control.canManage=!(!MWF.AC.isAdministrator()&&!MWF.AC.isPortalManager())},openFindDesigner:function(){layout.openApplication(null,"FindDesigner",{filter:{moduleList:["portal"]}})},createApplicationItem:function(t,a){new MWF.xApplication.portal.PortalExplorer.Portal(this,t,a).load()},okCreateApplication:function(t){var a=this.applicationCreateFormNode.getElement(".o2_process_AppExp_createApplicationName"),i=this.applicationCreateFormNode.getElement(".o2_process_AppExp_createApplicationAlias"),o=this.applicationCreateFormNode.getElement(".o2_process_AppExp_createApplicationDescription"),e=this.applicationCreateFormNode.getElement(".o2_process_AppExp_createApplicationType"),p={name:a.get("value"),alias:i.get("value"),description:o.get("value"),portalCategory:e.get("value")||""};p.name?this.restActions.saveApplication(p,function(t){this.applicationCreateMarkNode.destroy(),this.applicationCreateAreaNode.destroy(),this.restActions.getApplication(t.data.id,function(t){t.data.pageList=[],this.createApplicationItem(t.data,"top")}.bind(this)),this.reloadApplicationCategoryList(!0),this.notice(this.lp.application.createApplicationSuccess,"success")}.bind(this)):(a.setStyle("border-color","red"),a.focus(),this.notice(this.lp.application.inputApplicationName,"error"))},importApplication:function(t){MWF.xDesktop.requireApp("portal.PortalExplorer","Importer",function(){new MWF.xApplication.portal.PortalExplorer.Importer(this,t).load()}.bind(this))}}),MWF.xApplication.portal.PortalExplorer.Portal=new Class({Extends:MWF.xApplication.process.ApplicationExplorer.Application,Implements:[Events],checkManage:function(){return!!this.app.control.canManage||!(!this.app.control.canCreate||this.data.creatorPerson!=layout.desktop.session.user.name)},loadElements:function(){this.loadElementList("pageList",this.pageListNode,this.openPage.bind(this),this.lp.noPage,this.createNewPage.bind(this))},createNewPage:function(t){this.openApplication(t,0)},openPage:function(t,a){if(t){var i=this,o={appId:"portal.PageDesigner"+t,onQueryLoad:function(){this.actions=i.app.actions,this.options.id=t,this.application=i.data}};this.app.desktop.openApplication(a,"portal.PageDesigner",o)}},openApplication:function(t,a){var i="portal.PortalManager"+this.data.id;this.app.desktop.apps[i]?this.app.desktop.apps[i].setCurrent():this.app.desktop.openApplication(t,"portal.PortalManager",{application:this.data,appId:i,onQueryLoad:function(){this.status={navi:a||null}}})},setIconNode:function(){this.data.icon?this.iconNode.setStyle("background-image","url(data:image/png;base64,"+this.data.icon+")"):this.iconNode.setStyle("background-image","url(../x_component_portal_PortalExplorer/$Main/default/icon/application.png)"),this.iconNode.makeLnk({par:this._getLnkPar()})},_getLnkPar:function(){var t="../x_component_portal_PortalExplorer/$Main/default/lnk.png";this.data.icon&&(t="data:image/png;base64,"+this.data.icon);var a="portal.PortalManager"+this.data.id;return{icon:t,title:this.data.name,par:'portal.PortalManager#{"application": "'+this.data.id+'", "appId": "'+a+'"}'}},exportApplication:function(){MWF.xDesktop.requireApp("portal.PortalExplorer","Exporter",function(){new MWF.xApplication.portal.PortalExplorer.Exporter(this.app,this.data).load()}.bind(this))},_deleteElement:function(t,a,i,o){this.app.restActions.deleteApplication(t,i,o)}});