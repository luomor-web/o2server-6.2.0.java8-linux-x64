MWF.require("MWF.widget.Calendar",null,!1),MWF.xApplication.Meeting.WeekView=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",date:""},initialize:function(t,e,i){this.setOptions(i),this.path="../x_component_Meeting/$WeekView/",this.cssPath="../x_component_Meeting/$WeekView/"+this.options.style+"/css.wcss",this._loadCss(),this.app=e,this.container=$(t),this.weekBegin=this.app.meetingConfig.weekBegin||"0",this.load()},load:function(){this.node=new Element("div",{styles:this.css.node}).inject(this.container),this.resetNodeSize(),this.app.addEvent("resize",this.resetNodeSize.bind(this)),this.loadCalendar()},resetNodeSize:function(){var t=this.container.getSize(),e=t.y-60;this.node.setStyle("height",e+"px"),this.app.inContainer||this.node.setStyle("margin-top","60px");var i=this.app.sideBar?this.app.sideBar.getSize():{x:0,y:0};this.node.setStyle("width",t.x-i.x+"px"),this.node.setStyle("margin-right",i.x+"px")},loadCalendar:function(){var t="";t=this.options.date?Date.parse(this.options.date):new Date,this.currentWeek=this.getWeekNumber(t),this.calendar=new MWF.xApplication.Meeting.WeekView.Calendar(this,t)},hide:function(){new Fx.Morph(this.node,{duration:"300",transition:Fx.Transitions.Expo.easeOut}).start({opacity:0}).chain(function(){this.node.setStyle("display","none")}.bind(this))},show:function(){if(this.node.setStyles(this.css.node),this.app.inContainer)this.node.setStyles({opacity:1,position:"static",width:"auto"});else{var t=new Fx.Morph(this.node,{duration:"800",transition:Fx.Transitions.Expo.easeOut});this.app.fireAppEvent("resize"),t.start({opacity:1,left:"0px"}).chain(function(){this.node.setStyles({position:"static",width:"auto"})}.bind(this))}},reload:function(){this.calendar&&this.calendar.reLoadCalendar()},recordStatus:function(){var t="";return this.calendar&&(t=this.calendar.baseDate),{date:t.toString()}},destroy:function(){this.calendar&&this.calendar.destroy(),this.node.destroy()},getWeekNumber:function(t){var e=t.clone(),i=(7+t.getDay()-parseInt(this.weekBegin))%7;e.setDate(e.getDate()-i+3);var s=e.valueOf();return e.setMonth(0,1),4!=e.getDay()&&e.setMonth(0,1+(4-e.getDay()+7)%7),1+Math.ceil((s-e)/6048e5)}}),MWF.xApplication.Meeting.WeekView.Calendar=new Class({Implements:[Events],initialize:function(t,e){this.view=t,this.css=this.view.css,this.container=this.view.node,this.app=this.view.app,this.weekBegin=this.app.meetingConfig.weekBegin||"0",this.baseDate=e||new Date,this.today=new Date,this.days={},this.load()},load:function(){this.date=this.getWeekBeginDate(this.baseDate),this.titleNode=new Element("div",{styles:this.css.calendarTitleNode}).inject(this.container),this.scrollNode=new Element("div",{styles:this.app.inContainer?this.css.scrollNode_inContainer:this.css.scrollNode}).inject(this.container),this.contentWarpNode=new Element("div",{styles:this.css.contentWarpNode}).inject(this.scrollNode),this.contentContainerNode=new Element("div",{styles:this.css.contentContainerNode}).inject(this.contentWarpNode),this.bodyNode=new Element("div",{styles:this.css.contentNode}).inject(this.contentContainerNode),this.setTitleNode(),this.listRoom(function(){this.setBodyNode()}.bind(this)),this.resetBodySize(),this.app.addEvent("resize",this.resetBodySize.bind(this))},getWeekBeginDate:function(t){var e=t.clone(),i=(7+t.getDay()-parseInt(this.weekBegin))%7;return e.decrement("day",i)},resetBodySize:function(){var t=this.container.getSize(),e=this.titleNode.getSize(),i=t.y-e.y;this.scrollNode.setStyle("height",i+"px"),this.contentWarpNode&&this.contentWarpNode.setStyles({width:t.x-40+"px"})},setTitleNode:function(){this.prevWeekNode=new Element("div",{styles:this.css.calendarPrevWeekNode}).inject(this.titleNode);var t=this.baseDate.format(this.app.lp.dateFormatMonth),e=this.view.getWeekNumber(this.baseDate),i=this.app.lp.weeklyViewTitle.replace("{month}",t).replace("{week}",e);this.titleTextNode=new Element("div",{styles:this.css.calendarTitleTextNode,text:i}).inject(this.titleNode),this.nextWeekNode=new Element("div",{styles:this.css.calendarNextWeekNode}).inject(this.titleNode),this.prevWeekNode.addEvents({mouseover:function(){this.prevWeekNode.setStyles(this.css.calendarPrevWeekNode_over)}.bind(this),mouseout:function(){this.prevWeekNode.setStyles(this.css.calendarPrevWeekNode)}.bind(this),mousedown:function(){this.prevWeekNode.setStyles(this.css.calendarPrevWeekNode_down)}.bind(this),mouseup:function(){this.prevWeekNode.setStyles(this.css.calendarPrevWeekNode_over)}.bind(this),click:function(){this.changeWeekPrev()}.bind(this)}),this.nextWeekNode.addEvents({mouseover:function(){this.nextWeekNode.setStyles(this.css.calendarNextWeekNode_over)}.bind(this),mouseout:function(){this.nextWeekNode.setStyles(this.css.calendarNextWeekNode)}.bind(this),mousedown:function(){this.nextWeekNode.setStyles(this.css.calendarNextWeekNode_down)}.bind(this),mouseup:function(){this.nextWeekNode.setStyles(this.css.calendarNextWeekNode_over)}.bind(this),click:function(){this.changeWeekNext()}.bind(this)}),this.titleTextNode.addEvents({mouseover:function(){this.titleTextNode.setStyles(this.css.calendarTitleTextNode_over)}.bind(this),mouseout:function(){this.titleTextNode.setStyles(this.css.calendarTitleTextNode)}.bind(this),mousedown:function(){this.titleTextNode.setStyles(this.css.calendarTitleTextNode_down)}.bind(this),mouseup:function(){this.titleTextNode.setStyles(this.css.calendarTitleTextNode_over)}.bind(this)}),this.createWeekSelector()},changeWeekPrev:function(){this.date.decrement("week",1),this.baseDate=this.date;var t=this.baseDate.format(this.app.lp.dateFormatMonth),e=this.view.getWeekNumber(this.baseDate),i=this.app.lp.weeklyViewTitle.replace("{month}",t).replace("{week}",e);this.titleTextNode.set("text",i),this.reLoadCalendar()},changeWeekNext:function(){this.date.increment("week",1),this.baseDate=this.date;var t=this.baseDate.format(this.app.lp.dateFormatMonth),e=this.view.getWeekNumber(this.baseDate),i=this.app.lp.weeklyViewTitle.replace("{month}",t).replace("{week}",e);this.titleTextNode.set("text",i),this.reLoadCalendar()},changeWeekSelect:function(){this.monthSelector||this.createWeekSelector()},createWeekSelector:function(){this.weekCalendar=new MWF.xApplication.Meeting.WeekView.WeekCalendar(this.titleTextNode,{style:"meeting_blue",weekBegin:this.weekBegin,target:this.node,baseDate:this.baseDate,onInit:function(){this.options.dayPath=this.options.path+this.options.style+"/day_week.html"},onQueryComplate:function(t,e,i){var s=new Date.parse(e);this.changeWeekTo(s)}.bind(this)})},changeWeekTo:function(t){this.baseDate=t,this.date=this.getWeekBeginDate(t);var e=this.baseDate.format(this.app.lp.dateFormatMonth),i=this.view.getWeekNumber(this.baseDate),s=this.app.lp.weeklyViewTitle.replace("{month}",e).replace("{week}",i);this.titleTextNode.set("text",s),this.reLoadCalendar()},listRoom:function(t){this.app.actions.listBuilding(function(e){this.bulidingData=e.data,t&&t()}.bind(this))},setBodyNode:function(){this.roomTooltips=[],this.roomTrMap={},this.calendarTable=new Element("table",{styles:this.css.calendarTable,height:"100%",border:"0",cellPadding:"0",cellSpacing:"0"}).inject(this.bodyNode),this.loadTableHead(),this.bulidingData.each(function(t){t.roomList.each(function(e){var i=new Element("tr").inject(this.calendarTable),s=new Element("td",{tdType:"room"}).inject(i),n=new Element("div",{styles:this.css.calendarTableCell_room}).inject(s);s.store("room",e);for(var o=0;o<7;o++)new Element("td",{tdType:"meeting",room:e.id,index:o+1}).inject(i);this.roomTrMap[e.id]=i,this.rooms=this.rooms||{},this.rooms[e.id]=new MWF.xApplication.Meeting.WeekView.Room(this,n,e,t.name),this.roomTooltips.push(new MWF.xApplication.Meeting.RoomTooltip(this.app.content,n,this.app,e,{axis:"x",hiddenDelay:300,displayDelay:300}))}.bind(this))}.bind(this)),this.loadCalendar()},loadTableHead:function(){var t=this.date.clone(),e=new Date;if(this.tableHead)this.tableHead.getElements("th").each(function(i,s){if(0!=s){i.setStyles(t<e?this.css.calendarTableTh_pre:this.css.calendarTableTh);var n=(s-1+parseInt(this.weekBegin))%7;i.set("text",this.app.lp.weeks.arr[n]+"("+t.format("%m.%d")+")"),t.increment("day",1)}}.bind(this));else{var i=this.tableHead=new Element("tr",{styles:this.css.calendarTableTitleTr}).inject(this.calendarTable);new Element("th",{styles:this.css.calendarTableTh,text:this.app.lp.room}).inject(i);for(var s=0;s<7;s++){var n=(s+parseInt(this.weekBegin))%7;new Element("th",{styles:t<e?this.css.calendarTableTh_pre:this.css.calendarTableTh,text:this.app.lp.weeks.arr[n]+"("+t.format("%m.%d")+")"}).inject(i);t.increment("day",1)}}},reLoadCalendar:function(){for(var t in this.days)this.days[t].destroy(),delete this.days[t];this.calendarTable.getElements("td[tdType='meeting']").each(function(t){t.empty()}.bind(this)),this.loadTableHead(),this.loadCalendar()},loadCalendar:function(){for(var t=this.date.clone(),e=1;e<8;e++)this.loadDay(e,t),t.increment()},loadDay:function(t,e){var i="thisWeek",s=e.get("month"),n=e.get("year"),o=e.get("date"),a=(this.date.get("month"),this.date.get("year"),this.today.get("month")),h=this.today.get("year"),d=this.today.get("date");i=s==a&&n==h&&o==d?"today":"thisWeek";var l=e.format("%Y%m%d");this.days[l]=new MWF.xApplication.Meeting.WeekView.Calendar.Day(t,e,this,i)},reload:function(){this.view.reload()},destroy:function(){for(var t in this.days)this.days[t].destroy(),delete this.days[t];for(var t in this.rooms)this.rooms[t].destroy();this.roomTooltips.each(function(t){t.destroy()}.bind(this)),this.calendarTable.getElements("td[tdType='meeting']").each(function(t){t.empty()}.bind(this)),this.container.empty()}}),MWF.xApplication.Meeting.WeekView.Room=new Class({Implements:[Events],initialize:function(t,e,i,s){this.data=i,this.view=t,this.css=this.view.css,this.container=e,this.app=this.view.app,this.meetings=[],this.buildingName=s,this.enable=this.data.available,this.load()},load:function(){this.node=new Element("div.roomItemNode",{styles:this.css.roomItemNode}).inject(this.container),this.node.setStyle("min-height",this.view.roomNodeHeight+"px"),this.node.addEvents({mouseover:function(){this.node.setStyles(this.css.roomItemNode_over)}.bind(this),mouseout:function(){this.node.setStyles(this.css.roomItemNode)}.bind(this)}),this.titleNode=new Element("div.titleNode",{styles:this.css.roomItemTitleNode}).inject(this.node),this.titleNode.addEvents({click:function(){this.openRoom()}.bind(this)}),this.enable&&this.titleNode.addEvents({mouseenter:function(){this.titleTextNode.setStyles(this.css.roomItemTitleTextNode_over)}.bind(this),mouseleave:function(){this.titleTextNode.setStyles(this.css.roomItemTitleTextNode)}.bind(this)}),this.topNode=new Element("div.topNode",{styles:this.css.roomItemTitleTopNode}).inject(this.titleNode),this.descriptNode=new Element("div.roomItemDescriptNode",{styles:this.css.roomItemDescriptNode}).inject(this.titleNode),this.data.capacity&&(this.titleCountNode=new Element("div.titleCountNode",{styles:this.enable?this.css.roomItemTitleCountNode:this.css.roomItemTitleCountNode_disable,text:this.data.capacity+this.app.lp.person}).inject(this.descriptNode)),this.data.roomNumber&&new Element("div.titleCountNode",{styles:this.enable?this.css.roomItemTitleCountNode:this.css.roomItemTitleCountNode_disable,text:this.data.roomNumber}).inject(this.descriptNode),this.buildingName&&(this.buildingTextNode=new Element("div.buildingTextNode",{styles:this.enable?this.css.roomItemBuildingTextNode:this.css.roomItemBuildingTextNode_disable,text:this.buildingName}).inject(this.titleNode)),this.titleTextNode=new Element("div.roomItemTitleTextNode",{styles:this.enable?this.css.roomItemTitleTextNode:this.css.roomItemTitleTextNode_disable,text:this.data.name}).inject(this.topNode)},loadActions:function(){MWF.AC.isMeetingAdministrator()&&(this.editAction=new Element("div",{styles:this.css.roomAction_edit,events:{mouseover:function(){this.editAction.setStyles(this.css.roomAction_edit_over)}.bind(this),mouseout:function(){this.editAction.setStyles(this.css.roomAction_edit)}.bind(this),click:function(t){this.editRoom(),t.stopPropagation()}.bind(this)}}).inject(this.actionsNode),this.removeAction=new Element("div",{styles:this.css.roomAction_remove,events:{mouseover:function(){this.removeAction.setStyles(this.css.roomAction_remove_over)}.bind(this),mouseout:function(){this.removeAction.setStyles(this.css.roomAction_remove)}.bind(this),click:function(t){this.removeRoom(t),t.stopPropagation()}.bind(this)}}).inject(this.actionsNode)),this.enable&&(this.createMeetingAction=new Element("div",{tltile:this.app.lp.addMeeting,styles:this.css.createMeetingAction,events:{mouseover:function(){this.createMeetingAction.setStyles(this.css.createMeetingAction_over)}.bind(this),mouseout:function(){this.createMeetingAction.setStyles(this.css.createMeetingAction)}.bind(this),click:function(t){this.app.addMeeting(this.view.date,this.view.hours,this.view.minutes,this.data.id),t.stopPropagation()}.bind(this)}}).inject(this.actionsNode))},editRoom:function(){var t=new MWF.xApplication.Meeting.RoomForm(this.app,this.data,{},{app:this.app});t.view=this,t.edit()},openRoom:function(){var t=new MWF.xApplication.Meeting.RoomForm(this.app,this.data,{},{app:this.app});t.view=this,t.open()},reload:function(){this.view.reload(this.view.date,this.view.hours,this.view.minutes)},removeRoom:function(t){var e=this.app.lp.delete_room;e=e.replace(/{name}/g,this.data.name);var i=this;this.app.confirm("warn",t,this.app.lp.delete_building_title,e,300,120,(function(){i.remove(),this.close()}),(function(){this.close()}))},remove:function(){var t=this.view;this.app.actions.deleteRoom(this.data.id,function(){t.reload()}.bind(this))},resetHeight:function(){this.node.setStyle("min-height",this.view.roomNodeHeight+"px"),this.noMeetingNode&&(this.noMeetingNode.setStyle("min-height",this.view.roomNodeHeight-170+"px"),this.noMeetingNode.setStyle("line-height",this.view.roomNodeHeight-170+"px"))},destroy:function(){this.calendar&&this.calendar.container.destroy(),this.tooltip&&this.tooltip.destroy(),this.meetings.each((function(t){t.destroy()})),this.node.destroy(),MWF.release(this)}}),MWF.xApplication.Meeting.WeekView.Calendar.Day=new Class({Implements:[Events],initialize:function(t,e,i,s){this.index=t,this.calendar=i,this.view=this.calendar.view,this.css=this.calendar.css,this.app=this.calendar.app,this.date=e.clone(),this.key=this.date.format(this.app.lp.dateFormat),this.type=s,this.meetings=[],this.load()},load:function(){this.color="#666",this.day=this.date.getDate(),this.month=this.date.getMonth(),this.year=this.date.getYear(),this.loadMeetings(),this.roomMeetingObject={},this.containerObject={},this.calendar.calendarTable.getElements("td[index='"+this.index+"']").each(function(t){this.containerObject[t.get("room")]=t}.bind(this))},loadEmpty:function(){for(var t in this.containerObject){var e=this.containerObject[t];if(!this.roomMeetingObject[t]){var i=new Element("div",{styles:this.css["calendarTableCell_"+this.type]}).inject(e),s=new Element("div",{styles:this.css.dayContentNode}).inject(i);new Element("div",{styles:{"line-height":"60px","font-size":"14px","text-align":"center",color:this.color,padding:"20px 10px"}}).inject(s).set("text",this.app.lp.noMeeting)}}},loadMeetings:function(){this.app.isMeetingViewer(function(t){this._loadMeetings(t)}.bind(this))},_loadMeetings:function(t){var e=this.date.getFullYear(),i=this.date.getMonth()+1,s=this.date.getDate();this.app.actions[t?"listMeetingDayAll":"listMeetingDay"](e,i,s,function(t){t.data.length;t.data.each(function(t,e){this.roomMeetingObject[t.room]||(this.roomMeetingObject[t.room]=[]),this.roomMeetingObject[t.room].push(t)}.bind(this)),this.loadEmpty(),this.loadRoomMeeting()}.bind(this))},loadRoomMeeting:function(){var t=0,e="",i="";for(var s in this.roomMeetingObject){var n=this.containerObject[s],o=new Element("div",{styles:this.css["calendarTableCell_"+this.type]}).inject(n),a=new Element("div",{styles:this.css["dayTitle_"+this.type]}).inject(o);new Element("div",{styles:this.css["dayTitleDay_"+this.type],text:this.day}).inject(a);(new Date).diff(this.date)>=0&&(a.set("title",this.app.lp.titleNode),a.addEvent("click",function(){this.app.addMeeting(this.date)}.bind(this)));var h=new Element("div",{styles:this.css.dayContentNode}).inject(o),d=(t=0,0),l=this.roomMeetingObject[s].length;if(this.roomMeetingObject[s].each(function(s,a){if(s.myReject)d++;else{1==++t&&(e=s.status,s.myWaitAccept&&(e="myWaitAccept")),t+d==l&&(i=s.status,s.myWaitAccept&&(i="myWaitAccept"));var r=new MWF.xApplication.Meeting.WeekView.Calendar.Day.Meeting(this,h,s,t);r.parentNode=o,r.parentTd=n,this.meetings.push(r)}}.bind(this)),0==t);else{var r=new Element("div",{styles:this.css["dayTitleInfor_"+this.type]}).inject(a);if(this.app.isViewAvailable("toDay")?r.addEvent("click",function(t){this.app.toDay(this.date),t.stopPropagation()}.bind(this)):r.setStyle("cursor","default"),r.set("text",""+t+this.app.lp.countMeetings),t>3?o.addEvents({mouseenter:function(){this.obj.expend(this.td,this.node)}.bind({obj:this,td:n,node:o}),mouseleave:function(){this.obj.collapseReady=!0,this.obj.collapse(this.td,this.node)}.bind({obj:this,td:n,node:o})}):r.setStyle("color","otherMonth"==this.type?"#ccc":"#999"),e)switch(e){case"wait":a.setStyles({"border-left":"6px solid #4990E2"});break;case"processing":a.setStyles({"border-left":"6px solid #66CC7F"});break;case"completed":a.setStyles({"border-left":"6px solid #ccc"});break;case"myWaitAccept":a.setStyles({"border-left":"6px solid #F6A623"})}if(i){var c=0;c=t>=3?10:100-30*t;var p=new Element("div",{styles:{height:c+"px"}}).inject(o);switch(i){case"wait":p.setStyles({"border-left":"6px solid #4990E2"});break;case"processing":p.setStyles({"border-left":"6px solid #66CC7F"});break;case"completed":p.setStyles({"border-left":"6px solid #ccc"});break;case"myWaitAccept":p.setStyles({"border-left":"6px solid #F6A623"})}}}}},expend:function(t,e){this.oSize=e.getSize(),t.setStyles({position:"relative"}),this.tempNode=new Element("div",{styles:{width:e.getSize().x+"px",height:"1px",margin:"7px"}}).inject(t),e.setStyles({height:e.getScrollSize().y+"px",width:e.getSize().x+"px",position:"absolute",top:"0px",left:"0px","box-shadow":"0 0 8px 0 rgba(0,0,0,0.25)"});var i=e.getCoordinates(),s=this.calendar.contentWarpNode,n=s.getCoordinates();i.bottom>n.bottom&&(this.contentHeight=n.height,s.setStyle("height",i.bottom-n.top+"px")),this.isCollapse=!1},collapse:function(t,e){if(!this.collapseDisable&&this.collapseReady){if(t.setStyles({position:"static"}),this.tempNode&&this.tempNode.destroy(),e.setStyles({height:"140px",width:"auto",position:"static","box-shadow":"none"}),this.contentHeight)this.calendar.contentWarpNode.setStyle("height",this.contentHeight+"px"),this.contentHeight=null;this.isCollapse=!0}},destroy:function(){this.meetings.each(function(t){t.destroy()}.bind(this)),this.meetings=[],this.titleNode&&(this.titleNode.destroy(),this.titleNode=null),this.titleDayNode=null,this.titleInforNode=null,delete this.calendar.days[this.key],MWF.release(this)},reload:function(){this.view.reload()}}),MWF.xApplication.Meeting.WeekView.Calendar.Day.Meeting=new Class({initialize:function(t,e,i,s){this.day=t,this.css=this.day.css,this.view=this.day.view,this.app=this.day.app,this.container=e,this.data=i,this.index=s,this.load()},load:function(){this.nodeStyles="today"==this.day.type?this.css.meetingNode_today:this.css.meetingNode,this.node=new Element("div",{styles:this.nodeStyles}).inject(this.container),this.iconNode=new Element("div",{styles:this.css.meetingIconNode}).inject(this.node),this.timeNode=new Element("div",{styles:this.css.meetingTimeNode}).inject(this.node),this.textNode=new Element("div",{styles:this.css.meetingTextNode}).inject(this.node);var t=Date.parse(this.data.startTime).format("%H:%M");switch(this.timeNode.set("text",t),this.textNode.set("text",this.data.subject),this.data.status){case"wait":this.node.setStyles({"border-left":"6px solid #4990E2"});break;case"processing":this.node.setStyles({"border-left":"6px solid #66CC7F"});break;case"completed":this.node.setStyles({"border-left":"6px solid #ccc"})}this.data.myWaitAccept&&this.node.setStyles({"border-left":"6px solid #F6A623"}),this.node.addEvents({mouseenter:function(){this.day.collapseReady=!1,this.node.setStyles(this.css.meetingNode_over)}.bind(this),mouseleave:function(){this.node.setStyles(this.nodeStyles)}.bind(this),click:function(){this.openMeeting()}.bind(this)}),this.loadTooltip()},loadTooltip:function(){this.tooltip=new MWF.xApplication.Meeting.MeetingTooltip(this.app.content,this.node,this.app,this.data,{axis:"x",hiddenDelay:300,displayDelay:300,onShow:function(){this.day.collapseDisable=!0}.bind(this),onQueryCreate:function(){this.day.collapseDisable=!0}.bind(this),onHide:function(){this.day.collapseDisable=!1,this.day.collapse(this.parentTd,this.parentNode)}.bind(this)})},showTooltip:function(){this.tooltip||(this.tooltip=new MWF.xApplication.Meeting.MeetingTooltip(this.app.content,this.node,this.app,this.data,{axis:"x",delay:150})),this.tooltip.load()},openMeeting:function(){this.form=new MWF.xApplication.Meeting.MeetingForm(this,this.data,{},{app:this.app}),this.form.view=this,this.form.open()},destroy:function(){this.tooltip&&this.tooltip.destroy(),this.node.destroy(),MWF.release(this)},reload:function(){this.view.reload()}}),MWF.xApplication.Meeting.WeekView.WeekCalendar=new Class({Extends:MWF.widget.Calendar,initialize:function(t,e){this.options.weekBegin="0",Locale.use("zh-CHS"),this.options.defaultTime=this.options.baseDate.getHours()+":"+this.options.baseDate.getMinutes()+":"+this.options.baseDate.getSeconds(),this.setOptions(e),this.path=MWF.defaultPath+"/widget/$Calendar/",this.cssPath=MWF.defaultPath+"/widget/$Calendar/"+this.options.style+"/css.wcss",this._loadCss(),this.options.format||(this.options.isTime?this.options.timeOnly?this.options.format="%H:%M":this.options.format=Locale.get("Date").shortDate+" %H:%M":this.options.format=Locale.get("Date").shortDate),this.options.containerPath=this.options.path+this.options.style+"/container.html",this.options.dayPath=this.options.path+this.options.style+"/day_week.html",this.options.monthPath=this.options.path+this.options.style+"/month.html",this.options.yearPath=this.options.path+this.options.style+"/year.html",this.options.timePath=this.options.path+this.options.style+"/time.html",this.today=new Date,this.currentView=this.options.defaultView,this.node=$(t),this.visible=!1,this.container=this.createContainer(),this.container.inject(this.options.target||$(document.body)),this.contentTable=this.createContentTable(),this.contentTable.inject(this.contentDateNode),this.addEvents(),this.container.set({styles:{display:"none",opacity:1}}),this.fireEvent("init")},showDay:function(t,e){this._setDayTitle(null,t,e),this._setDayWeekTitleTh(),this._setDayDate(null,t,e)},_setDayTitle:function(t,e,i){var s=null!=e?e:this.options.baseDate.getFullYear(),n=null!=i?i:this.options.baseDate.getMonth();n++;var o=s+o2.LP.widget.year+n+o2.LP.widget.month,a=t||this.currentTextNode;a.set("text",o),a.store("year",s),a.store("month",n)},_setDayWeekTitleTh:function(t){var e=(t||this.contentTable).getElement("thead").getElements("th");this.css.calendarDaysContentTh&&e.setStyles(this.css.calendarDaysContentTh);var i=MWF.LP.widget.days_abbr;return e.each(function(t,e){if(0==e)t.set("text",o2.LP.widget.week);else{var s=(e-1+parseInt(this.options.weekBegin))%7;t.set("text",i[s])}}.bind(this)),e},_setDayDate:function(t,e,i){var s=t||this.contentTable,n=this.options.baseDate;null!=e&&null!=i&&((n=new Date).setDate(1),n.setFullYear(e),n.setMonth(i));var o=s.getElement("tbody").getElements("td"),a=n.clone();a.setDate(1);for(var h=(7+a.getDay()-parseInt(this.options.weekBegin))%7+1,d=a.clone(),l=h-1;l>=0;l--){if(l%8==0){var r=this.getWeekNumber(d);if(o[l].set("text",r),o[l].setStyles(this.css.week),o[l].store("weekValue",r.toString()),o[l].store("dateValue",d.toString()),--l<0)break}d.increment("day",-1),o[l].set("text",d.getDate()),o[l].addClass("gray_"+this.options.style),o[l].setStyles(this.css["gray_"+this.options.style]),o[l].store("dateValue",d.toString())}for(l=h;l<o.length;l++){if(l%8==0){r=this.getWeekNumber(a);if(o[l].set("text",r),o[l].setStyles(this.css.week),o[l].store("weekValue",r.toString()),o[l].store("dateValue",a.toString()),++l>=o.length)break}o[l].set("text",a.getDate()),a.toString()==this.options.baseDate.toString()?(o[l].addClass("current_"+this.options.style),o[l].setStyles(this.css["current_"+this.options.style]),o[l].removeClass("gray_"+this.options.style),o[l].setStyle("border","1px solid #FFF")):a.getMonth()!=n.getMonth()?(o[l].addClass("gray_"+this.options.style),o[l].setStyles(this.css["gray_"+this.options.style]),o[l].removeClass("current_"+this.options.style),o[l].setStyle("border","1px solid #FFF")):(o[l].setStyles(this.css["normal_"+this.options.style]),o[l].removeClass("current_"+this.options.style),o[l].removeClass("gray_"+this.options.style),o[l].setStyle("border","1px solid #FFF")),a.clone().clearTime().toString()==this.today.clearTime().toString()&&(o[l].setStyles(this.css["today_"+this.options.style]),o[l].setStyle("border","0px solid #AAA")),o[l].store("dateValue",a.toString()),a.increment("day",1)}},getWeekNumber:function(t){var e=t.clone(),i=(7+t.getDay()-parseInt(this.options.weekBegin))%7;e.setDate(e.getDate()-i+3);var s=e.valueOf();return e.setMonth(0,1),4!=e.getDay()&&e.setMonth(0,1+(4-e.getDay()+7)%7),1+Math.ceil((s-e)/6048e5)}});