MWF.xDesktop.requireApp("Template","MPopupForm",null,!1),MWF.xDesktop.requireApp("Template","MTooltips",null,!1),MWF.require("MWF.widget.O2Identity",null,!1),MWF.xDesktop.requireApp("Selector","package",null,!1),MWF.require("MWF.widget.AttachmentController",null,!1),MWF.xApplication.Meeting=MWF.xApplication.Meeting||{},MWF.xApplication.Meeting.BuildingForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"meeting",width:"800",height:"300",hasTop:!0,hasIcon:!1,hasTopIcon:!1,hasTopContent:!1,hasBottom:!1,draggable:!0,closeAction:!0},_createTableContent:function(){this.formTopTextNode.set("text",this.lp.editBuilding);var t="<table width='100%' bordr='0' cellpadding='7' cellspacing='0' styles='formTable'><tr><td styles='formTableTitle' lable='name'></td>    <td styles='formTableValue' item='name' colspan='3' ></td></tr><tr><td styles='formTableTitle' lable='address'></td>    <td styles='formTableValue' item='address' colspan='3'></td></tr><tr><td styles='formTableTitle'></td>    <td styles='formTableValue' colspan='3' style='padding-top: 30px;'>       <div item='saveAction' style='float:left;display:"+(this.isEdited||this.isNew?"":"none")+";'></div>       <div item='removeAction' style='float:left;display:"+(this.isEdited?"":"none")+";'></div>       <div item='cancelAction' style='"+(this.isEdited||this.isNew?"float:left;":"float:right;margin-right:15px;")+"'></div>   </td></tr></table>";this.formTableArea.set("html",t),MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.formTableArea,this.data,{isEdited:this.isEdited||this.isNew,style:"meeting",itemTemplate:{name:{text:this.lp.name,notEmpty:!0},address:{text:this.lp.address},saveAction:{type:"button",className:"inputOkButton",value:this.lp.save,event:{click:function(){this.save()}.bind(this)}},removeAction:{type:"button",className:"inputCancelButton",value:this.lp.delete,event:{click:function(t,e){this.removeBuilding(e)}.bind(this)}},cancelAction:{type:"button",className:"inputCancelButton",value:this.lp.close,event:{click:function(){this.close()}.bind(this)}}}},this.app),this.form.load()}.bind(this),!0)},save:function(){var t=this.form.getResult(!0,null,!0,!1,!0);this.actions.saveBuilding(t,function(e){this.app.notice(this.lp.save_success,"success");var i=this.view;this.fireEvent("postSave",[t]),this.close(),i&&i.reload()}.bind(this))},removeBuilding:function(t){var e=this.app.lp.delete_building;e=e.replace(/{name}/g,this.data.name);var i=this;this.app.confirm("warn",t,this.app.lp.delete_building_title,e,300,120,(function(){i.remove(),this.close()}),(function(){this.close()}))},remove:function(){var t=this.view;this.app.actions.deleteBuilding(this.data.id,function(){t.reload()}.bind(this))}}),MWF.xApplication.Meeting.BuildingTooltip=new Class({Extends:MTooltips,_loadCustom:function(t){this.loadActionBar(),t&&t()},_getHtml:function(){var t=this.data;return"<div item='containr' style='height:16px;line-height:16px;'><div style='font-size: 14px;color:#666;float:left; '>"+(t.address?t.address:this.lp.noAddress)+"</div></div>"},loadActionBar:function(){if(MWF.AC.isMeetingAdministrator()){var t=this.node.getElement("[item='containr']");this.editAction=new Element("div",{styles:this.css.action_edit,title:this.lp.editAddress,events:{mouseover:function(){this.editAction.setStyles(this.css.action_edit_over)}.bind(this),mouseout:function(){this.editAction.setStyles(this.css.action_edit)}.bind(this),click:function(){this.editBuilding(function(t){this.node.getElement("[item='containr']").getFirst().set("text",t.address?t.address:this.lp.noAddress)}.bind(this))}.bind(this)}}).inject(t),this.removeAction=new Element("div",{styles:this.css.action_remove,title:this.lp.removeBuilding,events:{mouseover:function(){this.removeAction.setStyles(this.css.action_remove_over)}.bind(this),mouseout:function(){this.removeAction.setStyles(this.css.action_remove)}.bind(this),click:function(t){this.removeBuilding(t)}.bind(this)}}).inject(t)}},editBuilding:function(t){var e=t?{onPostSave:t}:{};new MWF.xApplication.Meeting.BuildingForm(this,this.data,e,{app:this.app}).edit()},removeBuilding:function(t){this.app.actions.getBuilding(this.data.id,function(e){if(e.data.roomList&&e.data.roomList.length>0)this.app.notice(this.app.lp.delete_building_hasRoom.replace(/{name}/g,this.data.name),"error",t.target);else{var i=this.app.lp.delete_building;i=i.replace(/{name}/g,this.data.name);var s=this;this.app.confirm("warn",t,this.app.lp.delete_building_title,i,300,120,(function(){s.remove(),this.close()}),(function(){this.close()}))}}.bind(this))},remove:function(){var t=this.view;this.app.actions.deleteBuilding(this.data.id,function(){t.reload()}.bind(this))},reload:function(){this.view.reload()}}),MWF.xApplication.Meeting.RoomForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"meeting",width:"900",height:"500",hasTop:!0,hasIcon:!1,hasTopIcon:!1,hasTopContent:!1,hasBottom:!1,draggable:!0,closeAction:!0},_createTableContent:function(){this.isNew?this.formTopTextNode.set("text",this.lp.addRoom):this.isEdited?this.formTopTextNode.set("text",this.lp.editRoom):this.formTopTextNode.set("text",this.lp.room);var t=this.lp.roomForm,e=!this.isEdited&&!this.isNew&&MWF.AC.isMeetingAdministrator(),i=this.isEdited||this.isNew?"border:1px solid #ccc; border-radius: 4px;overflow: hidden;padding:8px;":"",s="<table width='100%' bordr='0' cellpadding='7' cellspacing='0' styles='formTable'><tr><td styles='formTableTitle'>"+t.name+":</td>    <td styles='formTableValue' item='name' colspan='3' ></td></tr><tr><td styles='formTableTitle'>"+t.building+":</td>    <td styles='formTableValue' item='buildingName' colspan='3'></td></tr><tr><td styles='formTableTitle'>"+t.floor+":</td>    <td styles='formTableValue' item='floor'></td>    <td styles='formTableTitle2'>"+t.capacity+":</td>    <td styles='formTableValue' item='capacity'></td></tr><tr><td styles='formTableTitle'>"+t.roomNumber+":</td>    <td styles='formTableValue' item='roomNumber'></td>    <td styles='formTableTitle2'>"+t.phone+":</td>    <td styles='formTableValue' item='phoneNumber'></td></tr><tr><td styles='formTableTitle'>"+t.device+":</td>    <td styles='formTableValue' colspan='3'>       <div item='deviceList' style='"+i+"'></div></td></tr><tr><td styles='formTableTitle'>"+t.available+":</td>    <td styles='formTableValue' colspan='3'>       <div item='available' style='"+i+"'></div></td></tr><tr><td styles='formTableTitle'></td>    <td styles='formTableValue' colspan='3' style='padding-top: 30px;'>       <div item='saveAction' style='float:left;display:"+(this.isEdited||this.isNew?"":"none")+";'></div>       <div item='editAction' style='float:left;display:"+(e?"":"none")+";'></div>       <div item='removeAction' style='float:left;display:"+(this.isEdited?"":"none")+";'></div>       <div item='cancelAction' style='"+(this.isEdited||this.isNew||e?"float:left;":"float:right;margin-right:15px;")+"'></div>   </td></tr></table>";this.formTableArea.set("html",s);var n=this.data||{};this.buildingId=n.building,this.buildingId&&this.getBuliding(),MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.formTableArea,n,{isEdited:this.isEdited||this.isNew,style:"meeting",itemTemplate:{name:{text:t.name,notEmpty:!0},buildingName:{text:t.building,notEmpty:!0,value:this.buildingName||"",event:{click:function(){this.listBuilding()}.bind(this),change:function(){this.buildingId=null}.bind(this),focus:function(){this.listBuildingHide(),this.listBuilding()}.bind(this),keydown:function(t){switch(t.code){case 13:this.listBuildingHide(),this.listBuilding();break;case 40:this.selectBuildingNext();break;case 38:this.selectBuildingPrev();break;case 38:this.selectBuildingConfirm()}}.bind(this)}},floor:{type:"select",defaultValue:"1",notEmpty:!0,text:t.floor,selectText:function(){for(var t=[],e=-2;e<=50;e++)0!=e&&t.push(e);return t}.bind(this),selectValue:function(){for(var t=[],e=-2;e<=50;e++)0!=e&&t.push(e);return t}.bind(this)},capacity:{notEmpty:!0,tType:"number",text:t.capacity},roomNumber:{},phoneNumber:{},deviceList:{type:"checkbox",value:this.data.device?this.data.device.split("#"):"",selectValue:function(){return Object.keys(this.lp.device)}.bind(this),selectText:function(){return Object.values(this.lp.device)}.bind(this)},available:{type:"radio",defaultValue:"true",selectValue:["true","false"],selectText:[this.lp.enable,this.lp.disable]},saveAction:{type:"button",className:"inputOkButton",value:this.lp.save,event:{click:function(){this.save()}.bind(this)}},removeAction:{type:"button",className:"inputCancelButton",value:this.lp.delete,event:{click:function(t,e){this.removeRoom(e)}.bind(this)}},editAction:{type:"button",className:"inputOkButton",value:this.lp.editRoom,event:{click:function(){this.editRoom()}.bind(this)}},cancelAction:{type:"button",className:"inputCancelButton",value:this.lp.close,event:{click:function(){this.close()}.bind(this)}}}},this.app),this.form.load()}.bind(this),!0)},editRoom:function(){this.formTopNode=null,this.setFormNodeSizeFun&&this.app&&this.app.removeEvent("resize",this.setFormNodeSizeFun),this.formMaskNode&&this.formMaskNode.destroy(),this.formAreaNode.destroy(),this.edit()},getBuliding:function(){this.actions.getBuilding(this.buildingId,function(t){this.buildingName=t.data.name}.bind(this),null,!1)},reset:function(){this.formTableArea.empty(),this._createTableContent()},removeRoom:function(t){var e=this.app.lp.delete_room;e=e.replace(/{name}/g,this.data.name);var i=this;this.app.confirm("warn",t,this.app.lp.delete_building_title,e,300,120,(function(){i.remove(),this.close()}),(function(){this.close()}))},remove:function(){var t=this.view;this.app.actions.deleteRoom(this.data.id,function(){this.close(),t.reload()}.bind(this))},selectBuildingNext:function(){if(this.selectBuildingNode){var t=null;if(this.selectBuildingNode.selectedNode?((t=this.selectBuildingNode.selectedNode.getNext())||(t=this.selectBuildingNode.getFirst()),this.selectBuildingNode.selectedNode.setStyle("background-color",this.selectBuildingNode.selectedNode.retrieve("bg"))):t=this.selectBuildingNode.getFirst(),t){var e=t.getStyle("background-color");t.store("bg",e),t.setStyles(this.css.createRoomBuildingSelectItem_over),this.selectBuildingNode.selectedNode=t}}},selectBuildingPrev:function(){if(this.selectBuildingNode){var t=null;if(this.selectBuildingNode.selectedNode)(t=this.selectBuildingNode.selectedNode.getPrevious())||(t=this.selectBuildingNode.getLast()),this.selectBuildingNode.selectedNode.setStyle("background-color",this.selectBuildingNode.selectedNode.retrieve("bg"));else t=this.selectBuildingNode.getLast();if(t){var e=t.getStyle("background-color");t.store("bg",e),t.setStyles(this.css.createRoomBuildingSelectItem_over),this.selectBuildingNode.selectedNode=t}}},selectBuildingConfirm:function(t){this.selectBuildingNode.selectedNode&&(this.selectBuilding(this.selectBuildingNode.selectedNode),t.preventDefault())},listBuildingData:function(t,e){t?this.actions.listBuildingByKey(t,(function(t){e&&e(t)})):this.actions.listBuilding((function(t){e&&e(t)}))},listBuilding:function(){if(!this.selectBuildingNode&&!this.listing){this.listing=!0;var t=this.form.getItem("buildingName"),e=t.getValue();this.listBuildingData(e,function(e){if(e.data&&e.data.length){this.selectBuildingNode=new Element("div",{styles:this.css.createRoomSelectBuildingNode}).inject(t.container),this.setSelectBuildingNodeSize(),this.listBuildingHideFun=this.listBuildingHide.bind(this),this.formMaskNode.addEvent("mousedown",this.listBuildingHideFun),this.formNode.addEvent("mousedown",this.listBuildingHideFun);var i=this;e.data.each(function(t,e){var s=new Element("div",{styles:this.css.createRoomBuildingSelectItem}).inject(this.selectBuildingNode);new Element("div",{styles:this.css.createRoomBuildingSelectItemName,text:t.name}).inject(s),new Element("div",{styles:this.css.createRoomBuildingSelectItemAddr,text:t.address}).inject(s);e%2==1&&s.setStyle("background-color","#f1f6ff"),s.store("building",t.id),s.addEvents({mouseover:function(t){var e=this.getStyle("background-color");this.store("bg",e),this.setStyles(i.css.createRoomBuildingSelectItem_over)},mouseout:function(t){this.setStyle("background-color",this.retrieve("bg"))},mousedown:function(t){t.stopPropagation()},click:function(t){i.selectBuilding(this)}})}.bind(this))}this.listing=!1}.bind(this))}},selectBuilding:function(t){var e=t.retrieve("building"),i=t.getFirst().get("text");this.form.getItem("buildingName").setValue(i),this.buildingId=e,this.listBuildingHide()},setSelectBuildingNodeSize:function(){var t=this.form.getItem("buildingName").getElements()[0];this.selectBuildingNode.position({relativeTo:t,position:"bottomLeft",edge:"upperCenter",offset:{x:4,y:0}});var e=t.getSize().x-8;this.selectBuildingNode.setStyle("width",e+"px")},listBuildingHide:function(){this.selectBuildingNode&&(this.selectBuildingNode.destroy(),this.selectBuildingNode=null,this.formMaskNode.removeEvent("mousedown",this.listBuildingHideFun),this.formNode.removeEvent("mousedown",this.listBuildingHideFun))},save:function(){this.getData(function(t){this.actions.saveRoom(t,function(t){this.app.notice(this.lp.roomForm.save_success,"success");var e=this.view;this.close(),e.reload()}.bind(this))}.bind(this))},getData:function(t){var e=this.form.getResult(!0,null,!0,!1,!0);e&&(e.device=e.deviceList.join("#"),e.available="true"==e.available,this.buildingId?(e.building=this.buildingId,t&&t(e)):this.actions.saveBuilding({name:e.buildingName,address:""},function(i){e.building=i.data.id,t&&t(e)}.bind(this)))}}),MWF.xApplication.Meeting.RoomTooltip=new Class({Extends:MTooltips,_loadCustom:function(t){this.loadBuilding(function(){t&&t()}.bind(this))},_getHtml:function(){var t=this.data,e=this.lp.device,i="font-size:14px;color:#333",s="font-size:14px;color:#666;padding-right:20px",n=[];return(t.device||"").split("#").each(function(t){n.push(e[t])}.bind(this)),e=this.lp.roomForm,"<div style='overflow: hidden;padding:15px 20px 20px 10px;height:16px;line-height:16px;'>   <div style='font-size: 16px;color:#333;float: left'>"+this.lp.room+"</div></div><div style='font-size: 18px;color:#333;padding:0px 10px 15px 20px;'>"+t.name+"</div><div style='height:1px;margin:0px 20px;border-bottom:1px solid #ccc;'></div><table width='100%' bordr='0' cellpadding='7' cellspacing='0' style='margin:13px 13px 13px 13px;'><tr><td style='"+i+"' width='100'>"+e.building+":</td>    <td style='"+s+"' item='building'></td></tr><tr><td style='"+i+"'>"+e.floor+":</td>    <td style='"+s+"'>"+t.floor+"</td></tr><tr><td style='"+i+"'>"+e.capacity+":</td>    <td style='"+s+"'>"+t.capacity+"</td></tr><tr><td style='"+i+"'>"+e.roomNumber+":</td>    <td style='"+s+"'>"+t.roomNumber+"</td></tr><tr><td style='"+i+"'>"+e.phone+":</td>    <td style='"+s+"'>"+t.phoneNumber+"</td></tr><tr><td style='"+i+"'>"+e.device+":</td>    <td style='"+s+"'>"+n.join(",")+"</td></tr><tr><td style='"+i+"'>"+e.available+":</td>    <td style='"+s+"'>"+(t.available?this.lp.enable:this.lp.disable)+"</td></tr></table>"},loadBuilding:function(t){var e=this.node.getElement("[item='building']");this.data.building&&this.app.actions.getBuilding(this.data.building,function(i){e.set("text",i.data.name),t&&t()}.bind(this))}}),MWF.xApplication.Meeting.MeetingForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"meeting",width:"900",height:"640",hasTop:!0,hasIcon:!1,hasTopIcon:!1,hasTopContent:!1,hasBottom:!1,draggable:!0,closeAction:!0,maxAction:!0},open:function(t){this.fireEvent("queryOpen"),this.isNew=!1,this.isEdited=!1,this.getMeetingData(function(){this._open()}.bind(this)),this.fireEvent("postOpen")},create:function(){this.fireEvent("queryCreate"),this.isNew=!0,this._open(),this.fireEvent("postCreate")},edit:function(){this.fireEvent("queryEdit"),this.isEdited=!0,this.getMeetingData(function(){this._open()}.bind(this)),this.fireEvent("postEdit")},_createTableContent:function(){var t,e,i,s;if(this.userName=layout.desktop.session.user.distinguishedName,this.userId=layout.desktop.session.user.id,this.isNew?this.formTopTextNode.set("text",this.lp.addMeeting):this.isEdited?(this.formTopTextNode.set("text",this.lp.editMeeting),this.options.height="630"):(this.formTopTextNode.set("text",this.lp.metting),this.options.height="540"),this.options.date||this.options.minute)if(this.date="string"==typeOf(this.options.date)?Date.parse(this.options.date):this.options.date,t=this.date.clone().format("%Y-%m-%d"),this.date.getHours())e=this.getString(this.date.getHours())+":"+this.getString(this.date.getMinutes()),i=this.date.clone().increment("hour",this.options.hour?parseInt(this.options.hour):1),this.options.minute&&(i=i.increment("minute",parseInt(this.options.minute))),s=this.getString(i.getHours())+":"+this.getString(i.getMinutes());else{var n=new Date;e=n.getHours()+1+":00",i=n.clone().increment("hour",this.options.hour?parseInt(this.options.hour):1),this.options.minute&&(i=i.increment("minute",parseInt(this.options.minute))),s=i.getHours()+1+":00"}else this.date=new Date,t=this.date.clone().format("%Y-%m-%d"),e=this.date.getHours()+1+":00",i=this.date.clone().increment("hour",this.options.hour?parseInt(this.options.hour):1),this.options.minute&&(i=i.increment("minute",parseInt(this.options.minute))),s=i.getHours()+1+":00";this.formTableArea.setStyle("position","relative");var o=this.data,a=this.userName==this.data.applicant||this.userId==this.data.applicant||MWF.AC.isMeetingAdministrator(),d=!this.isEdited&&!this.isNew&&"wait"==this.data.status&&a,l=this.isNew||this.isEdited&&"wait"==this.data.status&&a,c=!1;d&&(MWF.AC.isMeetingAdministrator()?c=!0:this.userName!=this.data.applicant&&this.userId!=this.data.applicant||this.app.meetingConfig.process||(c=!0));var h=!1;!a||this.isEdited||this.isNew||"processing"!=this.data.status||(h=!0);var r="<div item='qrCode' style='position: absolute;right:0px;top:-20px;width:150px;height:180px;'></div><table width='100%' bordr='0' cellpadding='7' cellspacing='0' styles='formTable'><tr>   <td styles='formTableTitle' width='70'>"+this.lp.applyPerson+":</td>    <td styles='formTableValue' item='applicant'></td></tr><tr><td styles='formTableTitle' width='100'>"+this.lp.beginDate+":</td>    <td styles='formTableValue' item='dateInput'></td></tr><tr><td styles='formTableTitle'>"+this.lp.time+":</td>    <td styles='formTableValue'>       <div item='beginTimeInput' style='float:left'></div>       <div style='float:left; "+(l?"margin:5px;":"margin:0px 5px;")+"'>"+this.lp.to+"</div>       <div item='endTimeInput' style='float:left'></div>   </td></tr><tr><td styles='formTableTitle'>"+this.lp.selectRoom+":</td>    <td styles='formTableValue' item='meetingRoom'></td></tr><tr><td styles='formTableTitle'>"+this.lp.invitePerson2+":</td>    <td styles='formTableValue'>       <div item='invitePersonList'></div>       <div style='display:"+(this.isEdited?"":"none")+";' item='selectinvitePerson'></div>"+(!this.isNew&&this.data.myWaitAccept?"       <tr><td></td><td styles='formTableValue'><div item='acceptAction'></div><div item='rejectAction'></div></td></tr>":"")+"   </td></tr><tr style='display:"+(this.isNew?"none":"")+" ;' item='checkPersonTr'><td styles='formTableTitle'>"+this.lp.needSignInPerson+":</td>    <td styles='formTableValue' item='checkinPersonList'></td></tr><tr><td styles='formTableTitle'>"+this.lp.meetingSubject+":</td>    <td styles='formTableValue' item='subject'></td></tr><tr><td styles='formTableTitle'>"+this.lp.meetingDescription+":</td>    <td styles='formTableValue' item='summary'></td></tr><tr style='display:none ;' item='attachmentTr'><td styles='formTableTitle'>"+this.lp.meetingAttachment+":</td>    <td styles='formTableValue' item='attachment'></td></tr><tr><td styles='formTableTitle'></td>    <td styles='formTableValue' style='padding-top: 10px;'>       <div item='saveAction' style='float:left;display:"+(this.isEdited||this.isNew?"":"none")+";'></div>       <div item='editAction' style='float:left;display:"+(d?"":"none")+";'></div>       <div item='startImmediatelyAction' style='float:left;display:"+(c?"":"none")+";'></div>       <div item='finishImmediatelyAction' style='float:left;display:"+(h?"":"none")+";'></div>       <div item='removeAction' style='float:left;display:"+(this.isEdited?"":"none")+";'></div>       <div item='cancelAction' style='"+(this.isEdited||this.isNew||d||c||h?"float:left;":"float:right;margin-right:15px;")+"'></div>   </td></tr></table>";if(this.formTableArea.set("html",r),o.startTime){var p=Date.parse(o.startTime);o.dateInput=p.format("%Y-%m-%d"),o.beginTimeInput=this.getString(p.getHours())+":"+this.getString(p.getMinutes())}if(o.completedTime){var m=Date.parse(o.completedTime);o.endTimeInput=this.getString(m.getHours())+":"+this.getString(m.getMinutes())}this.meetingRoomArea=this.formTableArea.getElement("[item='meetingRoom']"),this.attachmentTr=this.formTableArea.getElement("[item='attachmentTr']"),this.attachmentArea=this.formTableArea.getElement("[item='attachment']"),this.qrCodeArea=this.formTableArea.getElement("[item='qrCode']"),MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.formTableArea,o,{isEdited:this.isEdited||this.isNew,style:"meeting",itemTemplate:{applicant:{type:"org",orgType:"person",isEdited:!1,defaultValue:this.userName},dateInput:{tType:"date",isEdited:l,defaultValue:t,event:{change:function(t,e){this.clearRoom()}.bind(this)}},beginTimeInput:{tType:"time",isEdited:l,defaultValue:e,className:l?"inputTimeUnformatWidth":"",event:{change:function(t,e){this.clearRoom()}.bind(this)}},endTimeInput:{tType:"time",isEdited:l,defaultValue:s,className:l?"inputTimeUnformatWidth":"",event:{change:function(t,e){this.clearRoom()}.bind(this)}},invitePersonList:{type:"org",isEdited:this.isNew,orgType:["identity","person"],count:0,orgWidgetOptions:{onLoadedInfor:function(t){this.loadAcceptAndReject(t)}.bind(this)}},checkinPersonList:{type:"org",isEdited:!1,orgType:["identity","person"],count:0},selectinvitePerson:{type:"button",value:this.lp.addInvitePerson1,style:{"margin-left":"20px"},event:{click:function(t){var e={type:"",types:["identity","person"],exclude:this.getInvitePersonExclude(),values:[],count:0,onComplete:function(e){MWF.require("MWF.widget.O2Identity",function(){var i=[];e.each(function(e){if("i"==e.data.distinguishedName.split("@").getLast().toLowerCase()){new MWF.widget.O2Identity(e.data,t.form.getItem("invitePersonList").container,{style:"room"});i.push(e.data.distinguishedName)}else{new MWF.widget.O2Person(e.data,t.form.getItem("invitePersonList").container,{style:"room"});i.push(e.data.distinguishedName)}}.bind(this)),this.app.actions.addMeetingInvite(this.data.id,{invitePersonList:i,id:this.data.id},function(t){this.app.actions.getMeeting(t.data.id,function(t){this.invitePersonList=t.data.invitePersonList,this.app.notice(this.app.lp.addedInvitePerson1,"success",this.node)}.bind(this))}.bind(this))}.bind(this))}.bind(this)};new MWF.O2Selector(this.app.content,e)}.bind(this)}},subject:{},summary:{type:"textarea"},acceptAction:{type:"button",value:this.lp.accept,className:"inputAcceptButton",event:{click:function(t,e){this.accept(e)}.bind(this)}},rejectAction:{type:"button",value:this.lp.reject,style:{"margin-left":"20px"},className:"inputDenyButton",event:{click:function(t,e){this.reject(e)}.bind(this)}},saveAction:{type:"button",className:"inputOkButton",value:this.lp.save,event:{click:function(){this.save()}.bind(this)}},removeAction:{type:"button",className:"inputCancelButton",value:this.lp.cancelMeeting,event:{click:function(t,e){this.cancelMeeting(e)}.bind(this)}},editAction:{type:"button",className:"inputOkButton",value:this.lp.editMeeting,event:{click:function(){this.editMeeting()}.bind(this)}},startImmediatelyAction:{type:"button",className:"inputCancelButton",value:this.lp.startMeetingImmediately,event:{click:function(){this.startImmediately()}.bind(this)}},finishImmediatelyAction:{type:"button",className:"inputCancelButton",value:this.lp.endMeetingImmediately,event:{click:function(){this.finishImmediately()}.bind(this)}},cancelAction:{type:"button",className:"inputCancelButton",value:this.lp.close,event:{click:function(){this.close()}.bind(this)}}}},this.app),this.form.load(),l?this.loadSelectRoom():this.loadSelectRoom_read(),this.data.id&&this.loadAttachment(),!a||this.isNew||this.isEdited?this.qrCodeArea.destroy():this.loadQrCode()}.bind(this),!0)},startImmediately:function(){o2.Actions.load("x_meeting_assemble_control").MeetingAction.editStartTime(this.data.id,{room:this.roomId||this.data.room,startTime:(new Date).format("db")},function(){this.app.notice(this.lp.startMeetingSucccess,"success"),this.waitReload=!0,this.reload()}.bind(this))},finishImmediately:function(){o2.Actions.load("x_meeting_assemble_control").MeetingAction.editCompletedTime(this.data.id,{room:this.roomId||this.data.room,completedTime:(new Date).format("db")},function(){this.app.notice(this.lp.endMeetingSucccess,"success"),this.waitReload=!0,this.reload()}.bind(this))},getInvitePersonExclude:function(){var t=this.invitePersonList||this.data.invitePersonList,e=[];return t.length>0?(o2.Actions.load("x_organization_assemble_express").IdentityAction.listWithPerson({personList:t},(function(t){e=t.data?t.data.identityList:[]}),null,!1),(e||[]).concat(t)):[]},getString:function(t){var e="00"+t;return e.substr(e.length-2,2)},loadQrCode:function(){this.actions.getCheckinQrCode(this.data.id,function(t){new Element("img",{src:"data:image/png;base64,"+t.data.image,styles:{width:"150px",height:"150px"}}).inject(this.qrCodeArea),new Element("div",{text:this.app.lp.printQrcode,styles:{color:"#3c75b7",cursor:"pointer","text-align":"center"},events:{click:function(){window.open(o2.filterUrl("../x_desktop/meetingQrPrint.html?meeting="+this.data.id),"_blank")}.bind(this)}}).inject(this.qrCodeArea)}.bind(this))},loadAcceptAndReject:function(t){var e=t.data.distinguishedName;if(this.data.acceptPersonList&&-1!==this.data.acceptPersonList.indexOf(e)){new Element("div",{styles:this.css.acceptIconNode}).inject(t.node,"top");new Element("div",{styles:this.css.acceptTextNode,text:this.app.lp.accepted}).inject(t.inforNode)}if(this.data.rejectPersonList&&-1!==this.data.rejectPersonList.indexOf(e)){new Element("div",{styles:this.css.rejectIconNode}).inject(t.node,"top");new Element("div",{styles:this.css.rejectTextNode,text:this.app.lp.rejected}).inject(t.inforNode)}},getMeetingData:function(t){this.data&&this.data.id?(this.app.actions||this.actions).getMeeting(this.data.id,function(e){this.data=e.data,t&&t()}.bind(this)):t&&t()},editMeeting:function(){this.formTopNode=null,this.setFormNodeSizeFun&&this.app&&this.app.removeEvent("resize",this.setFormNodeSizeFun),this.formMaskNode&&this.formMaskNode.destroy(),this.formAreaNode.destroy(),this.edit()},cancelMeeting:function(t){var e=this,i=this.app.lp.cancel_confirm.replace(/{name}/g,this.data.subject);this.app.confirm("infor",t,this.app.lp.cancel_confirm_title,i,380,200,(function(){e._cancelMeeting(),this.close(),e.close()}),(function(){this.close()}))},_cancelMeeting:function(){var t=this.view;this.app.actions.deleteMeeting(this.data.id,function(){t.reload()}.bind(this))},reset:function(){this.formTableArea.empty(),this._createTableContent()},clearRoom:function(){this.roomId="",this.roomInput&&this.roomInput.set("text","")},loadSelectRoom_read:function(){var t=this.data.room||this.options.room;t&&(this.app.actions||this.actions).getRoom(t,function(e){(this.app.actions||this.actions).getBuilding(e.data.building,function(i){this.roomId=t,this.meetingRoomArea.set("text",e.data.name+" ("+i.data.name+")")}.bind(this))}.bind(this))},loadSelectRoom:function(){var t=this.app.css,e=new Element("div",{styles:t.createMeetingInfoLineNode}).inject(this.meetingRoomArea),i=new Element("div",{styles:t.createMeetingInfoItemEditNode,html:"<div></div>"}).inject(e);this.roomInput=i.getFirst(),this.roomInput.setStyles(t.createMeetingInfoItemDivNode),this.roomInput.addEvents({click:function(t){this.selectRooms()}.bind(this)});var s=this.data.room||this.options.room;s&&(this.app.actions||this.actions).getRoom(s,function(t){(this.app.actions||this.actions).getBuilding(t.data.building,function(e){this.roomId=s,this.roomInput.set("text",t.data.name+" ("+e.data.name+")")}.bind(this))}.bind(this))},selectRooms:function(){this.createRoomNode(function(){this.loadSelectRooms(),this.selectRoomNode.setStyle("display","block"),this.hideRoomNodeFun=this.hideRoomNode.bind(this),document.body.addEvent("mousedown",this.hideRoomNodeFun),this.selectRoomNode.position({relativeTo:this.roomInput,position:"bottomLeft",edge:"upperLeft",offset:{x:0,y:0}});var t=this.roomInput.getSize().x-2;this.selectRoomNode.setStyle("width",t+"px")}.bind(this))},createRoomNode:function(t){var e=this.app.css;this.selectRoomNode||(this.selectRoomNode=new Element("div",{styles:e.createMeetingInfoSelectRoomNode}).inject(this.formNode),this.selectRoomNode.addEvent("mousedown",(function(t){t.stopPropagation()}))),t&&t()},loadSelectRooms:function(){var t=this.app.css,e=this.form.getResult(!1,null,!1,!1,!0),i=e.dateInput,s=i+" "+e.beginTimeInput,n=i+" "+e.endTimeInput,o=function(e){e.data.each(function(e){var i=new Element("div",{styles:t.createMeetingInfoSelectRoomItem1Node}).inject(this.selectRoomNode);new Element("div",{styles:t.createMeetingInfoSelectRoomItem1NameNode,text:e.name}).inject(i),new Element("div",{styles:t.createMeetingInfoSelectRoomItem1AddrNode,text:e.address}).inject(i);e.roomList.each(function(t,i){t.available&&t.idle&&this.createRoomSelectNode(t,i,e)}.bind(this))}.bind(this))}.bind(this);this.isEdited&&this.data.room?o2.Actions.load("x_meeting_assemble_control").BuildingAction.listWithStartCompletedRoom(s,n,this.data.room,this.data.id,(function(t){o(t)})):this.app.actions.listBuildingByRange(s,n,function(t){o(t)}.bind(this))},createRoomSelectNode:function(t,e,i){var s=this.app.css,n=new Element("div",{styles:s.roomTitleNode}).inject(this.selectRoomNode),o=(new Element("div",{styles:s.roomTitleCapacityNode,text:t.capacity+this.lp.person}).inject(n),new Element("div",{styles:s.roomTitleInforNode}).inject(n)),a=new Element("div",{styles:{height:"20px"}}).inject(o),d=(new Element("div",{styles:s.roomTitleNumberNode,text:t.roomNumber?"#"+t.roomNumber:""}).inject(a),new Element("div",{styles:s.roomTitleNameNode,text:t.name}).inject(a),new Element("div",{styles:s.roomTitleIconsNode}).inject(o));(t.device||"").split("#").each(function(t){t&&new Element("div",{styles:s.roomTitleIconNode,title:this.lp.device[t]}).inject(d).setStyle("background-image","url(../x_component_Meeting/$RoomView/default/icon/device/"+t+"_disable.png)")}.bind(this)),e%2!=0&&n.setStyle("background-color","#f4f8ff"),n.store("room",t);var l=this;if(t.idle)n.addEvents({mouseover:function(t){var e=n.getStyle("background-color");this.store("bgcolor",e),this.setStyle("background-color","#e4edfc")},mouseout:function(){var t=this.retrieve("bgcolor","#FFF");this.setStyle("background-color",t)},click:function(){var t=this.retrieve("room");l.roomId=t.id,l.roomInput.set("text",t.name+" ("+i.name+")"),l.hideRoomNode()}});else{n.setStyle("background-color","#fff6f6");new Element("div",{styles:s.roomTitleDisabledIconNode}).inject(n)}},hideRoomNode:function(){this.selectRoomNode.empty(),this.selectRoomNode.setStyle("display","none"),document.body.removeEvent("mousedown",this.hideRoomNodeFun)},setCreateRoomSelectBuildingNodeSize:function(){var t=this.createRoomBuildingInput.getPosition(this.createRoomBuildingInput.getOffsetParent());this.createRoomSelectBuildingNode.position({relativeTo:this.createRoomBuildingInput,position:"bottomCenter",edge:"upperCenter",offset:{x:0,y:0}}),this.createRoomSelectBuildingNode.setStyle("left",t.x);var e=this.createRoomBuildingInput.getSize().x-2;this.createRoomSelectBuildingNode.setStyle("width",e+"px")},loadAttachment:function(){this.attachmentTr.setStyle("display",""),this.attachmentNode=new Element("div",{styles:this.css.createMeetingAttachmentNode}).inject(this.attachmentArea);var t=new Element("div",{styles:this.css.createMeetingAttachmentContentNode}).inject(this.attachmentNode);MWF.require("MWF.widget.AttachmentController",function(){this.attachmentController=new MWF.widget.AttachmentController(t,this,{size:"min",isSizeChange:!1,isReplace:!1,isUpload:this.isNew||this.isEdited,isDelete:this.isNew||this.isEdited,isDownload:!0,readonly:!this.isNew&&!this.isEdited}),this.attachmentController.load(),this.data.attachmentList&&this.data.attachmentList.each(function(t){t.person=t.lastUpdatePerson.split("@")[0];this.attachmentController.addAttachment(t)}.bind(this))}.bind(this))},uploadAttachment:function(t,e){this.uploadFileAreaNode||this.createUploadFileNode(),this.fileUploadNode.click()},createUploadFileNode:function(){this.uploadFileAreaNode=new Element("div");this.uploadFileAreaNode.set("html",'<input name="file" type="file" multiple/>'),this.fileUploadNode=this.uploadFileAreaNode.getFirst(),this.fileUploadNode.addEvent("change",function(){var t=this.fileUploadNode.files;if(t.length)for(var e=0;e<t.length;e++){var i=t.item(e),s=new FormData;s.append("file",i),this.app.actions.addAttachment(this.data.id,s,i,function(t,e){t.id&&this.app.actions.getAttachment(t.id,function(t){t.data&&this.attachmentController.addAttachment(t.data),this.attachmentController.checkActions()}.bind(this)),this.attachmentController.checkActions()}.bind(this))}}.bind(this))},deleteAttachments:function(t,e,i){var s=[];i.each(function(t){s.push(t.data.name)}.bind(this));var n=this;this.app.confirm("warn",t,this.lp.deleteAttachmentTitle,this.lp.deleteAttachment+"( "+s.join(", ")+" )",300,120,(function(){for(;i.length;)attachment=i.shift(),n.deleteAttachment(attachment);this.close()}),(function(){this.close()}),null)},deleteAttachment:function(t){this.app.actions.deleteFile(t.data.id,function(e){this.attachmentController.removeAttachment(t),this.attachmentController.checkActions()}.bind(this))},downloadAttachment:function(t,e,i){i.each(function(t){this.app.actions.getFileDownload(t.data.id)}.bind(this))},openAttachment:function(t,e,i){i.each(function(t){this.app.actions.getFile(t.data.id)}.bind(this))},getAttachmentUrl:function(t,e){this.app.actions.getFileUrl(t.data.id,e)},save:function(){this._save(function(){this.app.notice(this.lp.meeting_saveSuccess,"success"),this.attachmentNode||this.loadAttachment()}.bind(this))},_save:function(t){this.getSaveData();var e=new Date,i="";if(this.data.subject||(i+=this.lp.meeting_input_subject_error),this.data.room||(i+=this.lp.meeting_input_room_error),this.data.invitePersonList.length||(i+=this.lp.meeting_input_person_error),this.data.startTimeDate&&(this.data.startTimeDate.diff(this.data.completedTimeDate,"minute")<1&&(i+=this.lp.meeting_input_time_error),e.diff(this.data.startTimeDate,"minute")<0&&(i+=this.lp.meeting_input_date_error),delete this.data.startTimeDate,delete this.data.completedTimeDate),i)return this.app.notice(this.lp.meeting_input_error+i,"error"),!1;this.app.actions.saveMeeting(this.data,function(e){this.data.id=e.data.id,this.waitReload=!0,t&&t()}.bind(this))},getSaveData:function(){this.data=this.form.getResult(!1,null,!1,!1,!0),this.data.room=this.roomId,this.invitePersonList&&(this.data.invitePersonList=this.invitePersonList);var t=this.data.dateInput,e=t+" "+this.data.beginTimeInput+":0",i=t+" "+this.data.endTimeInput+":0",s=Date.parse(e),n=Date.parse(i);this.data.startTime=e,this.data.completedTime=i,this.data.startTimeDate=s,this.data.completedTimeDate=n,this.isNew?delete this.data.applicant:this.data.applicant=this.data.applicant.join(",")},getPersonByIdentity:function(t){},getPerson:function(t){"array"!=typeOf(t)&&(t=[t]);var e=[];return t.each(function(t){"i"==t.split("@").getLast().toLowerCase()?e.push(this.getPersonByIdentity(t)):e.push(t)}.bind(this)),e},reject:function(t){var e=this,i=this.app.lp.reject_confirm.replace(/{name}/g,this.data.subject);this.app.confirm("infor",t,this.app.lp.reject_confirm_title,i,300,120,(function(){e.rejectMeeting(),this.close(),e.close()}),(function(){this.close()}))},rejectMeeting:function(){var t=this.view;this.app.actions.rejectMeeting(this.data.id,function(){t.reload()}.bind(this))},accept:function(t){var e=this,i=this.app.lp.accept_confirm.replace(/{name}/g,this.data.subject);this.app.confirm("infor",t,this.app.lp.accept_confirm_title,i,300,120,(function(){e.acceptMeeting(),this.close(),e.close()}),(function(){this.close()}))},acceptMeeting:function(){var t=this.view;this.app.actions.acceptMeeting(this.data.id,function(){t.reload()}.bind(this))},close:function(t){this.fireEvent("queryClose"),this._close(),this.setFormNodeSizeFun&&this.app&&this.app.removeEvent("resize",this.setFormNodeSizeFun),this.formMaskNode&&this.formMaskNode.destroy(),this.formAreaNode.destroy(),this.fireEvent("postClose"),this.waitReload&&this.view.reload()}}),MWF.xApplication.Meeting.MeetingTooltip=new Class({Extends:MTooltips,_loadCustom:function(t){var e=function(){this.loadRoom(function(){this.loadInvite(),this.loadAttachment(),t&&t()}.bind(this))}.bind(this);this.options.isResetData&&this.data&&this.data.id?(this.app.actions||this.actions).getMeeting(this.data.id,function(t){this.data=t.data,e()}.bind(this)):e()},_getHtml:function(){var t=this.data,e="font-size:14px;color:#333",i="font-size:14px;color:#666;padding-right:20px",s=[];t.invitePersonList.each(function(t){s.push(t.split("@")[0])}.bind(this));var n="#ccc";switch(t.status){case"wait":n="#4990E2";break;case"processing":n="#66CC7F";break;case"completed":n="#666"}t.myWaitAccept&&(n="#F6A623"),t.confilct&&(n="#FF7F7F");var o=Date.parse(t.startTime),a=Date.parse(t.completedTime),d=o.format(this.app.lp.dateFormatDay)+" "+(this.getString(o.getHours())+":"+this.getString(o.getMinutes()))+"-"+(this.getString(a.getHours())+":"+this.getString(a.getMinutes())),l=(t.description||"")+(t.summary||"");return"<div style='overflow: hidden;padding:15px 20px 20px 10px;height:16px;line-height:16px;'>   <div style='font-size: 12px;color:#666; float: right'>"+this.lp.applyPerson+":"+t.applicant.split("@")[0]+"</div>   <div style='font-size: 16px;color:#333;float: left'>"+this.lp.meetingDetail+"</div></div><div style='font-size: 18px;color:#333;padding:0px 10px 15px 20px;overflow:hidden;'>"+t.subject+"</div><div style='height:1px;margin:0px 20px;border-bottom:1px solid #ccc;'></div><table width='100%' bordr='0' cellpadding='7' cellspacing='0' style='margin:13px 13px 13px 13px;'><tr><td style='"+e+";' width='70'>"+this.lp.meetingTime+":</td>    <td style='"+i+";color:"+n+"'>"+d+"</td></tr><tr><td style='"+e+"'>"+this.lp.selectRoom+":</td>    <td style='"+i+"' item='meetingRoom'></td></tr><tr><td style='"+e+"'>"+this.lp.invitePerson2+":</td>    <td style='"+i+"' item='invitePerson'>"+s.join(",")+"</td></tr><tr><td style='"+e+"'>"+this.lp.meetingDescription+":</td>    <td style='"+i+"'>"+l+"</td></tr>"+(this.options.isHideAttachment?"":"<tr><td style='"+e+"'>"+this.lp.meetingAttachment+":</td>    <td style='"+i+"' item='attachment'></td></tr>")+"</table>"},getString:function(t){var e="00"+t;return e.substr(e.length-2,2)},loadRoom:function(t){var e=this.node.getElement("[item='meetingRoom']");this.data.room&&this.app.actions.getRoom(this.data.room,function(i){this.app.actions.getBuilding(i.data.building,function(s){e.set("text",i.data.name+" ("+s.data.name+")"),t&&t()}.bind(this))}.bind(this))},loadInvite:function(){this.O2PersonList=[];var t=this.node.getElement("[item='invitePerson']");MWF.require("MWF.widget.O2Identity",function(){t.empty(),this.data.invitePersonList.each(function(e){var i=new MWF.widget.O2Person({name:e},t,{style:"room",onLoadedInfor:function(t){this.loadAcceptAndReject(t)}.bind(this)});this.O2PersonList.push(i)}.bind(this))}.bind(this))},loadAcceptAndReject:function(t){var e=t.data.distinguishedName;if(this.data.acceptPersonList&&-1!==this.data.acceptPersonList.indexOf(e)){new Element("div",{styles:{height:"20px",width:"14px","margin-right":"3px",float:"left",background:"url(../x_component_Template/$MPopupForm/meeting/icon/accept.png) no-repeat center center"}}).inject(t.node,"top");new Element("div",{styles:{color:"#1fbf04",clear:"both","text-align":"center"},text:this.app.lp.accepted}).inject(t.inforNode)}if(this.data.rejectPersonList&&-1!==this.data.rejectPersonList.indexOf(e)){new Element("div",{styles:{height:"20px",width:"14px","margin-right":"3px",float:"left",background:"url(../x_component_Template/$MPopupForm/meeting/icon/reject.png) no-repeat center center"}}).inject(t.node,"top");new Element("div",{styles:{color:"#FF0000",clear:"both","text-align":"center"},text:this.app.lp.rejected}).inject(t.inforNode)}},destroy:function(){this.O2PersonList&&this.O2PersonList.each((function(t){t.destroy()})),this.node&&(this.node.destroy(),this.node=null)},loadAttachment:function(){if(!this.options.isHideAttachment&&"array"==typeOf(this.data.attachmentList)&&this.data.attachmentList[0]){var t=this.node.getElement("[item='attachment']");this.attachmentNode=new Element("div").inject(t);var e=new Element("div",{}).inject(this.attachmentNode);this.attachmentController=new MWF.xApplication.Meeting.MeetingTooltip.AttachmentController(e,this,{size:"min",isSizeChange:!1,isReplace:!1,isUpload:!1,isDelete:!1,isDownload:!0,readonly:!0}),this.attachmentController.load(),this.data.attachmentList.each(function(t){t.person=t.lastUpdatePerson.split("@")[0];this.attachmentController.addAttachment(t)}.bind(this))}},downloadAttachment:function(t,e,i){i.each(function(t){this.app.actions.getFileDownload(t.data.id)}.bind(this))},openAttachment:function(t,e,i){i.each(function(t){this.app.actions.getFile(t.data.id)}.bind(this))},getAttachmentUrl:function(t,e){this.app.actions.getFileUrl(t.data.id,e)}}),MWF.xApplication.Meeting.MeetingTooltip.AttachmentController=new Class({Extends:MWF.widget.AttachmentController,loadMin:function(){this.node||(this.node=new Element("div",{styles:this.css.container_min})),this.minActionAreaNode?(this.minContent.setStyle("display","block"),this.minContent.empty()):(this.minContent=new Element("div",{styles:this.css.minContentNode}).inject(this.node),this.minContent.setStyles({"margin-right":"0px"}),this.node.inject(this.container),this.checkActions(),this.setEvent());for(var t=[];this.attachments.length;){var e=this.attachments.shift();t.push(new MWF.xApplication.Meeting.MeetingTooltip.AttachmentMin(e.data,this))}this.attachments=t},addAttachment:function(t){"min"==this.options.size?this.attachments.push(new MWF.xApplication.Meeting.MeetingTooltip.AttachmentMin(t,this)):this.attachments.push(new MWF.widget.AttachmentController.Attachment(t,this))}}),MWF.xApplication.Meeting.MeetingTooltip.AttachmentMin=new Class({Extends:MWF.widget.AttachmentController.AttachmentMin,setEvent:function(){this.node.addEvents({mouseover:function(){var t="attachmentNode_"+this.controller.options.listStyle+"_over";this.isSelected||this.node.setStyles(this.css[t])}.bind(this),mouseout:function(){var t="attachmentNode_"+this.controller.options.listStyle;this.isSelected||this.node.setStyles(this.css[t])}.bind(this),mousedown:function(t){this.selected(t)}.bind(this),click:function(t){this.downloadAttachment(t)}.bind(this)})},downloadAttachment:function(t){this.controller.module&&this.controller.module.downloadAttachment(t,null,[this])}}),MWF.xApplication.Meeting.MeetingArea=new Class({initialize:function(t,e,i){this.container=t,this.view=e,this.css=this.view.css,this.app=this.view.app,this.data=i,this.beginDate=Date.parse(this.data.startTime),this.endDate=Date.parse(this.data.completedTime),this.userName=layout.desktop.session.user.distinguishedName,this.userId=layout.desktop.session.user.id,this.parseData(),this.path="../x_component_Meeting/$Common/default/meetingarea/",this.cssPath="../x_component_Meeting/$Common/default/meetingarea/css.wcss",this._loadCss(),this.load()},load:function(){this.node=new Element("div",{styles:this.css.meetingNode}).inject(this.container),this.node.addEvents({mouseenter:function(){this.node.setStyles(this.css.meetingNode_over),this.subjectNode.setStyles(this.css.meetingSubjectNode_over)}.bind(this),mouseleave:function(){this.node.setStyles(this.css.meetingNode),this.subjectNode.setStyles(this.css.meetingSubjectNode)}.bind(this),click:function(){this.openMeeting()}.bind(this)}),this.colorNode=new Element("div",{styles:this.css.meetingColorNode}).inject(this.node),this.contentNode=new Element("div",{styles:this.css.meetingContentNode}).inject(this.node);var t=(this.beginDate.getHours()<12?this.app.lp.am:this.app.lp.pm)+" "+this.getString(this.beginDate.getHours())+":"+this.getString(this.beginDate.getMinutes()),e=(this.endDate.getHours()<12?this.app.lp.am:this.app.lp.pm)+" "+this.getString(this.endDate.getHours())+":"+this.getString(this.endDate.getMinutes());this.timeNode=new Element("div",{styles:this.css.meetingTimeNode,text:t+"-"+e}).inject(this.contentNode),this.subjectNode=new Element("div",{styles:this.css.meetingSubjectNode,text:this.data.subject}).inject(this.contentNode);var i=(this.data.description||"")+(this.data.summary||"");switch(this.descriptionNode=new Element("div",{styles:this.css.meetingDescriptionNode,text:i}).inject(this.contentNode),this.loadActionBar(),this.data.status){case"wait":this.colorNode.setStyles({"background-color":"#4990E2"}),this.timeNode.setStyles({color:"#4990E2"});break;case"processing":this.colorNode.setStyles({"background-color":"#66CC7F"}),this.timeNode.setStyles({color:"#66CC7F"});break;case"completed":this.colorNode.setStyles({"background-color":"#ccc"}),this.timeNode.setStyles({color:"#ccc"})}this.data.myWaitAccept&&(this.colorNode.setStyles({"background-color":"#F6A623"}),this.timeNode.setStyles({color:"#F6A623"})),this.resetNodeSize(),this.loadTooltip()},parseData:function(){if(!this.data.status){var t,e=new Date;t=this.beginDate>e?"wait":this.endDate<e?"completed":"processing",this.data.status=t}"boolean"!=typeOf(this.data.myWaitAccept)&&(this.data.invitePersonList.contains(this.userName)||this.data.invitePersonList.contains(this.userId))&&(this.data.myWaitAccept=(!this.data.acceptPersonList.contains(this.userName)||this.data.acceptPersonList.contains(this.userId))&&(!this.data.rejectPersonList.contains(this.userName)||!this.data.rejectPersonList.contains(this.userId)))},loadActionBar:function(){(this.userName==this.data.applicant||this.userId==this.data.applicant||MWF.AC.isMeetingAdministrator()||this.data.myWaitAccept)&&(this.actionBar=new Element("div",{styles:this.css.actionBar}).inject(this.contentNode),(this.userName==this.data.applicant||this.userId==this.data.applicant||MWF.AC.isMeetingAdministrator())&&"wait"==this.data.status&&(this.editAction=new Element("div",{styles:this.css.action_edit,events:{mouseover:function(){this.editAction.setStyles(this.css.action_edit_over)}.bind(this),mouseout:function(){this.editAction.setStyles(this.css.action_edit)}.bind(this),click:function(t){this.editMeeting(),t.stopPropagation()}.bind(this)}}).inject(this.actionBar),this.removeAction=new Element("div",{styles:this.css.action_remove,events:{mouseover:function(){this.removeAction.setStyles(this.css.action_remove_over)}.bind(this),mouseout:function(){this.removeAction.setStyles(this.css.action_remove)}.bind(this),click:function(t){this.cancel(t),t.stopPropagation()}.bind(this)}}).inject(this.actionBar)),this.data.myWaitAccept&&(this.acceptAction=new Element("div",{styles:this.css.action_accept,title:this.app.lp.accept,events:{mouseover:function(){this.acceptAction.setStyles(this.css.action_accept_over)}.bind(this),mouseout:function(){this.acceptAction.setStyles(this.css.action_accept)}.bind(this),click:function(t){this.accept(t),t.stopPropagation()}.bind(this)}}).inject(this.actionBar),this.rejectAction=new Element("div",{styles:this.css.action_reject,title:this.app.lp.reject,events:{mouseover:function(){this.rejectAction.setStyles(this.css.action_reject_over)}.bind(this),mouseout:function(){this.rejectAction.setStyles(this.css.action_reject)}.bind(this),click:function(t){this.reject(t),t.stopPropagation()}.bind(this)}}).inject(this.actionBar)))},getString:function(t){var e="00"+t;return e.substr(e.length-2,2)},_loadCss:function(){var t=encodeURIComponent(this.cssPath);MWF.widget.css[t]?this.css=MWF.widget.css[t]:new Request.JSON({url:this.cssPath,secure:!1,async:!1,method:"get",noCache:!1,onSuccess:function(e,i){this.css=e,MWF.widget.css[t]=e}.bind(this),onError:function(t,e){alert(e+t)}}).send()},loadTooltip:function(t,e){this.tooltip=new MWF.xApplication.Meeting.MeetingTooltip(this.app.content,this.node,this.app,this.data,{axis:"x",hiddenDelay:300,displayDelay:300,isHideAttachment:t,isResetData:e})},showTooltip:function(){this.tooltip||(this.tooltip=new MWF.xApplication.Meeting.MeetingTooltip(this.app.content,this.viewAction,this.app,this.data)),this.tooltip.load()},openMeeting:function(){var t=new MWF.xApplication.Meeting.MeetingForm(this,this.data,{},{app:this.app});t.view=this.view,t.open()},resetNodeSize:function(){var t=this.contentNode.getSize();this.colorNode.setStyle("height",t.y)},destroy:function(){this.tooltip&&this.tooltip.destroy(),this.node.destroy(),MWF.release(this)},editMeeting:function(){var t=new MWF.xApplication.Meeting.MeetingForm(this,this.data,{},{app:this.app});t.view=this.view,t.edit()},cancel:function(t){var e=this,i=this.app.lp.cancel_confirm.replace(/{name}/g,this.data.subject);this.app.confirm("infor",t,this.app.lp.cancel_confirm_title,i,380,150,(function(){e.cancelMeeting(),this.close()}),(function(){this.close()}))},cancelMeeting:function(){var t=this.view;this.app.actions.deleteMeeting(this.data.id,function(){t.reload()}.bind(this))},reject:function(t){var e=this,i=this.app.lp.reject_confirm.replace(/{name}/g,this.data.subject);this.app.confirm("infor",t,this.app.lp.reject_confirm_title,i,300,120,(function(){e.rejectMeeting(),this.close()}),(function(){this.close()}))},rejectMeeting:function(){var t=this.view;this.app.actions.rejectMeeting(this.data.id,function(){t.reload()}.bind(this))},accept:function(t){var e=this,i=this.app.lp.accept_confirm.replace(/{name}/g,this.data.subject);this.app.confirm("infor",t,this.app.lp.accept_confirm_title,i,300,120,(function(){e.acceptMeeting(),this.close()}),(function(){this.close()}))},acceptMeeting:function(){var t=this.view;this.app.actions.acceptMeeting(this.data.id,function(){t.reload()}.bind(this))},disagree:function(t){var e=this,i=this.app.lp.disagree_confirm.replace(/{name}/g,this.data.subject);this.app.confirm("infor",t,this.app.lp.disagree_confirm_title,i,300,120,(function(){e.disagreeMeeting(),this.close()}),(function(){this.close()}))},disagreeMeeting:function(){var t=this.view;this.app.actions.denyMeeting(this.data.id,function(){t.reload()}.bind(this))},agree:function(t){var e=this,i=this.app.lp.agree_confirm.replace(/{name}/g,this.data.subject);this.app.confirm("infor",t,this.app.lp.agree_confirm_title,i,300,120,(function(){e.agreeMeeting(),this.close()}),(function(){this.close()}))},agreeMeeting:function(){var t=this.view;this.app.actions.allowMeeting(this.data.id,function(){t.reload()}.bind(this))}}),MWF.xApplication.Meeting.SideBar=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(t,e,i){this.setOptions(i),this.container=t,this.app=e,this.lp=this.app.lp,this.isHidden=!1,this.cssPath="../x_component_Meeting/$Common/"+this.options.style+"/sidebar/css.wcss",this._loadCss(),this.load()},load:function(){this.node=new Element("div.sideBar",{styles:this.css.node,events:{mousedown:function(t){t.stopPropagation()}}}).inject(this.container),this.contentNode=new Element("div",{styles:this.css.contentNode}).inject(this.node),this.loadStatusArea(),new Element("div.contentLine",{styles:this.css.contentLine}).inject(this.contentNode),this.loadTodayMeetingNode(),this.trapezoid=new Element("div.trapezoid",{styles:this.css.trapezoid_toRight,events:{click:function(){this.trigger()}.bind(this)}}).inject(this.node),this.loadTodayMeeting(function(){var t=this.node.getSize().x-8;this.node.setStyle("right","-"+t+"px"),this.resetNodeSize(),this.resetNodeSizeFun=this.resetNodeSize.bind(this),this.app.addEvent("resize",this.resetNodeSizeFun),this.hideFun=this.hide.bind(this),this.app.node.addEvent("mousedown",this.hideFun)}.bind(this))},loadStatusArea:function(){var t=new Element("div",{styles:this.css.statusArea}).inject(this.contentNode),e="<div class='titleDiv'>"+this.lp.config.meetingStatus+"</div><div class = 'statusStyle'>   <div class='statusIconStyle' style='background-color:#4990E2'></div>   <div class = 'statusTextStyle'>"+this.lp.config.wait+"</div></div></div><div class = 'statusStyle'>   <div class='statusIconStyle' style='background-color:#66CC7F'></div>   <div class = 'statusTextStyle'>"+this.lp.config.progress+"</div></div></div><div class = 'statusStyle'>   <div class='statusIconStyle' style='background-color:#F6A623'></div>   <div class = 'statusTextStyle'>"+this.lp.config.invite+"</div></div></div><div class = 'statusStyle'>   <div  class='statusIconStyle' style='background-color:#ccc'></div>   <div class = 'statusTextStyle'>"+this.lp.config.completed+"</div></div></div><div class = 'statusStyle'>   <div  class='statusIconStyle2' style='border:2px solid #FF7F7F;'></div>   <div class = 'statusTextStyle'>"+this.lp.config.conflict+"</div></div></div>";t.set("html",e),t.getElements("div.titleDiv").setStyles(this.css.titleDiv),t.getElements("div.statusStyle").setStyles(this.css.statusStyle),t.getElements("div.statusIconStyle").setStyles(this.css.statusIconStyle),t.getElements("div.statusIconStyle2").setStyles(this.css.statusIconStyle2),t.getElements("div.statusTextStyle").setStyles(this.css.statusTextStyle)},loadTodayMeetingNode:function(){var t=new Element("div.meetingArea",{styles:this.css.meetingArea}).inject(this.contentNode);new Element("div.titleDiv",{styles:this.css.titleDiv,text:this.lp.meetingNotice}).inject(t),this.meetingNode=Element("div",{styles:this.css.meetingNode}).inject(t)},loadTodayMeeting:function(t){var e=new Date,i=layout.desktop.session.user,s=i.distinguishedName,n=e.getFullYear(),o=e.getMonth()+1,a=e.getDate();this.app.actions.listMeetingDay(n,o,a,function(e){var n=[];if(e.data.each(function(t){(t.invitePersonList.contains(s)||t.applicant==s)&&(t.rejectPersonList.contains(s)||n.push(t))}.bind(this)),i.distinguishedName)var o=i.distinguishedName.split("@")[0];else o=i.name;var a=n.length?this.lp.meetingTopInfor:this.lp.noMeetingTopInfor;this.meetingTopNode=new Element("div",{styles:this.css.meetingTopNode,html:a.replace("{userName}",o).replace("{count}",n.length)}).inject(this.meetingNode),this.scrollNode=new Element("div.scrollNode",{styles:this.css.scrollNode}).inject(this.meetingNode),this.meetingItemContainer=new Element("div.meetingItemContainer",{styles:this.css.meetingItemContainer}).inject(this.scrollNode),n.each(function(t,e){var i=new Element("div.meetingItemNode",{styles:this.css.meetingItemNode,events:{click:function(){this.obj.openMeeting(this.data)}.bind({obj:this,data:t})}}).inject(this.meetingItemContainer);this.tooltipList=this.tooltipList||[],this.tooltipList.push(new MWF.xApplication.Meeting.MeetingTooltip(this.app.content,i,this.app,t,{axis:"x",hiddenDelay:300,displayDelay:300}));var s=new Element("div.meetingItemColorNode",{styles:this.css.meetingItemColorNode,text:e+1}).inject(i);new Element("div.meetingItemTextNode",{styles:this.css.meetingItemTextNode,text:t.subject}).inject(i);switch(t.status){case"wait":s.setStyles({"background-color":"#4990E2"});break;case"processing":s.setStyles({"background-color":"#66CC7F"});break;case"completed":s.setStyles({"background-color":"#ccc"})}t.myWaitAccept&&s.setStyles({"background-color":"#F6A623"});var n=i.getSize().y;s.setStyle("margin-top",(n-20)/2)}.bind(this)),this.setScrollBar(this.scrollNode),t&&t()}.bind(this))},trigger:function(){this.isHidden?this.show(!0):this.hide(!0)},hide:function(t){var e=this.node.getSize().x-9;new Fx.Morph(this.node,{duration:"300",transition:Fx.Transitions.Expo.easeOut}).start({}).chain(function(){this.isHidden=!0,this.node.setStyles({right:"-"+e+"px"}),this.trapezoid.setStyles(this.css.trapezoid_toLeft)}.bind(this))},show:function(t){this.node.setStyles(this.css.node),this.trapezoid.setStyles(this.css.trapezoid_toRight);var e=new Fx.Morph(this.node,{duration:"500",transition:Fx.Transitions.Expo.easeOut});this.app.fireAppEvent("resize"),e.start({opacity:1}).chain(function(){this.node.setStyles({right:"0px"}),this.isHidden=!1}.bind(this))},resetNodeSize:function(){var t=this.container.getSize();this.node.setStyle("height",t.y-50),this.trapezoid.setStyle("top",(t.y-50)/2-this.trapezoid.getSize().y/2);var e=t.y-395,i=this.meetingItemContainer.getSize().y+12;this.scrollNode.setStyle("height",Math.min(e,i))},getSize:function(){return{x:9,y:0}},showByType:function(t){},reload:function(){this.destory(),this.app.reload()},openMeeting:function(t){var e=new MWF.xApplication.Meeting.MeetingForm(this,t,{},{app:this.app});e.view=this.app,e.open()},destory:function(){this.tooltipList.each((function(t){t.destory()})),this.app.removeEvent("resize",this.resetNodeSizeFun),this.app.node.removeEvent("mousedown",this.hideFun),this.node.destory()}});