MWF.xApplication.Selector=MWF.xApplication.Selector||{},MWF.xDesktop.requireApp("Selector","Identity",null,!1),MWF.xApplication.Selector.CMSFormField=new Class({Extends:MWF.xApplication.Selector.Identity,options:{style:"default",count:0,title:"",fieldType:"",values:[],names:[],application:"",form:"",expand:!1,forceSearchInItem:!0},setInitTitle:function(){this.options.title||this.setOptions({title:MWF.xApplication.Selector.LP.selectField})},_init:function(){this.selectType="formfield",this.className="CMSFormField"},getFields:function(){var t={string:["htmledit","radio","select","textarea","textfield"],person:["personfield","org","orgfield"],date:["calender"],number:["number"],array:["checkbox"]};return fieldList=[],Object.each(this.relativeFormData.json.moduleList,function(e){var i="";for(k in t)if(-1!==t[k].indexOf((e.moduleName||e.type).toLowerCase())){i=k;break}i&&fieldList.push({name:e.id,dataType:i})}.bind(this)),fieldList},loadSelectItems:function(t){this.options.form?this.cmsAction.getCMSForm(this.options.form,function(t){this.relativeFormData=t.data.data?JSON.decode(MWF.decodeJsonString(t.data.data)):null,this.getFields().each(function(t){if(!this.options.fieldType||this.options.fieldType===t.dataType){t.id=t.name;var e=this._newItem(t,this,this.itemAreaNode);this.items.push(e)}}.bind(this))}.bind(this)):this.options.application&&this.cmsAction.listCMSFormField(this.options.application,function(t){this.fieldData=t.data,this.options.fieldType?t.data[this.options.fieldType].each(function(t){t.id=t.name;var e=this._newItem(t,this,this.itemAreaNode);this.items.push(e)}.bind(this)):Object.each(t.data,function(t,e){this._newItemCategory({name:e,data:t},this,this.itemAreaNode)}.bind(this))}.bind(this))},_scrollEvent:function(t){return!0},_getChildrenItemIds:function(){return null},_newItemCategory:function(t,e,i,n){return new MWF.xApplication.Selector.CMSFormField.ItemCategory(t,e,i,n)},_listItemByKey:function(t,e,i){var n=[];this.options.fieldType?n=this.fieldData[this.options.fieldType]:Object.each(this.fieldData,function(t,e){n=n.length?n.concat(t):t}.bind(this));var o=[];n.each(function(t){-1!==t.name.toLowerCase().indexOf(i.toLowerCase())&&o.push(t)}.bind(this)),t&&t.apply(this,[{data:o}])},_getItem:function(t,e,i,n){t&&t({data:{name:i,id:i}})},_newItemSelected:function(t,e,i){return new MWF.xApplication.Selector.CMSFormField.ItemSelected(t,e,i)},_listItemByPinyin:function(t,e,i){this._listItemByKey(t,e,i)},_newItem:function(t,e,i,n){return new MWF.xApplication.Selector.CMSFormField.Item(t,e,i,n)}}),MWF.xApplication.Selector.CMSFormField.Item=new Class({Extends:MWF.xApplication.Selector.Identity.Item,_getShowName:function(){return this.data.name},_setIcon:function(){this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/default/icon/processicon.png)")},loadSubItem:function(){return!1},getData:function(t){t&&t()},checkSelectedSingle:function(){this.selector.options.values.filter(function(t,e){return"object"===typeOf(t)?this.data.name===t.name:"string"===typeOf(t)&&this.data.name===t}.bind(this)).length&&this.selectedSingle()},checkSelected:function(){var t=this.selector.selectedItems.filter(function(t,e){return t.data.name===this.data.name}.bind(this));t.length&&(t[0].addItem(this),this.selectedItem=t[0],this.setSelected())}}),MWF.xApplication.Selector.CMSFormField.ItemSelected=new Class({Extends:MWF.xApplication.Selector.Person.ItemSelected,_getShowName:function(){return this.data.name},_setIcon:function(){this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/default/icon/processicon.png)")}}),MWF.xApplication.Selector.CMSFormField.ItemCategory=new Class({Extends:MWF.xApplication.Selector.Identity.ItemCategory,_setIcon:function(){this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/default/icon/applicationicon.png)")},loadSub:function(t){this.loaded?t&&t():(this.selector.fieldData[this.data.name].each(function(t){this.selector._newItem(t,this.selector,this.children,this.level+1);this.selector.items.push(item)}.bind(this)),this.loaded=!0,t&&t())},_hasChild:function(){var t=this.selector.fieldData[this.data.name];return t&&t.length}});