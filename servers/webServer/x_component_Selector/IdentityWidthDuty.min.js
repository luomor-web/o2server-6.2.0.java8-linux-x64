MWF.xApplication.Selector=MWF.xApplication.Selector||{},MWF.xDesktop.requireApp("Selector","Identity",null,!1),MWF.xApplication.Selector.IdentityWidthDuty=new Class({Extends:MWF.xApplication.Selector.Identity,options:{style:"default",count:0,title:"",dutys:[],units:[],values:[],zIndex:1e3,expand:!1,noUnit:!1,include:[],resultType:"",expandSubEnable:!0,selectAllEnable:!0,exclude:[],selectType:"identity"},setInitTitle:function(){this.setOptions({title:MWF.xApplication.Selector.LP.selectIdentity})},_init:function(){this.selectType="identity",this.className="IdentityWidthDuty"},loadSelectItems:function(t){var e=this.afterLoadSelectItem.bind(this);if(this.options.disabled)this.afterLoadSelectItem();else if("person"===this.options.resultType&&(this.titleTextNode?this.titleTextNode.set("text",MWF.xApplication.Selector.LP.selectPerson):this.options.title=MWF.xApplication.Selector.LP.selectPerson),this.options.dutys.length){var i=0,n=function(){++i===this.options.dutys.length&&(this.dutyLoaded=!0,this.includeLoaded&&e())}.bind(this);this.loadInclude(function(){this.includeLoaded=!0,this.dutyLoaded&&e()}.bind(this));var s=function(){this.options.dutys.each(function(t){var e={name:t,id:t},i=this._newItemCategory("ItemCategory",e,this,this.itemAreaNode);this.subCategorys.push(i),n()}.bind(this))}.bind(this);if(0===this.options.units.length)s();else{var o=[];if(this.options.units.each((function(t){var e="string"===typeOf(t)?t:t.distinguishedName||t.unique||t.id||t.levelName;e&&o.push(e)})),this.options.expandSubEnable){var a=[],h=function(){MWF.Actions.get("x_organization_assemble_express").listUnitSubNested({unitList:o},function(t){var e=[];if(1===this.options.units.length){e=Array.clone(o);for(var i=0;i<t.data.length;i++)e.contains(t.data[i].distinguishedName)||e.push(t.data[i].distinguishedName)}else a.each((function(i){e.push(i.distinguishedName||i.unique||i.id||i.levelName);for(var n=0;n<t.data.length;n++)t.data[n].levelName.indexOf(i.levelName)>-1&&e.push(t.data[n].distinguishedName)}));this.allUnitNames=e,s()}.bind(this),null)}.bind(this),l=!1;1===this.options.units.length?h():(this.options.units.each((function(t){"string"===typeOf(t)?-1===t.indexOf("/")?l=!0:a.push({levelName:t}):t.levelName?a.push(t):l=!0})),l?o2.Actions.load("x_organization_assemble_express").UnitActions.listObject(function(t){a=t.data||[],h()}.bind(this)):h())}else this.allUnitNames=o,s()}}},search:function(){var t=this.searchInput.get("value");if(t){this.initSearchArea(!0);var e=this.searchInItems(t)||[];this.options.include&&this.options.include.length&&this.includeObject.listByFilter("key",t,function(t){t.each(function(t){e.contains(t.distinguishedName)||this.isExcluded(t)||this._newItem(t,this,this.itemSearchAreaNode)}.bind(this))}.bind(this))}else this.initSearchArea(!1)},listPersonByPinyin:function(t){this.searchInput.focus();var e=this.searchInput.get("value");e+=t.get("text"),this.searchInput.set("value",e),this.search()},checkLoadSelectItems:function(){this.options.units.length,this.loadSelectItems()},_scrollEvent:function(t){return!0},_getChildrenItemIds:function(){return null},_newItemCategory:function(t,e,i,n,s,o,a){return new MWF.xApplication.Selector.IdentityWidthDuty[t](e,i,n,s,o,a)},_listItemByKey:function(t,e,i){this.options.units.length&&(i={key:i,unitList:this.options.units}),this.orgAction.listIdentityByKey(function(e){t&&t.apply(this,[e])}.bind(this),e,i)},_getItem:function(t,e,i,n){this.orgAction.getIdentity(function(e){t&&t.apply(this,[e])}.bind(this),e,"string"===typeOf(i)?i:i.distinguishedName,n)},_newItemSelected:function(t,e,i,n){return new MWF.xApplication.Selector.IdentityWidthDuty.ItemSelected(t,e,i,n)},_listItemByPinyin:function(t,e,i){this.options.units.length&&(i={key:i,unitList:this.options.units}),this.orgAction.listIdentityByPinyin(function(e){t&&t.apply(this,[e])}.bind(this),e,i)},_newItem:function(t,e,i,n,s,o){return new MWF.xApplication.Selector.IdentityWidthDuty.Item(t,e,i,n,s,o)},_newItemSearch:function(t,e,i,n){return new MWF.xApplication.Selector.IdentityWidthDuty.SearchItem(t,e,i,n)}}),MWF.xApplication.Selector.IdentityWidthDuty.Item=new Class({Extends:MWF.xApplication.Selector.Identity.Item,_getShowName:function(){return this.data.name},_getTtiteText:function(){return this.data.name+(this.data.unitLevelName?"("+this.data.unitLevelName+")":"")},_setIcon:function(){var t=this.selector.options.style;this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/"+t+"/icon/personicon.png)")}}),MWF.xApplication.Selector.IdentityWidthDuty.SearchItem=new Class({Extends:MWF.xApplication.Selector.Identity.Item,_getShowName:function(){return this.data.name+(this.data.unitLevelName?"("+this.data.unitLevelName+")":"")}}),MWF.xApplication.Selector.IdentityWidthDuty.ItemSelected=new Class({Extends:MWF.xApplication.Selector.Identity.ItemSelected,_getShowName:function(){return this.data.name+(this.data.unitLevelName?"("+this.data.unitLevelName+")":"")},_getTtiteText:function(){return this.data.name+(this.data.unitLevelName?"("+this.data.unitLevelName+")":"")},_setIcon:function(){var t=this.selector.options.style;this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/"+t+"/icon/personicon.png)")}}),MWF.xApplication.Selector.IdentityWidthDuty.ItemCategory=new Class({Extends:MWF.xApplication.Selector.Identity.ItemCategory,createNode:function(){this.node=new Element("div",{styles:this.selector.css.selectorItemCategory_department,title:this._getTtiteText()}).inject(this.container)},_getShowName:function(){return this.data.name},_setIcon:function(){var t=this.selector.options.style;this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/"+t+"/icon/companyicon.png)")},_addSelectedCount:function(){var t=this._getSelectedCount();this.checkCountAndStatus(t)},_getTotalCount:function(){return this.subItems.length},_getSelectedCount:function(){return this.subItems.filter((function(t){return t.isSelected})).length},loadSub:function(t){this._loadSub(function(e){if(e&&(this.selector.options.showSelectedCount||this.selector.options.isCheckStatus)){var i=this._getSelectedCount();this.checkCountAndStatus(i)}t&&t()}.bind(this))},_loadSub:function(t){if(this.loaded||this.loadingsub)t&&t();else if(this.loadingsub=!0,this.selector.options.units.length){var e={name:this.data.name,unit:"",unitList:this.selector.allUnitNames};MWF.Actions.get("x_organization_assemble_express").getDuty(e,function(e){e.data.each(function(t){if(!this.selector.isExcluded(t)){var e=this.selector._newItem(t,this.selector,this.children,this.level+1,this);this.selector.items.push(e),this.subItems&&this.subItems.push(e)}}.bind(this)),this.loaded||(this.loaded=!0,this.loadingsub=!1,this.itemLoaded=!0,t&&t(!0))}.bind(this),null,!1)}else this.selector.orgAction.listIdentityWithDuty(function(e){e.data.each(function(t){if(!this.selector.isExcluded(t)){var e=this.selector._newItem(t,this.selector,this.children,this.level+1,this);this.selector.items.push(e),this.subItems&&this.subItems.push(e)}}.bind(this)),this.loaded=!0,this.loadingsub=!1,t&&t(!0)}.bind(this),null,this.data.name)},loadCategoryChildren:function(t){this.loadSub(t),this.categoryLoaded=!0},loadItemChildren:function(t){this.loadSub(t)},_hasChild:function(){return!0},_hasChildCategory:function(){return!0},_hasChildItem:function(){return!0}}),MWF.xApplication.Selector.IdentityWidthDuty.ItemUnitCategory=new Class({Extends:MWF.xApplication.Selector.Identity.ItemUnitCategory,loadSub:function(t){this.loaded?t&&t():this.selector.orgAction.listIdentityWithUnit(function(e){this.itemLoaded||(e.data.each(function(t){if(!this.selector.isExcluded(t)){var e=this.selector._newItem(t,this.selector,this.children,this.level+1,this);this.selector.items.push(e),this.subItems&&this.subItems.push(e)}}.bind(this)),this.itemLoaded=!0),this.selector.options.expandSubEnable||(this.loaded=!0,t&&t()),this.selector.options.expandSubEnable&&this.selector.orgAction.listSubUnitDirect(function(e){e.data.each(function(t){if(!this.selector.isExcluded(t)){var e=this.selector._newItemCategory("ItemUnitCategory",t,this.selector,this.children,this.level+1,this);this.subCategorys.push(e)}}.bind(this)),this.loaded=!0,t&&t()}.bind(this),null,this.data.distinguishedName)}.bind(this),null,this.data.distinguishedName)},loadCategoryChildren:function(t){this.categoryLoaded?t&&t():(this.loadSub(t),this.categoryLoaded=!0,this.itemLoaded=!0)},loadItemChildren:function(t){this.itemLoaded?t&&t():(this.selector.orgAction.listIdentityWithUnit(function(e){e.data.each(function(t){if(!this.selector.isExcluded(t)){var e=this.selector._newItem(t,this.selector,this.children,this.level+1,this);this.selector.items.push(e),this.subItems&&this.subItems.push(e)}}.bind(this)),t&&t()}.bind(this),null,this.data.distinguishedName),this.itemLoaded=!0)}}),MWF.xApplication.Selector.IdentityWidthDuty.ItemGroupCategory=new Class({Extends:MWF.xApplication.Selector.Identity.ItemGroupCategory}),MWF.xApplication.Selector.IdentityWidthDuty.Filter=new Class({Implements:[Options,Events],options:{style:"default",units:[],dutys:[]},initialize:function(t,e){this.setOptions(e),this.value=t,this.orgAction=MWF.Actions.get("x_organization_assemble_control")},getList:function(t){this.list=[],MWF.require("MWF.widget.PinYin",function(){this.options.dutys.each(function(t){if(this.options.units.length){var e=MWF.Actions.get("x_organization_assemble_express"),i={name:t,unit:""};this.options.units.each(function(t){"string"===typeOf(t)?i.unit=t:i.unit=t.distinguishedName||t.unique||t.id||t.levelName,e.getDuty(i,function(t){t.data.each(function(t){t.pinyin=t.name.toPY().toLowerCase(),t.firstPY=t.name.toPYFirst().toLowerCase(),this.list.push(t)}.bind(this))}.bind(this),null,!1)}.bind(this))}else this.orgAction.listIdentityWithDuty(function(t){t.data.each(function(t){t.pinyin=t.name.toPY().toLowerCase(),t.firstPY=t.name.toPYFirst().toLowerCase(),this.list.push(t)}.bind(this))}.bind(this),null,t,!1)}.bind(this)),t&&t()}.bind(this))},filter:function(t,e){this.value=t,this.getList(function(){var t=this.list.filter(function(t){return-1!=(t.name+"#"+t.pinyin+"#"+t.firstPY).indexOf(this.value)}.bind(this));e&&e(t)}.bind(this))}});