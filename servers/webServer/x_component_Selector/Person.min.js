MWF.xApplication.Selector=MWF.xApplication.Selector||{},MWF.xApplication.Selector.Person=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",count:0,title:"",groups:[],roles:[],values:[],exclude:[],exclude:[],zIndex:1e3,expand:!0,embedded:!1,selectAllEnable:!1,selectAllRange:"direct",level1Indent:10,indent:10,hasLetter:!0,hasTop:!1,hasShuttle:!1,searchbarInTopNode:!0,hasSelectedSearchbar:!1,noSelectedContainer:!1,contentUrl:"",injectToBody:!1,selectSingleItem:!1,hiddenEmptyCategory:!1,flatCategory:!1,selectType:"person",isCheckStatus:!1,showSelectedCount:!1,itemHeight:29,identityItemWidth:0,storeRange:"full",showEmptyText:!0},setInitTitle:function(){this.setOptions({title:MWF.xApplication.Selector.LP.selectPerson})},initialize:function(e,t){this.active=!0,this.setOptions(t),this.options.title||this.setInitTitle(),this.path="../x_component_Selector/$Selector/",this.cssPath="../x_component_Selector/$Selector/"+this.options.style+"/css.wcss",this._loadCss(!0),this.container=$(e),Object.defineProperties(this,{orgAction:{get:function(){return o2.Actions.get("x_organization_assemble_control")}},processAction:{get:function(){return o2.Actions.get("x_processplatform_assemble_surface")}},designerAction:{get:function(){return o2.Actions.get("x_processplatform_assemble_designer")}},portalAction:{get:function(){return o2.Actions.get("x_portal_assemble_surface")}},portalDesignerAction:{get:function(){return o2.Actions.get("x_portal_assemble_designer")}},cmsAction:{get:function(){return o2.Actions.get("x_cms_assemble_control")}},queryAction:{get:function(){return o2.Actions.get("x_query_assemble_designer")}}}),this.lastPeople="",this.pageCount="13",this.selectedItems=[],this.items=[],this.subCategorys=[],this.subItems=[],this.options.values||(this.options.values=[]),this._init()},_init:function(){this.selectType="person",this.className="Person"},load:function(){this.fireEvent("queryLoad",[this]),this.options.contentUrl?this.loadWithUrl():(layout.mobile?this.loadMobile():this.loadPc(),this.fireEvent("load"))},loadMobile:function(){this.maskRelativeNode=$(document.body),this.maskRelativeNode.mask({destroyOnHide:!0,style:this.css.maskNode}),this.node=new Element("div",{styles:this.css.containerNodeMobile}),this.node.setStyle("z-index",this.options.zIndex.toInt()+1),this.node.setStyle("height",$(document.body).getSize().y+"px"),this.titleNode=new Element("div",{styles:this.css.titleNodeMobile}).inject(this.node),this.titleCancelActionNode=new Element("div",{styles:this.css.titleCancelActionNodeMobile,text:MWF.SelectorLP.back}).inject(this.titleNode),this.titleOkActionNode=new Element("div",{styles:this.css.titleOkActionNodeMobile,text:MWF.SelectorLP.ok}).inject(this.titleNode),this.titleTextNode=new Element("div",{styles:this.css.titleTextNodeMobile,text:this.options.title}).inject(this.titleNode),this.contentNode=new Element("div",{styles:this.css.contentNode}).inject(this.node);var e=$(document.body).getSize().y-40;this.contentNode.setStyle("height",e+"px"),this.loadContent(),this.node.inject($(document.body)),this.node.setStyles({top:"0px",left:"0px"}),this.setEvent()},setMaskResize:function(){var e=this.container.getSize();this.mask.resize(),this.maskInterval=window.setInterval(function(){var t=this.container.getSize();e.x===t.x&&e.y===t.y||(this.mask.position(),this.mask.resize(),e.x=t.x,e.y=t.y)}.bind(this),66)},loadPc:function(){if(this.options.embedded)this.node=new Element("div",{styles:this.css.containerNode_embedded,events:{click:function(e){e.stopPropagation()},mousedown:function(e){e.stopPropagation()},mouseover:function(e){e.stopPropagation()},mouseout:function(e){e.stopPropagation()},keydown:function(e){e.stopPropagation()}}}),this.contentNode=new Element("div",{styles:this.css.contentNode_embedded?this.css.contentNode_embedded:this.css.contentNode}).inject(this.node),this.loadContent(),(this.options.width||this.options.height)&&this.setSize(),this.node.inject(this.container);else{this.css.maskNode["z-index"]=this.options.zIndex;var e=this.container.getPosition(this.container.getOffsetParent());this.mask=new Mask(this.container,{destroyOnHide:!0,style:this.css.maskNode,useIframeShim:!0,iframeShimOptions:{browsers:!0},onShow:function(){this.shim.shim.setStyles({opacity:0,top:e.y+"px",left:e.x+"px"})}}),this.mask.show(),this.setMaskResize(),this.node=new Element("div",{styles:this.options.noSelectedContainer?this.css.containerNodeSingle:this.css.containerNode,events:{click:function(e){e.stopPropagation()},mousedown:function(e){e.stopPropagation()},mouseover:function(e){e.stopPropagation()},mouseout:function(e){e.stopPropagation()},keydown:function(e){e.stopPropagation()}}}),this.node.setStyle("z-index",this.options.zIndex.toInt()+1),this.titleNode=new Element("div.titleNode",{styles:this.css.titleNode}).inject(this.node),this.titleActionNode=new Element("div",{styles:this.css.titleActionNode}).inject(this.titleNode),this.titleTextNode=new Element("div",{styles:this.css.titleTextNode,text:this.options.title}).inject(this.titleNode),this.contentNode=new Element("div",{styles:this.css.contentNode}).inject(this.node),this.loadContent(),this.actionNode=new Element("div",{styles:this.css.actionNode}).inject(this.node),this.loadAction(),this.node.inject(this.container),this.node.position({relativeTo:this.container,position:"center",edge:"center"});var t=this.container.getSize(),s=this.node.getSize();this.node.makeDraggable({handle:this.titleNode,limit:{x:[0,t.x-s.x],y:[0,t.y-s.y]}}),(this.options.width||this.options.height)&&this.setSize(),this.setEvent()}},loadWithUrl:function(){new Request.HTML({url:this.options.contentUrl,method:"GET",async:!1,onSuccess:function(e,t,s,i){this.node=e[0],this.loadContentWithHTML(),this.fireEvent("load")}.bind(this),onFailure:function(e){alert(e)}}).send()},loadContentWithHTML:function(){var e=this.options.injectToBody?$(document.body):this.container;this.options.embedded||(this.maskRelativeNode=e,this.css.maskNode["z-index"]=this.options.zIndex,this.maskRelativeNode.mask({destroyOnHide:!0,style:this.css.maskNode})),this.options.embedded||(this.node.setStyles(this.css.containerNodeMobile),this.node.setStyle("z-index",this.options.zIndex.toInt()+1)),this.node.setStyle("height",e.getSize().y+"px"),this.titleNode=this.node.getElement(".MWF_selector_titleNode"),this.titleTextNode=this.node.getElement(".MWF_selector_titleTextNode"),this.titleCancelActionNode=this.node.getElement(".MWF_selector_titleCancelActionNode"),this.titleOkActionNode=this.node.getElement(".MWF_selector_titleOkActionNode"),this.contentNode=this.node.getElement(".MWF_selector_contentNode"),this.selectNode=this.node.getElement(".MWF_selector_selectNode"),this.searchInputDiv=this.node.getElement(".MWF_selector_searchInputDiv"),this.searchInput=this.node.getElement(".MWF_selector_searchInput"),this.flatCategoryScrollNode=this.node.getElement(".MWF_selector_flatCategoryScrollNode"),this.flatCategoryNode=this.node.getElement(".MWF_selector_flatCategoryNode"),this.options.flatCategory&&this.flatCategoryScrollNode&&(this.isFlatCategory=!0,this.flatSubCategoryNodeList=[]),this.letterAreaNode=this.node.getElement(".MWF_selector_letterAreaNode"),this.itemAreaScrollNode=this.node.getElement(".MWF_selector_itemAreaScrollNode"),this.itemAreaNode=this.node.getElement(".MWF_selector_itemAreaNode"),this.itemSearchAreaScrollNode=this.node.getElement(".MWF_selector_itemSearchAreaScrollNode"),this.itemSearchAreaNode=this.node.getElement(".MWF_selector_itemSearchAreaNode"),this.selectedScrollNode=this.node.getElement(".MWF_selector_selectedScrollNode"),this.selectedNode=this.node.getElement(".MWF_selector_selectedNode"),this.selectedItemSearchAreaNode=this.node.getElement(".MWF_selector_selectedItemSearchAreaNode"),this.actionNode=this.node.getElement(".MWF_selector_actionNode"),this.okActionNode=this.node.getElement(".MWF_selector_okActionNode"),this.cancelActionNode=this.node.getElement(".MWF_selector_cancelActionNode"),this.titleNode&&this.titleNode.setStyles(this.css.titleNodeMobile),this.titleTextNode&&(this.titleTextNode.setStyles(this.css.titleTextNodeMobile),this.options.title&&this.titleTextNode.set("text",this.options.title)),this.titleCancelActionNode&&this.titleCancelActionNode.setStyles(this.css.titleCancelActionNodeMobile),this.titleOkActionNode&&this.titleOkActionNode.setStyles(this.css.titleOkActionNodeMobile),this.contentNode&&this.contentNode.setStyles(this.css.contentNode),this.selectNode&&this.selectNode.setStyles(this.css.selectNodeMobile),this.searchInputDiv&&this.searchInputDiv.setStyles(this.css.searchInputDiv),this.searchInput&&this.searchInput.setStyles(1===this.options.count.toInt()||this.options.noSelectedContainer?this.css.searchInputSingle:this.css.searchInput),this.letterAreaNode&&this.letterAreaNode.setStyles(this.css.letterAreaNode),this.itemAreaScrollNode&&this.itemAreaScrollNode.setStyles(this.css.itemAreaScrollNode),this.itemAreaNode&&this.itemAreaNode.setStyles(this.css.itemAreaNode),this.itemSearchAreaScrollNode&&this.itemSearchAreaScrollNode.setStyles(this.css.itemSearchAreaScrollNode),this.itemSearchAreaNode&&this.itemSearchAreaNode.setStyles(this.css.itemAreaNode),this.selectedScrollNode&&this.selectedScrollNode.setStyles(this.css.selectedScrollNode),this.selectedNode&&this.selectedNode.setStyles(this.css.selectedNode),this.selectedItemSearchAreaNode&&this.selectedItemSearchAreaNode.setStyles(this.css.itemAreaNode),this.actionNode&&this.actionNode.setStyles(this.css.actionNode),this.okActionNode&&(this.okActionNode.setStyles(this.css.okActionNode),this.okActionNode.set("text",MWF.SelectorLP.ok)),this.cancelActionNode&&(this.cancelActionNode.setStyles(this.css.cancelActionNode),this.cancelActionNode.set("text",MWF.SelectorLP.cancel)),this.loadContent(),this.actionNode&&this.loadAction(),this.node.inject(e),this.options.embedded||this.node.setStyles({top:"0px",left:"0px"}),this.setEvent()},getUnitIdentityCount:function(){},getUnitSelecteIndentityCount:function(e){var t;return this.selectedItems.each(function(s){0===s.data.unitLevelName.indexOf(e)&&t++}.bind(this)),t},getGroupNestCount:function(){},getGroupSelecteIndentityCount:function(e){var t;return this.selectedItems.each(function(e){0===e.data.unitLevelName.indexOf(unitLevelName)&&t++}.bind(this)),t},setEvent:function(){this.titleActionNode&&this.titleActionNode.addEvent("click",function(){this.fireEvent("cancel"),this.close()}.bind(this)),this.titleCancelActionNode&&this.titleCancelActionNode.addEvent("click",function(){this.fireEvent("cancel"),this.close()}.bind(this)),this.titleOkActionNode&&this.titleOkActionNode.addEvent("click",function(){this.fireEvent("complete",[this.selectedItems]),!1!==this.options.closeOnclickOk&&this.close()}.bind(this))},close:function(){this.fireEvent("close"),this.node.destroy(),this.options.embedded||(this.maskRelativeNode||this.container).unmask(),this.maskInterval&&(window.clearInterval(this.maskInterval),this.maskInterval=null),this.active=!1,MWF.release(this)},loadAction:function(){this.okActionNode||(this.okActionNode=new Element("button",{styles:this.css.okActionNode,text:MWF.SelectorLP.ok}).inject(this.actionNode)),this.cancelActionNode||(this.cancelActionNode=new Element("button",{styles:this.css.cancelActionNode,text:MWF.SelectorLP.cancel}).inject(this.actionNode)),this.okActionNode.addEvent("click",function(){this.fireEvent("complete",[this.selectedItems]),!1!==this.options.closeOnclickOk&&this.close()}.bind(this)),this.cancelActionNode.addEvent("click",function(){this.fireEvent("cancel"),this.close()}.bind(this))},loadContent:function(e,t){this.fireEvent("queryLoadContent",[this]),e&&(this.contentNode=e),this.options.contentUrl||t?(this.loadSelectedNodeHTML(),this.loadSelectNodeHTML(e)):layout.mobile?(this.loadSelectedNodeMobile(),this.loadSelectNodeMobile()):(this.loadSelectNode(),this.options.hasShuttle&&this.loadShuttleNode(),this.loadSelectedNode()),this.fireEvent("postLoadContent",[this])},getOffsetX:function(e){return(e.getStyle("margin-left").toInt()||0)+(e.getStyle("margin-right").toInt()||0)+(e.getStyle("padding-left").toInt()||0)+(e.getStyle("padding-right").toInt()||0)+(e.getStyle("border-left-width").toInt()||0)+(e.getStyle("border-right-width").toInt()||0)},getOffsetY:function(e){return(e.getStyle("margin-top").toInt()||0)+(e.getStyle("margin-bottom").toInt()||0)+(e.getStyle("padding-top").toInt()||0)+(e.getStyle("padding-bottom").toInt()||0)+(e.getStyle("border-top-width").toInt()||0)+(e.getStyle("border-bottom-width").toInt()||0)},loadSelectNodeHTML:function(e){var t,s;if(e)0===(s=(t=e.getSize()).y)&&(s=e.getStyle("height").toInt());else{if(0===(t=(this.options.injectToBody?$(document.body):this.container).getSize()).y&&(t.y=$(document.body).getSize().y),this.node){var i=this.node.getStyle("zoom").toInt()||0;i&&(t.x=100*t.x/i,t.y=100*t.y/i),this.node.setStyles({width:t.x+"px",height:t.y+"px"})}s=t.y-this.getOffsetY(this.contentNode),this.titleNode&&(s=s-this.getOffsetY(this.titleNode)-(this.titleNode.getStyle("height").toInt()||0)),this.actionNode&&(s=s-this.getOffsetY(this.actionNode)-(this.actionNode.getStyle("height").toInt()||0)),this.contentNode.setStyle("height",s+"px")}window.location.href.toLowerCase().indexOf("workmobilewithaction.html");this.selectNode.setStyle("height",s+"px"),this.searchInput&&(this.initSearchInput(),s=s-this.getOffsetY(this.searchInputDiv)-(this.searchInputDiv.getStyle("height").toInt()||0)),this.options.hasLetter&&this.letterAreaNode&&(width=t.x-18,this.letterAreaNode.setStyle("width",width+"px"),this.loadLetters(),s=s-this.getOffsetY(this.letterAreaNode)-(this.letterAreaNode.getStyle("height").toInt()||0)),this.itemAreaScrollNode.setStyle("height",s+"px"),this.itemAreaScrollNode.setStyle("overflow","auto"),this.itemSearchAreaScrollNode&&this.itemSearchAreaScrollNode.setStyles({display:"none",height:s+"px",overflow:"hidden"}),this.itemSearchAreaNode.setStyle("display","none"),this.initLoadSelectItems(),this.checkLoadSelectItems()},loadSelectNodeMobile:function(){this.selectNode=new Element("div.selectNode",{styles:this.css.selectNodeMobile}).inject(this.contentNode);var e,t=this.container.getSize(),s=$(document.body).getSize(),i={x:Math.min(t.x,s.x),y:Math.min(t.y,s.y)},o=window.location.href.toLowerCase().indexOf("workmobilewithaction.html")>-1;e=o?i.y-40-20-6-20:i.y,this.selectNode.setStyle("height",e+"px"),this.searchInputDiv=new Element("div.searchInputDiv",{styles:this.css.searchInputDiv}).inject(this.selectNode),this.searchInput=new Element("input.searchInput",{styles:1===this.options.count.toInt()||this.options.noSelectedContainer?this.css.searchInputSingle:this.css.searchInput,type:"text"}).inject(this.searchInputDiv);var l=i.x-20-18;this.searchInput.setStyle("width",l+"px"),this.searchInput.setStyle("height","20px"),this.initSearchInput(),this.options.hasLetter&&(this.letterAreaNode=new Element("div",{styles:this.css.letterAreaMobileNode}).inject(this.selectNode),l=i.x-18,this.letterAreaNode.setStyle("width",l+"px"),this.loadLetters()),this.itemAreaScrollNode=new Element("div.itemAreaScrollNode",{styles:this.css.itemAreaScrollNode}).inject(this.selectNode),e=o?i.y-40-20-78-20:i.y-42-31-40,this.itemAreaScrollNode.setStyle("height",e+"px"),this.itemAreaScrollNode.setStyle("overflow","auto"),this.itemAreaNode=new Element("div.itemAreaNode",{styles:this.css.itemAreaNode}).inject(this.itemAreaScrollNode),this.itemSearchAreaNode=new Element("div.itemSearchAreaNode",{styles:this.css.itemAreaNode}).inject(this.itemAreaScrollNode),this.itemSearchAreaNode.setStyle("display","none"),this.initLoadSelectItems(),this.checkLoadSelectItems()},loadSelectedNodeHTML:function(){this.setSelectedItem(),this.selectedScrollNode&&this.selectedScrollNode.setStyle("display","none")},checkLoadSelectItems:function(){this.options.groups.length||this.options.roles.length?this.loadSelectItemsByCondition():this.loadSelectItems()},loadShuttleNode:function(){this.shuttleNode||(this.shuttleNode=new Element("div.shuttleNode",{styles:this.css.shuttleNode}).inject(this.contentNode),this.shuttleInnerNode=new Element("div.shuttleInnerNode",{styles:this.css.shuttleInnerNode}).inject(this.shuttleNode),this.goRightNode=new Element("div.goRightNode",{styles:this.css.goRightNode}).inject(this.shuttleInnerNode),this.goLeftNode=new Element("div.goLeftNode",{styles:this.css.goLeftNode}).inject(this.shuttleInnerNode))},loadSelectNode:function(){this.selectNode=new Element("div.selectNode",{styles:this.css.selectNode}).inject(this.contentNode),this.options.hasTop&&(this.selectTopNode=new Element("div.selectTopNode",{styles:this.css.selectTopNode}).inject(this.selectNode),this.selectTopTextNode=new Element("div",{text:MWF.SelectorLP.waitingSelect,styles:this.css.selectTopTextNode}).inject(this.selectTopNode)),this.options.searchbarInTopNode?this.searchInputDiv=new Element("div",{styles:this.css.searchInputDiv}).inject(this.selectTopNode||this.selectNode):this.searchInputDiv=new Element("div.searchInputDiv",{styles:this.css.searchInputDiv}).inject(this.selectNode),this.searchInput=new Element("input",{styles:this.css.searchInput,placeholder:MWF.SelectorLP.searchDescription,type:"text"}).inject(this.searchInputDiv),this.initSearchInput(),this.options.hasLetter&&(this.letterAreaNode=new Element("div",{styles:this.css.letterAreaNode}).inject(this.selectNode),this.loadLetters()),this.itemAreaScrollNode=new Element("div",{styles:this.css.itemAreaScrollNode}).inject(this.selectNode),this.itemAreaNode=new Element("div",{styles:this.css.itemAreaNode}).inject(this.itemAreaScrollNode),this.itemSearchAreaNode=new Element("div",{styles:this.css.itemAreaNode}).inject(this.itemAreaScrollNode),this.itemSearchAreaNode.setStyle("display","none"),this.loadSelectNodeScroll(),this.initLoadSelectItems(),this.checkLoadSelectItems()},loadSelectNodeScroll:function(){var e=this.itemAreaScrollNode.getStyle("overflow-y");("string"!==typeOf(e)||"auto"!==e.toLowerCase()&&"scroll"!==e.toLowerCase())&&MWF.require("MWF.widget.ScrollBar",function(){var e=this;new MWF.widget.ScrollBar(this.itemAreaScrollNode,{style:"xApp_Organization_Explorer",where:"before",distance:30,friction:4,axis:{x:!1,y:!0},onScroll:function(t){e._scrollEvent(t)}})}.bind(this))},initSearchInput:function(){this.searchInput.addEvents({keydown:function(e){var t=this.searchInput.retrieve("searchTimer",null);t&&(window.clearTimeout(t),this.searchInput.eliminate("searchTimer")),t=window.setTimeout(function(){this.search()}.bind(this),800),this.searchInput.store("searchTimer",t)}.bind(this),change:function(e){this.searchInput.get("value")||this.initSearchArea(!1)}.bind(this),blur:function(){this.searchInput.get("value")||this.initSearchArea(!1)}.bind(this)})},initSearchArea:function(e){this.searchItems=[],e?(this.itemSearchAreaNode.empty(),this.itemAreaNode.setStyle("display","none"),this.itemSearchAreaNode.getParent()!==this.itemAreaScrollNode&&this.itemAreaScrollNode.setStyle("display","none"),this.flatCategoryScrollNode&&this.flatCategoryScrollNode.setStyle("display","none"),this.itemSearchAreaScrollNode&&this.itemSearchAreaScrollNode.setStyle("display","block"),this.itemSearchAreaNode.setStyle("display","block")):(this.itemAreaScrollNode.setStyle("display","block"),this.itemAreaNode.setStyle("display","block"),this.flatCategoryScrollNode&&this.flatSubCategoryNodeList&&this.flatSubCategoryNodeList.length>1&&this.flatCategoryScrollNode.setStyle("display","block"),this.itemSearchAreaScrollNode&&this.itemSearchAreaScrollNode.setStyle("display","none"),this.itemSearchAreaNode.setStyle("display","none"))},search:function(){var e;this.options.groups.length||this.options.roles.length||this.options.forceSearchInItem?(e=this.searchInput.get("value"))?(this.initSearchArea(!0),this.searchInItems(e)):this.initSearchArea(!1):(e=this.searchInput.get("value"))?this._listItemByKey(function(e){this.initSearchArea(!0),e.data.each(function(e){if(!this.isExcluded(e)){var t=this._newItemSearch(e,this,this.itemSearchAreaNode);this.searchItems.push(t)}}.bind(this))}.bind(this),null,e):this.initSearchArea(!1)},searchInItems:function(e){var t=[];return this.createItemsSearchData(function(){var s=e.toLowerCase();this.itemsSearchData.each(function(e){var i=e.text+"#"+e.pinyin+"#"+e.firstPY,o=e.data.distinguishedName||e.data.id||e.data.name||e.data.text;-1!==i.indexOf(s)&&-1===t.indexOf(o)&&(this._newItem(e.data,this,this.itemSearchAreaNode),t.push(o))}.bind(this))}.bind(this)),t},createItemsSearchData:function(e){this.itemsSearchData?e&&e():(this.itemsSearchData=[],MWF.require("MWF.widget.PinYin",function(){var t=[];this.items.each(function(e){var s=e.data.distinguishedName||e.data.id||e.data.name||e.data.text;if(-1==t.indexOf(s)){var i=e._getShowName().toLowerCase(),o=i.toPY().toLowerCase(),l=i.toPYFirst().toLowerCase();this.itemsSearchData.push({text:i,pinyin:o,firstPY:l,data:e.data}),t.push(s)}}.bind(this)),delete t,e&&e()}.bind(this)))},initSelectedSearchInput:function(){this.selectedSearchInput.addEvents({keydown:function(e){var t=this.selectedSearchInput.retrieve("searchTimer",null);t&&(window.clearTimeout(t),this.selectedSearchInput.eliminate("searchTimer")),t=window.setTimeout(function(){this.selectedSearch()}.bind(this),800),this.selectedSearchInput.store("searchTimer",t)}.bind(this),change:function(e){this.selectedSearchInput.get("value")||this.selectedSearch()}.bind(this),blur:function(){this.selectedSearchInput.get("value")||this.selectedSearch()}.bind(this)})},selectedSearch:function(){var e=this.selectedSearchInput.get("value");e?this.selectedSearchInItems(e):this.showAllSelectedItem()},selectedSearchInItems:function(e){var t=e.toLowerCase();MWF.require("MWF.widget.PinYin",function(){this.selectedItems.each(function(e){if(!e.searchedText){var s=e._getShowName().toLowerCase(),i=s.toPY().toLowerCase(),o=s.toPYFirst().toLowerCase();e.searchedText=s+"#"+i+"#"+o}-1!==e.searchedText.indexOf(t)?e.node.show():e.node.hide()}.bind(this))}.bind(this),null,!1)},showAllSelectedItem:function(){this.selectedItems.each((function(e){e.node.show()}))},loadSelectedNode:function(e){this.selectedContainerNode||(this.selectedContainerNode=new Element("div",{styles:this.css.selectedContainerNode}).inject(this.contentNode),this.options.noSelectedContainer&&this.selectedContainerNode.hide(),this.options.hasTop&&(this.selectedTopNode=new Element("div",{styles:this.css.selectedTopNode}).inject(this.selectedContainerNode),this.selectedTopTextNode=new Element("div",{text:MWF.SelectorLP.selected,styles:this.css.selectedTopTextNode}).inject(this.selectedTopNode),this.emptySelectedNode=new Element("div",{text:MWF.SelectorLP.empty,styles:this.css.selectedTopActionNode,events:{click:function(){this.emptySelectedItems()}.bind(this)}}).inject(this.selectedTopNode)),this.options.hasSelectedSearchbar&&(this.options.searchbarInTopNode?this.selectedSearchInputDiv=new Element("div",{styles:this.css.searchInputDiv}).inject(this.selectedTopNode||this.selectedContainerNode):this.selectedSearchInputDiv=new Element("div.selectedSearchInputDiv",{styles:this.css.searchInputDiv}).inject(this.selectedContainerNode),this.selectedSearchInput=new Element("input",{styles:this.css.searchInput,placeholder:MWF.SelectorLP.searchDescription,type:"text"}).inject(this.selectedSearchInputDiv),this.initSelectedSearchInput()),this.selectedScrollNode=new Element("div.selectedScrollNode",{styles:this.css.selectedScrollNode}).inject(this.selectedContainerNode),this.selectedNode=new Element("div.selectedNode",{styles:this.css.selectedNode}).inject(this.selectedScrollNode),this.options.hasSelectedSearchbar&&(this.selectedItemSearchAreaNode=new Element("div.selectedItemSearchAreaNode",{styles:this.css.itemAreaNode}).inject(this.selectedScrollNode),this.selectedItemSearchAreaNode.setStyle("display","none")),this.setSelectedItem(),this.loadSelectedNodeScroll(),e&&e())},emptySelectedItems:function(){for(;this.selectedItems.length;)this.selectedItems[0].clickItem()},loadSelectedNodeScroll:function(){var e=this.selectedScrollNode.getStyle("overflow-y");("string"!==typeOf(e)||"auto"!==e.toLowerCase()&&"scroll"!==e.toLowerCase())&&MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.selectedScrollNode,{style:"xApp_Organization_Explorer",where:"before",distance:100,friction:4,axis:{x:!1,y:!0}})}.bind(this))},loadSelectedNodeMobile:function(){this.selectedScrollNode=new Element("div.selectedScrollNode",{styles:this.css.selectedScrollNode}).inject(this.contentNode),this.selectedNode=new Element("div.selectedNode",{styles:this.css.selectedNode}).inject(this.selectedScrollNode),this.setSelectedItem(),this.selectedScrollNode.setStyle("display","none")},setSelectedItem:function(){this.options.values.length&&this.options.values.each(function(e,t){"object"===typeOf(e)?this.selectedItems.push(this._newItemSelected(e,this,null)):this._getItem(function(e){this.options.values[t]=e.data,this.selectedItems.push(this._newItemSelected(e.data,this,null))}.bind(this),null,e,!1)}.bind(this))},loadLetters:function(){var e=this;letters=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];var t=this.css.letterNode,s=this.css.letterNode_over;if(layout.mobile){t=this.css.letterNode_mobile||t,s=this.css.letterNode_mobile_over||s;var i=this.container.getSize(),o=layout.mobile?(i.x-18)/13:(i.x-20-4-18)/13;t.width=o+"px",s.width=o+"px"}letters.each(function(i){var o=new Element("div",{styles:t,text:i}).inject(this.letterAreaNode);layout.mobile?o.addEvents({click:function(){e.listPersonByPinyin(this)}}):o.addEvents({mouseover:function(e){e.target.setStyles(s);var t=new Element("div",{styles:this.css.letterShowNode,text:e.target.get("text")}).inject(this.selectNode);t.position({relativeTo:this.itemAreaScrollNode,position:"center",edge:"center"}),e.target.store("showNode",t)}.bind(this),mouseout:function(e){e.target.retrieve("showNode").destroy(),e.target.setStyles(t)}.bind(this),click:function(){e.listPersonByPinyin(this)}})}.bind(this))},listPersonByPinyin:function(e){this.searchInput.focus();var t=this.searchInput.get("value");t+=e.get("text"),this.searchInput.set("value",t),this.options.groups.length||this.options.roles.length?t?(this.initSearchArea(!0),this.searchInItems(t)):this.initSearchArea(!1):t&&this._listItemByPinyin(function(e){this.initSearchArea(!0),e.data.each(function(e){this.isExcluded(e)||this._newItemSearch(e,this,this.itemSearchAreaNode)}.bind(this))}.bind(this),null,t.toLowerCase())},initLoadSelectItems:function(){this.loaddingItems=!1,this.isItemLoaded=!1,this.loadItemsQueue=0,this.initSearchArea(!1)},loadSelectItems:function(e,t){if(!this.isItemLoaded)if(this.loaddingItems)e&&this.loadItemsQueue++;else{this.loaddingItems=!0;this._listItemNext(this.getLastLoadedItemId(),20,function(s){if(s.data.length){var i=0;s.data.each(function(e,t){if(this.isExcluded(e))i++,t+1===20&&(this.tailExcludeItemId=e.distinguishedName);else{var s=this._newItem(e,this,this.itemAreaNode);this.items.push(s),t+1===20&&(this.tailExcludeItemId=null)}}.bind(this)),this.loaddingItems=!1,t?20-t-i<0&&(i=t+i-20,this.loadItemsQueue++):i>0&&this.loadItemsQueue++,s.data.length<20?this.isItemLoaded=!0:this.loadItemsQueue>0&&(this.loadItemsQueue--,this.loadSelectItems(e,i))}else this.isItemLoaded=!0,this.loaddingItems=!1;this.afterLoadSelectItem&&this.afterLoadSelectItem()}.bind(this))}},getLastLoadedItemId:function(){return this.tailExcludeItemId?this.tailExcludeItemId:this.items.length?this.items[this.items.length-1].data.distinguishedName:"(0)"},loadSelectItemsByCondition:function(){this.options.groups.each(function(e){this.orgAction.listGroupByKey(function(e){if(e.data.length){var t=e.data[0],s=this._newItemCategory("ItemGroupCategory",t,this,this.itemAreaNode);this.subCategorys.push(s),this._getChildrenItemIds(t).each(function(e){this._getItem(function(e){if(!this.isExcluded(e.data)){var t=this._newItem(e.data,this,s.children);this.items.push(t)}}.bind(this),null,e)}.bind(this))}}.bind(this),null,e)}.bind(this)),this.options.roles.each(function(e){this.orgAction.listRoleByKey(function(e){if(e.data.length){var t=e.data[0],s=this._newItemCategory("ItemRoleCategory",t,this,this.itemAreaNode);this.subCategorys.push(s),this._getChildrenItemIds(t).each(function(e){this._getItem(function(e){if(!this.isExcluded(e.data)){var t=this._newItem(e.data,this,s.children);this.items.push(t)}}.bind(this),null,e)}.bind(this))}}.bind(this),null,e)}.bind(this))},isExcluded:function(e){if(0===this.options.exclude.length)return!1;this.excludeFlagMap||(this.excludeFlagMap={},this.options.exclude.each(function(e){e&&(this.excludeFlagMap["string"===typeOf(e)?e:e.distinguishedName||e.id||e.unique||e.employee||e.levelName]=!0)}.bind(this)));var t=this.excludeFlagMap;return e.distinguishedName&&t[e.distinguishedName]||e.id&&t[e.id]||e.unique&&t[e.unique]||e.employee&&t[e.employee]||e.levelName&&t[e.levelName]},_getChildrenItemIds:function(e){return e.personList},_newItemCategory:function(e,t,s,i){return new MWF.xApplication.Selector.Person[e](t,s,i)},_listItemByKey:function(e,t,s){this.orgAction.listPersonByKey(function(t){e&&e.apply(this,[t])}.bind(this),t,s)},_getItem:function(e,t,s,i){this.orgAction.getPerson(function(t){e&&e.apply(this,[t])}.bind(this),t,"string"===typeOf(s)?s:s.distinguishedName,i)},_newItemSelected:function(e,t,s,i){return new MWF.xApplication.Selector.Person.ItemSelected(e,t,s,i)},_listItemByPinyin:function(e,t,s){this.orgAction.listPersonByPinyin(function(t){e&&e.apply(this,[t])}.bind(this),t,s)},_newItem:function(e,t,s){return new MWF.xApplication.Selector.Person.Item(e,t,s)},_newItemSearch:function(e,t,s){return this._newItem(e,t,s)},_listItemNext:function(e,t,s){this.orgAction.listPersonNext(e,t,function(e){s&&s.apply(this,[e])}.bind(this))},_scrollEvent:function(e){if(!this.options.groups.length&&!this.options.roles.length){var t=this.itemAreaScrollNode.getScrollSize(),s=this.itemAreaScrollNode.getSize();e+30>t.y-s.y&&(this.isItemLoaded||this.loadSelectItems())}},afterLoadSelectItem:function(){0===this.items.length&&0===this.subItems.length&&0===this.subCategorys.length&&(this.noSelectableItemTextDiv=new Element("div",{text:MWF.SelectorLP.noSelectableItemText,styles:this.css.noSelectableItemText}).inject(this.itemAreaNode)),this.options.selectSingleItem&&this.selectSingleItem(),this.fireEvent("afterLoadSelectItem",[this])},selectSingleItem:function(){this.options.contentUrl||layout.mobile?this._selectSingleItem():(this.options.hasShuttle&&!this.shuttleNode&&this.loadShuttleNode(),this.selectedContainerNode?this._selectSingleItem():this.loadSelectedNode(function(){this._selectSingleItem()}.bind(this)))},_selectSingleItem:function(){var e=this,t=function(){1===this.items.length||1===this.subItems.length?1===this.items.length&&0===this.subItems.length?(this.items[0].isSelected||this.items[0].clickItem(),this.fireEvent("afterSelectSingleItem",[this,this.items[0]])):0===this.items.length&&1===this.subItems.length?(this.items[0].isSelected||this.subItems[0].clickItem(),this.fireEvent("afterSelectSingleItem",[this,this.items[0]])):1===this.items.length&&1===this.subItems.length&&this.items[0]===this.subItems[0]?(this.items[0].isSelected||this.items[0].clickItem(),this.fireEvent("afterSelectSingleItem",[this,this.items[0]])):e.fireEvent("afterCheckSelectSingleItem",[e]):e.fireEvent("afterCheckSelectSingleItem",[e])}.bind(this),s=function(t){t.loaded?function(t){if(t.subCategorys&&0!==t.subCategorys.length)if(1===t.subCategorys.length)t.subItems&&t.subItems.length>0?e.fireEvent("afterCheckSelectSingleItem",[e]):t.subCategorys[0]._hasChild&&t.subCategorys[0]._hasChild()?s(t.subCategorys[0]):(isSingleItem=!0,t.subItems[0].isSelected||t.subItems[0].clickItem(),e.fireEvent("afterSelectSingleItem",[e,t.subItems[0]]));else{for(var i=[],o=0;o<t.subCategorys.length;o++)t.subCategorys[o]._hasChild&&t.subCategorys[o]._hasChild()&&i.push(t.subCategorys[o]);1===i.length&&(t.subItems&&0!==t.subItems.length||s(i[0])),0===i.length&&t.subItems&&1===t.subItems.length?(isSingleItem=!0,t.subItems[0].isSelected||t.subItems[0].clickItem(),e.fireEvent("afterSelectSingleItem",[e,t.subItems[0]])):e.fireEvent("afterCheckSelectSingleItem",[e])}else t.subItems&&1===t.subItems.length?(isSingleItem=!0,t.subItems[0].isSelected||t.subItems[0].clickItem(),e.fireEvent("afterSelectSingleItem",[e,t.subItems[0]])):e.fireEvent("afterCheckSelectSingleItem",[e])}(t):t.loading&&window.setTimeout((function(){s(t)}),100)};1===this.subCategorys.length&&0===this.subItems.length?s(this.subCategorys[0]):0===this.subCategorys.length?t():e.fireEvent("afterCheckSelectSingleItem",[e])},setSize:function(){if(this.options.width||this.options.height){var e=function(e){return(e.getStyle("margin-left").toInt()||0)+(e.getStyle("margin-right").toInt()||0)+(e.getStyle("padding-left").toInt()||0)+(e.getStyle("padding-right").toInt()||0)+(e.getStyle("border-left-width").toInt()||0)+(e.getStyle("border-right-width").toInt()||0)},t=function(e){return(e.getStyle("margin-top").toInt()||0)+(e.getStyle("margin-bottom").toInt()||0)+(e.getStyle("padding-top").toInt()||0)+(e.getStyle("padding-bottom").toInt()||0)+(e.getStyle("border-top-width").toInt()||0)+(e.getStyle("border-bottom-width").toInt()||0)};if(this.options.width&&"auto"===this.options.width){this.node&&this.node.setStyle("width","auto"),this.selectNode.setStyles({width:"50%",float:"left"}),this.letterAreaNode&&this.letterAreaNode.setStyle("width","auto"),this.selectedContainerNode.setStyle("width","auto");var s=this.selectedScrollNode.getStyle("overflow-y");"string"!==typeOf(s)||"auto"!==s.toLowerCase()&&"scroll"!==s.toLowerCase()?this.selectedScrollNode.setStyle("margin-right","8px"):this.selectedScrollNode.setStyle("width","auto")}else if(this.options.width&&"number"===typeOf(this.options.width.toInt())){var i;this.node?(i=this.options.width.toInt()-e(this.node),this.node.setStyle("width",i)):i=this.options.width.toInt(),i-=e(this.contentNode),this.shuttleNode&&(i=i-e(this.shuttleNode)-this.shuttleNode.getStyle("width").toInt());var o=i-e(this.selectNode)-e(this.selectedContainerNode),l=this.options.noSelectedContainer?o:Math.floor(o/2)-2;this.selectNode.setStyle("width",l),this.letterAreaNode&&this.letterAreaNode.setStyle("width",l-19),this.selectedContainerNode.setStyle("width",l);s=this.selectedScrollNode.getStyle("overflow-y");"string"!==typeOf(s)||"auto"!==s.toLowerCase()&&"scroll"!==s.toLowerCase()?this.selectedScrollNode.setStyle("width",l-8):this.selectedScrollNode.setStyle("width",l)}if(this.options.height&&"number"===typeOf(this.options.height.toInt())){var n;this.node?(n=this.options.height.toInt()-t(this.node),this.node.setStyle("height",n)):n=this.options.height.toInt(),n=n-t(this.contentNode)-1,this.titleNode&&(n=n-t(this.titleNode)-this.titleNode.getStyle("height").toInt()),this.actionNode&&(n=n-t(this.actionNode)-this.actionNode.getStyle("height").toInt());var c=n-t(this.selectNode);if(this.selectNode.setStyle("height",c),this.shuttleNode){this.shuttleNode.setStyle("height",c);var h=t(this.shuttleInnerNode)+this.shuttleInnerNode.getStyle("height").toInt();this.shuttleInnerNode.setStyle("margin-top",(c-h)/2+"px")}var d=c-t(this.searchInputDiv)-this.searchInputDiv.getStyle("height").toInt();!this.options.searchbarInTopNode&&this.selectTopNode&&(d=d-t(this.selectTopNode)-this.selectTopNode.getStyle("height").toInt()),this.letterAreaNode&&(d=d-t(this.letterAreaNode)-this.letterAreaNode.getStyle("height").toInt()),d-=t(this.itemAreaScrollNode),this.itemAreaScrollNode.setStyle("height",d);var r=n-t(this.selectedContainerNode);this.selectedContainerNode.setStyle("height",r);var a=r;this.selectedTopNode&&(a=a-t(this.selectedTopNode)-this.selectedTopNode.getStyle("height").toInt()),!this.options.searchbarInTopNode&&this.selectedSearchInputDiv&&(a=a-t(this.selectedSearchInputDiv)-this.selectedSearchInputDiv.getStyle("height").toInt()),this.selectedScrollNode.setStyle("height",a)}this.fireEvent("setSize",[this])}},addFlatCategoryItem:function(e,t,s,i){if(this.flatSubCategoryNodeList||(this.flatSubCategoryNodeList=[]),t&&this.flatSubCategoryNodeList.push(e),!this.isFlatCategoryLoaded&&this.flatSubCategoryNodeList.length>1){this.flatCategoryScrollNode.show(),this.flatCategoryScrollNode.setStyles(this.css.flatCategoryScrollNode);var o=this.itemAreaScrollNode.getStyle("height").toInt();this.flatCategoryScrollNode.setStyle("height",o+"px"),this.flatCategoryNode.setStyles(this.css.flatCategoryNode),this.isFlatCategoryLoaded=!0,this.itemAreaScrollNode.setStyles(this.css.itemAreaScrollNode_flatCategory)}var l;if(t&&e.inject(s||this.flatCategoryNode),i&&(l=new Element("div.subCategoryListNode").inject(s||this.flatCategoryNode)),t)if(this.currentCategoryItemNode){var n=this.flatCategoryNode.getElement(".flatCategoryItemNode");if(n){var c=n.retrieve("dn"),h=this.currentCategoryItemNode.retrieve("dn");if(c&&h)c!=h&&(e.click(),this.currentCategoryItemNode=e);else{var d=n.get("title"),r=this.currentCategoryItemNode.get("title");if(d&&d)d!=r&&(e.click(),this.currentCategoryItemNode=e);else n.get("text")!=this.currentCategoryItemNode.get("text")&&(e.click(),this.currentCategoryItemNode=e)}}}else e.click(),this.currentCategoryItemNode=e;return l}}),MWF.xApplication.Selector.Person.Item=new Class({initialize:function(e,t,s,i,o,l){this.clazz="Item",this.data=e,this.selector=t,this.container=s,this.isSelected=!1,this.level=i?i.toInt():1,this.category=o,this.subItems=[],this.subCategorys=[],l||this.load()},_getShowName:function(){return this.data.name+(this.data.employee?"("+this.data.employee+")":"")},_getTtiteText:function(){return this.data.name+(this.data.employee?"("+this.data.employee+")":"")},_setIcon:function(){var e=this.selector.options.style;this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/"+e+"/icon/personicon.png)")},load:function(){if("Item"===this.clazz&&this.selector.fireEvent("queryLoadItem",[this]),this.node||(this.node=new Element("div",{styles:this.selector.css.selectorItem}).inject(this.container)),this.levelNode=new Element("div",{styles:this.selector.css.selectorItemLevelNode}).inject(this.node),"identity"!==this.selector.selectType||0===this.selector.options.identityItemWidth){var e=this.selector.options.level1Indent+(this.level-1)*this.selector.options.indent;this.levelNode.setStyle("width",e+"px")}this.iconNode=new Element("div",{styles:this.selector.css.selectorItemIconNode}).inject(this.node),this._setIcon(),this.actionNode=new Element("div",{styles:this.selector.css.selectorItemActionNode}).inject(this.node),(1===this.selector.options.count.toInt()||this.selector.options.noSelectedContainer)&&this.selector.css.selectorItemActionNode_single&&this.actionNode.setStyles(this.selector.css.selectorItemActionNode_single),this.textNode=new Element("div",{styles:this.selector.css.selectorItemTextNode,text:this._getShowName(),title:this._getTtiteText()}).inject(this.node),this.textNode.store("indent",e);var t=this.textNode.getStyle("margin-left").toFloat()+e;this.textNode.setStyle("margin-left",t+"px"),this.selector.options.identityItemWidth&&"identity"===this.selector.selectType&&this.node.setStyles({float:"left","min-width":this.selector.options.identityItemWidth+"px"}),this.postLoad&&this.postLoad(),this.loadSubItem(),this.setEvent(),this.check(),"Item"===this.clazz&&this.selector.fireEvent("postLoadItem",[this])},loadSubItem:function(){},disable:function(){this.node.hide(),this.disabled=!0},enable:function(){this.node.show(),this.disabled=!1},check:function(){this.checkSelected()},checkSelectedSingle:function(){this.selector.options.values.filter(function(e,t){return"object"===typeOf(e)?this.data.distinguishedName===e.distinguishedName:"string"===typeOf(e)&&this.data.distinguishedName===e}.bind(this)).length&&this.selectedSingle()},checkSelected:function(){var e=this.selector.selectedItems.filter(function(e,t){return e.data.distinguishedName===this.data.distinguishedName}.bind(this));e.length&&(e[0].addItem(this),this.selectedItem=e[0],this.setSelected())},checkTextNodeIndent:function(e,t){var s=e.retrieve("indent");if(s&&t&&t["margin-left"]){var i=t["margin-left"].toFloat()+s;e.setStyle("margin-left",i+"px")}},setSelected:function(){this.isSelected=!0,this.node.setStyles(this.selector.css.selectorItem_selected),this.textNode.setStyles(this.selector.css.selectorItemTextNode_selected),this.checkTextNodeIndent(this.textNode,this.selector.css.selectorItemTextNode_selected),this.actionNode.setStyles(this.selector.css.selectorItemActionNode_selected),(1===this.selector.options.count.toInt()||this.selector.options.noSelectedContainer)&&this.selector.css.selectorItemActionNode_single_selected&&this.actionNode.setStyles(this.selector.css.selectorItemActionNode_single_selected)},setEvent:function(){this.node.addEvents({mouseover:function(){this.overItem()}.bind(this),mouseout:function(){this.outItem()}.bind(this),click:function(){this.clickItem(null,!0)}.bind(this)})},clickItem:function(e,t){this.isSelected?this.unSelected(t):this.selected(t)},overItem:function(){this.isSelected?this.selector.css.selectorItem_over_force&&this.node.setStyles(this.selector.css.selectorItem_over_force):this.node.setStyles(this.selector.css.selectorItem_over),this.isSelected?this.selector.css.selectorItemActionNode_over_force&&this.node.setStyles(this.selector.css.selectorItemActionNode_over_force):(this.actionNode.setStyles(this.selector.css.selectorItemActionNode_over),(1===this.selector.options.count.toInt()||this.selector.options.noSelectedContainer)&&this.selector.css.selectorItemActionNode_single_over&&this.actionNode.setStyles(this.selector.css.selectorItemActionNode_single_over))},outItem:function(){this.isSelected?this.selector.css.selectorItem_over_force&&this.node.setStyles(this.selector.css.selectorItem_selected):this.node.setStyles(this.selector.css.selectorItem),this.isSelected?this.selector.css.selectorItemActionNode_over_force&&(this.actionNode.setStyles(this.selector.css.selectorItemActionNode_selected),(1===this.selector.options.count.toInt()||this.selector.options.noSelectedContainer)&&this.selector.css.selectorItemActionNode_single_selected&&this.actionNode.setStyles(this.selector.css.selectorItemActionNode_single_selected)):(this.actionNode.setStyles(this.selector.css.selectorItemActionNode),(1===this.selector.options.count.toInt()||this.selector.options.noSelectedContainer)&&this.selector.css.selectorItemActionNode_single&&this.actionNode.setStyles(this.selector.css.selectorItemActionNode_single))},selectedSingle:function(e){this.isSelected?(this.selector.emptySelectedItems(),this.unSelectedSingle(e)):(this.selector.currentItem&&this.selector.currentItem.unSelectedSingle(),this.selector.emptySelectedItems(),this.getData(function(){this.selector.currentItem=this,this.isSelected=!0,this.selector.selectedItems.push(this),this.node.setStyles(this.selector.css.selectorItem_selected),this.textNode.setStyles(this.selector.css.selectorItemTextNode_selected),this.checkTextNodeIndent(this.textNode,this.selector.css.selectorItemTextNode_selected),this.actionNode.setStyles(this.selector.css.selectorItemActionNode_selected),(1===this.selector.options.count.toInt()||this.selector.options.noSelectedContainer)&&this.selector.css.selectorItemActionNode_single_selected&&this.actionNode.setStyles(this.selector.css.selectorItemActionNode_single_selected),this.selector.fireEvent("selectItem",[this]),e&&this.selector.fireEvent("valid",[this.selector,this])}.bind(this)))},getData:function(e){e&&e()},unSelectedSingle:function(e){this.selector.currentItem=null,this.isSelected=!1,this.selector.selectedItems.erase(this),this.node.setStyles(this.selector.css.selectorItem),this.textNode.setStyles(this.selector.css.selectorItemTextNode),this.checkTextNodeIndent(this.textNode,this.selector.css.selectorItemTextNode),this.actionNode.setStyles(this.selector.css.selectorItemActionNode),(1===this.selector.options.count.toInt()||this.selector.options.noSelectedContainer)&&this.selector.css.selectorItemActionNode_single&&this.actionNode.setStyles(this.selector.css.selectorItemActionNode_single),this.selector.fireEvent("unselectItem",[this]),e&&this.selector.fireEvent("valid",[this.selector,this])},selected:function(e,t,s,i){var o=this.selector.options.maxCount||this.selector.options.count;(o=o.toInt())||(o=0),1==o&&this.selector.emptySelectedItems&&this.selector.emptySelectedItems(),0===o||this.selector.selectedItems.length+1<=o?(this.isSelected=!0,this.node&&(this.node.setStyles(this.selector.css.selectorItem_selected),this.textNode.setStyles(this.selector.css.selectorItemTextNode_selected),this.checkTextNodeIndent(this.textNode,this.selector.css.selectorItemTextNode_selected),this.actionNode.setStyles(this.selector.css.selectorItemActionNode_selected),(1===this.selector.options.count.toInt()||this.selector.options.noSelectedContainer)&&this.selector.css.selectorItemActionNode_single_selected&&this.actionNode.setStyles(this.selector.css.selectorItemActionNode_single_selected)),this.selectedItem=this.selector._newItemSelected(this.data,this.selector,this,s),this.selector.selectedItems.push(this.selectedItem),this.selector.fireEvent("selectItem",[this]),e&&this.selector.fireEvent("valid",[this.selector,this]),t&&t()):MWF.xDesktop.notice("error",{x:"right",y:"top"},MWF.SelectorLP.selectItemMaxText.replace("{count}",o),this.node)},unSelected:function(e,t){var s=this.isSelected;this.isSelected=!1,this.node&&(this.node.setStyles(this.selector.css.selectorItem),this.textNode.setStyles(this.selector.css.selectorItemTextNode),this.checkTextNodeIndent(this.textNode,this.selector.css.selectorItemTextNode),this.actionNode.setStyles(this.selector.css.selectorItemActionNode),(1===this.selector.options.count.toInt()||this.selector.options.noSelectedContainer)&&this.selector.css.selectorItemActionNode_single&&this.actionNode.setStyles(this.selector.css.selectorItemActionNode_single)),this.category&&"all"!==this.selector.options.selectAllRange&&this.category.checkUnselectAll(),this.selector.searchItems&&this.selector.searchItems.length&&this.selector.searchItems.each(function(e){var t=e.data,s=this.data;(t.distinguishedName&&t.distinguishedName===s.distinguishedName||t.id&&t.id===s.id||t.unique&&t.unique===s.unique||t.employee&&t.employee===s.employee||t.levelName&&t.levelName===s.levelName)&&(e.isSelected=!1,e.node.setStyles(this.selector.css.selectorItem),e.textNode.setStyles(this.selector.css.selectorItemTextNode),this.checkTextNodeIndent(e.textNode,this.selector.css.selectorItemTextNode),e.actionNode.setStyles(this.selector.css.selectorItemActionNode),(1===this.selector.options.count.toInt()||this.selector.options.noSelectedContainer)&&this.selector.css.selectorItemActionNode_single&&e.actionNode.setStyles(this.selector.css.selectorItemActionNode_single))}.bind(this)),this.selectedItem&&(this.selector.selectedItems.erase(this.selectedItem),this.selectedItem.items.each(function(e){(e.isSelected||e===this&&s)&&(("all"===this.selector.options.selectAllRange||"identity"==this.selector.selectType&&(this.selector.options.showSelectedCount||this.selector.options.isCheckStatus))&&e.category&&e.category._addSelectedCount&&e.category._addSelectedCount(-1,!0));e!=this&&(e.isSelected=!1,e.node.setStyles(this.selector.css.selectorItem),e.textNode.setStyles(this.selector.css.selectorItemTextNode),this.checkTextNodeIndent(e.textNode,this.selector.css.selectorItemTextNode),e.actionNode.setStyles(this.selector.css.selectorItemActionNode),(1===this.selector.options.count.toInt()||this.selector.options.noSelectedContainer)&&this.selector.css.selectorItemActionNode_single&&e.actionNode.setStyles(this.selector.css.selectorItemActionNode_single))}.bind(this)),this.selectedItem.destroy(),this.selectedItem=null),this.selector.fireEvent("unselectItem",[this]),e&&this.selector.fireEvent("valid",[this.selector,this]),t&&t()},postLoad:function(){},getParentCategoryByLevel:function(e){var t=this.category;do{if(t.level===e)return t;t=t.category}while(t)}}),MWF.xApplication.Selector.Person.ItemSelected=new Class({Extends:MWF.xApplication.Selector.Person.Item,initialize:function(e,t,s,i){this.data=e,this.selector=t,this.container=i||this.selector.selectedNode,this.isSelected=!1,this.clazz="ItemSelected",this.items=[],s&&this.items.push(s),this.level=0,this.node=new Element("div",{styles:this.selector.css.selectorItem}).inject(this.container),this.node.setStyle("display","none"),this.getData(function(){this.node.setStyle("display",""),this.load()}.bind(this))},postLoad:function(){this.selector.css.selectorSelectedItemActionNode&&(this.actionNode.setStyles(this.selector.css.selectorSelectedItemActionNode),(1===this.selector.options.count.toInt()||this.selector.options.noSelectedContainer)&&this.selector.css.selectorSelectedItemActionNode_single&&this.actionNode.setStyles(this.selector.css.selectorSelectedItemActionNode_single)),this.selector.css.selectorSelectedItemTextNode&&this.textNode.setStyles(this.selector.css.selectorSelectedItemTextNode)},getData:function(e){e&&e()},clickItem:function(e,t){this.items.length?(this.items.each((function(e){e.unSelected(t)})),t&&this.selector.fireEvent("valid",[this.selector,this])):(this.destroy(),this.selector.selectedItems.erase(this),t&&this.selector.fireEvent("valid",[this.selector,this]))},overItem:function(){this.isSelected||(this.selector.css.selectorItem_selected_over?this.node.setStyles(this.selector.css.selectorItem_selected_over):this.node.setStyles(this.selector.css.selectorItem_over),this.actionNode.setStyles(this.selector.css.selectorItemActionNode_selected_over),(1===this.selector.options.count.toInt()||this.selector.options.noSelectedContainer)&&this.selector.css.selectorItemActionNode_single_selected_over&&this.actionNode.setStyles(this.selector.css.selectorItemActionNode_single_selected_over))},outItem:function(){if(this.isSelected)this.selector.css.selectorItem_over_force&&this.node.setStyles(this.selector.css.selectorItem_selected);else{var e=this.selector.css.selectorSelectedItem||this.selector.css.selectorItem;this.node.setStyles(e)}if(this.isSelected)this.selector.css.selectorItemActionNode_over_force&&(this.actionNode.setStyles(this.selector.css.selectorItemActionNode_selected),(1===this.selector.options.count.toInt()||this.selector.options.noSelectedContainer)&&this.selector.css.selectorItemActionNode_single_selected&&this.actionNode.setStyles(this.selector.css.selectorItemActionNode_single_selected));else{e=this.selector.css.selectorSelectedItemActionNode||this.selector.css.selectorItemActionNode;this.actionNode.setStyles(e),1!==this.selector.options.count.toInt()&&!this.selector.options.noSelectedContainer||!this.selector.css.selectorSelectedItemActionNode_single&&!this.selector.css.selectorItemActionNode_single||this.actionNode.setStyles(this.selector.css.selectorSelectedItemActionNode_single||this.selector.css.selectorItemActionNode_single)}},addItem:function(e){-1===this.items.indexOf(e)&&this.items.push(e)},check:function(){if(this.selector.items.length){var e=this.selector.items.filter(function(e,t){return e.data.distinguishedName===this.data.distinguishedName}.bind(this));this.items=e,e.length&&e.each(function(e){e.selectedItem=this,e.setSelected()}.bind(this))}this.afterCheck&&this.afterCheck()},destroy:function(){this.node&&this.node.destroy()}}),MWF.xApplication.Selector.Person.ItemCategory=new Class({Extends:MWF.xApplication.Selector.Person.Item,initialize:function(e,t,s,i,o,l){this.data=e,this.selector=t,this.container=s,this.isSelected=!1,this.level=i?i.toInt():1,this.category=o,this.subItems=[],this.subCategorys=[],l||this.load()},load:function(){this.selector.isFlatCategory?this.loadForFlat():this.loadForNormal()},loadForFlat:function(){if(this.selector.fireEvent("queryLoadCategory",[this]),this.node=new Element("div.flatCategoryItemNode",{styles:this.selector.css.flatCategoryItemNode,title:this._getTtiteText()}),this.node.store("category",this),this.node.store("dn",this.data.distinguishedName),this.textNode=new Element("div",{styles:this.selector.css.flatCategoryItemTextNode,text:this._getShowName()}).inject(this.node),this.children=new Element("div",{styles:this.selector.css.selectorItemCategoryChildrenNode}).inject(this.selector.itemAreaNode),this.children.setStyle("display","none"),this.selector.options.selectAllEnable&&1!==this.selector.options.count.toInt()){var e=new Element("div",{styles:this.selector.css.flatCategory_selectAllWrap}).inject(this.children);this.selectAllNode=new Element("div",{styles:this.selector.css.flatCategory_selectAll,text:MWF.SelectorLP.selectAll}).inject(e),this.selectAllNode.addEvent("click",function(e){this.isSelectedAll?("all"===this.selector.options.selectAllRange?this.unselectAllNested(e,null,!0):this.unselectAll(e,null,!0),this.selector.fireEvent("unselectCatgory",[this]),this.selector.fireEvent("unselectCatgeory",[this])):("all"===this.selector.options.selectAllRange?this.selectAllNested(e,!0):this.selectAll(e,!0),this.selector.fireEvent("selectCatgory",[this]),this.selector.fireEvent("selectCatgeory",[this])),e.stopPropagation()}.bind(this))}this.selectAllNode&&("direct"!==this.selector.options.selectAllRange||this._hasChildItem()||this.selectAllNode.setStyle("display","none")),this.node.addEvents({click:function(){this.selector.currentFlatCategory!==this&&(this.selector.currentFlatCategory&&this.selector.currentFlatCategory.clickFlatCategoryItem(null,!0),this.selector.currentFlatCategory=this,this.clickFlatCategoryItem())}.bind(this)});var t,s=!this._hasChildCategory||this._hasChildCategory();t=this.nodeContainer?this.nodeContainer:this.category&&this.category.subCategoryListNode?this.category.subCategoryListNode:null,this.subCategoryListNode=this.selector.addFlatCategoryItem(this.node,this._hasChildItem(),t,s),this.check(),this.loadCategoryChildren&&this.loadCategoryChildren(),this.selector.fireEvent("postLoadCategory",[this])},loadForNormal:function(){if(this.selector.fireEvent("queryLoadCategory",[this]),this.createNode(),this.levelNode=new Element("div",{styles:this.selector.css.selectorItemLevelNode}).inject(this.node),"identity"!==this.selector.selectType||0===this.selector.options.identityItemWidth){var e=this.selector.options.level1Indent+(this.level-1)*this.selector.options.indent;this.levelNode.setStyle("width",e+"px")}else this.node.setStyle("clear","both");this.iconNode=new Element("div",{styles:this.selector.css.selectorItemCategoryIconNode||this.selector.css.selectorItemIconNode}).inject(this.node),this._setIcon(),this.actionNode=new Element("div",{styles:this.selector.options.expand?this.selector.css.selectorItemCategoryActionNode_expand:this.selector.css.selectorItemCategoryActionNode_collapse}).inject(this.node),this.selector.options.selectAllEnable&&1!==this.selector.options.count.toInt()&&(this.selectAllNode=new Element("div",{styles:this.selector.css.selectorItemCategoryActionNode_selectAll,title:MWF.SelectorLP.selectChildren}).inject(this.node),this.selectAllNode.addEvent("click",function(e){if(this.isSelectedAll)"all"===this.selector.options.selectAllRange?this.unselectAllNested(e,null,!0):this.unselectAll(e,null,!0),this.selector.fireEvent("unselectCatgory",[this]),this.selector.fireEvent("unselectCategory",[this]);else{if("all"===this.selector.options.selectAllRange){var t=new Element("div.categorySelectedNode").inject(this.selector.selectedNode);this.selectAllNested(e,!0,t)}else this.selectAll(e,!0);this.selector.fireEvent("selectCatgory",[this]),this.selector.fireEvent("selectCategory",[this])}e.stopPropagation()}.bind(this)),this.selector.css.selectorItemCategoryActionNode_selectAll_over&&this.selectAllNode.addEvents({mouseover:function(e){this.isSelectedAll||this.isSelectedSome||this.selectAllNode.setStyles(this.selector.css.selectorItemCategoryActionNode_selectAll_over)}.bind(this),mouseout:function(e){this.isSelectedAll||this.isSelectedSome||this.selectAllNode.setStyles(this.selector.css.selectorItemCategoryActionNode_selectAll)}.bind(this)})),this.textNode=new Element("div",{styles:this.selector.css.selectorItemCategoryTextNode,text:this._getShowName()}).inject(this.node);var t=this.textNode.getStyle("margin-left").toFloat()+e;if(this.textNode.setStyle("margin-left",t+"px"),this.selector.options.showSelectedCount&&"identity"==this.selector.selectType&&(this.selectedCountNode=new Element("span").inject(this.textNode)),this.children=new Element("div.children",{styles:this.selector.css.selectorItemCategoryChildrenNode}).inject(this.node,"after"),this.selector.options.expand||this.children.setStyle("display","none"),this.selector.options.expandEmptyCategory&&!this._hasChildItem())this.children.hide(),this.actionNode.setStyles(this.selector.css.selectorItemCategoryActionNode_collapse),this.isExpand=!1;else{var s=this.selector._getChildrenItemIds(this.data);if(s){var i=s.length;this.childrenHeight=i*this.selector.options.itemHeight,this.children.setStyle("height",this.childrenHeight+"px")}if(this.selector.options.identityItemWidth&&"identity"===this.selector.selectType){e=0===this.level?this.selector.options.level1Indent:this.selector.options.indent;this.children.setStyles({"padding-left":e+"px",overflow:"hidden"})}this._hasChild()||(this.selector.options.hiddenEmptyCategory?this.node.hide():(this.actionNode.setStyle("background","transparent"),this.textNode.setStyle("color","#777"))),this.selectAllNode&&("direct"!==this.selector.options.selectAllRange||this._hasChildItem()||this.selectAllNode.setStyle("display","none"))}this.setEvent(),this.check(),this.afterLoad(),this.selector.fireEvent("postLoadCategory",[this])},createNode:function(){this.node=new Element("div",{styles:this.selector.css.selectorItemCategory,title:this._getTtiteText()}).inject(this.container)},unselectAll:function(e,t,s){var i=function(){var e=t||[];t&&"array"!==typeOf(t)&&(e=[t]),(this.subItems||[]).each(function(t){t.isSelected&&!e.contains(t)&&t.unSelected(s)}.bind(this)),this.selectAllNode&&(this.selector.isFlatCategory?this.selectAllNode.setStyles(this.selector.css.flatCategory_selectAll):this.selector.css.selectorItemCategoryActionNode_selectAll&&this.selectAllNode.setStyles(this.selector.css.selectorItemCategoryActionNode_selectAll)),this.isSelectedAll=!1}.bind(this);this.loaded?i():this.clickItem(function(){i()}.bind(this))},unselectAllNested:function(e,t,s){this.unselectAll(e,t,s),this.subCategorys&&this.subCategorys.length&&this.subCategorys.each((function(i){i.unselectAllNested(e,t,s)}))},selectAllNested:function(e,t,s){var i;s&&(i=new Element("div.categorySelectedNode").inject(s)),this.selectAll(e,t,i,function(){this.subCategorys&&this.subCategorys.length&&this.subCategorys.each((function(i){if(s)var o=new Element("div.categorySelectedNode").inject(s);i.selectAllNested(e,t,o)}))}.bind(this))},selectAll:function(e,t,s,i){this.loaded||this.selector.isFlatCategory?(this._selectAll(e,t,s),i&&i()):this.clickItem(function(){this._selectAll(e,t,s),i&&i()}.bind(this))},_selectAll:function(e,t,s){if("direct"!==this.selector.options.selectAllRange||this.subItems&&this.subItems.length){var i=this.selector.options.maxCount||this.selector.options.count;i||(i=0);var o=0;if(this.subItems.each(function(e){e.isSelected&&o++}.bind(this)),0===i.toInt()||this.selector.selectedItems.length+(this.subItems.length-o)<=i){var l=0,n=function(){if(this.subItems.each(function(e){e.isSelected||e.disabled||e.selected(!1,function(){l++,this.subItems.length===l&&t&&this.selector.fireEvent("valid",[this.selector,this])}.bind(this),s)}.bind(this)),this.selectAllNode)if(this.selector.isFlatCategory)this.selectAllNode.setStyles(this.selector.css.flatCategory_selectAll_selected);else if(this.selector.css.selectorItemCategoryActionNode_selectAll_selected){var e=this.selector.css.selectorItemCategoryActionNode_selectAll_selected;this.selector.options.isCheckStatus&&"identity"===this.selector.selectType&&this._getSelectedCount()<this._getTotalCount()&&(e=this.selector.css.selectorItemCategoryActionNode_selectsome_selected),this.selectAllNode.setStyles(e)}this.isSelectedAll=!0}.bind(this);this._beforeSelectAll?this._beforeSelectAll(n):n()}else MWF.xDesktop.notice("error",{x:"right",y:"top"},MWF.SelectorLP.selectItemMaxText.replace("{count}",i),this.node)}},checkSelectAll:function(){if(!this.isSelectedAll&&this.selectAllNode&&this.subItems){for(var e=!0,t=0;t<this.subItems.length;t++)if(!this.subItems[t].isSelected){e=!1;break}e&&(this.selector.isFlatCategory?this.selectAllNode.setStyles(this.selector.css.flatCategory_selectAll_selected):this.selector.css.selectorItemCategoryActionNode_selectAll_selected&&this.selectAllNode.setStyles(this.selector.css.selectorItemCategoryActionNode_selectAll_selected),this.isSelectedAll=!0)}},checkUnselectAll:function(){if(this.isSelectedAll&&this.selectAllNode&&this.subItems){for(var e=!1,t=0;t<this.subItems.length;t++)if(this.subItems[t].isSelected){e=!0;break}e||(this.selector.isFlatCategory?this.selectAllNode.setStyles(this.selector.css.flatCategory_selectAll):this.selector.css.selectorItemCategoryActionNode_selectAll&&this.selectAllNode.setStyles(this.selector.css.selectorItemCategoryActionNode_selectAll),this.isSelectedAll=!1)}},afterLoad:function(){1===this.level&&this.clickItem()},clickFlatCategoryItem:function(e,t){if(this._hasChildItem()){var s=this.children.getStyle("display");t?(this.children.setStyles({display:"none"}),this.node.setStyles(this.selector.css.flatCategoryItemNode),this.isExpand=!1):"none"===s?(this.children.setStyles({display:"block",height:"auto"}),this.node.setStyles(this.selector.css.flatCategoryItemNode_selected),this.isExpand=!0):(this.children.setStyles({display:"none"}),this.node.setStyles(this.selector.css.flatCategoryItemNode),this.isExpand=!1),e&&e()}},clickItem:function(e){if(this._hasChild()||this.selector.options.expandEmptyCategory){if(this.fx||(this.fx=new Fx.Tween(this.children,{duration:200})),!this.fx.isRunning())"none"===this.children.getStyle("display")?(this.children.setStyles({display:"block",height:"0px"}),this.fx.start("height","0px",this.childrenHeight+"px"),this.actionNode.setStyles(this.selector.css.selectorItemCategoryActionNode_expand),this.isExpand=!0,this.selector.fireEvent("expand",[this])):(this.childrenHeight||(this.childrenHeight=this.children.getStyle("height").toFloat()),this.fx.start("height",this.childrenHeight+"px","0px").chain(function(){this.children.setStyles({display:"none",height:"0px"})}.bind(this)),this.actionNode.setStyles(this.selector.css.selectorItemCategoryActionNode_collapse),this.isExpand=!1,this.selector.fireEvent("collapse",[this]));e&&e()}},overItem:function(){this.selector.css.selectorItemCategory_over&&this.node.setStyles(this.selector.css.selectorItemCategory_over),"none"===this.children.getStyle("display")?this._hasChild()&&this.selector.css.selectorItemCategoryActionNode_collapse_over&&this.actionNode.setStyles(this.selector.css.selectorItemCategoryActionNode_collapse_over):this._hasChild()&&this.selector.css.selectorItemCategoryActionNode_expand_over&&this.actionNode.setStyles(this.selector.css.selectorItemCategoryActionNode_expand_over)},outItem:function(){this.selector.css.selectorItemCategory_over&&this.node.setStyles(this.selector.css.selectorItemCategory),"none"===this.children.getStyle("display")?this._hasChild()&&this.selector.css.selectorItemCategoryActionNode_collapse_over&&this.actionNode.setStyles(this.selector.css.selectorItemCategoryActionNode_collapse):this._hasChild()&&this.selector.css.selectorItemCategoryActionNode_expand_over&&this.actionNode.setStyles(this.selector.css.selectorItemCategoryActionNode_expand)},_hasChild:function(){var e=this.selector._getChildrenItemIds(this.data);return!(!e||!e.length)},_hasChildCategory:function(){return null},_hasChildItem:function(){return this._hasChild()},_getTtiteText:function(){return this.data.levelName?this.data.name+"("+this.data.levelName+")":this.data.name}}),MWF.xApplication.Selector.Person.ItemGroupCategory=new Class({Extends:MWF.xApplication.Selector.Person.ItemCategory,_getShowName:function(){return this.data.name},_setIcon:function(){var e=this.selector.options.style;this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/"+e+"/icon/groupicon.png)")}}),MWF.xApplication.Selector.Person.ItemRoleCategory=new Class({Extends:MWF.xApplication.Selector.Person.ItemCategory,_getShowName:function(){return this.data.name},_setIcon:function(){var e=this.selector.options.style;this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/"+e+"/icon/roleicon.png)")}}),MWF.xApplication.Selector.Person.Filter=new Class({Implements:[Options,Events],options:{style:"default",groups:[],roles:[]},initialize:function(e,t){this.setOptions(t),this.value=e,this.orgAction=MWF.Actions.get("x_organization_assemble_control")},filter:function(e,t){this.value=e;var s=this.value;(this.options.groups.length||this.options.roles.length)&&(s={key:s,groupList:this.options.groupList,roleList:this.options.roleList}),this.orgAction.listPersonByKey(function(e){data=e.data,t&&t(data)}.bind(this),null,s)}});