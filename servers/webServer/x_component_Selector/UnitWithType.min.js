MWF.xApplication.Selector=MWF.xApplication.Selector||{},MWF.xDesktop.requireApp("Selector","Unit",null,!1),MWF.xApplication.Selector.UnitWithType=new Class({Extends:MWF.xApplication.Selector.Unit,options:{style:"default",count:0,units:[],unitType:"",values:[],zIndex:1e3,expand:!0,exclude:[],selectType:"unit",expandSubEnable:!0,selectAllEnable:!0},setInitTitle:function(){this.setOptions({title:MWF.xApplication.Selector.LP.selectUnit})},_init:function(){this.selectType="unit",this.className="UnitWithType"},loadSelectItems:function(t){if(this.options.disabled)this.afterLoadSelectItem();else{var e=this.afterLoadSelectItem.bind(this),i={};i.type=this.options.unitType,i.unitList=[],this.options.units.each(function(t){"string"===typeOf(t)?i.unitList.push(t):i.unitList.push(t.distinguishedName)}.bind(this)),this.orgAction.listUnitByType(function(t){t.data.length&&t.data.each(function(t){if(!this.isExcluded(t))if(this.options.expandSubEnable&&this.options.unitType&&-1===t.typeList.indexOf(this.options.unitType)){if(t.woSubDirectUnitList.length){var e=this._newItemCategory("ItemCategory",t,this,this.itemAreaNode);this.subCategorys.push(e)}}else{var i=this._newItem(t,this,this.itemAreaNode,1);this.items.push(i),this.subItems.push(i)}}.bind(this)),e()}.bind(this),e,i)}},_scrollEvent:function(t){return!0},_getChildrenItemIds:function(){return null},_newItemCategory:function(t,e,i,s,n,o,l){return new MWF.xApplication.Selector.UnitWithType[t](e,i,s,n,o,l)},_listItemByKey:function(t,e,i){if(this.options.expandSubEnable){if(i={key:i},this.options.units.length){var s=[];this.options.units.each((function(t){"string"===typeOf(t)&&s.push(t),"object"===typeOf(t)&&s.push(t.distinguishedName)})),i.unitList=s}this.options.unitType&&(i.type=this.options.unitType),this.orgAction.listUnitByKey(function(e){t&&t.apply(this,[e])}.bind(this),e,i)}else i?(this.initSearchArea(!0),this.searchInItems(i)):this.initSearchArea(!1)},_getItem:function(t,e,i,s){this.orgAction.getUnit(function(e){t&&t.apply(this,[e])}.bind(this),e,"string"===typeOf(i)?i:i.distinguishedName,s)},_newItemSelected:function(t,e,i,s){return new MWF.xApplication.Selector.UnitWithType.ItemSelected(t,e,i,s)},_listItemByPinyin:function(t,e,i){if(i={key:i},this.options.units.length){var s=[];this.options.units.each((function(t){"string"===typeOf(t)&&s.push(t),"object"===typeOf(t)&&s.push(t.distinguishedName)})),i.unitList=s}this.options.unitType&&(i.type=this.options.unitType),this.orgAction.listUnitByPinyininitial(function(e){t&&t.apply(this,[e])}.bind(this),e,i)},_newItem:function(t,e,i,s,n,o){return new MWF.xApplication.Selector.UnitWithType.Item(t,e,i,s,n,o)},_newItemSearch:function(t,e,i,s){return new MWF.xApplication.Selector.UnitWithType.SearchItem(t,e,i,s)}}),MWF.xApplication.Selector.UnitWithType.Item=new Class({Extends:MWF.xApplication.Selector.Unit.Item,_getShowName:function(){return this.isShowLevelName&&this.data.levelName?this.data.levelName:this.data.name},_getTtiteText:function(){return this.data.levelName||this.data.name},_setIcon:function(){var t=this.selector.options.style;this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/"+t+"/icon/departmenticon.png)")},loadSubItem:function(){this.selector.options.expandSubEnable&&(this.isExpand=this.selector.options.expand,this.data.subDirectUnitCount&&(this.selector.options.expand?1===this.level?(this.levelNode.setStyles(this.selector.css.selectorItemLevelNode_expand),this.loadSubItems()):(this.isExpand=!1,this.levelNode.setStyles(this.selector.css.selectorItemLevelNode_collapse)):this.levelNode.setStyles(this.selector.css.selectorItemLevelNode_collapse),this.levelNode.addEvent("click",function(t){this.isExpand?(this.selector.fireEvent("collapse",[this]),this.children.setStyle("display","none"),this.levelNode.setStyles(this.selector.css.selectorItemLevelNode_collapse),this.isExpand=!1):(this.selector.fireEvent("expand",[this]),this.loadSubItems(),this.levelNode.setStyles(this.selector.css.selectorItemLevelNode_expand),this.isExpand=!0),t.stopPropagation()}.bind(this)),this.selectAllNode||this.selector.isFlatCategory||(this.selectAllNode=new Element("div",{styles:this.selector.css.selectorItemCategoryActionNode_selectAll,title:MWF.SelectorLP.selectChildren}).inject(this.textNode,"before"),this.selectAllNode.addEvent("click",(function(t){this.isSelectedAll?("all"===this.selector.options.selectAllRange?this.unselectAllNested(t,null,!0):this.unselectAll(t,null,!0),this.selector.fireEvent("unselectCatgory",[this]),this.selector.fireEvent("unselectCategory",[this])):("all"===this.selector.options.selectAllRange?this.selectAllNested(t,!0):this.selectAll(t,!0),this.selector.fireEvent("selectCatgory",[this]),this.selector.fireEvent("selectCategory",[this])),t.stopPropagation()})))))},loadSubItems:function(t){this.loaded||this.loading?this.children.setStyle("display","block"):(this.loading=!0,this.children||(this.children=new Element("div",{styles:this.selector.css.selectorItemCategoryChildrenNode}).inject(this.node,"after")),this.children.setStyle("display","block"),(this.data.woSubDirectUnitList||[]).each(function(e){if(!this.selector.isExcluded(e))if(this.selector.options.unitType&&-1===e.typeList.indexOf(this.selector.options.unitType)){if(e.woSubDirectUnitList.length){var i=this.selector._newItemCategory("ItemCategory",e,this.selector,this.children,this.level+1,this);this.subCategorys.push(i)}}else{var s=this.selector._newItem(e,this.selector,this.children,this.level+1,this);this.selector.items.push(s),this.subItems||(this.subItems=[]),this.subItems.push(s)}t&&t()}.bind(this)),this.loaded=!0,this.loading=!1)},postLoad:function(){},loadCategoryChildren:function(t){this.categoryLoaded||(this.data.woSubDirectUnitList.each(function(e){if(!this.selector.isExcluded(e))if(this.selector.options.unitType&&-1===e.typeList.indexOf(this.selector.options.unitType)){if(e.woSubDirectUnitList.length){var i=this.selector._newItemCategory("ItemCategory",e,this.selector,this.children,this.level+1,this);this.subCategorys.push(i)}}else;t&&t()}.bind(this)),this.categoryLoaded=!0)},loadItemChildren:function(t){this.itemLoaded?this.children.setStyle("display","block"):(this.children||(this.children=new Element("div",{styles:this.selector.css.selectorItemCategoryChildrenNode}).inject(this.selector.itemAreaNode)),this.children.setStyle("display","block"),this.data.woSubDirectUnitList.each(function(e){if(!(this.selector.isExcluded(e)||this.selector.options.unitType&&-1===e.typeList.indexOf(this.selector.options.unitType))){var i=this.selector._newItem(e,this.selector,this.children,this.level+1,this,!0);i.justItem=!0,i.load(),this.selector.items.push(i),this.subItems||(this.subItems=[]),this.subItems.push(i)}t&&t()}.bind(this)),this.itemLoaded=!0)}}),MWF.xApplication.Selector.UnitWithType.SearchItem=new Class({Extends:MWF.xApplication.Selector.UnitWithType.Item,load:function(){this.loadForNormal()},_getShowName:function(){return this.data.levelName||this.data.name},loadSubItems:function(t){}}),MWF.xApplication.Selector.UnitWithType.ItemSelected=new Class({Extends:MWF.xApplication.Selector.Unit.ItemSelected,_getTtiteText:function(){return this.data.levelName||this.data.name},_getShowName:function(){return this.data.name+(this.data.levelName?"("+this.data.levelName+")":"")},_setIcon:function(){var t=this.selector.options.style;this.iconNode.setStyle("background-image","url(../x_component_Selector/$Selector/"+t+"/icon/departmenticon.png)")}}),MWF.xApplication.Selector.UnitWithType.ItemCategory=new Class({Extends:MWF.xApplication.Selector.Unit.ItemCategory,loadSub:function(t){this.loaded||(this.data.woSubDirectUnitList.each(function(t){if(!this.selector.isExcluded(t))if(this.selector.options.unitType&&-1===t.typeList.indexOf(this.selector.options.unitType)){if(t.woSubDirectUnitList.length){var e=this.selector._newItemCategory("ItemCategory",t,this.selector,this.children,this.level+1,this);this.subCategorys.push(e)}}else{var i=this.selector._newItem(t,this.selector,this.children,this.level+1,this);this.selector.items.push(i),this.subItems&&this.subItems.push(i)}this.subItems&&this.subItems.length||this.selectAllNode&&this.selectAllNode.destroy()}.bind(this)),this.loaded=!0),t&&t()},afterLoad:function(){1===this.level&&this.clickItem();var t=!1;this.data.woSubDirectUnitList.each(function(e){this.selector.isExcluded(e)||this.selector.options.unitType&&-1===e.typeList.indexOf(this.selector.options.unitType)||(t=!0),!t&&this.selectAllNode&&this.selectAllNode.destroy()}.bind(this))},_hasChild:function(){return this.data.woSubDirectUnitList.length},_hasChildCategory:function(){return this.data.woSubDirectUnitList.length},_hasChildItem:function(){if("boolean"===typeOf(this.isHasChildItem))return this.isHasChildItem;this.isHasChildItem=!1;for(var t=this.data.woSubDirectUnitList||[],e=0;e<t.length;e++)if(!this.selector.options.unitType||-1!==t[e].typeList.indexOf(this.selector.options.unitType)){this.isHasChildItem=!0;break}return this.isHasChildItem},loadCategoryChildren:function(t){this.categoryLoaded||(this.data.woSubDirectUnitList.each(function(t){if(!this.selector.isExcluded(t))if(this.selector.options.unitType&&-1===t.typeList.indexOf(this.selector.options.unitType)){if(t.woSubDirectUnitList.length){var e=this.selector._newItemCategory("ItemCategory",t,this.selector,this.children,this.level+1,this);this.subCategorys.push(e)}}else;}.bind(this)),this.categoryLoaded=!0),t&&t()},loadItemChildren:function(t){this.itemLoaded||(this.data.woSubDirectUnitList.each(function(t){if(!(this.selector.isExcluded(t)||this.selector.options.unitType&&-1===t.typeList.indexOf(this.selector.options.unitType))){var e=this.selector._newItem(t,this.selector,this.children,this.level+1,this);this.selector.items.push(e),this.subItems&&this.subItems.push(e)}this.subItems&&this.subItems.length||this.selectAllNode&&this.selectAllNode.destroy()}.bind(this)),this.itemLoaded=!0),t&&t()}}),MWF.xApplication.Selector.UnitWithType.Filter=new Class({Implements:[Options,Events],options:{style:"default",units:[]},initialize:function(t,e){this.setOptions(e),this.value=t,this.orgAction=MWF.Actions.get("x_organization_assemble_control")},filter:function(t,e){this.value=t;var i=this.value;if(i={key:i},this.options.units.length){var s=[];this.options.units.each((function(t){"string"===typeOf(t)&&s.push(t),"object"===typeOf(t)&&s.push(t.distinguishedName)})),i.unitList=s}this.options.unitType&&(i.type=this.options.unitType),this.orgAction.listUnitByKey(function(t){data=t.data,e&&e(data)}.bind(this),failure,i)}});