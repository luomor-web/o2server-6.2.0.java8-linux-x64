MWF.xDesktop.requireApp("portal.PortalManager","package",null,!1),MWF.require("MWF.xAction.org.express.RestActions",null,!1),MWF.require("MWF.widget.Identity",null,!1),MWF.xDesktop.requireApp("process.ProcessManager","",null,!1),MWF.xApplication.portal=MWF.xApplication.portal||{},MWF.xApplication.portal.PortalManager.Main=new Class({Extends:MWF.xApplication.process.ProcessManager.Main,Implements:[Options,Events],options:{application:null,style:"default",name:"portal.PortalManager",icon:"icon.png",width:"1100",height:"700",title:MWF.xApplication.portal.PortalManager.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.portal.PortalManager.LP,this.currentContentNode=null,this.restActions=MWF.Actions.get("x_portal_assemble_designer")},keyCopyItems:function(t){layout.desktop.currentApp&&layout.desktop.currentApp.appId===this.appId&&(this.pageConfigurator&&this.pageConfigurator.keyCopy(t),this.scriptConfigurator&&this.scriptConfigurator.keyCopy(t),this.widgetConfigurator&&this.widgetConfigurator.keyCopy(t))},keyPasteItems:function(t){layout.desktop.currentApp&&layout.desktop.currentApp.appId===this.appId&&(this.pageConfigurator&&this.pageConfigurator.keyPaste(t),this.scriptConfigurator&&this.scriptConfigurator.keyPaste(t),this.widgetConfigurator&&this.widgetConfigurator.keyPaste(t))},loadStartMenu:function(t){this.startMenuNode=new Element("div",{styles:this.css.startMenuNode}).inject(this.node),this.menu=new MWF.xApplication.portal.PortalManager.Menu(this,this.startMenuNode,{onPostLoad:function(){this.status&&null!=this.status.navi?this.menu.doAction(this.menu.startNavis[this.status.navi]):this.menu.doAction(this.menu.startNavis[0])}.bind(this)}),this.addEvent("resize",function(){this.menu&&this.menu.onResize()}.bind(this))},clearContent:function(){this.pageConfiguratorContent&&(this.pageConfigurator&&delete this.pageConfigurator,this.pageConfiguratorContent.destroy(),this.pageConfiguratorContent=null),this.menuConfiguratorContent&&(this.menuConfigurator&&delete this.menuConfigurator,this.menuConfiguratorContent.destroy(),this.menuConfiguratorContent=null),this.propertyConfiguratorContent&&(this.property&&delete this.property,this.propertyConfiguratorContent.destroy(),this.propertyConfiguratorContent=null),this.widgetConfiguratorContent&&(this.widgetConfigurator&&delete this.widgetConfigurator,this.widgetConfiguratorContent.destroy(),this.widgetConfiguratorContent=null),this.scriptConfiguratorContent&&(this.scriptConfigurator&&delete this.scriptConfigurator,this.scriptConfiguratorContent.destroy(),this.scriptConfiguratorContent=null),this.fileConfiguratorContent&&(this.fileConfigurator&&delete this.fileConfigurator,this.fileConfiguratorContent.destroy(),this.fileConfiguratorContent=null)},applicationProperty:function(){this.clearContent(),this.propertyConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.property=new MWF.xApplication.portal.PortalManager.ApplicationProperty(this,this.propertyConfiguratorContent),this.property.load()},pageConfig:function(){this.clearContent(),this.pageConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadPageConfig()},loadPageConfig:function(){MWF.xDesktop.requireApp("portal.PortalManager","PageExplorer",function(){this.pageConfigurator=new MWF.xApplication.portal.PortalManager.PageExplorer(this.pageConfiguratorContent,this.restActions),this.pageConfigurator.app=this,this.pageConfigurator.load()}.bind(this))},menuConfig:function(){this.clearContent(),this.menuConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadMenuConfig()},loadMenuConfig:function(){MWF.xDesktop.requireApp("portal.PortalManager","MenuExplorer",function(){this.restActions||(this.restActions=MWF.Actions.get("x_portal_assemble_designer")),this.menuConfigurator=new MWF.xApplication.portal.PortalManager.MenuExplorer(this.menuConfiguratorContent,this.restActions),this.menuConfigurator.app=this,this.menuConfigurator.load()}.bind(this))},widgetConfig:function(){this.clearContent(),this.widgetConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadWidgetConfig()},loadWidgetConfig:function(){MWF.xDesktop.requireApp("portal.PortalManager","WidgetExplorer",function(){this.widgetConfigurator=new MWF.xApplication.portal.PortalManager.WidgetExplorer(this.widgetConfiguratorContent,this.restActions),this.widgetConfigurator.app=this,this.widgetConfigurator.load()}.bind(this))},scriptConfig:function(){this.clearContent(),this.scriptConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadScriptConfig()},loadScriptConfig:function(){MWF.xDesktop.requireApp("portal.PortalManager","ScriptExplorer",function(){this.restActions||(this.restActions=MWF.Actions.get("x_portal_assemble_designer")),this.scriptConfigurator=new MWF.xApplication.portal.PortalManager.ScriptExplorer(this.scriptConfiguratorContent,this.restActions),this.scriptConfigurator.app=this,this.scriptConfigurator.load()}.bind(this))},fileConfig:function(){this.clearContent(),this.fileConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadFileConfig()},loadFileConfig:function(){MWF.xDesktop.requireApp("portal.PortalManager","FileExplorer",function(){this.restActions=MWF.Actions.get("x_portal_assemble_designer"),this.fileConfigurator=new MWF.xApplication.portal.PortalManager.FileExplorer(this.fileConfiguratorContent,this.restActions),this.fileConfigurator.app=this,this.fileConfigurator.load()}.bind(this))}}),MWF.xApplication.portal.PortalManager.Menu=new Class({Extends:MWF.xApplication.process.ProcessManager.Menu,Implements:[Options,Events]}),MWF.xApplication.portal.PortalManager.ApplicationProperty=new Class({Extends:MWF.xApplication.process.ProcessManager.ApplicationProperty,createPropertyContentNode:function(){this.propertyContentNode=new Element("div",{styles:{overflow:"hidden","-webkit-user-select":"text","-moz-user-select":"text"}}).inject(this.contentAreaNode);var t="<table cellspacing='0' cellpadding='0' border='0' width='95%' align='center' style='margin-top: 20px'>";t+="<tr><td class='formTitle'>"+this.app.lp.application.name+"</td><td id='formApplicationName'></td></tr>",t+="<tr><td class='formTitle'>"+this.app.lp.application.alias+"</td><td id='formApplicationAlias'></td></tr>",t+="<tr><td class='formTitle'>"+this.app.lp.application.description+"</td><td id='formApplicationDescription'></td></tr>",t+="<tr><td class='formTitle'>"+this.app.lp.application.type+"</td><td id='formApplicationType'></td></tr>",t+="<tr><td class='formTitle'>"+this.app.lp.application.firstPage+"</td><td id='formApplicationFirstPage'></td></tr>",t+="<tr><td class='formTitle'>"+this.app.lp.application.pcClient+"</td><td id='formApplicationPcClient'></td></tr>",t+="<tr><td class='formTitle'>"+this.app.lp.application.mobileClient+"</td><td id='formApplicationMobileClient'></td></tr>",t+="<tr><td class='formTitle'>"+this.app.lp.application.id+"</td><td id='formApplicationId'></td></tr>",t+="<tr><td class='formTitle'>"+this.app.lp.application.url+"</td><td id='formApplicationUrl'></td></tr>",t+="</table>",this.propertyContentNode.set("html",t),this.propertyContentNode.getElements("td.formTitle").setStyles(this.app.css.propertyBaseContentTdTitle),this.nameInput=new MWF.xApplication.portal.PortalManager.Input(this.propertyContentNode.getElement("#formApplicationName"),this.data.name,this.app.css.formInput),this.aliasInput=new MWF.xApplication.portal.PortalManager.Input(this.propertyContentNode.getElement("#formApplicationAlias"),this.data.alias,this.app.css.formInput),this.descriptionInput=new MWF.xApplication.portal.PortalManager.Input(this.propertyContentNode.getElement("#formApplicationDescription"),this.data.description,this.app.css.formInput),this.typeInput=new MWF.xApplication.portal.PortalManager.Input(this.propertyContentNode.getElement("#formApplicationType"),this.data.portalCategory,this.app.css.formInput),this.firstPageInput=new MWF.xApplication.portal.PortalManager.Select(this.propertyContentNode.getElement("#formApplicationFirstPage"),this.data.firstPage,this.app.css.formInput,function(){var t={};return this.app.restActions.listPage(this.app.options.application.id,function(i){i.data.each(function(i){t[i.id]=i.name}.bind(this))}.bind(this),null,!1),t}.bind(this)),this.pcClientInput=new MWF.xApplication.portal.PortalManager.Radio(this.propertyContentNode.getElement("#formApplicationPcClient"),null!=this.data.pcClient?this.data.pcClient.toString():"true",this.app.css.formInput,function(){return{true:this.app.lp.application.true,false:this.app.lp.application.false}}.bind(this)),this.mobileClientInput=new MWF.xApplication.portal.PortalManager.Radio(this.propertyContentNode.getElement("#formApplicationMobileClient"),null!=this.data.mobileClient?this.data.mobileClient.toString():"true",this.app.css.formInput,function(){return{true:this.app.lp.application.true,false:this.app.lp.application.false}}.bind(this)),this.idInput=new MWF.xApplication.portal.PortalManager.Input(this.propertyContentNode.getElement("#formApplicationId"),this.data.id,this.app.css.formInput);var i="http://"+window.location.host+"/x_desktop/portal.html"+("?id="+this.data.id);this.urlInput=new MWF.xApplication.portal.PortalManager.Input(this.propertyContentNode.getElement("#formApplicationUrl"),i,this.app.css.formInput)},editMode:function(){this.nameInput.editMode(),this.aliasInput.editMode(),this.descriptionInput.editMode(),this.typeInput.editMode(),this.firstPageInput.editMode(),this.pcClientInput.editMode(),this.mobileClientInput.editMode(),this.isEdit=!0},readMode:function(){this.nameInput.readMode(),this.aliasInput.readMode(),this.descriptionInput.readMode(),this.typeInput.readMode(),this.firstPageInput.readMode(),this.pcClientInput.readMode(),this.mobileClientInput.readMode(),this.isEdit=!1},save:function(t,i){this.data.name=this.nameInput.input.get("value"),this.data.alias=this.aliasInput.input.get("value"),this.data.description=this.descriptionInput.input.get("value"),this.data.portalCategory=this.typeInput.input.get("value")||"",this.data.firstPage=this.firstPageInput.input.get("value"),this.data.pcClient="true"===this.pcClientInput.getValue(),this.data.mobileClient="true"===this.mobileClientInput.getValue(),this.app.restActions.saveApplication(this.data,function(i){this.propertyTitleBar.set("text",this.data.name),this.data.id=i.data.id,this.nameInput.save(),this.aliasInput.save(),this.descriptionInput.save(),this.typeInput.save(),this.firstPageInput.save(),this.pcClientInput.save(),this.mobileClientInput.save(),t&&t()}.bind(this),function(t,e,n){i&&i(t,e,n)}.bind(this))}}),MWF.xApplication.portal.PortalManager.Input=new Class({Extends:MWF.xApplication.process.ProcessManager.Input,Implements:[Events]}),MWF.xApplication.portal.PortalManager.Select=new Class({Extends:MWF.xApplication.portal.PortalManager.Input,Implements:[Events],initialize:function(t,i,e,n){this.node=$(t),this.value=i||"",this.style=e,this.select=n,this.selectList=null,this.load()},getSelectList:function(){return this.select?this.select():[]},getText:function(t){return t&&this.selectList&&this.selectList[t]||""},load:function(){this.selectList=this.getSelectList(),this.content=new Element("div",{styles:this.style.content,text:this.getText(this.value)}).inject(this.node)},editMode:function(){this.content.empty(),this.input=new Element("select",{}).inject(this.content),Object.each(this.selectList,function(t,i){new Element("option",{value:i,text:t,selected:this.value==i}).inject(this.input)}.bind(this))},readMode:function(){this.content.empty(),this.input=null,this.content.set("text",this.getText(this.value))},save:function(){return this.input&&(this.value=this.input.options[this.input.selectedIndex].get("value")),this.value}}),MWF.xApplication.portal.PortalManager.Radio=new Class({Extends:MWF.xApplication.portal.PortalManager.Select,editMode:function(){this.content.empty();var t=Math.random();Object.each(this.selectList,function(i,e){new Element("input",{type:"radio",name:"rd"+t,value:e,checked:this.value===e}).inject(this.content).appendHTML(i,"after")}.bind(this))},getValue:function(){for(var t=this.content.getElements("input"),i=0;i<t.length;i++)if(t[i].checked){this.value=t[i].value;break}return this.value},save:function(){for(var t=this.content.getElements("input"),i=0;i<t.length;i++)if(t[i].checked){this.value=t[i].value;break}return this.value}});