MWF.xApplication.process.Xform.widget=MWF.xApplication.process.Xform.widget||{},MWF.require("MWF.widget.ImageClipper",null,!1),MWF.xApplication.process.Xform.widget.ImageClipper=new Class({Implements:[Options,Events],Extends:MWF.widget.Common,options:{reference:"",referenceType:"",imageUrl:"",resultMaxSize:800,description:"",title:"Select Image",style:"default",aspectRatio:1},initialize:function(e,t){this.setOptions(t),this.app=e,this.path="../x_component_process_Xform/widget/$ImageClipper/",this.cssPath="../x_component_process_Xform/widget/$ImageClipper/"+this.options.style+"/css.wcss",this._loadCss()},load:function(e){this.data=e;var t={},i="668",s="510";i=i.toInt(),s=s.toInt();var o=this.app.content;layout.mobile&&(o=$(document.body));var n=o.getSize(),a=(n.x-i)/2,p=(n.y-s)/2;a<0&&(a=0),p<0&&(p=0),layout.mobile&&(a=20,p=0);var r=this;layout.mobile?(this.fileNode=new Element("input.file",{type:"file",accept:" .jpeg, .jpg, .png",multiple:!1,styles:{display:"none"}}).inject(o),this.fileNode.addEvent("change",function(e){var t=this.fileNode.files[0];t&&this.uploadImageForH5(t),this.fileNode.destroy(),this.fileNode=null}.bind(this)),setTimeout(function(){this.fileNode.click()}.bind(this),100)):MWF.require("MWF.xDesktop.Dialog",function(){var e=new MWF.xDesktop.Dialog({title:this.options.title||"Select Image",style:t.style||"image",top:p,left:a-20,fromTop:p,fromLeft:a-20,width:i,height:s,html:"<div></div>",maskNode:o,container:o,buttonList:[{text:MWF.LP.process.button.ok,action:function(){r.image.getResizedImage()?r.image.uploadImage(function(e){r.imageSrc=MWF.xDesktop.getImageSrc(e.id),r.imageId=e.id,r.fireEvent("change"),this.close()}.bind(this)):(r.imageSrc="",r.imageId="",r.fireEvent("change"),this.close())}},{text:MWF.LP.process.button.cancel,action:function(){this.close()}}]});e.show(),this.image=new MWF.widget.ImageClipper(e.content.getFirst(),{aspectRatio:this.options.aspectRatio,description:this.options.description,imageUrl:this.options.imageUrl,resultMaxSize:this.options.resultMaxSize,reference:this.options.reference,referenceType:this.options.referenceType,resetEnable:!0}),this.image.load(this.data)}.bind(this))},uploadImageForH5:function(e){var t=this.options.resultMaxSize?this.options.resultMaxSize:800,i=new FormData;i.append("file",e,e.name),o2.xDesktop.uploadImageByScale(this.options.reference,this.options.referenceType,t,i,e,function(e){this.imageSrc=MWF.xDesktop.getImageSrc(e.id),this.imageId=e.id,this.fireEvent("change")}.bind(this),function(e){this.imageSrc="",this.imageId="",this.fireEvent("change")}.bind(this))}});