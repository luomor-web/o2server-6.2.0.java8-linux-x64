MWF.xDesktop.requireApp("process.Xform","Textfield",null,!1),MWF.xApplication.process.Xform.Number=MWF.APPNumber=new Class({Implements:[Events],Extends:MWF.APPTextfield,iconStyle:"numberIcon",isEmpty:function(){return!this.getData()},getInputData:function(){if(this.node.getFirst()){var t=this.node.getElement("input").get("value"),i=t.toFloat();return isNaN(i)?0:i}return this._getBusinessData()},formatNumber:function(t){var i=t.toFloat();if(i&&this.json.decimals&&"*"!=this.json.decimals){var e=this.json.decimals.toInt(),n=Math.pow(10,e);if(t=(Math.round(i*n)/n).toString(),e>0){var o=t.indexOf(".");for(o<0&&(o=t.length,t+="."),decimalStr=t.substr(o+1,t.length);decimalStr.length<e;)t+="0",decimalStr+=0}}return t},validationFormat:function(){if(!this.node.getElement("input"))return!0;var t=this.node.getElement("input").get("value");return isNaN(t)?(this.notValidationMode(MWF.xApplication.process.Xform.LP.notValidation_number),!1):(this.node.getFirst().set("value",this.formatNumber(t)),!0)},validationConfigItem:function(t,i){if("all"==i.status||t==i.decision){var e=this.getInputData(),n="value"==i.valueType?e:e.length;switch(i.operateor){case"isnull":if(!n&&"0"!==n.toString())return this.notValidationMode(i.prompt),!1;break;case"notnull":if(n)return this.notValidationMode(i.prompt),!1;break;case"gt":if(n>i.value)return this.notValidationMode(i.prompt),!1;break;case"lt":if(n<i.value)return this.notValidationMode(i.prompt),!1;break;case"equal":if(n==i.value)return this.notValidationMode(i.prompt),!1;break;case"neq":if(n!=i.value)return this.notValidationMode(i.prompt),!1;break;case"contain":if(-1!=n.indexOf(i.value))return this.notValidationMode(i.prompt),!1;break;case"notcontain":if(-1==n.indexOf(i.value))return this.notValidationMode(i.prompt),!1}}return!0},validationConfig:function(t,i){if(this.json.validationConfig){if(this.json.validationConfig.length)for(var e=0;e<this.json.validationConfig.length;e++){var n=this.json.validationConfig[e];if(!this.validationConfigItem(t,n))return!1}return!0}return!0},validation:function(t,i){if(!this.readonly&&!this.json.isReadonly){if(!this.validationFormat())return!1;if(!this.validationConfig(t,i))return!1;if(!this.json.validation)return!0;if(!this.json.validation.code)return!0;this.currentRouteName=t;var e=this.form.Macro.exec(this.json.validation.code,this);if(this.currentRouteName="",e||(e=MWF.xApplication.process.Xform.LP.notValidation),"true"!=e.toString())return this.notValidationMode(e),!1}return!0},_resetNodeEdit:function(){var t=new Element("input",{styles:{background:"transparent",width:"100%",border:"0px"}}),i=new Element("div",{styles:{overflow:"hidden",position:"relative","margin-right":"20px","padding-right":"4px"}}).inject(this.node,"after");t.inject(i),this.node.destroy(),this.node=i},_loadNodeEdit:function(){this.json.preprocessing||this._resetNodeEdit(),this.node.getFirst().set(this.json.properties),this.node.set({id:this.json.id,MWFType:this.json.type,events:{click:this.clickSelect.bind(this)}}),"no"==this.json.showIcon||this.form.json.hideModuleIcon?this.form.json.nodeStyleWithhideModuleIcon&&this.node.setStyles(this.form.json.nodeStyleWithhideModuleIcon):this.iconNode=new Element("div",{styles:this.form.css[this.iconStyle]}).inject(this.node,"before"),this.node.getFirst().addEvent("change",function(){this.validationMode(),this.validation()&&(this._setBusinessData(this.getInputData("change")),this.fireEvent("change"))}.bind(this)),this.node.getFirst().addEvent("blur",function(){this.validation()}.bind(this)),this.node.getFirst().addEvent("keyup",function(){this.validationMode()}.bind(this))},_computeValue:function(t){return this.json.defaultValue&&this.json.defaultValue.code?this.form.Macro.exec(this.json.defaultValue.code,this):t||"0"},getValue:function(){if(this.moduleValueAG)return this.moduleValueAG;var t=this._getBusinessData();return t||(t=this._computeValue()),(t=this.formatNumber(t))||"0"},__setValue:function(t){return this._setBusinessData(t),this.node.getFirst()&&this.node.getFirst().set("value",t||"0"),(this.readonly||this.json.isReadonly)&&this.node.set("text",t),this.moduleValueAG=null,t}});