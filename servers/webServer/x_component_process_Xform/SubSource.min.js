MWF.xDesktop.requireApp("process.Xform","$Module",null,!1),MWF.xApplication.process.Xform.SubSource=MWF.APPSubSource=new Class({Extends:MWF.APP$Module,options:{moduleEvents:["queryLoad","postLoad","load","postLoadData","loadData"]},load:function(){this._loadModuleEvents(),this._queryLoaded(),this._loadUserInterface(),this._loadDomEvents(),this._afterLoaded()},_loadUserInterface:function(){this.loopNodes=[],this.subSourceItems=[];var t=new Element("div").inject(this.node,"before");this.node.inject(t),this.loopNode=this.node.dispose(),this.node=t;var e=t.get("id");t.set("id",""),this.node.set({id:e,mwftype:t.get("mwftype")}),this.node.store("module",this),this._loadJsonData()},_getSource:function(){for(var t=this.node.getParent();t&&"source"!=t.get("MWFtype")&&"subSource"!=t.get("MWFtype")&&"subSourceItem"!=t.get("MWFtype");)t=t.getParent();return t?t.retrieve("module"):null},_getSourceData:function(t){var e=t;"."!=this.json.jsonPath&&this.json.jsonPath.split(".").each(function(t){e=e[t]}.bind(this));this.data=e},_loopSub:function(t,e){this.form._getModuleNodes(t).each(function(t){var o=this.form._getDomjson(t),s=Object.clone(o);s.id=s.id+"_"+e,t.set("id",s.id);this.form._loadModule(s,t)}.bind(this))},_loopData:function(){this.data.each(function(t,e){var o=this.loopNode.clone(!0,!0);o.inject(this.node);var s=Object.clone(this.json);s.id=s.id+"_"+e,s.type="SubSourceItem",o.set({id:s.id,mwftype:"subSourceItem"});var i=this.form._loadModule(s,o,(function(){this.data=t,this.position=e}));this.subSourceItems.push(i),this.loopNodes.push(o),this._loopSub(o,e)}.bind(this))},_initSubSource:function(){this.loopNode&&(this.form._getModuleNodes(this.node).each(function(t){var e=t.retrieve("module");e&&("SubSource"==e.json.type?e._initSubSource():MWF.release(e))}.bind(this)),this.node.empty());this.loopNodes=[],this.subSourceItems=[]},_loadJsonData:function(t){t||this._initSubSource(),this.source=this._getSource(),this.source&&this.source.data&&(this._getSourceData(this.source.data),this.fireEvent("postLoadData"),"array"!==typeOf(this.data)&&(this.data=[this.data]),"array"==typeOf(this.data)?(this._loopData(),this.fireEvent("loadData")):this.form._loadModules(this.node))}}),MWF.xApplication.process.Xform.SubSourceItem=MWF.APPSubSourceItem=new Class({Extends:MWF.APP$Module,_loadUserInterface:function(){this.loopNodes=[],this.subSourceItems=[]}});