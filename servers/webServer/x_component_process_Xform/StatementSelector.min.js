MWF.xDesktop.requireApp("process.Xform","$Module",null,!1),MWF.xDesktop.requireApp("process.Xform","ViewSelector",null,!1),MWF.xApplication.process.Xform.StatementSelector=MWF.APPStatementSelector=new Class({Implements:[Events],Extends:MWF.xApplication.process.Xform.ViewSelector,doResult:function(t){if("script"===this.json.result)return this.selectedData=t,this.json.selectedScript.code?this.form.Macro.exec(this.json.selectedScript.code,this):"";Object.each(this.json.selectedSetValues,function(e,i){var o="";t.each(function(t,i){for(var s=e.split("."),n=0;n<s.length;n++){var l=s[n];if(/(^[1-9]\d*$)/.test(l)&&(l=l.toInt()),!t[l]){t="";break}t=t[l]}"array"!==typeOf(t)&&"object"!==typeOf(t)||(t=JSON.stringify(t)),o=o?o+", "+t:t}.bind(this));var s=this.form.all[i];s&&(s.setData(o),o?s.descriptionNode&&s.descriptionNode.setStyle("display","none"):s.descriptionNode&&s.descriptionNode.setStyle("display","block"))}.bind(this))},selectView:function(t){var e=this.json.queryStatement;if(e){var i=null;this.json.filterList&&this.json.filterList.length&&(i=[],this.json.filterList.each(function(t){t.value=this.form.Macro.exec(t.code.code,this),i.push(t)}.bind(this)));var o={application:e.appName,statementName:e.name,statementId:e.id,isTitle:this.json.isTitle||"yes",select:this.json.select||"single",titleStyles:this.json.titleStyles,itemStyles:this.json.itemStyles,isExpand:this.json.isExpand||"no",showActionbar:"show"===this.json.actionbar,filter:i,defaultSelectedScript:this.json.defaultSelectedScript?this.json.defaultSelectedScript.code:null,selectedAbleScript:this.json.selectedAbleScript?this.json.selectedAbleScript.code:null},s={},n=this.json.DialogWidth||"850",l=this.json.DialogHeight||"700";if(layout.mobile){var c=document.body.getSize();n=c.x,l=c.y,s.style="viewmobile"}n=n.toInt(),l=l.toInt();var a=((c=this.form.app.content.getSize()).x-n)/2,r=(c.y-l)/2;a<0&&(a=0),r<0&&(r=0),layout.mobile&&(a=20,r=0);var d=this;MWF.require("MWF.xDesktop.Dialog",function(){var e=new MWF.xDesktop.Dialog({title:this.json.title||"select view",style:s.style||"view",top:r,left:a-20,fromTop:r,fromLeft:a-20,width:n,height:l,html:"",maskNode:layout.mobile?$(document.body):this.form.app.content,container:layout.mobile?$(document.body):this.form.app.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){t&&t(d.view.getData()),this.close()}},{text:MWF.LP.process.button.cancel,action:function(){this.close()}}],onPostShow:function(){layout.mobile&&e.node.setStyle("z-index",200),MWF.xDesktop.requireApp("query.Query","Statement",function(){this.view=new MWF.xApplication.query.Query.Statement(e.content,o,{style:"select"},this.form.app,this.form.Macro)}.bind(this))}.bind(this)});if(e.show(),layout.mobile){var i=e.node.getElement(".MWF_dialod_Action_back"),c=e.node.getElement(".MWF_dialod_Action_ok");i&&i.addEvent("click",function(t){e.close()}.bind(this)),c&&c.addEvent("click",function(i){t&&t(this.view.getData()),e.close()}.bind(this))}}.bind(this))}}});