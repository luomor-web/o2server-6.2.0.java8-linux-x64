MWF.xApplication.process=MWF.xApplication.process||{},MWF.xApplication.process.ApplicationExplorer=MWF.xApplication.process.ApplicationExplorer||{},MWF.xDesktop.requireApp("process.ApplicationExplorer","lp."+MWF.language,null,!1),MWF.xApplication.process.ApplicationExplorer.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",mvcStyle:"style.css",name:"process.ApplicationExplorer",icon:"icon.png",width:"1500",height:"760",isResize:!0,isMax:!0,title:MWF.xApplication.process.ApplicationExplorer.LP.title,maxWidth:840,minWidth:540},onQueryLoad:function(){this.lp=MWF.xApplication.process.ApplicationExplorer.LP,this.viewPath=this.path+this.options.style+"/view.html",this.restActions=MWF.Actions.get("x_processplatform_assemble_designer"),this.deleteElements=[]},loadApplication:function(t){this.loadControl(),this.content.loadHtml(this.viewPath,{bind:{lp:this.lp,control:this.control}},function(){this.options.isRefresh?this.loadApp(t):this.maxSize(function(){this.loadApp(t)}.bind(this))}.bind(this))},loadApp:function(t){this.loadNodes(),this.resizeContent(),this.addEvent("resize",this.resizeContent.bind(this)),this.loadApplicationCategoryList(),this.clickAllCategoryNode(),t&&t()},loadControl:function(){this.control={},this.control.canCreate=MWF.AC.isProcessPlatformCreator(),this.control.canManage=!(!MWF.AC.isAdministrator()&&!MWF.AC.isProcessManager())},loadNodes:function(){this.node=this.content.getElement(".o2_process_AppExp_content"),this.topNode=this.content.getElement(".o2_process_AppExp_top"),this.allCategoryNode=this.content.getElement(".o2_process_AppExp_All"),this.category=this.allCategoryNode,this.allCategoryNode&&this.allCategoryNode.addEvent("click",this.clickAllCategoryNode.bind(this)),this.createNode=this.content.getElement(".o2_process_AppExp_create"),this.createNode&&this.createNode.addEvent("click",this.createApplication.bind(this)),this.importNode=this.content.getElement(".o2_process_AppExp_import"),this.findNode=this.content.getElement(".o2_process_AppExp_find"),this.categoryAreaNode=this.content.getElement(".o2_process_AppExp_category"),this.contentArea=this.content.getElement(".o2_process_AppExp_contentArea"),this.contentNode=this.content.getElement(".o2_process_AppExp_contentNode"),this.bottomNode=this.content.getElement(".o2_process_AppExp_bottom"),this.importNode&&this.importNode.addEvent("click",function(t){this.importApplicationNew(t)}.bind(this)),this.findNode&&this.findNode.addEvent("click",function(t){this.openFindDesigner()}.bind(this))},openFindDesigner:function(){layout.openApplication(null,"FindDesigner",{filter:{moduleList:["processPlatform"]}})},importApplicationNew:function(t){MWF.xDesktop.requireApp("AppCenter","",function(){if(this.uploadFileAreaNode){this.fileUploadNode&&this.fileUploadNode.destroy(),this.uploadFileAreaNode.empty();t='<input name="file" type="file" accept=".xapp"/>';this.uploadFileAreaNode.set("html",t),this.fileUploadNode=this.uploadFileAreaNode.getFirst(),this.fileUploadNode.addEvent("change",this.importLocalFile.bind(this))}else{this.uploadFileAreaNode=new Element("div");var t='<input name="file" type="file" accept=".xapp"/>';this.uploadFileAreaNode.set("html",t),this.fileUploadNode=this.uploadFileAreaNode.getFirst(),this.fileUploadNode.addEvent("change",this.importLocalFile.bind(this))}this.fileUploadNode.click()}.bind(this))},importLocalFile:function(){var t=this.fileUploadNode.files;if(t.length){var e=t[0],i=this.topNode.getPosition(this.node),o=this.contentArea.getSize(),n=.9*o.x;n>600&&(n=600);var s=.9*o.y,p=(o.x-n)/2,a=(o.y-s)/2,c=null,r=new MWF.xApplication.AppCenter.Main;r.inBrowser=!0,r.load(!0),MWF.require("MWF.xDesktop.Dialog",function(){var t=new MWF.xDesktop.Dialog({title:this.lp.setupTitle,style:"appMarket",top:a+20,left:p,fromTop:i.y,fromLeft:i.x,width:n,height:s,html:"",maskNode:this.node,container:this.node,buttonList:[{text:r.lp.ok,action:function(){c&&c.setup(),this.close()}},{text:r.lp.cancel,action:function(){this.close()}}]});t.show(),c=new MWF.xApplication.AppCenter.Module.SetupLocal(e,t,r)}.bind(this))}},createApplication:function(){this.createApplicationCreateMarkNode(),this.createApplicationCreateAreaNode(),this.createApplicationCreateNode(),this.applicationCreateAreaNode.inject(this.applicationCreateMarkNode,"after"),this.applicationCreateAreaNode.fade("in"),$("createApplicationName").focus(),this.setApplicationCreateNodeSize(),this.setApplicationCreateNodeSizeFun=this.setApplicationCreateNodeSize.bind(this),this.addEvent("resize",this.setApplicationCreateNodeSizeFun)},createApplicationCreateMarkNode:function(){this.applicationCreateMarkNode=new Element("div.o2_process_AppExp_applicationCreateMarkNode",{events:{mouseover:function(t){t.stopPropagation()},mouseout:function(t){t.stopPropagation()}}}).inject(this.node,"after")},createApplicationCreateAreaNode:function(){this.applicationCreateAreaNode=new Element("div.o2_process_AppExp_applicationCreateAreaNode")},createApplicationCreateNode:function(){this.applicationCreateNode=new Element("div.o2_process_AppExp_applicationCreateNode").inject(this.applicationCreateAreaNode),this.applicationCreateNewNode=new Element("div.o2_process_AppExp_applicationCreateNewNode").inject(this.applicationCreateNode),this.applicationCreateFormNode=new Element("div.o2_process_AppExp_applicationCreateFormNode").inject(this.applicationCreateNode);var t='<table width="100%" height="80%" border="0" cellPadding="0" cellSpacing="0"><tr><td style="height: 30px; line-height: 30px; text-align: left; min-width: 80px; width:25%">'+this.lp.name+':</td><td style="; text-align: right;"><input type="text" class=\'o2_process_AppExp_createApplicationName\' id="createApplicationName" style="width: 99%; border:1px solid #999; background-color:#FFF; border-radius: 3px; box-shadow: 0px 0px 6px #CCC; height: 26px;"/></td></tr><tr><td style="height: 30px; line-height: 30px; text-align: left">'+this.lp.alias+':</td><td style="; text-align: right;"><input type="text" class=\'o2_process_AppExp_createApplicationAlias\' id="createApplicationAlias" style="width: 99%; border:1px solid #999; background-color:#FFF; border-radius: 3px; box-shadow: 0px 0px 6px #CCC; height: 26px;"/></td></tr><tr><td style="height: 30px; line-height: 30px;  text-align: left">'+this.lp.description+':</td><td style="; text-align: right;"><input type="text" class=\'o2_process_AppExp_createApplicationDescription\' id="createApplicationDescription" style="width: 99%; border:1px solid #999; background-color:#FFF; border-radius: 3px; box-shadow: 0px 0px 6px #CCC; height: 26px;"/></td></tr><tr><td style="height: 30px; line-height: 30px;  text-align: left">'+this.lp.type+':</td><td style="; text-align: right;"><input type="text" class=\'o2_process_AppExp_createApplicationType\' id="createApplicationType" style="width: 99%; border:1px solid #999; background-color:#FFF; border-radius: 3px; box-shadow: 0px 0px 6px #CCC; height: 26px;"/></td></tr></table>';this.applicationCreateFormNode.set("html",t),this.applicationCancelActionNode=new Element("div.o2_process_AppExp_applicationCreateCancelActionNode",{text:this.lp.action_cancel}).inject(this.applicationCreateFormNode),this.applicationCreateOkActionNode=new Element("div.o2_process_AppExp_applicationCreateOkActionNode",{text:this.lp.action_ok}).inject(this.applicationCreateFormNode),this.applicationCancelActionNode.addEvent("click",function(t){this.cancelCreateApplication(t)}.bind(this)),this.applicationCreateOkActionNode.addEvent("click",function(t){this.okCreateApplication(t)}.bind(this))},setApplicationCreateNodeSize:function(){var t=this.node.getSize(),e=this.content.getSize();this.applicationCreateMarkNode.setStyles({width:e.x+"px",height:e.y+"px"}),this.applicationCreateAreaNode.setStyles({width:t.x+"px",height:t.y+"px"});var i=.8*t.y,o=.2*t.y/2;this.applicationCreateNode.setStyles({height:i+"px","margin-top":o+"px"});var n=.7*i;n>250&&(n=250);var s=.3*i/2-this.applicationCreateNewNode.getSize().y;this.applicationCreateFormNode.setStyles({height:n+"px","margin-top":s+"px"})},cancelCreateApplication:function(t){var e=this,i=this.applicationCreateFormNode.getElement(".o2_process_AppExp_createApplicationName"),o=this.applicationCreateFormNode.getElement(".o2_process_AppExp_createApplicationAlias"),n=this.applicationCreateFormNode.getElement(".o2_process_AppExp_createApplicationDescription");i.get("value")||o.get("value")||n.get("value")?this.confirm("warn",t,this.lp.createApplication_cancel_title,this.lp.createApplication_cancel,320,100,(function(){e.applicationCreateMarkNode.destroy(),e.applicationCreateAreaNode.destroy(),this.close()}),(function(){this.close()})):(this.applicationCreateMarkNode.destroy(),this.applicationCreateAreaNode.destroy())},okCreateApplication:function(t){var e=this.applicationCreateFormNode.getElement(".o2_process_AppExp_createApplicationName"),i=this.applicationCreateFormNode.getElement(".o2_process_AppExp_createApplicationAlias"),o=this.applicationCreateFormNode.getElement(".o2_process_AppExp_createApplicationDescription"),n=this.applicationCreateFormNode.getElement(".o2_process_AppExp_createApplicationType"),s={name:e.get("value"),alias:i.get("value"),description:o.get("value"),applicationCategory:n.get("value")};s.name?this.restActions.saveApplication(s,function(t){this.applicationCreateMarkNode.destroy(),this.applicationCreateAreaNode.destroy(),this.restActions.getApplication(t.data.id,function(t){t.data.processList=[],t.data.formList=[],this.createApplicationItem(t.data,"top")}.bind(this)),this.reloadApplicationCategoryList(!0),this.notice(this.lp.application.createApplicationSuccess,"success")}.bind(this)):(e.setStyle("border-color","red"),e.focus(),this.notice(this.lp.application.inputApplicationName,"error"))},clickAllCategoryNode:function(){this.category&&(this.category.removeClass("o2_process_AppExp_categoryItem_current"),this.category.removeClass("o2_process_AppExp_All_current"),this.category.removeClass("o2_process_AppExp_categoryItem_over"),this.category.removeClass("o2_process_AppExp_All_over")),this.allCategoryNode.removeClass("o2_process_AppExp_categoryItem_over"),this.allCategoryNode.addClass("o2_process_AppExp_All_current"),this.category=this.allCategoryNode,this.loadApplicationList(this.allCategoryNode)},resizeContent:function(){var t=this.content.getSize(),e=this.topNode.getComputedSize(),i=this.bottomNode.getComputedSize(),o=this.contentArea.getStyle("padding-top").toInt()||0,n=this.contentArea.getStyle("padding-bottom").toInt()||0,s=t.y-e.totalHeight-i.totalHeight-o-n;this.contentArea.setStyle("height",s+"px"),this.getApplicationDimension(),this.contentNode&&this.contentNode.setStyles({"margin-left":this.dimension.marginLeft+"px","margin-right":this.dimension.marginRight+"px"})},createCategoryExpandButton:function(){this.categoryExpandButton=new Element("div.o2_process_AppExp_categoryExpandButton").inject(this.categoryAreaNode,"before"),this.categoryExpandButton.addEvent("click",this.expandOrCollapseCategory.bind(this))},expandOrCollapseCategory:function(t){this.categoryMorph||(this.categoryMorph=new Fx.Morph(this.categoryAreaNode,{duration:100})),this.categoryAreaNode.hasClass("o2_process_AppExp_category_more")?(this.categoryAreaNode.removeClass("o2_process_AppExp_category_more"),this.categoryMorph.start({height:this.topNode.getSize().y+"px"}),this.expandOrCollapseCategoryFun&&this.content.removeEvent("click",this.expandOrCollapseCategoryFun)):(this.categoryAreaNode.addClass("o2_process_AppExp_category_more"),this.categoryMorph.start({height:this.categoryAreaNode.getScrollSize().y+"px"}),this.expandOrCollapseCategoryFun=this.expandOrCollapseCategory.bind(this),this.content.addEvent("click",this.expandOrCollapseCategoryFun)),t.stopPropagation()},loadApplicationCategoryList:function(t,e){this.control.canCreate&&this.restActions.listApplicationCategory(function(i){if(i.data.each(function(t){var e=t.applicationCategory||t.portalCategory||t.protalCategory||t.name;"null"===e&&(e=""),e?this.createCategoryItemNode(e,t.count):t}.bind(this)),this.categoryAreaNode.getScrollSize().y>this.categoryAreaNode.getSize().y&&this.createCategoryExpandButton(),t){var o=this.categoryAreaNode.getElements("div.o2_process_AppExp_categoryItem");if(o.length>0)for(var n=0;n<o.length;n++)o[n].retrieve("categoryName")===t&&this.clickCategoryNode(o[n],e)}}.bind(this))},reloadApplicationCategoryList:function(t){var e="";this.category&&(e=this.category.retrieve("categoryName")||""),this.categoryAreaNode.empty(),this.loadApplicationCategoryList(e,t)},createCategoryItemNode:function(t,e){var i=t,o=new Element("div.o2_process_AppExp_categoryItem",{text:e?i+" ("+e+") ":i}).inject(this.categoryAreaNode);o.store("categoryName",i);var n=this;o.addEvents({mouseover:function(){n.category!=this&&this.addClass("o2_process_AppExp_categoryItem_over")},mouseout:function(){n.category!=this&&this.removeClass("o2_process_AppExp_categoryItem_over")},click:function(){n.clickCategoryNode(this)}})},clickCategoryNode:function(t,e){this.category&&(this.category.removeClass("o2_process_AppExp_categoryItem_current"),this.category.removeClass("o2_process_AppExp_All_current"),this.category.removeClass("o2_process_AppExp_categoryItem_over"),this.category.removeClass("o2_process_AppExp_All_over")),t.removeClass("o2_process_AppExp_categoryItem_over"),t.addClass("o2_process_AppExp_categoryItem_current");var i=t.getPosition(this.categoryAreaNode),o=this.topNode.getSize();i.y>=o.y&&t.inject(this.categoryAreaNode,"top"),this.category=t,e||this.loadApplicationList(t)},getApplicationDimension:function(){this.dimension||(this.dimension={}),this.dimension.count=2,this.dimension.width=this.options.maxWidth,this.dimension.marginLeft=40,this.dimension.marginRight=20;var t=this.content.getSize(),e=t.x-60;t.y>=this.contentArea.getScrollSize().y&&(e-=18);var i=(e/this.dimension.count).toInt();if(i<this.options.minWidth)this.dimension.count=1,this.dimension.width=Math.min(e,this.options.maxWidth)-2;else{for(;i>this.options.maxWidth;)if(this.dimension.count++,(i=(e/this.dimension.count).toInt())<this.options.minWidth){this.dimension.count--,i=this.options.maxWidth;break}this.dimension.width=i}var o=t.x-this.dimension.width*this.dimension.count;this.dimension.width=this.dimension.width-2*this.dimension.count,this.dimension.marginLeft=o/2,this.dimension.marginRight=o/2-20},loadApplicationList:function(t){var e="";t&&(e=t.retrieve("categoryName","")),this.restActions.listApplicationSummary(e,function(t){(this.contentNode.empty(),t.data.length)?(this.getApplicationDimension(),t.data.each(function(t){this.createApplicationItem(t)}.bind(this))):this.control.canCreate?new Element("div.o2_process_AppExp_noApplicationNode",{html:this.lp.noApplicationCreate}).inject(this.contentNode).addEvent("click",function(){this.createApplication()}.bind(this)):new Element("div.o2_process_AppExp_noApplicationNode",{text:this.lp.noApplication}).inject(this.contentNode)}.bind(this))},createApplicationItem:function(t,e){new MWF.xApplication.process.ApplicationExplorer.Application(this,t,e).load()},checkDeleteApplication:function(){this.deleteElements.length?this.deleteElementsNode||(this.deleteElementsNode=new Element("div.o2_process_AppExp_deleteElements",{text:this.lp.application.deleteElements}).inject(this.node),this.deleteElementsNode.position({relativeTo:this.contentArea,position:"centerTop",edge:"centerTop"}),this.deleteElementsNode.addEvent("click",function(t){this.deleteSelectedElements(t)}.bind(this))):this.deleteElementsNode&&(this.deleteElementsNode.destroy(),this.deleteElementsNode=null,delete this.deleteElementsNode)},deleteSelectedElements:function(t){var e=this,i=[];this.deleteElements.each((function(t){i.push(t.data.name)}));var o=this.lp.application.deleteElementsConfirm+" ("+i.join("、")+") ",n='<br/><br/><input type="checkbox" id="deleteApplicationAllCheckbox" value="yes">'+this.lp.application.deleteApplicationAllConfirm;o+=n,this.confirm("infor",t,this.lp.application.deleteElementsTitle,{html:o},530,250,(function(){o=e.lp.application.deleteElementsConfirmAgain+"<br/><br/><font style='color:red; font-size:14px; font-weight: bold'>"+i.join("、")+"</font>";var n=this.content.getElement("#deleteApplicationAllCheckbox"),s=!0;n.checked&&(s=!1,o=e.lp.application.deleteElementsAllConfirmAgain+"<br/><br/><font style='color:red; font-size:14px; font-weight: bold'>"+i.join("、")+"</font>"),this.close(),e.confirm("infor",t,e.lp.application.deleteElementsTitle,{html:o},500,200,(function(){var t=[],i=0,o=e.deleteElements.length,n="",p=function(){i==o&&(e.reloadApplicationCategoryList(!0),n&&e.app.notice(n,"error"))};e.deleteElements.each((function(o){o.delete(s,(function(){t.push(o),i++,e.deleteElements.length==i&&(e.deleteElements=e.deleteElements.filter((function(e,i){return!t.contains(e)})),e.checkDeleteApplication()),p()}),(function(o){n=n?n+"<br/><br/>"+o:o,i++,e.deleteElements.length==i&&(e.deleteElements=e.deleteElements.filter((function(e,i){return!t.contains(e)})),e.checkDeleteApplication()),p()}))})),this.close()}),(function(){this.close()})),this.close()}),(function(){this.close()}))},createAppCenterApp:function(t){var e=this.content.getSize(),i=new Element("div",{styles:{width:e.x+"px",height:e.y+"px",position:"absolute",top:"0px"}}).inject(this.content,"after"),o=new new Class({Implements:[Events]});o.lp=MWF.xApplication.AppCenter.LP,o.css=MWF.xApplication.AppCenter.LP,o.actions=MWF.Actions.get("x_program_center"),o.curAppId=t,o.createApplicationNode=i,o.content=i,o.notice=this.notice,o.path="../x_component_AppCenter/$Main/",o.options={style:"default"},o.cssPath=o.path+o.options.style+"/css.wcss",o2.JSON.get(o.cssPath,(function(t){o.css=t}),!1),o.addEvent("exporterClose",(function(){this.content.hide()})),this.appCenterApp=o}}),MWF.xApplication.process.ApplicationExplorer.Application=new Class({Implements:[Events],initialize:function(t,e,i){this.app=t,this.lp=this.app.lp,this.dimension=this.app.dimension,this.container=this.app.contentNode,this.data=e,this.where=i||"bottom",this.canManage=this.checkManage()},checkManage:function(){return!!this.app.control.canManage||!(!this.app.control.canCreate||this.data.creatorPerson!=layout.desktop.session.user.name)},load:function(){this.node=new Element("div.o2_process_AppExp_item_node").inject(this.container,this.where);var t=this.dimension.width-20;this.node.setStyle("width",t+"px"),this.node.loadHtml(this.app.path+this.app.options.style+"/application.html",{bind:{lp:this.lp,data:this.data,canManage:this.canManage}},function(){this.loadNodes(),this.loadElements(),this.loadNewNode()}.bind(this)),this.resizeContentFun=this.resizeContent.bind(this),this.app.addEvent("resize",this.resizeContentFun)},loadElements:function(){this.loadElementList("formList",this.formListNode,this.openForm.bind(this),this.lp.noForm,this.createNewForm.bind(this)),this.loadElementList("processList",this.processListNode,this.openProcess.bind(this),this.lp.noProcess,this.createNewProcess.bind(this))},loadNewNode:function(){if(this.newNode=this.node.getElement(".o2_process_AppExp_item_newNode"),this.data.updateTime){var t=Date.parse(this.data.createTime),e=new Date;t.diff(e,"hour")<12?this.newNode.show():this.newNode.hide()}},loadElementList:function(t,e,i,o,n){this.data[t].length?this.data[t].each(function(t){var o=new Element("div.o2_process_AppExp_item_content_element").inject(e);o.set("text",t.name),o.store("elementId",t.id),o.addEvents({mouseover:function(){this.addClass("o2_process_AppExp_item_content_element_over")},mouseout:function(){this.removeClass("o2_process_AppExp_item_content_element_over")},click:function(t){var e=this.retrieve("elementId");i&&i(e,t)}})}.bind(this)):new Element("div.o2_process_AppExp_item_content_element",{text:o,styles:{color:"#999999"}}).inject(e).addEvent("click",function(t){n&&n(t)}.bind(this))},createNewForm:function(t){this.openApplication(t,0)},createNewProcess:function(t){this.openApplication(t,1)},openApplication:function(t,e){var i="process.ProcessManager"+this.data.id;this.app.desktop.apps[i]?this.app.desktop.apps[i].setCurrent():this.app.desktop.openApplication(t,"process.ProcessManager",{application:this.data,appId:i,onQueryLoad:function(){this.status={navi:e||null}}})},openForm:function(t,e){t&&layout.desktop.getFormDesignerStyle(function(){var i=this,o={style:layout.desktop.formDesignerStyle,appId:"process.FormDesigner"+t,onQueryLoad:function(){this.actions=i.app.actions,this.options.id=t,this.application=i.data}};this.app.desktop.openApplication(e,"process.FormDesigner",o)}.bind(this))},openProcess:function(t,e){if(t){var i=this,o={appId:"process.ProcessDesigner"+t,onQueryLoad:function(){this.actions=i.app.actions,this.options.id=t,this.application=i.data}};this.app.desktop.openApplication(e,"process.ProcessDesigner",o)}},setIconNode:function(){this.data.icon?this.iconNode.setStyle("background-image","url(data:image/png;base64,"+this.data.icon+")"):this.iconNode.setStyle("background-image","url(../x_component_process_ApplicationExplorer/$Main/default/icon/application.png)"),this.iconNode.makeLnk({par:this._getLnkPar()})},_getLnkPar:function(){var t="../x_component_process_ApplicationExplorer/$Main/default/lnk.png";this.data.icon&&(t="data:image/png;base64,"+this.data.icon);var e="process.ProcessManager"+this.data.id;return{icon:t,title:this.data.name,par:'process.ProcessManager#{"application": "'+this.data.id+'", "appId": "'+e+'"}'}},loadNodes:function(){this.iconNode=this.node.getElement(".o2_process_AppExp_item_icon"),this.setIconNode(),this.titleNode=this.node.getElement(".o2_process_AppExp_item_titleNode"),this.formListNode=this.node.getElement(".o2_process_AppExp_item_contentFormList"),this.processListNode=this.node.getElement(".o2_process_AppExp_item_contentProcessList"),this.pageListNode=this.node.getElement(".o2_process_AppExp_item_contentPageList"),this.viewListNode=this.node.getElement(".o2_process_AppExp_item_contentViewList"),this.statListNode=this.node.getElement(".o2_process_AppExp_item_contentStatList"),this.titleNode.addEvent("click",function(t){this.openApplication(t)}.bind(this)),this.categoryNode=this.node.getElement(".o2_process_AppExp_item_categoryNode");var t=this.data.applicationCategory||this.data.portalCategory||this.data.protalCategory,e=t;t&&"null"!==t||(e=this.lp.unCategory),this.categoryNode.set("text",e),t&&"null"!==t&&(this.categoryNode.set("title",t),this.categoryNode.addClass("o2_process_AppExp_item_categoryColorNode")),this.actionArea=this.node.getElement(".o2_process_AppExp_item_ActionArea"),this.actionDelete=this.node.getElement(".o2_process_AppExp_item_Action_delete"),this.actionExport=this.node.getElement(".o2_process_AppExp_item_Action_export"),this.actionArea&&this.setActionEvent()},setActionEvent:function(){this.node.addEvents({mouseover:function(){this.readyDelete||this.actionArea.fade("in"),this.node.addClass("o2_process_AppExp_item_node_over")}.bind(this),mouseout:function(){this.readyDelete||this.actionArea.fade("out"),this.node.removeClass("o2_process_AppExp_item_node_over")}.bind(this)}),this.actionDelete.addEvent("click",function(t){this.checkDeleteApplication(t),t.stopPropagation()}.bind(this)),this.actionExport.addEvent("click",function(t){MWF.xDesktop.requireApp("AppCenter","",function(){this.app.appCenterApp||this.app.createAppCenterApp(this.data.id),this.app.appCenterApp.curAppId=this.data.id,this.app.appCenterApp.content.show(),new MWF.xApplication.AppCenter.Exporter(this.app.appCenterApp)}.bind(this)),t.stopPropagation()}.bind(this))},checkDeleteApplication:function(t){this.readyDelete?(this.actionDelete.removeClass("o2_process_AppExp_item_Action_delete_select"),this.node.removeClass("o2_process_AppExp_item_node_del"),this.readyDelete=!1,this.app.deleteElements.erase(this)):(this.actionDelete.addClass("o2_process_AppExp_item_Action_delete_select"),this.node.addClass("o2_process_AppExp_item_node_del"),this.readyDelete=!0,this.app.deleteElements.push(this)),this.app.checkDeleteApplication()},exportApplication:function(){MWF.xDesktop.requireApp("process.ApplicationExplorer","Exporter",function(){new MWF.xApplication.process.ApplicationExplorer.Exporter(this.app,this.data).load()}.bind(this))},resizeContent:function(){var t=this.dimension.width-20;this.node.setStyle("width",t+"px")},delete:function(t,e,i){this._deleteElement(this.data.id,t,function(){this.destroy(),e&&e()}.bind(this),function(t,e,o){var n=o;t&&(n=t.responseText),i&&i(n)}.bind(this))},_deleteElement:function(t,e,i,o){this.app.restActions.deleteApplication(t,e,i,o)},destroy:function(){this.resizeContentFun&&this.app.removeEvent("resize",this.resizeContentFun),this.node.destroy(),o2.release(this)}});