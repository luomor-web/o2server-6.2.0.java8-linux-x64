MWF.xDesktop.requireApp("Template","MForm",null,!1),MWF.require("MWF.widget.ImageClipper",null,!1),MWF.xApplication.MinderEditor.HyperLinkForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"report",width:700,height:"300",hasTop:!0,hasIcon:!1,draggable:!0,title:"链接"},_createTableContent:function(){this.formTableArea.set("html","<table width='100%' bordr='0' cellpadding='7' cellspacing='0' styles='formTable' style='margin-top: 20px; '><tr><td styles='formTableTitle' lable='url' width='20%'></td>    <td styles='formTableValue14' item='url' colspan='3'></td></tr><tr><td styles='formTableTitle' lable='title'></td>    <td styles='formTableValue14' item='title' colspan='3'></td></tr></table>");var t=this.app.minder.queryCommandValue("HyperLink");this.form=new MForm(this.formTableArea,t,{isEdited:!0,style:"report",hasColon:!0,itemTemplate:{url:{text:"链接地址",notEmpty:!0,validRule:{isInvalid:function(t,e){return new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i").test(t)}.bind(this)},validMessage:{isInvalid:"请输入正确的链接"},attr:{placeholder:"必填：以 http(s):// 或 ftp:// 开头"}},title:{text:"提示文本",attr:{placeholder:"选填：鼠标在链接上悬停时提示的文本"}}}},this.app),this.form.load()},_createBottomContent:function(){(this.isNew||this.isEdited)&&(this.okActionNode=new Element("button.inputOkButton",{styles:this.css.inputOkButton,text:"确定"}).inject(this.formBottomNode),this.okActionNode.addEvent("click",function(t){this.save(t)}.bind(this))),this.removeAction=new Element("button.inputCancelButton",{styles:this.css.inputCancelButton,text:"删除链接"}).inject(this.formBottomNode),this.removeAction.addEvent("click",function(t){this.remove(t)}.bind(this)),this.cancelActionNode=new Element("button.inputCancelButton",{styles:this.isEdited||this.isNew||this.getEditPermission()?this.css.inputCancelButton:this.css.inputCancelButton_long,text:"关闭"}).inject(this.formBottomNode),this.cancelActionNode.addEvent("click",function(t){this.close(t)}.bind(this))},save:function(){var t=this.form.getResult(!0,null,!0,!1,!0);t&&(this.app.minder.execCommand("HyperLink",t.url,t.title||""),this.close())},remove:function(t){this.app.minder.execCommand("HyperLink",null),this.close()}}),MWF.xApplication.MinderEditor.NoteForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"report",width:300,height:"100%",right:0,hasTop:!0,hasIcon:!1,hasMask:!1,hasBottom:!1,draggable:!0,resizeable:!0,maxAction:!0,title:"备注"},_createTableContent:function(){this.formTableContainer.setStyle("width","100%"),this.formTableArea.setStyle("height","100%");this.formTableArea.set("html","<div item='content' style='height: 100%;'></div>"),MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.formTableArea,{},{style:"report",isEdited:!0,itemTemplate:{content:{type:"rtf",RTFConfig:{resize_enabled:!1,toolbar:[{name:"document",items:["Preview"]},{name:"basicstyles",items:["Bold","Italic","Underline","Strike","-","RemoveFormat"]},{name:"styles",items:["Styles","Format","Font","FontSize"]},{name:"colors",items:["TextColor","BGColor"]},{name:"links",items:["Link","Unlink"]},{name:"tools",items:["Maximize","-","About"]}]}}}},this.app),this.form.load()}.bind(this),!0)},_setNodesSize:function(t,e,i,o){this.form.getItem("content").editor.resize(null,o)}});