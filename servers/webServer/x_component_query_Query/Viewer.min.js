MWF.xApplication.query=MWF.xApplication.query||{},MWF.xApplication.query.Query=MWF.xApplication.query.Query||{},MWF.require("MWF.widget.Common",null,!1),MWF.require("o2.widget.Paging",null,!1),MWF.require("MWF.xScript.Macro",null,!1),MWF.xDesktop.requireApp("query.Query","lp."+o2.language,null,!1),MWF.xApplication.query.Query.Viewer=MWF.QViewer=new Class({Implements:[Options,Events],Extends:MWF.widget.Common,options:{style:"default",skin:null,resizeNode:!0,paging:"scroll",perPageCount:50,isload:"true",export:!1,moduleEvents:["queryLoad","postLoad","postLoadPageData","postLoadPage","selectRow","unselectRow","queryLoadItemRow","postLoadItemRow","queryLoadCategoryRow","postLoadCategoryRow"]},initialize:function(e,t,i,s,o){this.setOptions(i),this.path="../x_component_query_Query/$Viewer/",this.cssPath="../x_component_query_Query/$Viewer/"+this.options.style+"/css.wcss",this._loadCss(),this.lp=MWF.xApplication.query.Query.LP,this.app=s,this.container=$(e),this.json=t,this.parentMacro=o,this.originalJson=Object.clone(t),this.viewJson=null,this.filterItems=[],this.searchStatus="none",this.items=[],this.selectedItems=[],this.hideColumns=[],this.openColumns=[],this.gridJson=null,this.options.isload&&this.init(function(){this.load()}.bind(this))},loadView:function(){this.viewJson?this.reload():this.init(function(){this.load()}.bind(this))},init:function(e){this.json.data?(this.viewJson=JSON.decode(this.json.data),e&&e()):this.getView(e)},load:function(){this.loadMacro(function(){this._loadModuleEvents(),this.fireEvent("queryLoad")&&(this._loadUserInterface(),this._loadDomEvents())}.bind(this))},_loadUserInterface:function(){this.loadLayout(),this.createActionbarNode(),this.createSearchNode(),this.createViewNode({filterList:this.json.filter?this.json.filter.clone():null}),this.options.resizeNode&&(this.setContentHeightFun=this.setContentHeight.bind(this),this.container.addEvent("resize",this.setContentHeightFun),this.setContentHeightFun())},loadLayout:function(){this.node=new Element("div",{styles:this.css.node}).inject(this.container),this.actionbarAreaNode=new Element("div.actionbarAreaNode",{styles:this.css.actionbarAreaNode}).inject(this.node),this.searchAreaNode=new Element("div",{styles:this.css.searchAreaNode}).inject(this.node),this.viewAreaNode=new Element("div",{styles:this.css.viewAreaNode}).inject(this.node),this.viewPageAreaNode=new Element("div",{styles:this.css.viewPageAreaNode}).inject(this.node)},loadMacro:function(e){MWF.require("MWF.xScript.Macro",function(){this.Macro=new MWF.Macro.ViewContext(this),e&&e()}.bind(this))},createExportNode:function(){this.options.export&&MWF.require("MWF.widget.Toolbar",function(){this.toolbar=new MWF.widget.Toolbar(this.actionbarAreaNode,{style:"simple"},this);new Element("div",{id:"",MWFnodetype:"MWFToolBarButton",MWFButtonImage:this.path+""+this.options.style+"/icon/export.png",title:this.lp.exportExcel,MWFButtonAction:"exportView",MWFButtonText:this.lp.exportExcel}).inject(this.actionbarAreaNode);this.toolbar.load()}.bind(this))},exportView:function(){var e=this,t=this.lp.viewExport,i=this.exportExcelDlgNode=new Element("div"),s='<div style="line-height: 30px; height: 30px; color: #333333; overflow: hidden;margin-top:20px;">'+t.exportRange+"ï¼š   <input class='start' value='"+(this.exportExcelStart||1)+"'><span>"+t.to+"</span>   <input class='end' value='"+(this.exportExcelEnd||Math.min((this.bundleItems||[]).length,2e3))+"' ><span>"+t.item+"</span></div>";s+='<div style="clear:both; max-height: 300px; margin-bottom:10px; margin-top:10px; overflow-y:auto;">'+t.description.replace("{count}",(this.bundleItems||[]).length)+"</div>",i.set("html",s);var o=function(){1==this.value.length?this.value=this.value.replace(/[^1-9]/g,""):this.value=this.value.replace(/\D/g,""),this.value.toInt()>e.bundleItems.length&&(this.value=e.bundleItems.length)};i.getElement(".start").addEvent("keyup",(function(){o.call(this)})),i.getElement(".end").addEvent("keyup",(function(){o.call(this)}));var n=o2.DL.open({title:this.lp.exportExcel,style:"user",isResize:!1,content:i,width:600,height:260,buttonList:[{type:"ok",text:MWF.LP.process.button.ok,action:function(e,s){var o=i.getElement(".start").get("value"),l=i.getElement(".end").get("value");if(!o||!l)return MWF.xDesktop.notice("error",{x:"left",y:"top"},t.inputIntegerNotice,i,{x:0,y:85}),!1;if(o=o.toInt(),(l=l.toInt())<o)return MWF.xDesktop.notice("error",{x:"left",y:"top"},t.startLargetThanEndNotice,i,{x:0,y:85}),!1;this.exportExcelStart=o,this.exportExcelEnd=l;var a=this.bundleItems.slice(o-1,l),h=this.json.name+"("+o+"-"+l+").xlsx";this._exportView(a,h),n.close()}.bind(this)},{type:"cancel",text:MWF.LP.process.button.cancel,action:function(){n.close()}}]})},_exportView:function(e,t){var i=MWF.Actions.get("x_query_assemble_surface"),s=this.json.filter?this.json.filter.clone():[];this.filterItems.length&&this.filterItems.each(function(e){s.push(e.data)}.bind(this));var o={filterList:s};e&&(o.bundleList=e),t&&(o.excelName=t),o.key=this.bundleKey,i.exportViewWithQuery(this.json.viewName,this.json.application,o,function(e){var t=i.action.actions.getViewExcel.uri;t=t.replace("{flag}",e.data.id),t=o2.filterUrl(i.action.address+t);var s=new Element("a",{href:t,target:"_blank"});s.click(),s.destroy()}.bind(this))},setContentHeight:function(){var e=this.node.getSize(),t=this.searchAreaNode.getComputedSize(),i=e.y-t.totalHeight;this.actionbarAreaNode&&(i-=this.actionbarAreaNode.getComputedSize().totalHeight);i-=this.viewPageAreaNode.getComputedSize().totalHeight,this.viewAreaNode.setStyle("height",i+"px")},createLoadding:function(){this.loadingAreaNode=new Element("div",{styles:this.css.viewLoadingAreaNode}).inject(this.contentAreaNode),new Element("div",{styles:{height:"5px"}}).inject(this.loadingAreaNode);var e=new Element("div",{styles:this.css.viewLoadingNode}).inject(this.loadingAreaNode);new Element("div",{styles:this.css.viewLoadingIconNode}).inject(e),new Element("div",{styles:this.css.viewLoadingTextNode}).inject(e).set("text","loading...")},createActionbarNode:function(){if(this.actionbarAreaNode.empty(),"boolean"!==typeOf(this.json.showActionbar)||!0===this.json.showActionbar)if("boolean"===typeOf(this.viewJson.actionbarHidden)){if(!0===this.viewJson.actionbarHidden||!this.viewJson.actionbarList||!this.viewJson.actionbarList.length)return;this.actionbar=new MWF.xApplication.query.Query.Viewer.Actionbar(this.actionbarAreaNode,this.viewJson.actionbarList[0],this,{}),this.actionbar.load()}else this.createExportNode()},createViewNode:function(e,t){this.viewAreaNode.empty(),this.selectedItems=[];var i=this.viewJson.viewStyles;this.contentAreaNode=new Element("div",{styles:i&&i.container?i.container:this.css.contentAreaNode}).inject(this.viewAreaNode),this.viewTable=new Element("table",{styles:this.css.viewTitleTableNode,border:"0px",cellPadding:"0",cellSpacing:"0"}).inject(this.contentAreaNode),i&&(i.tableProperties&&this.viewTable.set(i.tableProperties),i.table&&this.viewTable.setStyles(i.table)),this.createLoadding();var s=i&&i.titleTd?i.titleTd:this.css.viewTitleCellNode;"no"!==this.json.isTitle?(this.viewTitleLine=new Element("tr",{styles:i&&i.titleTr?i.titleTr:this.css.viewTitleLineNode}).inject(this.viewTable),this.selectTitleCell=new Element("td.selectTitleCell",{styles:s}).inject(this.viewTitleLine),this.selectTitleCell.setStyle("width","10px"),this.json.titleStyles&&this.selectTitleCell.setStyles(this.json.titleStyles),this.isSelectTdHidden()&&this.selectTitleCell.hide(),"multi"===this.getSelectFlag(!0)&&this.viewJson.allowSelectAll||(this.expandTitleCell=this.selectTitleCell),"yes"===this.viewJson.isSequence&&(this.sequenceTitleCell=new Element("td",{styles:s}).inject(this.viewTitleLine),this.sequenceTitleCell.setStyle("width","10px"),this.json.titleStyles&&this.sequenceTitleCell.setStyles(this.json.titleStyles),this.expandTitleCell||(this.expandTitleCell=this.sequenceTitleCell)),this.entries={},this.viewJson.selectList.each(function(e){if(this.entries[e.column]=e,e.hideColumn)this.hideColumns.push(e.column);else{var t=new Element("td",{styles:s,text:e.displayName}).inject(this.viewTitleLine),i=MWF.getTextSize(e.displayName,s);if(t.setStyle("min-width",i.x+"px"),this.json.titleStyles&&t.setStyles(this.json.titleStyles),e.groupEntry&&!this.expandTitleCell&&(this.expandTitleCell=t),"object"===typeOf(e.titleStyles)&&t.setStyles(e.titleStyles),"object"===typeOf(e.titleProperties)&&t.setProperties(e.titleProperties),e.events&&e.events.loadTitle&&e.events.loadTitle.code){var o=e.events.loadTitle.code;this.Macro.fire(o,{node:t,json:e,data:e.displayName,view:this})}}e.allowOpen&&this.openColumns.push(e.column)}.bind(this)),this.lookup(e,t)):(this.entries={},this.viewJson.selectList.each(function(e){this.entries[e.column]=e,e.hideColumn&&this.hideColumns.push(e.column),e.allowOpen||this.openColumns.push(e.column)}.bind(this)),this.lookup(e,t))},getExpandFlag:function(){return this.options&&this.options.isExpand?this.options.isExpand:this.json&&this.json.isExpand?this.json.isExpand:this.viewJson&&this.viewJson.isExpand?this.viewJson.isExpand:"no"},getSelectFlag:function(e){return e||this.viewSelectedEnable?this.options&&this.options.select?this.options.select:this.json&&this.json.select?this.json.select:this.viewJson&&this.viewJson.select?this.viewJson.select:"none":"none"},isSelectTdHidden:function(){return!!this.viewJson.firstTdHidden&&((!this.viewJson.group||!this.viewJson.group.column)&&(!this.json.defaultSelectedScript&&!this.viewJson.defaultSelectedScript&&(this.options&&this.options.select?"none"===this.options.select||"no"===this.options.select:this.json&&this.json.select?"none"===this.json.select||"no"===this.json.select:!this.viewJson||!this.viewJson.select||("none"===this.viewJson.select||"no"===this.viewJson.select))))},_loadPageNode:function(){var e;(this.viewPageAreaNode.empty(),this.paging)?this.paging.reload():(e=this.viewJson.pagingList&&this.viewJson.pagingList.length?this.viewJson.pagingList[0]:{firstPageText:this.lp.firstPage,lastPageText:this.lp.lastPage},this.paging=new MWF.xApplication.query.Query.Viewer.Paging(this.viewPageAreaNode,e,this,{}),this.paging.load())},_initPage:function(){this.count=this.bundleItems.length;var e=this.count/this.json.pageSize;this.pages=e.toInt()<e?e.toInt()+1:e,this.currentPage=this.options.defaultPage||1,this.options.defaultPage=null,this.exportExcelStart=null,this.exportExcelEnd=null},lookup:function(e,t){this.lookuping||(this.lookuping=!0,this.getLookupAction(function(){if(this.json.application){var i=e||{};i.count=this.json.count,this.lookupAction.bundleView(this.json.id,i,function(e){if(this.bundleItems=e.data.valueList,this.bundleKey=e.data.key,this._initPage(),this.bundleItems.length)this.noDataTextNode&&this.noDataTextNode.destroy(),this.loadCurrentPageData(function(){this.fireEvent("postLoad"),this.lookuping=!1,t&&t(this)}.bind(this));else{if(this.viewPageAreaNode.empty(),this.viewJson.noDataText){var i=this.css.noDataTextNode;this.viewJson.viewStyles&&this.viewJson.viewStyles.noDataTextNode&&(i=this.viewJson.viewStyles.noDataTextNode),this.noDataTextNode=new Element("div",{styles:i,text:this.viewJson.noDataText}).inject(this.contentAreaNode)}this.loadingAreaNode&&(this.loadingAreaNode.destroy(),this.loadingAreaNode=null),this.fireEvent("postLoad"),this.lookuping=!1,t&&t(this)}}.bind(this))}}.bind(this)))},loadCurrentPageData:function(e,t){if(!this.pageloading){this.pageloading=!0,this.items=[];var i=this.currentPage,s={},o=this.bundleItems.slice((i-1)*this.json.pageSize,this.json.pageSize*i);for(s.bundleList=o,s.key=this.bundleKey;this.viewTable.rows.length>1;)this.viewTable.deleteRow(-1);this.loadViewRes=this.lookupAction.loadView(this.json.name,this.json.application,s,function(t){this.viewData=t.data,this.fireEvent("postLoadPageData"),this.viewJson.group.column?(this.gridJson=t.data.groupGrid,this.setSelectedableFlag(),this.loadGroupData()):(this.gridJson=t.data.grid,this.setSelectedableFlag(),this.loadData()),this.gridJson.length&&this._loadPageNode(),this.loadingAreaNode&&(this.loadingAreaNode.destroy(),this.loadingAreaNode=null),this.pageloading=!1,this.fireEvent("loadView"),this.fireEvent("postLoadPage"),e&&e()}.bind(this),null,!1!==t)}},setSelectedableFlag:function(){this.viewSelectedEnable=!1;var e=this.json.selectedAbleScript||this.viewJson.selectedAbleScript;this.viewJson.group.column?this.gridJson.each(function(t){t.list.each(function(i){i.$selectedEnable=!e||this.Macro.exec(e,{data:i,groupData:t,view:this}),i.$selectedEnable&&(t.$selectedEnable=!0,this.viewSelectedEnable=!0)}.bind(this))}.bind(this)):this.gridJson.each(function(t){t.$selectedEnable=!e||this.Macro.exec(e,{data:t,view:this}),t.$selectedEnable&&(this.viewSelectedEnable=!0)}.bind(this))},getMode:function(){return this.viewJson.group.column?"group":"item"},createSelectAllNode:function(){"multi"===this.getSelectFlag()&&this.viewJson.allowSelectAll&&this.selectTitleCell&&!this.selectTitleCell.retrieve("selectAllLoaded")&&(this.viewJson.viewStyles&&this.viewJson.viewStyles.checkboxNode?(this.selectAllNode=this.selectTitleCell,this.selectAllNode.setStyles(this.viewJson.viewStyles.checkboxNode)):this.selectAllNode.html("<img src='../x_component_query_Query/$Viewer/"+this.options.style+"/icon/checkbox.png'/></span>"),this.selectTitleCell.setStyle("cursor","pointer"),this.selectTitleCell.addEvent("click",function(){"all"===this.getSelectAllStatus()?this.unSelectAll("view"):this.selectAll("view")}.bind(this)),this.selectTitleCell.store("selectAllLoaded",!0))},loadData:function(){"multi"===this.getSelectFlag()&&this.viewJson.allowSelectAll?this.selectTitleCell&&this.selectTitleCell.retrieve("selectAllLoaded")?this.setUnSelectAllStyle():this.createSelectAllNode():this.selectAllNode&&this.clearSelectAllStyle(),this.gridJson.length?this.gridJson.each(function(e,t){this.items.push(new MWF.xApplication.query.Query.Viewer.Item(this,e,null,t))}.bind(this)):this.viewPageAreaNode&&this.viewPageAreaNode.empty()},loadPaging:function(){this.isItemsLoading=!1,this.pageNumber=0,this.isItemsLoaded=!1,this.isSetedScroll=!1,this.setScroll(),this.loadDataByPaging()},setScroll:function(){this.options.paging&&!this.isSetedScroll&&(this.contentAreaNode.setStyle("overflow","auto"),this.scrollContainerFun=function(){var e=this.contentAreaNode.getScrollSize(),t=this.contentAreaNode.getSize(),i=e.y-t.y;this.contentAreaNode.scrollTop+150>i&&(this.isItemsLoaded||this.loadDataByPaging())}.bind(this),this.isSetedScroll=!0,this.contentAreaNode.addEvent("scroll",this.scrollContainerFun))},loadDataByPaging:function(){if(!this.isItemsLoading&&!this.isItemsLoaded){var e=Math.min(this.pageNumber*this.options.perPageCount,this.gridJson.length),t=Math.min((this.pageNumber+1)*this.options.perPageCount+1,this.gridJson.length);this.isItemsLoading=!0;for(var i=e;i<t;i++)this.items.push(new MWF.xApplication.query.Query.Viewer.Item(this,this.gridJson[i],null,i));this.isItemsLoading=!1,this.pageNumber++,t==this.gridJson.length&&(this.isItemsLoaded=!0)}},loadGroupData:function(){if("multi"===this.getSelectFlag()&&this.viewJson.allowSelectAll?this.selectTitleCell&&this.selectTitleCell.retrieve("selectAllLoaded")?this.setUnSelectAllStyle():this.createSelectAllNode():this.selectAllNode&&this.clearSelectAllStyle(),this.expandTitleCell&&(this.expandTitleCell.retrieve("expandLoaded")?"yes"!==this.getExpandFlag()&&this.setCollapseAllStyle():(this.viewJson.viewStyles&&this.viewJson.viewStyles.groupCollapseNode?this.expandAllNode=new Element("span",{styles:this.viewJson.viewStyles.groupCollapseNode}).inject(this.expandTitleCell,"top"):this.expandAllNode=new Element("span",{html:"<img src='../x_component_query_Query/$Viewer/"+this.options.style+"/icon/expand.png'/></span>",style:"font-family: Webdings"}).inject(this.expandTitleCell,"top"),this.expandTitleCell.setStyle("cursor","pointer"),this.expandTitleCell.addEvent("click",this.expandOrCollapseAll.bind(this)),this.expandTitleCell.store("expandLoaded",!0))),this.gridJson.length){var e=0;this.gridJson.each(function(t){this.items.push(new MWF.xApplication.query.Query.Viewer.ItemCategory(this,t,e)),e+=t.list.length}.bind(this)),"yes"==this.getExpandFlag()&&this.expandOrCollapseAll()}else this.viewPageAreaNode&&this.viewPageAreaNode.empty()},getView:function(e){this.getLookupAction(function(){this.json.application?this.getViewRes=this.lookupAction.getView(this.json.viewName,this.json.application,function(t){this.viewJson=JSON.decode(t.data.data),this.json=Object.merge(this.json,t.data),e&&e()}.bind(this)):this.getViewRes=this.lookupAction.getViewById(this.json.viewId,function(t){this.viewJson=JSON.decode(t.data.data),this.json.application=t.data.query,this.json=Object.merge(this.json,t.data),e&&e()}.bind(this))}.bind(this))},getLookupAction:function(e){this.lookupAction||(this.lookupAction=MWF.Actions.get("x_query_assemble_surface")),e&&e()},hide:function(){this.node.setStyle("display","none")},reload:function(){this.lookuping||this.pageloading||(this.node.setStyle("display","block"),this.loadingAreaNode&&this.loadingAreaNode.setStyle("display","block"),this.filterItems.each(function(e){e.destroy()}.bind(this)),this.filterItems=[],this.viewSearchInputNode&&this.viewSearchInputNode.set("text",this.lp.searchKeywork),this.closeCustomSearch(),this.viewAreaNode.empty(),this.createViewNode({filterList:this.json.filter?this.json.filter.clone():null}))},getFilter:function(){var e=[];if("custom"===this.searchStatus&&this.filterItems.length&&this.filterItems.each(function(t){e.push(t.data)}.bind(this)),"default"===this.searchStatus){var t=this.viewSearchInputNode.get("value");t&&t!==this.lp.searchKeywork&&this.viewJson.customFilterList.each(function(i){if("textValue"===i.formatType){var s={path:i.path,value:t,formatType:i.formatType,logic:"or",comparison:"like"};e.push(s)}if("numberValue"===i.formatType){var o=t.toFloat();if(!isNaN(o)){s={path:i.path,value:o,formatType:i.formatType,logic:"or",comparison:"like"};e.push(s)}}}.bind(this))}return e.length?e:null},getData:function(){if(this.selectedItems.length){var e=[];return this.selectedItems.each((function(t){e.push(t.data)})),e}return[]},_loadModuleEvents:function(){Object.each(this.viewJson.events,function(e,t){e.code&&-1!==this.options.moduleEvents.indexOf(t)&&this.addEvent(t,function(t,i){return this.Macro.fire(e.code,i||this,t)}.bind(this))}.bind(this))},_loadDomEvents:function(){Object.each(this.viewJson.events,function(e,t){e.code&&-1===this.options.moduleEvents.indexOf(t)&&this.node.addEvent(t,function(t){return this.Macro.fire(e.code,this,t)}.bind(this))}.bind(this))},createSearchNode:function(){this.viewJson.customFilterList&&this.viewJson.customFilterList.length?(this.searchStatus="default",this.loadFilterSearch()):this.loadSimpleSearch()},loadSimpleSearch:function(){return!1},search:function(){if(this.gridJson)for(var e=this.searchSimpleInputNode.get("value"),t=this.viewTable.rows,i="no"!==this.json.isTitle?1:0;i<t.length;i++){var s=t[i];e&&e!=this.lp.searchKeywork?-1!==s.get("text").indexOf(e)?"none"===s.getStyle("display")&&s.setStyle("display","table-row"):"none"!==s.getStyle("display")&&s.setStyle("display","none"):"none"===s.getStyle("display")&&s.setStyle("display","table-row")}},loadFilterSearch:function(){this.viewSearchCustomActionNode=new Element("div",{styles:this.css.viewFilterSearchCustomActionNode,text:this.lp.customSearch}).inject(this.searchAreaNode),this.viewSearchInputAreaNode=new Element("div",{styles:this.css.viewFilterSearchInputAreaNode}).inject(this.searchAreaNode),this.viewSearchIconNode=new Element("div",{styles:this.css.viewFilterSearchIconNode}).inject(this.viewSearchInputAreaNode),this.viewSearchInputBoxNode=new Element("div",{styles:this.css.viewFilterSearchInputBoxNode}).inject(this.viewSearchInputAreaNode),this.viewSearchInputNode=new Element("input",{styles:this.css.viewFilterSearchInputNode,value:this.lp.searchKeywork}).inject(this.viewSearchInputBoxNode),this.viewSearchInputNode.addEvents({focus:function(){this.viewSearchInputNode.get("value")===this.lp.searchKeywork&&this.viewSearchInputNode.set("value","")}.bind(this),blur:function(){this.viewSearchInputNode.get("value")||this.viewSearchInputNode.set("value",this.lp.searchKeywork)}.bind(this),keydown:function(e){13===e.code&&this.searchView()}.bind(this)}),this.viewSearchIconNode.addEvents({click:function(){this.searchView()}.bind(this)}),this.viewSearchCustomActionNode.addEvents({click:function(){this.loadCustomSearch()}.bind(this)})},searchView:function(){if(this.viewJson.customFilterList){var e=this.viewSearchInputNode.get("value");if(e&&e!==this.lp.searchKeywork){var t=this.json.filter?this.json.filter.clone():[];this.filterItems=[],this.viewJson.customFilterList.each(function(i){if("textValue"===i.formatType){var s={path:i.path,value:e,formatType:i.formatType,logic:"or",comparison:"like"};t.push(s),this.filterItems.push({data:s})}if("numberValue"===i.formatType){var o=e.toFloat();if(!isNaN(o)){s={path:i.path,value:o,formatType:i.formatType,logic:"or",comparison:"like"};t.push(s),this.filterItems.push({data:s})}}}.bind(this)),this.createViewNode({filterList:t})}else{this.filterItems=[];t=this.json.filter?this.json.filter.clone():[];this.createViewNode({filterList:t})}}},searchCustomView:function(){if(this.filterItems.length){var e=this.json.filter?this.json.filter.clone():[];this.filterItems.each(function(t){e.push(t.data)}.bind(this)),this.createViewNode({filterList:e})}else this.createViewNode({filterList:this.json.filter?this.json.filter.clone():null})},loadCustomSearch:function(){this.lastFilterItems?this.filterItems=this.lastFilterItems:this.filterItems=[],this.viewSearchIconNode.setStyle("display","none"),this.viewSearchInputBoxNode.setStyle("display","none"),this.viewSearchCustomActionNode.setStyle("display","none"),this.searchMorph||(this.searchMorph=new Fx.Morph(this.viewSearchInputAreaNode));var e=this.viewSearchInputAreaNode.getParent().getSize().x-2-20;this.css.viewFilterSearchInputAreaNode_custom.width=e+"px";var t=this.viewSearchInputAreaNode.getSize().x-2;this.viewSearchInputAreaNode.setStyle("width",t+"px"),this.searchMorph.start(this.css.viewFilterSearchInputAreaNode_custom).chain(function(){this.searchStatus="custom",this.css.viewFilterSearchInputAreaNode_custom.width="auto",this.viewSearchInputAreaNode.setStyle("width","auto"),this.viewSearchCustomContentNode?(this.viewSearchCustomCloseActionNode.setStyle("display","block"),this.viewSearchCustomContentNode.setStyle("display","block")):this.loadCustomSearchContent(),this.setContentHeightFun&&this.setContentHeightFun()}.bind(this)),this.searchCustomView()},loadCustomSearchContent:function(){this.viewSearchCustomCloseActionNode=new Element("div",{styles:this.css.viewFilterSearchCustomCloseActionNode}).inject(this.viewSearchInputAreaNode),this.viewSearchCustomContentNode=new Element("div",{styles:this.css.viewFilterSearchCustomContentNode}).inject(this.viewSearchInputAreaNode),this.viewSearchCustomPathContentNode=new Element("div",{styles:this.css.viewFilterSearchCustomPathContentNode}).inject(this.viewSearchCustomContentNode),this.viewSearchCustomComparisonContentNode=new Element("div",{styles:this.css.viewFilterSearchCustomComparisonContentNode}).inject(this.viewSearchCustomContentNode),this.viewSearchCustomValueContentNode=new Element("div",{styles:this.css.viewFilterSearchCustomValueContentNode}).inject(this.viewSearchCustomContentNode),this.viewSearchCustomAddContentNode=new Element("div",{styles:this.css.viewFilterSearchCustomAddContentNode}).inject(this.viewSearchCustomContentNode),this.viewSearchCustomAddIconNode=new Element("div",{styles:this.css.viewFilterSearchCustomAddIconNode}).inject(this.viewSearchCustomAddContentNode),this.viewSearchCustomFilterContentNode=new Element("div",{styles:this.css.viewFilterSearchCustomFilterContentNode}).inject(this.viewSearchCustomContentNode),this.loadViewSearchCustomList(),this.viewSearchCustomCloseActionNode.addEvents({click:function(){this.closeCustomSearch()}.bind(this)}),this.viewSearchCustomAddIconNode.addEvents({click:function(){this.viewSearchCustomAddToFilter()}.bind(this)})},loadViewSearchCustomList:function(){this.viewSearchCustomPathListNode=new Element("select",{styles:this.css.viewFilterSearchCustomPathListNode,multiple:!0}).inject(this.viewSearchCustomPathContentNode),this.viewSearchCustomComparisonListNode=new Element("select",{styles:this.css.viewFilterSearchCustomComparisonListNode,multiple:!0}).inject(this.viewSearchCustomComparisonContentNode),this.viewJson.customFilterList.each(function(e){new Element("option",{style:this.css.viewFilterSearchOptionNode,value:e.path,text:e.title}).inject(this.viewSearchCustomPathListNode).store("entry",e)}.bind(this)),this.viewSearchCustomPathListNode.addEvent("change",function(){this.loadViewSearchCustomComparisonList()}.bind(this))},loadViewSearchCustomComparisonList:function(){var e=this.viewSearchCustomPathListNode.selectedIndex,t=this.viewSearchCustomPathListNode.options[e].retrieve("entry");if(t){var i=this.getCustomSelectScriptResult(t);switch(t.formatType){case"numberValue":this.loadComparisonSelect(this.lp.numberFilter),i.length>0?this.loadViewSerchCustomSelectByScript(i):this.loadViewSearchCustomValueNumberInput();break;case"dateTimeValue":this.loadComparisonSelect(this.lp.dateFilter),i.length>0?this.loadViewSerchCustomSelectByScript(i):this.loadViewSearchCustomValueDateTimeInput();break;case"dateValue":this.loadComparisonSelect(this.lp.dateFilter),i.length>0?this.loadViewSerchCustomSelectByScript(i):this.loadViewSearchCustomValueDateInput();break;case"timeValue":this.loadComparisonSelect(this.lp.dateFilter),i.length>0?this.loadViewSerchCustomSelectByScript(i):this.loadViewSearchCustomValueTimeInput();break;case"booleanValue":this.loadComparisonSelect(this.lp.booleanFilter),i.length>0?this.loadViewSerchCustomSelectByScript(i):this.loadViewSearchCustomValueBooleanInput();break;default:this.loadComparisonSelect(this.lp.textFilter),i.length>0?this.loadViewSerchCustomSelectByScript(i):this.loadViewSearchCustomValueTextInput()}}},getCustomSelectScriptResult:function(e){var t=[];if("script"===e.valueType&&e.valueScript&&e.valueScript.code)for(var i=this.Macro.exec(e.valueScript.code,this),s="array"===typeOf(i)?i:[i],o=0;o<s.length;o++)if(s[o].indexOf("|")>-1){var n=s[o].split("|");t.push({text:n[0],value:n[1]})}else t.push({text:s[o],value:s[o]});return t},loadViewSerchCustomSelectByScript:function(e){this.viewSearchCustomValueContentNode.empty(),this.viewSearchCustomValueNode=new Element("select",{styles:this.css.viewFilterSearchCustomComparisonListNode,multiple:!0}).inject(this.viewSearchCustomValueContentNode),e.each(function(t){new Element("option",{style:this.css.viewFilterSearchOptionNode,value:t.value,text:t.text,selected:1===e.length}).inject(this.viewSearchCustomValueNode)}.bind(this))},loadViewSearchCustomValueNumberInput:function(){this.viewSearchCustomValueContentNode.empty(),this.viewSearchCustomValueNode=new Element("input",{styles:this.css.viewFilterSearchCustomValueNode,type:"number"}).inject(this.viewSearchCustomValueContentNode)},loadViewSearchCustomValueDateTimeInput:function(){this.viewSearchCustomValueContentNode.empty(),this.viewSearchCustomValueNode=new Element("input",{styles:this.css.viewFilterSearchCustomValueNode,type:"text",readonly:!0}).inject(this.viewSearchCustomValueContentNode),MWF.require("MWF.widget.Calendar",function(){this.calendar=new MWF.widget.Calendar(this.viewSearchCustomValueNode,{style:"xform",isTime:!0,secondEnable:!0,target:this.container,format:"db"})}.bind(this))},loadViewSearchCustomValueDateInput:function(){this.viewSearchCustomValueContentNode.empty(),this.viewSearchCustomValueNode=new Element("input",{styles:this.css.viewFilterSearchCustomValueNode,type:"text",readonly:!0}).inject(this.viewSearchCustomValueContentNode),MWF.require("MWF.widget.Calendar",function(){this.calendar=new MWF.widget.Calendar(this.viewSearchCustomValueNode,{style:"xform",isTime:!1,target:this.container,format:"%Y-%m-%d"})}.bind(this))},loadViewSearchCustomValueTimeInput:function(){this.viewSearchCustomValueContentNode.empty(),this.viewSearchCustomValueNode=new Element("input",{styles:this.css.viewFilterSearchCustomValueNode,type:"text",readonly:!0}).inject(this.viewSearchCustomValueContentNode),MWF.require("MWF.widget.Calendar",function(){this.calendar=new MWF.widget.Calendar(this.viewSearchCustomValueNode,{style:"xform",timeOnly:!0,target:this.container,format:"%H:%M:%S"})}.bind(this))},loadViewSearchCustomValueBooleanInput:function(){this.viewSearchCustomValueContentNode.empty(),this.viewSearchCustomValueNode=new Element("select",{styles:this.css.viewFilterSearchCustomValueSelectNode,multiple:!0}).inject(this.viewSearchCustomValueContentNode),new Element("option",{value:"true",text:this.lp.yes}).inject(this.viewSearchCustomValueNode),new Element("option",{value:"false",text:this.lp.no}).inject(this.viewSearchCustomValueNode)},loadViewSearchCustomValueTextInput:function(){this.viewSearchCustomValueContentNode.empty(),this.viewSearchCustomValueNode=new Element("textarea",{styles:this.css.viewFilterSearchCustomValueNode}).inject(this.viewSearchCustomValueContentNode)},loadComparisonSelect:function(e){this.viewSearchCustomComparisonListNode.empty(),Object.each(e,function(e,t){new Element("option",{value:t,text:e}).inject(this.viewSearchCustomComparisonListNode)}.bind(this))},closeCustomSearch:function(){if(this.viewSearchCustomContentNode&&"block"===this.viewSearchCustomContentNode.getStyle("display")){this.viewSearchCustomCloseActionNode.setStyle("display","none"),this.viewSearchCustomContentNode.setStyle("display","none"),e=this.viewSearchInputAreaNode.getParent().getSize().x-2-10-90,this.css.viewFilterSearchInputAreaNode.width=e+"px";var e=this.viewSearchInputAreaNode.getSize().x-2;this.viewSearchInputAreaNode.setStyle("width",e+"px"),this.searchMorph||(this.searchMorph=new Fx.Morph(this.viewSearchInputAreaNode)),this.searchMorph.start(this.css.viewFilterSearchInputAreaNode).chain(function(){this.searchStatus="default",this.css.viewFilterSearchInputAreaNode.width="auto",this.viewSearchInputAreaNode.setStyle("margin-right","90px"),this.viewSearchIconNode.setStyle("display","block"),this.viewSearchInputBoxNode.setStyle("display","block"),this.viewSearchCustomActionNode.setStyle("display","block"),this.setContentHeightFun&&this.setContentHeightFun()}.bind(this)),this.lastFilterItems=this.filterItems,this.createViewNode({filterList:this.json.filter?this.json.filter.clone():null})}},viewSearchCustomAddToFilter:function(){var e=this.viewSearchCustomPathListNode.selectedIndex,t=this.viewSearchCustomComparisonListNode.selectedIndex;if(-1===e)return MWF.xDesktop.notice("error",{x:"left",y:"top"},this.lp.filterErrorTitle,this.viewSearchCustomPathListNode,{x:0,y:85}),!1;if(-1===t)return MWF.xDesktop.notice("error",{x:"left",y:"top"},this.lp.filterErrorComparison,this.viewSearchCustomComparisonListNode,{x:0,y:85}),!1;var i=this.viewSearchCustomPathListNode.options[e].retrieve("entry");if(i){var s=i.title,o=i.path,n=this.viewSearchCustomComparisonListNode.options[t].get("value"),l=this.viewSearchCustomComparisonListNode.options[t].get("text"),a="";if("script"===i.valueType&&i.valueScript&&i.valueScript.code){if(-1!==(r=this.viewSearchCustomValueNode.selectedIndex)){var h=this.viewSearchCustomValueNode.options[r].get("value");a="booleanValue"===i.formatType?"true"===h:h}}else switch(i.formatType){case"numberValue":case"dateTimeValue":a=this.viewSearchCustomValueNode.get("value");break;case"booleanValue":var r;if(-1!==(r=this.viewSearchCustomValueNode.selectedIndex))a="true"===(h=this.viewSearchCustomValueNode.options[r].get("value"));break;default:a=this.viewSearchCustomValueNode.get("value")}if(""===a)return MWF.xDesktop.notice("error",{x:"left",y:"top"},this.lp.filterErrorValue,this.viewSearchCustomValueContentNode,{x:0,y:85}),!1;this.filterItems.push(new MWF.xApplication.query.Query.Viewer.Filter(this,{logic:"and",path:o,title:s,comparison:n,comparisonTitle:l,value:a,formatType:"datetimeValue"==i.formatType?"dateTimeValue":i.formatType},this.viewSearchCustomFilterContentNode)),this.searchCustomView()}},searchViewRemoveFilter:function(e){this.filterItems.erase(e),e.destroy(),this.searchCustomView()},getParentEnvironment:function(){return this.parentMacro?this.parentMacro.environment:null},getViewInfor:function(){return this.json},getPageInfor:function(){return{pages:this.pages,perPageCount:this.options.perPageCount,currentPageNumber:this.currentPage}},getPageData:function(){return this.gridJson},toPage:function(e,t){this.currentPage=e,this.loadCurrentPageData(t)},getSelectedData:function(){return this.getData()},getSelectAllStatus:function(){if("multi"===this.getSelectFlag()){if(!this.items.length)return"none";for(var e=!0,t=!0,i=0;i<this.items.length;i++){var s=this.items[i];if("item"===s.clazzType)s.data.$selectedEnable&&(s.isSelected?t=!1:e=!1);else if(s.data.$selectedEnable){var o=s.getSelectAllStatus();"none"===o?e=!1:"all"===o?t=!1:"some"===o&&(e=!1,t=!1)}if(!e&&!t)return"some"}return t?"none":e?"all":"some"}},checkSelectAllStatus:function(){this.selectAllNode&&("all"===this.getSelectAllStatus()?this.setSelectAllStyle():this.setUnSelectAllStyle())},setSelectAllStyle:function(){this.selectAllNode&&(this.viewJson.viewStyles&&this.viewJson.viewStyles.checkedCheckboxNode?this.selectAllNode.setStyles(this.viewJson.viewStyles.checkedCheckboxNode):this.selectAllNode.getElement("img").set("src",'../x_component_query_Query/$Viewer/" + this.options.style + "/icon/checkbox_checked.png'))},setUnSelectAllStyle:function(){this.selectAllNode&&(this.viewJson.viewStyles&&this.viewJson.viewStyles.checkboxNode?this.selectAllNode.setStyles(this.viewJson.viewStyles.checkboxNode):this.selectAllNode.getElement("img").set("src",'../x_component_query_Query/$Viewer/" + this.options.style + "/icon/checkbox.png'))},clearSelectAllStyle:function(){if(this.selectAllNode){var e=this.viewJson.viewStyles,t=e&&e.titleTd?e.titleTd:this.css.viewTitleCellNode;t.background&&t["background-image"]&&t["background-color"]||(t.background="inherit"),this.selectAllNode.setStyles(t);var i=this.selectAllNode.getElement("img");i&&i.set("src",'../x_component_query_Query/$Viewer/" + this.options.style + "/icon/blank.png')}},selectAll:function(){"multi"===this.getSelectFlag()&&(this.items.each((function(e){e.data.$selectedEnable&&("item"===e.clazzType?e.selected("view"):e.selectAll("view"))})),this.viewJson.allowSelectAll&&this.setSelectAllStyle())},unSelectAll:function(){"multi"===this.getSelectFlag()&&(this.items.each((function(e){e.data.$selectedEnable&&("item"===e.clazzType?e.unSelected("view"):e.unSelectAll("view"))})),this.viewJson.allowSelectAll&&this.setUnSelectAllStyle())},getExpandAllStatus:function(){if(!this.items.length)return"none";for(var e=!0,t=!0,i=0;i<this.items.length;i++){if(this.items[i].expanded?t=!1:e=!1,!e&&!t)return"some"}return e?"all":t?"none":"some"},checkExpandAllStatus:function(){this.expandAllNode&&("all"===this.getExpandAllStatus()?this.setExpandAllStyle():this.setCollapseAllStyle())},setExpandAllStyle:function(){this.expandAllNode&&(this.viewJson.viewStyles&&this.viewJson.viewStyles.groupExpandNode?this.expandAllNode.setStyles(this.viewJson.viewStyles.groupExpandNode):this.expandAllNode.set("html","<img src='../x_component_query_Query/$Viewer/"+this.options.style+"/icon/expand.png'/>"))},setCollapseAllStyle:function(){this.expandAllNode&&(this.viewJson.viewStyles&&this.viewJson.viewStyles.groupCollapseNode?this.expandAllNode.setStyles(this.viewJson.viewStyles.groupCollapseNode):this.expandAllNode.set("html","<img src='../x_component_query_Query/$Viewer/"+this.options.style+"/icon/down.png'/>"))},expandAll:function(){this.items.each(function(e,t){window.setTimeout(function(){e.expand("view")}.bind(this),10*t+5)}.bind(this)),this.setExpandAllStyle()},collapseAll:function(){this.items.each(function(e){e.collapse("view")}.bind(this)),this.setCollapseAllStyle()},expandOrCollapseAll:function(){"all"===this.getExpandAllStatus()?this.collapseAll():this.expandAll()},setFilter:function(e,t){this.lookuping||this.pageloading||(e||(e=[]),"object"===typeOf(e)&&(e=[e]),this.json.filter=e,this.viewAreaNode&&this.createViewNode({filterList:this.json.filter?this.json.filter.clone():null},t))},switchView:function(e){this.node.setStyle("display","block"),this.loadingAreaNode&&this.loadingAreaNode.setStyle("display","block"),this.searchMorph=null,this.viewSearchCustomContentNode=null;var t=Object.merge(Object.clone(this.originalJson),e);this.container.empty(),this.initialize(this.container,t,Object.clone(this.options),this.app,this.parentMacro)},confirm:function(e,t,i,s,o,n,l,a,h,r,c){this.app.confirm(e,t,i,s,o,n,l,a,h,r,c)},alert:function(e,t,i,s,o){this.app.alert(e,"center",t,i,s,o)},notice:function(e,t,i,s,o,n){this.app.notice(e,t,i,s,o,n)}}),MWF.xApplication.query.Query.Viewer.Item=new Class({initialize:function(e,t,i,s,o){this.view=e,this.data=t,this.css=this.view.css,this.isSelected=!1,this.category=o,this.prev=i,this.idx=s,this.clazzType="item",this.load()},load:function(){this.view.fireEvent("queryLoadItemRow",[null,this]);var e=(t=this.view.viewJson.viewStyles)&&t.contentTd?t.contentTd:this.css.viewContentTdNode;this.node=new Element("tr",{styles:t&&t.contentTr?t.contentTr:this.css.viewContentTrNode}),this.prev?this.node.inject(this.prev.node,"after"):this.node.inject(this.view.viewTable),this.selectTd=new Element("td",{styles:e}).inject(this.node),this.selectTd.setStyles({cursor:"pointer"}),this.view.json.itemStyles&&this.selectTd.setStyles(this.view.json.itemStyles);var t,i,s=this.view.getSelectFlag();if(this.data.$selectedEnable&&["multi","single"].contains(s)&&"always"===this.view.viewJson.selectBoxShow)if(t=this.view.viewJson.viewStyles)"single"===s?this.selectTd.setStyles(t.radioNode):this.selectTd.setStyles(t.checkboxNode);else{var o="checkbox";"single"===s&&(o="radiobox"),this.selectTd.setStyles({background:"url(../x_component_query_Query/$Viewer/default/icon/"+o+".png) center center no-repeat"})}if(this.view.isSelectTdHidden()&&this.selectTd.hide(),"yes"===this.view.viewJson.isSequence){this.sequenceTd=new Element("td",{styles:e}).inject(this.node),this.sequenceTd.setStyle("width","10px");var n=1+this.view.json.pageSize*(this.view.currentPage-1)+this.idx;this.sequenceTd.set("text",n)}Object.each(this.view.entries,function(t,i){var s=this.data.data[i];if(void 0===s&&(s=""),-1===this.view.hideColumns.indexOf(i)){var o=new Element("td",{styles:e}).inject(this.node);if(i!==this.view.viewJson.group.column){var n=s;t.isHtml?o.set("html",n):o.set("text",n),"object"===typeOf(t.contentProperties)&&o.setProperties(t.contentProperties),this.view.json.itemStyles&&o.setStyles(this.view.json.itemStyles),"object"===typeOf(t.contentStyles)&&o.setStyles(t.contentStyles)}else this.view.json.itemStyles&&o.setStyles(this.view.json.itemStyles);-1!==this.view.openColumns.indexOf(i)&&this.setOpenWork(o,t),i!==this.view.viewJson.group.column&&Object.each(t.events||{},function(e,i){e.code&&("loadContent"===i?this.view.Macro.fire(e.code,{node:o,json:t,data:n,view:this.view,row:this}):"loadTitle"!==i&&o.addEvent(i,function(i){return this.view.Macro.fire(e.code,{node:o,json:t,data:n,view:this.view,row:this},i)}.bind(this)))}.bind(this))}}.bind(this));var l=this.view.json.defaultSelectedScript||this.view.viewJson.defaultSelectedScript;if(!this.isSelected&&l&&(i=this.view.Macro.exec(l,{node:this.node,data:this.data,view:this.view,row:this})),!this.isSelected&&this.view.selectedItems.length)for(var a=0;a<this.view.selectedItems.length;a++)if(this.view.selectedItems[a].data.bundle===this.data.bundle){i="true";break}if(i)if("multi"===i||"single"===i)this.select(i);else if("true"===i.toString()){var h=this.view.json.select||this.view.viewJson.select||"none";"single"!==h&&"multi"!==h||this.select()}this.setEvent(),this.view.fireEvent("postLoadItemRow",[null,this])},setOpenWork:function(e,t){e.setStyle("cursor","pointer"),t.clickCode?e.addEvent("click",function(e){var i=this.view.Macro.fire(t.clickCode,this,e);return e.stopPropagation(),i}.bind(this)):"cms"===this.view.json.type?e.addEvent("click",function(e){this.openCms(e),e.stopPropagation()}.bind(this)):e.addEvent("click",function(e){this.openWorkAndCompleted(e),e.stopPropagation()}.bind(this))},openCms:function(e){var t={documentId:this.data.bundle};this.view.fireEvent("openDocument",[t,this]),layout.desktop.openApplication(e,"cms.Document",t)},openWorkAndCompleted:function(e){MWF.Actions.get("x_processplatform_assemble_surface").listWorkByJob(this.data.bundle,function(t){var i=t.data.workCompletedList.length,s=t.data.workList.length+i;if(1===s)i?this.openWorkCompleted(t.data.workCompletedList[0].id,e):this.openWork(t.data.workList[0].id,e);else if(s>1){var o=this.createWorksArea();t.data.workCompletedList.each(function(e){this.createWorkCompletedNode(e,o)}.bind(this)),t.data.workList.each(function(e){this.createWorkNode(e,o)}.bind(this)),this.showWorksArea(o,e)}}.bind(this))},createWorkNode:function(e,t){var i=t.getLast(),s=new Element("div",{styles:this.css.workAreaNode}).inject(i),o=new Element("div",{styles:this.css.workAreaActionNode,text:this.view.lp.open}).inject(s);o.store("workId",e.id),o.addEvent("click",function(e){this.openWork(e.target.retrieve("workId"),e),this.mask.hide(),t.destroy()}.bind(this));var n=new Element("div",{styles:this.css.workAreaLeftNode}).inject(s),l=(new Element("div",{styles:this.css.workAreaTitleNode,text:e.title}).inject(n),new Element("div",{styles:this.css.workAreaContentNode}).inject(n));new Element("div",{styles:this.css.workAreaContentTitleNode,text:this.view.lp.activity+": "}).inject(l),new Element("div",{styles:this.css.workAreaContentTextNode,text:e.activityName}).inject(l);var a=[];MWF.Actions.get("x_processplatform_assemble_surface").listTaskByWork(e.id,function(e){e.data.each(function(e){a.push(MWF.name.cn(e.person))}.bind(this)),new Element("div",{styles:this.css.workAreaContentTitleNode,text:this.view.lp.taskPeople+": "}).inject(l),new Element("div",{styles:this.css.workAreaContentTextNode,text:a.join(", ")}).inject(l)}.bind(this))},createWorkCompletedNode:function(e,t){var i=t.getLast(),s=new Element("div",{styles:this.css.workAreaNode}).inject(i),o=new Element("div",{styles:this.css.workAreaActionNode,text:this.view.lp.open}).inject(s);o.store("workId",e.id),o.addEvent("click",function(e){this.mask.hide();var i=e.target.retrieve("workId");t.destroy(),this.openWorkCompleted(i,e)}.bind(this));var n=new Element("div",{styles:this.css.workAreaLeftNode}).inject(s),l=(new Element("div",{styles:this.css.workAreaTitleNode,text:e.title}).inject(n),new Element("div",{styles:this.css.workAreaContentNode}).inject(n));new Element("div",{styles:this.css.workAreaContentTitleNode,text:this.view.lp.activity+": "}).inject(l),new Element("div",{styles:this.css.workAreaContentTextNode,text:this.view.lp.processCompleted}).inject(l)},createWorksArea:function(){var e=this.css.worksAreaNode;layout.mobile&&(e=this.css.worksAreaNodeMobile);var t=new Element("div",{styles:e}),i=new Element("div",{styles:this.css.worksAreaTitleNode}).inject(t);new Element("div",{styles:this.css.worksAreaTitleCloseNode}).inject(i).addEvent("click",function(e){this.mask.hide(),e.target.getParent().getParent().destroy()}.bind(this));new Element("div",{styles:this.css.worksAreaContentNode}).inject(t);return t},showWorksArea:function(e,t){MWF.require("MWF.widget.Mask",null,!1),this.mask=new MWF.widget.Mask({style:"desktop",loading:!1}),this.mask.loadNode(this.view.container),e.inject(this.view.node),this.setWorksAreaPosition(e,t.target)},setWorksAreaPosition:function(e,t){var i=t.getPosition(this.view.container),s=this.view.container.getSize(),o=(this.view.container.getPosition(this.view.container.getOffsetParent()),e.getSize()),n=i.x+o.x-s.x;n=n>0?n+20:0;var l=i.y+o.y-s.y;l=l>0?l+5:0,e.position({relativeTo:t,position:"lefttop",edge:"lefttop",offset:{x:0-n,y:0-l}})},openWork:function(e,t){var i={workId:e};this.view.fireEvent("openDocument",[i,this]),layout.desktop.openApplication(t,"process.Work",i)},openWorkCompleted:function(e,t){var i={workCompletedId:e};this.view.fireEvent("openDocument",[i,this]),layout.desktop.openApplication(t,"process.Work",i)},setEvent:function(){var e=this.view.getSelectFlag();!this.data.$selectedEnable||"single"!==e&&"multi"!==e||this.node.addEvents({mouseover:function(){if(!this.isSelected&&"always"!==this.view.viewJson.selectBoxShow){var t=this.view.viewJson.viewStyles;if(t)"single"===e?this.selectTd.setStyles(t.radioNode):this.selectTd.setStyles(t.checkboxNode);else{var i="checkbox";"single"===e&&(i="radiobox"),this.selectTd.setStyles({background:"url(../x_component_query_Query/$Viewer/default/icon/"+i+".png) center center no-repeat"})}}}.bind(this),mouseout:function(){this.isSelected||"always"===this.view.viewJson.selectBoxShow||this.selectTd.setStyles({background:"transparent"})}.bind(this),click:function(){this.select()}.bind(this)})},select:function(e){var t=e||this.view.getSelectFlag();this.isSelected?"single"===t?this.unSelectedSingle():this.unSelected():"single"===t?this.selectedSingle():this.selected(),this.view.fireEvent("select")},selected:function(e){for(var t=0;t<this.view.selectedItems.length;t++){var i=this.view.selectedItems[t];if(i.data.bundle===this.data.bundle){this.view.selectedItems.erase(i);break}}this.view.selectedItems.push(this);var s=this.view.viewJson.viewStyles;s?(this.selectTd.setStyles(s.checkedCheckboxNode),this.node.setStyles(s.contentSelectedTr)):(this.selectTd.setStyles({background:"url(../x_component_query_Query/$Viewer/default/icon/checkbox_checked.png) center center no-repeat"}),this.node.setStyles(this.css.viewContentTrNode_selected)),this.isSelected=!0,"view"!==e&&"category"!==e&&this.view.viewJson.allowSelectAll&&(this.view.checkSelectAllStatus(),this.category&&this.category.checkSelectAllStatus()),this.view.fireEvent("selectRow",[this])},unSelected:function(e){for(var t=0;t<this.view.selectedItems.length;t++){var i=this.view.selectedItems[t];if(i.data.bundle===this.data.bundle){this.view.selectedItems.erase(i);break}}var s=this.view.viewJson.viewStyles;"always"!==this.view.viewJson.selectBoxShow?this.selectTd.setStyles({background:"transparent"}):s?this.selectTd.setStyles(s.checkboxNode):this.selectTd.setStyles({background:"url(../x_component_query_Query/$Viewer/default/icon/checkbox.png) center center no-repeat"}),s?this.node.setStyles(s.contentTr):this.node.setStyles(this.css.viewContentTrNode),this.isSelected=!1,"view"!==e&&"category"!==e&&this.view.viewJson.allowSelectAll&&(this.view.checkSelectAllStatus(),this.category&&this.category.checkSelectAllStatus()),this.view.fireEvent("unselectRow",[this])},selectedSingle:function(){this.view.currentSelectedItem&&this.view.currentSelectedItem.unSelectedSingle(),this.view.selectedItems=[this],this.view.currentSelectedItem=this;var e=this.view.viewJson.viewStyles;e?(this.selectTd.setStyles(e.checkedRadioNode),this.node.setStyles(e.contentSelectedTr)):(this.selectTd.setStyles({background:"url(../x_component_query_Query/$Viewer/default/icon/radiobox_checked.png) center center no-repeat"}),this.node.setStyles(this.css.viewContentTrNode_selected)),this.isSelected=!0,this.view.fireEvent("selectRow",[this])},unSelectedSingle:function(){this.view.selectedItems=[],this.view.currentSelectedItem=null;var e=this.view.viewJson.viewStyles;"always"!==this.view.viewJson.selectBoxShow?this.selectTd.setStyles({background:"transparent"}):e?this.selectTd.setStyles(e.radioNode):this.selectTd.setStyles({background:"url(../x_component_query_Query/$Viewer/default/icon/radiobox.png) center center no-repeat"}),e?this.node.setStyles(e.contentTr):this.node.setStyles(this.css.viewContentTrNode),this.isSelected=!1,this.view.fireEvent("unselectRow",[this])}}),MWF.xApplication.query.Query.Viewer.ItemCategory=new Class({initialize:function(e,t,i){this.view=e,this.data=t,this.css=this.view.css,this.items=[],this.loadChild=!1,this.idx=i,this.clazzType="category",this.load()},load:function(){this.view.fireEvent("queryLoadCategoryRow",[null,this]);var e=this.view.viewJson.viewStyles,t=e&&e.contentGroupTd?e.contentGroupTd:this.css.viewContentCategoryTdNode;this.node=new Element("tr",{styles:e&&e.contentTr?e.contentTr:this.css.viewContentTrNode}).inject(this.view.viewTable),this.selectTd=new Element("td",{styles:t}).inject(this.node),this.view.json.itemStyles&&this.selectTd.setStyles(this.view.json.itemStyles),this.data.$selectedEnable&&"multi"===this.view.getSelectFlag()&&this.view.viewJson.allowSelectAll&&(this.selectAllNode=this.selectTd,e&&e.checkboxNode?this.selectAllNode.setStyles(e.checkboxNode):this.selectAllNode.set("html","<img src='../x_component_query_Query/$Viewer/"+this.options.style+"/icon/checkbox.png'/></span>"),this.selectAllNode.setStyle("cursor","pointer"),this.selectAllNode.addEvent("click",function(e){"all"===this.getSelectAllStatus()?this.unSelectAll("category"):this.selectAll("category"),e.stopPropagation()}.bind(this))),this.categoryTd=new Element("td",{styles:t,colspan:this.view.viewJson.selectList.length+1}).inject(this.node),this.groupColumn=null;for(var i=0;i<this.view.viewJson.selectList.length;i++)if(this.view.viewJson.selectList[i].column===this.view.viewJson.group.column){this.groupColumn=this.view.viewJson.selectList[i];break}if(this.groupColumn)var s=this.data.group;else s=this.data.group;e&&e.groupCollapseNode?(this.expandNode=new Element("span",{styles:e.groupCollapseNode}).inject(this.categoryTd),new Element("span",{text:s}).inject(this.categoryTd)):this.categoryTd.set("html","<span style='font-family: Webdings'><img src='../x_component_query_Query/$Viewer/"+this.view.options.style+"/icon/expand.png'/></span> "+s),this.expanded=!1,this.view.json.itemStyles&&this.categoryTd.setStyles(this.view.json.itemStyles),this.groupColumn&&("object"===typeOf(this.groupColumn.contentStyles)&&this.categoryTd.setStyles(this.groupColumn.contentStyles),"object"===typeOf(this.groupColumn.contentProperties)&&this.categoryTd.setProperties(this.groupColumn.contentProperties)),this.setEvent();var o=this.groupColumn,n=this.categoryTd;Object.each(o.events||{},function(e,t){e.code&&("loadContent"===t?this.view.Macro.fire(e.code,{node:n,json:o,data:this.data.group,view:this.view,row:this}):"loadTitle"!==t&&n.addEvent(t,function(t){return this.view.Macro.fire(e.code,{node:n,json:o,data:this.data.group,view:this.view,row:this},t)}.bind(this)))}.bind(this)),this.view.fireEvent("postLoadCategoryRow",[null,this])},getSelectAllStatus:function(){if("multi"===this.view.getSelectFlag()){if(!this.items.length)return"none";for(var e=!0,t=!0,i=0;i<this.items.length;i++){var s=this.items[i];if(s.data.$selectedEnable&&(s.isSelected?t=!1:e=!1,!e&&!t))return"some"}return e?"all":t?"none":"some"}},checkSelectAllStatus:function(){this.selectAllNode&&("all"===this.getSelectAllStatus()?this.setSelectAllStyle():this.setUnSelectAllStyle())},setSelectAllStyle:function(){this.selectAllNode&&(this.view.viewJson.viewStyles&&this.view.viewJson.viewStyles.checkedCheckboxNode?this.selectAllNode.setStyles(this.view.viewJson.viewStyles.checkedCheckboxNode):this.selectAllNode.getElement("img").set("src",'../x_component_query_Query/$Viewer/" + this.options.style + "/icon/checkbox_checked.png'))},setUnSelectAllStyle:function(){this.selectAllNode&&(this.view.viewJson.viewStyles&&this.view.viewJson.viewStyles.checkboxNode?this.selectAllNode.setStyles(this.view.viewJson.viewStyles.checkboxNode):this.selectAllNode.getElement("img").set("src",'../x_component_query_Query/$Viewer/" + this.options.style + "/icon/checkbox.png'))},selectAll:function(e){"multi"===this.view.getSelectFlag()&&(this.expand(),this.items.each((function(t){t.data.$selectedEnable&&t.selected(e)})),this.view.viewJson.allowSelectAll&&(this.setSelectAllStyle(),"view"!==e&&this.view.checkSelectAllStatus()))},unSelectAll:function(e){"multi"===this.view.getSelectFlag()&&(this.items.each((function(t){t.data.$selectedEnable&&t.unSelected(e)})),this.view.viewJson.allowSelectAll&&(this.setUnSelectAllStyle(),"view"!==e&&this.view.checkSelectAllStatus()))},setEvent:function(){this.node.addEvents({click:function(){this.expandOrCollapse()}.bind(this)})},expandOrCollapse:function(){this.expanded?this.collapse():this.expand()},collapse:function(e){this.items.each(function(e){e.node.setStyle("display","none")}.bind(this)),this.expandNode?this.expandNode.setStyles(this.view.viewJson.viewStyles.groupCollapseNode):this.node.getElement("span").set("html","<img src='../x_component_query_Query/$Viewer/"+this.view.options.style+"/icon/expand.png'/>"),this.expanded=!1,"view"!==e&&this.view.checkExpandAllStatus()},expand:function(e){this.items.each(function(e){e.node.setStyle("display","table-row")}.bind(this)),this.expandNode?this.expandNode.setStyles(this.view.viewJson.viewStyles.groupExpandNode):this.node.getElement("span").set("html","<img src='../x_component_query_Query/$Viewer/"+this.view.options.style+"/icon/down.png'/>"),this.expanded=!0,this.loadChild||(this.data.list.each(function(e,t){var i=this.idx+t;this.lastItem=new MWF.xApplication.query.Query.Viewer.Item(this.view,e,this.lastItem||this,i,this),this.items.push(this.lastItem)}.bind(this)),this.loadChild=!0),"view"!==e&&this.view.checkExpandAllStatus()}}),MWF.xApplication.query.Query.Viewer.Filter=new Class({initialize:function(e,t,i){this.viewer=e,this.data=t,this.css=this.viewer.css,this.content=i,this.load()},load:function(){this.node=new Element("div",{styles:this.css.viewSearchFilterNode}).inject(this.content),this.viewer.filterItems.length&&(this.logicNode=new Element("div",{styles:this.css.viewSearchFilterSelectAreaNode}).inject(this.node),this.logicSelectNode=new Element("div",{styles:this.css.viewSearchFilterSelectNode,text:this.viewer.lp.and,value:"and"}).inject(this.logicNode),this.logicSelectButtonNode=new Element("div",{styles:this.css.viewSearchFilterSelectButtonNode}).inject(this.logicNode),this.logicNode.addEvents({click:function(){"and"===this.logicSelectNode.get("value")?(this.logicSelectButtonNode.setStyle("float","left"),this.logicSelectNode.setStyle("float","right"),this.logicSelectNode.set({text:this.viewer.lp.or,value:"or"}),this.data.logic="or"):(this.logicSelectButtonNode.setStyle("float","right"),this.logicSelectNode.setStyle("float","left"),this.logicSelectNode.set({text:this.viewer.lp.and,value:"and"}),this.data.logic="and"),this.viewer.searchCustomView()}.bind(this)})),this.titleNode=new Element("div",{styles:this.css.viewSearchFilterTextNode,text:this.data.title}).inject(this.node),this.comparisonTitleNode=new Element("div",{styles:this.css.viewSearchFilterTextNode,text:this.data.comparisonTitle}).inject(this.node),this.valueNode=new Element("div",{styles:this.css.viewSearchFilterTextNode,text:'"'+this.data.value+'"'}).inject(this.node),this.deleteNode=new Element("div",{styles:this.css.viewSearchFilterDeleteNode}).inject(this.node),this.node.addEvents({mouseover:function(){this.node.setStyles(this.css.viewSearchFilterNode_over),this.deleteNode.setStyles(this.css.viewSearchFilterDeleteNode_over)}.bind(this),mouseout:function(){this.node.setStyles(this.css.viewSearchFilterNode),this.deleteNode.setStyles(this.css.viewSearchFilterDeleteNode)}.bind(this)}),this.deleteNode.addEvent("click",function(){this.viewer.searchViewRemoveFilter(this)}.bind(this))},destroy:function(){this.node.destroy(),MWF.release(this)}}),MWF.xApplication.query.Query.Viewer.Actionbar=new Class({Implements:[Events],options:{style:"default",moduleEvents:["load","queryLoad","postLoad","afterLoad"]},initialize:function(e,t,i,s){this.node=$(e),this.node.store("module",this),this.json=t,this.form=i,this.view=i},hide:function(){var e=this.node.getStyle("display");"none"!==e&&this.node.store("mwf_display",e),this.node.setStyle("display","none")},show:function(){var e=this.node.retrieve("mwf_display",e);this.node.setStyle("display",e)},load:function(){this._loadModuleEvents(),this.fireEvent("queryLoad")&&(this._loadUserInterface(),this._loadStyles(),this._loadDomEvents(),this.fireEvent("postLoad"),this.fireEvent("load"))},_loadStyles:function(){this.json.styles&&Object.each(this.json.styles,function(e,t){if(-1!=e.indexOf("x_processplatform_assemble_surface")||-1!=e.indexOf("x_portal_assemble_surface")||-1!=e.indexOf("x_cms_assemble_control")){var i=MWF.Actions.getHost("x_processplatform_assemble_surface"),s=MWF.Actions.getHost("x_portal_assemble_surface"),o=MWF.Actions.getHost("x_cms_assemble_control");-1!==e.indexOf("/x_processplatform_assemble_surface")?e=e.replace("/x_processplatform_assemble_surface",i+"/x_processplatform_assemble_surface"):-1!==e.indexOf("x_processplatform_assemble_surface")&&(e=e.replace("x_processplatform_assemble_surface",i+"/x_processplatform_assemble_surface")),-1!==e.indexOf("/x_portal_assemble_surface")?e=e.replace("/x_portal_assemble_surface",s+"/x_portal_assemble_surface"):-1!==e.indexOf("x_portal_assemble_surface")&&(e=e.replace("x_portal_assemble_surface",s+"/x_portal_assemble_surface")),-1!==e.indexOf("/x_cms_assemble_control")?e=e.replace("/x_cms_assemble_control",o+"/x_cms_assemble_control"):-1!==e.indexOf("x_cms_assemble_control")&&(e=e.replace("x_cms_assemble_control",o+"/x_cms_assemble_control")),e=o2.filterUrl(e)}this.node.setStyle(t,e)}.bind(this))},_loadModuleEvents:function(){Object.each(this.json.events,function(e,t){e.code&&-1!==this.options.moduleEvents.indexOf(t)&&this.addEvent(t,function(t){return this.form.Macro.fire(e.code,this,t)}.bind(this))}.bind(this))},_loadDomEvents:function(){Object.each(this.json.events,function(e,t){e.code&&-1===this.options.moduleEvents.indexOf(t)&&this.node.addEvent(t,function(t){return this.form.Macro.fire(e.code,this,t)}.bind(this))}.bind(this))},_loadEvents:function(){Object.each(this.json.events,function(e,t){e.code&&(-1!==this.options.moduleEvents.indexOf(t)?this.addEvent(t,function(t){return this.form.Macro.fire(e.code,this,t)}.bind(this)):this.node.addEvent(t,function(t){return this.form.Macro.fire(e.code,this,t)}.bind(this)))}.bind(this))},addModuleEvent:function(e,t){-1!==this.options.moduleEvents.indexOf(e)?this.addEvent(e,function(e){return t?t(this,e):null}.bind(this)):this.node.addEvent(e,function(e){return t?t(this,e):null}.bind(this))},_loadUserInterface:function(){this.toolbarNode=this.node.getFirst("div"),this.toolbarNode||(this.toolbarNode=new Element("div").inject(this.node)),this.toolbarNode.empty(),MWF.require("MWF.widget.Toolbar",function(){this.toolbarWidget=new MWF.widget.Toolbar(this.toolbarNode,{style:this.json.style,onPostLoad:function(){this.fireEvent("afterLoad")}.bind(this)},this),this.json.actionStyles&&(this.toolbarWidget.css=this.json.actionStyles),this.json.multiTools?(this.json.multiTools.each(function(e){e.system?this.json.hideSystemTools||this.setToolbars([e],this.toolbarNode,this.readonly):this.setCustomToolbars([e],this.toolbarNode)}.bind(this)),this.toolbarWidget.load()):this.json.hideSystemTools?(this.setCustomToolbars(this.json.tools,this.toolbarNode),this.toolbarWidget.load()):this.json.defaultTools?(this.setToolbars(this.json.defaultTools,this.toolbarNode,this.readonly),this.setCustomToolbars(this.json.tools,this.toolbarNode),this.toolbarWidget.load()):MWF.getJSON(this.form.path+"toolbars.json",function(e){this.setToolbars(e,this.toolbarNode,this.readonly,!0),this.setCustomToolbars(this.json.tools,this.toolbarNode),this.toolbarWidget.load()}.bind(this),null)}.bind(this))},setCustomToolbars:function(e,t){var i="../x_component_process_FormDesigner/Module/Actionbar/",s="";this.json.customIconStyle&&(s=this.json.customIconStyle+"/"),e.each(function(e){var o=!0;if(o=this.readonly?e.readShow:e.editShow){if(o=!0,e.condition)o=!this.form.Macro.exec(e.condition,this);if(o){var n=new Element("div",{id:e.id,MWFnodetype:e.type,MWFButtonImage:i+""+this.form.options.style+"/custom/"+s+e.img,title:e.title,MWFButtonAction:"runCustomAction",MWFButtonText:e.text}).inject(t);if(this.json.customIconOverStyle&&n.set("MWFButtonImageOver",i+""+this.form.options.style+"/custom/"+this.json.customIconOverStyle+"/"+e.img),e.properties&&n.set(e.properties),e.actionScript&&n.store("script",e.actionScript),e.sub){var l=t.getLast();this.setCustomToolbars(e.sub,l)}}}}.bind(this))},setToolbarItem:function(e,t,i,s){var o="../x_component_query_ViewDesigner/$View/",n=!0;if(!s&&e.condition){var l=this.form.Macro.exec(e.condition,this);n=n&&!l}if(i&&(e.read||(n=!1)),n){var a=new Element("div",{id:e.id,MWFnodetype:e.type,MWFButtonImage:o+this.options.style+"/actionbar/"+(this.json.iconStyle||"default")+"/"+e.img,title:e.title,MWFButtonAction:e.action,MWFButtonText:e.text}).inject(t);if(this.json.iconOverStyle&&a.set("MWFButtonImageOver",o+""+this.options.style+"/actionbar/"+this.json.iconOverStyle+"/"+e.img),e.properties&&a.set(e.properties),e.sub){var h=t.getLast();this.setToolbars(e.sub,h,i,s)}}},setToolbars:function(e,t,i,s){e.each(function(e){this.setToolbarItem(e,t,i,s)}.bind(this))},runCustomAction:function(e){var t=e.node.retrieve("script");this.form.Macro.exec(t,this)},exportView:function(){this.form.exportView()},deleteWork:function(){this.form.deleteWork()}}),MWF.xApplication.query.Query.Viewer.Paging=new Class({Implements:[Events],options:{style:"default",moduleEvents:["load","queryLoad","postLoad","afterLoad","jump"]},initialize:function(e,t,i,s){this.node=$(e),this.node.store("module",this),this.json=t,this.form=i,this.view=i},hide:function(){var e=this.node.getStyle("display");"none"!==e&&this.node.store("mwf_display",e),this.node.setStyle("display","none")},show:function(){var e=this.node.retrieve("mwf_display",e);this.node.setStyle("display",e)},load:function(){this._loadModuleEvents(),this.fireEvent("queryLoad")&&(this._loadUserInterface(),this._loadStyles(),this._loadDomEvents(),this.fireEvent("postLoad"))},_loadStyles:function(){this.json.styles&&Object.each(this.json.styles,function(e,t){if(-1!=e.indexOf("x_processplatform_assemble_surface")||-1!=e.indexOf("x_portal_assemble_surface")||-1!=e.indexOf("x_cms_assemble_control")){var i=MWF.Actions.getHost("x_processplatform_assemble_surface"),s=MWF.Actions.getHost("x_portal_assemble_surface"),o=MWF.Actions.getHost("x_cms_assemble_control");-1!==e.indexOf("/x_processplatform_assemble_surface")?e=e.replace("/x_processplatform_assemble_surface",i+"/x_processplatform_assemble_surface"):-1!==e.indexOf("x_processplatform_assemble_surface")&&(e=e.replace("x_processplatform_assemble_surface",i+"/x_processplatform_assemble_surface")),-1!==e.indexOf("/x_portal_assemble_surface")?e=e.replace("/x_portal_assemble_surface",s+"/x_portal_assemble_surface"):-1!==e.indexOf("x_portal_assemble_surface")&&(e=e.replace("x_portal_assemble_surface",s+"/x_portal_assemble_surface")),-1!==e.indexOf("/x_cms_assemble_control")?e=e.replace("/x_cms_assemble_control",o+"/x_cms_assemble_control"):-1!==e.indexOf("x_cms_assemble_control")&&(e=e.replace("x_cms_assemble_control",o+"/x_cms_assemble_control")),e=o2.filterUrl(e)}this.node.setStyle(t,e)}.bind(this))},_loadModuleEvents:function(){Object.each(this.json.events,function(e,t){e.code&&-1!==this.options.moduleEvents.indexOf(t)&&this.addEvent(t,function(t){return this.form.Macro.fire(e.code,this,t)}.bind(this))}.bind(this))},_loadDomEvents:function(){Object.each(this.json.events,function(e,t){e.code&&-1===this.options.moduleEvents.indexOf(t)&&this.node.addEvent(t,function(t){return this.form.Macro.fire(e.code,this,t)}.bind(this))}.bind(this))},_loadEvents:function(){Object.each(this.json.events,function(e,t){e.code&&(-1!==this.options.moduleEvents.indexOf(t)?this.addEvent(t,function(t){return this.form.Macro.fire(e.code,this,t)}.bind(this)):this.node.addEvent(t,function(t){return this.form.Macro.fire(e.code,this,t)}.bind(this)))}.bind(this))},addModuleEvent:function(e,t){-1!==this.options.moduleEvents.indexOf(e)?this.addEvent(e,function(e){return t?t(this,e):null}.bind(this)):this.node.addEvent(e,function(e){return t?t(this,e):null}.bind(this))},_loadUserInterface:function(){this.loadPaging(!0)},reload:function(){this.loadPaging(!1)},loadPaging:function(e){this.node.empty(),this.paging=new o2.widget.Paging(this.node,{countPerPage:this.view.json.pageSize||this.view.options.perPageCount,visiblePages:layout.mobile?5:this.json.visiblePages?this.json.visiblePages.toInt():9,currentPage:this.view.currentPage,itemSize:this.view.count,pageSize:this.view.pages,hasNextPage:"boolean"!==typeOf(this.json.hasPreNextPage)||this.json.hasPreNextPage,hasPrevPage:"boolean"!==typeOf(this.json.hasPreNextPage)||this.json.hasPreNextPage,hasTruningBar:"boolean"!==typeOf(this.json.hasTruningBar)||this.json.hasTruningBar,hasBatchTuring:"boolean"!==typeOf(this.json.hasBatchTuring)||this.json.hasBatchTuring,hasFirstPage:"boolean"===typeOf(this.json.hasFirstLastPage)?this.json.hasFirstLastPage:!layout.mobile,hasLastPage:"boolean"===typeOf(this.json.hasFirstLastPage)?this.json.hasFirstLastPage:!layout.mobile,hasJumper:"boolean"===typeOf(this.json.hasPageJumper)?this.json.hasPageJumper:!layout.mobile,hiddenWithDisable:!1,hiddenWithNoItem:!0,text:{prePage:this.json.prePageText,nextPage:this.json.nextPageText,firstPage:this.json.firstPageText,lastPage:this.json.lastPageText},onJumpingPage:function(e,t){this.view.currentPage=e,this.fireEvent("jump"),this.view.loadCurrentPageData(null,!1)}.bind(this),onPostLoad:function(){e&&(this.view.setContentHeightFun&&this.view.setContentHeightFun(),this.fireEvent("load")),this.fireEvent("afterLoad")}.bind(this)},this.json.pagingStyles||{}),this.paging.load()}});