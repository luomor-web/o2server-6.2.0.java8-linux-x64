MWF.require("MWF.widget.MaskNode",null,!1),o2.requireApp("AppMarketV2","RecommendContent",null,!1),MWF.xApplication.AppMarketV2.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",mvcStyle:"style.css",name:"AppMarketV2",icon:"icon.png",width:"1000",height:"700",isResize:!0,isMax:!0,title:MWF.xApplication.AppMarketV2.LP.title,minHeight:700},onQueryLoad:function(){this.lp=MWF.xApplication.AppMarketV2.LP,this.actions=MWF.Actions.load("x_program_center"),this.viewPath=this.path+this.options.style+"/view.html",this.iconPath=this.path+this.options.style+"/icon/"},mask:function(){this.maskNode||(this.marketnode.setStyle("overflow","hidden"),this.maskNode=new MWF.widget.MaskNode(this.marketnode,{style:"bam"}),this.maskNode.load())},unmask:function(){this.maskNode&&this.maskNode.hide(function(){MWF.release(this.maskNode),this.maskNode=null,this.marketnode.setStyle("overflow","auto")}.bind(this))},loadApplication:function(t){MWF.AC.isAdministrator()?this.content.loadHtml(this.viewPath,{bind:{lp:this.lp},module:this},function(){this.options.isRefresh?this.loadApp(t):this.maxSize(function(){this.actions.CollectAction.login(function(i){i.type&&"success"==i.type&&this.loadApp(t)}.bind(this),function(i){errtype=JSON.parse(i.response).type,errtype&&"error"==errtype&&this.loadCloudConnectTip(t)}.bind(this),!1)}.bind(this))}.bind(this)):o2.xDesktop.notice("error",{x:"right",y:"top"},this.lp.accessDenyNotice)},loadApp:function(t){this.initNodeSize(),this.recommondLoaded=!1,this.applicationsLoaded=!0,this.loadRecommondContent(function(){this.recommondLoaded=!0,this.checkAppLoaded(t)}.bind(this)),this.loadApplicationsContent(function(){this.applicationsLoaded=!0,this.checkAppLoaded(t)}.bind(this))},loadCloudConnectTip:function(t){this.initNodeSize(),o2.requireApp("AppMarketV2","CloudConnectTip",function(){this.cloudTip=new MWF.xApplication.AppMarketV2.CloudConnectTip(this,this.cloudConnectTipNode,{onLoad:function(){t&&t()}})}.bind(this))},checkAppLoaded:function(t){this.recommondLoaded&&this.applicationsLoaded&&t&&t()},initNodeSize:function(){this.resizeNodeSize(),this.addEvent("resize",this.resizeNodeSize.bind(this))},resizeNodeSize:function(){var t=this.content.getSize(),i=this.marketnode.getEdgeHeight(),e=t.y-i;e<this.options.minHeight&&(e=this.options.minHeight),this.marketnode.setStyle("height",e+"px")},loadRecommondContent:function(t){this.recommendContent=new MWF.xApplication.AppMarketV2.RecommendContent(this,this.topRecommendNode,{onLoad:function(){t&&t()}})},loadApplicationsContent:function(t){o2.requireApp("AppMarketV2","ApplicationsContent",function(){this.applicationsContent=new MWF.xApplication.AppMarketV2.ApplicationsContent(this,this.applicationsNode,{onLoad:function(){t&&t()}})}.bind(this))}});