MWF.xDesktop.requireApp("query.ViewDesigner","",null,!1),MWF.APPDIPD=MWF.xApplication.query.ImporterDesigner,MWF.APPDIPD.options={multitask:!0,executable:!1},MWF.xDesktop.requireApp("query.ImporterDesigner","Importer",null,!1),MWF.xApplication.query.ImporterDesigner.Main=new Class({Extends:MWF.xApplication.query.ViewDesigner.Main,Implements:[Options,Events],options:{style:"default",name:"query.ImporterDesigner",icon:"icon.png",title:MWF.APPDIPD.LP.title,appTitle:MWF.APPDIPD.LP.title,id:"",tooltip:{unCategory:MWF.APPDIPD.LP.unCategory},actions:null,category:null},onQueryLoad:function(){this.shortcut=!0,this.status&&(this.options.application=this.status.applicationId,this.application=this.status.application,this.options.id=this.status.id),this.options.id||(this.options.desktopReload=!1,this.options.title=this.options.title+"-"+MWF.APPDIPD.LP.newImporter),this.actions||(this.actions=MWF.Actions.get("x_query_assemble_designer")),this.lp=MWF.xApplication.query.ImporterDesigner.LP,this.addEvent("queryClose",function(t){this.explorer&&this.explorer.reload()}.bind(this))},loadViewListNodes:function(){this.viewListTitleNode=new Element("div",{styles:this.css.viewListTitleNode,text:MWF.APPDIPD.LP.importer}).inject(this.viewListNode),this.viewListResizeNode=new Element("div",{styles:this.css.viewListResizeNode}).inject(this.viewListNode),this.viewListAreaSccrollNode=new Element("div",{styles:this.css.viewListAreaSccrollNode}).inject(this.viewListNode),this.viewListAreaNode=new Element("div",{styles:this.css.viewListAreaNode}).inject(this.viewListAreaSccrollNode),this.loadViewListResize(),this.loadViewList()},loadViewList:function(){this.actions.listImportModel(this.application.id,function(t){t.data.each(function(t){this.createListViewItem(t)}.bind(this))}.bind(this),null,!1)},createListViewItem:function(t,e){var i=this,s=new Element("div",{styles:this.css.listViewItem}).inject(this.viewListAreaNode,e?"top":"bottom");new Element("div",{styles:this.css.listViewItemIcon}).inject(s),new Element("div",{styles:this.css.listViewItemText,text:t.name?t.name+" ("+t.alias+")":this.lp.newImporter}).inject(s);s.store("importer",t),s.addEvents({dblclick:function(t){i.loadImporterByData(this,t)},mouseover:function(){i.currentListViewItem!=this&&this.setStyles(i.css.listViewItem_over)},mouseout:function(){i.currentListViewItem!=this&&this.setStyles(i.css.listViewItem)}})},loadImporterByData:function(t,e){var i=t.retrieve("importer");if(!i.isNewImportModel){var s=this,o={appId:"query.ImporterDesigner"+i.id,onQueryLoad:function(){this.actions=s.actions,this.category=s,this.options.id=i.id,this.application=s.application,this.explorer=s.explorer}};this.desktop.openApplication(e,"query.ImporterDesigner",o)}},loadView:function(){this.getViewData(this.options.id,function(t){this.setTitle(this.options.appTitle+"-"+t.name),this.taskitem.setText(this.options.appTitle+"-"+t.name),this.options.appTitle=this.options.appTitle+"-"+t.name,this.importer=new MWF.xApplication.query.ImporterDesigner.Importer(this,t),this.view=this.importer,this.importer.load()}.bind(this))},loadNewViewData:function(t){MWF.getJSON("../x_component_query_ImporterDesigner/$Importer/importer.json",{onSuccess:function(e){this.actions.getUUID(function(i){e.id=i,e.isNewImportModel=!0,e.application=this.application.id,this.createListViewItem(e,!0),t&&t(e)}.bind(this))}.bind(this),onerror:function(t){this.notice(t,"error")}.bind(this),onRequestFailure:function(t){this.notice(t.responseText,"error")}.bind(this)})},loadViewData:function(t,e){this.actions.getImportModel(t,function(t){if(t){var i=t.data;this.application?e&&e(i):this.actions.getApplication(i.query,function(t){this.application={name:t.data.name,id:t.data.id},e&&e(i)}.bind(this))}}.bind(this))},saveView:function(){this.view.save(function(){var t=this.view.data.name;this.setTitle(MWF.APPDIPD.LP.title+"-"+t),this.options.desktopReload=!0,this.options.id=this.view.data.id}.bind(this))},statusBuild:function(){this.view.statusBuild()},statusDraft:function(){this.view.statusDraft()},buildAllView:function(){this.view.buildAllView()}}),MWF.xDesktop.requireApp("Template","MPopupForm",null,!1),MWF.xApplication.query.ImporterDesigner.Importer.NewNameForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"design",width:700,height:"260",hasTop:!0,hasIcon:!1,draggable:!0,title:MWF.xApplication.query.ImporterDesigner.LP.newImporter},_createTableContent:function(){this.formTableArea.set("html","<table width='80%' bordr='0' cellpadding='7' cellspacing='0' styles='formTable' style='margin: 20px auto 0px auto; '><tr><td styles='formTableTitle' lable='selectQuery' width='25%'></td>    <td styles='formTableValue' item='selectQuery' colspan='3' width='75%'></td></tr><tr><td styles='formTableTitle' lable='name'></td>    <td styles='formTableValue' item='name' colspan='3'></td></tr></table>"),MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.formTableArea,this.data||{},{isEdited:!0,style:"cms",hasColon:!0,itemTemplate:{selectQuery:{text:MWF.xApplication.query.ImporterDesigner.LP.application,type:"org",orgType:"Query",defaultValue:this.data.queryName,orgWidgetOptions:{canRemove:!1}},name:{text:MWF.xApplication.query.ImporterDesigner.LP.name,notEmpty:!0}}},this.app),this.form.load()}.bind(this),null,!0)},ok:function(){var t=this.form.getResult(!0,null,!0,!1,!0);if(t){var e=this.form.getItem("selectQuery").orgObject;if(e&&e.length>0){var i=e[0].data;t.query=i.id,t.queryName=i.name}this.fireEvent("save",[t,function(){this.close()}.bind(this)])}}});