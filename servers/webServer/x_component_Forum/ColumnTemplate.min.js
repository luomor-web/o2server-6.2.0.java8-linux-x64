MWF.xDesktop.requireApp("Template","Explorer",null,!1),MWF.xApplication.Forum.ColumnTemplate=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{naviMode:!1,style:"default",width:"1230",type:"type_1_0",categoryId:""},initialize:function(t,e,i,o){this.setOptions(o),this.options.type||(this.options.type="type_1_0"),this.container=t,this.app=e,this.lp=e.lp,this.actions=e.restActions,this.explorer=i,this.path="../x_component_Forum/$ColumnTemplate/",this.cssPath="../x_component_Forum/$ColumnTemplate/"+this.options.style+"/css.wcss",this._loadCss()},load:function(){this.loadSetting(),this.loadView()},_loadSetting:function(){var t;MWF.xApplication.Forum.ColumnTemplate.Setting?t=MWF.xApplication.Forum.ColumnTemplate.Setting:new Request.JSON({url:"../x_component_Forum/$ColumnTemplate/template/setting.json",secure:!1,async:!1,method:"get",noCache:!1,onSuccess:function(e,i){t=MWF.xApplication.Forum.ColumnTemplate.Setting=e}.bind(this),onError:function(t,e){alert(e+t)}}).send();return t},loadSetting:function(){var t=this._loadSetting();this.setting=t[this.options.type]},loadView:function(){this.view=new MWF.xApplication.Forum.ColumnTemplate.View(this.container,this.app,this,{setting:this.setting,templateUrl:this.setting.template,categoryId:this.options.categoryId,onPostCreateViewBody:function(){this.fireEvent("postLoad")}.bind(this)},{css:this.css}),this.view.load()}}),MWF.xApplication.Forum.ColumnTemplate.View=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t,e){if(this.app.access.isSectionViewer(t))return new MWF.xApplication.Forum.ColumnTemplate.Document(this.viewNode,t,this.explorer,this,null,e)},_getCurrentPageData:function(t,e){e||(e=20);this.items.length&&this.items[this.items.length-1].data.id,this.filterData;this.actions.listSection(this.options.categoryId,function(e){e.data||(e.data=[]),t&&t(e)}.bind(this))},_removeDocument:function(t,e){},_create:function(){},_openDocument:function(t){},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){}}),MWF.xApplication.Forum.ColumnTemplate.Document=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,mouseoverDocument:function(){},mouseoutDocument:function(){},_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){var i=t.getElements("[item='moderatorNames']")[0];i&&this.createPersonNode(i,e.moderatorNames);var o=this.view.options.setting,s=o.column;(this.index+1)%s==0&&t.setStyle("margin-right","0px"),o.hasBorder&&this.container.setStyle("padding-bottom","10px"),o.image&&this._loadImage(t),this._loadSubjectList(t)},_loadSubjectList:function(t){var e=t.getElements("[item='itemListNode']")[0],i=t.getElements("[item='itemReplyListNode']")[0];e&&this._getListData(function(t){t.data.each(function(t,o){if((n=new Element("div",{styles:this.css.itemListItemNode,text:t.title,title:t.title}).inject(e)).addEvents({mouseover:function(){this.node.setStyles(this.obj.css.itemListItemNode_over)}.bind({node:n,obj:this}),mouseout:function(){this.node.setStyles(this.obj.css.itemListItemNode)}.bind({node:n,obj:this}),click:function(){var t="ForumDocument"+this.da.id;this.obj.app.desktop.apps[t]?this.obj.app.desktop.apps[t].setCurrent():this.obj.app.desktop.openApplication(null,"ForumDocument",{sectionId:this.da.sectionId,id:this.da.id,appId:t,isEdited:!1,isNew:!1,index:o})}.bind({da:t,obj:this})}),i){var s=new Element("div",{styles:this.css.itemReplyListItemNode}).inject(i);(n=new Element("div",{styles:this.css.itemReplyPersonNode,text:(t.creatorName||"").split("@")[0]}).inject(s)).addEvents({mouseover:function(){this.node.setStyles(this.obj.css.itemReplyPersonNode_over)}.bind({node:n,obj:this}),mouseout:function(){this.node.setStyles(this.obj.css.itemReplyPersonNode)}.bind({node:n,obj:this}),click:function(){this.obj.app.openPerson(this.userName)}.bind({userName:t.creatorName,obj:this})});var n=new Element("div",{styles:this.css.itemReplyTimeNode,text:MWFForum.getDateDiff(t.latestReplyTime),title:t.latestReplyTime}).inject(s)}}.bind(this))}.bind(this),this.view.options.setting.itemCount)},_loadImage:function(t){var e=this,i=t.getElements("[item='itemImage']")[0],o={sectionId:this.data.id,needPicture:!0};i&&this.actions.listSubjectForBBSIndex(1,1,o,function(t){if(t.data){var i=t.data[0];this.node.set("title",i.title),i.picId&&(this.node.set("src",MWF.xDesktop.getImageSrc(i.picId)),this.node.setStyle("cursor","pointer")),this.node.addEvents({click:function(){var t="ForumDocument"+this.da.id;e.app.desktop.apps[t]?e.app.desktop.apps[t].setCurrent():e.app.desktop.openApplication(null,"ForumDocument",{sectionId:this.da.sectionId,id:this.da.id,appId:t,isEdited:!1,isNew:!1})}.bind({da:i})})}}.bind({node:i}))},_getListData:function(t,e){e||(e=6);var i={sectionId:this.data.id};this.actions.listSubjectForBBSIndex(1,e,i,function(e){e.data||(e.data=[]),t&&t(e)}.bind(this))},removeCenterWork:function(t){return!1},openSection:function(t){if(this.explorer.options.naviMode&&this.explorer.forumNavi)this.explorer.forumNavi.goto(MWFForum.NaviType.section,this.data.id);else{var e="ForumSection"+this.data.id;this.app.desktop.apps[e]?this.app.desktop.apps[e].setCurrent():this.app.desktop.openApplication(t,"ForumSection",{sectionId:this.data.id,appId:e})}},openPerson:function(t){var e="ForumPerson"+t;this.app.desktop.apps[e]?this.app.desktop.apps[e].setCurrent():this.app.desktop.openApplication(null,"ForumPerson",{personName:t,appId:e})},createPersonNode:function(t,e){var i="array"===typeOf(e)?e:e.split(",");i.each(function(e,o){var s=new Element("span",{text:e.split("@")[0],styles:this.css.person}).inject(t);s.addEvents({mouseover:function(){this.node.setStyles(this.obj.css.person_over)}.bind({node:s,obj:this}),mouseout:function(){this.node.setStyles(this.obj.css.person)}.bind({node:s,obj:this}),click:function(){this.obj.openPerson(this.userName)}.bind({userName:e,obj:this})}),o!=i.length-1&&new Element("span",{text:"„ÄÅ"}).inject(t)}.bind(this))}});