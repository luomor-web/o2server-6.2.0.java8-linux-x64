var Config={soapUrl:"http://10.134.73.35:8080/haSms/SendSms",userName:"snrlmh",password:"snrlmh1904"},applications=resources.getContext().applications();function parseResp(e){return e&&null!==e?JSON.parse(e.toString()):{type:"error",message:"服务响应是null"}}function getSoapReqData(e,r,t){return'<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:sms="http://sms.ha.mocha.com/">   <soapenv:Header/>   <soapenv:Body>      <sms:sendSms>         <arg0>'+Config.userName+"</arg0>         <arg1>"+Config.password+"</arg1>         <arg2>"+e+"</arg2>         <arg3>"+r+"</arg3>         <arg4>"+(t||null)+"</arg4>      </sms:sendSms>   </soapenv:Body></soapenv:Envelope>"}function getXmlText(e,r){var t=e.getElementsByTagName(r);if(null==t)return null;var s=t.item(0);return null==s?null:s.getTextContent()}function parseResult(e,r){try{var t=Java.type("javax.xml.parsers.DocumentBuilderFactory"),s=Java.type("java.io.StringReader"),a=Java.type("org.xml.sax.InputSource"),n=t.newInstance().newDocumentBuilder(),o=new a(new s(e)),p=getXmlText(n.parse(o).getDocumentElement(),"soap:Body"),i="";if(print("sms返回结果:"+p),"0"===p.substr(0,1))return r.resultCode="success",r.result="成功:"+p,{result:"success",description:"返回结果："+p};var u=p.substr(2,3);switch(u){case"100":i="平台服务异常";break;case"001":i="身份认证失败";break;case"002":i="手机号不合法";break;case"003":i="信息内容大小超过允许范围";break;case"009":i="定时时间早于当前时间";break;case"011":i="密码为空或者账号为空或手机号为空"}return r.resultCode="error",r.result=i+":"+p,print("错误信息："+i),{result:"error",description:"返回结果："+p+" ,错误信息"+u}}catch(e){return print("解析返回结果报错："),r.resultCode="run time error",r.result="解析返回结果报错："+e.name+": "+e.message,print(e.printStackTrace()),{result:"error",description:"解析返回结果报错："+e.name+": "+e.message}}}function sendRequest(e,r){try{print("发起请求:"+e);var t=new(Java.type("java.util.ArrayList")),s=new(Java.type("com.x.base.core.project.bean.NameValuePair"))("Content-Type","text/xml; charset=utf-8");t.add(s);var a=Java.type("com.x.base.core.project.connection.HttpConnection").postAsString(Config.soapUrl,t,e);return print("SMS 返回:"+a),parseResult(a,r)}catch(e){return print("发送请求出错："),r.resultCode="run time error",r.result="发送请求出错："+e.name+": "+e.message,print(e.printStackTrace()),{result:"error",description:"发送请求出错："+e.name+": "+e.message}}}function saveLog(e){var r=parseResp(applications.postQuery("x_query_assemble_surface","table/hrMarketSMSLog/row",JSON.stringify(e)));r&&"error"==r.type&&print("save sms log error :"+r.message)}function init(){var e,r="";try{print("requestText="+requestText),e=JSON.parse(requestText),print("type of requestJson = "+typeof e),"string"==typeof e&&(e=JSON.parse(e)),r=sendRequest(getSoapReqData(e.receiveMobile,e.content),e)}catch(t){t.printStackTrace(),e&&(e.resultCode="run time error",e.result=t.name+": "+t.message),r={result:"error",description:t.name+": "+t.message}}finally{return e&&saveLog(e),print("responseText="+JSON.stringify(r)),r}}init();