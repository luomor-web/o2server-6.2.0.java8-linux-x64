MWF.xApplication.BAM.summary=MWF.xApplication.BAM.summary||{},MWF.xApplication.BAM.summary.TaskDashboard=new Class({Implements:[Options,Events],options:{style:"default"},initialize:function(t,i,o){this.setOptions(o),this.summary=t,this.app=this.summary.app,this.css=this.app.css,this.container=$(i),this.load()},load:function(){this.node=new Element("div",{styles:this.css.taskDashboardNode}).inject(this.container),this.taskElapsed=new MWF.xApplication.BAM.summary.TaskDashboard.TaskElapsed(this),this.workElapsed=new MWF.xApplication.BAM.summary.TaskDashboard.WorkElapsed(this),this.taskElapsedCount=new MWF.xApplication.BAM.summary.TaskDashboard.TaskElapsedCount(this),this.workElapsedCount=new MWF.xApplication.BAM.summary.TaskDashboard.WorkElapsedCount(this)},destroy:function(){this.taskElapsed.destroy(),this.workElapsed.destroy(),this.taskElapsedCount.destroy(),this.workElapsedCount.destroy(),MWF.release(this)}}),MWF.xApplication.BAM.summary.TaskDashboard.TaskChart=new Class({initialize:function(t){this.dashboard=t,this.app=this.dashboard.app,this.css=this.app.css,this.container=this.dashboard.node,this.categoryData=this.dashboard.summary.categoryData,this.status="dashboard",this.load()},load:function(){this.node=new Element("div",{styles:this.css.taskChartNode}).inject(this.container),this.titleNode=new Element("div",{styles:this.css.taskChartTitleNode}).inject(this.node),this.chartNode=new Element("div",{styles:this.css.taskChartChartNode}).inject(this.node),this.actionNode=new Element("div",{styles:this.css.taskChartActionNode}).inject(this.node),this.setTitle(),this.createActions(),this.draw()},draw:function(){MWF.require("MWF.widget.chart.Dashboard",function(){var t=0,i=0;this.categoryData.application&&this.categoryData.application.length&&this.categoryData.application.each((function(o){i+=o.taskCount,t+=o.taskDuration})),this.taskCount=i;var o=100*Math.round(t/i/60)/100;this.chart=new MWF.widget.chart.Dashboard(this.chartNode,o,{domain:[0,72]}),this.chart.load()}.bind(this))},setTitle:function(){this.titleNode.set("text",this.app.lp.taskElapsedTitle)},createActions:function(){this.proportionAction=new Element("div",{styles:this.css.taskChartProportionAction,text:this.app.lp.proportion}).inject(this.actionNode),this.distributionAction=new Element("div",{styles:this.css.taskChartDistributionAction,text:this.app.lp.distribution}).inject(this.actionNode),this.proportionAction.addEvent("click",function(){this.proportion()}.bind(this)),this.distributionAction.addEvent("click",function(){this.distribution()}.bind(this))},proportion:function(){switch(this.status){case"dashboard":this.status="proportion",this.changeToProportion();break;case"proportion":this.status="dashboard",this.changeToDashboard();break;case"distribution":this.status="proportion",this.changeToProportion()}},distribution:function(){switch(this.status){case"dashboard":case"proportion":this.status="distribution",this.changeToDistribution();break;case"distribution":this.status="dashboard",this.changeToDashboard()}},changeToDashboard:function(){this.proportionAction&&this.proportionAction.setStyles(this.css.taskChartProportionAction_back),this.distributionAction&&this.distributionAction.setStyles(this.css.taskChartDistributionAction),this.proportionChart&&this.proportionChart.hide(),this.distributionChart&&this.distributionChart.hide(),this.chart&&this.chart.show()},changeToProportion:function(){this.proportionAction&&this.proportionAction.setStyles(this.css.taskChartProportionAction_current),this.distributionAction&&this.distributionAction.setStyles(this.css.taskChartDistributionAction),this.getProportionData(function(){this.chart&&this.chart.hide(),this.distributionChart&&this.distributionChart.hide(),this.proportionChart?this.proportionChart.show():MWF.require("MWF.widget.chart.Pie",function(){this.proportionChart=new MWF.widget.chart.Pie(this.chartNode,this.proportionData,{dataFormat:".1%"}),this.proportionChart.load()}.bind(this))}.bind(this))},changeToDistribution:function(){this.proportionAction&&this.proportionAction.setStyles(this.css.taskChartProportionAction),this.distributionAction&&this.distributionAction.setStyles(this.css.taskChartDistributionAction_current),this.getDistributionData(function(){this.chart&&this.chart.hide(),this.proportionChart&&this.proportionChart.hide(),this.distributionChart?this.distributionChart.show():MWF.require("MWF.widget.chart.Pie",function(){this.distributionChart=new MWF.widget.chart.Pie(this.chartNode,this.distributionData,{dataFormat:".1%"}),this.distributionChart.load()}.bind(this))}.bind(this))},destroy:function(){this.chart&&this.chart.destroy(),this.proportionChart&&this.proportionChart.destroy(),this.distributionChart&&this.distributionChart.destroy(),MWF.release(this)}}),MWF.xApplication.BAM.summary.TaskDashboard.TaskElapsed=new Class({Extends:MWF.xApplication.BAM.summary.TaskDashboard.TaskChart,createActions:function(){this.proportionAction=new Element("div",{styles:this.css.taskChartProportionAction_one,text:this.app.lp.proportion}).inject(this.actionNode),this.proportionAction.addEvent("click",function(){this.proportion()}.bind(this))},getProportionData:function(t){this.proportionData?t&&t():this.dashboard.summary.loadRunningData(function(){var i=this.dashboard.summary.runningData.task,o=[],s=this.dashboard.app.lp.taskElapsed,a=i.halfDay+i.oneDay+i.twoDay+i.threeDay+i.moreDay;o.push({name:s.halfDay,value:i.halfDay/a}),o.push({name:s.oneDay,value:i.oneDay/a}),o.push({name:s.twoDay,value:i.twoDay/a}),o.push({name:s.threeDay,value:i.threeDay/a}),o.push({name:s.moreDay,value:i.moreDay/a}),this.proportionData=o,t&&t()}.bind(this))},getDistributionData:function(t){this.distributionData?t&&t():this.app.actions.getTaskElapsedPercent(function(i){this.distributionData=i.data,t&&t()}.bind(this))}}),MWF.xApplication.BAM.summary.TaskDashboard.WorkElapsed=new Class({Extends:MWF.xApplication.BAM.summary.TaskDashboard.TaskChart,setTitle:function(){this.titleNode.set("text",this.app.lp.workElapsedTitle)},createActions:function(){this.proportionAction=new Element("div",{styles:this.css.taskChartProportionAction_one,text:this.app.lp.proportion}).inject(this.actionNode),this.proportionAction.addEvent("click",function(){this.proportion()}.bind(this))},draw:function(){MWF.require("MWF.widget.chart.Dashboard",function(){var t=0,i=0;this.categoryData.application&&this.categoryData.application.length&&this.categoryData.application.each((function(o){i+=o.workCount,t+=o.workDuration})),this.workCount=i;var o=100*Math.round(t/i/60)/100;this.chart=new MWF.widget.chart.Dashboard(this.chartNode,o,{domain:[0,720]}),this.chart.load()}.bind(this))},getProportionData:function(t){this.proportionData?t&&t():this.dashboard.summary.loadRunningData(function(){var i=this.dashboard.summary.runningData.work,o=[],s=this.dashboard.app.lp.workElapsed,a=i.threeDay+i.oneWeek+i.twoWeek+i.oneMonth+i.moreMonth;o.push({name:s.threeDay,value:i.threeDay/a}),o.push({name:s.oneWeek,value:i.oneWeek/a}),o.push({name:s.twoWeek,value:i.twoWeek/a}),o.push({name:s.oneMonth,value:i.oneMonth/a}),o.push({name:s.moreMonth,value:i.moreMonth/a}),this.proportionData=o,t&&t()}.bind(this))}}),MWF.xApplication.BAM.summary.TaskDashboard.TaskElapsedCount=new Class({Extends:MWF.xApplication.BAM.summary.TaskDashboard.TaskChart,setTitle:function(){this.titleNode.set("text",this.app.lp.taskElapsedCountTitle)},createActions:function(){this.proportionAction=new Element("div",{styles:this.css.taskChartProportionAction,text:this.app.lp.count}).inject(this.actionNode),this.distributionAction=new Element("div",{styles:this.css.taskChartDistributionAction,text:this.app.lp.distribution}).inject(this.actionNode),this.proportionAction.addEvent("click",function(){this.proportion()}.bind(this)),this.distributionAction.addEvent("click",function(){this.distribution()}.bind(this))},draw:function(){MWF.require("MWF.widget.chart.Dashboard",function(){var t=0,i=0;this.categoryData.application&&this.categoryData.application.length&&this.categoryData.application.each((function(o){i+=o.taskExpiredCount,t+=o.taskCount})),this.taskCount=t;var o=Math.round(i/t*100*100)/100;this.chart=new MWF.widget.chart.Dashboard(this.chartNode,o,{domain:[0,100],text:o+"%"}),this.chart.load()}.bind(this))},changeToProportion:function(){if(this.proportionAction&&this.proportionAction.setStyles(this.css.taskChartProportionAction_current),this.distributionAction&&this.distributionAction.setStyles(this.css.taskChartDistributionAction),this.chart&&this.chart.hide(),this.distributionChart&&this.distributionChart.hide(),this.proportionChart)this.proportionChart.show();else{var t=0,i=0;this.categoryData.application&&this.categoryData.application.length&&this.categoryData.application.each((function(o){i+=o.taskExpiredCount,t+=o.taskCount})),this.proportionChart=new MWF.widget.chart.Dashboard(this.chartNode,i,{domain:[0,t]}),this.proportionChart.load()}},changeToDistribution:function(){this.proportionAction&&this.proportionAction.setStyles(this.css.taskChartProportionAction),this.distributionAction&&this.distributionAction.setStyles(this.css.taskChartDistributionAction_current),this.getDistributionData(),this.chart&&this.chart.hide(),this.proportionChart&&this.proportionChart.hide(),this.distributionChart?this.distributionChart.show():MWF.require("MWF.widget.chart.Pie",function(){this.distributionChart=new MWF.widget.chart.Pie(this.chartNode,this.distributionData),this.distributionChart.load()}.bind(this))},getDistributionData:function(t){if(this.distributionData)t&&t();else{var i=this.categoryData.application?Array.clone(this.categoryData.application):[];i.sort((function(t,i){return t.taskExpiredCount>i.taskExpiredCount}));var o=[],s=0,a=0;i.each(function(t){a/this.taskCount>.8||o.length>5?s+=t.taskExpiredCount:t.taskExpiredCount&&(o.push({name:t.name,value:t.taskExpiredCount}),a+=t.taskExpiredCount)}.bind(this)),s>0&&o.push({name:this.app.lp.other,value:s}),this.distributionData=o}}}),MWF.xApplication.BAM.summary.TaskDashboard.WorkElapsedCount=new Class({Extends:MWF.xApplication.BAM.summary.TaskDashboard.TaskElapsedCount,setTitle:function(){this.titleNode.set("text",this.app.lp.workElapsedCountTitle)},draw:function(){MWF.require("MWF.widget.chart.Dashboard",function(){var t=0,i=0;this.categoryData.application&&this.categoryData.application.length&&this.categoryData.application.each((function(o){i+=o.workExpiredCount,t+=o.workCount})),this.workCount=t;var o=Math.round(i/t*100*100)/100;this.chart=new MWF.widget.chart.Dashboard(this.chartNode,o,{domain:[0,100],text:o+"%"}),this.chart.load()}.bind(this))},changeToProportion:function(){if(this.proportionAction&&this.proportionAction.setStyles(this.css.taskChartProportionAction_current),this.distributionAction&&this.distributionAction.setStyles(this.css.taskChartDistributionAction),this.chart&&this.chart.hide(),this.distributionChart&&this.distributionChart.hide(),this.proportionChart)this.proportionChart.show();else{var t=0,i=0;this.categoryData.application&&this.categoryData.application.length&&this.categoryData.application.each((function(o){i+=o.workExpiredCount,t+=o.workCount})),this.proportionChart=new MWF.widget.chart.Dashboard(this.chartNode,i,{domain:[0,t]}),this.proportionChart.load()}},changeToDistribution:function(){this.proportionAction&&this.proportionAction.setStyles(this.css.taskChartProportionAction),this.distributionAction&&this.distributionAction.setStyles(this.css.taskChartDistributionAction_current),this.getDistributionData(),this.chart&&this.chart.hide(),this.proportionChart&&this.proportionChart.hide(),this.distributionChart?this.distributionChart.show():MWF.require("MWF.widget.chart.Pie",function(){this.distributionChart=new MWF.widget.chart.Pie(this.chartNode,this.distributionData),this.distributionChart.load()}.bind(this))},getDistributionData:function(t){if(this.distributionData)t&&t();else{var i=this.categoryData.application?Array.clone(this.categoryData.application):[];i.sort((function(t,i){return t.workExpiredCount>i.workExpiredCount}));var o=[],s=0,a=0;i.each(function(t){a/this.workCount>.8||o.length>5?s+=t.workExpiredCount:t.workExpiredCount&&(o.push({name:t.name,value:t.workExpiredCount}),a+=t.workExpiredCount)}.bind(this)),s>0&&o.push({name:this.app.lp.other,value:s}),this.distributionData=o}}});