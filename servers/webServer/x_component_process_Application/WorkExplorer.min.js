MWF.require("MWF.widget.Mask",null,!1),MWF.require("MWF.widget.O2Identity",null,!1),MWF.xDesktop.requireApp("Selector","package",null,!1),MWF.xDesktop.requireApp("process.ProcessManager","DictionaryExplorer",null,!1),MWF.xApplication.process.Application.WorkExplorer=new Class({Extends:MWF.xApplication.process.ProcessManager.DictionaryExplorer,Implements:[Options,Events],initialize:function(e,t,s){this.setOptions(s),this.setTooltip(),this.path="../x_component_process_Application/$WorkExplorer/",this.cssPath="../x_component_process_Application/$WorkExplorer/"+this.options.style+"/css.wcss",this._loadCss(),this.actions=t,this.node=$(e),this.items=[],this.works={},this.filter=null,this.isItemsLoaded=!1,this.isItemLoadding=!1,this.loadItemQueue=0,this.pageCount=20,this.initData()},load:function(){this.loadToolbar(),this.loadFilterNode(),this.loadFilterConditionNode(),this.loadContentNode(),this.setNodeScroll(),this.mask=new MWF.widget.Mask({style:"desktop"}),this.mask.loadNode(this.node),this.loadElementList()},createSearchElementNode:function(){this.toCompletedNode=new Element("div",{styles:this.css.toCompletedNode,text:this.app.lp.toCompleted}).inject(this.toolbarNode),this.toCompletedNode.addEvents({mouseover:function(){this.toCompletedNode.setStyles(this.css.toCompletedNode_over)}.bind(this),mouseout:function(){this.toCompletedNode.setStyles(this.css.toCompletedNode)}.bind(this),click:function(){this.app.workCompletedConfig()}.bind(this)})},clearWorks:function(){MWF.release(this.items),this.isCountShow=!1,this.works=null,this.items=[],this.works={},this.elementContentListNode.empty(),this.isItemsLoaded=!1,this.isItemLoadding=!1,this.loadItemQueue=0},loadFilterNode:function(){this.filterNode=new Element("div",{styles:this.css.filterNode}).inject(this.node),this.filterAllProcessNode=new Element("div",{styles:this.css.filterAllProcessNode,text:this.app.lp.all}).inject(this.filterNode),new Element("span",{styles:this.css.filterAllProcessCountNode}).inject(this.filterAllProcessNode),this.filterAllProcessNode.addEvent("click",function(){this.currentProcessNode&&this.currentProcessNode.setStyles(this.css.filterProcessNode),this.currentProcessNode=null,this.filter=null,this.reloadWorks()}.bind(this)),this.filterActionAreaNode=new Element("div",{styles:this.css.filterActionAreaNode}).inject(this.filterNode),this.filterActionNode=new Element("div",{styles:this.css.filterActionNode,text:this.app.lp.filter}).inject(this.filterActionAreaNode),this.filterActionNode.addEvent("click",function(e){this.showOrHideFilter(),e.stopPropagation()}.bind(this)),this.filterProcessAreaNode=new Element("div",{styles:this.css.filterProcessAreaNode}).inject(this.filterNode),this.filterProcessListNode=new Element("div",{styles:this.css.filterProcessListNode}).inject(this.filterProcessAreaNode),this.loadProcess()},showOrHideFilter:function(){this.isFilterOpen?!this.filterAreaMorph&&this.filterAreaMorph.isRunning()||this.hideFilter():this.filterAreaMorph&&this.filterAreaMorph.isRunning()||this.showFilter()},showFilter:function(){this.filterActionNode.setStyles(this.css.filterActionNode_over),this.filterAreaNode||this.createFilterAreaNode(),this.filterAreaTipNode.setStyle("display","block"),this.filterAreaNode.setStyle("display","block"),this.resizeFilterAreaNode();this.isFilterOpen=!0,this.filterAreaMorph.start({width:"460px",height:"500px"}).chain(function(){this.createFilterAreaTitle(),this.createFilterAreaContent(),this.hideFilterFun=this.hideFilter.bind(this),$(document.body).addEvent("click",this.hideFilterFun)}.bind(this))},hideFilter:function(){if(this.filterAreaNode){this.filterAreaNode.empty(),this.isFilterOpen=!1,this.filterAreaMorph.start({width:"460px",height:"0px"}).chain(function(){this.filterAreaNode.eliminate("input"),this.filterAreaNode.setStyle("display","none"),this.filterAreaTipNode.setStyle("display","none"),this.filterActionNode.setStyles(this.css.filterActionNode),$(document.body).removeEvent("click",this.hideFilterFun)}.bind(this)),$(document.body).removeEvent("click",this.hideFilterFun)}},createFilterAreaNode:function(){this.filterAreaNode=new Element("div",{styles:this.css.filterAreaNode}).inject(this.app.content),this.filterAreaNode.addEvent("click",(function(e){e.stopPropagation()})),this.filterAreaTipNode=new Element("div",{styles:this.css.filterAreaTipNode}).inject(this.app.content),this.filterAreaNode.setStyles({width:"460px",height:"0px"}),this.filterAreaNode.position({relativeTo:this.filterNode,position:"bottomRight",edge:"upperRight",offset:{x:-20,y:-1}}),this.filterAreaTipNode.position({relativeTo:this.filterNode,position:"bottomRight",edge:"bottomRight",offset:{x:-38,y:0}}),this.app.addEvent("resize",function(){this.resizeFilterAreaNode()}.bind(this)),this.filterAreaMorph=new Fx.Morph(this.filterAreaNode,{duration:"100",transition:Fx.Transitions.Sine.easeInOut})},resizeFilterAreaNode:function(){this.filterAreaNode&&(this.filterAreaNode.position({relativeTo:this.filterNode,position:"bottomRight",edge:"upperRight",offset:{x:-20,y:-1}}),this.filterAreaTipNode&&this.filterAreaTipNode.position({relativeTo:this.filterNode,position:"bottomRight",edge:"bottomRight",offset:{x:-38,y:0}}))},createFilterAreaTitle:function(){var e=new Element("div",{styles:this.css.filterAreaTitleNode}).inject(this.filterAreaNode),t=new Element("div",{styles:this.css.filterAreaTitleActionOkNode,text:this.app.lp.ok}).inject(e);new Element("div",{styles:this.css.filterAreaTitleActionClearNode,text:this.app.lp.clear}).inject(e).addEvent("click",function(){this.filterAreaNode.getElements(".filterItem").each(function(e){this.unSelectedFilterItem(e)}.bind(this)),this.filterAreaNode.retrieve("input").set("value",""),this.filter=null,this.hideFilter(),this.reloadWorks()}.bind(this)),t.addEvent("click",function(){var e=this.filterAreaNode.retrieve("input");this.filter||(this.filter={});var t=e.get("value");t&&t!=this.app.lp.searchKey?this.filter.key=t:(this.filter.key="",delete this.filter.key),this.hideFilter(),this.reloadWorks()}.bind(this));var s=new Element("div",{styles:this.css.filterAreaTitleSearchNode}).inject(e),i=(new Element("div",{styles:this.css.filterAreaTitleSearchIconNode}).inject(s),new Element("div",{styles:this.css.filterAreaTitleSearchInputAreaNode}).inject(s)),o=new Element("input",{styles:this.css.filterAreaTitleSearchInputNode,value:this.app.lp.searchKey}).inject(i);this.filter&&this.filter.key&&o.set("value",this.filter.key),this.filterAreaNode.store("input",o);var n=this.app.lp.searchKey;o.addEvents({blur:function(){this.get("value")||this.set("value",n)},focus:function(){this.get("value")==n&&this.set("value","")},keydown:function(e){if(13==e.code){var t=this.filterAreaNode.retrieve("input");this.filter||(this.filter={});var s=t.get("value");s&&s!=this.app.lp.searchKey?this.filter.key=s:(this.filter.key="",delete this.filter.key),this.hideFilter(),this.reloadWorks()}}.bind(this)})},createFilterAreaContent:function(){var e=new Element("div",{styles:this.css.applicationFilterAreaContentScrollNode}).inject(this.filterAreaNode),t=new Element("div",{styles:{overflow:"hidden"}}).inject(e);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(e,{style:"xApp_filter",where:"after",distance:30,friction:4,axis:{x:!1,y:!0}})}.bind(this));var s=this;this._getFilterCount(function(e){var i=e.data;Object.each(i,function(e,i){new Element("div",{styles:this.css.applicationFilterCategoryNode}).inject(t).set("text",this.app.lp[i]);var o=new Element("div",{styles:this.css.applicationFilterItemAreaNode}).inject(t);e.each(function(e){if(e.value){var t=new Element("div",{styles:this.css.applicationFilterItemNode}).inject(o);t.set("text",e.name),t.store("value",e.value),t.store("textname",e.name),t.store("key",i),t.addEvent("click",(function(){this.hasClass("applicationFilterItemNode_over")?s.unSelectedFilterItem(this):s.selectedFilterItem(this)})),this.filter&&this.filter[i]&&this.filter[i].some((function(t){return t.value===e.value}))&&this.selectedFilterItem(t)}}.bind(this))}.bind(this))}.bind(this))},_getFilterCount:function(e){this.actions.listFilterAttributeManage(this.app.options.id,(function(t){e&&e(t)}))},unSelectedFilterItem:function(e){if(e.hasClass("applicationFilterItemNode_over")){var t=e.retrieve("value"),s=(e.retrieve("textname"),e.retrieve("key"));e.setStyles(this.css.applicationFilterItemNode),e.removeClass("applicationFilterItemNode_over"),e.addClass("applicationFilterItemNode"),this.filter?this.filter[s]&&(this.filter[s]=this.filter[s].filter((function(e){return e.value!=t})),this.filter[s].length||delete this.filter[s]):this.filter={},e.getParent().eliminate("current")}},selectedFilterItem:function(e){if(!e.hasClass("applicationFilterItemNode_over")){e.getParent().retrieve("current");var t=e.retrieve("value"),s=e.retrieve("key"),i=e.retrieve("textname");e.setStyles(this.css.applicationFilterItemNode_over),e.removeClass("applicationFilterItemNode"),e.addClass("applicationFilterItemNode_over"),this.filter||(this.filter={}),this.filter[s]||(this.filter[s]=[]),this.filter[s].some((function(e){return e.value===t}))||this.filter[s].push({value:t,name:i}),e.getParent().store("current",e)}},searchElement:function(){this.filter||(this.filter={});var e=this.searchElementInputNode.get("value");e&&e!=this.app.lp.searchKey&&(this.filter.key=e,this.hideFilter(),this.reloadWorks())},loadFilterConditionNode:function(){this.filterConditionNode=new Element("div",{styles:this.css.filterConditionNode}).inject(this.node),this.setFilterConditions()},setFilterConditions:function(){this.filterConditionNode.empty(),this.filter&&Object.keys(this.filter).length?(Object.each(this.filter,function(e,t){"key"!==t&&e.each(function(e){this.createFilterItemNode(t,e)}.bind(this))}.bind(this)),this.filter.key&&this.createFilterItemNode("key",{name:this.filter.key}),this.filterProcessListNode.setStyle("display","none")):this.filterProcessListNode.setStyle("display","block")},createFilterItemNode:function(e,t){var s=this,i=new Element("div",{styles:this.css.filterListItemNode}).inject(this.filterConditionNode),o=new Element("div",{styles:this.css.filterListItemActionNode}).inject(i);new Element("div",{styles:this.css.filterListItemTextNode}).inject(i).set("text",this.app.lp[e]+": "+t.name),o.store("key",e),o.store("value",t.name),o.store("valueId",t.value),i.addEvents({mouseover:function(){this.setStyles(s.css.filterListItemNode_over),this.getLast().setStyles(s.css.filterListItemTextNode_over),this.getFirst().setStyles(s.css.filterListItemActionNode_over)},mouseout:function(){this.setStyles(s.css.filterListItemNode),this.getLast().setStyles(s.css.filterListItemTextNode),this.getFirst().setStyles(s.css.filterListItemActionNode)}}),o.addEvent("click",(function(){var e=this.retrieve("key"),t=(this.retrieve("value"),this.retrieve("valueId"));s.filter[e]&&(s.filter[e]=s.filter[e].filter((function(e){return e.value!==t})),s.filter[e].length||delete s.filter[e]),this.destroy(),s.reloadWorks()}))},loadProcess:function(){this.actions.listProcessCountManage(this.app.options.id,function(e){e.data.each(function(e){this.loadProcessNode(e)}.bind(this))}.bind(this))},loadProcessNode:function(e){var t=new Element("div",{styles:this.css.filterProcessNode}).inject(this.filterProcessListNode);t.set("text",e.name+"("+e.count+")"),t.store("process",e);var s=this;t.addEvent("click",(function(){s.setCurrentProcess(this),s.reloadWorks()}))},setCurrentProcess:function(e){this.currentProcessNode&&this.currentProcessNode.setStyles(this.css.filterProcessNode),e.setStyles(this.css.filterProcessNode_current),this.currentProcessNode=e;var t=e.retrieve("process");this.filter={processList:[{name:t.name,value:t.value}]}},reloadWorks:function(){this.clearWorks(),this.setFilterConditions(),this.createWorkListHead(),this.loadElementList()},loadContentNode:function(){this.elementContentNode=new Element("div",{styles:this.css.elementContentNode}).inject(this.node),this.elementContentListNode=new Element("div",{styles:this.css.elementContentListNode}).inject(this.elementContentNode),this.createWorkListHead(),this.setContentSize(),this.setContentSizeFun=this.setContentSize.bind(this),this.app.addEvent("resize",this.setContentSizeFun)},setNodeScroll:function(){var e=this;this.elementContentNode.addEvent("scroll",(function(){var t=e.elementContentNode.scrollTop.toFloat(),s=e.elementContentNode.getScrollSize(),i=e.elementContentNode.getSize();t+200>s.y-i.y&&(e.isItemsLoaded||e.loadElementList())}))},createWorkListHead:function(){var e=new Element("div",{styles:this.css.workItemHeadNode}).inject(this.elementContentListNode),t="<div class='headArea1Node'><div class='checkAreaHeadNode'></div><div class='iconAreaHeadNode'></div><div class='titleAreaHeadNode'>"+this.app.lp.workTitle+"</div></div><div class='headArea2Node'><div class='statusAreaHeadNode'>"+this.app.lp.status+"</div><div class='activityAreaHeadNode'>"+this.app.lp.activity+"</div></div><div class='headArea3Node'><div class='actionAreaHeadNode'>"+this.app.lp.action+"</div><div class='expireAreaHeadNode'>"+this.app.lp.expire+"</div><div class='personAreaHeadNode'>"+this.app.lp.person+"</div></div>";e.set("html",t),e.getElement(".headArea1Node").setStyles(this.css.headArea1Node),e.getElement(".headArea2Node").setStyles(this.css.headArea2Node),e.getElement(".headArea3Node").setStyles(this.css.headArea3Node),e.getElement(".checkAreaHeadNode").setStyles(this.css.checkAreaHeadNode),e.getElement(".iconAreaHeadNode").setStyles(this.css.iconAreaHeadNode),e.getElement(".titleAreaHeadNode").setStyles(this.css.titleAreaHeadNode),e.getElement(".statusAreaHeadNode").setStyles(this.css.statusAreaHeadNode),e.getElement(".activityAreaHeadNode").setStyles(this.css.activityAreaHeadNode),e.getElement(".personAreaHeadNode").setStyles(this.css.personAreaHeadNode),e.getElement(".actionAreaHeadNode").setStyles(this.css.actionAreaHeadNode),e.getElement(".expireAreaHeadNode").setStyles(this.css.expireAreaHeadNode)},createCreateElementNode:function(){},setContentSize:function(){var e=this.toolbarNode.getSize(),t=this.node.getSize(),s=this.elementContentNode.getStyle("padding-top").toFloat(),i=this.elementContentNode.getStyle("padding-bottom").toFloat(),o=this.filterNode.getSize(),n=this.filterConditionNode.getSize(),r=t.y-e.y-s-i-o.y-n.y;this.elementContentNode.setStyle("height",r+"px"),this.pageCount=(r/40).toInt()+5,this.items.length<this.pageCount&&this.loadElementList(this.pageCount-this.items.length),this.options.noCreate&&this.createElementNode.destroy()},_getCurrentPageData:function(e,t){var s=this.items.length?this.items[this.items.length-1].data.id:"(0)";if(this.filter){var i={};Object.each(this.filter,(function(e,t){"key"!=t?(i[t]||(i[t]=[]),e.each((function(e){i[t].push(e.value)}))):i[t]=e})),this.actions.listWorkFilterManage(s,t||this.pageCount,this.app.options.id,i,(function(t){e&&e(t)}))}else this.actions.listWorkNextManage(s,t||this.pageCount,this.app.options.id,(function(t){e&&e(t)}))},loadElementList:function(e){this.isItemsLoaded||(this.isItemLoadding?this.loadItemQueue++:(this.isItemLoadding=!0,this._getCurrentPageData(function(e){this.count=e.count,this.isCountShow||(this.filterAllProcessNode.getFirst("span").set("text","("+this.count+")"),this.isCountShow=!0),e.count<=this.items.length&&(this.isItemsLoaded=!0),e.data.each(function(e){if(!this.works[e.id]){var t=this._createItem(e);this.items.push(t),this.works[e.id]=t}}.bind(this)),this.isItemLoadding=!1,this.loadItemQueue>0&&(this.loadItemQueue--,this.loadElementList()),this.mask.hide()}.bind(this),e)))},_createItem:function(e){return new MWF.xApplication.process.Application.WorkExplorer.Work(e,this)},removeWork:function(e,t){this.actions.removeWork(e.data.id,this.app.options.id,t,function(e){e.data.each(function(e){this.works[e.id].destroy(),this.items.erase(this.works[e.id]),MWF.release(this.works[e.id]),delete this.works[e.id]}.bind(this))}.bind(this))}}),MWF.xApplication.process.Application.WorkExplorer.Work=new Class({initialize:function(e,t,s){this.explorer=t,this.data=e,this.container=this.explorer.elementContentListNode,this.relative=s,this.css=this.explorer.css,this.tasks=[],this.dones=[],this.reads=[],this.readeds=[],this.taskChildren={},this.doneChildren={},this.readChildren={},this.readedChildren={},this.relativeWorks=[],this.load()},load:function(){this.node=new Element("div",{styles:this.css.workItemNode}),this.relative?this.node.inject(this.relative.node,"after"):this.node.inject(this.container),this.workAreaNode=new Element("div",{styles:this.css.workItemWorkNode}).inject(this.node);var e="<div class='area1Node'><div class='checkAreaNode'></div><div class='iconAreaNode'></div><div class='titleAreaNode'><div class='titleAreaTextNode'>"+(this.data.title||"")+"</div></div></div><div class='area2Node'><div class='statusAreaNode'></div><div class='activityAreaNode'><div class='activityAreaTextNode'>"+this.data.activityName+"</div></div></div><div class='area3Node'><div class='actionAreaNode'></div><div class='expireAreaNode'></div><div class='personAreaNode'></div></div>";if(this.workAreaNode.set("html",e),this.workAreaNode.getElement(".area1Node").setStyles(this.css.headArea1Node),this.workAreaNode.getElement(".area2Node").setStyles(this.css.headArea2Node),this.workAreaNode.getElement(".area3Node").setStyles(this.css.headArea3Node),this.checkAreaNode=this.workAreaNode.getElement(".checkAreaNode").setStyles(this.css.checkAreaHeadNode),this.iconAreaNode=this.workAreaNode.getElement(".iconAreaNode").setStyles(this.css.iconAreaHeadNode),this.titleAreaNode=this.workAreaNode.getElement(".titleAreaNode").setStyles(this.css.titleAreaHeadNode),this.statusAreaNode=this.workAreaNode.getElement(".statusAreaNode").setStyles(this.css.statusAreaHeadNode),this.activityAreaNode=this.workAreaNode.getElement(".activityAreaNode").setStyles(this.css.activityAreaHeadNode),this.personAreaNode=this.workAreaNode.getElement(".personAreaNode").setStyles(this.css.personAreaHeadNode),this.actionAreaNode=this.workAreaNode.getElement(".actionAreaNode").setStyles(this.css.actionAreaHeadNode),this.expireAreaNode=this.workAreaNode.getElement(".expireAreaNode").setStyles(this.css.expireAreaHeadNode),this.activityAreaTextNode=this.workAreaNode.getElement(".activityAreaTextNode").setStyles(this.css.activityAreaTextNode),this.titleAreaTextNode=this.workAreaNode.getElement(".titleAreaTextNode").setStyles(this.css.titleAreaTextNode),this.data.expireTime){var t=Date.parse(this.data.expireTime);(new Date).diff(t,"second")<0&&this.expireAreaNode.setStyle("color","#FF0000"),this.expireAreaNode.set("text",this.data.expireTime)}else this.expireAreaNode.set("text",this.explorer.app.lp.noExpire);this.expireAreaNode.setStyles(this.css.expireAreaNode),this.data.control.allowVisit||(this.node.setStyles(this.css.workItemNode_noread),this.checkAreaNode.setStyles(this.css.actionStopWorkNode),this.actionAreaNode.setStyles(this.css.actionStopWorkActionNode)),this.iconAreaNode.setStyles(this.css.iconWorkNode),this.titleAreaNode.setStyles(this.css.titleWorkNode),this.setPersonData(),this.setStatusData(),this.setActions(),this.setEvents(),this.relative||this.listRelatives()},reload:function(e){this.relative?this.relative.reload():this.explorer.actions.getWork(this.data.id,function(t){this.data=t.data,this.titleAreaTextNode.set("text",this.data.title||""),this.activityAreaTextNode.set("text",this.data.activityName),this.statusAreaNode.empty(),this.setStatusData(),this.relativeWorks.length&&this.relativeWorks.each((function(e){e.destroy()})),this.relativeWorks=[],this.listRelatives(),e&&e()}.bind(this))},listRelatives:function(){this.data.splitting&&this.explorer.actions.listRelatives(this.data.id,function(e){e.data&&e.data.length&&this.loadRelativeWorks(e.data)}.bind(this))},loadRelativeWorks:function(e){this.checkAreaNode.setStyles(this.css.relativeTop),this.workAreaNode.setStyle("height","40px");for(var t=e.length-1;t>=0;t--){var s=e[t];if(i=this.explorer.works[s.id])i.node.inject(this.node,"after"),i.relative=this;else{var i=new MWF.xApplication.process.Application.WorkExplorer.Work(s,this.explorer,this);this.explorer.works[s.id]=i}i.workAreaNode.setStyle("height","40px"),t==e.length-1?i.checkAreaNode.setStyles(this.css.relativeBottom):i.checkAreaNode.setStyles(this.css.relativeCenter),this.relativeWorks.push(i)}},setEvents:function(){this.openNode&&this.openNode.addEvents({mouseover:function(){this.openNode.setStyles(this.css.actionOpenNode_over)}.bind(this),mouseout:function(){this.openNode.setStyles(this.css.actionOpenNode)}.bind(this),mousedown:function(){this.openNode.setStyles(this.css.actionOpenNode_down)}.bind(this),mouseup:function(){this.openNode.setStyles(this.css.actionOpenNode_over)}.bind(this),click:function(e){this.openWork(e)}.bind(this)}),this.processNode&&this.processNode.addEvents({mouseover:function(){this.processNode.setStyles(this.css.actionProcessNode_over)}.bind(this),mouseout:function(){this.processNode.setStyles(this.css.actionProcessNode)}.bind(this),mousedown:function(){this.processNode.setStyles(this.css.actionProcessNode_down)}.bind(this),mouseup:function(){this.processNode.setStyles(this.css.actionProcessNode_over)}.bind(this),click:function(e){this.processWork(e)}.bind(this)}),this.rerouteNode&&this.rerouteNode.addEvents({mouseover:function(){this.rerouteNode.setStyles(this.css.actionRerouteNode_over)}.bind(this),mouseout:function(){this.rerouteNode.setStyles(this.css.actionRerouteNode)}.bind(this),mousedown:function(){this.rerouteNode.setStyles(this.css.actionRerouteNode_down)}.bind(this),mouseup:function(){this.rerouteNode.setStyles(this.css.actionRerouteNode_over)}.bind(this),click:function(e){this.rerouteWork(e)}.bind(this)}),this.deleteNode&&this.deleteNode.addEvents({mouseover:function(){this.deleteNode.setStyles(this.css.actionDeleteNode_over)}.bind(this),mouseout:function(){this.deleteNode.setStyles(this.css.actionDeleteNode)}.bind(this),mousedown:function(){this.deleteNode.setStyles(this.css.actionDeleteNode_down)}.bind(this),mouseup:function(){this.deleteNode.setStyles(this.css.actionDeleteNode_over)}.bind(this),click:function(e){this.remove(e)}.bind(this)}),this.data.control.allowVisit&&(this.workAreaNode.addEvents({mouseover:function(){this.readyRemove||this.readyFlow||this.workAreaNode.setStyles(this.css.workItemWorkNode_over)}.bind(this),mouseout:function(){this.readyRemove||this.readyFlow||this.workAreaNode.setStyles(this.css.workItemWorkNode)}.bind(this)}),this.titleAreaNode.addEvent("click",function(){this.loadChild()}.bind(this)))},processWork:function(e){var t=this.explorer.app.lp,s=t.flowWork.replace(/{title}/g,this.data.title||""),i=this;this.workAreaNode.setStyles(this.css.workItemWorkNode_action),this.readyFlow=!0,this.explorer.app.confirm("warn",e,t.flowWorkTitle,s,380,130,(function(){i.explorer.actions.flowWork(i.data.id,{},function(e){e.data.id?i.explorer.actions.getWork(i.data.id,function(e){i.workAreaNode.setStyles(i.css.workItemWorkNode),i.readyFlow=!1,i.reload()}.bind(this)):i.reload(),this.close()}.bind(this),function(){i.workAreaNode.setStyles(i.css.workItemWorkNode),i.readyFlow=!1,i.reload(),this.close()}.bind(this))}),(function(){i.workAreaNode.setStyles(i.css.workItemWorkNode),i.readyFlow=!1,this.close()}))},rerouteWork:function(){var e=this.explorer.app.lp;this.workAreaNode.setStyles(this.css.workItemWorkNode_action),this.readyReroute=!0,MWF.require("MWF.xDesktop.Dialog",function(){var t=MWF.getCenterPosition(this.explorer.app.content,560,260),s=this;new MWF.xDesktop.Dialog({title:e.reroute,style:"work",top:t.y-100,left:t.x,fromTop:t.y-100,fromLeft:t.x,width:560,height:260,url:this.explorer.app.path+"reroute.html",container:this.explorer.app.content,isClose:!0,onPostShow:function(){$("rerouteWork_okButton").addEvent("click",function(){s.doRerouteWork(this)}.bind(this)),$("rerouteWork_cancelButton").addEvent("click",function(){this.close()}.bind(this));var e=$("rerouteWork_selectActivity");s.explorer.actions.getRerouteTo(s.data.process,function(t){t.data.agentList&&t.data.agentList.each(function(t){new Element("option",{value:t.id+"#agent",text:t.name}).inject(e)}.bind(s)),t.data.cancelList&&t.data.cancelList.each(function(t){new Element("option",{value:t.id+"#cancel",text:t.name}).inject(e)}.bind(s)),t.data.choiceList&&t.data.choiceList.each(function(t){new Element("option",{value:t.id+"#choice",text:t.name}).inject(e)}.bind(s)),t.data.conditionList&&t.data.conditionList.each(function(t){new Element("option",{value:t.id+"#condition",text:t.name}).inject(e)}.bind(s)),t.data.delayList&&t.data.delayList.each(function(t){new Element("option",{value:t.id+"#delay",text:t.name}).inject(e)}.bind(s)),t.data.embedList&&t.data.embedList.each(function(t){new Element("option",{value:t.id+"#embed",text:t.name}).inject(e)}.bind(s)),t.data.endList&&t.data.endList.each(function(t){new Element("option",{value:t.id+"#end",text:t.name}).inject(e)}.bind(s)),t.data.invokeList&&t.data.invokeList.each(function(t){new Element("option",{value:t.id+"#invoke",text:t.name}).inject(e)}.bind(s)),t.data.manualList&&t.data.manualList.each(function(t){new Element("option",{value:t.id+"#manual",text:t.name}).inject(e)}.bind(s)),t.data.mergeList&&t.data.mergeList.each(function(t){new Element("option",{value:t.id+"#merge",text:t.name}).inject(e)}.bind(s)),t.data.messageList&&t.data.messageList.each(function(t){new Element("option",{value:t.id+"#message",text:t.name}).inject(e)}.bind(s)),t.data.parallelList&&t.data.parallelList.each(function(t){new Element("option",{value:t.id+"#parallel",text:t.name}).inject(e)}.bind(s)),t.data.serviceList&&t.data.serviceList.each(function(t){new Element("option",{value:t.id+"#service",text:t.name}).inject(e)}.bind(s)),t.data.splitList&&t.data.splitList.each(function(t){new Element("option",{value:t.id+"#split",text:t.name}).inject(e)}.bind(s))}.bind(s)),this.content.getElement(".rerouteWork_selPeopleButton").addEvent("click",function(){s.selectReroutePeople(this)}.bind(this))}}).show()}.bind(this))},selectReroutePeople:function(e){var t=e.identityList||[],s=e.content.getElement(".rerouteWork_selPeopleArea"),i={values:t,type:"identity",count:0,title:this.explorer.app.lp.reroute,onComplete:function(t){s.empty();var i=[];t.each(function(e){new MWF.widget.O2Identity(e.data,s,{style:"reset"}),i.push(e.data.distinguishedName)}.bind(this)),e.identityList=i}.bind(this)};MWF.xDesktop.requireApp("Selector","package",function(){new MWF.O2Selector(this.explorer.app.content,i)}.bind(this))},doRerouteWork:function(e){var t=$("rerouteWork_opinion").get("value"),s=$("rerouteWork_selectActivity"),i=s.options[s.selectedIndex].get("value"),o=(s.options[s.selectedIndex].get("text"),i.split("#"));i=o[0];var n=o[1],r=[];(e.identityList||[]).each((function(e){r.push(e)})),MWF.require("MWF.widget.Mask",function(){this.mask=new MWF.widget.Mask({style:"desktop",zIndex:5e4}),this.mask.loadNode(this.explorer.app.content),this.rerouteWorkToActivity(i,n,t,r,function(){this.explorer.actions.getWork(this.data.id,function(e){this.data=e.data,this.workAreaNode.setStyles(this.css.workItemWorkNode),this.readyReroute=!1,this.reload()}.bind(this)),e.close(),this.mask&&(this.mask.hide(),this.mask=null)}.bind(this),function(t,s,i){var o=i+":"+s;t&&(o=t.responseText),this.app.notice("request json error: "+o,"error",e.node),this.mask&&(this.mask.hide(),this.mask=null)}.bind(this))}.bind(this))},rerouteWorkToActivity:function(e,t,s,i,o,n){var r={activity:e,activityType:t,mergeWork:!1,manualForceTaskIdentityList:i};o2.Actions.load("x_processplatform_assemble_surface").WorkAction.V2Reroute(this.data.id,r,function(){o&&o()}.bind(this),(function(e,t,s){n&&n(e,t,s)}))},openWork:function(e){var t={workId:this.data.id,isControl:this.explorer.app.options.application.allowControl};this.explorer.app.desktop.openApplication(e,"process.Work",t)},remove:function(e){var t=this.explorer.app.lp,s=t.deleteWork.replace(/{title}/g,this.data.title||""),i=this;this.workAreaNode.setStyles(this.css.workItemWorkNode_remove),this.readyRemove=!0,this.explorer.app.confirm("warn",e,t.deleteWorkTitle,s,350,120,(function(){this.close(),i.explorer.app.confirm("warn",e,t.deleteWorkTitle,{html:t.deleteAllWork},400,220,(function(){for(var e=this.content.getElements("input"),s="",o=0;o<e.length;o++)if(e[o].checked){s=e[o].get("value");break}s?("all"==s?i.explorer.removeWork(i,!0):i.explorer.removeWork(i,!1),this.close()):this.content.getElement("#deleteWork_checkInfor").set("text",t.deleteAllWorkCheck).setStyle("color","red")}),(function(){i.workAreaNode.setStyles(i.css.workItemWorkNode),this.close()}))}),(function(){i.workAreaNode.setStyles(i.css.workItemWorkNode),i.readyRemove=!1,this.close()}))},destroy:function(){this.node.destroy()},loadChild:function(){this.childNode?"none"==this.childNode.getStyle("display")?this.childNode.setStyle("display","block"):this.childNode.setStyle("display","none"):(this.createChildNode(),this.listAssignments())},createChildNode:function(){this.childNode=new Element("div",{styles:this.css.workItemChildNode}).inject(this.node),this.taskAreaNode=new Element("div",{styles:this.css.workItemTaskNode}).inject(this.childNode),this.doneAreaNode=new Element("div",{styles:this.css.workItemDonwNode}).inject(this.childNode),this.readAreaNode=new Element("div",{styles:this.css.workItemReadNode}).inject(this.childNode),this.readedAreaNode=new Element("div",{styles:this.css.workItemReadedNode}).inject(this.childNode),this.taskAreaTitleAreaNode=new Element("div",{styles:this.css.workItemListTitleNode}).inject(this.taskAreaNode),this.doneAreaTitleAreaNode=new Element("div",{styles:this.css.workItemListTitleNode}).inject(this.doneAreaNode),this.readAreaTitleAreaNode=new Element("div",{styles:this.css.workItemListTitleNode}).inject(this.readAreaNode),this.readedAreaTitleAreaNode=new Element("div",{styles:this.css.workItemListTitleNode}).inject(this.readedAreaNode);new Element("div",{styles:this.css.workItemTaskTitleNode,text:this.explorer.app.lp.task}).inject(this.taskAreaTitleAreaNode),new Element("div",{styles:this.css.workItemDoneTitleNode,text:this.explorer.app.lp.done}).inject(this.doneAreaTitleAreaNode),new Element("div",{styles:this.css.workItemReadTitleNode,text:this.explorer.app.lp.read}).inject(this.readAreaTitleAreaNode),new Element("div",{styles:this.css.workItemReadedTitleNode,text:this.explorer.app.lp.readed}).inject(this.readedAreaTitleAreaNode);this.taskAreaContentNode=new Element("div",{styles:this.css.taskAreaContentNode}).inject(this.taskAreaNode),this.doneAreaContentNode=new Element("div",{styles:this.css.doneAreaContentNode}).inject(this.doneAreaNode),this.readAreaContentNode=new Element("div",{styles:this.css.readAreaContentNode}).inject(this.readAreaNode),this.readedAreaContentNode=new Element("div",{styles:this.css.readedAreaContentNode}).inject(this.readedAreaNode)},listAssignments:function(){this.explorer.actions.listAssignments(this.data.id,function(e){this.listTasks(e.data.taskList),this.listDones(e.data.taskCompletedList),this.listReads(e.data.readList),this.listReadeds(e.data.readCompletedList)}.bind(this))},listTasks:function(e){e.length?e.each(function(e){var t=new MWF.xApplication.process.Application.WorkExplorer.Task(e,this.taskAreaContentNode,this.explorer,this);this.tasks.push(t),this.taskChildren[e.id]=t}.bind(this)):new Element("div",{styles:this.css.noListText,text:"［"+this.explorer.app.lp.noTask+"］"}).inject(this.taskAreaTitleAreaNode)},listDones:function(e){e.length?e.each(function(e){var t=new MWF.xApplication.process.Application.WorkExplorer.Done(e,this.doneAreaContentNode,this.explorer,this);this.dones.push(t),this.doneChildren[e.id]=t}.bind(this)):new Element("div",{styles:this.css.noListText,text:"［"+this.explorer.app.lp.noDone+"］"}).inject(this.doneAreaTitleAreaNode)},listReads:function(e){e.length?e.each(function(e){var t=new MWF.xApplication.process.Application.WorkExplorer.Read(e,this.readAreaContentNode,this.explorer,this);this.reads.push(t),this.readChildren[e.id]=t}.bind(this)):new Element("div",{styles:this.css.noListText,text:"［"+this.explorer.app.lp.noRead+"］"}).inject(this.readAreaTitleAreaNode)},listReadeds:function(e){e.length?e.each(function(e){var t=new MWF.xApplication.process.Application.WorkExplorer.Readed(e,this.readedAreaContentNode,this.explorer,this);this.readeds.push(t),this.readedChildren[e.id]=t}.bind(this)):new Element("div",{styles:this.css.noListText,text:"［"+this.explorer.app.lp.noReaded+"］"}).inject(this.readedAreaTitleAreaNode)},setPersonData:function(){this.personAreaNode.set("text",MWF.name.cn(this.data.creatorIdentity)+"("+(this.data.creatorUnit?MWF.name.cn(this.data.creatorUnit):"")+")")},setStatusData:function(){this.createStatusIcon("start"),this.createStatusIcon("processing"),this.createStatusIcon("hanging"),this.statusAreaNode.set("title",this.explorer.app.lp[this.data.workStatus])},createStatusIcon:function(e){var t=new Element("div",{styles:this.css.statusIconNode}).inject(this.statusAreaNode),s=this.data.workStatus==e?"status_"+e+"_red.png":"status_"+e+".png",i="url(../x_component_process_Application/$WorkExplorer/"+this.explorer.options.style+"/icon/"+s+")";t.setStyle("background-image",i)},setActions:function(){this.data.control.allowVisit&&(this.openNode=new Element("div",{styles:this.css.actionOpenNode,title:this.explorer.app.lp.open}).inject(this.actionAreaNode)),this.data.control.allowReroute&&(this.processNode=new Element("div",{styles:this.css.actionProcessNode,title:this.explorer.app.lp.flowManager}).inject(this.actionAreaNode)),this.data.control.allowReroute&&(this.rerouteNode=new Element("div",{styles:this.css.actionRerouteNode,title:this.explorer.app.lp.reroute}).inject(this.actionAreaNode)),this.data.control.allowDelete&&(this.deleteNode=new Element("div",{styles:this.css.actionDeleteNode,title:this.explorer.app.lp.delete}).inject(this.actionAreaNode))},removeTask:function(e){var t=e.data.id;this.explorer.actions.removeTask(t,function(e){this.tasks.erase(this.taskChildren[t]),this.taskChildren[t].destroy(),MWF.release(this.taskChildren[t]),delete this.taskChildren[t]}.bind(this))},removeDone:function(e){var t=e.data.id;this.explorer.actions.removeDone(t,function(e){this.dones.erase(this.doneChildren[t]),this.doneChildren[t].destroy(),MWF.release(this.doneChildren[t]),delete this.doneChildren[t]}.bind(this))},removeRead:function(e){var t=e.data.id;this.explorer.actions.removeRead(t,function(e){this.reads.erase(this.readChildren[t]),this.readChildren[t].destroy(),MWF.release(this.readChildren[t]),delete this.readChildren[t]}.bind(this))},removeReaded:function(e){var t=e.data.id;this.explorer.actions.removeReaded(t,function(e){this.readeds.erase(this.readedChildren[t]),this.readedChildren[t].destroy(),MWF.release(this.readedChildren[t]),delete this.readedChildren[t]}.bind(this))}}),MWF.xApplication.process.Application.WorkExplorer.Task=new Class({initialize:function(e,t,s,i){this.explorer=s,this.work=i,this.data=e,this.container=t,this.css=this.explorer.css,this.load()},load:function(){this.node=new Element("div",{styles:this.css.taskItemNode}).inject(this.container);var e=new Element("div",{styles:this.css.taskArea1Node}).inject(this.node),t=new Element("div",{styles:this.css.taskArea2Node}).inject(this.node),s=new Element("div",{styles:this.css.taskArea3Node}).inject(this.node);this.iconAreaNode=new Element("div",{styles:this.css.taskItemIconAreaNode}).inject(e),this.personAreaNode=new Element("div",{styles:this.css.taskItemPersonAreaNode}).inject(e),this.timeAreaNode=new Element("div",{styles:this.css.taskItemTimeAreaNode}).inject(t),this.actionAreaNode=new Element("div",{styles:this.css.taskItemActionNode}).inject(s),this.activityAreaNode=new Element("div",{styles:this.css.taskItemActivityNode}).inject(s),this.setTaskContent(),this.setActions(),this.setEvents()},setTaskContent:function(){this.personAreaNode.set("text",o2.name.cn(this.data.identity)+"("+o2.name.cn(this.data.unit)+")");var e=(new Date).parse(this.data.startTime).format("%Y-%m-%d %H:%M");this.timeAreaNode.set("text",e),this.activityAreaNode.set("text",this.data.activityName)},setActions:function(){(this.data.control||this.work.data.control).allowReset&&(this.resetNode=new Element("div",{styles:this.css.taskActionResetNode,title:this.explorer.app.lp.reset}).inject(this.actionAreaNode)),(this.data.control||this.work.data.control).allowProcessing&&(this.flowNode=new Element("div",{styles:this.css.taskActionFlowNode,title:this.explorer.app.lp.flow}).inject(this.actionAreaNode)),(this.data.control||this.work.data.control).allowDelete&&(this.deleteNode=new Element("div",{styles:this.css.taskActionDeleteNode,title:this.explorer.app.lp.delete}).inject(this.actionAreaNode))},setEvents:function(){this.resetNode&&this.resetNode.addEvents({mouseover:function(){this.resetNode.setStyles(this.css.taskActionResetNode_over)}.bind(this),mouseout:function(){this.resetNode.setStyles(this.css.taskActionResetNode)}.bind(this),mousedown:function(){this.resetNode.setStyles(this.css.taskActionResetNode_down)}.bind(this),mouseup:function(){this.resetNode.setStyles(this.css.taskActionResetNode_over)}.bind(this),click:function(){this.reset()}.bind(this)}),this.flowNode&&this.flowNode.addEvents({mouseover:function(){this.flowNode.setStyles(this.css.taskActionFlowNode_over)}.bind(this),mouseout:function(){this.flowNode.setStyles(this.css.taskActionFlowNode)}.bind(this),mousedown:function(){this.flowNode.setStyles(this.css.taskActionFlowNode_down)}.bind(this),mouseup:function(){this.flowNode.setStyles(this.css.taskActionFlowNode_over)}.bind(this),click:function(e){this.flow(e)}.bind(this)}),this.deleteNode&&this.deleteNode.addEvents({mouseover:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_over)}.bind(this),mouseout:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode)}.bind(this),mousedown:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_down)}.bind(this),mouseup:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_over)}.bind(this),click:function(e){this.remove(e)}.bind(this)})},reset:function(){this.node.setStyles(this.css.taskItemNode_action);var e={type:"identity",title:this.explorer.app.lp.reset,onComplete:function(e){e.length?this.resetPeople(e):this.node.setStyles(this.css.taskItemNode)}.bind(this),onCancel:function(){this.node.setStyles(this.css.taskItemNode)}.bind(this)};new MWF.O2Selector(this.explorer.app.content,e)},resetPeople:function(e){var t=[],s=[];e.each((function(e){t.push(e.data.distinguishedName),s.push(e.data.name)}));var i={routeName:this.explorer.app.lp.reset,opinion:this.explorer.app.lp.reset+": "+s.join(", "),identityList:t};this.explorer.actions.resetTask(this.data.id,i,function(){this.work.childNode.destroy(),this.work.childNode=null,this.work.loadChild()}.bind(this))},flow:function(e){this.node.setStyles(this.css.taskItemNode_action),this.processNode=new Element("div",{styles:this.css.taskItemFlowNode}).inject(this.explorer.app.content),this.processNode.setStyles({overflow:"auto"}),MWF.require("MWF.xDesktop.Dialog",function(){var e=this.explorer.app.content.getSize(),t=e.x/2-280,s=e.y/2-200;t+parseFloat(560)>e.x&&(t-=parseFloat(560)),t<0&&(t=0),s+parseFloat(400)>e.y&&(s-=parseFloat(400)),s<0&&(s=0);var i=new MWF.xDesktop.Dialog({title:"",style:"application",top:s,left:t-20,fromTop:s,fromLeft:t-20,width:560,height:400,content:this.processNode,container:this.explorer.app.content,onPostShow:function(){var e=this;MWF.xDesktop.requireApp("process.Work","Processor",function(){new MWF.xApplication.process.Work.Processor(this.processNode,this.data,{style:"task",isManagerProcess:!0,onCancel:function(){i.close(),e.node.setStyles(e.css.taskItemNode)},onSubmit:function(t,s){e.submitTask(t,s,this,i)},onResize:function(){var e=this.node.getSize();if(i&&i.node){i.node.setStyle("display","block"),i.content.setStyles({height:e.y,width:e.x});i.setContentSize("auto",null);"auto"===i.content.getStyle("overflow-y")&&"auto"!==i.content.getStyle("overflow-x")&&(i.node.setStyle("width",i.node.getStyle("width").toInt()+20+"px"),i.content.setStyle("width",i.content.getStyle("width").toInt()+20+"px")),i.reCenter()}}})}.bind(this))}.bind(this)});i.show()}.bind(this))},submitTask:function(e,t,s,i){var o={routeName:e,opinion:t};this.explorer.actions.flowTask(this.data.id,o,function(){s.destroy(),i.close(),this.work.childNode.destroy(),this.work.childNode=null,this.work.reload(function(){this.work.loadChild()}.bind(this))}.bind(this))},remove:function(e){var t=this.explorer.app.lp,s=t.deleteTask.replace(/{people}/g,this.data.person),i=this;this.node.setStyles(this.css.taskItemNode_remove),this.explorer.app.confirm("warn",e,t.deleteTaskTitle,s,350,120,(function(){this.close(),i.work.removeTask(i)}),(function(){i.node.setStyles(i.css.taskItemNode),this.close()}))},destroy:function(){this.node.destroy()}}),MWF.xApplication.process.Application.WorkExplorer.Done=new Class({Extends:MWF.xApplication.process.Application.WorkExplorer.Task,setActions:function(){(this.data.control||this.work.data.control).allowDelete&&(this.deleteNode=new Element("div",{styles:this.css.taskActionDeleteNode,title:this.explorer.app.lp.delete}).inject(this.actionAreaNode))},setEvents:function(){this.deleteNode&&this.deleteNode.addEvents({mouseover:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_over)}.bind(this),mouseout:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode)}.bind(this),mousedown:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_down)}.bind(this),mouseup:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_over)}.bind(this),click:function(e){this.remove(e)}.bind(this)})},remove:function(e){var t=this.explorer.app.lp,s=t.deleteDone.replace(/{people}/g,this.data.person),i=this;this.node.setStyles(this.css.taskItemNode_remove),this.explorer.app.confirm("warn",e,t.deleteDoneTitle,s,350,120,(function(){this.close(),i.work.removeDone(i)}),(function(){i.node.setStyles(i.css.taskItemNode),this.close()}))}}),MWF.xApplication.process.Application.WorkExplorer.Read=new Class({Extends:MWF.xApplication.process.Application.WorkExplorer.Task,setActions:function(){(this.data.control||this.work.data.control).allowReadReset&&(this.resetNode=new Element("div",{styles:this.css.taskActionResetNode,title:this.explorer.app.lp.reset}).inject(this.actionAreaNode)),(this.data.control||this.work.data.control).allowRead&&(this.flagNode=new Element("div",{styles:this.css.readActionFlagNode,title:this.explorer.app.lp.flag}).inject(this.actionAreaNode)),(this.data.control||this.work.data.control).allowDelete&&(this.deleteNode=new Element("div",{styles:this.css.taskActionDeleteNode,title:this.explorer.app.lp.delete}).inject(this.actionAreaNode))},setEvents:function(){this.resetNode&&this.resetNode.addEvents({mouseover:function(){this.resetNode.setStyles(this.css.taskActionResetNode_over)}.bind(this),mouseout:function(){this.resetNode.setStyles(this.css.taskActionResetNode)}.bind(this),mousedown:function(){this.resetNode.setStyles(this.css.taskActionResetNode_down)}.bind(this),mouseup:function(){this.resetNode.setStyles(this.css.taskActionResetNode_over)}.bind(this),click:function(){this.reset()}.bind(this)}),this.flagNode&&this.flagNode.addEvents({mouseover:function(){this.flagNode.setStyles(this.css.readActionFlagNode_over)}.bind(this),mouseout:function(){this.flagNode.setStyles(this.css.readActionFlagNode)}.bind(this),mousedown:function(){this.flagNode.setStyles(this.css.readActionFlagNode_down)}.bind(this),mouseup:function(){this.flagNode.setStyles(this.css.readActionFlagNode_over)}.bind(this),click:function(){this.flagRead()}.bind(this)}),this.deleteNode&&this.deleteNode.addEvents({mouseover:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_over)}.bind(this),mouseout:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode)}.bind(this),mousedown:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_down)}.bind(this),mouseup:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_over)}.bind(this),click:function(e){this.remove(e)}.bind(this)})},reset:function(){this.node.setStyles(this.css.taskItemNode_action);var e={type:"identity",title:this.explorer.app.lp.reset,onComplete:function(e){e.length?this.resetPeople(e):this.node.setStyles(this.css.taskItemNode)}.bind(this),onCancel:function(){this.node.setStyles(this.css.taskItemNode)}.bind(this)};new MWF.O2Selector(this.explorer.app.content,e)},resetPeople:function(e){var t=[];e.each((function(e){t.push(e.data.distinguishedName)}));var s={routeName:this.explorer.app.lp.resetTo,opinion:this.explorer.app.lp.resetTo+": "+t.join(", "),identityList:t};this.explorer.actions.resetRead(this.data.id,s,function(){this.work.childNode.destroy(),this.work.childNode=null,this.work.loadChild()}.bind(this))},remove:function(e){var t=this.explorer.app.lp,s=t.deleteRead.replace(/{people}/g,this.data.person),i=this;this.node.setStyles(this.css.taskItemNode_remove),this.explorer.app.confirm("warn",e,t.deleteReadTitle,s,350,120,(function(){this.close(),i.work.removeRead(i)}),(function(){i.node.setStyles(i.css.taskItemNode),this.close()}))},flagRead:function(){var t=this.explorer.app.lp,s=t.flagRead.replace(/{people}/g,this.data.person),i=this;this.node.setStyles(this.css.taskItemNode_action),this.explorer.app.confirm("warn",e,t.flagReadTitle,s,350,180,(function(){this.close(),i.doFlagRead()}),(function(){i.node.setStyles(i.css.taskItemNode),this.close()}))},doFlagRead:function(){this.explorer.actions.flagRead(this.data.id,{},function(){this.work.childNode.destroy(),this.work.childNode=null,this.work.loadChild()}.bind(this))}}),MWF.xApplication.process.Application.WorkExplorer.Readed=new Class({Extends:MWF.xApplication.process.Application.WorkExplorer.Done,remove:function(e){var t=this.explorer.app.lp,s=t.deleteReaded.replace(/{people}/g,this.data.person),i=this;this.node.setStyles(this.css.taskItemNode_remove),this.explorer.app.confirm("warn",e,t.deleteReadedTitle,s,350,120,(function(){this.close(),i.work.removeReaded(i)}),(function(){i.node.setStyles(i.css.taskItemNode),this.close()}))}});