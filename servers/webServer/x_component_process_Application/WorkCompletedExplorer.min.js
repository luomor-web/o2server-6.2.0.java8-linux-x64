MWF.require("MWF.widget.Mask",null,!1),MWF.require("MWF.widget.Identity",null,!1),MWF.xDesktop.requireApp("process.Application","WorkExplorer",null,!1),MWF.xApplication.process.Application.WorkCompletedExplorer=new Class({Extends:MWF.xApplication.process.Application.WorkExplorer,Implements:[Options,Events],createSearchElementNode:function(){this.toCompletedNode=new Element("div",{styles:this.css.toCompletedNode,text:this.app.lp.toWork}).inject(this.toolbarNode),this.toCompletedNode.addEvents({mouseover:function(){this.toCompletedNode.setStyles(this.css.toCompletedNode_over)}.bind(this),mouseout:function(){this.toCompletedNode.setStyles(this.css.toCompletedNode)}.bind(this),click:function(){this.app.workConfig()}.bind(this)})},_getFilterCount:function(e){this.actions.listWorkCompletedFilterAttributeManage(this.app.options.id,(function(t){e&&e(t)}))},loadProcess:function(){this.actions.listWorkCompletedProcessManage(this.app.options.id,function(e){e.data.each(function(e){this.loadProcessNode(e)}.bind(this))}.bind(this))},createWorkListHead:function(){var e=new Element("div",{styles:this.css.workItemHeadNode}).inject(this.elementContentListNode),t="<div class='headArea1Node'><div class='checkAreaHeadNode'></div><div class='iconAreaHeadNode'></div><div class='titleAreaHeadNode'>"+this.app.lp.workTitle+"</div></div><div class='headArea2Node'><div class='timeAreaHeadNode'>"+this.app.lp.completedTime+"</div><div class='processAreaHeadNode'>"+this.app.lp.process+"</div></div><div class='headArea3Node'><div class='actionAreaHeadNode'>"+this.app.lp.action+"</div><div class='expireAreaHeadNode'>"+this.app.lp.expire+"</div><div class='personAreaHeadNode'>"+this.app.lp.person+"</div></div>";e.set("html",t),e.getElement(".headArea1Node").setStyles(this.css.headArea1Node),e.getElement(".headArea2Node").setStyles(this.css.headArea2Node),e.getElement(".headArea3Node").setStyles(this.css.headArea3Node),e.getElement(".checkAreaHeadNode").setStyles(this.css.checkAreaHeadNode),e.getElement(".iconAreaHeadNode").setStyles(this.css.iconAreaHeadNode),e.getElement(".titleAreaHeadNode").setStyles(this.css.titleAreaHeadNode),e.getElement(".timeAreaHeadNode").setStyles(this.css.timeAreaHeadNode),e.getElement(".processAreaHeadNode").setStyles(this.css.processAreaHeadNode),e.getElement(".personAreaHeadNode").setStyles(this.css.personAreaHeadNode),e.getElement(".actionAreaHeadNode").setStyles(this.css.actionAreaHeadNode),e.getElement(".expireAreaHeadNode").setStyles(this.css.expireAreaHeadNode)},_getCurrentPageData:function(e,t){var s=this.items.length?this.items[this.items.length-1].data.id:"(0)";if(this.filter){var i={};Object.each(this.filter,(function(e,t){"key"!=t?(i[t]||(i[t]=[]),e.each((function(e){i[t].push(e.value)}))):i[t]=e})),this.actions.listWorkCompletedFilterManage(s,t||this.pageCount,this.app.options.id,i,(function(t){e&&e(t)}))}else this.actions.listWorkCompletedNextManage(s,t||this.pageCount,this.app.options.id,(function(t){e&&e(t)}))},loadElementList:function(e){this.isItemsLoaded||(this.isItemLoadding?this.loadItemQueue++:(this.isItemLoadding=!0,this._getCurrentPageData(function(e){this.count=e.count,this.isCountShow||(this.filterAllProcessNode.getFirst("span").set("text","("+this.count+")"),this.isCountShow=!0),e.count<=this.items.length&&(this.isItemsLoaded=!0),e.data.each(function(e){var t=this._createItem(e);this.items.push(t),this.works[e.id]=t}.bind(this)),this.isItemLoadding=!1,this.loadItemQueue>0&&(this.loadItemQueue--,this.loadElementList()),this.mask.hide()}.bind(this),e)))},_createItem:function(e){return new MWF.xApplication.process.Application.WorkCompletedExplorer.Work(e,this)},removeWorkCompleted:function(e){this.actions.removeWorkCompleted(e.data.id,function(e){e.data.each(function(e){this.items.erase(this.works[e.id]),this.works[e.id].destroy(),MWF.release(this.works[e.id]),delete this.works[e.id]}.bind(this))}.bind(this))}}),MWF.xApplication.process.Application.WorkCompletedExplorer.Work=new Class({Extends:MWF.xApplication.process.Application.WorkExplorer.Work,load:function(){this.node=new Element("div",{styles:this.css.workItemNode}),this.relative?this.node.inject(this.relative.node,"after"):this.node.inject(this.container),this.workAreaNode=new Element("div",{styles:this.css.workItemWorkNode}).inject(this.node);var e="<div class='area1Node'><div class='checkAreaNode'></div><div class='iconAreaNode'></div><div class='titleAreaNode'><div class='titleAreaTextNode'>"+(this.data.title||"")+"</div></div></div><div class='area2Node'><div class='timeAreaNode'></div><div class='processAreaNode'><div class='processAreaTextNode'>"+this.data.processName+"</div></div></div><div class='area3Node'><div class='actionAreaNode'></div><div class='expireAreaNode'></div><div class='personAreaNode'></div></div>";this.workAreaNode.set("html",e),this.workAreaNode.getElement(".area1Node").setStyles(this.css.headArea1Node),this.workAreaNode.getElement(".area2Node").setStyles(this.css.headArea2Node),this.workAreaNode.getElement(".area3Node").setStyles(this.css.headArea3Node),this.checkAreaNode=this.workAreaNode.getElement(".checkAreaNode").setStyles(this.css.checkAreaHeadNode),this.iconAreaNode=this.workAreaNode.getElement(".iconAreaNode").setStyles(this.css.iconAreaHeadNode),this.titleAreaNode=this.workAreaNode.getElement(".titleAreaNode").setStyles(this.css.titleAreaHeadNode),this.timeAreaNode=this.workAreaNode.getElement(".timeAreaNode").setStyles(this.css.timeAreaHeadNode),this.processAreaNode=this.workAreaNode.getElement(".processAreaNode").setStyles(this.css.processAreaHeadNode),this.personAreaNode=this.workAreaNode.getElement(".personAreaNode").setStyles(this.css.personAreaHeadNode),this.actionAreaNode=this.workAreaNode.getElement(".actionAreaNode").setStyles(this.css.actionAreaHeadNode),this.expireAreaNode=this.workAreaNode.getElement(".expireAreaNode").setStyles(this.css.expireAreaHeadNode),this.processAreaTextNode=this.workAreaNode.getElement(".processAreaTextNode").setStyles(this.css.processAreaTextNode),this.titleAreaTextNode=this.workAreaNode.getElement(".titleAreaTextNode").setStyles(this.css.titleAreaTextNode),this.data.expired?(this.expireAreaNode.setStyle("color","#FF0000"),this.expireAreaNode.set("text",this.explorer.app.lp.expired)):this.expireAreaNode.set("text",this.explorer.app.lp.notExpired),this.expireAreaNode.setStyles(this.css.expireAreaNode),this.data.control.allowVisit||(this.node.setStyles(this.css.workItemNode_noread),this.checkAreaNode.setStyles(this.css.actionStopWorkNode),this.actionAreaNode.setStyles(this.css.actionStopWorkActionNode)),this.iconAreaNode.setStyles(this.css.iconWorkNode),this.titleAreaNode.setStyles(this.css.titleWorkNode),this.setPersonData(),this.setTimeData(),this.setActions(),this.setEvents()},reload:function(e){this.explorer.actions.getWorkCompleted(this.data.id,function(t){this.data=t.data,this.titleAreaTextNode.set("text",this.data.title||""),this.activityAreaTextNode.set("text",this.data.activityName),this.statusAreaNode.empty(),this.setStatusData(),this.relativeWorks.length&&this.relativeWorks.each((function(e){e.destroy()})),this.relativeWorks=[],this.listRelatives(),e&&e()}.bind(this))},openWork:function(e){var t={workCompletedId:this.data.id,isControl:this.explorer.app.options.application.allowControl};this.explorer.app.desktop.openApplication(e,"process.Work",t)},remove:function(e){var t=this.explorer.app.lp,s=t.deleteWork.replace(/{title}/g,this.data.title||""),i=this;this.workAreaNode.setStyles(this.css.workItemWorkNode_remove),this.readyRemove=!0,this.explorer.app.confirm("warn",e,t.deleteWorkTitle,s,350,120,(function(){i.explorer.removeWorkCompleted(i),this.close()}),(function(){i.workAreaNode.setStyles(i.css.workItemWorkNode),i.readyRemove=!1,this.close()}))},createChildNode:function(){this.childNode=new Element("div",{styles:this.css.workItemChildNode}).inject(this.node),this.doneAreaNode=new Element("div",{styles:this.css.workItemDonwNode}).inject(this.childNode),this.readAreaNode=new Element("div",{styles:this.css.workItemReadNode}).inject(this.childNode),this.readedAreaNode=new Element("div",{styles:this.css.workItemReadedNode}).inject(this.childNode),this.doneAreaTitleAreaNode=new Element("div",{styles:this.css.workItemListTitleNode}).inject(this.doneAreaNode),this.readAreaTitleAreaNode=new Element("div",{styles:this.css.workItemListTitleNode}).inject(this.readAreaNode),this.readedAreaTitleAreaNode=new Element("div",{styles:this.css.workItemListTitleNode}).inject(this.readedAreaNode);new Element("div",{styles:this.css.workItemDoneTitleNode,text:this.explorer.app.lp.done}).inject(this.doneAreaTitleAreaNode),new Element("div",{styles:this.css.workItemReadTitleNode,text:this.explorer.app.lp.read}).inject(this.readAreaTitleAreaNode),new Element("div",{styles:this.css.workItemReadedTitleNode,text:this.explorer.app.lp.readed}).inject(this.readedAreaTitleAreaNode);this.doneAreaContentNode=new Element("div",{styles:this.css.doneAreaContentNode}).inject(this.doneAreaNode),this.readAreaContentNode=new Element("div",{styles:this.css.readAreaContentNode}).inject(this.readAreaNode),this.readedAreaContentNode=new Element("div",{styles:this.css.readedAreaContentNode}).inject(this.readedAreaNode)},listAssignments:function(){this.explorer.actions.listWorkCompletedAssignments(this.data.id,function(e){this.listDones(e.data.taskCompletedList),this.listReads(e.data.readList),this.listReadeds(e.data.readCompletedList)}.bind(this))},listDones:function(e){e.length?e.each(function(e){var t=new MWF.xApplication.process.Application.WorkCompletedExplorer.Done(e,this.doneAreaContentNode,this.explorer,this);this.dones.push(t),this.doneChildren[e.id]=t}.bind(this)):new Element("div",{styles:this.css.noListText,text:"［"+this.explorer.app.lp.noDone+"］"}).inject(this.doneAreaTitleAreaNode)},listReads:function(e){e.length?e.each(function(e){var t=new MWF.xApplication.process.Application.WorkCompletedExplorer.Read(e,this.readAreaContentNode,this.explorer,this);this.reads.push(t),this.readChildren[e.id]=t}.bind(this)):new Element("div",{styles:this.css.noListText,text:"［"+this.explorer.app.lp.noRead+"］"}).inject(this.readAreaTitleAreaNode)},listReadeds:function(e){e.length?e.each(function(e){var t=new MWF.xApplication.process.Application.WorkCompletedExplorer.Readed(e,this.readedAreaContentNode,this.explorer,this);this.readeds.push(t),this.readedChildren[e.id]=t}.bind(this)):new Element("div",{styles:this.css.noListText,text:"［"+this.explorer.app.lp.noReaded+"］"}).inject(this.readedAreaTitleAreaNode)},setTimeData:function(){var e=(new Date).parse(this.data.completedTime).format("%Y-%m-%d"),t=(new Date).parse(this.data.completedTime).format("%Y-%m-%d %H:%M");this.timeAreaNode.set("text",e),this.timeAreaNode.set("title",t)}}),MWF.xApplication.process.Application.WorkCompletedExplorer.Done=new Class({Extends:MWF.xApplication.process.Application.WorkExplorer.Done}),MWF.xApplication.process.Application.WorkCompletedExplorer.Read=new Class({Extends:MWF.xApplication.process.Application.WorkExplorer.Read}),MWF.xApplication.process.Application.WorkCompletedExplorer.Readed=new Class({Extends:MWF.xApplication.process.Application.WorkExplorer.Readed});