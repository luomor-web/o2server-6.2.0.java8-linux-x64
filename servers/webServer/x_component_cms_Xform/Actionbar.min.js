MWF.xDesktop.requireApp("process.Xform","Actionbar",null,!1),MWF.xApplication.cms.Xform.Actionbar=MWF.CMSActionbar=new Class({Extends:MWF.APPActionbar,reload:function(){this._loadUserInterface()},_loadUserInterface:function(){this.toolbarNode=this.node.getFirst("div"),this.toolbarNode||(this.toolbarNode=this.node),this.toolbarNode&&this.toolbarNode.empty(),MWF.require("MWF.widget.SimpleToolbar",function(){if(this.toolbarWidget=new MWF.widget.SimpleToolbar(this.toolbarNode,{style:this.json.style,onPostLoad:function(){this.fireEvent("afterLoad")}.bind(this)},this),this.json.actionStyles&&(this.toolbarWidget.css=this.json.actionStyles),this.json.multiTools){var t=JSON.stringify(this.json.multiTools);t=o2.bindJson(t,{lp:MWF.xApplication.cms.Xform.LP.form}),this.json.multiTools=JSON.parse(t),this.json.multiTools.each(function(t){t.system?this.json.hideSystemTools||this.setToolbars([t],this.toolbarNode,this.readonly):this.setCustomToolbars([t],this.toolbarNode)}.bind(this)),this.toolbarWidget.load()}else this.json.hideSystemTools?(this.setCustomToolbars(this.json.tools,this.toolbarNode),this.toolbarWidget.load()):this.json.defaultTools?(this.setToolbars(this.json.defaultTools,this.toolbarNode,this.readonly),this.setCustomToolbars(this.json.tools,this.toolbarNode),this.toolbarWidget.load()):MWF.getJSON("../x_component_cms_Xform/$Form/toolbars.json",function(t){this.setToolbars(t,this.toolbarNode,this.readonly,!0),this.setCustomToolbars(this.json.tools,this.toolbarNode),this.toolbarWidget.load()}.bind(this),!1)}.bind(this))},setCustomToolbars:function(t,o){var s,i="../x_component_cms_FormDesigner/Module/Actionbar/";s=this.json.customIconStyle?this.json.customIconStyle:(this.json.style||"default").indexOf("red")>-1?"red":"blue";var e=this.json.customIconOverStyle||"white";t.each(function(t){var n=!0;if(n=this.readonly?t.readShow:t.editShow){if(n=!0,t.control&&(n=this.form.businessData.control[t.control]),t.condition)n=!this.form.Macro.exec(t.condition,this);if(n){var r=new Element("div",{id:t.id,MWFnodetype:t.type,MWFButtonImage:i+""+this.form.options.style+"/custom/"+s+"/"+t.img,MWFButtonImageOver:i+""+this.form.options.style+"/custom/"+e+"/"+t.img,title:t.title,MWFButtonAction:"runCustomAction",MWFButtonText:t.text}).inject(o);if(t.properties&&r.set(t.properties),t.actionScript&&r.store("script",t.actionScript),t.sub){var l=o.getLast();this.setCustomToolbars(t.sub,l)}}}}.bind(this))},setToolbars:function(t,o,s,i){t.each(function(t){var e=!0;if(t.control&&(e=this.form.businessData.control[t.control]),!i&&t.condition){var n=this.form.Macro.exec(t.condition,this);e=e&&!n}if(s?t.read||(e=!1):t.edit||(e=!1),this.json.hideSetPopularDocumentTool&&"action_popular"==t.id&&(e=!1),e){new Element("div",{id:t.id,MWFnodetype:t.type,MWFButtonImage:"../x_component_cms_FormDesigner/Module/Actionbar/"+(this.options.style||"default")+"/tools/"+(this.json.style||"default")+"/"+t.img,MWFButtonImageOver:"../x_component_cms_FormDesigner/Module/Actionbar/"+(this.options.style||"default")+"/tools/"+(this.json.style||"default")+"/"+t.img_over,title:t.title,MWFButtonAction:t.action,MWFButtonText:t.text}).inject(o);if(t.sub){var r=o.getLast();this.setToolbars(t.sub,r)}}}.bind(this))},runCustomAction:function(t){var o=t.node.retrieve("script");this.form.Macro.exec(o,this)},saveDocument:function(){this.form.saveDocument()},saveDraftDocument:function(){this.form.saveDocument()},closeDocument:function(){this.form.closeDocument()},publishDocument:function(){this.form.publishDocument()},archiveDocument:function(){this.form.archiveDocument()},redraftDocument:function(){this.form.redraftDocument()},deleteDocument:function(){this.form.deleteDocument()},editDocument:function(){this.form.editDocument()},setPopularDocument:function(){this.form.setPopularDocument()},printDocument:function(){this.form.printDocument()}});