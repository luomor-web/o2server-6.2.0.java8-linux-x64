MWF.xDesktop.requireApp("process.Xform","Htmleditor",null,!1),MWF.xApplication.cms.Xform.Htmleditor=MWF.CMSHtmleditor=new Class({Extends:MWF.APPHtmleditor,_loadUserInterface:function(){if(this.node.empty(),this.readonly)this.node.set("html",this._getBusinessData()),this.node.setStyles({"-webkit-user-select":"text","-moz-user-select":"text"}),layout.mobile&&this.node.getElements("img").each(function(t){t.setStyles({height:"auto","max-width":"100%"})}.bind(this));else{var t=Object.clone(this.json.editorProperties);if(this.json.config&&this.json.config.code){var e=MWF.CMSMacro.exec(this.json.config.code,this);Object.each(e,(function(e,i){t[i]=e}))}this.loadCkeditor(t)}},loadCkeditor:function(t){_self=this,COMMON.AjaxModule.loadDom("ckeditor",function(){CKEDITOR.disableAutoInline=!0;var e=new Element("div").inject(this.node),i=this._getBusinessData();i?e.set("html",i):this.json.templateCode&&e.set("html",this.json.templateCode);this.node.getSize().y;var o=t||{};"Mobile"==this.form.json.mode&&(o.toolbar||o.toolbarGroups||(o.toolbar=[{name:"paragraph",items:["Bold","Italic","-","TextColor","BGColor","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","Undo","Redo"]},{name:"basicstyles",items:["Styles","FontSize"]},{name:"insert",items:["Image"]}])),o.base64Encode="y"===this.json.base64Encode,o.localImageMaxWidth=800,o.reference=this.form.businessData.document.id,o.referenceType="cmsDocument",o.language||(o.language=MWF.language),o.skin&&(o.skin="moono-lisa"),this.editor=CKEDITOR.replace(e,o),this._loadEvents(),this.editor.on("change",function(){this._setBusinessData(this.getData())}.bind(this))}.bind(this))},getText:function(){return this.editor.document.getBody().getText()},getImages:function(){var t=[],e=this.editor.document.find("img");if(e)for(var i=0;i<e.$.length;i++)t.push(e.getItem(i).$);return t},getImageIds:function(){for(var t=[],e=this.getImages(),i=0;i<e.length;i++){var o=e[i];o.getAttribute("data-id")&&t.push(o.getAttribute("data-id"))}return t},_loadStyles:function(){this.json.styles&&this.node.setStyles(this.json.styles),this.node.setStyle("overflow","hidden")},validationConfigItem:function(t,e){if("all"==e.status||"publish"==t){var i=this.getData(),o="value"==e.valueType?i:i.length;switch(e.operateor){case"isnull":if(!o)return this.notValidationMode(e.prompt),!1;break;case"notnull":if(o)return this.notValidationMode(e.prompt),!1;break;case"gt":if(o>e.value)return this.notValidationMode(e.prompt),!1;break;case"lt":if(o<e.value)return this.notValidationMode(e.prompt),!1;break;case"equal":if(o==e.value)return this.notValidationMode(e.prompt),!1;break;case"neq":if(o!=e.value)return this.notValidationMode(e.prompt),!1;break;case"contain":if(-1!=o.indexOf(e.value))return this.notValidationMode(e.prompt),!1;break;case"notcontain":if(-1==o.indexOf(e.value))return this.notValidationMode(e.prompt),!1}}return!0}});