MWF.xApplication.Homepage.MeetingContent=new Class({Extends:MWF.xApplication.Homepage.TaskContent,Implements:[Options,Events],options:{view:"meetingContent.html"},load:function(){this.tabs={},this.container.loadHtml(this.viewPath,{bind:{lp:this.app.lp},module:this},function(){this.initSize(),this.loadMyMeeting(function(){this.fireEvent("load")}.bind(this))}.bind(this))},openMeeting:function(e){layout.openApplication(e,"Meeting")},setContentSize:function(){var e=this.container.getSize().y-(this.taskTitleNode.getSize().y+this.taskTitleNode.getEdgeHeight())-(this.pageAreaNode.getSize().y+this.pageAreaNode.getEdgeHeight())-this.itemContentNode.getEdgeHeight();if(this.itemContentNode.setStyle("height",e+"px"),this.contentHeight=e,this.noItemNode){var t=(this.contentHeight-this.noItemNode.getSize().y)/2;this.noItemNode.setStyle("margin-top",t+"px")}},loadMyMeeting:function(e){o2.Actions.load("x_meeting_assemble_control").MeetingAction.lisInvitedWait(function(t){t.data&&t.data.length?this.loadMeetingInvited(null,e,this.data):this.loadMeeting(null,e)}.bind(this))},loadMeetingInvited:function(e,t,n){this.isLoading||(this.invitedContentTab?this.invitedContentTab.load():this.invitedContentTab=new MWF.xApplication.Homepage.MeetingContent.MeetingInvited(this,this.invitedTab,n,{onLoad:function(){t&&t()}}),this.currentTab=this.invitedContentTab)},loadMeeting:function(e,t){this.isLoading||(this.meetingContentTab?this.meetingContentTab.load():this.meetingContentTab=new MWF.xApplication.Homepage.MeetingContent.Meeting(this,this.meetingTab,null,{onLoad:function(){t&&t()}}),this.currentTab=this.meetingContentTab)}}),MWF.xApplication.Homepage.MeetingContent.MeetingInvited=new Class({Extends:MWF.xApplication.Homepage.TaskContent.Task,Implements:[Options,Events],options:{itemHeight:80,type:"meetingInvited"},initialize:function(e,t,n,i){this.setOptions(i),this.content=e,this.app=this.content.app,this.container=this.content.itemContentNode,this.tab=t,this.data=n,this.load()},loadItemsRes:function(){this.data?(this.loadItems(this.data),this.data=null,this.fireEvent("load")):o2.Actions.load("x_meeting_assemble_control").MeetingAction.lisInvitedWait(function(e){e.data&&e.data.length?this.loadItems(e.data):this.emptyLoadContent(),this.fireEvent("load")}.bind(this))},emptyLoadContent:function(){this.container.empty(),this.container.removeClass("o2_homepage_area_content_loading").removeClass("icon_loading"),this.content.pageAreaNode.empty(),this.content.noItemNode=new Element("div.o2_homepage_meeting_area_content_empty_node",{text:this.app.lp.noMeeting}).inject(this.container);var e=(this.content.contentHeight-this.content.noItemNode.getSize().y)/2;this.content.noItemNode.setStyle("margin-top",e+"px"),this.content.isLoading=!1},loadItems:function(e){for(var t=0;t<Math.min(e.length,this.pageSize);t++){var n=e[t];this.loadItem(n,t)}this.endLoadContent()},loadItemRow:function(e){var t=new Element("div.o2_homepage_meeting_item_node").inject(this.container),n=new Element("div.o2_homepage_meeting_item_action").inject(t),i=new Element("div.o2_homepage_meeting_item_infor").inject(t),o=(new Element("div.o2_homepage_meeting_item_title",{text:e.subject,title:e.subject}).inject(i),new Element("div.o2_homepage_meeting_item_time").inject(i)),a=(new Date).parse(e.startTime),s=((new Date).parse(e.completedTime),a.format("%Y-%m-%d %H:%M")),m=a.format("%H:%M");if(o.set("html",this.app.lp.meetingTime+": <span style='color: #999999'>"+s+" - "+m+"<span>"),new Element("div.o2_homepage_meeting_item_location").inject(i).set("html",this.app.lp.meetingLocation+": <span style='color: #999999'>"+e.woRoom.name+"<span>"),e.myAccept||e.myReject)e.myAccept?new Element("div.o2_homepage_meeting_item_action_accepted",{text:this.app.lp.accepted}).inject(n):e.myReject&&new Element("div.o2_homepage_meeting_item_action_rejected",{text:this.app.lp.rejected}).inject(n);else{var c=new Element("div.o2_homepage_meeting_item_action_accept",{text:this.app.lp.accept}).inject(n),p=new Element("div.o2_homepage_meeting_item_action_reject",{text:this.app.lp.reject}).inject(n);c.store("invited",e),p.store("invited",e),c.addEvent("click",function(e){var t=e.target.retrieve("invited");this.acceptInvitedConfirm(t,c,e)}.bind(this)),p.addEvent("click",function(e){var t=e.target.retrieve("invited");this.rejectInvitedConfirm(t,p,e)}.bind(this))}return t},acceptInvitedConfirm:function(e,t,n){var i=this.app.lp.acceptConfirm;i=i.replace("{name}",e.subject);var o=this;this.app.confirm("warn",n,this.app.lp.acceptConfirmTitle,i,340,100,(function(){o.acceptInvited(e,t),this.close()}),(function(){this.close()}))},acceptInvited:function(e,t){o2.Actions.load("x_meeting_assemble_control").MeetingAction.accpet(e.id,function(e){var n=t.getParent();n.empty(),new Element("div.o2_homepage_meeting_item_action_accepted",{text:this.app.lp.accepted}).inject(n)}.bind(this))},rejectInvitedConfirm:function(e,t,n){var i=this.app.lp.rejectConfirm;i=i.replace("{name}",e.subject);var o=this;this.app.confirm("warn",n,this.app.lp.rejectConfirmTitle,i,340,100,(function(){o.rejectInvited(e,t),this.close()}),(function(){this.close()}))},rejectInvited:function(e,t){o2.Actions.load("x_meeting_assemble_control").MeetingAction.reject(e.id,function(e){var n=t.getParent();n.empty(),new Element("div.o2_homepage_meeting_item_action_rejected",{text:this.app.lp.rejected}).inject(n)}.bind(this))},loadItem:function(e,t){var n=this.loadItemRow(e,t);n.store("data",e),n.addEvents({mouseover:function(){this.addClass("mainColor_color").addClass("o2_homepage_task_item_row_over")},mouseout:function(){this.removeClass("mainColor_color").removeClass("o2_homepage_task_item_row_over")}}),n.getLast().addEvent("click",(function(e){layout.openApplication(e,"Meeting")}))},open:function(e,t){layout.openApplication(e,"Meeting")}}),MWF.xApplication.Homepage.MeetingContent.Meeting=new Class({Extends:MWF.xApplication.Homepage.MeetingContent.MeetingInvited,Implements:[Options,Events],options:{itemHeight:80,type:"meeting",month:1},loadItemsRes:function(){o2.Actions.load("x_meeting_assemble_control").MeetingAction.listComingMonth(this.options.month,function(e){e.data&&e.data.length?this.loadItems(e.data):this.emptyLoadContent(),this.fireEvent("load")}.bind(this))},loadItemRow:function(e){var t=new Element("div.o2_homepage_meeting_item_node").inject(this.container),n=(new Element("div.o2_homepage_meeting_item_action").inject(t),new Element("div.o2_homepage_meeting_item_infor").inject(t)),i=(new Element("div.o2_homepage_meeting_item_title",{text:e.subject,title:e.subject}).inject(n),new Element("div.o2_homepage_meeting_item_time").inject(n)),o=(new Date).parse(e.startTime),a=((new Date).parse(e.completedTime),o.format("%Y-%m-%d %H:%M")),s=o.format("%H:%M");return i.set("html",this.app.lp.meetingTime+": <span style='color: #999999'>"+a+" - "+s+"<span>"),new Element("div.o2_homepage_meeting_item_location").inject(n).set("html",this.app.lp.meetingLocation+": <span style='color: #999999'>"+e.woRoom.name+"<span>"),t}});