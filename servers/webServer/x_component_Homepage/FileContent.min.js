MWF.xApplication.Homepage.FileContent=new Class({Extends:MWF.xApplication.Homepage.TaskContent,Implements:[Options,Events],options:{view:"fileContent.html"},load:function(){this.tabs={},this.container.loadHtml(this.viewPath,{bind:{lp:this.app.lp},module:this},function(){this.initSize(),this.loadMyFile(function(){this.fireEvent("load")}.bind(this))}.bind(this))},openFile:function(t){o2.Actions.load("x_portal_assemble_surface").PortalAction.get("95135369-ab35-47ba-a9ce-845f26ff9efb",(function(){layout.openApplication(t,"portal.Portal",{portalId:"95135369-ab35-47ba-a9ce-845f26ff9efb"})}),(function(){layout.openApplication(t,"File")}))},setContentSize:function(){var t=this.container.getSize().y-(this.taskTitleNode.getSize().y+this.taskTitleNode.getEdgeHeight())-(this.pageAreaNode.getSize().y+this.pageAreaNode.getEdgeHeight())-this.itemContentNode.getEdgeHeight();if(this.itemContentNode.setStyle("height",t+"px"),this.contentHeight=t,this.noItemNode){var e=(this.contentHeight-this.noItemNode.getSize().y)/2;this.noItemNode.setStyle("margin-top",e+"px")}},loadMyFile:function(t){this.loadFile(null,t)},loadFile:function(t,e){this.isLoading||(this.fileContentTab?this.fileContentTab.load():this.fileContentTab=new MWF.xApplication.Homepage.FileContent.File(this,this.fileTab,{onLoad:function(){e&&e()}}),this.currentTab=this.fileContentTab)}}),MWF.xApplication.Homepage.FileContent.File=new Class({Extends:MWF.xApplication.Homepage.TaskContent.Task,Implements:[Options,Events],options:{itemHeight:50,type:"file"},getIconJson:function(t){this.iconJson?t&&t():o2.JSON.get("../x_component_File/$Main/icon.json",function(e){this.iconJson=e,t&&t()}.bind(this))},loadItemsRes:function(){var t=[];o2.Actions.load("x_file_assemble_control").Attachment2Action.listTop(function(e){o2.Actions.load("x_file_assemble_control").AttachmentAction.listTop(function(n){e.data&&e.data.length&&(e.data.map((function(t){t.version="v2"})),t=t.concat(e.data)),n.data&&n.data.length&&(n.data.map((function(t){t.version="v1"})),t=t.concat(n.data)),t.length?(t.sort((function(t,e){return Date.parse(e.lastUpdateTime)-Date.parse(t.lastUpdateTime)})),this.getIconJson(function(){this.loadItems(t)}.bind(this))):this.emptyLoadContent(),this.fireEvent("load")}.bind(this))}.bind(this))},emptyLoadContent:function(){this.container.empty(),this.container.removeClass("o2_homepage_area_content_loading").removeClass("icon_loading"),this.content.pageAreaNode.empty(),this.content.noItemNode=new Element("div.o2_homepage_file_area_content_empty_node",{text:this.app.lp.noFile}).inject(this.container),this.content.noItemNode.addEvent("click",function(t){this.content.openFile(t)}.bind(this));var t=(this.content.contentHeight-this.content.noItemNode.getSize().y)/2;this.content.noItemNode.setStyle("margin-top",t+"px"),this.content.isLoading=!1},loadItems:function(t){for(var e=0;e<Math.min(t.length,this.pageSize);e++){var n=t[e];this.loadItem(n,e)}this.endLoadContent()},loadItemRow:function(t){var e=new Element("div.o2_homepage_file_item_node").inject(this.container),n=new Element("div.o2_homepage_file_item_icon").inject(e),o=(new Element("div.o2_homepage_file_item_action",{title:this.app.lp.download}).inject(e),new Element("div.o2_homepage_file_item_title",{text:t.name,title:t.name}).inject(e),this.iconJson[t.extension.toLowerCase()]);return o||(o=this.iconJson.unknow),n.setStyle("background-image","url(../x_component_File/$Main/default/file/"+o+")"),e},loadItem:function(t,e){var n=this.loadItemRow(t,e),o=this;n.store("data",t),n.addEvents({mouseover:function(){this.addClass("mainColor_color").addClass("o2_homepage_task_item_row_over")},mouseout:function(){this.removeClass("mainColor_color").removeClass("o2_homepage_task_item_row_over")}}),n.getLast().addEvent("click",(function(t){var e=this.getParent().retrieve("data");o.openAttachment(e)})),n.getLast().getPrevious().addEvent("click",(function(t){var e=this.getParent().retrieve("data");o.downloadAttachment(e)}))},openAttachment:function(t){"v2"===t.version?o2.Actions.get("x_file_assemble_control").getFileDownloadUrl2(t.id,(function(t){window.open(o2.filterUrl(t))})):o2.Actions.get("x_file_assemble_control").getFileDownloadUrl(t.id,(function(t){window.open(o2.filterUrl(t))}))},downloadAttachment:function(t){"v2"===t.version?o2.Actions.get("x_file_assemble_control").getFileUrl2(t.id,(function(t){window.open(o2.filterUrl(t))})):o2.Actions.get("x_file_assemble_control").getFileUrl(t.id,(function(t){window.open(o2.filterUrl(t))}))},open:function(t,e){layout.openApplication(t,"Meeting")}});