MWF.require("MWF.widget.Mask",null,!1),MWF.require("MWF.xDesktop.UserData",null,!1),MWF.xDesktop.requireApp("process.TaskCenter","TaskList",null,!1),MWF.xDesktop.requireApp("process.TaskCenter","TaskCompletedList",null,!1),MWF.xDesktop.requireApp("process.TaskCenter","ReadList",null,!1),MWF.xDesktop.requireApp("process.TaskCenter","ReadCompletedList",null,!1),MWF.xDesktop.requireApp("process.TaskCenter","ReviewList",null,!1),MWF.xApplication.process.TaskCenter.options.multitask=!1,MWF.xApplication.process.TaskCenter.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"process.TaskCenter",icon:"icon.png",width:"1280",height:"700",title:MWF.xApplication.process.TaskCenter.LP.title,filterMap:{applicationList:"applicationList",processList:"processList",creatorUnitList:"creatorUnitList",creatorCompanyList:"creatorCompanyList",creatorDepartmentList:"creatorDepartmentList",activityNameList:"activityNameList",completedTimeMonthList:"completedTimeMonthList",key:"key"}},onQueryLoad:function(){this.lp=MWF.xApplication.process.TaskCenter.LP},loadApplication:function(t){this.appIcons={},this.tabs=[],this.tabShadows=[],this.startApplications=[],this.appStartableData=null,this.loadTitle(),this.loadTab(),this.loadFilterAction(),this.loadContent(),this.currentTab="",this.openTab(),t&&t()},loadTitle:function(){this.loadTitleBar(),layout.mobile||this.loadTitleUserNode(),this.loadStartProcessActionNode(),layout.mobile||this.loadTitleTextNode(),this.loadSearchNode()},loadTitleBar:function(){this.taskTitleBar=new Element("div",{styles:this.css.taskTitleBar}).inject(this.content)},loadTitleUserNode:function(){this.taskTitleUserNode=new Element("div",{styles:this.css.taskTitleUserNode}).inject(this.taskTitleBar),this.taskTitleUserIconNode=new Element("div",{styles:this.css.taskTitleUserIconNode}).inject(this.taskTitleUserNode),this.taskTitleUserTextNode=new Element("div",{styles:this.css.taskTitleUserTextNode,text:this.desktop.session.user.name}).inject(this.taskTitleUserNode)},loadStartProcessActionNode:function(){this.startProcessAction=new Element("div",{styles:this.css.startProcessAction}).inject(this.taskTitleBar),this.startProcessAction.addEvents({click:function(t){this.showStartProcessArea(t)}.bind(this)})},loadTitleTextNode:function(){this.taskTitleTextNode=new Element("div",{styles:this.css.taskTitleTextNode,text:this.lp.title}).inject(this.taskTitleBar)},loadSearchNode:function(){this.searchBarAreaNode=new Element("div",{styles:this.css.searchBarAreaNode}).inject(this.taskTitleBar),layout.mobile&&this.searchBarAreaNode.setStyle("margin-left","10px"),layout.mobile&&this.searchBarAreaNode.setStyle("margin-right","20px"),this.searchBarNode=new Element("div",{styles:this.css.searchBarNode}).inject(this.searchBarAreaNode),this.searchBarActionNode=new Element("div",{styles:this.css.searchBarActionNode}).inject(this.searchBarNode),this.searchBarInputBoxNode=new Element("div",{styles:this.css.searchBarInputBoxNode}).inject(this.searchBarNode),this.searchBarInputNode=new Element("input",{type:"text",value:this.lp.searchKey,styles:this.css.searchBarInputNode}).inject(this.searchBarInputBoxNode);var t=this;this.searchBarActionNode.addEvent("click",function(){this.searchTask()}.bind(this)),this.searchBarInputNode.addEvents({focus:function(){this.value===t.lp.searchKey&&this.set("value","")},blur:function(){this.value||this.set("value",t.lp.searchKey)},keydown:function(t){13===t.code&&(this.searchTask(),t.preventDefault())}.bind(this),selectstart:function(t){t.preventDefault()}})},loadTab:function(){this.tabAreaNode=new Element("div",{styles:this.css.tabAreaNode}).inject(this.content),this.createTabItem(this.lp.task,"task.png","task",function(){this.showTask()}.bind(this)),this.createTabItem(this.lp.done,"done.png","taskCompleted",function(){this.showDone()}.bind(this)),this.createTabItem(this.lp.read,"read.png","read",function(){this.showRead()}.bind(this)),this.createTabItem(this.lp.readed,"readed.png","readCompleted",function(){this.showReaded()}.bind(this)),this.getWorkCounts()},createTabItem:function(t,s,e,i){var a=new Element("div",{styles:this.css.tabItemNode}).inject(this.tabAreaNode);layout.mobile||new Element("div",{styles:this.css.tabItemIconNode}).inject(a).setStyle("background-image","url(../x_component_process_TaskCenter/$Main/default/tab/"+s+")");new Element("div",{styles:this.css.tabItemTextNode,text:t}).inject(a);this[e+"CountNode"]=new Element("div",{styles:this.css.tabItemCountNode}).inject(a),a.addEvent("click",function(){i()}.bind(this)),this.tabs.push(a)},loadFilterAction:function(){},getWorkCounts:function(){this.getAction(function(){this.action.getCount(function(t){this.counts=t.data,this.taskCountNode.set("text","( "+(this.counts.task>100?"99":this.counts.task)+" )"),this.taskCompletedCountNode.set("text","( "+(this.counts.taskCompleted>100?"99":this.counts.taskCompleted)+" )"),this.readCountNode.set("text","( "+(this.counts.read>100?"99":this.counts.read)+" )"),this.readCompletedCountNode.set("text","( "+(this.counts.readCompleted>100?"99":this.counts.readCompleted)+" )")}.bind(this),null,this.desktop.session.user.distinguishedName)}.bind(this))},loadContent:function(){this.contentNode=new Element("div",{styles:this.css.contentNode}).inject(this.content),this.contentListAreaNode=new Element("div",{styles:this.css.contentListAreaNode}).inject(this.contentNode),this.setContentNodeHeight(),this.addEvent("resize",this.setContentNodeHeight.bind(this))},setContentNodeHeight:function(){var t=this.content.getSize(),s=this.taskTitleBar.getSize(),e=this.tabAreaNode.getSize(),i=t.y-s.y-e.y-1;this.contentNode.setStyle("height",i+"px");var a=0;this.taskList&&(a+=t.x),this.taskCompletedList&&(a+=t.x),this.readList&&(a+=t.x),this.readCompletedList&&(a+=t.x),this.contentListAreaNode.setStyle("width",a+"px")},openTab:function(){var t="task";switch(this.options.navi&&(t=this.options.navi),this.status&&(t=this.status.navi),t){case"task":this.showTask();break;case"done":this.showDone();break;case"read":this.showRead();break;case"readed":this.showReaded();break;case"review":this.showReview();break;default:this.showTask()}},showTask:function(){"task"!==this.currentTab?(this.showTab(0),this.currentTab="task",this.taskList?(this.taskList.show(),this.taskList&&this.taskList.refresh()):(this.createTaskList(),this.taskList.show())):this.taskList&&this.taskList.refresh()},showTab:function(t){this.tabs.each(function(s,e){if(e===t)if(s.getLast().setStyles(this.css.tabItemTextNode_current),layout.mobile)s.getFirst().setStyles(this.css.tabItemTextNode_current);else{s.getFirst().getNext().setStyles(this.css.tabItemTextNode_current);var i=s.getFirst().getStyle("background-image");s.getFirst().setStyle("background-image",i.replace(".png","_cur.png"))}else if(s.getLast().setStyles(this.css.tabItemCountNode),layout.mobile)s.getFirst().setStyles(this.css.tabItemTextNode);else{s.getFirst().getNext().setStyles(this.css.tabItemTextNode);i=s.getFirst().getStyle("background-image");s.getFirst().setStyle("background-image",i.replace("_cur.png",".png"))}}.bind(this))},createTaskList:function(){this.contentNode||this.loadContent(),this.taskList=new MWF.xApplication.process.TaskCenter.TaskList(this.contentListAreaNode,this)},showStartProcessArea:function(){layout.mobile?this.showStartProcessArea_mobile():this.showStartProcessArea_pc()},showStartProcessArea_mobile:function(){this.startProcessAreaNode||this.createStartProcessArea_mobile(),this.startProcessAreaNode.setStyle("display","block"),new Fx.Morph(this.startProcessAreaNode,{duration:200,transition:Fx.Transitions.Expo.easeOut}).start({left:"0px"})},showStartProcessArea_pc:function(){this.startProcessAreaNode||this.createStartProcessArea(),this.content.mask({inject:this.content,destroyOnHide:!0,id:"process_taskcenter_startProcessMask",style:this.css.maskNode});var t=this.content.getParent().getElement("#process_taskcenter_startProcessMask");t&&(this.inBrowser&&t.setStyles({width:"100%",height:"100%"}),t.addEvent("click",function(t){this.closeStartProcessArea(t)}.bind(this))),this.startProcessAreaNode.fade("in")},createStartProcessArea_mobile:function(){this.startProcessAreaNode=new Element("div",{styles:this.css.startProcessAreaNode_mobile}).inject(this.content);var t=this.content.getSize();this.startProcessAreaNode.setStyles({width:t.x+"px",height:t.y+"px",top:"0px",left:t.x+"px"}),this.startProcessTopNode=new Element("div",{styles:this.css.startProcessTopNode_mobile}).inject(this.startProcessAreaNode),this.startProcessCloseNode=new Element("div",{styles:this.css.startProcessCloseNode_mobile,text:this.lp.back}).inject(this.startProcessTopNode),this.startProcessCloseNode.addEvent("click",function(t){this.closeStartProcessArea(t)}.bind(this)),this.startProcessListNode=new Element("div",{styles:this.css.startProcessListNode_mobile}).inject(this.startProcessAreaNode);var s=t.y-this.startProcessTopNode.getSize().y;this.startProcessListNode.setStyle("height",s+"px"),this.getAction(function(){this.action.listApplicationStartable(function(t){this.app=this,MWF.UD.getDataJson("taskCenter_startTop",function(s){if(this.top5Data=s,this.top5Data&&this.top5Data.length){new Element("div",{styles:this.css.applicationChildTitleNode,text:this.lp.startTop5}).inject(this.startProcessListNode);var e=new Element("div",{styles:this.css.applicationChildChildNode}).inject(this.startProcessListNode);this.top5Data.sort((function(t,s){return 0-(t.count-s.count)})),this.top5Data.each(function(t,s){s<5&&new MWF.xApplication.process.TaskCenter.Process(t,this,{name:t.applicationName},e)}.bind(this))}t.data.each(function(t){new Element("div",{styles:this.css.applicationChildTitleNode,text:t.name}).inject(this.startProcessListNode);var s=new Element("div",{styles:this.css.applicationChildChildNode}).inject(this.startProcessListNode);t.processList.each(function(e){new MWF.xApplication.process.TaskCenter.Process(e,this,t,s)}.bind(this))}.bind(this))}.bind(this))}.bind(this))}.bind(this))},createStartProcessArea:function(){this.createStartProcessAreaNode(),this.createStartProcessScrollNode(),this.listApplications(),this.setResizeStartProcessAreaHeight(),this.addEvent("resize",this.setResizeStartProcessAreaHeight.bind(this))},createStartProcessAreaNode:function(){this.startProcessAreaNode=new Element("div",{styles:this.css.startProcessAreaNode}).inject(this.content)},createStartProcessCloseNode:function(){this.startProcessTopNode=new Element("div",{styles:this.css.startProcessTopNode}).inject(this.startProcessRightListNode),this.startProcessCloseNode=new Element("div",{styles:this.css.startProcessCloseNode}).inject(this.startProcessTopNode),this.startProcessCloseNode.addEvent("click",function(t){this.closeStartProcessArea(t)}.bind(this))},createStartProcessSearchNode:function(){this.startProcessSearchNode=new Element("div",{styles:this.css.startProcessSearchNode}).inject(this.startProcessRightListNode),this.startProcessSearchIconNode=new Element("div",{styles:this.css.startProcessSearchIconNode}).inject(this.startProcessSearchNode),this.startProcessSearchAreaNode=new Element("div",{styles:this.css.startProcessSearchAreaNode}).inject(this.startProcessSearchNode),this.startProcessSearchInputNode=new Element("input",{styles:this.css.startProcessSearchInputNode}).inject(this.startProcessSearchAreaNode),this.startProcessSearchInputNode.set("value",this.lp.searchProcess),this.startProcessSearchInputNode.addEvents({focus:function(){this.startProcessSearchInputNode.get("value")===this.lp.searchProcess&&this.startProcessSearchInputNode.set("value","")}.bind(this),blur:function(){this.startProcessSearchInputNode.get("value")||this.startProcessSearchInputNode.set("value",this.lp.searchProcess)}.bind(this),keydown:function(t){13===t.code&&this.searchStartProcess()}.bind(this)}),this.startProcessSearchIconNode.addEvent("click",function(){this.searchStartProcess()}.bind(this))},searchStartProcess:function(){var t=this.startProcessSearchInputNode.get("value");if(t&&t!==this.lp.searchProcess&&this.appStartableData){this.startApplications.each((function(t){t.unselected()})),this.searchProcessSearchchildNode&&this.searchProcessSearchchildNode.destroy();var s=this.lp.searchProcessResault.replace("{key}",t);this.searchProcessSearchchildNode=new Element("div",{styles:this.css.applicationChildNode}).inject(this.startProcessProcessAreaNode),this.searchProcessSearchchildNode.setStyle("display","block"),new Element("div",{styles:this.css.applicationChildTitleNode,text:s}).inject(this.searchProcessSearchchildNode);var e=new Element("div",{styles:this.css.applicationChildChildNode}).inject(this.searchProcessSearchchildNode);this.appStartableData.each(function(s){s.processList.each(function(i){if(-1!==i.name.indexOf(t)){var a=Object.clone(i);a.applicationName=s.name,new MWF.xApplication.process.TaskCenter.Process(a,{app:this},{name:s},e)}}.bind(this))}.bind(this))}},createStartProcessScrollNode:function(){this.startProcessApplicationListNode=new Element("div",{styles:this.css.startProcessApplicationListNode}).inject(this.startProcessAreaNode),this.startProcessRightListNode=new Element("div",{styles:this.css.startProcessRightListNode}).inject(this.startProcessAreaNode),this.createStartProcessCloseNode(),this.createStartProcessSearchNode(),this.startProcessApplicationScrollNode=new Element("div",{styles:this.css.startProcessApplicationScrollNode}).inject(this.startProcessApplicationListNode),this.startProcessApplicationAreaNode=new Element("div",{styles:this.css.startProcessApplicationAreaNode}).inject(this.startProcessApplicationScrollNode),this.startProcessProcessListNode=new Element("div",{styles:this.css.startProcessProcessListNode}).inject(this.startProcessRightListNode),this.startProcessProcessScrollNode=new Element("div",{styles:this.css.startProcessProcessScrollNode}).inject(this.startProcessProcessListNode),this.startProcessProcessAreaNode=new Element("div",{styles:this.css.startProcessProcessAreaNode}).inject(this.startProcessProcessScrollNode),MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.startProcessApplicationScrollNode,{distance:100,friction:4}),new MWF.widget.ScrollBar(this.startProcessProcessScrollNode,{distance:100,friction:4})}.bind(this))},closeStartProcessArea:function(){if(layout.mobile){var t=this.startProcessAreaNode.getSize();new Fx.Morph(this.startProcessAreaNode,{duration:200,transition:Fx.Transitions.Expo.easeOut,onComplete:function(){this.startProcessAreaNode.setStyle("display","none")}.bind(this)}).start({left:t.x+"px"})}else this.content.unmask(),this.startProcessAreaNode&&this.startProcessAreaNode.fade("out")},setResizeStartProcessAreaHeight:function(){if(this.startProcessAreaNode){var t=this.content.getSize(),s=this.startProcessAreaNode.getSize(),e=(t.x-s.x)/2,i=(t.y-s.y)/2;this.startProcessAreaNode.setStyle("top",i+"px"),this.startProcessAreaNode.setStyle("left",e+"px");var a=this.content.getParent().getElement("#process_taskcenter_startProcessMask");if(a&&(a.setStyles({width:t.x+"px",height:t.y+"px"}),a.position({relativeTo:this.content,position:"topLeft",edge:"topLeft"})),this.startProcessProcessListNode){var o=this.startProcessTopNode.getSize(),n=this.startProcessSearchNode.getSize(),r=s.y-o.y-n.y;this.startProcessProcessListNode.setStyle("height",r+"px")}}},listApplications:function(){this.getAction(function(){this.action.listApplicationStartable(function(t){this.appStartableData=t.data,this.startProcessSearchNode.setStyle("display","block"),this.allApplicationStarter=new MWF.xApplication.process.TaskCenter.AllApplication(t.data,this),this.allApplicationStarter.selected(),t.data.each(function(t){new MWF.xApplication.process.TaskCenter.Application(t,this)}.bind(this))}.bind(this))}.bind(this))},getAction:function(t){this.action||(this.action=MWF.Actions.get("x_processplatform_assemble_surface")),t&&t()},refreshAll:function(){this.getWorkCounts(),this.taskList&&"task"===this.currentTab&&this.taskList.refresh()},createTaskCompletedList:function(t){this.contentNode||this.loadContent(),this.taskCompletedList=new MWF.xApplication.process.TaskCenter.TaskCompletedList(this.contentListAreaNode,this,t)},showDone:function(){"done"!==this.currentTab?(this.showTab(1),this.currentTab="done",this.taskCompletedList?(this.taskCompletedList.show(),this.taskCompletedList&&this.taskCompletedList.refresh()):(this.createTaskCompletedList(this.status?this.status.filter:null),this.taskCompletedList.show())):this.taskCompletedList&&this.taskCompletedList.refresh(),this.searchBarAreaNode.setStyle("display","block"),this.searchBarInputNode.set("value",this.lp.searchKey)},createReadList:function(t){this.contentNode||this.loadContent(),this.readList=new MWF.xApplication.process.TaskCenter.ReadList(this.contentListAreaNode,this,t)},showRead:function(){"read"!==this.currentTab?(this.showTab(2),this.currentTab="read",this.readList?(this.readList.show(),this.readList&&this.readList.refresh()):(this.createReadList(this.status?this.status.filter:null),this.readList.show())):this.readList&&this.readList.refresh(),this.searchBarAreaNode.setStyle("display","block"),this.searchBarInputNode.set("value",this.lp.searchKey)},createReadedList:function(t){this.contentNode||this.loadContent(),this.readedList=new MWF.xApplication.process.TaskCenter.ReadCompletedList(this.contentListAreaNode,this,t)},showReaded:function(){"readed"!==this.currentTab?(this.showTab(3),this.currentTab="readed",this.readedList?(this.readedList.show(),this.readedList&&this.readedList.refresh()):(this.createReadedList(this.status?this.status.filter:null),this.readedList.show())):this.readedList&&this.readedList.refresh(),this.searchBarAreaNode.setStyle("display","block"),this.searchBarInputNode.set("value",this.lp.searchKey)},createReviewList:function(t){this.contentNode||this.loadContent(),this.reviewList=new MWF.xApplication.process.TaskCenter.ReviewList(this.contentListAreaNode,this,t)},showReview:function(){"review"!==this.currentTab?(this.showTab(4),this.currentTab="review",this.reviewList?(this.reviewList.show(),this.reviewList&&this.reviewList.refresh()):(this.createReviewList(this.status?this.status.filter:null),this.reviewList.show())):this.reviewList&&this.reviewList.refresh(),this.searchBarAreaNode.setStyle("display","block")},recordStatus:function(){var t=this.currentTab||"task",s=null;return"done"===t&&(s=this.taskCompletedList.filterData),"read"===t&&(s=this.readList.filterData),"readed"===t&&(s=this.readedList.filterData),"review"===t&&(s=this.reviewList.filterData),{navi:this.currentTab||"task",filter:s}},searchTask:function(){var t=this.searchBarInputNode.get("value");if(t&&t!==this.lp.searchKey)switch(this.currentTab||"task"){case"task":this.taskList.filterData||(this.taskList.filterData={}),this.taskList.filterData.key=t,this.taskList.refilter();break;case"done":this.taskCompletedList.filterData||(this.taskCompletedList.filterData={}),this.taskCompletedList.filterData.key=t,this.taskCompletedList.refilter();break;case"read":this.readList.filterData||(this.readList.filterData={}),this.readList.filterData.key=t,this.readList.refilter();break;case"readed":this.readedList.filterData||(this.readedList.filterData={}),this.readedList.filterData.key=t,this.readedList.refilter();break;case"review":this.reviewList.filterData||(this.reviewList.filterData={}),this.reviewList.filterData.key=t,this.reviewList.refilter()}}}),MWF.xApplication.process.TaskCenter.Application=new Class({initialize:function(t,s){this.bgColors=["#30afdc","#e9573e","#8dc153","#9d4a9c","#ab8465","#959801","#434343","#ffb400","#9e7698","#00a489"],this.data=t,this.app=s,this.container=this.app.startProcessApplicationAreaNode,this.processContainer=this.app.startProcessProcessAreaNode,this.css=this.app.css,this.isLoaded=!1,this.load()},load:function(){this.node=new Element("div",{styles:this.css.applicationNode}).inject(this.container),this.iconAreaNode=new Element("div",{styles:this.css.applicationIconAreaNode}).inject(this.node),this.iconNode=new Element("img",{styles:this.css.applicationIconNode}).inject(this.iconAreaNode),this.data.icon?this.iconNode.set("src","data:image/png;base64,"+this.data.icon):this.iconNode.set("src","../x_component_process_ApplicationExplorer/$Main/default/icon/application.png"),this.textNode=new Element("div",{styles:this.css.applicationTextNode}).inject(this.node),this.textNode.set("text",this.data.name),this.textNode.set("title",this.data.name),this.childNode=new Element("div",{styles:this.css.applicationChildNode}).inject(this.processContainer),this.node.addEvent("click",function(){this.selected()}.bind(this)),this.app.startApplications.push(this)},unselected:function(){this.childNode.setStyle("display","none"),this.node.setStyles(this.css.applicationNode)},selected:function(){this.app.startApplications.each((function(t){t.unselected()})),this.app.searchProcessSearchchildNode&&this.app.searchProcessSearchchildNode.destroy(),this.app.startProcessSearchInputNode&&this.app.startProcessSearchInputNode.set("value",this.app.lp.searchProcess),this.childNode.setStyle("display","block"),this.node.setStyles(this.css.applicationNode_selected),this.isLoaded||(this.loadChild(),this.isLoaded=!0)},loadChild:function(){new Element("div",{styles:this.css.applicationChildTitleNode,text:this.app.lp.startProcess}).inject(this.childNode);var t=new Element("div",{styles:this.css.applicationChildChildNode}).inject(this.childNode);this.data.processList.each(function(s){new MWF.xApplication.process.TaskCenter.Process(s,this,this.data,t)}.bind(this))}}),MWF.xApplication.process.TaskCenter.AllApplication=new Class({Extends:MWF.xApplication.process.TaskCenter.Application,initialize:function(t,s){this.bgColors=["#30afdc","#e9573e","#8dc153","#9d4a9c","#ab8465","#959801","#434343","#ffb400","#9e7698","#00a489"],this.data=t,this.app=s,this.container=this.app.startProcessApplicationAreaNode,this.processContainer=this.app.startProcessProcessAreaNode,this.css=this.app.css,this.isLoaded=!1,this.load()},load:function(){this.node=new Element("div",{styles:this.css.applicationNode}).inject(this.container),this.iconAreaNode=new Element("div",{styles:this.css.applicationIconAreaNode}).inject(this.node),this.iconNode=new Element("img",{styles:this.css.applicationIconNode}).inject(this.iconAreaNode),this.iconNode.set("src","../x_component_process_TaskCenter/$Main/default/icon/appAppliction.png"),this.textNode=new Element("div",{styles:this.css.applicationTextNode}).inject(this.node),this.textNode.set("text",this.app.lp.all),this.textNode.set("title",this.app.lp.all),this.childNode=new Element("div",{styles:this.css.applicationChildNode}).inject(this.processContainer),this.node.addEvent("click",function(){this.selected()}.bind(this)),this.app.startApplications.push(this)},unselected:function(){this.childNode.empty(),this.isLoaded=!1,this.childNode.setStyle("display","none"),this.node.setStyles(this.css.applicationNode)},loadChild:function(){MWF.UD.getDataJson("taskCenter_startTop",function(t){if(this.top5Data=t,this.top5Data&&this.top5Data.length){new Element("div",{styles:this.css.applicationChildTitleNode,text:this.app.lp.startTop5}).inject(this.childNode);var s=new Element("div",{styles:this.css.applicationChildChildNode}).inject(this.childNode);this.top5Data.sort((function(t,s){return 0-(t.count-s.count)}))}var e=[];this.data.each(function(t){new Element("div",{styles:this.css.applicationChildTitleNode,text:t.name}).inject(this.childNode);var s=new Element("div",{styles:this.css.applicationChildChildNode}).inject(this.childNode);t.processList.each(function(i){e.push(i.id),new MWF.xApplication.process.TaskCenter.Process(i,this,t,s)}.bind(this))}.bind(this)),s&&(saveflag=!1,this.top5Data.each(function(t,i){-1!==e.indexOf(t.id)?i<5&&new MWF.xApplication.process.TaskCenter.Process(t,this,{name:t.applicationName},s):(saveflag=!0,t.count=0)}.bind(this)),saveflag&&MWF.UD.putData("taskCenter_startTop",this.top5Data))}.bind(this))}}),MWF.xApplication.process.TaskCenter.Process=new Class({initialize:function(t,s,e,i){this.data=t,this.application=s,this.applicationData=e,this.app=this.application.app,this.container=i,this.css=this.app.css,this.load()},load:function(){this.node=new Element("div.processItem",{styles:this.css.startProcessNode}).inject(this.container),this.iconNode=new Element("div",{styles:this.css.processIconNode}).inject(this.node),this.data.icon?this.iconNode.setStyle("background-image","url("+this.data.icon+")"):this.iconNode.setStyle("background-image","url(../x_component_process_ProcessManager/$Explorer/default/processIcon/process.png)"),this.actionNode=new Element("div",{styles:this.css.processActionNode,text:this.app.lp.start}).inject(this.node),this.textNode=new Element("div",{styles:this.css.processTextNode}).inject(this.node),this.textNode.set({text:this.data.name+(this.data.applicationName?" -- ("+this.data.applicationName+")":""),title:this.data.name+"-"+this.data.description}),this.actionNode.addEvents({mouseover:function(){this.actionNode.setStyles(this.css.processActionNode_over)}.bind(this),mouseout:function(){this.actionNode.setStyles(this.css.processActionNode)}.bind(this),click:function(t){this.startProcess(t)}.bind(this)}),this.node.addEvents({mouseover:function(){this.node.setStyles(this.css.startProcessNode_over),this.actionNode.setStyle("display","block")}.bind(this),mouseout:function(){this.node.setStyles(this.css.startProcessNode_out)}.bind(this)})},startProcess:function(){this.app.closeStartProcessArea(),MWF.xDesktop.requireApp("process.TaskCenter","ProcessStarter",function(){new MWF.xApplication.process.TaskCenter.ProcessStarter(this.data,this.app,{onStarted:function(t,s,e){this.afterStartProcess(t,s,e)}.bind(this)}).load()}.bind(this))},recordProcessData:function(){MWF.UD.getDataJson("taskCenter_startTop",function(t){t&&t.length||(t=[]);var s=null;this.data.lastStartTime=new Date;for(var e=0,i=!0,a=0;a<t.length;a++){var o=t[a];o.id===this.data.id&&(s=o),i&&(o.lastStartTime?new Date(o.lastStartTime)<new Date(t[e].lastStartTime)&&(e=a):(e=a,i=!1))}s?(s.lastStartTime=new Date,s.count=(s.count||0)+1,s.applicationName=this.applicationData.name):t.length<10?(this.data.count=1,this.data.applicationName=this.applicationData.name,t.push(this.data)):(t.splice(e,1),this.data.count=1,this.data.applicationName=this.applicationData.name,t.push(this.data)),MWF.UD.putData("taskCenter_startTop",t)}.bind(this))},afterStartProcess:function(t,s,e){this.recordProcessData();var i=[],a=[];if(t.each(function(t){-1!==t.currentTaskIndex&&a.push(t.taskList[t.currentTaskIndex].work),i.push(this.getStartWorkInforObj(t))}.bind(this)),1===a.length){var o={workId:a[0],appId:a[0]};this.app.desktop.openApplication(null,"process.Work",o),layout.desktop.message&&this.createStartWorkResault(i,s,e,!1)}else layout.desktop.message&&this.createStartWorkResault(i,s,e,!0)},getStartWorkInforObj:function(t){var s=[],e="";return t.taskList.each(function(i,a){s.push(i.person+"("+i.department+")"),t.currentTaskIndex===a&&(e=i.id)}.bind(this)),{activity:t.fromActivityName,users:s,currentTask:e}},createStartWorkResault:function(t,s,e,i){var a="";t.each(function(t){var s=[];t.users.each((function(t){s.push(MWF.name.cn(t))})),a+="<div><b>"+this.app.lp.nextActivity+'<font style="color: #ea621f">'+t.activity+"</font>, "+this.app.lp.nextUser+'<font style="color: #ea621f">'+s.join(", ")+"</font></b>",t.currentTask&&i?a+='&nbsp;&nbsp;&nbsp;&nbsp;<span value="'+t.currentTask+'">'+this.app.lp.deal+"</span></div>":a+="</div>"}.bind(this));var o={subject:this.app.lp.processStarted,content:"<div>"+this.app.lp.processStartedMessage+"“["+e+"]"+s+"”</div>"+a},n=layout.desktop.message.addTooltip(o),r=layout.desktop.message.addMessage(o);this.setStartWorkResaultAction(n),this.setStartWorkResaultAction(r)},setStartWorkResaultAction:function(t){var s=t.node.getElements("span");s.setStyles(this.app.css.dealStartedWorkAction);var e=this;s.addEvent("click",(function(t){var s={taskId:this.get("value"),appId:this.get("value")};e.app.desktop.openApplication(t,"process.Work",s)}))}});