MWF.xApplication.process.FormDesigner.Module=MWF.xApplication.process.FormDesigner.Module||{},MWF.xDesktop.requireApp("process.FormDesigner","Module.$Element",null,!1),MWF.xApplication.process.FormDesigner.Module.Htmleditor=MWF.FCHtmleditor=new Class({Extends:MWF.FC$Element,Implements:[Options,Events],options:{style:"default",propertyPath:"../x_component_process_FormDesigner/Module/Htmleditor/htmleditor.html"},initialize:function(e,t){this.setOptions(t),this.path="../x_component_process_FormDesigner/Module/Htmleditor/",this.cssPath="../x_component_process_FormDesigner/Module/Htmleditor/"+this.options.style+"/css.wcss",this._loadCss(),this.moduleType="element",this.moduleName="htmleditor",this.form=e,this.container=null,this.containerNode=null},_createMoveNode:function(){this.moveNode=new Element("div",{MWFType:"htmleditor",id:this.json.id,styles:this.css.moduleNodeMove,events:{selectstart:function(){return!1}}}).inject(this.form.container)},_createNode:function(){this.node=this.moveNode.clone(!0,!0),this.node.setStyles(this.css.moduleNode),this.node.set("id",this.json.id),this.node.addEvent("selectstart",(function(e){e.preventDefault()}))},_setEditStyle_custom:function(e){if("editorProperties"==e&&this.editor){Object.each(this.json.editorProperties,function(e,t){"true"==e&&(this.json.editorProperties[t]=!0),"false"==e&&(this.json.editorProperties[t]=!1)}.bind(this)),this.distroyCkeditor();var t=Object.clone(this.json.editorProperties);if(this.json.config&&this.json.config.code){var o=MWF.Macro.exec(this.json.config.code,this);Object.each(o,(function(e,o){t[o]=e}))}this.loadCkeditor(t)}"templateCode"==e&&this.editor&&this.editor.setData(this.json.templateCode)},_initModule:function(){this.node.empty();var e=Object.clone(this.json.editorProperties);if(this.json.config&&this.json.config.code){var t=MWF.Macro.exec(this.json.config.code,this);Object.each(t,(function(t,o){e[o]=t}))}this.loadCkeditor(e),this._setNodeProperty(),this.form.isSubform||this._createIconAction(),this._setNodeEvent()},loadCkeditor:function(e){COMMON.AjaxModule.load("ckeditor",function(){CKEDITOR.disableAutoInline=!0;var t=new Element("div").inject(this.node);this.json.templateCode&&t.set("html",this.json.templateCode);this.node.getSize().y;var o=e||{};"Mobile"==this.form.options.mode&&(o.toolbar=[{name:"paragraph",items:["Bold","Italic","-","TextColor","BGColor","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","Undo","Redo"]},{name:"basicstyles",items:["Styles","FontSize"]}]),this.editor=CKEDITOR.replace(t,o),this.editor.on("dataReady",(function(){this.editor.setReadOnly(!0)}),this)}.bind(this))},destroy:function(){this.distroyCkeditor(),this.form.moduleList.erase(this),this.form.moduleNodeList.erase(this.node),this.form.moduleElementNodeList.erase(this.node),this.form.scriptDesigner&&this.form.scriptDesigner.removeModule(this.json),this.property&&this.property.destroy(),this.node.destroy(),this.actionArea.destroy(),delete this.form.json.moduleList[this.json.id],this.json=null,delete this.json,this.treeNode.destroy(),o2.release(this)},distroyCkeditor:function(){this.editor&&this.editor.destroy(),this.editor=null}});