MWF.xApplication.process.FormDesigner.Module=MWF.xApplication.process.FormDesigner.Module||{},MWF.xDesktop.requireApp("process.FormDesigner","Module.$Module",null,!1),MWF.xApplication.process.FormDesigner.Module.$Container=MWF.FC$Container=new Class({Extends:MWF.FC$Module,Implements:[Options,Events],options:{injectActions:[{name:"before",styles:"injectActionBefore",event:"click",action:"injectBefore",title:MWF.APPFD.LP.formAction.insertBefore},{name:"after",styles:"injectActionAfter",event:"click",action:"injectAfter",title:MWF.APPFD.LP.formAction.insertAfter},{name:"top",styles:"injectActionTop",event:"click",action:"injectTop",title:MWF.APPFD.LP.formAction.insertTop},{name:"bottom",styles:"injectActionBottom",event:"click",action:"injectBottom",title:MWF.APPFD.LP.formAction.insertBottom}]},_setNodeProperty:function(){this.node.store("module",this),-1==this.form.moduleList.indexOf(this)&&this.form.moduleList.push(this),-1==this.form.moduleNodeList.indexOf(this.node)&&this.form.moduleNodeList.push(this.node),-1==this.form.moduleContainerNodeList.indexOf(this.node)&&this.form.moduleContainerNodeList.push(this.node),this.node.store("module",this)},_dragIn:function(e){if(e.onDragModule=this,this.Component||(e.inContainer=this),e.parentContainer=this,e.nextModule=null,this.node.setStyles({border:"1px solid #ffa200"}),e.controlMode)e.copyNode&&e.copyNode.hide();else{var t=e._getCopyNode(this);t.show(),t.inject(this.node)}},_setControlModeNode:function(){this.controlMode?this.copyNode&&this.copyNode.hide():this.onDragModule&&this.onDragModule._dragIn(this)},_dragOut:function(e){e.inContainer=null,e.parentContainer=null,e.nextModule=null,this.node.setStyles(this.css.moduleNode),this.setCustomStyles(),e._getCopyNode().setStyle("display","none")},_dragDrop:function(e,t){(t||!new Event(event).control)&&(this.node.setStyles(this.css.moduleNode),this.setCustomStyles())},_dragInLikeElement:function(e){e.parentContainer=this.parentContainer,e.nextModule=this,this.node.setStyles({border:"1px solid #ffa200"}),e._getCopyNode().inject(this.node,"before")},_getSubModule:function(){for(var e=[],t=this.node.getFirst();t;){var o=t.retrieve("module");o&&e.push(o),t=t.getNext()}return e},load:function(e,t,o){this.json=e,this.node=t,this.node.store("module",this),this.node.setStyles(this.css.moduleNode),this._loadNodeStyles(),this._loadNodeCustomStyles(),this._initModule(),this._loadTreeNode(o),this.parseModules(),this.parentContainer=this.treeNode.parentNode.module,this._setEditStyle_custom("id"),this.json.moduleName=this.moduleName},parseModules:function(){for(var e=[],t=this.node.getFirst();t;){if(t.get("MWFtype")){var o=this.form.getDomjson(t),i=t;e.push({dom:i,json:o})}t=t.getNext()}e.each(function(e){module=this.form.loadModule(e.json,e.dom,this)}.bind(this))},destroy:function(){this._getSubModule().each((function(e){e.destroy()})),this._deleteModule()},_deleteModule:function(){this.form.moduleList.erase(this),this.form.moduleNodeList.erase(this.node),this.form.moduleElementNodeList.erase(this.node),this.form.scriptDesigner&&this.form.scriptDesigner.removeModule(this.json),this.property&&this.property.destroy(),this.node.destroy(),this.actionArea.destroy(),delete this.form.json.moduleList[this.json.id],this.json=null,delete this.json,this.treeNode.destroy(),o2.release(this)},copy:function(e){this.copySubModule().move(e)},copyTo:function(e){e||(e=this.form);var t=this.node.clone(!1,!0),o=Object.clone(this.json);t.inject(e.node);var i=this.moduleName.capitalize(),s="page"==this.form.moduleType?"PC":"FC",n=new MWF[s+i](this.form);return o.id=n._getNewId(),t.set("id",o.id),this.form.json.moduleList[o.id]=o,this.form.scriptDesigner&&this.form.scriptDesigner.createModuleScript(o),n.load(o,t,e),n},copySubModule:function(e){var t=this.copyTo(e);return this._getSubModule().each((function(e){"container"==e.moduleType&&e.copySubModule(t),"element"==e.moduleType&&e.copyTo(t),"component"==e.moduleType&&e.copyTo(t)})),t}});