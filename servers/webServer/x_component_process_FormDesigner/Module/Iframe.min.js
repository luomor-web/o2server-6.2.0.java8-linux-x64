MWF.xApplication.process.FormDesigner.Module=MWF.xApplication.process.FormDesigner.Module||{},MWF.xDesktop.requireApp("process.FormDesigner","Module.$Element",null,!1),MWF.xApplication.process.FormDesigner.Module.Iframe=MWF.FCIframe=new Class({Extends:MWF.FC$Element,Implements:[Options,Events],options:{style:"default",propertyPath:"../x_component_process_FormDesigner/Module/Iframe/iframe.html"},initialize:function(e,t){this.setOptions(t),this.path="../x_component_process_FormDesigner/Module/Iframe/",this.cssPath="../x_component_process_FormDesigner/Module/Iframe/"+this.options.style+"/css.wcss",this._loadCss(),this.moduleType="element",this.moduleName="iframe",this.form=e,this.container=null,this.containerNode=null},load:function(e,t,s){this.json=e,this.node=t,this.node.store("module",this);var i=this.node.getElement("iframe");i&&i.destroy(),this.node.setStyles(this.css.moduleNode),this._loadNodeStyles(),this._initModule(),this._loadTreeNode(s),this.setCustomStyles(),this.parentContainer=this.treeNode.parentNode.module,this._setEditStyle_custom("id"),this.parseModules(),this.json.moduleName=this.moduleName},_resetModuleDomNode:function(){},_preprocessingModuleData:function(){},_recoveryModuleData:function(){},_createMoveNode:function(){this.moveNode=new Element("div",{MWFType:"iframe",id:this.json.id,styles:this.css.moduleNodeMove,events:{selectstart:function(){return!1}}}).inject(this.form.container)},_createNode:function(e){this.node=e||this.moveNode.clone(!0,!0),this.node.setStyles(this.css.moduleNode),this.node.set("id",this.json.id),this.node.addEvent("selectstart",(function(){return!1})),this.iconNode=new Element("div",{styles:this.css.iconNode}).inject(this.node),new Element("div",{styles:this.css.iconNodeIcon}).inject(this.iconNode),new Element("div",{styles:this.css.iconNodeText,text:"iframe"}).inject(this.iconNode),this.iconNode.addEvent("click",function(){this.loadIframe()}.bind(this))},_loadNodeStyles:function(){this.iconNode=this.node.getElement("div"),this.iconNode||(this.iconNode=new Element("div").inject(this.node,"top")),this.iconNode.setStyles(this.css.iconNode);var e=this.iconNode.getFirst("div"),t=this.iconNode.getLast("div");e.setStyles(this.css.iconNodeIcon),t.setStyles(this.css.iconNodeText),this.iconNode.addEvent("click",function(){this.loadIframe()}.bind(this))},getIconPosition:function(){var e=this.node.getPosition(this.node.getOffsetParent()),t=this.node.getSize(),s=this.iconNode.getSize();return{x:e.x+t.x-s.x-1,y:e.y+1}},loadIframe:function(){this.iframe?this.closeSrc():this.loadSrc()},closeSrc:function(){this.iframe.destroy(),this.iframe=null,this.iconNode.setStyles(this.css.iconNode),this.iconNode.getFirst().setStyles(this.css.iconNodeIcon)},loadSrc:function(){if("script"!=this.json.valueType&&this.json.src){var e=this.getIconPosition();this.iconNode.setStyles({float:"right","margin-top":"0px",position:"absolute",top:e.y,left:e.x-18}),this.iconNode.getFirst().setStyles({background:"url("+this.path+this.options.style+"/icon/close.png) 5px center no-repeat"}),this.iframe=new Element("iframe",{styles:this.css.iframe,border:"0",src:this.json.src}),this.iframe.inject(this.node,"top")}}});