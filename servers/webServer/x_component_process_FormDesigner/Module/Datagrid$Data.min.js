MWF.xApplication.process.FormDesigner.Module=MWF.xApplication.process.FormDesigner.Module||{},MWF.xDesktop.requireApp("process.FormDesigner","Module.$Container",null,!1),MWF.xApplication.process.FormDesigner.Module.Datagrid$Data=MWF.FCDatagrid$Data=new Class({Extends:MWF.FCTable$Td,Implements:[Options,Events],options:{propertyPath:"../x_component_process_FormDesigner/Module/Datagrid$Data/datagrid$Data.html",actions:[{name:"insertCol",icon:"insertCol1.png",event:"click",action:"insertCol",title:MWF.LP.process.formAction.insertCol},{name:"deleteCol",icon:"deleteCol1.png",event:"click",action:"deleteCol",title:MWF.LP.process.formAction.deleteCol}],allowModules:["textfield","number","personfield","orgfield","org","calendar","textarea","select","radio","checkbox","combox","image","label","htmleditor","button","imageclipper","address","attachment"]},initialize:function(e,t){this.setOptions(t),this.path="../x_component_process_FormDesigner/Module/Datagrid$Data/",this.cssPath="../x_component_process_FormDesigner/Module/Datagrid$Data/"+this.options.style+"/css.wcss",this._loadCss(),this.moduleType="container",this.moduleName="datagrid$Data",this.Node=null,this.form=e},setAllStyles:function(){Object.each(this.json.styles,function(e,t){t.test(/^border\w*/gi)||t&&this.node.setStyle(t,e)}.bind(this)),this.setPropertiesOrStyles("properties"),this.reloadMaplist()},load:function(e,t,s){if(this.json=e,this.node=t,this.node.store("module",this),this.node.setStyles(this.css.moduleNode),!this.json.id){var o=this._getNewId(s.json.id);this.json.id=o}t.set({MWFType:"datagrid$Data",id:this.json.id}),this.form.json.moduleList[this.json.id]||(this.form.json.moduleList[this.json.id]=this.json),this._initModule(),this._loadTreeNode(s),this.form.parseModules(this,this.node),this.parentContainer=this.treeNode.parentNode.module,this._setEditStyle_custom("id"),this.checkSequence(),this.json.moduleName=this.moduleName,!1===this.json.isShow&&this._switchShow()},_setEditStyle_custom:function(e,t,s){"cellType"==e&&this.checkSequence(t,s)},_preprocessingModuleData:function(){this.node.clearStyles(),this.json.recoveryStyles=Object.clone(this.json.styles),this.json.recoveryStyles&&Object.each(this.json.recoveryStyles,function(e,t){-1!=e.indexOf("x_processplatform_assemble_surface")||-1!=e.indexOf("x_portal_assemble_surface")||(this.node.setStyle(t,e),delete this.json.styles[t])}.bind(this))},_recoveryModuleData:function(){this.json.recoveryStyles&&(this.json.styles=this.json.recoveryStyles),this.json.recoveryStyles=null},setCustomStyles:function(){this._recoveryModuleData();var e=this.node.getStyle("border");this.node.clearStyles(),this.node.setStyles(this.css.moduleNode),this.initialStyles&&this.node.setStyles(this.initialStyles),this.node.setStyle("border",e),Object.each(this.json.styles,function(e,t){t.test(/^border\w*/gi)||this.node.setStyle(t,e)}.bind(this)),this.setCustomNodeStyles(this.node,this.parentContainer.json.contentStyles),!1===this.json.isShow&&this._switchShow()},checkSequence:function(e,t){if("sequence"==this.json.cellType&&"sequence"!=t)if(this.treeNode.firstChild){var s=this,o=this.treeNode.firstChild.module;this.form.designer.confirm("warn",o.node,MWF.APPFD.LP.notice.changeToSequenceTitle,MWF.APPFD.LP.notice.changeToSequence,300,120,(function(){o.destroy(),this.close(),s.sequenceNode||(s.node.empty(),s.sequenceNode=new Element("div",{styles:s.css.sequenceNode,text:"(N)",MWFType1:"MWFTemp"}).inject(s.node))}),(function(){s.json.cellType="content",e.checked=!1,this.close()}),null)}else this.sequenceNode||(this.node.empty(),this.sequenceNode=new Element("div",{styles:this.css.sequenceNode,text:"(N)",MWFType1:"MWFTemp"}).inject(this.node));else"sequence"==t||this.sequenceNode&&(this.sequenceNode.destroy(),this.sequenceNode=null)},_dragIn:function(e){this.treeNode.firstChild||"sequence"==this.json.cellType?this.parentContainer._dragIn(e):-1!=this.options.allowModules.indexOf(e.moduleName)?(this.Component||(e.inContainer=this),e.parentContainer=this,e.nextModule=null,this.node.setStyles({border:"1px solid #ffa200"}),e._getCopyNode().inject(this.node)):this.parentContainer._dragIn(e)},_showActions:function(){this.actionArea&&(this._setActionAreaPosition(),this.actionArea.setStyle("display","block"))},_insertCol:function(){for(var e=$("MWFInsertColNumber").get("value"),t=document.getElementsByName("MWFInsertColPosition"),s="before",o=0;o<t.length;o++)if(t[o].checked){s=t[o].value;break}for(var i=this.node.getParent("tr").getParent("table"),n=this.node.cellIndex,r=i.rows[0],l=i.rows[1],a=r.cells[n],d=1;d<=e;d++){var c=new Element("th").inject(a,s);this.form.getTemplateData("Datagrid$Title",function(e){var t=Object.clone(e),s=new MWF.FCDatagrid$Title(this.form);s.load(t,c,this.parentContainer),this.parentContainer.elements.push(s)}.bind(this))}for(var h=l.cells[n],u=1;u<=e;u++){var p=new Element("td").inject(h,s);this.form.getTemplateData("Datagrid$Data",function(e){var t=Object.clone(e),s=new MWF.FCDatagrid$Data(this.form);s.load(t,p,this.parentContainer),this.parentContainer.containers.push(s)}.bind(this))}this.unSelected(),this.selected()},_deleteCol:function(){var e=this.node.getParent("tr"),t=e.getParent("table"),s=this.node.cellIndex,o=t.rows[0],i=t.rows[1];if(e.cells.length<=1)this.parentContainer.destroy();else{var n=o.cells[s],r=i.cells[s],l=n.retrieve("module");l&&(l.parentContainer.elements.erase(l),l.destroy());var a=r.retrieve("module");a&&(a.parentContainer.containers.erase(a),a.destroy())}},_switchShow:function(e){"boolean"===typeOf(e)?this.json.isShow=e:e=!1!==this.json.isShow,this.node.setStyle("opacity",e?"1":"0.3")}});