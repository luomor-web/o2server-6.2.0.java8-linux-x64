MWF.xApplication.process.FormDesigner.Module=MWF.xApplication.process.FormDesigner.Module||{},MWF.xDesktop.requireApp("process.FormDesigner","Module.$Element",null,!1),MWF.require("MWF.widget.Toolbar",null,!1),MWF.xApplication.process.FormDesigner.Module.Actionbar=MWF.FCActionbar=new Class({Extends:MWF.FC$Element,Implements:[Options,Events],options:{style:"default",propertyPath:"../x_component_process_FormDesigner/Module/Actionbar/actionbar.html"},addAction:function(){},initialize:function(t,o){this.setOptions(o),this.path="../x_component_process_FormDesigner/Module/Actionbar/",this.cssPath="../x_component_process_FormDesigner/Module/Actionbar/"+this.options.style+"/css.wcss",this._loadCss(),this.moduleType="component",this.moduleName="actionbar",this.Node=null,this.form=t,this.container=null,this.containerNode=null,this.systemTools=[],this.customTools=[],this.multiTools=[]},setTemplateStyles:function(t){this.json.style=t.style,this.json.iconOverStyle=t.iconOverStyle||"",this.json.customIconStyle=t.customIconStyle,this.json.customIconOverStyle=t.customIconOverStyle||""},clearTemplateStyles:function(t){this.json.style="form",this.json.iconOverStyle="",this.json.customIconStyle="",this.json.customIconOverStyle=""},setAllStyles:function(){this._resetActionbar()},_createMoveNode:function(){this.moveNode=new Element("div",{MWFType:"actionbar",id:this.json.id,styles:this.css.moduleNodeMove,events:{selectstart:function(t){t.preventDefault()}}}).inject(this.form.container)},_createNode:function(t){this.node=new Element("div",{id:this.json.id,MWFType:"actionbar",styles:this.css.moduleNode,events:{selectstart:function(t){t.preventDefault()}}}).inject(this.form.node),"Mobile"==this.form.options.mode?(this.node.set("text",MWF.APPFD.LP.notice.notUseModuleInMobile+"("+this.moduleName+")"),this.node.setStyles({height:"24px","line-height":"24px","background-color":"#999"})):(this.toolbarNode=new Element("div").inject(this.node),this.toolbarWidget=new MWF.widget.Toolbar(this.toolbarNode,{style:this.json.style},this),o2.xhr_get(this.path+"toolbars.json",function(t){var o=t.responseText;this.json.multiTools=JSON.parse(o).map((function(t){return t.system=!0,t})),o=o2.bindJson(o,{lp:MWF.xApplication.process.FormDesigner.LP.actionBar}),this.multiToolsJson=JSON.parse(o).map((function(t){return t.system=!0,t})),this.setToolbars(this.multiToolsJson,this.toolbarNode),this.toolbarWidget.load()}.bind(this),null,null,!0))},_initModule:function(){this.setStyleTemplate(),this._setNodeProperty(),this.form.isSubform||this._createIconAction(),this._setNodeEvent(),this._refreshActionbar(),this.json.events||MWF.getJSON(this.path+"template.json",function(t){this.json.events=t.events}.bind(this),!1)},_refreshActionbar:function(){"Mobile"==this.form.options.mode?(this.node.set("text",MWF.APPFD.LP.notice.notUseModuleInMobile+"("+this.moduleName+")"),this.node.setStyles({height:"24px","line-height":"24px","background-color":"#999"})):(this.toolbarNode=this.node.getFirst("div"),this.toolbarNode.empty(),this.toolbarWidget=new MWF.widget.Toolbar(this.toolbarNode,{style:this.json.style},this),this.json.actionStyles||(this.json.actionStyles=Object.clone(this.toolbarWidget.css)),this.toolbarWidget.css=this.json.actionStyles,this.loadMultiToolbar())},_resetActionbar:function(){"Mobile"==this.form.options.mode?(this.node.set("text",MWF.APPFD.LP.notice.notUseModuleInMobile+"("+this.moduleName+")"),this.node.setStyles({height:"24px","line-height":"24px","background-color":"#999"})):(this.toolbarNode=this.node.getFirst("div"),this.toolbarNode.empty(),this.toolbarWidget=new MWF.widget.Toolbar(this.toolbarNode,{style:this.json.style},this),this.json.actionStyles?(this.toolbarWidget.css=Object.merge(Object.clone(this.json.actionStyles),this.toolbarWidget.css),this.json.actionStyles=Object.clone(this.toolbarWidget.css)):this.json.actionStyles=Object.clone(this.toolbarWidget.css),this.loadMultiToolbar())},loadMultiToolbar:function(){if(this.json.multiTools){if(MWF.xApplication.process.FormDesigner.LP.actionBar){var t=JSON.stringify(this.json.multiTools);t=o2.bindJson(t,{lp:MWF.xApplication.process.FormDesigner.LP.actionBar}),this.multiToolsJson=JSON.parse(t).map((function(t){return t.system=!0,t}))}else this.multiToolsJson=this.json.multiTools;var o=Array.clone(this.multiToolsJson);this.setMultiToolbars(o,this.toolbarNode),this.toolbarWidget.load()}else this.json.defaultTools?(this.json.multiTools=this.json.defaultTools.map((function(t){return t.system=!0,t})),this.json.tools&&(this.json.multiTools=this.json.multiTools.concat(this.json.tools)),this.setMultiToolbars(Array.clone(this.json.multiTools),this.toolbarNode),this.toolbarWidget.load()):o2.xhr_get(this.path+"toolbars.json",function(t){var o=t.responseText;this.json.multiTools=JSON.parse(o).map((function(t){return t.system=!0,t})),MWF.xApplication.process.FormDesigner.LP.actionBar?(o=o2.bindJson(o,{lp:MWF.xApplication.process.FormDesigner.LP.actionBar}),this.multiToolsJson=JSON.parse(o).map((function(t){return t.system=!0,t}))):this.multiToolsJson=this.json.multiTools,this.setMultiToolbars(Array.clone(this.multiToolsJson),this.toolbarNode),this.toolbarWidget.load()}.bind(this),null,null,!0)},setMultiToolbars:function(t,o){t.each(function(t){t.system?this.setToolbars([t],o):this.setCustomToolbars([t],o)}.bind(this))},setToolbars:function(t,o){t.each(function(t){var s=new Element("div",{MWFnodetype:t.type,MWFButtonImage:this.path+""+this.options.style+"/tools/"+(this.json.style||"default")+"/"+t.img,title:t.title,MWFButtonAction:t.action,MWFButtonText:t.text}).inject(o);if(this.json.iconOverStyle&&s.set("MWFButtonImageOver",this.path+""+this.options.style+"/tools/"+this.json.iconOverStyle+"/"+t.img),s.isSystemTool=!0,this.systemTools.push(s),this.multiTools.push(s),t.sub){var e=o.getLast();this.setToolbars(t.sub,e)}}.bind(this))},setCustomToolbars:function(t,o){var s="";this.json.customIconStyle&&(s=this.json.customIconStyle+"/"),t.each(function(t){var e=new Element("div",{MWFnodetype:t.type,MWFButtonImage:this.path+""+this.options.style+"/custom/"+s+t.img,title:t.title,MWFButtonAction:t.action,MWFButtonText:t.text}).inject(o);if(this.json.customIconOverStyle&&e.set("MWFButtonImageOver",this.path+""+this.options.style+"/custom/"+this.json.customIconOverStyle+"/"+t.img),this.customTools.push(e),this.multiTools.push(e),t.sub){var i=o.getLast();this.setToolbars(t.sub,i)}}.bind(this))},_setEditStyle_custom:function(t){"hideSystemTools"==t&&(this.json.hideSystemTools?this.systemTools.each((function(t){t.setStyle("display","none")})):this.systemTools.each((function(t){t.setStyle("display","block")}))),"defaultTools"!=t&&"tools"!=t&&"multiTools"!=t&&"actionStyles"!==t||this._refreshActionbar()}});