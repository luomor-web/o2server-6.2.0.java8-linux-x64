MWF.xDesktop.requireApp("process.FormDesigner","widget.EventsEditor",null,!1),MWF.xApplication.process.FormDesigner.widget.ParameterEditor=new Class({Implements:[Options,Events],Extends:MWF.xApplication.process.FormDesigner.widget.EventsEditor,options:{style:"default",maxObj:document.body},load:function(t,e,i){this.data=t||{},this.module=e,this.scriptPath=i,this.addNewItemAction=new Element("div",{styles:this.css.addNewItemAction,text:"+"}).inject(this.node),this.addNewItemAction.addEvent("click",function(){this.addEvent(),this.addNewItemAction.setStyle("display","none")}.bind(this)),Object.each(t,function(t,e){var i=new MWF.xApplication.process.FormDesigner.widget.ParameterEditor.Item(this);i.load(e,t),this.items.push(i)}.bind(this))},addItem:function(t){this.data[t.event]=t.data,this.items.push(t)},addEvent:function(){new MWF.xApplication.process.FormDesigner.widget.ParameterEditor.Item(this).load("","")},deleteItem:function(t){this.items.erase(t),this.data[t.event]&&(this.data[t.event].code="",this.data[t.event].html="",delete this.data[t.event]),t.deleteScriptDesignerItem(),t.container&&t.container.destroy(),Object.getLength(this.data)||this.addNewItemAction&&this.addNewItemAction.setStyle("display","block")}}),MWF.xApplication.process.FormDesigner.widget.ParameterEditor.Item=new Class({Extends:MWF.xApplication.process.FormDesigner.widget.EventsEditor.Item,createContainerTitle:function(){this.container=new Element("div",{styles:this.editor.css.itemContainer}).inject(this.editor.eventsContainer),this.titleContainer=new Element("div",{styles:this.editor.css.itemTitleContainer}).inject(this.container),this.iconNode=new Element("div",{styles:this.editor.css.parIconNode}).inject(this.titleContainer),this.actionNode=new Element("div",{styles:this.editor.css.actionNode}).inject(this.titleContainer),this.textNode=new Element("div",{styles:this.editor.css.textNode,text:this.event}).inject(this.titleContainer)},editCode:function(){this.editor.currentEditItem&&this.editor.currentEditItem!=this&&this.editor.currentEditItem.editCodeComplete(),this.editor.currentEditItem!=this?(this.codeEditor||(this.codeEditor=new MWF.widget.ScriptArea(this.codeNode,{style:"event",title:this.event+" (S)",maxObj:this.editor.options.maxObj,onChange:function(){var t=this.codeEditor.toJson();this.data.code=t.code,this.data.html=t.html,this.checkIcon()}.bind(this),onSave:function(){var t=this.codeEditor.toJson();this.data.code=t.code,this.data.html=t.html,this.checkIcon(),this.editor.app.savePage()}.bind(this)}),this.codeEditor.load(this.data)),this.morph||(this.morph=new Fx.Morph(this.codeNode,{duration:200})),this.codeNode.setStyle("display","block"),this.morph.start({height:[0,300]}).chain(function(){this.codeEditor.resizeContentNodeSize(),this.codeEditor.focus()}.bind(this)),this.editor.currentEditItem=this):this.editCodeComplete()},bindScriptDesigner:function(){var t=this.editor.app.form||this.editor.app.page;t.scriptDesigner&&t.scriptDesigner.addScriptItem(this.data,"code",this.editor.module,this.editor.scriptPath,this.event)},deleteScriptDesignerItem:function(){var t=this.editor.app.form||this.editor.app.page;t.scriptDesigner&&t.scriptDesigner.deleteScriptItem(this.editor.module,this.editor.scriptPath,this.event)},checkIcon:function(){this.data.code?this.iconNode.setStyle("background","url("+this.editor.path+this.editor.options.style+"/icon/codePar.png) center center no-repeat"):this.iconNode.setStyle("background","url("+this.editor.path+this.editor.options.style+"/icon/codePar_empty.png) center center no-repeat")}});