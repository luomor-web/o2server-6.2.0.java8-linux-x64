MWF.xDesktop.requireApp("Attendance","Explorer",null,!1),MWF.xDesktop.requireApp("Selector","package",null,!1),MWF.xDesktop.requireApp("Template","MForm",null,!1),MWF.xApplication.Attendance.MyDetail=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(t,e,i,a){this.setOptions(a),this.app=e,this.path="../x_component_Attendance/$MyDetail/",this.cssPath="../x_component_Attendance/$MyDetail/"+this.options.style+"/css.wcss",this._loadCss(),this.actions=i,this.node=$(t)},load:function(){this.loadTab()},loadTab:function(){this.tabNode=new Element("div",{styles:this.css.tabNode}).inject(this.node),this.detailArea=new Element("div",{styles:this.css.tabPageContainer}).inject(this.tabNode),this.detailStaticArea=new Element("div",{styles:this.css.tabPageContainer}).inject(this.tabNode),MWF.require("MWF.widget.Tab",function(){this.tabs=new MWF.widget.Tab(this.tabNode,{style:"attendance"}),this.tabs.load(),this.detailPage=this.tabs.addTab(this.detailArea,this.app.lp.myDetail,!1),this.detailPage.contentNodeArea.set("class","detailPage"),this.detailPage.addEvent("show",function(){this.detailExplorer||(this.detailExplorer=new MWF.xApplication.Attendance.MyDetail.Explorer(this.detailArea,this),this.detailExplorer.load())}.bind(this)),this.detailStaticPage=this.tabs.addTab(this.detailStaticArea,this.app.lp.myDetailStatic,!1),this.detailStaticPage.contentNodeArea.set("class","detailStaticPage"),this.detailStaticPage.addEvent("show",function(){this.detailStaticExplorer||(this.detailStaticExplorer=new MWF.xApplication.Attendance.MyDetail.DetailStaticExplorer(this.detailStaticArea,this),this.detailStaticExplorer.load())}.bind(this)),this.tabs.pages[0].showTab()}.bind(this))}}),MWF.xApplication.Attendance.MyDetail.Explorer=new Class({Extends:MWF.xApplication.Attendance.Explorer,Implements:[Options,Events],initialize:function(t,e,i){this.setOptions(i),this.parent=e,this.app=e.app,this.css=e.css,this.path=e.path,this.actions=e.actions,this.node=$(t),this.preMonthDate=new Date,this.initData(),this.peopleActions||(this.peopleActions=new MWF.xAction.org.express.RestActions)},initData:function(){this.toolItemNodes=[]},reload:function(){this.node.empty(),this.load()},load:function(){this.loadConfig(),this.loadFilter(),this.loadContentNode(),this.setNodeScroll();var t=(this.preMonthDate.getMonth()+1).toString();1==t.length&&(t="0"+t);var e={cycleYear:this.preMonthDate.getFullYear().toString(),cycleMonth:t};this.loadView(e)},loadConfig:function(){var t;this.config={},this.configSetting=new Object(null),this.actions.listSetting(function(e){e.data?(e.data.map(function(t){this.configSetting[t.configCode]=t}.bind(this)),t=this.configSetting.APPEALABLE.configValue):t=null}.bind(this),null,!1),this.config.APPEALABLE=!t||"false"!=t},loadFilter:function(){var t=MWF.xApplication.Attendance.LP;this.fileterNode=new Element("div.fileterNode",{styles:this.css.fileterNode}).inject(this.node);this.fileterNode.set("html","<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='filterTable'><tr>    <td styles='filterTableTitle' lable='cycleYear'></td>    <td styles='filterTableValue' item='cycleYear'></td>    <td styles='filterTableTitle' lable='cycleMonth'></td>    <td styles='filterTableValue' item='cycleMonth'></td>    <td styles='filterTableTitle' lable='date'></td>    <td styles='filterTableValue' item='date'></td>    <td styles='filterTableTitle' lable='isAbsent'></td>    <td styles='filterTableValue' item='isAbsent'></td>    <td styles='filterTableTitle' lable='isLate'></td>    <td styles='filterTableValue' item='isLate'></td>    <td styles='filterTableTitle' lable='isLackOfTime'></td>    <td styles='filterTableValue' item='isLackOfTime'></td>    <td styles='filterTableValue' item='action'></td></tr></table>"),MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.fileterNode,{},{isEdited:!0,itemTemplate:{cycleYear:{text:t.annuaal,type:"select",selectValue:function(){for(var t=[],e=(new Date).getFullYear(),i=0;i<6;i++)t.push(e--);return t},event:{change:function(t,e){var i=this.getDateSelectValue();t.form.getItem("date").resetItemOptions(i,i)}.bind(this)}},cycleMonth:{text:t.months,type:"select",defaultValue:function(){var t=((new Date).getMonth()+1).toString();return 1==t.length?"0"+t:t},selectValue:["","01","02","03","04","05","06","07","08","09","10","11","12"],event:{change:function(t,e){var i=this.getDateSelectValue();t.form.getItem("date").resetItemOptions(i,i)}.bind(this)}},date:{text:t.date,type:"select",selectValue:function(){var t=this.preMonthDate.getFullYear(),e=this.preMonthDate.getMonth(),i=new Date(t,e,1),a=[];for(a.push("");i.getMonth()===e;){var s=i.getDate().toString();1==s.length&&(s="0"+s),a.push(s),i.setDate(i.getDate()+1)}return a}.bind(this)},isAbsent:{text:t.absent,type:"select",selectValue:["","true","false"],selectText:t.absendSelectText},isLate:{text:t.late,type:"select",selectValue:["","true","false"],selectText:t.lateSelectText},isLackOfTime:{text:t.lackOfTime,type:"select",selectValue:["","true","false"],selectText:t.truefalseSelectText},action:{value:t.query,type:"button",className:"filterButton",event:{click:function(){var t=this.form.getResult(!1,null,!1,!0,!1);"string"==typeOf(t.isAbsent)&&(t.isAbsent=this.getBoolean(t.isAbsent)),"string"==typeOf(t.isLate)&&(t.isLate=this.getBoolean(t.isLate)),"string"==typeOf(t.isLackOfTime)&&(t.isLackOfTime=this.getBoolean(t.isLackOfTime)),t.date&&""!=t.date&&(t.q_date=year+"-"+month+"-"+t.date),this.loadView(t)}.bind(this)}}}},this.app,this.css),this.form.load()}.bind(this),!0)},getBoolean:function(t){return"true"===t||"false"!==t&&t},loadContentNode:function(){this.elementContentNode=new Element("div",{styles:this.css.elementContentNode}).inject(this.node),this.app.addEvent("resize",function(){this.setContentSize()}.bind(this))},loadView:function(t){this.elementContentNode.empty(),this.view&&delete this.view,this.view=new MWF.xApplication.Attendance.MyDetail.View(this.elementContentNode,this.app,this),this.view.filterData=t,this.view.load(),this.setContentSize()},setContentSize:function(){var t=this.parent.tabs?this.parent.tabs.tabNodeContainer.getSize():{x:0,y:0},e=this.fileterNode?this.fileterNode.getSize():{x:0,y:0},i=this.parent.node.getSize(),a=this.elementContentNode.getStyle("padding-top").toFloat(),s=this.elementContentNode.getStyle("padding-bottom").toFloat(),n=i.y-t.y-a-s-e.y-20;this.elementContentNode.setStyle("height",n+"px"),this.pageCount=(n/40).toInt()+5,this.view&&this.view.items.length<this.pageCount&&this.view.loadElementList(this.pageCount-this.view.items.length)}}),MWF.xApplication.Attendance.MyDetail.SelfHoliday=new Class({Extends:MWF.xApplication.Attendance.MyDetail.Explorer,loadView:function(t){this.elementContentNode.empty(),this.view&&delete this.view,this.view=new MWF.xApplication.Attendance.MyDetail.SelfHolidayView(this.elementContentNode,this.app,this),this.view.filterData=t,this.view.load(),this.setContentSize()}}),MWF.xApplication.Attendance.MyDetail.DetailStaticExplorer=new Class({Extends:MWF.xApplication.Attendance.MyDetail.Explorer,load:function(){this.loadContentNode(),this.setNodeScroll();var t={cycleYear:this.preMonthDate.getFullYear().toString(),cycleMonth:this.preMonthDate.format(this.app.lp.dateFormatOnlyMonth)};this.loadView(t)},loadFilter:function(){this.fileterNode=new Element("div.fileterNode",{styles:this.css.fileterNode}).inject(this.node);var t=new Element("table",{width:"100%",border:"0",cellpadding:"5",cellspacing:"0",styles:this.css.filterTable,class:"filterTable"}).inject(this.fileterNode);t.setStyle("width","360px");var e=new Element("tr").inject(t);this.createYearSelectTd(e),this.createMonthSelectTd(e),this.createActionTd(e)},createMonthSelectTd:function(t){var e=this,i=new Element("td",{styles:this.css.filterTableTitle,text:MWF.xApplication.Attendance.LP.months}).inject(t);i=new Element("td",{styles:this.css.filterTableValue}).inject(t);this.cycleMonth=new MDomItem(i,{name:"cycleMonth",type:"select",selectValue:["","01","02","03","04","05","06","07","08","09","10","11","12"],event:{change:function(){e.dateSelecterTd&&e.createDateSelectTd()}}},!0,this.app),this.cycleMonth.load()},createActionTd:function(t){var e=new Element("td",{styles:this.css.filterTableValue}).inject(t);new Element("button",{text:MWF.xApplication.Attendance.LP.query,styles:this.css.filterButton}).inject(e).addEvent("click",function(){var t=this.preMonthDate.getFullYear().toString(),e=(this.preMonthDate.getMonth()+1).toString();1==e.length&&(e="0"+e);var i={cycleYear:t,cycleMonth:e};this.isAbsent&&""!=this.isAbsent.getValue()&&(i.isAbsent=this.isAbsent.getValue()),this.isLeaveEarlier&&""!=this.isLeaveEarlier.getValue()&&(i.isLeaveEarlier=this.isLeaveEarlier.getValue()),this.isLate&&""!=this.isLate.getValue()&&(i.isLate=this.isLate.getValue()),this.q_date&&""!=this.q_date.getValue()&&(i.q_date=t+"-"+e+"-"+this.q_date.getValue()),this.loadView(i)}.bind(this))},loadView:function(t){this.elementContentNode.empty(),this.view&&delete this.view,this.view=new MWF.xApplication.Attendance.MyDetail.DetailStaticView(this.elementContentNode,this.app,this),this.view.filterData=t,this.view.listItemUrl=this.path+"listItem_detailStatic.json",this.view.load(),this.setContentSize()}}),MWF.xApplication.Attendance.MyDetail.SelfHolidayStaticExplorer=new Class({Extends:MWF.xApplication.Attendance.MyDetail.Explorer,loadView:function(t){this.elementContentNode.empty(),this.view&&delete this.view,this.view=new MWF.xApplication.Attendance.MyDetail.SelfHolidayStaticView(this.elementContentNode,this.app,this),this.view.filterData=t,this.view.load(),this.setContentSize()}}),MWF.xApplication.Attendance.MyDetail.View=new Class({Extends:MWF.xApplication.Attendance.Explorer.View,_createItem:function(t){return new MWF.xApplication.Attendance.MyDetail.Document(this.table,t,this.explorer,this)},_getCurrentPageData:function(t,e){e||(e=100);var i=this.items.length?this.items[this.items.length-1].data.id:"(0)",a=this.filterData||{};a.key=this.sortField||this.sortFieldDefault||"",a.order=this.sortType||this.sortTypeDefault||"",a.q_empName=layout.desktop.session.user.distinguishedName,this.actions.listDetailFilterNext(i,e,a,function(e){var i=e.data;i.each(function(t){t.APPEALABLE=this.explorer.config.APPEALABLE}.bind(this)),e.data=i,t&&t(e)}.bind(this))},_removeDocument:function(t,e){},_createDocument:function(){},_openDocument:function(t){}}),MWF.xApplication.Attendance.MyDetail.SelfHolidayView=new Class({Extends:MWF.xApplication.Attendance.Explorer.View,_createItem:function(t){return new MWF.xApplication.Attendance.MyDetail.SelfHolidayDocument(this.table,t,this.explorer,this)},_getCurrentPageData:function(t,e){var i=this.filterData||{};i.q_empName=layout.desktop.session.user.distinguishedName,this.actions.listDetailFilterUser(i,function(e){t&&t(e)}.bind(this))},_removeDocument:function(t,e){},_createDocument:function(){},_openDocument:function(t){}}),MWF.xApplication.Attendance.MyDetail.DetailStaticView=new Class({Extends:MWF.xApplication.Attendance.Explorer.View,_createItem:function(t){return new MWF.xApplication.Attendance.MyDetail.DetailStaticDocument(this.table,t,this.explorer,this)},_getCurrentPageData:function(t,e){var i=this.filterData||{};i.key=this.sortField||this.sortFieldDefault||"",i.order=this.sortType||this.sortTypeDefault||"",i.q_empName=layout.desktop.session.user.distinguishedName;var a=((new Date).getMonth()+1).toString();1==a.length&&(a="0"+a),i.cycleMonth=a,this.actions.listStaticMonthPerson(i.q_empName,i.cycleYear,i.cycleMonth,function(e){t&&t(e)}.bind(this))},_removeDocument:function(t,e){},_createDocument:function(){},_openDocument:function(t){}}),MWF.xApplication.Attendance.MyDetail.SelfHolidayStaticView=new Class({Extends:MWF.xApplication.Attendance.Explorer.View,_createItem:function(t){return new MWF.xApplication.Attendance.MyDetail.SelfHolidayStaticDocument(this.table,t,this.explorer,this)},_getCurrentPageData:function(t,e){var i=this.filterData||{};this.actions.listDetailFilterUser(i,function(e){t&&t(e)}.bind(this))},_removeDocument:function(t,e){},_createDocument:function(){},_openDocument:function(t){}}),MWF.xApplication.Attendance.MyDetail.Document=new Class({Extends:MWF.xApplication.Attendance.Explorer.Document,appeal:function(){"BUILTIN"==this.explorer.configSetting.APPEAL_AUDIFLOWTYPE.configValue?new MWF.xApplication.Attendance.MyDetail.Appeal(this.explorer,this.data).create():this.loadProcess(this.explorer.configSetting.APPEAL_AUDIFLOW_ID.configValue,{record:this.data},null)},loadProcess:function(t,e,i){this.getProcess(t,function(t){MWF.xDesktop.requireApp("process.TaskCenter","ProcessStarter",function(){new MWF.xApplication.process.TaskCenter.ProcessStarter(t,this.app,{latest:i,workData:e,onStarted:function(t,e,i){this.afterStartProcess(t,e,i)}.bind(this)}).load()}.bind(this))}.bind(this))},afterStartProcess:function(t,e,i){var a=[],s=[];if(t.each(function(t){-1!==t.currentTaskIndex&&s.push(t.taskList[t.currentTaskIndex].work),a.push(this.getStartWorkInforObj(t))}.bind(this)),1===s.length){var n={workId:s[0],appId:s[0]};this.app.desktop.openApplication(null,"process.Work",n),this.createStartWorkResault(a,e,i,!1)}else this.createStartWorkResault(a,e,i,!0)},createStartWorkResault:function(t,e,i,a){var s="";t.each(function(t){var e=[];t.users.each((function(t){e.push(MWF.name.cn(t))})),s+="<div><b>"+this.app.lp.nextActivity+'<font style="color: #ea621f">'+t.activity+"</font>, "+this.app.lp.nextUser+'<font style="color: #ea621f">'+e.join(", ")+"</font></b>",t.currentTask&&a?s+='&nbsp;&nbsp;&nbsp;&nbsp;<span value="'+t.currentTask+'">'+this.app.lp.deal+"</span></div>":s+="</div>"}.bind(this));var n=t[0].title||e,o={subject:this.app.lp.processStarted,content:"<div>"+this.app.lp.processStartedMessage+"“["+i+"]"+n+"”</div>"+s},l=layout.desktop.message.addTooltip(o),r=layout.desktop.message.addMessage(o);this.setStartWorkResaultAction(l),this.setStartWorkResaultAction(r)},getStartWorkInforObj:function(t){var e="",i=[],a="";return t.taskList.each(function(s,n){e=s.title,i.push(s.person+"("+s.department+")"),t.currentTaskIndex===n&&(a=s.id)}.bind(this)),{activity:t.fromActivityName,users:i,currentTask:a,title:e}},setStartWorkResaultAction:function(t){var e=t.node.getElements("span");e.setStyles(this.css.dealStartedWorkAction);var i=this;e.addEvent("click",(function(t){var e={taskId:this.get("value"),appId:this.get("value")};i.app.desktop.openApplication(t,"process.Work",e)}))},getProcess:function(t,e){this.action=new o2.xDesktop.Actions.RestActions("","x_processplatform_assemble_surface",""),this.action.actions={getProces:{uri:"/jaxrs/process/{id}/complex"}},this.action.invoke({name:"getProces",async:!1,parameter:{id:t},success:function(t){e&&e(t.data)}.bind(this)})},seeAppeal:function(){if(this.data.appealInfos[0].appealAuditInfo&&this.data.appealInfos[0].appealAuditInfo.workId){var t=this.data.appealInfos[0].appealAuditInfo.workId,e={workId:t,appId:"process.Work"+t};this.app.desktop.openApplication(null,"process.Work",e)}else{new MWF.xApplication.Attendance.MyDetail.Appeal(this.explorer,this.data).open()}}}),MWF.xApplication.Attendance.MyDetail.SelfHolidayDocument=new Class({Extends:MWF.xApplication.Attendance.Explorer.Document}),MWF.xApplication.Attendance.MyDetail.DetailStaticDocument=new Class({Extends:MWF.xApplication.Attendance.Explorer.Document}),MWF.xApplication.Attendance.MyDetail.SelfHolidayStaticDocument=new Class({Extends:MWF.xApplication.Attendance.Explorer.Document}),MWF.xApplication.Attendance.MyDetail.Appeal=new Class({Extends:MWF.widget.Common,initialize:function(t,e){this.explorer=t,this.app=t.app,this.detailData=e,this.css=this.explorer.css,this.load()},load:function(){},open:function(t){this.isNew=!1,this.isEdited=!1,this.app.restActions.getAppeal(this.detailData.id,function(t){this.data=t.data,this.data.onDutyTime=this.detailData.onDutyTime,this.data.offDutyTime=this.detailData.offDutyTime}.bind(this),null,!1),this.data||(this.data=this.detailData||{}),this._open()},create:function(){this.isNew=!0,this.data=this.detailData||{},this._open()},edit:function(){this.isEdited=!0,this.app.restActions.getAppeal(this.detailData.id,function(t){this.data=t.data,this.data.onDutyTime=this.detailData.onDutyTime,this.data.offDutyTime=this.detailData.offDutyTime}.bind(this),null,!1),this.data||(this.data=this.detailData||{}),this._open()},_open:function(){this.createMarkNode=new Element("div",{styles:this.css.createMarkNode,events:{mouseover:function(t){t.stopPropagation()},mouseout:function(t){t.stopPropagation()}}}).inject(this.app.content,"after"),this.createAreaNode=new Element("div",{styles:this.css.createAreaNode}),this.createNode(),this.createAreaNode.inject(this.createMarkNode,"after"),this.createAreaNode.fade("in"),this.setCreateNodeSize(),this.setCreateNodeSizeFun=this.setCreateNodeSize.bind(this),this.addEvent("resize",this.setCreateNodeSizeFun)},createNode:function(){var t=MWF.xApplication.Attendance.LP,e=this;this.createNode=new Element("div",{styles:this.css.createNode}).inject(this.createAreaNode),this.createContainerNode=new Element("div",{styles:this.css.createContainerNode}).inject(this.createNode),this.setScrollBar(this.createContainerNode),this.createIconNode=new Element("div",{styles:this.isNew?this.css.createNewNode:this.css.createIconNode}).inject(this.createContainerNode),this.createFormNode=new Element("div",{styles:this.css.createFormNode}).inject(this.createContainerNode),this.createTableContainer=new Element("div",{styles:this.css.createTableContainer}).inject(this.createFormNode),this.createTableArea=new Element("div",{styles:this.css.createTableArea}).inject(this.createTableContainer);var i=this.data,a=[];!i.isGetSelfHolidays||i.selfHolidayDayTime!=t.wholeDay&&"全天"!=i.selfHolidayDayTime?!i.isAbnormalDuty||i.abnormalDutyDayTime!=t.wholeDay&&"全天"!=i.abnormalDutyDayTime?i.isLackOfTime?a.push(t.lackOfTime):(!i.isGetSelfHolidays||i.selfHolidayDayTime!=t.am&&"上午"!=i.selfHolidayDayTime?i.isLate?a.push(t.late):i.isAbsent&&["上午","全天",t.am,t.wholeDay].contains(i.absentDayTime)?a.push(t.absent):i.isAbnormalDuty&&["上午","全天",t.am,t.wholeDay].contains(i.abnormalDutyDayTime)&&a.push(t.abNormalDuty):a.push(t.levelAsked),!i.isGetSelfHolidays||"下午"!=i.selfHolidayDayTime&&i.selfHolidayDayTime!=t.pm?(!i.isAbsent||"下午"!=i.absentDayTime&&i.absentDayTime!=t.pm)&&(!i.isAbnormalDuty||"下午"!=i.abnormalDutyDayTime&&i.abnormalDutyDayTime!=t.pm)||a.push(t.abNormalDuty):a.push(t.levelAsked)):a.push(t.abNormalDuty):a.push(t.levelAsked),this.data.statusShow=a.unique().join();var s=t.draft;0==i.status?s=t.todo:1==i.status?s=t.approve:-1==i.status&&(s=t.deny),this.data.appealStatusShow=s;var n=this.getIdentity(),o="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'><tr><td colspan='4' styles='formTableHead'>"+t.apealApplyForm+"</td></tr><tr><td styles='formTableTitle'>"+t.employeeName+"</td>    <td styles='formTableValue'>"+this.data.empName.split("@")[0]+"</td>    <td styles='formTableTitle' lable='recordDateString'></td>    <td styles='formTableValue' item='recordDateString'></td></tr><tr><td styles='formTableTitle' lable='onDutyTime'></td>    <td styles='formTableValue' item='onDutyTime'></td>"+("2"==this.data.signProxy||"3"==this.data.signProxy?"    <td styles='formTableTitle' lable='morningOffDutyTime'></td>    <td styles='formTableValue' item='morningOffDutyTime'></td></tr><tr><td styles='formTableTitle' lable='afternoonOnDutyTime'></td>    <td styles='formTableValue' item='afternoonOnDutyTime'></td>":"")+"    <td styles='formTableTitle' lable='offDutyTime'></td>    <td styles='formTableValue' item='offDutyTime'></td></tr>"+(this.isNew&&n.identities.length>1?"<tr><td styles='formTableTitle' lable='identity'></td>    <td styles='formTableValue' item='identity'  colspan='3'></td></tr>":"")+(this.isNew?"<tr><td styles='formTableTitle' lable='statusShow'></td>    <td styles='formTableValue' item='statusShow'></td>    <td styles='formTableTitle' lable='appealStatusShow'></td>    <td styles='formTableValue' item='appealStatusShow'></td></tr>":"<tr><td styles='formTableTitle' lable='appealStatusShow'></td>    <td styles='formTableValue' item='appealStatusShow'  colspan='3'></td></tr>")+"<tr><td styles='formTableTitle' lable='appealReason'></td>    <td styles='formTableValue' item='appealReason' colspan='3'></td></tr><tr contain='selfHolidayType'><td styles='formTableTitle' lable='selfHolidayType'></td>    <td styles='formTableValue' item='selfHolidayType' colspan='3'></td></tr><tr contain='address'><td styles='formTableTitle' lable='address'></td>    <td styles='formTableValue' item='address' colspan='3'></td></tr><tr contain='startTime'><td styles='formTableTitle' lable='startTime'></td>    <td styles='formTableValue' item='startTime' colspan='3'></td></tr><tr contain='endTime'><td styles='formTableTitle' lable='endTime'></td>    <td styles='formTableValue' item='endTime' colspan='3'></td></tr><tr contain='appealDescription'><td styles='formTableTitle' lable='appealDescription'></td>    <td styles='formTableValue' item='appealDescription' colspan='3'></td></tr></table>";this.createTableArea.set("html",o);var l=this.app.lp.schedule,r=this.data.signProxy||1;this.document=new MForm(this.createTableArea,this.data,{style:"popup",isEdited:this.isEdited||this.isNew,itemTemplate:{recordDateString:{text:t.recordDate,type:"innertext"},onDutyTime:{text:t.onDutyTime,type:"innertext"},morningOffDutyTime:{text:1==r?"":l.signProxy[r].middayRestStartTime,type:"innertext"},afternoonOnDutyTime:{text:1==r?"":l.signProxy[r].middayRestEndTime,type:"innertext"},offDutyTime:{text:t.offDutyTime,type:"innertext"},statusShow:{text:t.attendanceStatus,type:"innertext"},appealStatusShow:{text:t.appealStatus,type:"innertext"},appealReason:{notEmpty:!0,text:t.appealReason,type:"select",selectValue:t.appealReasonSelectText,event:{change:function(t){e.switchFieldByAppealReason(t.getValue())}}},identity:{notEmpty:!0,text:t.selectDepartment,type:"radio",defaultValue:function(){return n.identities[0]}.bind(this),selectText:n.units,selectValue:n.identities},address:{text:t.address},selfHolidayType:{text:t.leaveType,type:"select",selectValue:t.leaveTypeSelectText},startTime:{text:t.startTime,tType:"datetime"},endTime:{text:t.endTime,tType:"datetime"},appealDescription:{text:t.appealDescriptoin}}},this.app,this.css),this.document.load(),e.switchFieldByAppealReason(this.data.appealReason),this.cancelActionNode=new Element("div",{styles:this.css.createCancelActionNode,text:t.cancel}).inject(this.createFormNode),this.cancelActionNode.addEvent("click",function(t){this.cancelCreate(t)}.bind(this)),(this.isNew||this.isEdited)&&(this.createOkActionNode=new Element("div",{styles:this.css.createOkActionNode,text:t.ok}).inject(this.createFormNode),this.createOkActionNode.addEvent("click",function(t){this.okCreate(t)}.bind(this)))},switchFieldByAppealReason:function(t){var e=MWF.xApplication.Attendance.LP,i=[];t==e.temporaryLeave?i=["selfHolidayType","startTime","endTime"]:t==e.out?i=["address","startTime","endTime"]:t==e.businessTrip?i=["address","startTime","endTime","appealDescription"]:t==e.other&&(i=["appealDescription"]),["selfHolidayType","startTime","endTime","address","appealDescription"].each(function(t){this.createTableArea.getElement("[contain='"+t+"']").setStyle("display",i.contains(t)?"":"none"),(this.isNew||this.isEdited)&&(this.document.items[t].options.notEmpty=!!i.contains(t))}.bind(this))},getIdentity:function(){var t={identities:[],units:[]};return this.app.personActions.getPerson(function(e){e.data.woIdentityList.each(function(e){var i=e.woUnit;t.identities.push(e.distinguishedName),t.units.push(i.name)}.bind(this))}.bind(this),null,!1),t},getAuditor:function(){var t=MWF.xApplication.Attendance.LP,e={},i=[];if(this.app.restActions.listSetting(function(t){t.data.each(function(t){e[t.configCode]=t}.bind(this))}.bind(this),null,!1),e.APPEAL_AUDITOR_TYPE&&""!=e.APPEAL_AUDITOR_TYPE.configValue&&e.APPEAL_AUDITOR_VALUE&&""!=e.APPEAL_AUDITOR_VALUE.configValue){if(e.APPEAL_AUDITOR_TYPE.configValue==t.reportTo||"汇报对象"==e.APPEAL_AUDITOR_TYPE.configValue){var a={personList:[layout.desktop.session.user.distinguishedName]};this.app.orgActions.listPersonSupDirectValue(a,function(e){var a=e.data.personList;if(a&&a[0]){var s=a[0];"i"==s.split("@")[s.split("@").length-1].toLowerCase()?i.push(this.getPersonByIdentity(s)):i.push(s)}else this.app.notice(t.noReportToNotice,"error")}.bind(this),null,!1)}else if("所属部门职位"==e.APPEAL_AUDITOR_TYPE.configValue||e.APPEAL_AUDITOR_TYPE.configValue==t.unitDuty)this.app.personActions.getPerson(function(a){a.data.woIdentityList.each(function(a){var s=a.woUnit,n={name:e.APPEAL_AUDITOR_VALUE.configValue,unit:s.distinguishedName};this.app.orgActions.getDutyValue(n,function(a){var n=a.data?a.data.identityList:[];if("array"==typeOf(n)&&n[0])n.each(function(t){i=i.concat(this.getPersonByIdentity(t))}.bind(this));else{var o=t.noUnitDutyNotice.replace("{unit}",s.name).replace("{duty}",e.APPEAL_AUDITOR_VALUE.configValue);this.app.notice(o,"error")}}.bind(this),null,!1)}.bind(this))}.bind(this),null,!1);else if("人员属性"==e.APPEAL_AUDITOR_TYPE.configValue||e.APPEAL_AUDITOR_TYPE.configValue==t.personAttribute){if(this.app.personActions.getPerson(function(t){var a=e.APPEAL_AUDITOR_VALUE.configValue;t.data.woPersonAttributeList.each((function(t){if(t.name==a){var e=t.attributeList[0];e&&("i"==e.split("@")[e.split("@").length-1].toLowerCase()?i.push(this.getPersonByIdentity(e)):i.push(e))}}))}.bind(this),null,!1),0==i.length){var s=t.noPersonAttribute.replace("{att}",e.APPEAL_AUDITOR_VALUE.configValue);this.app.notice(s,"error")}}else if("指定人"==e.APPEAL_AUDITOR_TYPE.configValue||e.APPEAL_AUDITOR_TYPE.configValue==t.assignedPerson){var n=e.APPEAL_AUDITOR_TYPE.configValue;"i"==n.split("@")[n.split("@").length-1].toLowerCase()?i.push(this.getPersonByIdentity(n)):i.push(n)}}else this.app.personActions.getPerson(function(e){var a=t.directLeader;e.data.woPersonAttributeList.each((function(t){if(t.name==a){var e=t.attributeList[0];e&&("i"==e.split("@")[e.split("@").length-1].toLowerCase()?i.push(this.getPersonByIdentity(e)):i.push(e))}}))}.bind(this),null,!1),this.app.notice(t.noDirectLeader,"error");return i},getPersonByIdentity:function(t){var e={identityList:[t]},i=[];return this.app.orgActions.listPersonWithIdentityValue(e,function(t){i=t.data.personList}.bind(this),null,!1),i},setCreateNodeSize:function(){var t=this.app.node.getSize();this.app.content.getSize();this.createAreaNode.setStyles({width:t.x+"px",height:t.y+"px"});var e=(t.y-"580")/2;this.createNode.setStyles({height:"580px","margin-top":e+"px",width:"800px"}),this.createContainerNode.setStyles({height:"580px"});var i="580"-(this.createIconNode?this.createIconNode.getSize():{x:0,y:0}).y-20;this.createFormNode.setStyles({height:i+"px","margin-top":"20px"})},cancelCreate:function(t){this.createMarkNode.destroy(),this.createAreaNode.destroy()},okCreate:function(t){var e=this.document.getResult(!0,",",!0,!1,!0);if(e){var i=e.startTime,a=e.endTime;if(""!=i&&""!=a)if(new Date(i.replace(/-/g,"/"))>=new Date(a.replace(/-/g,"/")))return void this.app.notice(MWF.xApplication.Attendance.LP.holiday.beginGreateThanEndNotice,"error");this._ok(e)}},_ok:function(t){this.app.restActions.createAppeal(this.data.id,t,function(t){"ERROR"==t.type?this.app.notice(t.message,"error"):(this.createMarkNode.destroy(),this.createAreaNode.destroy(),this.explorer.view&&this.explorer.view.reload(),this.app.notice(MWF.xApplication.Attendance.LP.createAppealNotice,"success"))}.bind(this))},selectDateTime:function(t,e,i,a){var s={style:"xform",timeOnly:e,isTime:i,target:this.app.content};a&&(s.baseDate=a),MWF.require("MWF.widget.Calendar",function(){new MWF.widget.Calendar(t,s).show()}.bind(this))},getUnitByPerson:function(t){var e={personList:[layout.desktop.session.user.distinguishedName]};this.app.orgActions.listUnitWithPerson(function(e){e.data.length>0?t&&t(e.data):this.app.notice(MWF.xApplication.Attendance.LP.noDepartment,"error")}.bind(this),function(){this.app.notice(MWF.xApplication.Attendance.LP.noDepartment,"error")}.bind(this),e,!1)}});