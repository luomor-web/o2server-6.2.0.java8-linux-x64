MWF.xDesktop.requireApp("Template","MForm",null,!1),MWF.xApplication.Attendance.WeekendSetting=new Class({Extends:MWF.widget.Common,options:{style:"default"},initialize:function(e,t,i){this.setOptions(i),this.app=e,this.path="/x_component_Attendance/$WeekendSetting/",this.cssPath="/x_component_Attendance/$WeekendSetting/"+this.options.style+"/css.wcss",this._loadCss(),this.actions=t,this.load()},load:function(){this.app.restActions.listSetting(function(e){e.data&&e.data.length>0&&(this.data=e.data)}.bind(this),null,!1),this.data||(this.data=[])},decodeData:function(e){var t={};return this.dataJson={},e.each(function(e){t[e.configCode]=e.configValue,this.dataJson[e.configCode]=e}.bind(this)),t},encodeData:function(e,t){var i=[];for(var s in t)if(this.itemTemplate[s]){for(var a=!1,n=0;n<e.length;n++)e[n].configCode==s&&(a=!0,e[n].configValue=t[s],i.push(Object.clone(e[n])));a||i.push({configCode:s,configValue:t[s],configName:this.itemTemplate[s].text})}return i},open:function(e){this.isNew=!1,this.isEdited=!1,this._open()},create:function(){this.isNew=!0,this._open()},edit:function(){this.isEdited=!0,this._open()},_open:function(){this.createMarkNode=new Element("div",{styles:this.css.createMarkNode,events:{mouseover:function(e){e.stopPropagation()},mouseout:function(e){e.stopPropagation()}}}).inject(this.app.content,"after"),this.createAreaNode=new Element("div",{styles:this.css.createAreaNode}),this.createNode(),this.createAreaNode.inject(this.createMarkNode,"after"),this.createAreaNode.fade("in"),this.setCreateNodeSize(),this.setCreateNodeSizeFun=this.setCreateNodeSize.bind(this),this.addEvent("resize",this.setCreateNodeSizeFun)},createNode:function(){var e=MWF.xApplication.Attendance.LP;this.createNode=new Element("div",{styles:this.css.createNode}).inject(this.createAreaNode),this.createContainerNode=new Element("div",{styles:this.css.createContainerNode}).inject(this.createNode),this.setScrollBar(this.createContainerNode),this.createFormNode=new Element("div",{styles:this.css.createFormNode}).inject(this.createContainerNode),this.createTableContainer=new Element("div",{styles:this.css.createTableContainer}).inject(this.createFormNode),this.createTableArea=new Element("div",{styles:this.css.createTableArea}).inject(this.createTableContainer);new Element("table",{width:"100%",border:"0",cellpadding:"5",cellspacing:"0",styles:this.css.editTable,class:"editTable"}).inject(this.createTableArea);var t=this.decodeData(this.data),i="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'><tr><td colspan='4' styles='formTableHead'>"+e.weekendSetting+"</td></tr><tr><td styles='formTableTitle' lable='ATTENDANCE_WEEKEND'></td>    <td styles='formTableValue' item='ATTENDANCE_WEEKEND'></td></table>";i=i+"<span style='font-size:12px'>"+this.dataJson.ATTENDANCE_WEEKEND.description+"</span>",this.createTableArea.set("html",i),this.itemTemplate={ATTENDANCE_WEEKEND:{text:e.selectWeekend,type:"select",value:t.ATTENDANCE_WEEKEND,selectValue:this.dataJson.ATTENDANCE_WEEKEND.selectContent.split("|")}},this.document=new MForm(this.createTableArea,this.data,{style:"popup",isEdited:this.isEdited||this.isNew,itemTemplate:this.itemTemplate},this.app,this.css),this.document.load(),this.cancelActionNode=new Element("div",{styles:this.css.createCancelActionNode,text:e.cancel}).inject(this.createFormNode),this.cancelActionNode.addEvent("click",function(e){this.cancelCreate(e)}.bind(this)),(this.isNew||this.isEdited)&&(this.createOkActionNode=new Element("div",{styles:this.css.createOkActionNode,text:e.ok}).inject(this.createFormNode),this.createOkActionNode.addEvent("click",function(e){this.okCreate(e)}.bind(this)))},setCreateNodeSize:function(){var e=this.app.node.getSize();this.app.content.getSize();this.createAreaNode.setStyles({width:e.x+"px",height:e.y+"px"});var t=(e.y-"270")/2;this.createNode.setStyles({height:"270px","margin-top":t+"px",width:"600px"}),this.createContainerNode.setStyles({height:"270px"});var i="270"-(this.createIconNode?this.createIconNode.getSize():{x:0,y:0}).y-60;this.createFormNode.setStyles({height:i+"px","margin-top":"60px"})},cancelCreate:function(e){this.createMarkNode.destroy(),this.createAreaNode.destroy()},okCreate:function(e){var t=this.document.getResult(!0,",",!0,!1,!1);if(t){var i=this.encodeData(this.data,t);this.save(i)}},save:function(e){var t=!0;e.each(function(e){this.app.restActions.saveSetting(e,function(e){"ERROR"==e.type&&(this.app.notice(e.message,"error"),t=!1)}.bind(this),null,!1)}.bind(this)),t&&(this.createMarkNode.destroy(),this.createAreaNode.destroy(),this.app.notice(MWF.xApplication.Attendance.LP.saveSuccess,"success"))}});