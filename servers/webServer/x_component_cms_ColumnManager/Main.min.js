MWF.xDesktop.requireApp("cms.ColumnManager","package",null,!1),MWF.xDesktop.requireApp("Template","MDomItem",null,!1),MWF.xDesktop.requireApp("Selector","package",null,!1),MWF.require("MWF.xAction.org.express.RestActions",null,!1),MWF.require("MWF.widget.O2Identity",null,!1),MWF.xApplication.cms.ColumnManager.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{column:null,application:null,style:"default",name:"cms.ColumnManager",icon:"icon.png",width:"1100",height:"700",title:MWF.xApplication.cms.ColumnManager.LP.title,currentCategoryId:""},onQueryLoad:function(){this.options.column&&(this.options.column.icon=this.options.column.appIcon),this.options.application||(this.options.application=this.options.column),this.lp=MWF.xApplication.cms.ColumnManager.LP,this.currentContentNode=null},findDesigner:function(){this.options.column.moduleType="cms",this.options.column.name=this.options.column.appName;var t={filter:{moduleList:["cms"],appList:[this.options.column]}};layout.openApplication(null,"FindDesigner",t)},loadApplication:function(t){this.restActions=MWF.Actions.get("x_cms_assemble_control"),this.status&&!this.options.currentCategoryId&&this.status.categoryId&&(this.options.currentCategoryId=this.status.categoryId),this.getColumn(function(){this.setTitle(this.options.column.appName+this.lp.setting),this.loadController(function(){this.isAdmin?(this.createNode(),this.loadApplicationContent(),window.clipboardData?this.addKeyboardEvents():(this.keyCopyItemsFun=this.keyCopyItems.bind(this),this.keyPasteItemsFun=this.keyPasteItems.bind(this),document.addEventListener("copy",this.keyCopyItemsFun),document.addEventListener("paste",this.keyPasteItemsFun),this.addEvent("queryClose",function(){this.keyCopyItemsFun&&document.removeEventListener("copy",this.keyCopyItemsFun),this.keyPasteItemsFun&&document.removeEventListener("paste",this.keyPasteItemsFun)}.bind(this))),t&&t()):(this.notice(MWF.CMSCM.LP.noAdministratorAccess,"error"),this.close())}.bind(this))}.bind(this),function(){this.close()}.bind(this))},addKeyboardEvents:function(){this.addEvent("copy",function(){this.keyCopyItems()}.bind(this)),this.addEvent("paste",function(){this.keyPasteItems()}.bind(this))},keyCopyItems:function(t){layout.desktop.currentApp&&layout.desktop.currentApp.appId===this.appId&&(this.formConfigurator&&(this.formConfigurator.keyCopy(t),t&&t.preventDefault()),this.viewConfigurator&&(this.viewConfigurator.keyCopy(t),t&&t.preventDefault()),this.dataConfigurator&&(this.dataConfigurator.keyCopy(t),t&&t.preventDefault()),this.scriptConfigurator&&(this.scriptConfigurator.keyCopy(t),t&&t.preventDefault()))},keyPasteItems:function(t){layout.desktop.currentApp&&layout.desktop.currentApp.appId===this.appId&&(this.formConfigurator&&this.formConfigurator.keyPaste(t),this.viewConfigurator&&this.viewConfigurator.keyPaste(t),this.dataConfigurator&&this.dataConfigurator.keyPaste(t),this.scriptConfigurator&&this.scriptConfigurator.keyPaste(t))},loadController:function(t){this.restActions.isAppInfoManager(this.options.column.id,function(e){this.isAdmin=MWF.AC.isCMSManager()||e.data.value,t&&t(this.isAdmin)}.bind(this))},getColumn:function(t,e){if(this.options.column)t&&t();else{var i=this.options.columnId;i||(i=this.status&&this.status.column),i?this.restActions.getColumn(i,function(i){i.data?(this.options.column=i.data,this.options.application=i.data,t&&t()):e&&e()}.bind(this),function(){e&&e()}.bind(this),!1):e&&e()}},loadApplicationContent:function(){this.loadStartMenu(),this.loadApplicationLayout()},createNode:function(){this.content.setStyle("overflow","hidden"),this.node=new Element("div",{styles:{width:"100%",height:"100%",overflow:"hidden"}}).inject(this.content)},loadApplicationLayout:function(){},loadStartMenu:function(t){if(this.leftContentNode=new Element("div",{styles:this.css.leftContentNode}).inject(this.node),this.leftTitleNode=new Element("div",{styles:this.css.leftTitleNode}).inject(this.leftContentNode),this.leftTitleIconNode=new Element("div",{styles:this.css.leftTitleIconNode}).inject(this.leftTitleNode),this.options.column){var e=this.options.column.icon||this.options.column.appIcon;e?this.leftTitleIconNode.setStyle("background-image","url(data:image/png;base64,"+e+")"):this.leftTitleIconNode.setStyle("background-image","url(../x_component_cms_Column/$Main/default/icon/column.png)")}this.leftTitleTextNode=new Element("div",{styles:this.css.leftTitleTextNode,text:this.options.column.appName+this.lp.setting,title:this.options.column.appName+this.lp.setting}).inject(this.leftTitleNode),this.startMenuNode=new Element("div",{styles:this.css.normalStartMenuNode}).inject(this.leftContentNode),this.menu=new MWF.xApplication.cms.ColumnManager.Menu(this,this.startMenuNode,{onPostLoad:function(){this.status?null!=this.status.navi&&this.menu.itemObject[this.status.navi]?this.menu.doAction(this.menu.itemObject[this.status.navi]):this.menu.doAction(this.menu.itemObject.categoryConfig):this.menu.doAction(this.menu.startNavis[0])}.bind(this)})},clearContent:function(){this.categoryConfiguratorContent&&(this.categoryConfigurator&&(this.categoryConfigurator.isActive=!1),this.categoryConfiguratorContent.setStyle("display","none")),this.formConfiguratorContent&&(this.formConfigurator&&delete this.formConfigurator,this.formConfiguratorContent.destroy(),this.formConfiguratorContent=null),this.propertyConfiguratorContent&&(this.property&&delete this.property,this.propertyConfiguratorContent.destroy(),this.propertyConfiguratorContent=null),this.dataConfiguratorContent&&(this.dataConfigurator&&delete this.dataConfigurator,this.dataConfiguratorContent.destroy(),this.dataConfiguratorContent=null),this.scriptConfiguratorContent&&(this.scriptConfigurator&&delete this.scriptConfigurator,this.scriptConfiguratorContent.destroy(),this.scriptConfiguratorContent=null),this.viewConfiguratorContent&&(this.viewConfigurator&&delete this.viewConfigurator,this.viewConfiguratorContent.destroy(),this.viewConfiguratorContent=null),this.queryViewConfiguratorContent&&(this.queryViewConfigurator&&delete this.queryViewConfigurator,this.queryViewConfiguratorContent.destroy(),this.queryViewConfiguratorContent=null),this.fileConfiguratorContent&&(this.queryViewConfigurator&&delete this.fileConfiguratorContent,this.fileConfiguratorContent.destroy(),this.fileConfiguratorContent=null)},applicationProperty:function(){this.clearContent(),this.propertyConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.property=new MWF.xApplication.cms.ColumnManager.ApplicationProperty(this,this.propertyConfiguratorContent),this.property.load()},cagetoryConfig:function(t){this.clearContent(),this.categoryConfiguratorContent?(this.categoryConfiguratorContent.setStyle("display",""),this.menu.itemObject.categoryConfig&&this.menu.expend(this.menu.itemObject.categoryConfig),this.categoryConfigurator.isActive=!0,t||this.categoryConfigurator.refresh()):(this.categoryConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadCategoryConfig())},loadCategoryConfig:function(){MWF.xDesktop.requireApp("cms.ColumnManager","CategoryExplorer",function(){var t=this.menu.itemObject.categoryConfig.retrieve("subNode");this.categoryConfigurator=new MWF.xApplication.cms.ColumnManager.CategoryExplorer(this.categoryConfiguratorContent,t,this.restActions,{currentCategoryId:this.options.currentCategoryId,onPostLoadCategoryList:function(){}.bind(this),onPostClickSub:function(){this.menu.cancelCurrentNavi()}.bind(this)}),this.categoryConfigurator.isActive=!0,this.categoryConfigurator.app=this,this.categoryConfigurator.load(),this.options.currentCategoryId=""}.bind(this))},createCategory:function(){this.cagetoryConfig(!0),this.categoryConfigurator&&this.categoryConfigurator.categoryList.newCategory()},setCategory:function(t){this.cagetoryConfig(!0),this.categoryConfigurator&&this.categoryConfigurator.categoryList.setCurrentCategoryById(t)},formConfig:function(){this.clearContent(),this.formConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadFormConfig()},loadFormConfig:function(){MWF.xDesktop.requireApp("cms.ColumnManager","FormExplorer",function(){var t=MWF.xApplication.cms.ColumnManager.LP.formSetting;this.formConfigurator=new MWF.xApplication.cms.ColumnManager.FormExplorer(this.formConfiguratorContent,this.restActions,{title:t}),this.formConfigurator.app=this,this.formConfigurator.load()}.bind(this))},createForm:function(){this.formConfigurator?this.formConfigurator._createElement():MWF.xDesktop.requireApp("cms.ColumnManager","FormExplorer",function(){this.formConfigurator=new MWF.xApplication.cms.ColumnManager.FormExplorer(this.formConfiguratorContent,this.restActions),this.formConfigurator.app=this,this.formConfigurator._createElement()}.bind(this))},dataConfig:function(){this.clearContent(),this.dataConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadDataConfig()},loadDataConfig:function(){MWF.xDesktop.requireApp("cms.ColumnManager","DictionaryExplorer",function(){var t=MWF.xApplication.cms.ColumnManager.LP.dataSetting;this.dataConfigurator=new MWF.xApplication.cms.ColumnManager.DictionaryExplorer(this.dataConfiguratorContent,this.restActions,{title:t}),this.dataConfigurator.app=this,this.dataConfigurator.load()}.bind(this))},createDataConfig:function(){this.dataConfigurator?this.dataConfigurator._createElement():MWF.xDesktop.requireApp("cms.ColumnManager","DictionaryExplorer",function(){this.dataConfigurator=new MWF.xApplication.cms.ColumnManager.DictionaryExplorer(this.dataConfiguratorContent,this.restActions),this.dataConfigurator.app=this,this.dataConfigurator._createElement()}.bind(this))},scriptConfig:function(){this.clearContent(),this.scriptConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadScriptConfig()},loadScriptConfig:function(){MWF.xDesktop.requireApp("cms.ColumnManager","ScriptExplorer",function(){var t=MWF.xApplication.cms.ColumnManager.LP.scriptSetting;this.scriptConfigurator=new MWF.xApplication.cms.ColumnManager.ScriptExplorer(this.scriptConfiguratorContent,this.restActions,{title:t}),this.scriptConfigurator.app=this,this.scriptConfigurator.load()}.bind(this))},createScriptConfig:function(){this.scriptConfigurator?this.scriptConfigurator._createElement():MWF.xDesktop.requireApp("cms.ColumnManager","ScriptExplorer",function(){this.scriptConfigurator=new MWF.xApplication.cms.ColumnManager.ScriptExplorer(this.scriptConfiguratorContent,this.restActions),this.scriptConfigurator.app=this,this.scriptConfigurator._createElement()}.bind(this))},viewConfig:function(){this.clearContent(),this.viewConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadViewConfig()},loadViewConfig:function(){MWF.xDesktop.requireApp("cms.ColumnManager","ViewExplorer",function(){var t=MWF.xApplication.cms.ColumnManager.LP.listSetting;this.viewConfigurator=new MWF.xApplication.cms.ColumnManager.ViewExplorer(this.viewConfiguratorContent,this.restActions,{title:t}),this.viewConfigurator.app=this,this.viewConfigurator.load()}.bind(this))},createView:function(){this.viewConfigurator?this.viewConfigurator._createElement():MWF.xDesktop.requireApp("cms.ColumnManager","ViewExplorer",function(){this.viewConfigurator=new MWF.xApplication.cms.ColumnManager.ViewExplorer(this.viewConfiguratorContent,this.restActions),this.viewConfigurator.app=this,this.viewConfigurator._createElement()}.bind(this))},queryViewConfig:function(){this.clearContent(),this.queryViewConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadQueryViewConfig()},loadQueryViewConfig:function(){MWF.xDesktop.requireApp("cms.ColumnManager","QueryViewExplorer",function(){var t=MWF.xApplication.cms.ColumnManager.LP.queryViewSetting;this.queryViewConfigurator=new MWF.xApplication.cms.ColumnManager.QueryViewExplorer(this.queryViewConfiguratorContent,this.restActions,{title:t}),this.queryViewConfigurator.app=this,this.queryViewConfigurator.load()}.bind(this))},createQueryView:function(){this.queryViewConfigurator?this.queryViewConfigurator._createElement():MWF.xDesktop.requireApp("cms.ColumnManager","QueryViewExplorer",function(){this.queryViewConfigurator=new MWF.xApplication.cms.ColumnManager.QueryViewExplorer(this.queryViewConfiguratorContent,this.restActions),this.queryViewConfigurator.app=this,this.queryViewConfigurator._createElement()}.bind(this))},fileConfig:function(){this.clearContent(),this.fileConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.loadFileConfig()},loadFileConfig:function(){MWF.xDesktop.requireApp("cms.ColumnManager","FileExplorer",function(){var t=MWF.xApplication.cms.ColumnManager.LP.attachmentSetting;this.fileConfigurator=new MWF.xApplication.cms.ColumnManager.FileExplorer(this.fileConfiguratorContent,this.restActions,{title:t}),this.fileConfigurator.app=this,this.fileConfigurator.load()}.bind(this))},createFileConfig:function(){this.fileConfigurator?this.fileConfigurator._createElement():MWF.xDesktop.requireApp("cms.ColumnManager","QueryViewExplorer",function(){this.fileConfigurator=new MWF.xApplication.cms.ColumnManager.FileViewExplorer(this.fileConfiguratorContent,this.restActions),this.fileConfigurator.app=this,this.fileConfigurator._createElement()}.bind(this))},getCategoryCount:function(){if(this.categoryConfigurator){var t=this.categoryConfigurator.categoryNode.getSize();return categoryCount=parseInt(t.x/401)*parseInt(t.y/101)+10,categoryCount}return 20},showContentNode:function(t){this.currentContentNode&&(this.currentContentNode.fade("hide"),t.fade("show"),t.setStyle("display","node"),this.currentContentNode=null),t.setStyle("display","block"),t.fade("show"),this.currentContentNode=t},recordStatus:function(){var t=null,e="";this.menu.currentNavi&&(t=this.menu.currentNavi.retrieve("naviData").id);if("categoryConfig"==t&&this.categoryConfigurator&&this.categoryConfigurator.categoryList){var i=this.categoryConfigurator.categoryList;i.currentCategory&&i.currentCategory.data&&(e=i.currentCategory.data.id)}return{navi:t,column:this.options.column.id,categoryId:e}}}),MWF.xApplication.cms.ColumnManager.Menu=new Class({Implements:[Options,Events],initialize:function(t,e,i){this.setOptions(i),this.app=t,this.node=$(e),this.currentNavi=null,this.status="start",this.startNavis=[],this.itemObject={},this.load()},load:function(){this.areaNode=new Element("div.startMenuAreaNode",this.app.css.startMenuAreaNode).inject(this.node),MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.node,{style:"xApp_ProcessManager_StartMenu",distance:100,friction:4,axis:{x:!1,y:!0}})}.bind(this));var t=this.app.path+"startMenu.json";MWF.getJSON(t,function(t){t.each(function(t){var e=new Element("div",{styles:this.app.css.startMenuNaviNode});if(e.store("naviData",t),t.expand){var i=new Element("div",{styles:this.app.css.startMenuExpandNode});i.inject(e),e.store("expandNode",i)}else new Element("div",{styles:this.app.css.startMenuEmptyNode}).inject(e);var n=new Element("div",{styles:this.app.css.startMenuIconNode}).inject(e);if(n.setStyle("background-image","url("+this.app.path+this.app.options.style+"/icon/"+t.icon+")"),e.store("iconNode",n),new Element("div",{styles:this.app.css.startMenuTextNode,text:t.title}).inject(e),t.create){var o=new Element("div",{styles:this.app.css.startMenuCreateNode,title:MWF.xApplication.cms.ColumnManager.LP.new+t.title});o.inject(e),e.store("createNode",o),o.addEvents({click:function(t){this.obj.app[this.navi.createAction](),t.stopPropagation()}.bind({obj:this,navi:t}),mouseover:function(t){this.obj.currentNavi!=this.naviNode||this.naviData.unselected?this.createNode.setStyles(this.obj.app.css.startMenuCreateNode_over):this.createNode.setStyles(this.obj.app.css.startMenuCreateNode_current_over)}.bind({obj:this,createNode:o,naviNode:e,naviData:t}),mouseout:function(t){this.obj.currentNavi!=this.naviNode||this.naviData.unselected?this.createNode.setStyles(this.obj.app.css.startMenuCreateNode):this.createNode.setStyles(this.obj.app.css.startMenuCreateNode_current)}.bind({obj:this,createNode:o,naviNode:e,naviData:t})})}if(e.inject(this.areaNode),t.expand){var s=new Element("div",{styles:this.app.css.startMenuSubContentNode});s.inject(this.areaNode),e.store("subNode",s)}this.startNavis.push(e),this.itemObject[t.id]=e,this.setStartNaviEvent(e,t)}.bind(this)),this.setContentSize(),this.app.addEvent("resize",this.setContentSize.bind(this)),this.fireEvent("postLoad")}.bind(this))},setStartNaviEvent:function(t){var e=this;t.addEvents({mouseover:function(){e.currentNavi!=this&&this.setStyles(e.app.css.startMenuNaviNode_over)},mouseout:function(){e.currentNavi!=this&&this.setStyles(e.app.css.startMenuNaviNode)},mousedown:function(){e.currentNavi!=this&&this.setStyles(e.app.css.startMenuNaviNode_down)},mouseup:function(){e.currentNavi!=this&&this.setStyles(e.app.css.startMenuNaviNode_over)},click:function(){e.doAction.apply(e,[this])}})},expend:function(t){t.retrieve("isExpand")||(t.retrieve("expandNode").setStyles(this.app.css.startMenuCollapseNode),t.retrieve("subNode").setStyle("display",""),t.store("isExpand",!0))},collapse:function(t){t.retrieve("isExpand")&&(t.retrieve("expandNode").setStyles(this.app.css.startMenuExpandNode),t.retrieve("subNode").setStyle("display","none"),t.store("isExpand",!1))},cancelCurrentNavi:function(){if(this.currentNavi){this.currentNavi.setStyles(this.app.css.startMenuNaviNode);var t=this.currentNavi.retrieve("iconNode"),e=this.currentNavi.retrieve("naviData");t.setStyle("background-image","url("+this.app.path+this.app.options.style+"/icon/"+e.icon+")")}},doAction:function(t){if(this.currentNavi&&this.currentNavi==t){(n=this.currentNavi.retrieve("naviData")).expand&&(this.currentNavi.retrieve("isExpand")?(this.currentNavi.retrieve("expandNode").setStyles(this.app.css.startMenuExpandNode),this.currentNavi.retrieve("subNode").setStyle("display","none"),this.currentNavi.store("isExpand",!1)):(this.currentNavi.retrieve("expandNode").setStyles(this.app.css.startMenuCollapseNode),this.currentNavi.retrieve("subNode").setStyle("display",""),this.currentNavi.store("isExpand",!0)))}else{var e=t?t.retrieve("naviData"):null;if(this.currentNavi&&(!e||!e.noSelect)){this.currentNavi.setStyles(this.app.css.startMenuNaviNode);var i=this.currentNavi.retrieve("iconNode"),n=this.currentNavi.retrieve("naviData");if(i.setStyle("background-image","url("+this.app.path+this.app.options.style+"/icon/"+n.icon+")"),n.expand)this.currentNavi.retrieve("expandNode").setStyles(this.app.css.startMenuExpandNode),this.currentNavi.retrieve("subNode").setStyle("display","none"),this.currentNavi.store("isExpand",!1);if(n.create)(s=this.currentNavi.retrieve("createNode")).setStyles(this.app.css.startMenuCreateNode)}if(t){var o=(n=e).action;if(!n.unselected&&!n.noSelect)t.setStyles(this.app.css.startMenuNaviNode_current),(i=t.retrieve("iconNode")).setStyle("background-image","url("+this.app.path+this.app.options.style+"/icon/"+n.selectedIcon+")");if(n.expand){if(n.unselected)t.retrieve("expandNode").setStyles(this.app.css.startMenuCollapseNode);else t.retrieve("expandNode").setStyles(this.app.css.startMenuCollapseNode_current);t.retrieve("subNode").setStyle("display",""),t.store("isExpand",!0)}if(n.create){var s=t.retrieve("createNode");n.unselected?s.setStyles(this.app.css.startMenuCreateNode):s.setStyles(this.app.css.startMenuCreateNode_current)}this.app[o]&&this.app[o].apply(this.app)}n&&n.noSelect||(this.currentNavi=t)}},setContentSize:function(){var t=this.app.content.getSize();this.node.setStyle("height",t.y-82)}}),MWF.xApplication.cms.ColumnManager.ApplicationProperty=new Class({initialize:function(t,e){this.app=t,this.node=$(e),this.data=this.app.options.application,"string"===typeOf(this.data.config)?this.config=JSON.parse(this.data.config||{}):this.config=Object.clone(this.data.config||{}),this.controllerData=[],this.controllerList=[]},load:function(){this.propertyTitleBar=new Element("div.propertyTitleBar",{styles:this.app.css.propertyTitleBar,text:MWF.xApplication.cms.ColumnManager.LP.appProperty}).inject(this.node),this.contentNode=new Element("div.propertyContentNode",{styles:this.app.css.propertyContentNode}).inject(this.node),this.contentAreaNode=new Element("div.propertyContentAreaNode",{styles:this.app.css.propertyContentAreaNode}).inject(this.contentNode),this.setContentHeight(),this.setContentHeightFun=this.setContentHeight.bind(this),this.app.addEvent("resize",this.setContentHeightFun),MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.contentNode,{indent:!1})}.bind(this)),this.baseActionAreaNode=new Element("div.baseActionAreaNode",{styles:this.app.css.baseActionAreaNode}).inject(this.contentAreaNode),this.baseActionNode=new Element("div.propertyInforActionNode",{styles:this.app.css.propertyInforActionNode}).inject(this.baseActionAreaNode),this.baseTextNode=new Element("div.baseTextNode",{styles:this.app.css.baseTextNode,text:this.app.lp.application.property}).inject(this.baseActionAreaNode),this.createEditBaseNode(),this.createPropertyContentNode(),this.createIconContentNode(),this.viewerContainer=new Element("div").inject(this.contentAreaNode),MWF.xDesktop.requireApp("cms.ColumnManager","widget.ColumnViewerSetting",null,!1),this.viewerSetting=new MWF.xApplication.cms.ColumnManager.ColumnViewerSetting(this.app,this.app.lp.application.viewerSetting,this.viewerContainer,{objectId:this.data.id}),this.viewerSetting.dataParent=this,this.viewerSetting.load(),this.publisherContainer=new Element("div").inject(this.contentAreaNode),MWF.xDesktop.requireApp("cms.ColumnManager","widget.ColumnPublisherSetting",null,!1),this.publisherSetting=new MWF.xApplication.cms.ColumnManager.ColumnPublisherSetting(this.app,this.app.lp.application.publisherSetting,this.publisherContainer,{objectId:this.data.id}),this.publisherSetting.dataParent=this,this.publisherSetting.load(),this.managerContainer=new Element("div").inject(this.contentAreaNode),MWF.xDesktop.requireApp("cms.ColumnManager","widget.ColumnManagerSetting",null,!1),this.viewerSetting=new MWF.xApplication.cms.ColumnManager.ColumnManagerSetting(this.app,this.app.lp.application.managerSetting,this.managerContainer,{objectId:this.data.id}),this.viewerSetting.dataParent=this,this.viewerSetting.load()},setContentHeight:function(){var t=this.app.content.getSize(),e=this.propertyTitleBar.getSize(),i=t.y-e.y;this.contentNode.setStyle("height",i+"px")},createIconContentNode:function(){this.iconContentTitleNode=new Element("div.iconContentTitleNode",{styles:this.app.css.iconContentTitleNode,text:this.app.lp.application.icon}).inject(this.contentAreaNode),this.iconContentNode=new Element("div",{styles:{overflow:"hidden"}}).inject(this.contentAreaNode);this.iconContentNode.set("html","<table cellspacing='0' cellpadding='0' border='0' width='95%' align='center' style='margin-top: 20px'><tr><td class='formTitle'><div id='formIconPreview'></div></td><td id='formChangeIconAction'></td></tr></table>"),this.iconContentNode.getElements("td.formTitle").setStyles(this.app.css.propertyBaseContentTdTitle),this.iconPreviewNode=this.iconContentNode.getElement("div#formIconPreview"),this.iconActionNode=this.iconContentNode.getElement("td#formChangeIconAction"),this.iconPreviewNode.setStyles({height:"72px",width:"72px",float:"right"});var t=this.data.icon||this.data.appIcon;t?this.iconPreviewNode.setStyle("background","url(data:image/png;base64,"+t+") center center no-repeat"):this.iconPreviewNode.setStyle("background","url(../x_component_cms_Column/$Main/default/icon/column.png) center center no-repeat"),new Element("div",{styles:this.app.css.selectButtonStyle,text:MWF.xApplication.cms.ColumnManager.LP.changeIcon}).inject(this.iconActionNode).addEvent("click",function(){this.changeIcon()}.bind(this))},changeIcon:function(){if(!this.uploadFileAreaNode){this.uploadFileAreaNode=new Element("div");this.uploadFileAreaNode.set("html",'<input name="file" type="file"/>'),this.fileUploadNode=this.uploadFileAreaNode.getFirst(),this.fileUploadNode.addEvent("change",function(){var e=t.files;if(e.length)for(var i=0;i<e.length;i++){var n=e.item(i),o=new FormData;o.append("file",n),this.app.restActions.updataColumnIcon(this.data.id,function(){this.app.restActions.getColumn(this.data.id,function(t){t.data&&(this.data=t.data,this.data.appIcon?this.iconPreviewNode.setStyle("background","url(data:image/png;base64,"+this.data.appIcon+") center center no-repeat"):this.iconPreviewNode.setStyle("background","url(../x_component_cms_Column/$Main/default/icon/category2.png) center center no-repeat"))}.bind(this),!1)}.bind(this),null,o,n)}}.bind(this))}var t=this.uploadFileAreaNode.getFirst();t.click()},createPropertyContentNode:function(){var t=MWF.xApplication.cms.ColumnManager.LP;this.propertyContentNode=new Element("div",{styles:{overflow:"hidden"}}).inject(this.contentAreaNode);var e="<table cellspacing='0' cellpadding='0' border='0' width='95%' align='center' style='margin-top: 20px'>";e+="<tr><td class='formTitle'>"+this.app.lp.application.id+"</td><td id='formApplicationId' class='formValue'>"+this.data.id+"</td></tr>",e+="<tr><td class='formTitle'>"+this.app.lp.application.name+"</td><td id='formApplicationName'></td></tr>",e+="<tr><td class='formTitle'>"+this.app.lp.application.sign+"</td><td id='formApplicationAlias'></td></tr>",e+="<tr><td class='formTitle'>"+this.app.lp.application.appType+"</td><td id='formApplicationAppType'></td></tr>",e+="<tr><td class='formTitle'>"+this.app.lp.application.documentType+"</td><td id='formApplicationType' class='formValue'>"+(this.data.documentType||t.documentTypeSelectText[0])+"</td></tr>",e+="<tr><td class='formTitle'>"+this.app.lp.application.description+"</td><td id='formApplicationDescription'></td></tr>",e+="<tr><td class='formTitle'>"+this.app.lp.application.sort+"</td><td id='formApplicationSort'></td></tr>";var i="boolean"===typeOf(this.config.ignoreTitle)&&this.config.ignoreTitle;e+="<tr><td class='formTitle'>"+this.app.lp.application.ignoreTitle+"</td><td id='formApplicationIgnoreTitle' class='formValue'>"+(i?t.ignoreTitleSelectText[0]:t.ignoreTitleSelectText[1])+"</td></tr>";i="boolean"!==typeOf(this.config.latest)||this.config.latest;e+="<tr><td class='formTitle'>"+this.app.lp.application.latest+"</td><td id='formApplicationLatest' class='formValue'>"+(i?t.checkDraftSelectText[0]:t.checkDraftSelectText[1])+"</td></tr>";i="boolean"!==typeOf(this.data.showAllDocuments)||this.data.showAllDocuments;e+="<tr><td class='formTitle'>"+this.app.lp.application.showAllDocumentViews+"</td><td id='showAllDocumentViews' class='formValue'>"+(i?t.showAllDocumentSelectText[0]:t.showAllDocumentSelectText[1])+"</td></tr>",e+="</table>",this.propertyContentNode.set("html",e),this.propertyContentNode.getElements("td.formTitle").setStyles(this.app.css.propertyBaseContentTdTitle),this.propertyContentNode.getElements("td.formValue").setStyles(this.app.css.propertyBaseContentTdValue),this.nameInput=new MWF.xApplication.cms.ColumnManager.Input(this.propertyContentNode.getElement("#formApplicationName"),this.data.name||this.data.appName,this.app.css.formInput),this.aliasInput=new MWF.xApplication.cms.ColumnManager.Input(this.propertyContentNode.getElement("#formApplicationAlias"),this.data.alias||this.data.appAlias,this.app.css.formInput),this.appTypeInput=new MWF.xApplication.cms.ColumnManager.Input(this.propertyContentNode.getElement("#formApplicationAppType"),this.data.appType||"",this.app.css.formInput),this.typeSelect=new MDomItem(this.propertyContentNode.getElement("#formApplicationType"),{type:"select",value:this.data.documentType||t.documentTypeSelectValue[0],selectValue:t.documentTypeSelectValue,selectText:t.documentTypeSelectText}),this.descriptionInput=new MWF.xApplication.cms.ColumnManager.Input(this.propertyContentNode.getElement("#formApplicationDescription"),this.data.description,this.app.css.formInput),this.sortInput=new MWF.xApplication.cms.ColumnManager.Input(this.propertyContentNode.getElement("#formApplicationSort"),this.data.appInfoSeq,this.app.css.formInput),this.ignoreTitleSelect=new MDomItem(this.propertyContentNode.getElement("#formApplicationIgnoreTitle"),{type:"select",defaultValue:"false",value:("boolean"===typeOf(this.config.ignoreTitle)&&this.config.ignoreTitle).toString(),selectValue:["true","false"],selectText:t.ignoreTitleSelectText}),this.latestSelect=new MDomItem(this.propertyContentNode.getElement("#formApplicationLatest"),{type:"select",defaultValue:"true",value:("boolean"!==typeOf(this.config.latest)||this.config.latest).toString(),selectValue:["true","false"],selectText:t.checkDraftSelectText}),this.allDocumentViewSelect=new MDomItem(this.propertyContentNode.getElement("#showAllDocumentViews"),{type:"select",defaultValue:"true",value:("boolean"!==typeOf(this.data.showAllDocuments)||this.data.showAllDocuments).toString(),selectValue:["true","false"],selectText:t.showAllDocumentSelectText})},createEditBaseNode:function(){this.editBaseNode=new Element("button.editBaseNode",{styles:this.app.css.editBaseNode,text:this.app.lp.edit,events:{click:this.editBaseInfor.bind(this)}}).inject(this.baseActionNode)},createCancelBaseNode:function(){this.cancelBaseNode=new Element("button.cancelBaseNode",{styles:this.app.css.cancelBaseNode,text:this.app.lp.cancel,events:{click:this.cancelBaseInfor.bind(this)}}).inject(this.baseActionNode)},createSaveBaseNode:function(){this.saveBaseNode=new Element("button.saveBaseNode",{styles:this.app.css.saveBaseNode,text:this.app.lp.save,events:{click:this.saveBaseInfor.bind(this)}}).inject(this.baseActionNode)},editBaseInfor:function(){this.baseActionNode.empty(),this.editBaseNode=null,this.createCancelBaseNode(),this.createSaveBaseNode(),this.editMode()},editMode:function(){this.nameInput.editMode(),this.aliasInput.editMode(),this.appTypeInput.editMode(),this.descriptionInput.editMode(),this.sortInput.editMode(),this.typeSelect.editMode(),this.latestSelect.editMode(),this.ignoreTitleSelect.editMode(),this.allDocumentViewSelect.editMode(),this.isEdit=!0},readMode:function(){this.nameInput.readMode(),this.aliasInput.readMode(),this.appTypeInput.readMode(),this.descriptionInput.readMode(),this.sortInput.readMode(),this.typeSelect.readMode(),this.latestSelect.readMode(),this.ignoreTitleSelect.readMode(),this.allDocumentViewSelect.readMode(),this.isEdit=!1},cancelBaseInfor:function(){this.data.name||this.data.appName||this.data.id?(this.baseActionNode.empty(),this.cancelBaseNode=null,this.saveBaseNode=null,this.createEditBaseNode(),this.readMode()):this.destroy()},saveBaseInfor:function(){if(!this.nameInput.input.get("value"))return this.app.notice(this.app.lp.application.inputApplicationName,"error",this.node),!1;this.save(function(){this.baseActionNode.empty(),this.cancelBaseNode=null,this.saveBaseNode=null,this.createEditBaseNode(),this.readMode()}.bind(this),function(t,e,i){var n=i;t&&(n=t.responseText),this.app.notice("request json error: "+n,"error")}.bind(this))},save:function(t,e){this.data.name=this.nameInput.input.get("value"),this.data.appName=this.data.name,this.data.alias=this.aliasInput.input.get("value"),this.data.appAlias=this.data.alias,this.data.appType=this.appTypeInput.input.get("value"),this.data.description=this.descriptionInput.input.get("value"),this.data.appInfoSeq=this.sortInput.input.get("value"),this.data.documentType=this.typeSelect.getValue(),this.data.showAllDocuments="false"!==this.allDocumentViewSelect.getValue(),this.config.ignoreTitle="false"!==this.ignoreTitleSelect.getValue(),this.config.latest="false"!==this.latestSelect.getValue(),this.data.config=JSON.stringify(this.config),this.app.restActions.saveColumn(this.data,function(e){this.propertyTitleBar.set("text",this.data.name),this.data.id=e.data.id,this.nameInput.save(),this.aliasInput.save(),this.appTypeInput.save(),this.descriptionInput.save(),this.sortInput.save(),this.typeSelect.save(),this.latestSelect.save(),this.ignoreTitleSelect.save(),this.allDocumentViewSelect.save(),this.app.notice(this.app.lp.application.saveSuccess,"success"),t&&t()}.bind(this),function(t,i,n){e&&e(t,i,n)}.bind(this))}}),MWF.xApplication.cms.ColumnManager.Input=new Class({Implements:[Events],initialize:function(t,e,i){this.node=$(t),this.value=e||"",this.style=i,this.load()},load:function(){this.content=new Element("div",{styles:this.style.content,text:this.value}).inject(this.node)},editMode:function(){this.content.empty(),this.input=new Element("input",{styles:this.style.input,value:this.value}).inject(this.content),this.input.addEvents({focus:function(){this.input.setStyles(this.style.input_focus)}.bind(this),blur:function(){this.input.setStyles(this.style.input)}.bind(this)})},readMode:function(){this.content.empty(),this.input=null,this.content.set("text",this.value)},save:function(){return this.input&&(this.value=this.input.get("value")),this.value}});