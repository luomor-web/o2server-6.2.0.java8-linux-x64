MWF.xApplication.cms.ColumnManager=MWF.xApplication.cms.ColumnManager||{},MWF.xApplication.cms.ColumnManager.PermissionSetting=new Class({Implements:[Options],options:{objectId:"",objectType:"APPINFO",permission:"VIEW"},initialize:function(t,i,e,s){this.app=t,this.node=$(e),this.lp=i,this.setOptions(s),this.data=[],this.personList=[],this.unitList=[]},load:function(){this.listData(function(t){t.data=t.data||[],this.data=t.data,t.data.each(function(t){"USER"==t.usedObjectType?this.personList.push(t.usedObjectName):"UNIT"==t.usedObjectType&&this.unitList.push(t.usedObjectName)}.bind(this)),this.createNode()}.bind(this))},createNode:function(){this.titleNode=new Element("div.availableTitleNode",{styles:this.app.css.availableTitleNode,text:this.lp.title}).inject(this.node),this.contentNode=new Element("div",{styles:{overflow:"hidden"}}).inject(this.node),this.itemsContentNode=new Element("div.availableItemsContentNode",{styles:this.app.css.availableItemsContentNode}).inject(this.contentNode),this.actionAreaNode=new Element("div",{styles:{overflow:"hidden"}}).inject(this.node),new Element("div.selectButtonStyle",{styles:this.app.css.selectButtonStyle,text:this.lp.setPerson}).inject(this.actionAreaNode).addEvent("click",function(){this.changeIdentitys()}.bind(this)),new Element("div.selectButtonStyle",{styles:this.app.css.selectButtonStyle,text:this.lp.setUnit}).inject(this.actionAreaNode).addEvent("click",function(){this.changeUnit()}.bind(this)),this.setItems()},setItems:function(){this.personList&&this.personList.each(function(t){t&&new MWF.widget.O2Person({name:t},this.itemsContentNode,{style:"application"})}.bind(this)),this.unitList&&this.unitList.each(function(t){t&&new MWF.widget.O2Unit({name:t},this.itemsContentNode,{style:"application"})}.bind(this))},changeIdentitys:function(){var t={type:"person",title:this.lp.setPerson,values:this.personList||[],onComplete:function(t){var i=[];t.each(function(t){i.push(t.data.distinguishedName)}.bind(this)),i.each(function(t){if(!this.personList.contains(t)){var i={objectType:this.options.objectType,objectId:this.options.objectId,usedObjectType:"USER",usedObjectCode:t,usedObjectName:t,permission:this.options.permission};this.saveData(i,function(t){i.id=t.data.id,this.data.push(i)}.bind(this),null,!1)}}.bind(this)),this.personList.each(function(t){if(!i.contains(t)){var e=null,s="";this.data.each(function(i){i.usedObjectName==t&&(e=i,s=i.id)}.bind(this)),this.removeData(s,function(t){this.data.erase(e)}.bind(this))}}.bind(this)),this.personList=i,this.itemsContentNode.empty(),this.setItems(),this.app.notice(this.lp.setIdentitySuccess,"success")}.bind(this)};new MWF.O2Selector(this.app.content,t)},changeUnit:function(){var t={type:"unit",title:this.lp.setUnit,values:this.unitList||[],onComplete:function(t){var i=[];t.each(function(t){i.push(t.data.distinguishedName)}.bind(this)),i.each(function(t){if(!this.unitList.contains(t)){var i={objectType:this.options.objectType,objectId:this.options.objectId,usedObjectType:"UNIT",usedObjectCode:t,usedObjectName:t,permission:this.options.permission};this.saveData(i,function(t){i.id=t.data.id,this.data.push(i)}.bind(this))}}.bind(this)),this.unitList.each(function(t){if(!i.contains(t)){var e=null,s="";this.data.each(function(i){i.usedObjectName==t&&(e=i,s=i.id)}.bind(this)),this.removeData(s,function(t){this.data.erase(e)}.bind(this))}}.bind(this)),this.unitList=i,this.itemsContentNode.empty(),this.setItems(),this.app.notice(this.lp.setUnitSuccess,"success")}.bind(this)};new MWF.O2Selector(this.app.content,t)},listData:function(t){this.app.restActions.listColumnPermission(this.options.objectId,function(i){t&&t(i)}.bind(this),null,!1)},removeData:function(t,i){this.app.restActions.removePermission(t,function(t){i&&i(t)}.bind(this),null,!1)},saveData:function(t,i){this.app.restActions.savePermission(t,function(t){i&&i(t)}.bind(this),null,!1)}});