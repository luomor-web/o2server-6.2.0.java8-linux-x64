MWF.xApplication.query=MWF.xApplication.query||{},MWF.xApplication.query.ViewDesigner=MWF.xApplication.query.ViewDesigner||{},MWF.xApplication.query.ViewDesigner.widget=MWF.xApplication.query.ViewDesigner.widget||{},MWF.xApplication.query.ViewDesigner.widget.ViewFilter=new Class({Implements:[Options,Events],Extends:MWF.widget.Common,options:{style:"default",type:"identity",names:[]},initialize:function(t,e,i,a){this.setOptions(a),this.node=$(t),this.app=e,this.filtrData=i,this.path="../x_component_query_ViewDesigner/widget/$ViewFilter/",this.cssPath="../x_component_query_ViewDesigner/widget/$ViewFilter/"+this.options.style+"/css.wcss",this._loadCss(),this.items=[],this.load()},load:function(t){this.getInputNodes(),this.createActionNode(),this.loadData()},loadData:function(){this.filtrData.filtrData&&this.filtrData.filtrData.length&&this.filtrData.filtrData.each(function(t){this.items.push(new MWF.xApplication.query.ViewDesigner.widget.ViewFilter.Item(this,t))}.bind(this)),this.filtrData.customData&&this.filtrData.customData.length&&this.filtrData.customData.each(function(t){t.type="custom",this.items.push(new MWF.xApplication.query.ViewDesigner.widget.ViewFilter.ItemCustom(this,t))}.bind(this))},createScriptArea:function(t){this.scriptValueArea=t;var e=t.get("title");MWF.require("MWF.widget.ScriptArea",function(){this.scriptArea=new MWF.widget.ScriptArea(t,{title:e,maxObj:this.app.formContentNode||this.app.pageContentNode,onChange:function(){this.scriptData=this.scriptArea.toJson()}.bind(this),onSave:function(){}.bind(this),style:"formula"});var i=this.scriptData?this.scriptData.code:"";this.scriptArea.load(i)}.bind(this))},createCustomFilterValueScriptArea:function(t){var e=t.get("title");MWF.require("MWF.widget.ScriptArea",function(){this.customFilterValueScriptArea=new MWF.widget.ScriptArea(t,{title:e,isload:!0,isbind:!1,forceType:"ace",maxObj:this.app.formContentNode||this.app.pageContentNode,onChange:function(){this.customFilterValueScriptData=this.customFilterValueScriptArea.toJson()}.bind(this),onSave:function(){}.bind(this),style:"formula"});var i=this.customFilterValueScriptData?this.customFilterValueScriptData.code:"";this.customFilterValueScriptArea.load(i)}.bind(this))},getInputNodes:function(){this.inputAreaNode=this.node.getElement(".inputAreaNode_vf"),this.actionAreaNode=this.node.getElement(".actionAreaNode_vf"),this.actionAreaNode.setStyles(this.css.actionAreaNode),this.listAreaNode=this.node.getElement(".listAreaNode_vf"),this.fieldListAreaNode=this.node.getElement(".fieldListAreaNode_vf"),this.restrictViewFilterTable=this.node.getElement(".restrictViewFilterTable_vf");var t=this.node.getElement(".MWFFilterFormulaArea");if(t&&this.createScriptArea(t),this.multiValueNoticeNode=this.inputAreaNode.getElement(".multiValueNotice_vf"),this.titleInput=this.inputAreaNode.getElement(".titleInput_vf"),this.pathInput=this.inputAreaNode.getElement(".pathInput_vf"),this.datatypeInput=this.inputAreaNode.getElement(".datatypeInput_vf"),this.restrictFilterInput=this.inputAreaNode.getElement(".restrictFilterInput_vf"),this.customFilterInput=this.inputAreaNode.getElement(".customFilterInput_vf"),this.logicInput=this.inputAreaNode.getElement(".logicInput_vf"),this.comparisonInput=this.inputAreaNode.getElement(".comparisonInput_vf"),this.comparisonInput.addEvent("change",function(){this.switchInputDisplay()}.bind(this)),this.valueTextInput=this.inputAreaNode.getElement(".valueTextInput_vf"),this.valueNumberInput=this.inputAreaNode.getElement(".valueNumberInput_vf"),this.valueDatetimeInput=this.inputAreaNode.getElement(".valueDatetimeInput_vf"),this.valueBooleanInput=this.inputAreaNode.getElement(".valueBooleanInput_vf"),this.valueDateInput=this.inputAreaNode.getElement(".valueDateInput_vf"),this.valueTimeInput=this.inputAreaNode.getElement(".valueTimeInput_vf"),this.app.view){var e=this.app.view.data.id;this.customFilterValueTypes=this.inputAreaNode.getElements("[name='"+e+"viewCustomFilterValueType']"),this.customFilterValueScriptDiv=this.inputAreaNode.getElement("#"+e+"viewCustomFilterValueScriptDiv"),this.customFilterValueScript=this.inputAreaNode.getElement("[name='"+e+"viewCustomFilterValueScript']"),this.customFilterValueScript&&this.createCustomFilterValueScriptArea(this.customFilterValueScript)}if(MWF.require("MWF.widget.Calendar",function(){this.calendar=new MWF.widget.Calendar(this.valueDatetimeInput,{style:"xform",isTime:!0,secondEnable:!0,target:this.app.content,format:"db",onComplate:function(){this.node.getElement("#"+i+"viewFilterDateFormulaSelector").getElements("input").set("checked",!1)}.bind(this)}),new MWF.widget.Calendar(this.valueDateInput,{style:"xform",isTime:!1,target:this.app.content,format:"%Y-%m-%d"}),new MWF.widget.Calendar(this.valueTimeInput,{style:"xform",timeOnly:!0,secondEnable:!0,target:this.app.content,format:"%H:%M:%S"})}.bind(this)),this.datatypeInput.addEvent("change",function(){this.switchInputDisplay()}.bind(this)),this.valueTextInput.addEvent("keydown",function(t){13==t.code&&this.modifyOrAddFilterItem()}.bind(this)),this.valueNumberInput.addEvent("keydown",function(t){13==t.code&&this.modifyOrAddFilterItem()}.bind(this)),this.app.view){var i=this.app.view.data.id,a=this.node.getElement("#"+i+"viewFilterValueArea2");a&&(this.valueTextInput2=a.getElement(".valueTextInput2_vf")||null,this.valueNumberInput2=a.getElement(".valueNumberInput2_vf")||null,this.valueDatetimeInput2=a.getElement(".valueDatetimeInput2_vf")||null,this.valueDateInput2=a.getElement(".valueDateInput2_vf")||null,this.valueTimeInput2=a.getElement(".valueTimeInput2_vf")||null,this.valueBooleanInput2=a.getElement(".valueBooleanInput2_vf")||null,MWF.require("MWF.widget.Calendar",function(){this.calendar=new MWF.widget.Calendar(this.valueDatetimeInput2,{style:"xform",isTime:!0,secondEnable:!0,target:this.app.content,format:"db",onComplate:function(){this.node.getElement("#"+i+"viewFilterDateFormulaSelector2").getElements("input").set("checked",!1)}.bind(this)}),new MWF.widget.Calendar(this.valueDateInput2,{style:"xform",isTime:!1,target:this.app.content,format:"%Y-%m-%d"}),new MWF.widget.Calendar(this.valueTimeInput2,{style:"xform",timeOnly:!0,secondEnable:!0,target:this.app.content,format:"%H:%M:%S"})}.bind(this)),this.valueTextInput2.addEvent("keydown",function(t){13==t.code&&this.modifyOrAddFilterItem()}.bind(this)),this.valueNumberInput2.addEvent("keydown",function(t){13==t.code&&this.modifyOrAddFilterItem()}.bind(this)))}},switchInputDisplay:function(){var t="";this.app.view&&(t=this.app.view.data.id);var e=this.app.lp.filter,i={textValue:{equals:{selectorArea:["#"+t+"viewFilterTextFormulaSelector"]},notEquals:{selectorArea:["#"+t+"viewFilterTextFormulaSelector"]},greaterThan:{invalidValue:["@person","@unitList","@unitAllList","@identityList"]},greaterThanOrEqualTo:{invalidValue:["@person","@unitList","@unitAllList","@identityList"]},lessThan:{invalidValue:["@person","@unitList","@unitAllList","@identityList"]},lessThanOrEqualTo:{invalidValue:["@person","@unitList","@unitAllList","@identityList"]},like:{invalidValue:["@person","@unitList","@unitAllList","@identityList"]},notLike:{invalidValue:["@person","@unitList","@unitAllList","@identityList"]},range:{invalidValue:["@person","@unitList","@unitAllList","@identityList"]},in:{invalidValue:["@person","@unitList","@unitAllList","@identityList"]}},numberValue:{equals:{},notEquals:{},greaterThan:{},greaterThanOrEqualTo:{},lessThan:{},lessThanOrEqualTo:{},range:{}},dateTimeValue:{equals:{invalidValue:["@year","@season","@month","@time","@date"]},notEquals:{selectorArea:["#"+t+"viewFilterDateFormulaSelector"]},greaterThan:{selectorArea:["#"+t+"viewFilterDateFormulaSelector"]},greaterThanOrEqualTo:{selectorArea:["#"+t+"viewFilterDateFormulaSelector"]},lessThan:{selectorArea:["#"+t+"viewFilterDateFormulaSelector"]},lessThanOrEqualTo:{selectorArea:["#"+t+"viewFilterDateFormulaSelector"]},range:{invalidValue:["@year","@season","@month","@time","@date"]}},dateValue:{equals:{invalidValue:["@year","@season","@month","@date"]},notEquals:{selectorArea:["#"+t+"viewFilterDateOnlyFormulaSelector"]},greaterThan:{selectorArea:["#"+t+"viewFilterDateOnlyFormulaSelector"]},greaterThanOrEqualTo:{selectorArea:["#"+t+"viewFilterDateOnlyFormulaSelector"]},lessThan:{selectorArea:["#"+t+"viewFilterDateOnlyFormulaSelector"]},lessThanOrEqualTo:{selectorArea:["#"+t+"viewFilterDateOnlyFormulaSelector"]},range:{invalidValue:["@year","@season","@month","@date"]}},timeValue:{equals:{invalidValue:["@time"]},notEquals:{selectorArea:["#"+t+"viewFilterTimeOnlyFormulaSelector"]},greaterThan:{selectorArea:["#"+t+"viewFilterTimeOnlyFormulaSelector"]},greaterThanOrEqualTo:{selectorArea:["#"+t+"viewFilterTimeOnlyFormulaSelector"]},lessThan:{selectorArea:["#"+t+"viewFilterTimeOnlyFormulaSelector"]},lessThanOrEqualTo:{selectorArea:["#"+t+"viewFilterTimeOnlyFormulaSelector"]},range:{invalidValue:["@time"]}},booleanValue:{equals:{},notEquals:{}}},a=["#"+t+"viewFilterTextFormulaSelector","#"+t+"viewFilterDateFormulaSelector","#"+t+"viewFilterDateOnlyFormulaSelector","#"+t+"viewFilterTimeOnlyFormulaSelector"],s=this.datatypeInput.options[this.datatypeInput.selectedIndex].value,n=i[s],l=Object.keys(n),u=this.comparisonInput.options,o=u[this.comparisonInput.selectedIndex].value;if(l.contains("in")&&"in"===o?this.multiValueNoticeNode&&this.multiValueNoticeNode.show():this.multiValueNoticeNode&&this.multiValueNoticeNode.hide(),!this.originalComparisonOptions){this.originalComparisonOptions=[];for(var r=0;r<u.length;r++)this.originalComparisonOptions.push({text:u[r].text,value:u[r].value})}for(;this.comparisonInput.options&&this.comparisonInput.options.length;)this.comparisonInput.options[0].destroy();for(r=0;r<this.originalComparisonOptions.length;r++){var h=this.originalComparisonOptions[r];if(l.contains(h.value)){var p=new Element("option",{text:h.text,value:h.value}).inject(this.comparisonInput);h.value===o&&(p.selected=!0)}}var c,d,v=[],m=[];for(var I in n)if(o===I){v=n[I].selectorArea||[],m=n[I].invalidValue||[];break}for(r=0;r<m.length;r++)m[r]=m[r].toLowerCase();switch(a.each(function(t){var e=this.inputAreaNode.getElement(t);e&&(v.contains(t)?e.setStyle("display","block"):(e.getElements("input").set("checked",!1),e.setStyle("display","none")))}.bind(this)),l.contains("range")&&"range"==o?((c=this.inputAreaNode.getElement("#"+t+"viewFilterValue2Area"))&&c.setStyle("display","block"),(d=this.inputAreaNode.getElement("#"+t+"viewFilterValueTitleArea"))&&d.set("text",e.from)):((c=this.inputAreaNode.getElement("#"+t+"viewFilterValue2Area"))&&c.setStyle("display","none"),(d=this.inputAreaNode.getElement("#"+t+"viewFilterValueTitleArea"))&&d.set("text",e.value)),s){case"textValue":this.valueTextInput.setStyle("display","block"),m.contains((this.valueTextInput.get("value")||"").toLowerCase())&&this.valueTextInput.set("value",""),this.valueNumberInput.setStyle("display","none"),this.valueDatetimeInput.setStyle("display","none"),this.valueDateInput.setStyle("display","none"),this.valueTimeInput.setStyle("display","none"),this.valueBooleanInput.setStyle("display","none"),this.valueTextInput2&&this.valueTextInput2.setStyle("display","block"),this.valueNumberInput2&&this.valueNumberInput2.setStyle("display","none"),this.valueDatetimeInput2&&this.valueDatetimeInput2.setStyle("display","none"),this.valueDateInput2&&this.valueDateInput2.setStyle("display","none"),this.valueTimeInput2&&this.valueTimeInput2.setStyle("display","none"),this.valueBooleanInput2&&this.valueBooleanInput2.setStyle("display","none");break;case"numberValue":this.valueTextInput.setStyle("display","none"),this.valueNumberInput.setStyle("display","block"),m.contains((this.valueNumberInput.get("value")||"").toLowerCase())&&this.valueNumberInput.set("value",""),this.valueDatetimeInput.setStyle("display","none"),this.valueBooleanInput.setStyle("display","none"),this.valueDateInput.setStyle("display","none"),this.valueTimeInput.setStyle("display","none"),this.valueTextInput2&&this.valueTextInput2.setStyle("display","none"),this.valueNumberInput2&&this.valueNumberInput2.setStyle("display","block"),this.valueDatetimeInput2&&this.valueDatetimeInput2.setStyle("display","none"),this.valueDateInput2&&this.valueDateInput2.setStyle("display","none"),this.valueTimeInput2&&this.valueTimeInput2.setStyle("display","none"),this.valueBooleanInput2&&this.valueBooleanInput2.setStyle("display","none");break;case"datetimeValue":case"dateTimeValue":this.valueTextInput.setStyle("display","none"),this.valueNumberInput.setStyle("display","none"),this.valueDatetimeInput.setStyle("display","block"),m.contains((this.valueDatetimeInput.get("value")||"").toLowerCase())&&this.valueDatetimeInput.set("value",""),this.valueBooleanInput.setStyle("display","none"),this.valueDateInput.setStyle("display","none"),this.valueTimeInput.setStyle("display","none"),this.valueTextInput2&&this.valueTextInput2.setStyle("display","none"),this.valueNumberInput2&&this.valueNumberInput2.setStyle("display","none"),this.valueDatetimeInput2&&this.valueDatetimeInput2.setStyle("display","block"),this.valueDateInput2&&this.valueDateInput2.setStyle("display","none"),this.valueTimeInput2&&this.valueTimeInput2.setStyle("display","none"),this.valueBooleanInput2&&this.valueBooleanInput2.setStyle("display","none");break;case"dateValue":this.valueTextInput.setStyle("display","none"),this.valueNumberInput.setStyle("display","none"),this.valueDatetimeInput.setStyle("display","none"),this.valueBooleanInput.setStyle("display","none"),this.valueDateInput.setStyle("display","block"),m.contains((this.valueDateInput.get("value")||"").toLowerCase())&&this.valueDateInput.set("value",""),this.valueTimeInput.setStyle("display","none"),this.valueTextInput2&&this.valueTextInput2.setStyle("display","none"),this.valueNumberInput2&&this.valueNumberInput2.setStyle("display","none"),this.valueDatetimeInput2&&this.valueDatetimeInput2.setStyle("display","none"),this.valueDateInput2&&this.valueDateInput2.setStyle("display","block"),this.valueTimeInput2&&this.valueTimeInput2.setStyle("display","none"),this.valueBooleanInput2&&this.valueBooleanInput2.setStyle("display","none");break;case"timeValue":this.valueTextInput.setStyle("display","none"),this.valueNumberInput.setStyle("display","none"),this.valueDatetimeInput.setStyle("display","none"),this.valueBooleanInput.setStyle("display","none"),this.valueDateInput.setStyle("display","none"),this.valueTimeInput.setStyle("display","block"),m.contains((this.valueTimeInput.get("value")||"").toLowerCase())&&this.valueTimeInput.set("value",""),this.valueTextInput2&&this.valueTextInput2.setStyle("display","none"),this.valueNumberInput2&&this.valueNumberInput2.setStyle("display","none"),this.valueDatetimeInput2&&this.valueDatetimeInput2.setStyle("display","none"),this.valueDateInput2&&this.valueDateInput2.setStyle("display","none"),this.valueTimeInput2&&this.valueTimeInput2.setStyle("display","block"),this.valueBooleanInput2&&this.valueBooleanInput2.setStyle("display","none");break;case"booleanValue":this.valueTextInput.setStyle("display","none"),this.valueNumberInput.setStyle("display","none"),this.valueDatetimeInput.setStyle("display","none"),this.valueDateInput.setStyle("display","none"),this.valueTimeInput.setStyle("display","none"),this.valueBooleanInput.setStyle("display","block"),this.valueTextInput2&&this.valueTextInput2.setStyle("display","none"),this.valueNumberInput2&&this.valueNumberInput2.setStyle("display","none"),this.valueDatetimeInput2&&this.valueDatetimeInput2.setStyle("display","none"),this.valueDateInput2&&this.valueDateInput2.setStyle("display","none"),this.valueTimeInput2&&this.valueTimeInput2.setStyle("display","none"),this.valueBooleanInput2&&this.valueBooleanInput2.setStyle("display","block")}},createActionNode:function(){this.actionNode=new Element("div",{styles:this.css.actionNode}).inject(this.actionAreaNode),this.actionNode.addEvent("click",function(){this.modifyOrAddFilterItem()}.bind(this))},modifyOrAddFilterItem:function(){this.currentFilterItem?this.modifyFilterItem():this.restrictFilterInput.checked?this.addFilterItem():this.addCustomFilterItem(),this.setData({logic:"and",path:"",title:"",type:this.restrictFilterInput.checked?"restrict":"custom",comparison:"equals",formatType:"textValue",value:"",otherValue:"",code:""})},modifyFilterItem:function(){var t=this.getInputData();this.verificationData(t)&&(this.currentFilterItem.reload(t),this.currentFilterItem.unSelected(),this.fireEvent("change"))},addFilterItem:function(){var t=this.getInputData();this.verificationData(t)&&(this.items.push(new MWF.xApplication.query.ViewDesigner.widget.ViewFilter.Item(this,t)),this.fireEvent("change"))},addCustomFilterItem:function(){var t=this.getInputData();this.verificationDataCustom(t)&&(this.items.push(new MWF.xApplication.query.ViewDesigner.widget.ViewFilter.ItemCustom(this,t)),this.fireEvent("change"))},verificationData:function(t){return!!t.path||(this.verificationNode=new Element("div",{styles:this.css.verificationNode}).inject(this.inputAreaNode),new Element("div",{styles:this.css.verificationTextNode,text:this.app.lp.mastInputPath}).inject(this.verificationNode),this.pathInput.focus(),this.pathInput.setStyle("background-color","#fbe8e8"),this.pathInput.addEvents({keydown:function(){this.verificationNode&&(this.verificationNode.destroy(),this.verificationNode=null,this.pathInput.setStyle("background-color","#FFF"))}.bind(this),click:function(){this.verificationNode&&(this.verificationNode.destroy(),this.verificationNode=null)}.bind(this)}),!1)},verificationDataCustom:function(t){return t.title?!!t.path||(this.verificationNode=new Element("div",{styles:this.css.verificationNode}).inject(this.inputAreaNode),new Element("div",{styles:this.css.verificationTextNode,text:this.app.lp.mastInputPath}).inject(this.verificationNode),this.pathInput.focus(),this.pathInput.setStyle("background-color","#fbe8e8"),this.pathInput.addEvents({keydown:function(){this.verificationNode&&(this.verificationNode.destroy(),this.verificationNode=null,this.pathInput.setStyle("background-color","#FFF"))}.bind(this),click:function(){this.verificationNode&&(this.verificationNode.destroy(),this.verificationNode=null)}.bind(this)}),!1):(this.verificationNode=new Element("div",{styles:this.css.verificationNode}).inject(this.inputAreaNode),new Element("div",{styles:this.css.verificationTextNode,text:this.app.lp.mastInputTitle}).inject(this.verificationNode),this.titleInput.focus(),this.titleInput.setStyle("background-color","#fbe8e8"),this.titleInput.addEvents({keydown:function(){this.verificationNode&&(this.verificationNode.destroy(),this.verificationNode=null,this.titleInput.setStyle("background-color","#FFF"))}.bind(this),click:function(){this.verificationNode&&(this.verificationNode.destroy(),this.verificationNode=null)}.bind(this)}),!1)},getInputData:function(){var t=this.logicInput.options[this.logicInput.selectedIndex].value,e=this.pathInput.get("value"),i=this.titleInput.get("value");if(this.restrictFilterInput.checked)var a="restrict";if(this.customFilterInput.checked)a="custom";var s=this.comparisonInput.options[this.comparisonInput.selectedIndex].value,n=this.datatypeInput.options[this.datatypeInput.selectedIndex].value,l="",u="";switch(n){case"textValue":l=this.valueTextInput.get("value")||"",u=this.valueTextInput2&&this.valueTextInput2.get("value")||"";break;case"numberValue":l=this.valueNumberInput.get("value").toFloat(),u=this.valueNumberInput2?this.valueNumberInput2.get("value").toFloat():"";break;case"datetimeValue":case"dateTimeValue":l=this.valueDatetimeInput.get("value")||"",u=this.valueDatetimeInput2&&this.valueDatetimeInput2.get("value")||"";break;case"dateValue":l=this.valueDateInput.get("value")||"",u=this.valueDateInput2&&this.valueDateInput2.get("value")||"";break;case"timeValue":l=this.valueTimeInput.get("value")||"",u=this.valueTimeInput2&&this.valueTimeInput2.get("value")||"";break;case"booleanValue":l="true"==(l=this.valueBooleanInput.options[this.valueBooleanInput.selectedIndex].value),u="true"==(u=this.valueBooleanInput2?this.valueBooleanInput2.options[this.valueBooleanInput.selectedIndex].value:"")}if("restrict"===a)return{logic:t,path:e,title:i,type:a,comparison:s,formatType:n,value:l,otherValue:u,code:this.scriptData};var o="";return this.customFilterValueTypes.each((function(t){t.get("checked")&&(o=t.get("value"))})),{logic:t,path:e,title:i,type:a,comparison:s,formatType:n,value:l,otherValue:u,code:this.scriptData,valueType:o,valueScript:this.customFilterValueScriptData}},setData:function(t){for(var e=0;e<this.logicInput.options.length;e++)if(this.logicInput.options[e].value===t.logic){this.logicInput.options[e].set("selected",!0);break}this.titleInput.set("value",t.title),this.pathInput.set("value",t.path);for(e=0;e<this.comparisonInput.options.length;e++)if(this.comparisonInput.options[e].value===t.comparison){this.comparisonInput.options[e].set("selected",!0);break}for(e=0;e<this.datatypeInput.options.length;e++)if(this.datatypeInput.options[e].value===t.formatType){this.datatypeInput.options[e].set("selected",!0);break}switch(t.formatType){case"textValue":this.valueTextInput.set("value",t.value),this.valueTextInput2&&this.valueTextInput2.set("value",t.otherValue);break;case"numberValue":this.valueNumberInput.set("value",t.value),this.valueNumberInput2&&this.valueNumberInput2.set("value",t.otherValue);break;case"datetimeValue":case"dateTimeValue":this.valueDatetimeInput.set("value",t.value),this.valueDatetimeInput2&&this.valueDatetimeInput2.set("value",t.otherValue);break;case"dateValue":this.valueDateInput.set("value",t.value),this.valueDateInput2&&this.valueDateInput2.set("value",t.otherValue);break;case"timeValue":this.valueTimeInput.set("value",t.value),this.valueTimeInput2&&this.valueTimeInput2.set("value",t.otherValue);break;case"booleanValue":for(e=0;e<this.valueBooleanInput.options.length;e++){if("true"==this.valueBooleanInput.options[e].value===t.value){this.valueBooleanInput.options[e].set("selected",!0);break}}if(this.valueBooleanInput2)for(e=0;e<this.valueBooleanInput2.options.length;e++){if("true"==this.valueBooleanInput2.options[e].value===t.otherValue){this.valueBooleanInput2.options[e].set("selected",!0);break}}}this.scriptData=t.code;try{this.scriptArea&&this.scriptArea.editor&&this.scriptArea.editor.setValue(this.scriptData.code)}catch(t){}"custom"===t.type&&(this.customFilterValueTypes.each((function(e){t.valueType?t.valueType===e.get("value")&&e.set("checked",!0):"input"===e.get("value")&&e.set("checked",!0)})),this.customFilterValueScriptArea&&(t.valueType&&"input"!==t.valueType?(this.customFilterValueScriptDiv.show(),this.customFilterValueScriptData=t.valueScript,this.customFilterValueScriptArea.editor.setValue(t.valueScript?t.valueScript.code:"")):(this.customFilterValueScriptDiv.hide(),this.customFilterValueScriptData="",this.customFilterValueScriptArea.editor.setValue("")))),this.switchInputDisplay(),this.datatypeInput.onchange&&this.datatypeInput.onchange()},deleteItem:function(t){this.currentFilterItem==t&&t.unSelected(),this.items.erase(t),t.node.destroy(),MWF.release(t),this.fireEvent("change")},getData:function(){var t=[],e=[];return this.items.each(function(i){"custom"===i.data.type?e.push(i.data):t.push(i.data)}.bind(this)),{data:t,customData:e}}}),MWF.xApplication.query.ViewDesigner.widget.ViewFilter.Item=new Class({Implements:[Events],initialize:function(t,e){this.filter=t,this.data=e,this.container=this.filter.listAreaNode,this.css=this.filter.css,this.app=this.filter.app,this.load()},load:function(){this.node=new Element("div",{styles:this.css.itemNode}).inject(this.container),this.deleteNode=new Element("div",{styles:this.css.itemDeleteNode}).inject(this.node),this.contentNode=new Element("div",{styles:this.css.itemContentNode}).inject(this.node),this.contentNode.set("text",this.getText()),this.contentNode.addEvent("click",function(){this.selected()}.bind(this)),this.deleteNode.addEvent("click",function(t){this.deleteItem(t)}.bind(this))},getText:function(){var t=this.app.lp.filter;return"numberValue"===this.data.formatType?t[this.data.logic]+" "+this.data.path+" "+t[this.data.comparison]+" "+this.data.value+("range"==this.data.comparison?', "'+this.data.otherValue+'"':""):t[this.data.logic]+" "+this.data.path+" "+t[this.data.comparison]+' "'+this.data.value+'"'+("range"==this.data.comparison?', "'+this.data.otherValue+'"':"")},reload:function(t){this.data=t,this.contentNode.set("text",this.getText())},selected:function(){this.filter.restrictFilterInput.set("checked",!0),this.filter.restrictFilterInput.click(),this.filter.currentFilterItem&&this.filter.currentFilterItem.unSelected(),this.node.setStyles(this.css.itemNode_current),this.filter.currentFilterItem=this,this.filter.setData(this.data)},unSelected:function(){this.node.setStyles(this.css.itemNode),this.filter.currentFilterItem=null,this.filter.currentItem=this},deleteItem:function(t){var e=this;this.filter.app.confirm("warn",t,this.app.lp.delete_filterItem_title,this.app.lp.delete_filterItem,300,120,(function(){e.destroy(),this.close()}),(function(){this.close()}))},destroy:function(){this.filter.deleteItem(this)}}),MWF.xApplication.query.ViewDesigner.widget.ViewFilter.ItemCustom=new Class({Extends:MWF.xApplication.query.ViewDesigner.widget.ViewFilter.Item,initialize:function(t,e){this.filter=t,this.data=e,this.container=this.filter.fieldListAreaNode,this.css=this.filter.css,this.app=this.filter.app,this.load()},selected:function(){this.filter.customFilterInput.set("checked",!0),this.filter.customFilterInput.click(),this.filter.currentFilterItem&&this.filter.currentFilterItem.unSelected(),this.node.setStyles(this.css.itemNode_current),this.filter.currentFilterItem=this,this.filter.setData(this.data)},getText:function(){this.app.lp.filter;return this.data.title+"("+this.data.path+")"}});