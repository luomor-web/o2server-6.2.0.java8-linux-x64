layout=window.layout||{},layout.desktop=layout;var locate=window.location;layout.protocol=locate.protocol;var href=locate.href;layout.session=layout.session||{},-1!=href.indexOf("debugger")&&(layout.debugger=!0),o2.addReady((function(){o2.load(["../o2_lib/mootools/plugin/mBox.Notice.js","../o2_lib/mootools/plugin/mBox.Tooltip.js"],{sequence:!0},(function(){MWF.loadLP("zh-cn"),MWF.require("MWF.widget.Mask",null,!1),layout.mask=new MWF.widget.Mask({style:"desktop"}),layout.mask.load(),MWF.require("MWF.xDesktop.Layout",(function(){MWF.require("MWF.xDesktop.Authentication",null,!1),MWF.require("MWF.xDesktop.Common",null,!1),MWF.require("MWF.xDesktop.Access",null,!1),MWF.require("MWF.xAction.RestActions",null,!1),MWF.require("MWF.xDesktop.Actions.RestActions",null,!1),MWF.xDesktop.requireApp("Common","",null,!1),layout.requireApp=function(o,t,i){var e=o.split("."),n=(e[e.length-1],MWF.language,MWF.xApplication);e.each(function(o,t){t<e.length-1?n[o]=n[o]||{}:n[o]=n[o]||{options:Object.clone(MWF.xApplication.Common.options)},n=n[o]}.bind(this)),n.options||(n.options=Object.clone(MWF.xApplication.Common.options)),MWF.xDesktop.requireApp(o,"lp."+MWF.language,{onRequestFailure:function(){MWF.xDesktop.requireApp(o,"lp.zh-cn",null,!1)}.bind(this),onSuccess:function(){}.bind(this)},!1),MWF.xDesktop.requireApp(o,i,(function(){t&&t(n)}))},layout.openApplication=function(o,t,i,e){var n;if(layout.app)t&&"Forum"!=t?"ForumCategory"==t?n=i.categoryId:"ForumDocument"==t?n=i.id:"ForumPerson"==t||"ForumSearch"==t||"ForumSection"==t&&(n=i.sectionId):n=i.id,sessionStorage[t+(n||"")+"options"]=JSON.stringify(i),sessionStorage[a+(n||"")+"status"]=JSON.stringify(e),layout.debugger?window.open("forum.html?debugger&app="+t+(n?"&id="+n:""),"_blank"):window.open("forum.html?app="+t+(n?"&id="+n:""),"_blank");else{var s=t.split("."),a=s[s.length-1];layout.requireApp(t,function(t){this.createNewApplication(o,t,a,i,e)}.bind(this))}},layout.createNewApplication=function(o,t,i,e,n){var s=new t.Main(this,e);s.desktop=layout,s.inBrowser=!0,s.status=n,s.load(!0);var a=i;e.appId?a=e.appId:t.options.multitask&&(a=a+"-"+new MWF.widget.UUID),s.appId=a,layout.app=s},layout.load=function(){this.isAuthentication(function(){layout.apps=[],this.node=$("layout");var o,t={},i=layout.getUrlParam();if(i.app){var e=i.app,n=i.id,s=sessionStorage[e+(n||"")+"options"];s?t=JSON.parse(s):n&&(t="ForumCategory"==e?{categoryId:n}:"ForumSection"==e?{sectionId:n}:"ForumDocument"==e?{isNew:!1,isEdited:!1,id:n}:{id:n}),(o=sessionStorage[e+(n||"")+"status"])&&(o=JSON.parse(t))}else e="Forum";layout.openApplication(null,e,t,o),layout.mask.hide()}.bind(this))},layout.getUrlParam=function(){var o=window.location.href,t=o.substr(o.indexOf("?")+1,o.length).split("&"),i={};return t.each((function(o){var t=o.split("=");i[t[0]]=t[1]})),i},layout.isAuthentication=function(o){this.authentication=new MWF.xDesktop.Authentication({onLogin:layout.load.bind(layout)});var t=!0;return this.authentication.isAuthenticated(function(t){this.user=t.data,this.session={},this.session.user=t.data,o&&o()}.bind(this),function(){this.user="anonymous",this.session={},this.session.user={name:this.user,roleList:[]},o&&o(),t=!1}.bind(this)),t},MWF.getJSON("res/config/config.json",(function(o){layout.config=o,MWF.xDesktop.getServiceAddress(layout.config,function(o,t){layout.serviceAddressList=o,layout.centerServer=t,layout.load()}.bind(this))}))}))}))}));