o2.addReady((function(){window.Element&&Element.implement({makeLnk:function(o){}}),layout.desktop.addEvent=function(o,e,t){window.addEvent(o,e,t)},layout.desktop.addEvents=function(o){window.addEvents(o)};var o=window.$?$("loaddingArea"):null,e=0,t=window.document&&document.body?document.body.getSize():null,n=function(){o&&(o.destroy(),o=null)},a=function(a){if(o)if(a)o.setStyles({width:t.x+"px"}),window.setTimeout(n,500);else{var s=++e/4*t.x;o.setStyles({width:s+"px"}),e>=4&&window.setTimeout(n,500)}},s=function(o,e){layout.serviceAddressList=o,layout.centerServer=e,layout.desktop.serviceAddressList=o,layout.desktop.centerServer=e},i=function(o){if("auto"===layout.config.app_protocol&&(layout.config.app_protocol=window.location.protocol),layout.config.configMapping&&(layout.config.configMapping[window.location.host]||layout.config.configMapping[window.location.hostname])){var e=layout.config.configMapping[window.location.host]||layout.config.configMapping[window.location.hostname];e.servers?(layout.serviceAddressList=e.servers,layout.desktop.serviceAddressList=e.servers,e.center&&(center="array"===o2.typeOf(e.center)?e.center[0]:e.center),layout.centerServer=center,layout.desktop.centerServer=center,o&&o()):(e.center&&(layout.config.center="array"===o2.typeOf(e.center)?e.center:[e.center]),o2.xDesktop.getServiceAddress(layout.config,function(e,t){s(e,t),a(),o&&o()}.bind(this)))}else o2.xDesktop.getServiceAddress(layout.config,function(e,t){s(e,t),a(),o&&o()}.bind(this))},u=function(){var o=new URI(window.location.href).get("data");if(o[o2.tokenName]){Cookie.dispose(o2.tokenName);var e=window.location.host,t=null;/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(e)?t=e:e.indexOf(".")>0&&(t=e.substring(e.indexOf("."))),t?Cookie.write(o2.tokenName,o[o2.tokenName],{domain:t,path:"/"}):Cookie.write(o2.tokenName,o[o2.tokenName])}layout.sessionPromise=new Promise((function(o,e){o2.Actions.get("x_organization_assemble_authentication").getAuthentication(function(e){if(e.data.language&&e.data.language!==o2.languageName){o2.language=e.data.language.toLowerCase(),o2.languageName=e.data.language;var t="../x_desktop/js/base_lp_"+o2.language+(o2.session.isDebugger?"":".min")+".js";o2.load(t,{reload:!0},(function(){o&&o(e.data)}))}else o&&o(e.data)}.bind(this),function(o,t,n){e&&e({xhr:o,text:t,error:n})}.bind(this))})),layout.sessionPromise.then((function(o){layout.user=o,layout.session=layout.session||{},layout.session.user=o,layout.session.token=o.token,layout.desktop.session=layout.session}),(function(){if(layout.anonymous){var o={name:"anonymous",roleList:[]};layout.user=o,layout.session=layout.session||{},layout.session.user=o,layout.session.token=o.token,layout.desktop.session=layout.session}else a(!0),layout.yqwx?layout.openLoginQywx():layout.openLogin()})),function(o){for(o&&(layout.user=o.data,layout.session=layout.session||{},layout.session.user=o.data,layout.session.token=o.data.token,layout.desktop.session=layout.session),a(!0),layout.isReady=!0;layout.readys&&layout.readys.length;)layout.readys.shift().apply(window)}(),layout.openLogin=function(){layout.desktop.type="app",layout.app=null;var o=$("appContent")||$("layout");o&&o.empty(),layout.authentication=new o2.xDesktop.Authentication({style:"flat",onLogin:u.bind(layout)}),layout.authentication.loadLogin(document.body);var e=$("browser_loading");e&&e.fade("out")},layout.openLoginQywx=function(){console.log("开始login。。。。。。。。。。。。。");var o=locate.href.toURI();console.log("执行单点。。。。。。。。。。");var e=new MWF.xDesktop.Actions.RestActions("","x_organization_assemble_authentication","");e.getActions=function(o){this.actions={sso:{uri:"/jaxrs/qiyeweixin/code/{code}",method:"GET"}},o&&o()},e.invoke({name:"sso",async:!0,parameter:{code:o.getData("code")},success:function(o){console.log("单点成功。"),console.log(o),layout.session.user=o.data,u()}.bind(this),failure:function(o,e,t){var n=document.getElementById("loaddingArea");n&&n.destroy(),document.id("layout").set("html","<div>企业微信单点异常！</div>")}.bind(this)})}};layout.config=null;var l=!1,d=!1,c=!1,r="../x_desktop/js/base_lp_"+o2.language+(o2.session.isDebugger?"":".min")+".js";o2.session.isDebugger&&(o2.session.isMobile||layout.mobile)&&o2.load("../o2_lib/eruda/eruda.js");var y=function(){a(),d=!0;o2.require(["o2.xDesktop.$all"],{onSuccess:function(){c=!0,l&&c&&d&&i((function(){u()}))},onEvery:function(){a()}})};o2.LP?y():o2.load(r,y),o2.getJSON("../x_desktop/res/config/config.json",(function(o){a(),layout.config=o,o2.tokenName=o.tokenName||"x-token",(l=!0)&&c&&d&&i((function(){u()}))}))}));