layout=window.layout||{};var locate=window.location;layout.protocol=locate.protocol,layout.mobile=!0,layout.desktop=layout,layout.session=layout.session||{},o2.addReady((function(){var o=locate.href;-1!==o.indexOf("debugger")&&(layout.debugger=!0);var t=new URI(o),n=(t.getData("redirectTo"),t.getData("option")),e=t.getData("status"),i=n?JSON.decode(n):null,a=e?JSON.decode(e):null;o2.load(["../o2_lib/mootools/plugin/mBox.Notice.js","../o2_lib/mootools/plugin/mBox.Tooltip.js"],{sequence:!0},(function(){MWF.loadLP("zh-cn"),MWF.require("MWF.xDesktop.Layout",(function(){MWF.xDesktop.requireApp("Common","",null,!1),MWF.require("MWF.xDesktop.Authentication",null,!1),layout.requireApp=function(o,t,n){var e=o.split("."),i=(e[e.length-1],MWF.language,MWF.xApplication);e.each(function(o,t){t<e.length-1?i[o]=i[o]||{}:i[o]=i[o]||{options:Object.clone(MWF.xApplication.Common.options)},i=i[o]}.bind(this)),i.options||(i.options=Object.clone(MWF.xApplication.Common.options)),MWF.xDesktop.requireApp(o,"lp."+MWF.language,{onRequestFailure:function(){MWF.xDesktop.requireApp(o,"lp.zh-cn",null,!1)}.bind(this),onSuccess:function(){}.bind(this)},!1),MWF.xDesktop.requireApp(o,n,(function(){t&&t(i)}))},layout.openApplication=function(o,t,n,e){if(layout.app){layout.desktop.openBrowserApp=t,layout.desktop.openBrowserStatus=e,layout.desktop.openBrowserOption=n;var i=JSON.encode(n),a=JSON.encode(e);if(n.docTitle,"process.Work"===t){var s=new URI(window.location.href).getData("redirectlink");s=s?encodeURIComponent(s):encodeURIComponent(locate.pathname+locate.search),n.workId?window.location=o2.filterUrl("../x_desktop/workmobilewithaction.html?workid="+n.workId+"&redirectlink="+s):n.workCompletedId&&(window.location=o2.filterUrl("../x_desktop/workmobilewithaction.html?workcompletedid="+n.workCompletedId+"&redirectlink="+s))}else window.location=o2.filterUrl("../x_desktop/appMobile.html?app="+t+"&option="+(i||"")+"&status="+(a||""))}else{var l=t.split("."),c=l[l.length-1];layout.requireApp(t,function(t){this.createNewApplication(o,t,c,n,e)}.bind(this))}},layout.createNewApplication=function(o,t,n,e,i){var a=new t.Main(this,e);a.desktop=layout,a.inBrowser=!0,a.status=i,a.load(!0);var s=n;e.appId?s=e.appId:t.options.multitask&&(s=s+"-"+new MWF.widget.UUID),a.appId=s,layout.app=a},layout.load=function(){o.toURI(),MWF.require("MWF.xDesktop.Actions.RestActions",function(){var t=new MWF.xDesktop.Actions.RestActions("","x_organization_assemble_authentication","");t.getActions=function(o){this.actions={info:{uri:"/jaxrs/zhengwudingding/info",method:"POST"},auth:{uri:"/jaxrs/zhengwudingding/code/{code}"}},o&&o()},t.invoke({name:"info",async:!0,data:{url:o},success:function(o){this.isAuthentication(function(){var o=a,t=i;layout.openApplication(null,"portal.Portal",t||{},o),document.all.appContentMask&&document.all.appContentMask.destroy()}.bind(this));var n=o.data;dd.config({agentId:n.agentid,corpId:n.corpId,timeStamp:n.timeStamp,nonceStr:n.nonceStr,signature:n.signature,jsApiList:["runtime.info"]}),dd.biz.navigation.setTitle({title:""}),dd.runtime.permission.requestAuthCode({corpId:n.corpId,onSuccess:function(o){t.invoke({name:"auth",async:!0,parameter:{code:o.code},success:function(o){}.bind(this),failure:function(o,t,n){"appMobile.html?app=process.TaskCenter".toURI().go()}.bind(this)})}.bind(this),onFail:function(o){}})}.bind(this),failure:function(o,t,n){}.bind(this)})}.bind(this))},layout.isAuthentication=function(o){this.authentication=new MWF.xDesktop.Authentication({onLogin:layout.load.bind(layout)});var t=!0;return this.authentication.isAuthenticated(function(t){this.user=t.data,this.session={},this.session.user=t.data,o&&o()}.bind(this),function(){this.authentication.loadLogin(document.body),layout.mask&&layout.mask.hide(),document.all.appContentMask&&document.all.appContentMask.destroy(),t=!1}.bind(this)),t},layout.notice=function(o,t,n,e,i){e||(e={x:"right",y:"top"}),n||(n=this.content),t||(t="ok");var a=n||$(document.body),s=i;s||(s={x:10,y:(e.y.toString().toLowerCase(),10)}),new mBox.Notice({type:t,position:e,move:!1,target:a,delayClose:"error"==t?1e4:5e3,offset:s,content:o})},MWF.getJSON("res/config/config.json",(function(o){layout.config=o,MWF.xDesktop.getServiceAddress(layout.config,function(o,t){layout.serviceAddressList=o,layout.centerServer=t,layout.load()}.bind(this))}))}))}))}));