layout.addReady((function(){!function(t){var e=new URI(window.location.href),i=e.get("data"),o=e.getData("app"),n=e.getData("form");i.form={app:o,id:n};var r=function(){t.apps=[],t.node=$("layout")||$("appContent")||document.body;var e="process.Work",o=null,n=i,r=window.opener;if(r)try{e||(e=r.layout.desktop.openBrowserApp),o||(o=r.layout.desktop.openBrowserStatus),n||(n=r.layout.desktop.openBrowserOption)}catch(t){}if(i.job&&!i.workid){var d=null;if(o2.Actions.get("x_processplatform_assemble_surface").listWorkByJob(i.job,function(t){t.data&&(d=t.data)}.bind(this),null,!1),d){var p=d.workList.length+d.workCompletedList.length;if(p)if(p>1&&i.choice){t.node.empty(),t.node.setStyle("background","#f1f1f1");var l=new Element("div",{styles:{"font-size":"18px","text-align":"center","font-weight":"bold",margin:"auto",height:"30px",width:"90%","max-width":"600px",padding:"40px 0px 20px 20px"},text:o2.LP.widget.choiceWork}).inject(t.node);l=new Element("div",{styles:{margin:"auto",padding:"0px 20px",width:"90%","max-width":"600px"}}).inject(t.node);d.workList.each(function(r){var d=new Element("div",{styles:{background:"#ffffff","border-radius":"10px",clear:"both","margin-bottom":"10px",height:"40px",padding:"10px 10px"}}).inject(l),p="<div style='height: 40px; width: 40px; float: left; background: url(../x_component_process_Xform/$Form/default/icon/work.png) no-repeat center center'></div><div style='height: 40px; width: 40px; float: right'><div class='MWFAction' style='height: 20px; width: 40px; margin-top: 10px; border: 1px solid #999999; border-radius: 5px;text-align: center; cursor: pointer'>"+o2.LP.widget.open+"</div></div><div style='height: 20px; line-height: 20px; margin: 0px 40px'>"+r.title+"</div><div style='margin: 0px 40px'><div style='color:#999999; float: left; margin-right: 10px'>"+r.activityName+"</div><div style='color:#999999; float: left; margin-right: 10px'>"+r.activityArrivedTime+"</div><div style='color:#999999; float: left; margin-right: 10px'>"+(r.manualTaskIdentityText||"")+"</div></div>";d.set("html",p);var a=d.getElement(".MWFAction");a.store("work",r),a.addEvent("click",function(r){var d=r.target.retrieve("work");i.workId=d.id,t.node.empty(),t.openApplication(null,e,n||{},o)}.bind(this))}.bind(this)),d.workCompletedList.each(function(r){var d=new Element("div",{styles:{background:"#ffffff","border-radius":"10px",clear:"both","margin-bottom":"10px",height:"40px",padding:"10px 10px"}}).inject(l),p="<div style='height: 40px; width: 40px; float: left; background: url(../x_component_process_Xform/$Form/default/icon/work.png) no-repeat center center'></div><div style='height: 40px; width: 40px; float: right'><div class='MWFAction' style='height: 20px; width: 40px; margin-top: 10px; border: 1px solid #999999; border-radius: 5px;text-align: center; cursor: pointer'>"+o2.LP.widget.open+"</div></div><div style='height: 20px; line-height: 20px; margin: 0px 40px'>"+r.title+"</div><div style='margin: 0px 40px'><div style='color:#999999; float: left; margin-right: 10px'>+o2.LP.widget.workcompleted+</div><div style='color:#999999; float: left; margin-right: 10px'>"+r.completedTime+"</div>";d.set("html",p);var a=d.getElement(".MWFAction");a.store("work",r),a.addEvent("click",function(r){var d=r.target.retrieve("work");i.workCompletedId=d.id,t.node.empty(),t.openApplication(null,e,n||{},o)}.bind(this))}.bind(this))}else d.workList.length?i.workId=d.workList[0].id:i.workCompletedId=d.workCompletedList[0].id,t.openApplication(null,e,n||{},o)}}else t.openApplication(null,e,n||{},o)};t.session&&t.session.user?r():t.sessionPromise&&t.sessionPromise.then((function(){r()}),(function(){}))}(layout)}));