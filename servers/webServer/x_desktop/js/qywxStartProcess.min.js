layout=window.layout||{},layout.desktop=layout,layout.desktop.type="app";var locate=window.location;layout.protocol=locate.protocol,layout.inBrowser=!0,layout.session=layout.session||{},layout.debugger=-1!==locate.href.toString().indexOf("debugger"),o2.xApplication=o2.xApplication||{},o2.xDesktop=o2.xDesktop||{},o2.xDesktop.requireApp=function(o,t,e,n){o2.requireApp(o,t,e,n)},function(o){o.readys=[],o.addReady=function(){for(var t=0;t<arguments.length;t++)"function"===o2.typeOf(arguments[t])&&o.readys.push(arguments[t])};o.openApplication=function(t,e,n,s,i,a,p){var r=e.split("."),c=r[r.length-1];!function(o,t,e){var n=o.split("."),s=o2.xApplication;n.each(function(o,t){t<n.length-1?s[o]=s[o]||{}:s[o]=s[o]||{options:Object.clone(o2.xApplication.Common.options)},s=s[o]}.bind(this)),s.options||(s.options=Object.clone(o2.xApplication.Common.options));o2.xDesktop.requireApp(o,"lp."+o2.language,{failure:function(){o2.xDesktop.requireApp(o,"lp.zh-cn",null,!1)}.bind(this)},!1),o2.xDesktop.requireApp(o,e,(function(){t&&t(s)}))}(e,function(e){var r=n&&n.appId?n.appId:e.options.multitask?"":c;r&&o.desktop.apps&&o.desktop.apps[r]?o.desktop.apps[r].setCurrent():(n&&(n.appId=r),function(t,e,n,s,i,a,p,r){s?s.event=t:s={event:t};var c=new e.Main(o.desktop,s);if(c.desktop=o.desktop,c.status=i,c.inBrowser=!(!a&&!o.inBrowser),"layout"===o.desktop.type){if(c.appId=s.appId?s.appId:e.options.multitask?n+"-"+new o2.widget.UUID:n,c.options.appId=c.appId,p||(p=o.desktop.createTaskItem(c)),c.taskitem=p,c.taskitem.app=c,c.isLoadApplication=!0,c.load(!r),o.desktop.apps||(o.desktop.apps={}),o.desktop.apps[c.appId])o.desktop.apps[c.appId];else o.desktop.apps[c.appId]=c;o.desktop.appArr.push(c),o.desktop.appCurrentList.push(c),r||(o.desktop.currentApp=c)}else c.load(!0),o.app=c;var d=document.getElementById("appContentMask");d&&d.destroy()}(t,e,c,n||{appId:r},s,i,a,p))}.bind(this))},o.startProcess=function(t,e,n){MWF.Actions.get("x_processplatform_assemble_surface").getProcessByName(e,t,function(t){t.data&&MWF.xDesktop.requireApp("process.TaskCenter","ProcessStarter",function(){var e=new MWF.xApplication.process.TaskCenter.ProcessStarter(t.data,o.app,{workData:{},identity:null,latest:!1,onStarted:function(t,e,s){t.work?o.startProcessDraft(t,e,s,n):o.startProcessInstance(t,e,s,n)}.bind(this)}),s=document.getElementById("loaddingArea");s&&s.destroy(),e.load()}.bind(this))}.bind(this))},o.startProcessDraft=function(t,e,n,s){o2.require("o2.widget.UUID",(function(){var e={draft:t.work,appId:"process.Work"+(new o2.widget.UUID).toString(),desktopReload:!1};s?history.replaceState(null,"startProcess",s):history.replaceState(null,"startProcess","../x_desktop/appMobile.html?app=process.TaskCenter"),o.openWorkIn(e)}))},o.startProcessInstance=function(t,e,n,s){var i=[];if(t.each(function(o){-1!=o.currentTaskIndex&&i.push(o.taskList[o.currentTaskIndex].work)}.bind(this)),1==i.length){var a={workId:i[0],appId:i[0]};s?history.replaceState(null,"startProcess",s):history.replaceState(null,"startProcess","../x_desktop/appMobile.html?app=process.TaskCenter"),o.openWorkIn(a)}},o.openWorkIn=function(t){o2.requireApp("Common","",(function(){var e=new URI(window.location.href).getData("redirectlink");e=e?encodeURIComponent(e):encodeURIComponent(locate.pathname+locate.search);t.redirectlink=e,o.app=null,o.openApplication(null,"process.Work",t,null)}),!0)},o.notice=function(o,t,e,n,s){n||(n={x:"right",y:"top"}),e||(e=this.content),t||(t="ok");var i=e||$(document.body),a=s;a||(a={x:10,y:(n.y.toString().toLowerCase(),10)}),new mBox.Notice({type:t,position:n,move:!1,target:i,delayClose:"error"==t?1e4:5e3,offset:a,content:o})}}(layout),o2.addReady((function(){Element.implement({makeLnk:function(o){}}),layout.desktop.addEvent=function(o,t,e){window.addEvent(o,t,e)},layout.desktop.addEvents=function(o){window.addEvents(o)};var o=$("loaddingArea"),t=0,e=document.body.getSize(),n=function(){o&&(o.destroy(),o=null)},s=function(s){if(o)if(s)o.setStyles({width:e.x+"px"}),window.setTimeout(n,500);else{var i=++t/16*e.x;o.setStyles({width:i+"px"}),t>=16&&window.setTimeout(n,500)}};layout.config=null;var i=!1,a=!1,p=!1,r=o2.session.path+"/lp/"+o2.language+".js";o2.load(r,(function(){s(),a=!0,i&&p&&a&&c((function(){d()}))}));o2.require(["o2.xDesktop.Common","o2.xDesktop.Actions.RestActions","o2.xAction.RestActions"],{onSuccess:function(){p=!0,i&&p&&a&&c((function(){d()}))},onEvery:function(){s()}}),o2.getJSON("../x_desktop/res/config/config.json",(function(o){s(),layout.config=o,(i=!0)&&p&&a&&c((function(){d()}))}));var c=function(o){"auto"===layout.config.app_protocol&&(layout.config.app_protocol=window.location.protocol),o2.xDesktop.getServiceAddress(layout.config,function(t,e){layout.serviceAddressList=t,layout.centerServer=e,layout.desktop.serviceAddressList=t,layout.desktop.centerServer=e,s(),o&&o()}.bind(this))},d=function(){var o=function(o){layout.user=o.data,layout.session.user=o.data,layout.session.token=o.data.token,layout.desktop.session=layout.session,function(o){!function(o){var t=!1,e=!1,n=["o2.xDesktop.Dialog","o2.xDesktop.UserData","o2.xDesktop.Access","o2.widget.UUID","o2.xDesktop.Menu","o2.xDesktop.Authentication","o2.widget.PinYin","o2.xDesktop.Access"],i=function(){t&&e&&o&&o()};o2.load(["../o2_lib/mootools/plugin/mBox.min.js"],(function(){s(),t=!0,i()})),o2.require("o2.widget.Common",(function(){s(),o2.require(n,{onSuccess:function(){o2.requireApp("Common","",(function(){s(),e=!0,i()}))},onEvery:function(){s()}})}))}((function(){s(!0);var t=locate.href.toURI(),e=t.getData("redirect"),n=t.getData("processId"),i=t.getData("appId");o.content=$(document.body),o.app=o,o.startProcess(i,n,e)}))}(layout)},t=new URI(window.location.href).get("data");if(t[o2.tokenName]){Cookie.dispose(o2.tokenName);var e=window.location.host,n=null;/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(e)?n=e:e.indexOf(".")>0&&(n=e.substring(e.indexOf("."))),n?Cookie.write(o2.tokenName,t[o2.tokenName],{domain:n,path:"/"}):Cookie.write(o2.tokenName,t[o2.tokenName])}o2.Actions.get("x_organization_assemble_authentication").getAuthentication(function(t){s(),o(t)}.bind(this),(function(o){s();!function(o){var t=!1,e=!1,n=["o2.xDesktop.Dialog","o2.xDesktop.UserData","o2.xDesktop.Access","o2.widget.UUID","o2.xDesktop.Menu","o2.widget.PinYin","o2.xDesktop.Access"],i=function(){t&&e&&o&&o()};o2.load(["../o2_lib/mootools/plugin/mBox.min.js"],(function(){s(),t=!0,i()})),o2.require("o2.widget.Common",(function(){s(),o2.require(n,{onSuccess:function(){o2.requireApp("Common","",(function(){e=!0,i()}))},onEvery:function(){s()}})}))}((function(){s(!0),layout.openLoginQywx()}))})),layout.openLoginQywx=function(){var o=locate.href.toURI();MWF.require("MWF.xDesktop.Actions.RestActions",(function(){var t=new MWF.xDesktop.Actions.RestActions("","x_organization_assemble_authentication","");t.getActions=function(o){this.actions={sso:{uri:"/jaxrs/qiyeweixin/code/{code}",method:"GET"}},o&&o()},t.invoke({name:"sso",async:!0,parameter:{code:o.getData("code")},success:function(o){layout.session.user=o.data,d()}.bind(this),failure:function(o,t,e){var n=document.getElementById("loaddingArea");n&&n.destroy(),document.id("layout").set("html","<div>企业微信单点异常！</div>")}.bind(this)})}))}}}));