layout=window.layout||{};var locate=window.location;layout.protocol=locate.protocol;var href=locate.href;-1!=href.indexOf("debugger")&&(layout.debugger=!0),layout.desktop=layout,layout.session=layout.session||{},o2.xDesktop=o2.xDesktop||{},o2.addReady((function(){var o=$("loaddingArea"),t=0,e=document.body.getSize(),n=function(){o&&(o.destroy(),o=null)},a=function(a){if(o)if(a)o.setStyles({width:e.x+"px"}),window.setTimeout(n,500);else{var i=++t/16*e.x;o.setStyles({width:i+"px"}),t>=16&&window.setTimeout(n,500)}};o2.load(["../o2_lib/mootools/plugin/mBox.Notice.js","../o2_lib/mootools/plugin/mBox.Tooltip.js"],{sequence:!0},(function(){MWF.loadLP("zh-cn"),MWF.require("MWF.xDesktop.Layout",(function(){MWF.require("MWF.xDesktop.Authentication",null,!1),function(){layout.load=function(){var o=href.toURI(),t=o.getData("redirect"),e=o.getData("code");console.log("code："+e);var n=o.getData("type");console.log("type："+n),n&&"bind"===n?layout._authForm():(layout.showLoading(),o2.Actions.load("x_organization_assemble_authentication").MPweixinAction.loginWithCode(e,(function(o){console.log(o),layout.hideLoading(),layout.session.user=o.data,t?(history.replaceState(null,"page",t),t.toURI().go()):(history.replaceState(null,"page","../x_desktop/appMobile.html?app=process.TaskCenter"),"appMobile.html?app=process.TaskCenter".toURI().go())}),(function(o){layout.hideLoading(),console.log(o),layout.notice("单点登录失败，请先绑定用户","error")})))},layout._authForm=function(){$(document.body).loadAll({css:["../x_desktop/template/_mpwxssoLogin.css"],html:["../x_desktop/template/_mpwxssoLogin.html"]},{bind:layout,module:layout},function(){layout.loginPwdModeNode.addEvents({click:function(o){o.target.addClass("mode-active"),layout.loginCodeModeNode.removeClass("mode-active"),layout.loginCodeBoxNode.setStyles({display:"none"}),layout.loginInputPasswordNode.setStyles({display:""}),layout.loginMode="password"}}),layout.loginCodeModeNode.addEvents({click:function(o){o.target.addClass("mode-active"),layout.loginPwdModeNode.removeClass("mode-active"),layout.loginCodeBoxNode.setStyles({display:""}),layout.loginInputPasswordNode.setStyles({display:"none"}),layout.loginMode="code"}}),layout.getCodeBtnNode.addEvents({click:function(o){layout._getCodeForLogin()}}),layout.loginBtnNode.addEvents({click:function(o){var t=layout.loginInputUsernameNode.get("value");if(t&&""!==t)if(layout.loginMode&&"code"===layout.loginMode){var e=layout.loginInputCodeNode.get("value");if(!e||""===e)return void layout.notice("请先输入验证码！","error");var n={credential:t,codeAnswer:e};layout.showLoading(),o2.Actions.load("x_organization_assemble_authentication").AuthenticationAction.codeLogin(n,(function(o){console.log("登录成功。。。。。。。"),layout.session.user=o.data,layout._bindWeixin2User()}),(function(o){layout.hideLoading(),console.log(o),layout.notice("登录失败！","error")}))}else{var a=layout.loginInputPasswordNode.get("value");if(!a||""===a)return void layout.notice("请先输入密码！","error");n={credential:t,password:a};layout.showLoading(),o2.Actions.load("x_organization_assemble_authentication").AuthenticationAction.login(n,(function(o){layout.session.user=o.data,layout.loginBoxNode.destroy(),layout._bindWeixin2User()}),(function(o){layout.hideLoading(),console.log(o),layout.notice("登录失败！","error")}))}else layout.notice("请先输入用户名或手机号码！","error")}})}.bind(layout))},layout._bindWeixin2User=function(){var o=href.toURI().getData("code");o?o2.Actions.load("x_organization_assemble_authentication").MPweixinAction.bindWithCode(o,(function(o){layout.hideLoading();var t=new Element("div",{style:"text-align: center;"}).inject($(document.body));new Element("h2",{text:"绑定成功！"}).inject(t)}),(function(o){layout.hideLoading(),console.log(o),layout.notice("绑定账号失败","error")})):(layout.hideLoading(),layout.notice("没有传入微信code无法绑定","error"))},layout._getCodeForLogin=function(){var o=layout.loginInputUsernameNode.get("value");o&&""!==o?(layout.countDownTime=60,layout.getCodeBtnNode.removeClass("code-btn"),layout.getCodeBtnNode.addClass("code-btn-sending"),layout.countDownTime--,layout.getCodeBtnNode.set("text",layout.countDownTime+"秒后可重新获取"),layout.countDownFun=setInterval(()=>{layout._countDownSendCode()},1e3),o2.Actions.load("x_organization_assemble_authentication").AuthenticationAction.code(o,(function(o){layout.notice("验证码已经发送，请注意查收！","success")}),(function(o){console.log(o),layout.notice("发送验证码失败！","error")}))):layout.notice("请先输入用户名或手机号码！","error")},layout._countDownSendCode=function(){0===layout.countDownTime?(layout.getCodeBtnNode.removeClass("code-btn-sending"),layout.getCodeBtnNode.addClass("code-btn"),layout.getCodeBtnNode.set("text","获取验证码"),layout.countDownTime=60,layout.countDownFun&&(clearInterval(layout.countDownFun),layout.countDownFun=null)):(layout.countDownTime--,layout.getCodeBtnNode.set("text",layout.countDownTime+"秒后可重新获取"))},layout.showLoading=function(){layout.loadingGif=new Element("div",{sytle:"position:fixed;left:0;right:0;top:0;text-align: center;margin: 60px;"}).inject($(document.body)),new Element("img",{src:"../x_desktop/img/loading2.gif",style:"width: 96px; height: 96px;"}).inject(layout.loadingGif)},layout.hideLoading=function(){layout.loadingGif&&(layout.loadingGif.destroy(),layout.loadingGif=null)},layout.notice=function(o,t,e,n,a){n||(n={x:"right",y:"top"}),e||(e=this.content),t||(t="ok");var i=e||$(document.body),l=a;l||(l={x:10,y:(n.y.toString().toLowerCase(),10)}),new mBox.Notice({type:t,position:n,move:!1,target:i,delayClose:"error"==t?1e4:5e3,offset:l,content:o})},layout.config=null;var o=!1,t=!1,e=!1,n=o2.session.path+"/lp/"+o2.language+".js";o2.load(n,(function(){a(),t=!0;o2.require(["o2.xDesktop.$all"],{onSuccess:function(){e=!0,o&&e&&t&&i((function(){layout.load()}))},onEvery:function(){a()}})})),o2.getJSON("../x_desktop/res/config/config.json",(function(n){a(),layout.config=n,(o=!0)&&e&&t&&i((function(){layout.load()}))}));var i=function(o){"auto"===layout.config.app_protocol&&(layout.config.app_protocol=window.location.protocol),o2.xDesktop.getServiceAddress(layout.config,function(t,e){layout.serviceAddressList=t,layout.centerServer=e,a(),o&&o()}.bind(this))}}()}))}))}));