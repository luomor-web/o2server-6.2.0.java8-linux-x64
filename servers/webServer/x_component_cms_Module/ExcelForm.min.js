MWF.xDesktop.requireApp("Template","MPopupForm",null,!1),MWF.xApplication.cms=MWF.xApplication.cms||{},MWF.xApplication.cms.Module=MWF.xApplication.cms.Module||{},MWF.xDesktop.requireApp("cms.Module","$ExcelForm.lp."+MWF.language,null,!1),MWF.xApplication.cms.Module.ImportForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"cms",width:"650",height:"300",hasTop:!0,hasIcon:!1,draggable:!0,title:MWF.xApplication.cms.Module.ExcelForm.lp.importData},initialize:function(t,e,i,s){this.lp=MWF.xApplication.cms.Module.ExcelForm.lp,this.setOptions(i),this.data=e,this.explorer=t,this.app=this.explorer.app,this.container=this.app.content,this.action=MWF.Actions.get("x_cms_assemble_control"),this.path="../x_component_cms_Module/$ExcelForm/",this.cssPath="../x_component_Template/$MPopupForm/"+this.options.style+"/css.wcss",this.load()},_createTableContent:function(){this.formTableArea.set("html","<table width='100%' bordr='0' cellpadding='7' cellspacing='0' styles='formTable' style='margin-top: 20px; '><tr><td styles='formTableTitle' lable='url' width='20%'></td>    <td styles='formTableValue' item='url' colspan='3' width='80%'></td></tr><tr><td styles='formTableTitle' lable='file' ></td>    <td styles='formTableValue' colspan='3'><div item='filename'></div><div item='file'></div></td></tr></table>"),MWF.xDesktop.requireApp("Template","MForm",null,!1),this.form=new MForm(this.formTableArea,{},{isEdited:!0,style:"cms",hasColon:!0,itemTemplate:{url:{text:this.lp.downloadTemplate},file:{type:"button",value:this.lp.selectExcelFile,text:this.lp.selectFile,event:{click:function(){this.selectFile()}.bind(this)}}}},this.app),this.form.load()},_setCustom:function(){this.formTableContainer.setStyles({"margin-left":"60px",width:"520px"}),this.formBottomNode.setStyles({"padding-right":"195px","padding-bottom":"20px"})},selectFile:function(){if(!this.uploadFileAreaNode){this.uploadFileAreaNode=new Element("div");this.uploadFileAreaNode.set("html",'<input name="file" type="file" accept="csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" />'),this.fileUploadNode=this.uploadFileAreaNode.getFirst(),this.fileUploadNode.addEvent("change",function(){var e=t.files;if(e.length){var i=e.item(0);if(i.name.indexOf(" ")>-1)return this.app.notice("上传的文件不能带空格","error"),!1;this.file=i,this.formData=new FormData,this.formData.append("file",this.file),this.formTableArea.getElement("[item='filename']").set("text",i.name)}}.bind(this))}var t=this.uploadFileAreaNode.getFirst();t.click()},ok:function(t){this.formData?this.action.importDocumentFormExcel(this.data.id,function(){this.formData=null,this.file=null}.bind(this),null,this.formData,this.file):this.app.notice(this.lp.selectExcelFileNotice,"error")}}),MWF.xApplication.cms.Module.ExportForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"cms",width:"850",height:"700",maxAction:!0,hasTop:!0,hasIcon:!1,hasBottom:!0,draggable:!0,title:MWF.xApplication.cms.Module.ExcelForm.lp.exportData},initialize:function(t,e,i,s){MWF.xDesktop.requireApp("cms.Module","$ExcelForm.lp."+MWF.language,null,!1),this.lp=MWF.xApplication.cms.Module.ExcelForm.lp,this.setOptions(i),this.data=e,this.explorer=t,this.app=this.explorer.app,this.container=this.app.content,this.action=MWF.Actions.get("x_cms_assemble_control"),this.path="../x_component_cms_Module/$ExcelForm/",this.cssPath="../x_component_Template/$MPopupForm/"+this.options.style+"/css.wcss",this.load()},_setCustom:function(){},_createTableContent:function(){this.formTableArea.setStyles({"margin-left":"20px","margin-right":"20px"});var t={application:this.data.importViewAppId,viewName:this.data.importViewId,isTitle:"yes",select:"multi"};MWF.xDesktop.requireApp("query.Query","Viewer",function(){this.view=new MWF.xApplication.query.Query.Viewer(this.formTableArea,t,{onSelect:function(){this.fireEvent("select")}.bind(this)},this.app)}.bind(this))},_setNodesSize:function(t,e,i,s){this.formTableArea.setStyles({height:s+"px"}),this.view&&this.view.node&&this.view.viewAreaNode&&this.view.setContentHeight()}});